"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
exports.id = "vendor-chunks/mongodb";
exports.ids = ["vendor-chunks/mongodb"];
exports.modules = {

/***/ "(api)/../server/node_modules/mongodb/lib/admin.js":
/*!***************************************************!*\
  !*** ../server/node_modules/mongodb/lib/admin.js ***!
  \***************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.Admin = void 0;\nconst add_user_1 = __webpack_require__(/*! ./operations/add_user */ \"(api)/../server/node_modules/mongodb/lib/operations/add_user.js\");\nconst execute_operation_1 = __webpack_require__(/*! ./operations/execute_operation */ \"(api)/../server/node_modules/mongodb/lib/operations/execute_operation.js\");\nconst list_databases_1 = __webpack_require__(/*! ./operations/list_databases */ \"(api)/../server/node_modules/mongodb/lib/operations/list_databases.js\");\nconst remove_user_1 = __webpack_require__(/*! ./operations/remove_user */ \"(api)/../server/node_modules/mongodb/lib/operations/remove_user.js\");\nconst run_command_1 = __webpack_require__(/*! ./operations/run_command */ \"(api)/../server/node_modules/mongodb/lib/operations/run_command.js\");\nconst validate_collection_1 = __webpack_require__(/*! ./operations/validate_collection */ \"(api)/../server/node_modules/mongodb/lib/operations/validate_collection.js\");\n/**\n * The **Admin** class is an internal class that allows convenient access to\n * the admin functionality and commands for MongoDB.\n *\n * **ADMIN Cannot directly be instantiated**\n * @public\n *\n * @example\n * ```ts\n * import { MongoClient } from 'mongodb';\n *\n * const client = new MongoClient('mongodb://localhost:27017');\n * const admin = client.db().admin();\n * const dbInfo = await admin.listDatabases();\n * for (const db of dbInfo.databases) {\n *   console.log(db.name);\n * }\n * ```\n */\nclass Admin {\n    /**\n     * Create a new Admin instance\n     * @internal\n     */\n    constructor(db) {\n        this.s = { db };\n    }\n    /**\n     * Execute a command\n     *\n     * The driver will ensure the following fields are attached to the command sent to the server:\n     * - `lsid` - sourced from an implicit session or options.session\n     * - `$readPreference` - defaults to primary or can be configured by options.readPreference\n     * - `$db` - sourced from the name of this database\n     *\n     * If the client has a serverApi setting:\n     * - `apiVersion`\n     * - `apiStrict`\n     * - `apiDeprecationErrors`\n     *\n     * When in a transaction:\n     * - `readConcern` - sourced from readConcern set on the TransactionOptions\n     * - `writeConcern` - sourced from writeConcern set on the TransactionOptions\n     *\n     * Attaching any of the above fields to the command will have no effect as the driver will overwrite the value.\n     *\n     * @param command - The command to execute\n     * @param options - Optional settings for the command\n     */\n    async command(command, options) {\n        return (0, execute_operation_1.executeOperation)(this.s.db.client, new run_command_1.RunCommandOperation(this.s.db, command, { dbName: 'admin', ...options }));\n    }\n    /**\n     * Retrieve the server build information\n     *\n     * @param options - Optional settings for the command\n     */\n    async buildInfo(options) {\n        return this.command({ buildinfo: 1 }, options);\n    }\n    /**\n     * Retrieve the server build information\n     *\n     * @param options - Optional settings for the command\n     */\n    async serverInfo(options) {\n        return this.command({ buildinfo: 1 }, options);\n    }\n    /**\n     * Retrieve this db's server status.\n     *\n     * @param options - Optional settings for the command\n     */\n    async serverStatus(options) {\n        return this.command({ serverStatus: 1 }, options);\n    }\n    /**\n     * Ping the MongoDB server and retrieve results\n     *\n     * @param options - Optional settings for the command\n     */\n    async ping(options) {\n        return this.command({ ping: 1 }, options);\n    }\n    /**\n     * Add a user to the database\n     *\n     * @param username - The username for the new user\n     * @param passwordOrOptions - An optional password for the new user, or the options for the command\n     * @param options - Optional settings for the command\n     * @deprecated Use the createUser command in `db.command()` instead.\n     * @see https://www.mongodb.com/docs/manual/reference/command/createUser/\n     */\n    async addUser(username, passwordOrOptions, options) {\n        options =\n            options != null && typeof options === 'object'\n                ? options\n                : passwordOrOptions != null && typeof passwordOrOptions === 'object'\n                    ? passwordOrOptions\n                    : undefined;\n        const password = typeof passwordOrOptions === 'string' ? passwordOrOptions : undefined;\n        return (0, execute_operation_1.executeOperation)(this.s.db.client, new add_user_1.AddUserOperation(this.s.db, username, password, { dbName: 'admin', ...options }));\n    }\n    /**\n     * Remove a user from a database\n     *\n     * @param username - The username to remove\n     * @param options - Optional settings for the command\n     */\n    async removeUser(username, options) {\n        return (0, execute_operation_1.executeOperation)(this.s.db.client, new remove_user_1.RemoveUserOperation(this.s.db, username, { dbName: 'admin', ...options }));\n    }\n    /**\n     * Validate an existing collection\n     *\n     * @param collectionName - The name of the collection to validate.\n     * @param options - Optional settings for the command\n     */\n    async validateCollection(collectionName, options = {}) {\n        return (0, execute_operation_1.executeOperation)(this.s.db.client, new validate_collection_1.ValidateCollectionOperation(this, collectionName, options));\n    }\n    /**\n     * List the available databases\n     *\n     * @param options - Optional settings for the command\n     */\n    async listDatabases(options) {\n        return (0, execute_operation_1.executeOperation)(this.s.db.client, new list_databases_1.ListDatabasesOperation(this.s.db, options));\n    }\n    /**\n     * Get ReplicaSet status\n     *\n     * @param options - Optional settings for the command\n     */\n    async replSetGetStatus(options) {\n        return this.command({ replSetGetStatus: 1 }, options);\n    }\n}\nexports.Admin = Admin;\n//# sourceMappingURL=admin.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9hZG1pbi5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxhQUFhO0FBQ2IsbUJBQW1CLG1CQUFPLENBQUMsOEZBQXVCO0FBQ2xELDRCQUE0QixtQkFBTyxDQUFDLGdIQUFnQztBQUNwRSx5QkFBeUIsbUJBQU8sQ0FBQywwR0FBNkI7QUFDOUQsc0JBQXNCLG1CQUFPLENBQUMsb0dBQTBCO0FBQ3hELHNCQUFzQixtQkFBTyxDQUFDLG9HQUEwQjtBQUN4RCw4QkFBOEIsbUJBQU8sQ0FBQyxvSEFBa0M7QUFDeEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxjQUFjO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQjtBQUNuQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1SUFBdUksNkJBQTZCO0FBQ3BLO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEJBQThCLGNBQWM7QUFDNUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFBOEIsY0FBYztBQUM1QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhCQUE4QixpQkFBaUI7QUFDL0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFBOEIsU0FBUztBQUN2QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0SUFBNEksNkJBQTZCO0FBQ3pLO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3SUFBd0ksNkJBQTZCO0FBQ3JLO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseURBQXlEO0FBQ3pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEJBQThCLHFCQUFxQjtBQUNuRDtBQUNBO0FBQ0EsYUFBYTtBQUNiIiwic291cmNlcyI6WyJEOlxcc2Fsb25pXFxhcHByYWlzYWwtc3lzdGVtXFxzZXJ2ZXJcXG5vZGVfbW9kdWxlc1xcbW9uZ29kYlxcbGliXFxhZG1pbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuQWRtaW4gPSB2b2lkIDA7XG5jb25zdCBhZGRfdXNlcl8xID0gcmVxdWlyZShcIi4vb3BlcmF0aW9ucy9hZGRfdXNlclwiKTtcbmNvbnN0IGV4ZWN1dGVfb3BlcmF0aW9uXzEgPSByZXF1aXJlKFwiLi9vcGVyYXRpb25zL2V4ZWN1dGVfb3BlcmF0aW9uXCIpO1xuY29uc3QgbGlzdF9kYXRhYmFzZXNfMSA9IHJlcXVpcmUoXCIuL29wZXJhdGlvbnMvbGlzdF9kYXRhYmFzZXNcIik7XG5jb25zdCByZW1vdmVfdXNlcl8xID0gcmVxdWlyZShcIi4vb3BlcmF0aW9ucy9yZW1vdmVfdXNlclwiKTtcbmNvbnN0IHJ1bl9jb21tYW5kXzEgPSByZXF1aXJlKFwiLi9vcGVyYXRpb25zL3J1bl9jb21tYW5kXCIpO1xuY29uc3QgdmFsaWRhdGVfY29sbGVjdGlvbl8xID0gcmVxdWlyZShcIi4vb3BlcmF0aW9ucy92YWxpZGF0ZV9jb2xsZWN0aW9uXCIpO1xuLyoqXG4gKiBUaGUgKipBZG1pbioqIGNsYXNzIGlzIGFuIGludGVybmFsIGNsYXNzIHRoYXQgYWxsb3dzIGNvbnZlbmllbnQgYWNjZXNzIHRvXG4gKiB0aGUgYWRtaW4gZnVuY3Rpb25hbGl0eSBhbmQgY29tbWFuZHMgZm9yIE1vbmdvREIuXG4gKlxuICogKipBRE1JTiBDYW5ub3QgZGlyZWN0bHkgYmUgaW5zdGFudGlhdGVkKipcbiAqIEBwdWJsaWNcbiAqXG4gKiBAZXhhbXBsZVxuICogYGBgdHNcbiAqIGltcG9ydCB7IE1vbmdvQ2xpZW50IH0gZnJvbSAnbW9uZ29kYic7XG4gKlxuICogY29uc3QgY2xpZW50ID0gbmV3IE1vbmdvQ2xpZW50KCdtb25nb2RiOi8vbG9jYWxob3N0OjI3MDE3Jyk7XG4gKiBjb25zdCBhZG1pbiA9IGNsaWVudC5kYigpLmFkbWluKCk7XG4gKiBjb25zdCBkYkluZm8gPSBhd2FpdCBhZG1pbi5saXN0RGF0YWJhc2VzKCk7XG4gKiBmb3IgKGNvbnN0IGRiIG9mIGRiSW5mby5kYXRhYmFzZXMpIHtcbiAqICAgY29uc29sZS5sb2coZGIubmFtZSk7XG4gKiB9XG4gKiBgYGBcbiAqL1xuY2xhc3MgQWRtaW4ge1xuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIG5ldyBBZG1pbiBpbnN0YW5jZVxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGRiKSB7XG4gICAgICAgIHRoaXMucyA9IHsgZGIgfTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRXhlY3V0ZSBhIGNvbW1hbmRcbiAgICAgKlxuICAgICAqIFRoZSBkcml2ZXIgd2lsbCBlbnN1cmUgdGhlIGZvbGxvd2luZyBmaWVsZHMgYXJlIGF0dGFjaGVkIHRvIHRoZSBjb21tYW5kIHNlbnQgdG8gdGhlIHNlcnZlcjpcbiAgICAgKiAtIGBsc2lkYCAtIHNvdXJjZWQgZnJvbSBhbiBpbXBsaWNpdCBzZXNzaW9uIG9yIG9wdGlvbnMuc2Vzc2lvblxuICAgICAqIC0gYCRyZWFkUHJlZmVyZW5jZWAgLSBkZWZhdWx0cyB0byBwcmltYXJ5IG9yIGNhbiBiZSBjb25maWd1cmVkIGJ5IG9wdGlvbnMucmVhZFByZWZlcmVuY2VcbiAgICAgKiAtIGAkZGJgIC0gc291cmNlZCBmcm9tIHRoZSBuYW1lIG9mIHRoaXMgZGF0YWJhc2VcbiAgICAgKlxuICAgICAqIElmIHRoZSBjbGllbnQgaGFzIGEgc2VydmVyQXBpIHNldHRpbmc6XG4gICAgICogLSBgYXBpVmVyc2lvbmBcbiAgICAgKiAtIGBhcGlTdHJpY3RgXG4gICAgICogLSBgYXBpRGVwcmVjYXRpb25FcnJvcnNgXG4gICAgICpcbiAgICAgKiBXaGVuIGluIGEgdHJhbnNhY3Rpb246XG4gICAgICogLSBgcmVhZENvbmNlcm5gIC0gc291cmNlZCBmcm9tIHJlYWRDb25jZXJuIHNldCBvbiB0aGUgVHJhbnNhY3Rpb25PcHRpb25zXG4gICAgICogLSBgd3JpdGVDb25jZXJuYCAtIHNvdXJjZWQgZnJvbSB3cml0ZUNvbmNlcm4gc2V0IG9uIHRoZSBUcmFuc2FjdGlvbk9wdGlvbnNcbiAgICAgKlxuICAgICAqIEF0dGFjaGluZyBhbnkgb2YgdGhlIGFib3ZlIGZpZWxkcyB0byB0aGUgY29tbWFuZCB3aWxsIGhhdmUgbm8gZWZmZWN0IGFzIHRoZSBkcml2ZXIgd2lsbCBvdmVyd3JpdGUgdGhlIHZhbHVlLlxuICAgICAqXG4gICAgICogQHBhcmFtIGNvbW1hbmQgLSBUaGUgY29tbWFuZCB0byBleGVjdXRlXG4gICAgICogQHBhcmFtIG9wdGlvbnMgLSBPcHRpb25hbCBzZXR0aW5ncyBmb3IgdGhlIGNvbW1hbmRcbiAgICAgKi9cbiAgICBhc3luYyBjb21tYW5kKGNvbW1hbmQsIG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuICgwLCBleGVjdXRlX29wZXJhdGlvbl8xLmV4ZWN1dGVPcGVyYXRpb24pKHRoaXMucy5kYi5jbGllbnQsIG5ldyBydW5fY29tbWFuZF8xLlJ1bkNvbW1hbmRPcGVyYXRpb24odGhpcy5zLmRiLCBjb21tYW5kLCB7IGRiTmFtZTogJ2FkbWluJywgLi4ub3B0aW9ucyB9KSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHJpZXZlIHRoZSBzZXJ2ZXIgYnVpbGQgaW5mb3JtYXRpb25cbiAgICAgKlxuICAgICAqIEBwYXJhbSBvcHRpb25zIC0gT3B0aW9uYWwgc2V0dGluZ3MgZm9yIHRoZSBjb21tYW5kXG4gICAgICovXG4gICAgYXN5bmMgYnVpbGRJbmZvKG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29tbWFuZCh7IGJ1aWxkaW5mbzogMSB9LCBvcHRpb25zKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0cmlldmUgdGhlIHNlcnZlciBidWlsZCBpbmZvcm1hdGlvblxuICAgICAqXG4gICAgICogQHBhcmFtIG9wdGlvbnMgLSBPcHRpb25hbCBzZXR0aW5ncyBmb3IgdGhlIGNvbW1hbmRcbiAgICAgKi9cbiAgICBhc3luYyBzZXJ2ZXJJbmZvKG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29tbWFuZCh7IGJ1aWxkaW5mbzogMSB9LCBvcHRpb25zKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0cmlldmUgdGhpcyBkYidzIHNlcnZlciBzdGF0dXMuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzIGZvciB0aGUgY29tbWFuZFxuICAgICAqL1xuICAgIGFzeW5jIHNlcnZlclN0YXR1cyhvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbW1hbmQoeyBzZXJ2ZXJTdGF0dXM6IDEgfSwgb3B0aW9ucyk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFBpbmcgdGhlIE1vbmdvREIgc2VydmVyIGFuZCByZXRyaWV2ZSByZXN1bHRzXG4gICAgICpcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzIGZvciB0aGUgY29tbWFuZFxuICAgICAqL1xuICAgIGFzeW5jIHBpbmcob3B0aW9ucykge1xuICAgICAgICByZXR1cm4gdGhpcy5jb21tYW5kKHsgcGluZzogMSB9LCBvcHRpb25zKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQWRkIGEgdXNlciB0byB0aGUgZGF0YWJhc2VcbiAgICAgKlxuICAgICAqIEBwYXJhbSB1c2VybmFtZSAtIFRoZSB1c2VybmFtZSBmb3IgdGhlIG5ldyB1c2VyXG4gICAgICogQHBhcmFtIHBhc3N3b3JkT3JPcHRpb25zIC0gQW4gb3B0aW9uYWwgcGFzc3dvcmQgZm9yIHRoZSBuZXcgdXNlciwgb3IgdGhlIG9wdGlvbnMgZm9yIHRoZSBjb21tYW5kXG4gICAgICogQHBhcmFtIG9wdGlvbnMgLSBPcHRpb25hbCBzZXR0aW5ncyBmb3IgdGhlIGNvbW1hbmRcbiAgICAgKiBAZGVwcmVjYXRlZCBVc2UgdGhlIGNyZWF0ZVVzZXIgY29tbWFuZCBpbiBgZGIuY29tbWFuZCgpYCBpbnN0ZWFkLlxuICAgICAqIEBzZWUgaHR0cHM6Ly93d3cubW9uZ29kYi5jb20vZG9jcy9tYW51YWwvcmVmZXJlbmNlL2NvbW1hbmQvY3JlYXRlVXNlci9cbiAgICAgKi9cbiAgICBhc3luYyBhZGRVc2VyKHVzZXJuYW1lLCBwYXNzd29yZE9yT3B0aW9ucywgb3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID1cbiAgICAgICAgICAgIG9wdGlvbnMgIT0gbnVsbCAmJiB0eXBlb2Ygb3B0aW9ucyA9PT0gJ29iamVjdCdcbiAgICAgICAgICAgICAgICA/IG9wdGlvbnNcbiAgICAgICAgICAgICAgICA6IHBhc3N3b3JkT3JPcHRpb25zICE9IG51bGwgJiYgdHlwZW9mIHBhc3N3b3JkT3JPcHRpb25zID09PSAnb2JqZWN0J1xuICAgICAgICAgICAgICAgICAgICA/IHBhc3N3b3JkT3JPcHRpb25zXG4gICAgICAgICAgICAgICAgICAgIDogdW5kZWZpbmVkO1xuICAgICAgICBjb25zdCBwYXNzd29yZCA9IHR5cGVvZiBwYXNzd29yZE9yT3B0aW9ucyA9PT0gJ3N0cmluZycgPyBwYXNzd29yZE9yT3B0aW9ucyA6IHVuZGVmaW5lZDtcbiAgICAgICAgcmV0dXJuICgwLCBleGVjdXRlX29wZXJhdGlvbl8xLmV4ZWN1dGVPcGVyYXRpb24pKHRoaXMucy5kYi5jbGllbnQsIG5ldyBhZGRfdXNlcl8xLkFkZFVzZXJPcGVyYXRpb24odGhpcy5zLmRiLCB1c2VybmFtZSwgcGFzc3dvcmQsIHsgZGJOYW1lOiAnYWRtaW4nLCAuLi5vcHRpb25zIH0pKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVtb3ZlIGEgdXNlciBmcm9tIGEgZGF0YWJhc2VcbiAgICAgKlxuICAgICAqIEBwYXJhbSB1c2VybmFtZSAtIFRoZSB1c2VybmFtZSB0byByZW1vdmVcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzIGZvciB0aGUgY29tbWFuZFxuICAgICAqL1xuICAgIGFzeW5jIHJlbW92ZVVzZXIodXNlcm5hbWUsIG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuICgwLCBleGVjdXRlX29wZXJhdGlvbl8xLmV4ZWN1dGVPcGVyYXRpb24pKHRoaXMucy5kYi5jbGllbnQsIG5ldyByZW1vdmVfdXNlcl8xLlJlbW92ZVVzZXJPcGVyYXRpb24odGhpcy5zLmRiLCB1c2VybmFtZSwgeyBkYk5hbWU6ICdhZG1pbicsIC4uLm9wdGlvbnMgfSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBWYWxpZGF0ZSBhbiBleGlzdGluZyBjb2xsZWN0aW9uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gY29sbGVjdGlvbk5hbWUgLSBUaGUgbmFtZSBvZiB0aGUgY29sbGVjdGlvbiB0byB2YWxpZGF0ZS5cbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzIGZvciB0aGUgY29tbWFuZFxuICAgICAqL1xuICAgIGFzeW5jIHZhbGlkYXRlQ29sbGVjdGlvbihjb2xsZWN0aW9uTmFtZSwgb3B0aW9ucyA9IHt9KSB7XG4gICAgICAgIHJldHVybiAoMCwgZXhlY3V0ZV9vcGVyYXRpb25fMS5leGVjdXRlT3BlcmF0aW9uKSh0aGlzLnMuZGIuY2xpZW50LCBuZXcgdmFsaWRhdGVfY29sbGVjdGlvbl8xLlZhbGlkYXRlQ29sbGVjdGlvbk9wZXJhdGlvbih0aGlzLCBjb2xsZWN0aW9uTmFtZSwgb3B0aW9ucykpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBMaXN0IHRoZSBhdmFpbGFibGUgZGF0YWJhc2VzXG4gICAgICpcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzIGZvciB0aGUgY29tbWFuZFxuICAgICAqL1xuICAgIGFzeW5jIGxpc3REYXRhYmFzZXMob3B0aW9ucykge1xuICAgICAgICByZXR1cm4gKDAsIGV4ZWN1dGVfb3BlcmF0aW9uXzEuZXhlY3V0ZU9wZXJhdGlvbikodGhpcy5zLmRiLmNsaWVudCwgbmV3IGxpc3RfZGF0YWJhc2VzXzEuTGlzdERhdGFiYXNlc09wZXJhdGlvbih0aGlzLnMuZGIsIG9wdGlvbnMpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogR2V0IFJlcGxpY2FTZXQgc3RhdHVzXG4gICAgICpcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzIGZvciB0aGUgY29tbWFuZFxuICAgICAqL1xuICAgIGFzeW5jIHJlcGxTZXRHZXRTdGF0dXMob3B0aW9ucykge1xuICAgICAgICByZXR1cm4gdGhpcy5jb21tYW5kKHsgcmVwbFNldEdldFN0YXR1czogMSB9LCBvcHRpb25zKTtcbiAgICB9XG59XG5leHBvcnRzLkFkbWluID0gQWRtaW47XG4vLyMgc291cmNlTWFwcGluZ1VSTD1hZG1pbi5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/admin.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/bson.js":
/*!**************************************************!*\
  !*** ../server/node_modules/mongodb/lib/bson.js ***!
  \**************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.resolveBSONOptions = exports.pluckBSONSerializeOptions = exports.Timestamp = exports.serialize = exports.ObjectId = exports.MinKey = exports.MaxKey = exports.Long = exports.Int32 = exports.Double = exports.deserialize = exports.Decimal128 = exports.DBRef = exports.Code = exports.calculateObjectSize = exports.BSONType = exports.BSONSymbol = exports.BSONRegExp = exports.BSON = exports.Binary = void 0;\nvar bson_1 = __webpack_require__(/*! bson */ \"(api)/../server/node_modules/bson/lib/bson.cjs\");\nObject.defineProperty(exports, \"Binary\", ({ enumerable: true, get: function () { return bson_1.Binary; } }));\nObject.defineProperty(exports, \"BSON\", ({ enumerable: true, get: function () { return bson_1.BSON; } }));\nObject.defineProperty(exports, \"BSONRegExp\", ({ enumerable: true, get: function () { return bson_1.BSONRegExp; } }));\nObject.defineProperty(exports, \"BSONSymbol\", ({ enumerable: true, get: function () { return bson_1.BSONSymbol; } }));\nObject.defineProperty(exports, \"BSONType\", ({ enumerable: true, get: function () { return bson_1.BSONType; } }));\nObject.defineProperty(exports, \"calculateObjectSize\", ({ enumerable: true, get: function () { return bson_1.calculateObjectSize; } }));\nObject.defineProperty(exports, \"Code\", ({ enumerable: true, get: function () { return bson_1.Code; } }));\nObject.defineProperty(exports, \"DBRef\", ({ enumerable: true, get: function () { return bson_1.DBRef; } }));\nObject.defineProperty(exports, \"Decimal128\", ({ enumerable: true, get: function () { return bson_1.Decimal128; } }));\nObject.defineProperty(exports, \"deserialize\", ({ enumerable: true, get: function () { return bson_1.deserialize; } }));\nObject.defineProperty(exports, \"Double\", ({ enumerable: true, get: function () { return bson_1.Double; } }));\nObject.defineProperty(exports, \"Int32\", ({ enumerable: true, get: function () { return bson_1.Int32; } }));\nObject.defineProperty(exports, \"Long\", ({ enumerable: true, get: function () { return bson_1.Long; } }));\nObject.defineProperty(exports, \"MaxKey\", ({ enumerable: true, get: function () { return bson_1.MaxKey; } }));\nObject.defineProperty(exports, \"MinKey\", ({ enumerable: true, get: function () { return bson_1.MinKey; } }));\nObject.defineProperty(exports, \"ObjectId\", ({ enumerable: true, get: function () { return bson_1.ObjectId; } }));\nObject.defineProperty(exports, \"serialize\", ({ enumerable: true, get: function () { return bson_1.serialize; } }));\nObject.defineProperty(exports, \"Timestamp\", ({ enumerable: true, get: function () { return bson_1.Timestamp; } }));\nfunction pluckBSONSerializeOptions(options) {\n    const { fieldsAsRaw, useBigInt64, promoteValues, promoteBuffers, promoteLongs, serializeFunctions, ignoreUndefined, bsonRegExp, raw, enableUtf8Validation } = options;\n    return {\n        fieldsAsRaw,\n        useBigInt64,\n        promoteValues,\n        promoteBuffers,\n        promoteLongs,\n        serializeFunctions,\n        ignoreUndefined,\n        bsonRegExp,\n        raw,\n        enableUtf8Validation\n    };\n}\nexports.pluckBSONSerializeOptions = pluckBSONSerializeOptions;\n/**\n * Merge the given BSONSerializeOptions, preferring options over the parent's options, and\n * substituting defaults for values not set.\n *\n * @internal\n */\nfunction resolveBSONOptions(options, parent) {\n    const parentOptions = parent?.bsonOptions;\n    return {\n        raw: options?.raw ?? parentOptions?.raw ?? false,\n        useBigInt64: options?.useBigInt64 ?? parentOptions?.useBigInt64 ?? false,\n        promoteLongs: options?.promoteLongs ?? parentOptions?.promoteLongs ?? true,\n        promoteValues: options?.promoteValues ?? parentOptions?.promoteValues ?? true,\n        promoteBuffers: options?.promoteBuffers ?? parentOptions?.promoteBuffers ?? false,\n        ignoreUndefined: options?.ignoreUndefined ?? parentOptions?.ignoreUndefined ?? false,\n        bsonRegExp: options?.bsonRegExp ?? parentOptions?.bsonRegExp ?? false,\n        serializeFunctions: options?.serializeFunctions ?? parentOptions?.serializeFunctions ?? false,\n        fieldsAsRaw: options?.fieldsAsRaw ?? parentOptions?.fieldsAsRaw ?? {},\n        enableUtf8Validation: options?.enableUtf8Validation ?? parentOptions?.enableUtf8Validation ?? true\n    };\n}\nexports.resolveBSONOptions = resolveBSONOptions;\n//# sourceMappingURL=bson.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9ic29uLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELDBCQUEwQixHQUFHLGlDQUFpQyxHQUFHLGlCQUFpQixHQUFHLGlCQUFpQixHQUFHLGdCQUFnQixHQUFHLGNBQWMsR0FBRyxjQUFjLEdBQUcsWUFBWSxHQUFHLGFBQWEsR0FBRyxjQUFjLEdBQUcsbUJBQW1CLEdBQUcsa0JBQWtCLEdBQUcsYUFBYSxHQUFHLFlBQVksR0FBRywyQkFBMkIsR0FBRyxnQkFBZ0IsR0FBRyxrQkFBa0IsR0FBRyxrQkFBa0IsR0FBRyxZQUFZLEdBQUcsY0FBYztBQUNoWixhQUFhLG1CQUFPLENBQUMsNERBQU07QUFDM0IsMENBQXlDLEVBQUUscUNBQXFDLHlCQUF5QixFQUFDO0FBQzFHLHdDQUF1QyxFQUFFLHFDQUFxQyx1QkFBdUIsRUFBQztBQUN0Ryw4Q0FBNkMsRUFBRSxxQ0FBcUMsNkJBQTZCLEVBQUM7QUFDbEgsOENBQTZDLEVBQUUscUNBQXFDLDZCQUE2QixFQUFDO0FBQ2xILDRDQUEyQyxFQUFFLHFDQUFxQywyQkFBMkIsRUFBQztBQUM5Ryx1REFBc0QsRUFBRSxxQ0FBcUMsc0NBQXNDLEVBQUM7QUFDcEksd0NBQXVDLEVBQUUscUNBQXFDLHVCQUF1QixFQUFDO0FBQ3RHLHlDQUF3QyxFQUFFLHFDQUFxQyx3QkFBd0IsRUFBQztBQUN4Ryw4Q0FBNkMsRUFBRSxxQ0FBcUMsNkJBQTZCLEVBQUM7QUFDbEgsK0NBQThDLEVBQUUscUNBQXFDLDhCQUE4QixFQUFDO0FBQ3BILDBDQUF5QyxFQUFFLHFDQUFxQyx5QkFBeUIsRUFBQztBQUMxRyx5Q0FBd0MsRUFBRSxxQ0FBcUMsd0JBQXdCLEVBQUM7QUFDeEcsd0NBQXVDLEVBQUUscUNBQXFDLHVCQUF1QixFQUFDO0FBQ3RHLDBDQUF5QyxFQUFFLHFDQUFxQyx5QkFBeUIsRUFBQztBQUMxRywwQ0FBeUMsRUFBRSxxQ0FBcUMseUJBQXlCLEVBQUM7QUFDMUcsNENBQTJDLEVBQUUscUNBQXFDLDJCQUEyQixFQUFDO0FBQzlHLDZDQUE0QyxFQUFFLHFDQUFxQyw0QkFBNEIsRUFBQztBQUNoSCw2Q0FBNEMsRUFBRSxxQ0FBcUMsNEJBQTRCLEVBQUM7QUFDaEg7QUFDQSxZQUFZLG9KQUFvSjtBQUNoSztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQztBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkVBQTZFO0FBQzdFO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQjtBQUMxQiIsInNvdXJjZXMiOlsiRDpcXHNhbG9uaVxcYXBwcmFpc2FsLXN5c3RlbVxcc2VydmVyXFxub2RlX21vZHVsZXNcXG1vbmdvZGJcXGxpYlxcYnNvbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMucmVzb2x2ZUJTT05PcHRpb25zID0gZXhwb3J0cy5wbHVja0JTT05TZXJpYWxpemVPcHRpb25zID0gZXhwb3J0cy5UaW1lc3RhbXAgPSBleHBvcnRzLnNlcmlhbGl6ZSA9IGV4cG9ydHMuT2JqZWN0SWQgPSBleHBvcnRzLk1pbktleSA9IGV4cG9ydHMuTWF4S2V5ID0gZXhwb3J0cy5Mb25nID0gZXhwb3J0cy5JbnQzMiA9IGV4cG9ydHMuRG91YmxlID0gZXhwb3J0cy5kZXNlcmlhbGl6ZSA9IGV4cG9ydHMuRGVjaW1hbDEyOCA9IGV4cG9ydHMuREJSZWYgPSBleHBvcnRzLkNvZGUgPSBleHBvcnRzLmNhbGN1bGF0ZU9iamVjdFNpemUgPSBleHBvcnRzLkJTT05UeXBlID0gZXhwb3J0cy5CU09OU3ltYm9sID0gZXhwb3J0cy5CU09OUmVnRXhwID0gZXhwb3J0cy5CU09OID0gZXhwb3J0cy5CaW5hcnkgPSB2b2lkIDA7XG52YXIgYnNvbl8xID0gcmVxdWlyZShcImJzb25cIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJCaW5hcnlcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGJzb25fMS5CaW5hcnk7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJCU09OXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBic29uXzEuQlNPTjsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIkJTT05SZWdFeHBcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGJzb25fMS5CU09OUmVnRXhwOyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiQlNPTlN5bWJvbFwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gYnNvbl8xLkJTT05TeW1ib2w7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJCU09OVHlwZVwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gYnNvbl8xLkJTT05UeXBlOyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiY2FsY3VsYXRlT2JqZWN0U2l6ZVwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gYnNvbl8xLmNhbGN1bGF0ZU9iamVjdFNpemU7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJDb2RlXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBic29uXzEuQ29kZTsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIkRCUmVmXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBic29uXzEuREJSZWY7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJEZWNpbWFsMTI4XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBic29uXzEuRGVjaW1hbDEyODsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcImRlc2VyaWFsaXplXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBic29uXzEuZGVzZXJpYWxpemU7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJEb3VibGVcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGJzb25fMS5Eb3VibGU7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJJbnQzMlwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gYnNvbl8xLkludDMyOyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiTG9uZ1wiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gYnNvbl8xLkxvbmc7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJNYXhLZXlcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGJzb25fMS5NYXhLZXk7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJNaW5LZXlcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGJzb25fMS5NaW5LZXk7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJPYmplY3RJZFwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gYnNvbl8xLk9iamVjdElkOyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwic2VyaWFsaXplXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBic29uXzEuc2VyaWFsaXplOyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiVGltZXN0YW1wXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBic29uXzEuVGltZXN0YW1wOyB9IH0pO1xuZnVuY3Rpb24gcGx1Y2tCU09OU2VyaWFsaXplT3B0aW9ucyhvcHRpb25zKSB7XG4gICAgY29uc3QgeyBmaWVsZHNBc1JhdywgdXNlQmlnSW50NjQsIHByb21vdGVWYWx1ZXMsIHByb21vdGVCdWZmZXJzLCBwcm9tb3RlTG9uZ3MsIHNlcmlhbGl6ZUZ1bmN0aW9ucywgaWdub3JlVW5kZWZpbmVkLCBic29uUmVnRXhwLCByYXcsIGVuYWJsZVV0ZjhWYWxpZGF0aW9uIH0gPSBvcHRpb25zO1xuICAgIHJldHVybiB7XG4gICAgICAgIGZpZWxkc0FzUmF3LFxuICAgICAgICB1c2VCaWdJbnQ2NCxcbiAgICAgICAgcHJvbW90ZVZhbHVlcyxcbiAgICAgICAgcHJvbW90ZUJ1ZmZlcnMsXG4gICAgICAgIHByb21vdGVMb25ncyxcbiAgICAgICAgc2VyaWFsaXplRnVuY3Rpb25zLFxuICAgICAgICBpZ25vcmVVbmRlZmluZWQsXG4gICAgICAgIGJzb25SZWdFeHAsXG4gICAgICAgIHJhdyxcbiAgICAgICAgZW5hYmxlVXRmOFZhbGlkYXRpb25cbiAgICB9O1xufVxuZXhwb3J0cy5wbHVja0JTT05TZXJpYWxpemVPcHRpb25zID0gcGx1Y2tCU09OU2VyaWFsaXplT3B0aW9ucztcbi8qKlxuICogTWVyZ2UgdGhlIGdpdmVuIEJTT05TZXJpYWxpemVPcHRpb25zLCBwcmVmZXJyaW5nIG9wdGlvbnMgb3ZlciB0aGUgcGFyZW50J3Mgb3B0aW9ucywgYW5kXG4gKiBzdWJzdGl0dXRpbmcgZGVmYXVsdHMgZm9yIHZhbHVlcyBub3Qgc2V0LlxuICpcbiAqIEBpbnRlcm5hbFxuICovXG5mdW5jdGlvbiByZXNvbHZlQlNPTk9wdGlvbnMob3B0aW9ucywgcGFyZW50KSB7XG4gICAgY29uc3QgcGFyZW50T3B0aW9ucyA9IHBhcmVudD8uYnNvbk9wdGlvbnM7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgcmF3OiBvcHRpb25zPy5yYXcgPz8gcGFyZW50T3B0aW9ucz8ucmF3ID8/IGZhbHNlLFxuICAgICAgICB1c2VCaWdJbnQ2NDogb3B0aW9ucz8udXNlQmlnSW50NjQgPz8gcGFyZW50T3B0aW9ucz8udXNlQmlnSW50NjQgPz8gZmFsc2UsXG4gICAgICAgIHByb21vdGVMb25nczogb3B0aW9ucz8ucHJvbW90ZUxvbmdzID8/IHBhcmVudE9wdGlvbnM/LnByb21vdGVMb25ncyA/PyB0cnVlLFxuICAgICAgICBwcm9tb3RlVmFsdWVzOiBvcHRpb25zPy5wcm9tb3RlVmFsdWVzID8/IHBhcmVudE9wdGlvbnM/LnByb21vdGVWYWx1ZXMgPz8gdHJ1ZSxcbiAgICAgICAgcHJvbW90ZUJ1ZmZlcnM6IG9wdGlvbnM/LnByb21vdGVCdWZmZXJzID8/IHBhcmVudE9wdGlvbnM/LnByb21vdGVCdWZmZXJzID8/IGZhbHNlLFxuICAgICAgICBpZ25vcmVVbmRlZmluZWQ6IG9wdGlvbnM/Lmlnbm9yZVVuZGVmaW5lZCA/PyBwYXJlbnRPcHRpb25zPy5pZ25vcmVVbmRlZmluZWQgPz8gZmFsc2UsXG4gICAgICAgIGJzb25SZWdFeHA6IG9wdGlvbnM/LmJzb25SZWdFeHAgPz8gcGFyZW50T3B0aW9ucz8uYnNvblJlZ0V4cCA/PyBmYWxzZSxcbiAgICAgICAgc2VyaWFsaXplRnVuY3Rpb25zOiBvcHRpb25zPy5zZXJpYWxpemVGdW5jdGlvbnMgPz8gcGFyZW50T3B0aW9ucz8uc2VyaWFsaXplRnVuY3Rpb25zID8/IGZhbHNlLFxuICAgICAgICBmaWVsZHNBc1Jhdzogb3B0aW9ucz8uZmllbGRzQXNSYXcgPz8gcGFyZW50T3B0aW9ucz8uZmllbGRzQXNSYXcgPz8ge30sXG4gICAgICAgIGVuYWJsZVV0ZjhWYWxpZGF0aW9uOiBvcHRpb25zPy5lbmFibGVVdGY4VmFsaWRhdGlvbiA/PyBwYXJlbnRPcHRpb25zPy5lbmFibGVVdGY4VmFsaWRhdGlvbiA/PyB0cnVlXG4gICAgfTtcbn1cbmV4cG9ydHMucmVzb2x2ZUJTT05PcHRpb25zID0gcmVzb2x2ZUJTT05PcHRpb25zO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YnNvbi5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/bson.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/bulk/common.js":
/*!*********************************************************!*\
  !*** ../server/node_modules/mongodb/lib/bulk/common.js ***!
  \*********************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.BulkOperationBase = exports.FindOperators = exports.MongoBulkWriteError = exports.mergeBatchResults = exports.WriteError = exports.WriteConcernError = exports.BulkWriteResult = exports.Batch = exports.BatchType = void 0;\nconst bson_1 = __webpack_require__(/*! ../bson */ \"(api)/../server/node_modules/mongodb/lib/bson.js\");\nconst error_1 = __webpack_require__(/*! ../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst delete_1 = __webpack_require__(/*! ../operations/delete */ \"(api)/../server/node_modules/mongodb/lib/operations/delete.js\");\nconst execute_operation_1 = __webpack_require__(/*! ../operations/execute_operation */ \"(api)/../server/node_modules/mongodb/lib/operations/execute_operation.js\");\nconst insert_1 = __webpack_require__(/*! ../operations/insert */ \"(api)/../server/node_modules/mongodb/lib/operations/insert.js\");\nconst operation_1 = __webpack_require__(/*! ../operations/operation */ \"(api)/../server/node_modules/mongodb/lib/operations/operation.js\");\nconst update_1 = __webpack_require__(/*! ../operations/update */ \"(api)/../server/node_modules/mongodb/lib/operations/update.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\nconst write_concern_1 = __webpack_require__(/*! ../write_concern */ \"(api)/../server/node_modules/mongodb/lib/write_concern.js\");\n/** @internal */\nconst kServerError = Symbol('serverError');\n/** @public */\nexports.BatchType = Object.freeze({\n    INSERT: 1,\n    UPDATE: 2,\n    DELETE: 3\n});\n/**\n * Keeps the state of a unordered batch so we can rewrite the results\n * correctly after command execution\n *\n * @public\n */\nclass Batch {\n    constructor(batchType, originalZeroIndex) {\n        this.originalZeroIndex = originalZeroIndex;\n        this.currentIndex = 0;\n        this.originalIndexes = [];\n        this.batchType = batchType;\n        this.operations = [];\n        this.size = 0;\n        this.sizeBytes = 0;\n    }\n}\nexports.Batch = Batch;\n/**\n * @public\n * The result of a bulk write.\n */\nclass BulkWriteResult {\n    static generateIdMap(ids) {\n        const idMap = {};\n        for (const doc of ids) {\n            idMap[doc.index] = doc._id;\n        }\n        return idMap;\n    }\n    /**\n     * Create a new BulkWriteResult instance\n     * @internal\n     */\n    constructor(bulkResult, isOrdered) {\n        this.result = bulkResult;\n        this.insertedCount = this.result.nInserted ?? 0;\n        this.matchedCount = this.result.nMatched ?? 0;\n        this.modifiedCount = this.result.nModified ?? 0;\n        this.deletedCount = this.result.nRemoved ?? 0;\n        this.upsertedCount = this.result.upserted.length ?? 0;\n        this.upsertedIds = BulkWriteResult.generateIdMap(this.result.upserted);\n        this.insertedIds = BulkWriteResult.generateIdMap(this.getSuccessfullyInsertedIds(bulkResult, isOrdered));\n        Object.defineProperty(this, 'result', { value: this.result, enumerable: false });\n    }\n    /**\n     * Returns document_ids that were actually inserted\n     * @internal\n     */\n    getSuccessfullyInsertedIds(bulkResult, isOrdered) {\n        if (bulkResult.writeErrors.length === 0)\n            return bulkResult.insertedIds;\n        if (isOrdered) {\n            return bulkResult.insertedIds.slice(0, bulkResult.writeErrors[0].index);\n        }\n        return bulkResult.insertedIds.filter(({ index }) => !bulkResult.writeErrors.some(writeError => index === writeError.index));\n    }\n    /** Evaluates to true if the bulk operation correctly executes */\n    get ok() {\n        return this.result.ok;\n    }\n    /**\n     * The number of inserted documents\n     * @deprecated Use insertedCount instead.\n     */\n    get nInserted() {\n        return this.result.nInserted;\n    }\n    /**\n     * Number of upserted documents\n     * @deprecated User upsertedCount instead.\n     */\n    get nUpserted() {\n        return this.result.nUpserted;\n    }\n    /**\n     * Number of matched documents\n     * @deprecated Use matchedCount instead.\n     */\n    get nMatched() {\n        return this.result.nMatched;\n    }\n    /**\n     * Number of documents updated physically on disk\n     * @deprecated Use modifiedCount instead.\n     */\n    get nModified() {\n        return this.result.nModified;\n    }\n    /**\n     * Number of removed documents\n     * @deprecated Use deletedCount instead.\n     */\n    get nRemoved() {\n        return this.result.nRemoved;\n    }\n    /**\n     * Returns an array of all inserted ids\n     * @deprecated Use insertedIds instead.\n     */\n    getInsertedIds() {\n        return this.result.insertedIds;\n    }\n    /**\n     * Returns an array of all upserted ids\n     * @deprecated Use upsertedIds instead.\n     */\n    getUpsertedIds() {\n        return this.result.upserted;\n    }\n    /** Returns the upserted id at the given index */\n    getUpsertedIdAt(index) {\n        return this.result.upserted[index];\n    }\n    /** Returns raw internal result */\n    getRawResponse() {\n        return this.result;\n    }\n    /** Returns true if the bulk operation contains a write error */\n    hasWriteErrors() {\n        return this.result.writeErrors.length > 0;\n    }\n    /** Returns the number of write errors off the bulk operation */\n    getWriteErrorCount() {\n        return this.result.writeErrors.length;\n    }\n    /** Returns a specific write error object */\n    getWriteErrorAt(index) {\n        return index < this.result.writeErrors.length ? this.result.writeErrors[index] : undefined;\n    }\n    /** Retrieve all write errors */\n    getWriteErrors() {\n        return this.result.writeErrors;\n    }\n    /** Retrieve the write concern error if one exists */\n    getWriteConcernError() {\n        if (this.result.writeConcernErrors.length === 0) {\n            return;\n        }\n        else if (this.result.writeConcernErrors.length === 1) {\n            // Return the error\n            return this.result.writeConcernErrors[0];\n        }\n        else {\n            // Combine the errors\n            let errmsg = '';\n            for (let i = 0; i < this.result.writeConcernErrors.length; i++) {\n                const err = this.result.writeConcernErrors[i];\n                errmsg = errmsg + err.errmsg;\n                // TODO: Something better\n                if (i === 0)\n                    errmsg = errmsg + ' and ';\n            }\n            return new WriteConcernError({ errmsg, code: error_1.MONGODB_ERROR_CODES.WriteConcernFailed });\n        }\n    }\n    toString() {\n        return `BulkWriteResult(${this.result})`;\n    }\n    isOk() {\n        return this.result.ok === 1;\n    }\n}\nexports.BulkWriteResult = BulkWriteResult;\n/**\n * An error representing a failure by the server to apply the requested write concern to the bulk operation.\n * @public\n * @category Error\n */\nclass WriteConcernError {\n    constructor(error) {\n        this[kServerError] = error;\n    }\n    /** Write concern error code. */\n    get code() {\n        return this[kServerError].code;\n    }\n    /** Write concern error message. */\n    get errmsg() {\n        return this[kServerError].errmsg;\n    }\n    /** Write concern error info. */\n    get errInfo() {\n        return this[kServerError].errInfo;\n    }\n    toJSON() {\n        return this[kServerError];\n    }\n    toString() {\n        return `WriteConcernError(${this.errmsg})`;\n    }\n}\nexports.WriteConcernError = WriteConcernError;\n/**\n * An error that occurred during a BulkWrite on the server.\n * @public\n * @category Error\n */\nclass WriteError {\n    constructor(err) {\n        this.err = err;\n    }\n    /** WriteError code. */\n    get code() {\n        return this.err.code;\n    }\n    /** WriteError original bulk operation index. */\n    get index() {\n        return this.err.index;\n    }\n    /** WriteError message. */\n    get errmsg() {\n        return this.err.errmsg;\n    }\n    /** WriteError details. */\n    get errInfo() {\n        return this.err.errInfo;\n    }\n    /** Returns the underlying operation that caused the error */\n    getOperation() {\n        return this.err.op;\n    }\n    toJSON() {\n        return { code: this.err.code, index: this.err.index, errmsg: this.err.errmsg, op: this.err.op };\n    }\n    toString() {\n        return `WriteError(${JSON.stringify(this.toJSON())})`;\n    }\n}\nexports.WriteError = WriteError;\n/** Merges results into shared data structure */\nfunction mergeBatchResults(batch, bulkResult, err, result) {\n    // If we have an error set the result to be the err object\n    if (err) {\n        result = err;\n    }\n    else if (result && result.result) {\n        result = result.result;\n    }\n    if (result == null) {\n        return;\n    }\n    // Do we have a top level error stop processing and return\n    if (result.ok === 0 && bulkResult.ok === 1) {\n        bulkResult.ok = 0;\n        const writeError = {\n            index: 0,\n            code: result.code || 0,\n            errmsg: result.message,\n            errInfo: result.errInfo,\n            op: batch.operations[0]\n        };\n        bulkResult.writeErrors.push(new WriteError(writeError));\n        return;\n    }\n    else if (result.ok === 0 && bulkResult.ok === 0) {\n        return;\n    }\n    // If we have an insert Batch type\n    if (isInsertBatch(batch) && result.n) {\n        bulkResult.nInserted = bulkResult.nInserted + result.n;\n    }\n    // If we have an insert Batch type\n    if (isDeleteBatch(batch) && result.n) {\n        bulkResult.nRemoved = bulkResult.nRemoved + result.n;\n    }\n    let nUpserted = 0;\n    // We have an array of upserted values, we need to rewrite the indexes\n    if (Array.isArray(result.upserted)) {\n        nUpserted = result.upserted.length;\n        for (let i = 0; i < result.upserted.length; i++) {\n            bulkResult.upserted.push({\n                index: result.upserted[i].index + batch.originalZeroIndex,\n                _id: result.upserted[i]._id\n            });\n        }\n    }\n    else if (result.upserted) {\n        nUpserted = 1;\n        bulkResult.upserted.push({\n            index: batch.originalZeroIndex,\n            _id: result.upserted\n        });\n    }\n    // If we have an update Batch type\n    if (isUpdateBatch(batch) && result.n) {\n        const nModified = result.nModified;\n        bulkResult.nUpserted = bulkResult.nUpserted + nUpserted;\n        bulkResult.nMatched = bulkResult.nMatched + (result.n - nUpserted);\n        if (typeof nModified === 'number') {\n            bulkResult.nModified = bulkResult.nModified + nModified;\n        }\n        else {\n            bulkResult.nModified = 0;\n        }\n    }\n    if (Array.isArray(result.writeErrors)) {\n        for (let i = 0; i < result.writeErrors.length; i++) {\n            const writeError = {\n                index: batch.originalIndexes[result.writeErrors[i].index],\n                code: result.writeErrors[i].code,\n                errmsg: result.writeErrors[i].errmsg,\n                errInfo: result.writeErrors[i].errInfo,\n                op: batch.operations[result.writeErrors[i].index]\n            };\n            bulkResult.writeErrors.push(new WriteError(writeError));\n        }\n    }\n    if (result.writeConcernError) {\n        bulkResult.writeConcernErrors.push(new WriteConcernError(result.writeConcernError));\n    }\n}\nexports.mergeBatchResults = mergeBatchResults;\nfunction executeCommands(bulkOperation, options, callback) {\n    if (bulkOperation.s.batches.length === 0) {\n        return callback(undefined, new BulkWriteResult(bulkOperation.s.bulkResult, bulkOperation.isOrdered));\n    }\n    const batch = bulkOperation.s.batches.shift();\n    function resultHandler(err, result) {\n        // Error is a driver related error not a bulk op error, return early\n        if (err && 'message' in err && !(err instanceof error_1.MongoWriteConcernError)) {\n            return callback(new MongoBulkWriteError(err, new BulkWriteResult(bulkOperation.s.bulkResult, bulkOperation.isOrdered)));\n        }\n        if (err instanceof error_1.MongoWriteConcernError) {\n            return handleMongoWriteConcernError(batch, bulkOperation.s.bulkResult, bulkOperation.isOrdered, err, callback);\n        }\n        // Merge the results together\n        mergeBatchResults(batch, bulkOperation.s.bulkResult, err, result);\n        const writeResult = new BulkWriteResult(bulkOperation.s.bulkResult, bulkOperation.isOrdered);\n        if (bulkOperation.handleWriteError(callback, writeResult))\n            return;\n        // Execute the next command in line\n        executeCommands(bulkOperation, options, callback);\n    }\n    const finalOptions = (0, utils_1.resolveOptions)(bulkOperation, {\n        ...options,\n        ordered: bulkOperation.isOrdered\n    });\n    if (finalOptions.bypassDocumentValidation !== true) {\n        delete finalOptions.bypassDocumentValidation;\n    }\n    // Set an operationIf if provided\n    if (bulkOperation.operationId) {\n        resultHandler.operationId = bulkOperation.operationId;\n    }\n    // Is the bypassDocumentValidation options specific\n    if (bulkOperation.s.bypassDocumentValidation === true) {\n        finalOptions.bypassDocumentValidation = true;\n    }\n    // Is the checkKeys option disabled\n    if (bulkOperation.s.checkKeys === false) {\n        finalOptions.checkKeys = false;\n    }\n    if (finalOptions.retryWrites) {\n        if (isUpdateBatch(batch)) {\n            finalOptions.retryWrites = finalOptions.retryWrites && !batch.operations.some(op => op.multi);\n        }\n        if (isDeleteBatch(batch)) {\n            finalOptions.retryWrites =\n                finalOptions.retryWrites && !batch.operations.some(op => op.limit === 0);\n        }\n    }\n    try {\n        if (isInsertBatch(batch)) {\n            (0, execute_operation_1.executeOperation)(bulkOperation.s.collection.client, new insert_1.InsertOperation(bulkOperation.s.namespace, batch.operations, finalOptions), resultHandler);\n        }\n        else if (isUpdateBatch(batch)) {\n            (0, execute_operation_1.executeOperation)(bulkOperation.s.collection.client, new update_1.UpdateOperation(bulkOperation.s.namespace, batch.operations, finalOptions), resultHandler);\n        }\n        else if (isDeleteBatch(batch)) {\n            (0, execute_operation_1.executeOperation)(bulkOperation.s.collection.client, new delete_1.DeleteOperation(bulkOperation.s.namespace, batch.operations, finalOptions), resultHandler);\n        }\n    }\n    catch (err) {\n        // Force top level error\n        err.ok = 0;\n        // Merge top level error and return\n        mergeBatchResults(batch, bulkOperation.s.bulkResult, err, undefined);\n        callback();\n    }\n}\nfunction handleMongoWriteConcernError(batch, bulkResult, isOrdered, err, callback) {\n    mergeBatchResults(batch, bulkResult, undefined, err.result);\n    callback(new MongoBulkWriteError({\n        message: err.result?.writeConcernError.errmsg,\n        code: err.result?.writeConcernError.result\n    }, new BulkWriteResult(bulkResult, isOrdered)));\n}\n/**\n * An error indicating an unsuccessful Bulk Write\n * @public\n * @category Error\n */\nclass MongoBulkWriteError extends error_1.MongoServerError {\n    /** Creates a new MongoBulkWriteError */\n    constructor(error, result) {\n        super(error);\n        this.writeErrors = [];\n        if (error instanceof WriteConcernError)\n            this.err = error;\n        else if (!(error instanceof Error)) {\n            this.message = error.message;\n            this.code = error.code;\n            this.writeErrors = error.writeErrors ?? [];\n        }\n        this.result = result;\n        Object.assign(this, error);\n    }\n    get name() {\n        return 'MongoBulkWriteError';\n    }\n    /** Number of documents inserted. */\n    get insertedCount() {\n        return this.result.insertedCount;\n    }\n    /** Number of documents matched for update. */\n    get matchedCount() {\n        return this.result.matchedCount;\n    }\n    /** Number of documents modified. */\n    get modifiedCount() {\n        return this.result.modifiedCount;\n    }\n    /** Number of documents deleted. */\n    get deletedCount() {\n        return this.result.deletedCount;\n    }\n    /** Number of documents upserted. */\n    get upsertedCount() {\n        return this.result.upsertedCount;\n    }\n    /** Inserted document generated Id's, hash key is the index of the originating operation */\n    get insertedIds() {\n        return this.result.insertedIds;\n    }\n    /** Upserted document generated Id's, hash key is the index of the originating operation */\n    get upsertedIds() {\n        return this.result.upsertedIds;\n    }\n}\nexports.MongoBulkWriteError = MongoBulkWriteError;\n/**\n * A builder object that is returned from {@link BulkOperationBase#find}.\n * Is used to build a write operation that involves a query filter.\n *\n * @public\n */\nclass FindOperators {\n    /**\n     * Creates a new FindOperators object.\n     * @internal\n     */\n    constructor(bulkOperation) {\n        this.bulkOperation = bulkOperation;\n    }\n    /** Add a multiple update operation to the bulk operation */\n    update(updateDocument) {\n        const currentOp = buildCurrentOp(this.bulkOperation);\n        return this.bulkOperation.addToOperationsList(exports.BatchType.UPDATE, (0, update_1.makeUpdateStatement)(currentOp.selector, updateDocument, {\n            ...currentOp,\n            multi: true\n        }));\n    }\n    /** Add a single update operation to the bulk operation */\n    updateOne(updateDocument) {\n        if (!(0, utils_1.hasAtomicOperators)(updateDocument)) {\n            throw new error_1.MongoInvalidArgumentError('Update document requires atomic operators');\n        }\n        const currentOp = buildCurrentOp(this.bulkOperation);\n        return this.bulkOperation.addToOperationsList(exports.BatchType.UPDATE, (0, update_1.makeUpdateStatement)(currentOp.selector, updateDocument, { ...currentOp, multi: false }));\n    }\n    /** Add a replace one operation to the bulk operation */\n    replaceOne(replacement) {\n        if ((0, utils_1.hasAtomicOperators)(replacement)) {\n            throw new error_1.MongoInvalidArgumentError('Replacement document must not use atomic operators');\n        }\n        const currentOp = buildCurrentOp(this.bulkOperation);\n        return this.bulkOperation.addToOperationsList(exports.BatchType.UPDATE, (0, update_1.makeUpdateStatement)(currentOp.selector, replacement, { ...currentOp, multi: false }));\n    }\n    /** Add a delete one operation to the bulk operation */\n    deleteOne() {\n        const currentOp = buildCurrentOp(this.bulkOperation);\n        return this.bulkOperation.addToOperationsList(exports.BatchType.DELETE, (0, delete_1.makeDeleteStatement)(currentOp.selector, { ...currentOp, limit: 1 }));\n    }\n    /** Add a delete many operation to the bulk operation */\n    delete() {\n        const currentOp = buildCurrentOp(this.bulkOperation);\n        return this.bulkOperation.addToOperationsList(exports.BatchType.DELETE, (0, delete_1.makeDeleteStatement)(currentOp.selector, { ...currentOp, limit: 0 }));\n    }\n    /** Upsert modifier for update bulk operation, noting that this operation is an upsert. */\n    upsert() {\n        if (!this.bulkOperation.s.currentOp) {\n            this.bulkOperation.s.currentOp = {};\n        }\n        this.bulkOperation.s.currentOp.upsert = true;\n        return this;\n    }\n    /** Specifies the collation for the query condition. */\n    collation(collation) {\n        if (!this.bulkOperation.s.currentOp) {\n            this.bulkOperation.s.currentOp = {};\n        }\n        this.bulkOperation.s.currentOp.collation = collation;\n        return this;\n    }\n    /** Specifies arrayFilters for UpdateOne or UpdateMany bulk operations. */\n    arrayFilters(arrayFilters) {\n        if (!this.bulkOperation.s.currentOp) {\n            this.bulkOperation.s.currentOp = {};\n        }\n        this.bulkOperation.s.currentOp.arrayFilters = arrayFilters;\n        return this;\n    }\n    /** Specifies hint for the bulk operation. */\n    hint(hint) {\n        if (!this.bulkOperation.s.currentOp) {\n            this.bulkOperation.s.currentOp = {};\n        }\n        this.bulkOperation.s.currentOp.hint = hint;\n        return this;\n    }\n}\nexports.FindOperators = FindOperators;\n/**\n * TODO(NODE-4063)\n * BulkWrites merge complexity is implemented in executeCommands\n * This provides a vehicle to treat bulkOperations like any other operation (hence \"shim\")\n * We would like this logic to simply live inside the BulkWriteOperation class\n * @internal\n */\nclass BulkWriteShimOperation extends operation_1.AbstractCallbackOperation {\n    constructor(bulkOperation, options) {\n        super(options);\n        this.bulkOperation = bulkOperation;\n    }\n    executeCallback(server, session, callback) {\n        if (this.options.session == null) {\n            // An implicit session could have been created by 'executeOperation'\n            // So if we stick it on finalOptions here, each bulk operation\n            // will use this same session, it'll be passed in the same way\n            // an explicit session would be\n            this.options.session = session;\n        }\n        return executeCommands(this.bulkOperation, this.options, callback);\n    }\n}\n/** @public */\nclass BulkOperationBase {\n    /**\n     * Create a new OrderedBulkOperation or UnorderedBulkOperation instance\n     * @internal\n     */\n    constructor(collection, options, isOrdered) {\n        // determine whether bulkOperation is ordered or unordered\n        this.isOrdered = isOrdered;\n        const topology = (0, utils_1.getTopology)(collection);\n        options = options == null ? {} : options;\n        // TODO Bring from driver information in hello\n        // Get the namespace for the write operations\n        const namespace = collection.s.namespace;\n        // Used to mark operation as executed\n        const executed = false;\n        // Current item\n        const currentOp = undefined;\n        // Set max byte size\n        const hello = topology.lastHello();\n        // If we have autoEncryption on, batch-splitting must be done on 2mb chunks, but single documents\n        // over 2mb are still allowed\n        const usingAutoEncryption = !!(topology.s.options && topology.s.options.autoEncrypter);\n        const maxBsonObjectSize = hello && hello.maxBsonObjectSize ? hello.maxBsonObjectSize : 1024 * 1024 * 16;\n        const maxBatchSizeBytes = usingAutoEncryption ? 1024 * 1024 * 2 : maxBsonObjectSize;\n        const maxWriteBatchSize = hello && hello.maxWriteBatchSize ? hello.maxWriteBatchSize : 1000;\n        // Calculates the largest possible size of an Array key, represented as a BSON string\n        // element. This calculation:\n        //     1 byte for BSON type\n        //     # of bytes = length of (string representation of (maxWriteBatchSize - 1))\n        //   + 1 bytes for null terminator\n        const maxKeySize = (maxWriteBatchSize - 1).toString(10).length + 2;\n        // Final options for retryable writes\n        let finalOptions = Object.assign({}, options);\n        finalOptions = (0, utils_1.applyRetryableWrites)(finalOptions, collection.s.db);\n        // Final results\n        const bulkResult = {\n            ok: 1,\n            writeErrors: [],\n            writeConcernErrors: [],\n            insertedIds: [],\n            nInserted: 0,\n            nUpserted: 0,\n            nMatched: 0,\n            nModified: 0,\n            nRemoved: 0,\n            upserted: []\n        };\n        // Internal state\n        this.s = {\n            // Final result\n            bulkResult,\n            // Current batch state\n            currentBatch: undefined,\n            currentIndex: 0,\n            // ordered specific\n            currentBatchSize: 0,\n            currentBatchSizeBytes: 0,\n            // unordered specific\n            currentInsertBatch: undefined,\n            currentUpdateBatch: undefined,\n            currentRemoveBatch: undefined,\n            batches: [],\n            // Write concern\n            writeConcern: write_concern_1.WriteConcern.fromOptions(options),\n            // Max batch size options\n            maxBsonObjectSize,\n            maxBatchSizeBytes,\n            maxWriteBatchSize,\n            maxKeySize,\n            // Namespace\n            namespace,\n            // Topology\n            topology,\n            // Options\n            options: finalOptions,\n            // BSON options\n            bsonOptions: (0, bson_1.resolveBSONOptions)(options),\n            // Current operation\n            currentOp,\n            // Executed\n            executed,\n            // Collection\n            collection,\n            // Fundamental error\n            err: undefined,\n            // check keys\n            checkKeys: typeof options.checkKeys === 'boolean' ? options.checkKeys : false\n        };\n        // bypass Validation\n        if (options.bypassDocumentValidation === true) {\n            this.s.bypassDocumentValidation = true;\n        }\n    }\n    /**\n     * Add a single insert document to the bulk operation\n     *\n     * @example\n     * ```ts\n     * const bulkOp = collection.initializeOrderedBulkOp();\n     *\n     * // Adds three inserts to the bulkOp.\n     * bulkOp\n     *   .insert({ a: 1 })\n     *   .insert({ b: 2 })\n     *   .insert({ c: 3 });\n     * await bulkOp.execute();\n     * ```\n     */\n    insert(document) {\n        if (document._id == null && !shouldForceServerObjectId(this)) {\n            document._id = new bson_1.ObjectId();\n        }\n        return this.addToOperationsList(exports.BatchType.INSERT, document);\n    }\n    /**\n     * Builds a find operation for an update/updateOne/delete/deleteOne/replaceOne.\n     * Returns a builder object used to complete the definition of the operation.\n     *\n     * @example\n     * ```ts\n     * const bulkOp = collection.initializeOrderedBulkOp();\n     *\n     * // Add an updateOne to the bulkOp\n     * bulkOp.find({ a: 1 }).updateOne({ $set: { b: 2 } });\n     *\n     * // Add an updateMany to the bulkOp\n     * bulkOp.find({ c: 3 }).update({ $set: { d: 4 } });\n     *\n     * // Add an upsert\n     * bulkOp.find({ e: 5 }).upsert().updateOne({ $set: { f: 6 } });\n     *\n     * // Add a deletion\n     * bulkOp.find({ g: 7 }).deleteOne();\n     *\n     * // Add a multi deletion\n     * bulkOp.find({ h: 8 }).delete();\n     *\n     * // Add a replaceOne\n     * bulkOp.find({ i: 9 }).replaceOne({writeConcern: { j: 10 }});\n     *\n     * // Update using a pipeline (requires Mongodb 4.2 or higher)\n     * bulk.find({ k: 11, y: { $exists: true }, z: { $exists: true } }).updateOne([\n     *   { $set: { total: { $sum: [ '$y', '$z' ] } } }\n     * ]);\n     *\n     * // All of the ops will now be executed\n     * await bulkOp.execute();\n     * ```\n     */\n    find(selector) {\n        if (!selector) {\n            throw new error_1.MongoInvalidArgumentError('Bulk find operation must specify a selector');\n        }\n        // Save a current selector\n        this.s.currentOp = {\n            selector: selector\n        };\n        return new FindOperators(this);\n    }\n    /** Specifies a raw operation to perform in the bulk write. */\n    raw(op) {\n        if (op == null || typeof op !== 'object') {\n            throw new error_1.MongoInvalidArgumentError('Operation must be an object with an operation key');\n        }\n        if ('insertOne' in op) {\n            const forceServerObjectId = shouldForceServerObjectId(this);\n            if (op.insertOne && op.insertOne.document == null) {\n                // NOTE: provided for legacy support, but this is a malformed operation\n                if (forceServerObjectId !== true && op.insertOne._id == null) {\n                    op.insertOne._id = new bson_1.ObjectId();\n                }\n                return this.addToOperationsList(exports.BatchType.INSERT, op.insertOne);\n            }\n            if (forceServerObjectId !== true && op.insertOne.document._id == null) {\n                op.insertOne.document._id = new bson_1.ObjectId();\n            }\n            return this.addToOperationsList(exports.BatchType.INSERT, op.insertOne.document);\n        }\n        if ('replaceOne' in op || 'updateOne' in op || 'updateMany' in op) {\n            if ('replaceOne' in op) {\n                if ('q' in op.replaceOne) {\n                    throw new error_1.MongoInvalidArgumentError('Raw operations are not allowed');\n                }\n                const updateStatement = (0, update_1.makeUpdateStatement)(op.replaceOne.filter, op.replaceOne.replacement, { ...op.replaceOne, multi: false });\n                if ((0, utils_1.hasAtomicOperators)(updateStatement.u)) {\n                    throw new error_1.MongoInvalidArgumentError('Replacement document must not use atomic operators');\n                }\n                return this.addToOperationsList(exports.BatchType.UPDATE, updateStatement);\n            }\n            if ('updateOne' in op) {\n                if ('q' in op.updateOne) {\n                    throw new error_1.MongoInvalidArgumentError('Raw operations are not allowed');\n                }\n                const updateStatement = (0, update_1.makeUpdateStatement)(op.updateOne.filter, op.updateOne.update, {\n                    ...op.updateOne,\n                    multi: false\n                });\n                if (!(0, utils_1.hasAtomicOperators)(updateStatement.u)) {\n                    throw new error_1.MongoInvalidArgumentError('Update document requires atomic operators');\n                }\n                return this.addToOperationsList(exports.BatchType.UPDATE, updateStatement);\n            }\n            if ('updateMany' in op) {\n                if ('q' in op.updateMany) {\n                    throw new error_1.MongoInvalidArgumentError('Raw operations are not allowed');\n                }\n                const updateStatement = (0, update_1.makeUpdateStatement)(op.updateMany.filter, op.updateMany.update, {\n                    ...op.updateMany,\n                    multi: true\n                });\n                if (!(0, utils_1.hasAtomicOperators)(updateStatement.u)) {\n                    throw new error_1.MongoInvalidArgumentError('Update document requires atomic operators');\n                }\n                return this.addToOperationsList(exports.BatchType.UPDATE, updateStatement);\n            }\n        }\n        if ('deleteOne' in op) {\n            if ('q' in op.deleteOne) {\n                throw new error_1.MongoInvalidArgumentError('Raw operations are not allowed');\n            }\n            return this.addToOperationsList(exports.BatchType.DELETE, (0, delete_1.makeDeleteStatement)(op.deleteOne.filter, { ...op.deleteOne, limit: 1 }));\n        }\n        if ('deleteMany' in op) {\n            if ('q' in op.deleteMany) {\n                throw new error_1.MongoInvalidArgumentError('Raw operations are not allowed');\n            }\n            return this.addToOperationsList(exports.BatchType.DELETE, (0, delete_1.makeDeleteStatement)(op.deleteMany.filter, { ...op.deleteMany, limit: 0 }));\n        }\n        // otherwise an unknown operation was provided\n        throw new error_1.MongoInvalidArgumentError('bulkWrite only supports insertOne, updateOne, updateMany, deleteOne, deleteMany');\n    }\n    get bsonOptions() {\n        return this.s.bsonOptions;\n    }\n    get writeConcern() {\n        return this.s.writeConcern;\n    }\n    get batches() {\n        const batches = [...this.s.batches];\n        if (this.isOrdered) {\n            if (this.s.currentBatch)\n                batches.push(this.s.currentBatch);\n        }\n        else {\n            if (this.s.currentInsertBatch)\n                batches.push(this.s.currentInsertBatch);\n            if (this.s.currentUpdateBatch)\n                batches.push(this.s.currentUpdateBatch);\n            if (this.s.currentRemoveBatch)\n                batches.push(this.s.currentRemoveBatch);\n        }\n        return batches;\n    }\n    async execute(options = {}) {\n        if (this.s.executed) {\n            throw new error_1.MongoBatchReExecutionError();\n        }\n        const writeConcern = write_concern_1.WriteConcern.fromOptions(options);\n        if (writeConcern) {\n            this.s.writeConcern = writeConcern;\n        }\n        // If we have current batch\n        if (this.isOrdered) {\n            if (this.s.currentBatch)\n                this.s.batches.push(this.s.currentBatch);\n        }\n        else {\n            if (this.s.currentInsertBatch)\n                this.s.batches.push(this.s.currentInsertBatch);\n            if (this.s.currentUpdateBatch)\n                this.s.batches.push(this.s.currentUpdateBatch);\n            if (this.s.currentRemoveBatch)\n                this.s.batches.push(this.s.currentRemoveBatch);\n        }\n        // If we have no operations in the bulk raise an error\n        if (this.s.batches.length === 0) {\n            throw new error_1.MongoInvalidArgumentError('Invalid BulkOperation, Batch cannot be empty');\n        }\n        this.s.executed = true;\n        const finalOptions = { ...this.s.options, ...options };\n        const operation = new BulkWriteShimOperation(this, finalOptions);\n        return (0, execute_operation_1.executeOperation)(this.s.collection.client, operation);\n    }\n    /**\n     * Handles the write error before executing commands\n     * @internal\n     */\n    handleWriteError(callback, writeResult) {\n        if (this.s.bulkResult.writeErrors.length > 0) {\n            const msg = this.s.bulkResult.writeErrors[0].errmsg\n                ? this.s.bulkResult.writeErrors[0].errmsg\n                : 'write operation failed';\n            callback(new MongoBulkWriteError({\n                message: msg,\n                code: this.s.bulkResult.writeErrors[0].code,\n                writeErrors: this.s.bulkResult.writeErrors\n            }, writeResult));\n            return true;\n        }\n        const writeConcernError = writeResult.getWriteConcernError();\n        if (writeConcernError) {\n            callback(new MongoBulkWriteError(writeConcernError, writeResult));\n            return true;\n        }\n        return false;\n    }\n}\nexports.BulkOperationBase = BulkOperationBase;\nObject.defineProperty(BulkOperationBase.prototype, 'length', {\n    enumerable: true,\n    get() {\n        return this.s.currentIndex;\n    }\n});\nfunction shouldForceServerObjectId(bulkOperation) {\n    if (typeof bulkOperation.s.options.forceServerObjectId === 'boolean') {\n        return bulkOperation.s.options.forceServerObjectId;\n    }\n    if (typeof bulkOperation.s.collection.s.db.options?.forceServerObjectId === 'boolean') {\n        return bulkOperation.s.collection.s.db.options?.forceServerObjectId;\n    }\n    return false;\n}\nfunction isInsertBatch(batch) {\n    return batch.batchType === exports.BatchType.INSERT;\n}\nfunction isUpdateBatch(batch) {\n    return batch.batchType === exports.BatchType.UPDATE;\n}\nfunction isDeleteBatch(batch) {\n    return batch.batchType === exports.BatchType.DELETE;\n}\nfunction buildCurrentOp(bulkOp) {\n    let { currentOp } = bulkOp.s;\n    bulkOp.s.currentOp = undefined;\n    if (!currentOp)\n        currentOp = {};\n    return currentOp;\n}\n//# sourceMappingURL=common.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9idWxrL2NvbW1vbi5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCx5QkFBeUIsR0FBRyxxQkFBcUIsR0FBRywyQkFBMkIsR0FBRyx5QkFBeUIsR0FBRyxrQkFBa0IsR0FBRyx5QkFBeUIsR0FBRyx1QkFBdUIsR0FBRyxhQUFhLEdBQUcsaUJBQWlCO0FBQzFOLGVBQWUsbUJBQU8sQ0FBQyxpRUFBUztBQUNoQyxnQkFBZ0IsbUJBQU8sQ0FBQyxtRUFBVTtBQUNsQyxpQkFBaUIsbUJBQU8sQ0FBQywyRkFBc0I7QUFDL0MsNEJBQTRCLG1CQUFPLENBQUMsaUhBQWlDO0FBQ3JFLGlCQUFpQixtQkFBTyxDQUFDLDJGQUFzQjtBQUMvQyxvQkFBb0IsbUJBQU8sQ0FBQyxpR0FBeUI7QUFDckQsaUJBQWlCLG1CQUFPLENBQUMsMkZBQXNCO0FBQy9DLGdCQUFnQixtQkFBTyxDQUFDLG1FQUFVO0FBQ2xDLHdCQUF3QixtQkFBTyxDQUFDLG1GQUFrQjtBQUNsRDtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnREFBZ0QsdUNBQXVDO0FBQ3ZGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnREFBZ0QsT0FBTztBQUN2RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsMkNBQTJDO0FBQ3ZFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJDQUEyQyw4REFBOEQ7QUFDekc7QUFDQTtBQUNBO0FBQ0Esa0NBQWtDLFlBQVk7QUFDOUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QjtBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9DQUFvQyxZQUFZO0FBQ2hEO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSw2QkFBNkIsOEJBQThCO0FBQzNEO0FBQ0E7QUFDQSxrQkFBa0I7QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsNEJBQTRCO0FBQ3BEO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLCtCQUErQjtBQUN2RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQjtBQUMzQjtBQUNBLDJDQUEyQyw2QkFBNkI7QUFDeEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0pBQXdKLDRCQUE0QjtBQUNwTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFKQUFxSiw0QkFBNEI7QUFDakw7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3SUFBd0ksd0JBQXdCO0FBQ2hLO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0lBQXdJLHdCQUF3QjtBQUNoSztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1Q0FBdUM7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQ0FBMkM7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CLE1BQU07QUFDekIsbUJBQW1CLE1BQU07QUFDekIsbUJBQW1CLE1BQU07QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCLE1BQU0sY0FBYyxRQUFRLFFBQVE7QUFDekQ7QUFDQTtBQUNBLHFCQUFxQixNQUFNLFdBQVcsUUFBUSxRQUFRO0FBQ3REO0FBQ0E7QUFDQSxxQkFBcUIsTUFBTSx1QkFBdUIsUUFBUSxRQUFRO0FBQ2xFO0FBQ0E7QUFDQSxxQkFBcUIsTUFBTTtBQUMzQjtBQUNBO0FBQ0EscUJBQXFCLE1BQU07QUFDM0I7QUFDQTtBQUNBLHFCQUFxQixNQUFNLGNBQWMsZ0JBQWdCLFFBQVE7QUFDakU7QUFDQTtBQUNBLG1CQUFtQixZQUFZLGVBQWUsT0FBTyxpQkFBaUI7QUFDdEUsV0FBVyxRQUFRLFNBQVM7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2SEFBNkgsZ0NBQWdDO0FBQzdKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrSEFBK0gsMkJBQTJCO0FBQzFKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnSUFBZ0ksNEJBQTRCO0FBQzVKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFBOEI7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0I7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVUsWUFBWTtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIkQ6XFxzYWxvbmlcXGFwcHJhaXNhbC1zeXN0ZW1cXHNlcnZlclxcbm9kZV9tb2R1bGVzXFxtb25nb2RiXFxsaWJcXGJ1bGtcXGNvbW1vbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuQnVsa09wZXJhdGlvbkJhc2UgPSBleHBvcnRzLkZpbmRPcGVyYXRvcnMgPSBleHBvcnRzLk1vbmdvQnVsa1dyaXRlRXJyb3IgPSBleHBvcnRzLm1lcmdlQmF0Y2hSZXN1bHRzID0gZXhwb3J0cy5Xcml0ZUVycm9yID0gZXhwb3J0cy5Xcml0ZUNvbmNlcm5FcnJvciA9IGV4cG9ydHMuQnVsa1dyaXRlUmVzdWx0ID0gZXhwb3J0cy5CYXRjaCA9IGV4cG9ydHMuQmF0Y2hUeXBlID0gdm9pZCAwO1xuY29uc3QgYnNvbl8xID0gcmVxdWlyZShcIi4uL2Jzb25cIik7XG5jb25zdCBlcnJvcl8xID0gcmVxdWlyZShcIi4uL2Vycm9yXCIpO1xuY29uc3QgZGVsZXRlXzEgPSByZXF1aXJlKFwiLi4vb3BlcmF0aW9ucy9kZWxldGVcIik7XG5jb25zdCBleGVjdXRlX29wZXJhdGlvbl8xID0gcmVxdWlyZShcIi4uL29wZXJhdGlvbnMvZXhlY3V0ZV9vcGVyYXRpb25cIik7XG5jb25zdCBpbnNlcnRfMSA9IHJlcXVpcmUoXCIuLi9vcGVyYXRpb25zL2luc2VydFwiKTtcbmNvbnN0IG9wZXJhdGlvbl8xID0gcmVxdWlyZShcIi4uL29wZXJhdGlvbnMvb3BlcmF0aW9uXCIpO1xuY29uc3QgdXBkYXRlXzEgPSByZXF1aXJlKFwiLi4vb3BlcmF0aW9ucy91cGRhdGVcIik7XG5jb25zdCB1dGlsc18xID0gcmVxdWlyZShcIi4uL3V0aWxzXCIpO1xuY29uc3Qgd3JpdGVfY29uY2Vybl8xID0gcmVxdWlyZShcIi4uL3dyaXRlX2NvbmNlcm5cIik7XG4vKiogQGludGVybmFsICovXG5jb25zdCBrU2VydmVyRXJyb3IgPSBTeW1ib2woJ3NlcnZlckVycm9yJyk7XG4vKiogQHB1YmxpYyAqL1xuZXhwb3J0cy5CYXRjaFR5cGUgPSBPYmplY3QuZnJlZXplKHtcbiAgICBJTlNFUlQ6IDEsXG4gICAgVVBEQVRFOiAyLFxuICAgIERFTEVURTogM1xufSk7XG4vKipcbiAqIEtlZXBzIHRoZSBzdGF0ZSBvZiBhIHVub3JkZXJlZCBiYXRjaCBzbyB3ZSBjYW4gcmV3cml0ZSB0aGUgcmVzdWx0c1xuICogY29ycmVjdGx5IGFmdGVyIGNvbW1hbmQgZXhlY3V0aW9uXG4gKlxuICogQHB1YmxpY1xuICovXG5jbGFzcyBCYXRjaCB7XG4gICAgY29uc3RydWN0b3IoYmF0Y2hUeXBlLCBvcmlnaW5hbFplcm9JbmRleCkge1xuICAgICAgICB0aGlzLm9yaWdpbmFsWmVyb0luZGV4ID0gb3JpZ2luYWxaZXJvSW5kZXg7XG4gICAgICAgIHRoaXMuY3VycmVudEluZGV4ID0gMDtcbiAgICAgICAgdGhpcy5vcmlnaW5hbEluZGV4ZXMgPSBbXTtcbiAgICAgICAgdGhpcy5iYXRjaFR5cGUgPSBiYXRjaFR5cGU7XG4gICAgICAgIHRoaXMub3BlcmF0aW9ucyA9IFtdO1xuICAgICAgICB0aGlzLnNpemUgPSAwO1xuICAgICAgICB0aGlzLnNpemVCeXRlcyA9IDA7XG4gICAgfVxufVxuZXhwb3J0cy5CYXRjaCA9IEJhdGNoO1xuLyoqXG4gKiBAcHVibGljXG4gKiBUaGUgcmVzdWx0IG9mIGEgYnVsayB3cml0ZS5cbiAqL1xuY2xhc3MgQnVsa1dyaXRlUmVzdWx0IHtcbiAgICBzdGF0aWMgZ2VuZXJhdGVJZE1hcChpZHMpIHtcbiAgICAgICAgY29uc3QgaWRNYXAgPSB7fTtcbiAgICAgICAgZm9yIChjb25zdCBkb2Mgb2YgaWRzKSB7XG4gICAgICAgICAgICBpZE1hcFtkb2MuaW5kZXhdID0gZG9jLl9pZDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaWRNYXA7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIG5ldyBCdWxrV3JpdGVSZXN1bHQgaW5zdGFuY2VcbiAgICAgKiBAaW50ZXJuYWxcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihidWxrUmVzdWx0LCBpc09yZGVyZWQpIHtcbiAgICAgICAgdGhpcy5yZXN1bHQgPSBidWxrUmVzdWx0O1xuICAgICAgICB0aGlzLmluc2VydGVkQ291bnQgPSB0aGlzLnJlc3VsdC5uSW5zZXJ0ZWQgPz8gMDtcbiAgICAgICAgdGhpcy5tYXRjaGVkQ291bnQgPSB0aGlzLnJlc3VsdC5uTWF0Y2hlZCA/PyAwO1xuICAgICAgICB0aGlzLm1vZGlmaWVkQ291bnQgPSB0aGlzLnJlc3VsdC5uTW9kaWZpZWQgPz8gMDtcbiAgICAgICAgdGhpcy5kZWxldGVkQ291bnQgPSB0aGlzLnJlc3VsdC5uUmVtb3ZlZCA/PyAwO1xuICAgICAgICB0aGlzLnVwc2VydGVkQ291bnQgPSB0aGlzLnJlc3VsdC51cHNlcnRlZC5sZW5ndGggPz8gMDtcbiAgICAgICAgdGhpcy51cHNlcnRlZElkcyA9IEJ1bGtXcml0ZVJlc3VsdC5nZW5lcmF0ZUlkTWFwKHRoaXMucmVzdWx0LnVwc2VydGVkKTtcbiAgICAgICAgdGhpcy5pbnNlcnRlZElkcyA9IEJ1bGtXcml0ZVJlc3VsdC5nZW5lcmF0ZUlkTWFwKHRoaXMuZ2V0U3VjY2Vzc2Z1bGx5SW5zZXJ0ZWRJZHMoYnVsa1Jlc3VsdCwgaXNPcmRlcmVkKSk7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCAncmVzdWx0JywgeyB2YWx1ZTogdGhpcy5yZXN1bHQsIGVudW1lcmFibGU6IGZhbHNlIH0pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGRvY3VtZW50X2lkcyB0aGF0IHdlcmUgYWN0dWFsbHkgaW5zZXJ0ZWRcbiAgICAgKiBAaW50ZXJuYWxcbiAgICAgKi9cbiAgICBnZXRTdWNjZXNzZnVsbHlJbnNlcnRlZElkcyhidWxrUmVzdWx0LCBpc09yZGVyZWQpIHtcbiAgICAgICAgaWYgKGJ1bGtSZXN1bHQud3JpdGVFcnJvcnMubGVuZ3RoID09PSAwKVxuICAgICAgICAgICAgcmV0dXJuIGJ1bGtSZXN1bHQuaW5zZXJ0ZWRJZHM7XG4gICAgICAgIGlmIChpc09yZGVyZWQpIHtcbiAgICAgICAgICAgIHJldHVybiBidWxrUmVzdWx0Lmluc2VydGVkSWRzLnNsaWNlKDAsIGJ1bGtSZXN1bHQud3JpdGVFcnJvcnNbMF0uaW5kZXgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBidWxrUmVzdWx0Lmluc2VydGVkSWRzLmZpbHRlcigoeyBpbmRleCB9KSA9PiAhYnVsa1Jlc3VsdC53cml0ZUVycm9ycy5zb21lKHdyaXRlRXJyb3IgPT4gaW5kZXggPT09IHdyaXRlRXJyb3IuaW5kZXgpKTtcbiAgICB9XG4gICAgLyoqIEV2YWx1YXRlcyB0byB0cnVlIGlmIHRoZSBidWxrIG9wZXJhdGlvbiBjb3JyZWN0bHkgZXhlY3V0ZXMgKi9cbiAgICBnZXQgb2soKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlc3VsdC5vaztcbiAgICB9XG4gICAgLyoqXG4gICAgICogVGhlIG51bWJlciBvZiBpbnNlcnRlZCBkb2N1bWVudHNcbiAgICAgKiBAZGVwcmVjYXRlZCBVc2UgaW5zZXJ0ZWRDb3VudCBpbnN0ZWFkLlxuICAgICAqL1xuICAgIGdldCBuSW5zZXJ0ZWQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlc3VsdC5uSW5zZXJ0ZWQ7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIE51bWJlciBvZiB1cHNlcnRlZCBkb2N1bWVudHNcbiAgICAgKiBAZGVwcmVjYXRlZCBVc2VyIHVwc2VydGVkQ291bnQgaW5zdGVhZC5cbiAgICAgKi9cbiAgICBnZXQgblVwc2VydGVkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yZXN1bHQublVwc2VydGVkO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBOdW1iZXIgb2YgbWF0Y2hlZCBkb2N1bWVudHNcbiAgICAgKiBAZGVwcmVjYXRlZCBVc2UgbWF0Y2hlZENvdW50IGluc3RlYWQuXG4gICAgICovXG4gICAgZ2V0IG5NYXRjaGVkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yZXN1bHQubk1hdGNoZWQ7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIE51bWJlciBvZiBkb2N1bWVudHMgdXBkYXRlZCBwaHlzaWNhbGx5IG9uIGRpc2tcbiAgICAgKiBAZGVwcmVjYXRlZCBVc2UgbW9kaWZpZWRDb3VudCBpbnN0ZWFkLlxuICAgICAqL1xuICAgIGdldCBuTW9kaWZpZWQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlc3VsdC5uTW9kaWZpZWQ7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIE51bWJlciBvZiByZW1vdmVkIGRvY3VtZW50c1xuICAgICAqIEBkZXByZWNhdGVkIFVzZSBkZWxldGVkQ291bnQgaW5zdGVhZC5cbiAgICAgKi9cbiAgICBnZXQgblJlbW92ZWQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlc3VsdC5uUmVtb3ZlZDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhbiBhcnJheSBvZiBhbGwgaW5zZXJ0ZWQgaWRzXG4gICAgICogQGRlcHJlY2F0ZWQgVXNlIGluc2VydGVkSWRzIGluc3RlYWQuXG4gICAgICovXG4gICAgZ2V0SW5zZXJ0ZWRJZHMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlc3VsdC5pbnNlcnRlZElkcztcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhbiBhcnJheSBvZiBhbGwgdXBzZXJ0ZWQgaWRzXG4gICAgICogQGRlcHJlY2F0ZWQgVXNlIHVwc2VydGVkSWRzIGluc3RlYWQuXG4gICAgICovXG4gICAgZ2V0VXBzZXJ0ZWRJZHMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlc3VsdC51cHNlcnRlZDtcbiAgICB9XG4gICAgLyoqIFJldHVybnMgdGhlIHVwc2VydGVkIGlkIGF0IHRoZSBnaXZlbiBpbmRleCAqL1xuICAgIGdldFVwc2VydGVkSWRBdChpbmRleCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yZXN1bHQudXBzZXJ0ZWRbaW5kZXhdO1xuICAgIH1cbiAgICAvKiogUmV0dXJucyByYXcgaW50ZXJuYWwgcmVzdWx0ICovXG4gICAgZ2V0UmF3UmVzcG9uc2UoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlc3VsdDtcbiAgICB9XG4gICAgLyoqIFJldHVybnMgdHJ1ZSBpZiB0aGUgYnVsayBvcGVyYXRpb24gY29udGFpbnMgYSB3cml0ZSBlcnJvciAqL1xuICAgIGhhc1dyaXRlRXJyb3JzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yZXN1bHQud3JpdGVFcnJvcnMubGVuZ3RoID4gMDtcbiAgICB9XG4gICAgLyoqIFJldHVybnMgdGhlIG51bWJlciBvZiB3cml0ZSBlcnJvcnMgb2ZmIHRoZSBidWxrIG9wZXJhdGlvbiAqL1xuICAgIGdldFdyaXRlRXJyb3JDb3VudCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVzdWx0LndyaXRlRXJyb3JzLmxlbmd0aDtcbiAgICB9XG4gICAgLyoqIFJldHVybnMgYSBzcGVjaWZpYyB3cml0ZSBlcnJvciBvYmplY3QgKi9cbiAgICBnZXRXcml0ZUVycm9yQXQoaW5kZXgpIHtcbiAgICAgICAgcmV0dXJuIGluZGV4IDwgdGhpcy5yZXN1bHQud3JpdGVFcnJvcnMubGVuZ3RoID8gdGhpcy5yZXN1bHQud3JpdGVFcnJvcnNbaW5kZXhdIDogdW5kZWZpbmVkO1xuICAgIH1cbiAgICAvKiogUmV0cmlldmUgYWxsIHdyaXRlIGVycm9ycyAqL1xuICAgIGdldFdyaXRlRXJyb3JzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yZXN1bHQud3JpdGVFcnJvcnM7XG4gICAgfVxuICAgIC8qKiBSZXRyaWV2ZSB0aGUgd3JpdGUgY29uY2VybiBlcnJvciBpZiBvbmUgZXhpc3RzICovXG4gICAgZ2V0V3JpdGVDb25jZXJuRXJyb3IoKSB7XG4gICAgICAgIGlmICh0aGlzLnJlc3VsdC53cml0ZUNvbmNlcm5FcnJvcnMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy5yZXN1bHQud3JpdGVDb25jZXJuRXJyb3JzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgLy8gUmV0dXJuIHRoZSBlcnJvclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVzdWx0LndyaXRlQ29uY2VybkVycm9yc1swXTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIC8vIENvbWJpbmUgdGhlIGVycm9yc1xuICAgICAgICAgICAgbGV0IGVycm1zZyA9ICcnO1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnJlc3VsdC53cml0ZUNvbmNlcm5FcnJvcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlcnIgPSB0aGlzLnJlc3VsdC53cml0ZUNvbmNlcm5FcnJvcnNbaV07XG4gICAgICAgICAgICAgICAgZXJybXNnID0gZXJybXNnICsgZXJyLmVycm1zZztcbiAgICAgICAgICAgICAgICAvLyBUT0RPOiBTb21ldGhpbmcgYmV0dGVyXG4gICAgICAgICAgICAgICAgaWYgKGkgPT09IDApXG4gICAgICAgICAgICAgICAgICAgIGVycm1zZyA9IGVycm1zZyArICcgYW5kICc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IFdyaXRlQ29uY2VybkVycm9yKHsgZXJybXNnLCBjb2RlOiBlcnJvcl8xLk1PTkdPREJfRVJST1JfQ09ERVMuV3JpdGVDb25jZXJuRmFpbGVkIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIHRvU3RyaW5nKCkge1xuICAgICAgICByZXR1cm4gYEJ1bGtXcml0ZVJlc3VsdCgke3RoaXMucmVzdWx0fSlgO1xuICAgIH1cbiAgICBpc09rKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yZXN1bHQub2sgPT09IDE7XG4gICAgfVxufVxuZXhwb3J0cy5CdWxrV3JpdGVSZXN1bHQgPSBCdWxrV3JpdGVSZXN1bHQ7XG4vKipcbiAqIEFuIGVycm9yIHJlcHJlc2VudGluZyBhIGZhaWx1cmUgYnkgdGhlIHNlcnZlciB0byBhcHBseSB0aGUgcmVxdWVzdGVkIHdyaXRlIGNvbmNlcm4gdG8gdGhlIGJ1bGsgb3BlcmF0aW9uLlxuICogQHB1YmxpY1xuICogQGNhdGVnb3J5IEVycm9yXG4gKi9cbmNsYXNzIFdyaXRlQ29uY2VybkVycm9yIHtcbiAgICBjb25zdHJ1Y3RvcihlcnJvcikge1xuICAgICAgICB0aGlzW2tTZXJ2ZXJFcnJvcl0gPSBlcnJvcjtcbiAgICB9XG4gICAgLyoqIFdyaXRlIGNvbmNlcm4gZXJyb3IgY29kZS4gKi9cbiAgICBnZXQgY29kZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXNba1NlcnZlckVycm9yXS5jb2RlO1xuICAgIH1cbiAgICAvKiogV3JpdGUgY29uY2VybiBlcnJvciBtZXNzYWdlLiAqL1xuICAgIGdldCBlcnJtc2coKSB7XG4gICAgICAgIHJldHVybiB0aGlzW2tTZXJ2ZXJFcnJvcl0uZXJybXNnO1xuICAgIH1cbiAgICAvKiogV3JpdGUgY29uY2VybiBlcnJvciBpbmZvLiAqL1xuICAgIGdldCBlcnJJbmZvKCkge1xuICAgICAgICByZXR1cm4gdGhpc1trU2VydmVyRXJyb3JdLmVyckluZm87XG4gICAgfVxuICAgIHRvSlNPTigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXNba1NlcnZlckVycm9yXTtcbiAgICB9XG4gICAgdG9TdHJpbmcoKSB7XG4gICAgICAgIHJldHVybiBgV3JpdGVDb25jZXJuRXJyb3IoJHt0aGlzLmVycm1zZ30pYDtcbiAgICB9XG59XG5leHBvcnRzLldyaXRlQ29uY2VybkVycm9yID0gV3JpdGVDb25jZXJuRXJyb3I7XG4vKipcbiAqIEFuIGVycm9yIHRoYXQgb2NjdXJyZWQgZHVyaW5nIGEgQnVsa1dyaXRlIG9uIHRoZSBzZXJ2ZXIuXG4gKiBAcHVibGljXG4gKiBAY2F0ZWdvcnkgRXJyb3JcbiAqL1xuY2xhc3MgV3JpdGVFcnJvciB7XG4gICAgY29uc3RydWN0b3IoZXJyKSB7XG4gICAgICAgIHRoaXMuZXJyID0gZXJyO1xuICAgIH1cbiAgICAvKiogV3JpdGVFcnJvciBjb2RlLiAqL1xuICAgIGdldCBjb2RlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5lcnIuY29kZTtcbiAgICB9XG4gICAgLyoqIFdyaXRlRXJyb3Igb3JpZ2luYWwgYnVsayBvcGVyYXRpb24gaW5kZXguICovXG4gICAgZ2V0IGluZGV4KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5lcnIuaW5kZXg7XG4gICAgfVxuICAgIC8qKiBXcml0ZUVycm9yIG1lc3NhZ2UuICovXG4gICAgZ2V0IGVycm1zZygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZXJyLmVycm1zZztcbiAgICB9XG4gICAgLyoqIFdyaXRlRXJyb3IgZGV0YWlscy4gKi9cbiAgICBnZXQgZXJySW5mbygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZXJyLmVyckluZm87XG4gICAgfVxuICAgIC8qKiBSZXR1cm5zIHRoZSB1bmRlcmx5aW5nIG9wZXJhdGlvbiB0aGF0IGNhdXNlZCB0aGUgZXJyb3IgKi9cbiAgICBnZXRPcGVyYXRpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmVyci5vcDtcbiAgICB9XG4gICAgdG9KU09OKCkge1xuICAgICAgICByZXR1cm4geyBjb2RlOiB0aGlzLmVyci5jb2RlLCBpbmRleDogdGhpcy5lcnIuaW5kZXgsIGVycm1zZzogdGhpcy5lcnIuZXJybXNnLCBvcDogdGhpcy5lcnIub3AgfTtcbiAgICB9XG4gICAgdG9TdHJpbmcoKSB7XG4gICAgICAgIHJldHVybiBgV3JpdGVFcnJvcigke0pTT04uc3RyaW5naWZ5KHRoaXMudG9KU09OKCkpfSlgO1xuICAgIH1cbn1cbmV4cG9ydHMuV3JpdGVFcnJvciA9IFdyaXRlRXJyb3I7XG4vKiogTWVyZ2VzIHJlc3VsdHMgaW50byBzaGFyZWQgZGF0YSBzdHJ1Y3R1cmUgKi9cbmZ1bmN0aW9uIG1lcmdlQmF0Y2hSZXN1bHRzKGJhdGNoLCBidWxrUmVzdWx0LCBlcnIsIHJlc3VsdCkge1xuICAgIC8vIElmIHdlIGhhdmUgYW4gZXJyb3Igc2V0IHRoZSByZXN1bHQgdG8gYmUgdGhlIGVyciBvYmplY3RcbiAgICBpZiAoZXJyKSB7XG4gICAgICAgIHJlc3VsdCA9IGVycjtcbiAgICB9XG4gICAgZWxzZSBpZiAocmVzdWx0ICYmIHJlc3VsdC5yZXN1bHQpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LnJlc3VsdDtcbiAgICB9XG4gICAgaWYgKHJlc3VsdCA9PSBudWxsKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgLy8gRG8gd2UgaGF2ZSBhIHRvcCBsZXZlbCBlcnJvciBzdG9wIHByb2Nlc3NpbmcgYW5kIHJldHVyblxuICAgIGlmIChyZXN1bHQub2sgPT09IDAgJiYgYnVsa1Jlc3VsdC5vayA9PT0gMSkge1xuICAgICAgICBidWxrUmVzdWx0Lm9rID0gMDtcbiAgICAgICAgY29uc3Qgd3JpdGVFcnJvciA9IHtcbiAgICAgICAgICAgIGluZGV4OiAwLFxuICAgICAgICAgICAgY29kZTogcmVzdWx0LmNvZGUgfHwgMCxcbiAgICAgICAgICAgIGVycm1zZzogcmVzdWx0Lm1lc3NhZ2UsXG4gICAgICAgICAgICBlcnJJbmZvOiByZXN1bHQuZXJySW5mbyxcbiAgICAgICAgICAgIG9wOiBiYXRjaC5vcGVyYXRpb25zWzBdXG4gICAgICAgIH07XG4gICAgICAgIGJ1bGtSZXN1bHQud3JpdGVFcnJvcnMucHVzaChuZXcgV3JpdGVFcnJvcih3cml0ZUVycm9yKSk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgZWxzZSBpZiAocmVzdWx0Lm9rID09PSAwICYmIGJ1bGtSZXN1bHQub2sgPT09IDApIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAvLyBJZiB3ZSBoYXZlIGFuIGluc2VydCBCYXRjaCB0eXBlXG4gICAgaWYgKGlzSW5zZXJ0QmF0Y2goYmF0Y2gpICYmIHJlc3VsdC5uKSB7XG4gICAgICAgIGJ1bGtSZXN1bHQubkluc2VydGVkID0gYnVsa1Jlc3VsdC5uSW5zZXJ0ZWQgKyByZXN1bHQubjtcbiAgICB9XG4gICAgLy8gSWYgd2UgaGF2ZSBhbiBpbnNlcnQgQmF0Y2ggdHlwZVxuICAgIGlmIChpc0RlbGV0ZUJhdGNoKGJhdGNoKSAmJiByZXN1bHQubikge1xuICAgICAgICBidWxrUmVzdWx0Lm5SZW1vdmVkID0gYnVsa1Jlc3VsdC5uUmVtb3ZlZCArIHJlc3VsdC5uO1xuICAgIH1cbiAgICBsZXQgblVwc2VydGVkID0gMDtcbiAgICAvLyBXZSBoYXZlIGFuIGFycmF5IG9mIHVwc2VydGVkIHZhbHVlcywgd2UgbmVlZCB0byByZXdyaXRlIHRoZSBpbmRleGVzXG4gICAgaWYgKEFycmF5LmlzQXJyYXkocmVzdWx0LnVwc2VydGVkKSkge1xuICAgICAgICBuVXBzZXJ0ZWQgPSByZXN1bHQudXBzZXJ0ZWQubGVuZ3RoO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJlc3VsdC51cHNlcnRlZC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgYnVsa1Jlc3VsdC51cHNlcnRlZC5wdXNoKHtcbiAgICAgICAgICAgICAgICBpbmRleDogcmVzdWx0LnVwc2VydGVkW2ldLmluZGV4ICsgYmF0Y2gub3JpZ2luYWxaZXJvSW5kZXgsXG4gICAgICAgICAgICAgICAgX2lkOiByZXN1bHQudXBzZXJ0ZWRbaV0uX2lkXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIGlmIChyZXN1bHQudXBzZXJ0ZWQpIHtcbiAgICAgICAgblVwc2VydGVkID0gMTtcbiAgICAgICAgYnVsa1Jlc3VsdC51cHNlcnRlZC5wdXNoKHtcbiAgICAgICAgICAgIGluZGV4OiBiYXRjaC5vcmlnaW5hbFplcm9JbmRleCxcbiAgICAgICAgICAgIF9pZDogcmVzdWx0LnVwc2VydGVkXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvLyBJZiB3ZSBoYXZlIGFuIHVwZGF0ZSBCYXRjaCB0eXBlXG4gICAgaWYgKGlzVXBkYXRlQmF0Y2goYmF0Y2gpICYmIHJlc3VsdC5uKSB7XG4gICAgICAgIGNvbnN0IG5Nb2RpZmllZCA9IHJlc3VsdC5uTW9kaWZpZWQ7XG4gICAgICAgIGJ1bGtSZXN1bHQublVwc2VydGVkID0gYnVsa1Jlc3VsdC5uVXBzZXJ0ZWQgKyBuVXBzZXJ0ZWQ7XG4gICAgICAgIGJ1bGtSZXN1bHQubk1hdGNoZWQgPSBidWxrUmVzdWx0Lm5NYXRjaGVkICsgKHJlc3VsdC5uIC0gblVwc2VydGVkKTtcbiAgICAgICAgaWYgKHR5cGVvZiBuTW9kaWZpZWQgPT09ICdudW1iZXInKSB7XG4gICAgICAgICAgICBidWxrUmVzdWx0Lm5Nb2RpZmllZCA9IGJ1bGtSZXN1bHQubk1vZGlmaWVkICsgbk1vZGlmaWVkO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgYnVsa1Jlc3VsdC5uTW9kaWZpZWQgPSAwO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmIChBcnJheS5pc0FycmF5KHJlc3VsdC53cml0ZUVycm9ycykpIHtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCByZXN1bHQud3JpdGVFcnJvcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IHdyaXRlRXJyb3IgPSB7XG4gICAgICAgICAgICAgICAgaW5kZXg6IGJhdGNoLm9yaWdpbmFsSW5kZXhlc1tyZXN1bHQud3JpdGVFcnJvcnNbaV0uaW5kZXhdLFxuICAgICAgICAgICAgICAgIGNvZGU6IHJlc3VsdC53cml0ZUVycm9yc1tpXS5jb2RlLFxuICAgICAgICAgICAgICAgIGVycm1zZzogcmVzdWx0LndyaXRlRXJyb3JzW2ldLmVycm1zZyxcbiAgICAgICAgICAgICAgICBlcnJJbmZvOiByZXN1bHQud3JpdGVFcnJvcnNbaV0uZXJySW5mbyxcbiAgICAgICAgICAgICAgICBvcDogYmF0Y2gub3BlcmF0aW9uc1tyZXN1bHQud3JpdGVFcnJvcnNbaV0uaW5kZXhdXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgYnVsa1Jlc3VsdC53cml0ZUVycm9ycy5wdXNoKG5ldyBXcml0ZUVycm9yKHdyaXRlRXJyb3IpKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAocmVzdWx0LndyaXRlQ29uY2VybkVycm9yKSB7XG4gICAgICAgIGJ1bGtSZXN1bHQud3JpdGVDb25jZXJuRXJyb3JzLnB1c2gobmV3IFdyaXRlQ29uY2VybkVycm9yKHJlc3VsdC53cml0ZUNvbmNlcm5FcnJvcikpO1xuICAgIH1cbn1cbmV4cG9ydHMubWVyZ2VCYXRjaFJlc3VsdHMgPSBtZXJnZUJhdGNoUmVzdWx0cztcbmZ1bmN0aW9uIGV4ZWN1dGVDb21tYW5kcyhidWxrT3BlcmF0aW9uLCBvcHRpb25zLCBjYWxsYmFjaykge1xuICAgIGlmIChidWxrT3BlcmF0aW9uLnMuYmF0Y2hlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIGNhbGxiYWNrKHVuZGVmaW5lZCwgbmV3IEJ1bGtXcml0ZVJlc3VsdChidWxrT3BlcmF0aW9uLnMuYnVsa1Jlc3VsdCwgYnVsa09wZXJhdGlvbi5pc09yZGVyZWQpKTtcbiAgICB9XG4gICAgY29uc3QgYmF0Y2ggPSBidWxrT3BlcmF0aW9uLnMuYmF0Y2hlcy5zaGlmdCgpO1xuICAgIGZ1bmN0aW9uIHJlc3VsdEhhbmRsZXIoZXJyLCByZXN1bHQpIHtcbiAgICAgICAgLy8gRXJyb3IgaXMgYSBkcml2ZXIgcmVsYXRlZCBlcnJvciBub3QgYSBidWxrIG9wIGVycm9yLCByZXR1cm4gZWFybHlcbiAgICAgICAgaWYgKGVyciAmJiAnbWVzc2FnZScgaW4gZXJyICYmICEoZXJyIGluc3RhbmNlb2YgZXJyb3JfMS5Nb25nb1dyaXRlQ29uY2VybkVycm9yKSkge1xuICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKG5ldyBNb25nb0J1bGtXcml0ZUVycm9yKGVyciwgbmV3IEJ1bGtXcml0ZVJlc3VsdChidWxrT3BlcmF0aW9uLnMuYnVsa1Jlc3VsdCwgYnVsa09wZXJhdGlvbi5pc09yZGVyZWQpKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGVyciBpbnN0YW5jZW9mIGVycm9yXzEuTW9uZ29Xcml0ZUNvbmNlcm5FcnJvcikge1xuICAgICAgICAgICAgcmV0dXJuIGhhbmRsZU1vbmdvV3JpdGVDb25jZXJuRXJyb3IoYmF0Y2gsIGJ1bGtPcGVyYXRpb24ucy5idWxrUmVzdWx0LCBidWxrT3BlcmF0aW9uLmlzT3JkZXJlZCwgZXJyLCBjYWxsYmFjayk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gTWVyZ2UgdGhlIHJlc3VsdHMgdG9nZXRoZXJcbiAgICAgICAgbWVyZ2VCYXRjaFJlc3VsdHMoYmF0Y2gsIGJ1bGtPcGVyYXRpb24ucy5idWxrUmVzdWx0LCBlcnIsIHJlc3VsdCk7XG4gICAgICAgIGNvbnN0IHdyaXRlUmVzdWx0ID0gbmV3IEJ1bGtXcml0ZVJlc3VsdChidWxrT3BlcmF0aW9uLnMuYnVsa1Jlc3VsdCwgYnVsa09wZXJhdGlvbi5pc09yZGVyZWQpO1xuICAgICAgICBpZiAoYnVsa09wZXJhdGlvbi5oYW5kbGVXcml0ZUVycm9yKGNhbGxiYWNrLCB3cml0ZVJlc3VsdCkpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIC8vIEV4ZWN1dGUgdGhlIG5leHQgY29tbWFuZCBpbiBsaW5lXG4gICAgICAgIGV4ZWN1dGVDb21tYW5kcyhidWxrT3BlcmF0aW9uLCBvcHRpb25zLCBjYWxsYmFjayk7XG4gICAgfVxuICAgIGNvbnN0IGZpbmFsT3B0aW9ucyA9ICgwLCB1dGlsc18xLnJlc29sdmVPcHRpb25zKShidWxrT3BlcmF0aW9uLCB7XG4gICAgICAgIC4uLm9wdGlvbnMsXG4gICAgICAgIG9yZGVyZWQ6IGJ1bGtPcGVyYXRpb24uaXNPcmRlcmVkXG4gICAgfSk7XG4gICAgaWYgKGZpbmFsT3B0aW9ucy5ieXBhc3NEb2N1bWVudFZhbGlkYXRpb24gIT09IHRydWUpIHtcbiAgICAgICAgZGVsZXRlIGZpbmFsT3B0aW9ucy5ieXBhc3NEb2N1bWVudFZhbGlkYXRpb247XG4gICAgfVxuICAgIC8vIFNldCBhbiBvcGVyYXRpb25JZiBpZiBwcm92aWRlZFxuICAgIGlmIChidWxrT3BlcmF0aW9uLm9wZXJhdGlvbklkKSB7XG4gICAgICAgIHJlc3VsdEhhbmRsZXIub3BlcmF0aW9uSWQgPSBidWxrT3BlcmF0aW9uLm9wZXJhdGlvbklkO1xuICAgIH1cbiAgICAvLyBJcyB0aGUgYnlwYXNzRG9jdW1lbnRWYWxpZGF0aW9uIG9wdGlvbnMgc3BlY2lmaWNcbiAgICBpZiAoYnVsa09wZXJhdGlvbi5zLmJ5cGFzc0RvY3VtZW50VmFsaWRhdGlvbiA9PT0gdHJ1ZSkge1xuICAgICAgICBmaW5hbE9wdGlvbnMuYnlwYXNzRG9jdW1lbnRWYWxpZGF0aW9uID0gdHJ1ZTtcbiAgICB9XG4gICAgLy8gSXMgdGhlIGNoZWNrS2V5cyBvcHRpb24gZGlzYWJsZWRcbiAgICBpZiAoYnVsa09wZXJhdGlvbi5zLmNoZWNrS2V5cyA9PT0gZmFsc2UpIHtcbiAgICAgICAgZmluYWxPcHRpb25zLmNoZWNrS2V5cyA9IGZhbHNlO1xuICAgIH1cbiAgICBpZiAoZmluYWxPcHRpb25zLnJldHJ5V3JpdGVzKSB7XG4gICAgICAgIGlmIChpc1VwZGF0ZUJhdGNoKGJhdGNoKSkge1xuICAgICAgICAgICAgZmluYWxPcHRpb25zLnJldHJ5V3JpdGVzID0gZmluYWxPcHRpb25zLnJldHJ5V3JpdGVzICYmICFiYXRjaC5vcGVyYXRpb25zLnNvbWUob3AgPT4gb3AubXVsdGkpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpc0RlbGV0ZUJhdGNoKGJhdGNoKSkge1xuICAgICAgICAgICAgZmluYWxPcHRpb25zLnJldHJ5V3JpdGVzID1cbiAgICAgICAgICAgICAgICBmaW5hbE9wdGlvbnMucmV0cnlXcml0ZXMgJiYgIWJhdGNoLm9wZXJhdGlvbnMuc29tZShvcCA9PiBvcC5saW1pdCA9PT0gMCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgICAgaWYgKGlzSW5zZXJ0QmF0Y2goYmF0Y2gpKSB7XG4gICAgICAgICAgICAoMCwgZXhlY3V0ZV9vcGVyYXRpb25fMS5leGVjdXRlT3BlcmF0aW9uKShidWxrT3BlcmF0aW9uLnMuY29sbGVjdGlvbi5jbGllbnQsIG5ldyBpbnNlcnRfMS5JbnNlcnRPcGVyYXRpb24oYnVsa09wZXJhdGlvbi5zLm5hbWVzcGFjZSwgYmF0Y2gub3BlcmF0aW9ucywgZmluYWxPcHRpb25zKSwgcmVzdWx0SGFuZGxlcik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoaXNVcGRhdGVCYXRjaChiYXRjaCkpIHtcbiAgICAgICAgICAgICgwLCBleGVjdXRlX29wZXJhdGlvbl8xLmV4ZWN1dGVPcGVyYXRpb24pKGJ1bGtPcGVyYXRpb24ucy5jb2xsZWN0aW9uLmNsaWVudCwgbmV3IHVwZGF0ZV8xLlVwZGF0ZU9wZXJhdGlvbihidWxrT3BlcmF0aW9uLnMubmFtZXNwYWNlLCBiYXRjaC5vcGVyYXRpb25zLCBmaW5hbE9wdGlvbnMpLCByZXN1bHRIYW5kbGVyKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChpc0RlbGV0ZUJhdGNoKGJhdGNoKSkge1xuICAgICAgICAgICAgKDAsIGV4ZWN1dGVfb3BlcmF0aW9uXzEuZXhlY3V0ZU9wZXJhdGlvbikoYnVsa09wZXJhdGlvbi5zLmNvbGxlY3Rpb24uY2xpZW50LCBuZXcgZGVsZXRlXzEuRGVsZXRlT3BlcmF0aW9uKGJ1bGtPcGVyYXRpb24ucy5uYW1lc3BhY2UsIGJhdGNoLm9wZXJhdGlvbnMsIGZpbmFsT3B0aW9ucyksIHJlc3VsdEhhbmRsZXIpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNhdGNoIChlcnIpIHtcbiAgICAgICAgLy8gRm9yY2UgdG9wIGxldmVsIGVycm9yXG4gICAgICAgIGVyci5vayA9IDA7XG4gICAgICAgIC8vIE1lcmdlIHRvcCBsZXZlbCBlcnJvciBhbmQgcmV0dXJuXG4gICAgICAgIG1lcmdlQmF0Y2hSZXN1bHRzKGJhdGNoLCBidWxrT3BlcmF0aW9uLnMuYnVsa1Jlc3VsdCwgZXJyLCB1bmRlZmluZWQpO1xuICAgICAgICBjYWxsYmFjaygpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGhhbmRsZU1vbmdvV3JpdGVDb25jZXJuRXJyb3IoYmF0Y2gsIGJ1bGtSZXN1bHQsIGlzT3JkZXJlZCwgZXJyLCBjYWxsYmFjaykge1xuICAgIG1lcmdlQmF0Y2hSZXN1bHRzKGJhdGNoLCBidWxrUmVzdWx0LCB1bmRlZmluZWQsIGVyci5yZXN1bHQpO1xuICAgIGNhbGxiYWNrKG5ldyBNb25nb0J1bGtXcml0ZUVycm9yKHtcbiAgICAgICAgbWVzc2FnZTogZXJyLnJlc3VsdD8ud3JpdGVDb25jZXJuRXJyb3IuZXJybXNnLFxuICAgICAgICBjb2RlOiBlcnIucmVzdWx0Py53cml0ZUNvbmNlcm5FcnJvci5yZXN1bHRcbiAgICB9LCBuZXcgQnVsa1dyaXRlUmVzdWx0KGJ1bGtSZXN1bHQsIGlzT3JkZXJlZCkpKTtcbn1cbi8qKlxuICogQW4gZXJyb3IgaW5kaWNhdGluZyBhbiB1bnN1Y2Nlc3NmdWwgQnVsayBXcml0ZVxuICogQHB1YmxpY1xuICogQGNhdGVnb3J5IEVycm9yXG4gKi9cbmNsYXNzIE1vbmdvQnVsa1dyaXRlRXJyb3IgZXh0ZW5kcyBlcnJvcl8xLk1vbmdvU2VydmVyRXJyb3Ige1xuICAgIC8qKiBDcmVhdGVzIGEgbmV3IE1vbmdvQnVsa1dyaXRlRXJyb3IgKi9cbiAgICBjb25zdHJ1Y3RvcihlcnJvciwgcmVzdWx0KSB7XG4gICAgICAgIHN1cGVyKGVycm9yKTtcbiAgICAgICAgdGhpcy53cml0ZUVycm9ycyA9IFtdO1xuICAgICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBXcml0ZUNvbmNlcm5FcnJvcilcbiAgICAgICAgICAgIHRoaXMuZXJyID0gZXJyb3I7XG4gICAgICAgIGVsc2UgaWYgKCEoZXJyb3IgaW5zdGFuY2VvZiBFcnJvcikpIHtcbiAgICAgICAgICAgIHRoaXMubWVzc2FnZSA9IGVycm9yLm1lc3NhZ2U7XG4gICAgICAgICAgICB0aGlzLmNvZGUgPSBlcnJvci5jb2RlO1xuICAgICAgICAgICAgdGhpcy53cml0ZUVycm9ycyA9IGVycm9yLndyaXRlRXJyb3JzID8/IFtdO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucmVzdWx0ID0gcmVzdWx0O1xuICAgICAgICBPYmplY3QuYXNzaWduKHRoaXMsIGVycm9yKTtcbiAgICB9XG4gICAgZ2V0IG5hbWUoKSB7XG4gICAgICAgIHJldHVybiAnTW9uZ29CdWxrV3JpdGVFcnJvcic7XG4gICAgfVxuICAgIC8qKiBOdW1iZXIgb2YgZG9jdW1lbnRzIGluc2VydGVkLiAqL1xuICAgIGdldCBpbnNlcnRlZENvdW50KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yZXN1bHQuaW5zZXJ0ZWRDb3VudDtcbiAgICB9XG4gICAgLyoqIE51bWJlciBvZiBkb2N1bWVudHMgbWF0Y2hlZCBmb3IgdXBkYXRlLiAqL1xuICAgIGdldCBtYXRjaGVkQ291bnQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlc3VsdC5tYXRjaGVkQ291bnQ7XG4gICAgfVxuICAgIC8qKiBOdW1iZXIgb2YgZG9jdW1lbnRzIG1vZGlmaWVkLiAqL1xuICAgIGdldCBtb2RpZmllZENvdW50KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yZXN1bHQubW9kaWZpZWRDb3VudDtcbiAgICB9XG4gICAgLyoqIE51bWJlciBvZiBkb2N1bWVudHMgZGVsZXRlZC4gKi9cbiAgICBnZXQgZGVsZXRlZENvdW50KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yZXN1bHQuZGVsZXRlZENvdW50O1xuICAgIH1cbiAgICAvKiogTnVtYmVyIG9mIGRvY3VtZW50cyB1cHNlcnRlZC4gKi9cbiAgICBnZXQgdXBzZXJ0ZWRDb3VudCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVzdWx0LnVwc2VydGVkQ291bnQ7XG4gICAgfVxuICAgIC8qKiBJbnNlcnRlZCBkb2N1bWVudCBnZW5lcmF0ZWQgSWQncywgaGFzaCBrZXkgaXMgdGhlIGluZGV4IG9mIHRoZSBvcmlnaW5hdGluZyBvcGVyYXRpb24gKi9cbiAgICBnZXQgaW5zZXJ0ZWRJZHMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlc3VsdC5pbnNlcnRlZElkcztcbiAgICB9XG4gICAgLyoqIFVwc2VydGVkIGRvY3VtZW50IGdlbmVyYXRlZCBJZCdzLCBoYXNoIGtleSBpcyB0aGUgaW5kZXggb2YgdGhlIG9yaWdpbmF0aW5nIG9wZXJhdGlvbiAqL1xuICAgIGdldCB1cHNlcnRlZElkcygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVzdWx0LnVwc2VydGVkSWRzO1xuICAgIH1cbn1cbmV4cG9ydHMuTW9uZ29CdWxrV3JpdGVFcnJvciA9IE1vbmdvQnVsa1dyaXRlRXJyb3I7XG4vKipcbiAqIEEgYnVpbGRlciBvYmplY3QgdGhhdCBpcyByZXR1cm5lZCBmcm9tIHtAbGluayBCdWxrT3BlcmF0aW9uQmFzZSNmaW5kfS5cbiAqIElzIHVzZWQgdG8gYnVpbGQgYSB3cml0ZSBvcGVyYXRpb24gdGhhdCBpbnZvbHZlcyBhIHF1ZXJ5IGZpbHRlci5cbiAqXG4gKiBAcHVibGljXG4gKi9cbmNsYXNzIEZpbmRPcGVyYXRvcnMge1xuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgRmluZE9wZXJhdG9ycyBvYmplY3QuXG4gICAgICogQGludGVybmFsXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoYnVsa09wZXJhdGlvbikge1xuICAgICAgICB0aGlzLmJ1bGtPcGVyYXRpb24gPSBidWxrT3BlcmF0aW9uO1xuICAgIH1cbiAgICAvKiogQWRkIGEgbXVsdGlwbGUgdXBkYXRlIG9wZXJhdGlvbiB0byB0aGUgYnVsayBvcGVyYXRpb24gKi9cbiAgICB1cGRhdGUodXBkYXRlRG9jdW1lbnQpIHtcbiAgICAgICAgY29uc3QgY3VycmVudE9wID0gYnVpbGRDdXJyZW50T3AodGhpcy5idWxrT3BlcmF0aW9uKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuYnVsa09wZXJhdGlvbi5hZGRUb09wZXJhdGlvbnNMaXN0KGV4cG9ydHMuQmF0Y2hUeXBlLlVQREFURSwgKDAsIHVwZGF0ZV8xLm1ha2VVcGRhdGVTdGF0ZW1lbnQpKGN1cnJlbnRPcC5zZWxlY3RvciwgdXBkYXRlRG9jdW1lbnQsIHtcbiAgICAgICAgICAgIC4uLmN1cnJlbnRPcCxcbiAgICAgICAgICAgIG11bHRpOiB0cnVlXG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgLyoqIEFkZCBhIHNpbmdsZSB1cGRhdGUgb3BlcmF0aW9uIHRvIHRoZSBidWxrIG9wZXJhdGlvbiAqL1xuICAgIHVwZGF0ZU9uZSh1cGRhdGVEb2N1bWVudCkge1xuICAgICAgICBpZiAoISgwLCB1dGlsc18xLmhhc0F0b21pY09wZXJhdG9ycykodXBkYXRlRG9jdW1lbnQpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdVcGRhdGUgZG9jdW1lbnQgcmVxdWlyZXMgYXRvbWljIG9wZXJhdG9ycycpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGN1cnJlbnRPcCA9IGJ1aWxkQ3VycmVudE9wKHRoaXMuYnVsa09wZXJhdGlvbik7XG4gICAgICAgIHJldHVybiB0aGlzLmJ1bGtPcGVyYXRpb24uYWRkVG9PcGVyYXRpb25zTGlzdChleHBvcnRzLkJhdGNoVHlwZS5VUERBVEUsICgwLCB1cGRhdGVfMS5tYWtlVXBkYXRlU3RhdGVtZW50KShjdXJyZW50T3Auc2VsZWN0b3IsIHVwZGF0ZURvY3VtZW50LCB7IC4uLmN1cnJlbnRPcCwgbXVsdGk6IGZhbHNlIH0pKTtcbiAgICB9XG4gICAgLyoqIEFkZCBhIHJlcGxhY2Ugb25lIG9wZXJhdGlvbiB0byB0aGUgYnVsayBvcGVyYXRpb24gKi9cbiAgICByZXBsYWNlT25lKHJlcGxhY2VtZW50KSB7XG4gICAgICAgIGlmICgoMCwgdXRpbHNfMS5oYXNBdG9taWNPcGVyYXRvcnMpKHJlcGxhY2VtZW50KSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignUmVwbGFjZW1lbnQgZG9jdW1lbnQgbXVzdCBub3QgdXNlIGF0b21pYyBvcGVyYXRvcnMnKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjdXJyZW50T3AgPSBidWlsZEN1cnJlbnRPcCh0aGlzLmJ1bGtPcGVyYXRpb24pO1xuICAgICAgICByZXR1cm4gdGhpcy5idWxrT3BlcmF0aW9uLmFkZFRvT3BlcmF0aW9uc0xpc3QoZXhwb3J0cy5CYXRjaFR5cGUuVVBEQVRFLCAoMCwgdXBkYXRlXzEubWFrZVVwZGF0ZVN0YXRlbWVudCkoY3VycmVudE9wLnNlbGVjdG9yLCByZXBsYWNlbWVudCwgeyAuLi5jdXJyZW50T3AsIG11bHRpOiBmYWxzZSB9KSk7XG4gICAgfVxuICAgIC8qKiBBZGQgYSBkZWxldGUgb25lIG9wZXJhdGlvbiB0byB0aGUgYnVsayBvcGVyYXRpb24gKi9cbiAgICBkZWxldGVPbmUoKSB7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRPcCA9IGJ1aWxkQ3VycmVudE9wKHRoaXMuYnVsa09wZXJhdGlvbik7XG4gICAgICAgIHJldHVybiB0aGlzLmJ1bGtPcGVyYXRpb24uYWRkVG9PcGVyYXRpb25zTGlzdChleHBvcnRzLkJhdGNoVHlwZS5ERUxFVEUsICgwLCBkZWxldGVfMS5tYWtlRGVsZXRlU3RhdGVtZW50KShjdXJyZW50T3Auc2VsZWN0b3IsIHsgLi4uY3VycmVudE9wLCBsaW1pdDogMSB9KSk7XG4gICAgfVxuICAgIC8qKiBBZGQgYSBkZWxldGUgbWFueSBvcGVyYXRpb24gdG8gdGhlIGJ1bGsgb3BlcmF0aW9uICovXG4gICAgZGVsZXRlKCkge1xuICAgICAgICBjb25zdCBjdXJyZW50T3AgPSBidWlsZEN1cnJlbnRPcCh0aGlzLmJ1bGtPcGVyYXRpb24pO1xuICAgICAgICByZXR1cm4gdGhpcy5idWxrT3BlcmF0aW9uLmFkZFRvT3BlcmF0aW9uc0xpc3QoZXhwb3J0cy5CYXRjaFR5cGUuREVMRVRFLCAoMCwgZGVsZXRlXzEubWFrZURlbGV0ZVN0YXRlbWVudCkoY3VycmVudE9wLnNlbGVjdG9yLCB7IC4uLmN1cnJlbnRPcCwgbGltaXQ6IDAgfSkpO1xuICAgIH1cbiAgICAvKiogVXBzZXJ0IG1vZGlmaWVyIGZvciB1cGRhdGUgYnVsayBvcGVyYXRpb24sIG5vdGluZyB0aGF0IHRoaXMgb3BlcmF0aW9uIGlzIGFuIHVwc2VydC4gKi9cbiAgICB1cHNlcnQoKSB7XG4gICAgICAgIGlmICghdGhpcy5idWxrT3BlcmF0aW9uLnMuY3VycmVudE9wKSB7XG4gICAgICAgICAgICB0aGlzLmJ1bGtPcGVyYXRpb24ucy5jdXJyZW50T3AgPSB7fTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmJ1bGtPcGVyYXRpb24ucy5jdXJyZW50T3AudXBzZXJ0ID0gdHJ1ZTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIC8qKiBTcGVjaWZpZXMgdGhlIGNvbGxhdGlvbiBmb3IgdGhlIHF1ZXJ5IGNvbmRpdGlvbi4gKi9cbiAgICBjb2xsYXRpb24oY29sbGF0aW9uKSB7XG4gICAgICAgIGlmICghdGhpcy5idWxrT3BlcmF0aW9uLnMuY3VycmVudE9wKSB7XG4gICAgICAgICAgICB0aGlzLmJ1bGtPcGVyYXRpb24ucy5jdXJyZW50T3AgPSB7fTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmJ1bGtPcGVyYXRpb24ucy5jdXJyZW50T3AuY29sbGF0aW9uID0gY29sbGF0aW9uO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgLyoqIFNwZWNpZmllcyBhcnJheUZpbHRlcnMgZm9yIFVwZGF0ZU9uZSBvciBVcGRhdGVNYW55IGJ1bGsgb3BlcmF0aW9ucy4gKi9cbiAgICBhcnJheUZpbHRlcnMoYXJyYXlGaWx0ZXJzKSB7XG4gICAgICAgIGlmICghdGhpcy5idWxrT3BlcmF0aW9uLnMuY3VycmVudE9wKSB7XG4gICAgICAgICAgICB0aGlzLmJ1bGtPcGVyYXRpb24ucy5jdXJyZW50T3AgPSB7fTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmJ1bGtPcGVyYXRpb24ucy5jdXJyZW50T3AuYXJyYXlGaWx0ZXJzID0gYXJyYXlGaWx0ZXJzO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgLyoqIFNwZWNpZmllcyBoaW50IGZvciB0aGUgYnVsayBvcGVyYXRpb24uICovXG4gICAgaGludChoaW50KSB7XG4gICAgICAgIGlmICghdGhpcy5idWxrT3BlcmF0aW9uLnMuY3VycmVudE9wKSB7XG4gICAgICAgICAgICB0aGlzLmJ1bGtPcGVyYXRpb24ucy5jdXJyZW50T3AgPSB7fTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmJ1bGtPcGVyYXRpb24ucy5jdXJyZW50T3AuaGludCA9IGhpbnQ7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbn1cbmV4cG9ydHMuRmluZE9wZXJhdG9ycyA9IEZpbmRPcGVyYXRvcnM7XG4vKipcbiAqIFRPRE8oTk9ERS00MDYzKVxuICogQnVsa1dyaXRlcyBtZXJnZSBjb21wbGV4aXR5IGlzIGltcGxlbWVudGVkIGluIGV4ZWN1dGVDb21tYW5kc1xuICogVGhpcyBwcm92aWRlcyBhIHZlaGljbGUgdG8gdHJlYXQgYnVsa09wZXJhdGlvbnMgbGlrZSBhbnkgb3RoZXIgb3BlcmF0aW9uIChoZW5jZSBcInNoaW1cIilcbiAqIFdlIHdvdWxkIGxpa2UgdGhpcyBsb2dpYyB0byBzaW1wbHkgbGl2ZSBpbnNpZGUgdGhlIEJ1bGtXcml0ZU9wZXJhdGlvbiBjbGFzc1xuICogQGludGVybmFsXG4gKi9cbmNsYXNzIEJ1bGtXcml0ZVNoaW1PcGVyYXRpb24gZXh0ZW5kcyBvcGVyYXRpb25fMS5BYnN0cmFjdENhbGxiYWNrT3BlcmF0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcihidWxrT3BlcmF0aW9uLCBvcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKG9wdGlvbnMpO1xuICAgICAgICB0aGlzLmJ1bGtPcGVyYXRpb24gPSBidWxrT3BlcmF0aW9uO1xuICAgIH1cbiAgICBleGVjdXRlQ2FsbGJhY2soc2VydmVyLCBzZXNzaW9uLCBjYWxsYmFjaykge1xuICAgICAgICBpZiAodGhpcy5vcHRpb25zLnNlc3Npb24gPT0gbnVsbCkge1xuICAgICAgICAgICAgLy8gQW4gaW1wbGljaXQgc2Vzc2lvbiBjb3VsZCBoYXZlIGJlZW4gY3JlYXRlZCBieSAnZXhlY3V0ZU9wZXJhdGlvbidcbiAgICAgICAgICAgIC8vIFNvIGlmIHdlIHN0aWNrIGl0IG9uIGZpbmFsT3B0aW9ucyBoZXJlLCBlYWNoIGJ1bGsgb3BlcmF0aW9uXG4gICAgICAgICAgICAvLyB3aWxsIHVzZSB0aGlzIHNhbWUgc2Vzc2lvbiwgaXQnbGwgYmUgcGFzc2VkIGluIHRoZSBzYW1lIHdheVxuICAgICAgICAgICAgLy8gYW4gZXhwbGljaXQgc2Vzc2lvbiB3b3VsZCBiZVxuICAgICAgICAgICAgdGhpcy5vcHRpb25zLnNlc3Npb24gPSBzZXNzaW9uO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBleGVjdXRlQ29tbWFuZHModGhpcy5idWxrT3BlcmF0aW9uLCB0aGlzLm9wdGlvbnMsIGNhbGxiYWNrKTtcbiAgICB9XG59XG4vKiogQHB1YmxpYyAqL1xuY2xhc3MgQnVsa09wZXJhdGlvbkJhc2Uge1xuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIG5ldyBPcmRlcmVkQnVsa09wZXJhdGlvbiBvciBVbm9yZGVyZWRCdWxrT3BlcmF0aW9uIGluc3RhbmNlXG4gICAgICogQGludGVybmFsXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoY29sbGVjdGlvbiwgb3B0aW9ucywgaXNPcmRlcmVkKSB7XG4gICAgICAgIC8vIGRldGVybWluZSB3aGV0aGVyIGJ1bGtPcGVyYXRpb24gaXMgb3JkZXJlZCBvciB1bm9yZGVyZWRcbiAgICAgICAgdGhpcy5pc09yZGVyZWQgPSBpc09yZGVyZWQ7XG4gICAgICAgIGNvbnN0IHRvcG9sb2d5ID0gKDAsIHV0aWxzXzEuZ2V0VG9wb2xvZ3kpKGNvbGxlY3Rpb24pO1xuICAgICAgICBvcHRpb25zID0gb3B0aW9ucyA9PSBudWxsID8ge30gOiBvcHRpb25zO1xuICAgICAgICAvLyBUT0RPIEJyaW5nIGZyb20gZHJpdmVyIGluZm9ybWF0aW9uIGluIGhlbGxvXG4gICAgICAgIC8vIEdldCB0aGUgbmFtZXNwYWNlIGZvciB0aGUgd3JpdGUgb3BlcmF0aW9uc1xuICAgICAgICBjb25zdCBuYW1lc3BhY2UgPSBjb2xsZWN0aW9uLnMubmFtZXNwYWNlO1xuICAgICAgICAvLyBVc2VkIHRvIG1hcmsgb3BlcmF0aW9uIGFzIGV4ZWN1dGVkXG4gICAgICAgIGNvbnN0IGV4ZWN1dGVkID0gZmFsc2U7XG4gICAgICAgIC8vIEN1cnJlbnQgaXRlbVxuICAgICAgICBjb25zdCBjdXJyZW50T3AgPSB1bmRlZmluZWQ7XG4gICAgICAgIC8vIFNldCBtYXggYnl0ZSBzaXplXG4gICAgICAgIGNvbnN0IGhlbGxvID0gdG9wb2xvZ3kubGFzdEhlbGxvKCk7XG4gICAgICAgIC8vIElmIHdlIGhhdmUgYXV0b0VuY3J5cHRpb24gb24sIGJhdGNoLXNwbGl0dGluZyBtdXN0IGJlIGRvbmUgb24gMm1iIGNodW5rcywgYnV0IHNpbmdsZSBkb2N1bWVudHNcbiAgICAgICAgLy8gb3ZlciAybWIgYXJlIHN0aWxsIGFsbG93ZWRcbiAgICAgICAgY29uc3QgdXNpbmdBdXRvRW5jcnlwdGlvbiA9ICEhKHRvcG9sb2d5LnMub3B0aW9ucyAmJiB0b3BvbG9neS5zLm9wdGlvbnMuYXV0b0VuY3J5cHRlcik7XG4gICAgICAgIGNvbnN0IG1heEJzb25PYmplY3RTaXplID0gaGVsbG8gJiYgaGVsbG8ubWF4QnNvbk9iamVjdFNpemUgPyBoZWxsby5tYXhCc29uT2JqZWN0U2l6ZSA6IDEwMjQgKiAxMDI0ICogMTY7XG4gICAgICAgIGNvbnN0IG1heEJhdGNoU2l6ZUJ5dGVzID0gdXNpbmdBdXRvRW5jcnlwdGlvbiA/IDEwMjQgKiAxMDI0ICogMiA6IG1heEJzb25PYmplY3RTaXplO1xuICAgICAgICBjb25zdCBtYXhXcml0ZUJhdGNoU2l6ZSA9IGhlbGxvICYmIGhlbGxvLm1heFdyaXRlQmF0Y2hTaXplID8gaGVsbG8ubWF4V3JpdGVCYXRjaFNpemUgOiAxMDAwO1xuICAgICAgICAvLyBDYWxjdWxhdGVzIHRoZSBsYXJnZXN0IHBvc3NpYmxlIHNpemUgb2YgYW4gQXJyYXkga2V5LCByZXByZXNlbnRlZCBhcyBhIEJTT04gc3RyaW5nXG4gICAgICAgIC8vIGVsZW1lbnQuIFRoaXMgY2FsY3VsYXRpb246XG4gICAgICAgIC8vICAgICAxIGJ5dGUgZm9yIEJTT04gdHlwZVxuICAgICAgICAvLyAgICAgIyBvZiBieXRlcyA9IGxlbmd0aCBvZiAoc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIChtYXhXcml0ZUJhdGNoU2l6ZSAtIDEpKVxuICAgICAgICAvLyAgICsgMSBieXRlcyBmb3IgbnVsbCB0ZXJtaW5hdG9yXG4gICAgICAgIGNvbnN0IG1heEtleVNpemUgPSAobWF4V3JpdGVCYXRjaFNpemUgLSAxKS50b1N0cmluZygxMCkubGVuZ3RoICsgMjtcbiAgICAgICAgLy8gRmluYWwgb3B0aW9ucyBmb3IgcmV0cnlhYmxlIHdyaXRlc1xuICAgICAgICBsZXQgZmluYWxPcHRpb25zID0gT2JqZWN0LmFzc2lnbih7fSwgb3B0aW9ucyk7XG4gICAgICAgIGZpbmFsT3B0aW9ucyA9ICgwLCB1dGlsc18xLmFwcGx5UmV0cnlhYmxlV3JpdGVzKShmaW5hbE9wdGlvbnMsIGNvbGxlY3Rpb24ucy5kYik7XG4gICAgICAgIC8vIEZpbmFsIHJlc3VsdHNcbiAgICAgICAgY29uc3QgYnVsa1Jlc3VsdCA9IHtcbiAgICAgICAgICAgIG9rOiAxLFxuICAgICAgICAgICAgd3JpdGVFcnJvcnM6IFtdLFxuICAgICAgICAgICAgd3JpdGVDb25jZXJuRXJyb3JzOiBbXSxcbiAgICAgICAgICAgIGluc2VydGVkSWRzOiBbXSxcbiAgICAgICAgICAgIG5JbnNlcnRlZDogMCxcbiAgICAgICAgICAgIG5VcHNlcnRlZDogMCxcbiAgICAgICAgICAgIG5NYXRjaGVkOiAwLFxuICAgICAgICAgICAgbk1vZGlmaWVkOiAwLFxuICAgICAgICAgICAgblJlbW92ZWQ6IDAsXG4gICAgICAgICAgICB1cHNlcnRlZDogW11cbiAgICAgICAgfTtcbiAgICAgICAgLy8gSW50ZXJuYWwgc3RhdGVcbiAgICAgICAgdGhpcy5zID0ge1xuICAgICAgICAgICAgLy8gRmluYWwgcmVzdWx0XG4gICAgICAgICAgICBidWxrUmVzdWx0LFxuICAgICAgICAgICAgLy8gQ3VycmVudCBiYXRjaCBzdGF0ZVxuICAgICAgICAgICAgY3VycmVudEJhdGNoOiB1bmRlZmluZWQsXG4gICAgICAgICAgICBjdXJyZW50SW5kZXg6IDAsXG4gICAgICAgICAgICAvLyBvcmRlcmVkIHNwZWNpZmljXG4gICAgICAgICAgICBjdXJyZW50QmF0Y2hTaXplOiAwLFxuICAgICAgICAgICAgY3VycmVudEJhdGNoU2l6ZUJ5dGVzOiAwLFxuICAgICAgICAgICAgLy8gdW5vcmRlcmVkIHNwZWNpZmljXG4gICAgICAgICAgICBjdXJyZW50SW5zZXJ0QmF0Y2g6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIGN1cnJlbnRVcGRhdGVCYXRjaDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgY3VycmVudFJlbW92ZUJhdGNoOiB1bmRlZmluZWQsXG4gICAgICAgICAgICBiYXRjaGVzOiBbXSxcbiAgICAgICAgICAgIC8vIFdyaXRlIGNvbmNlcm5cbiAgICAgICAgICAgIHdyaXRlQ29uY2Vybjogd3JpdGVfY29uY2Vybl8xLldyaXRlQ29uY2Vybi5mcm9tT3B0aW9ucyhvcHRpb25zKSxcbiAgICAgICAgICAgIC8vIE1heCBiYXRjaCBzaXplIG9wdGlvbnNcbiAgICAgICAgICAgIG1heEJzb25PYmplY3RTaXplLFxuICAgICAgICAgICAgbWF4QmF0Y2hTaXplQnl0ZXMsXG4gICAgICAgICAgICBtYXhXcml0ZUJhdGNoU2l6ZSxcbiAgICAgICAgICAgIG1heEtleVNpemUsXG4gICAgICAgICAgICAvLyBOYW1lc3BhY2VcbiAgICAgICAgICAgIG5hbWVzcGFjZSxcbiAgICAgICAgICAgIC8vIFRvcG9sb2d5XG4gICAgICAgICAgICB0b3BvbG9neSxcbiAgICAgICAgICAgIC8vIE9wdGlvbnNcbiAgICAgICAgICAgIG9wdGlvbnM6IGZpbmFsT3B0aW9ucyxcbiAgICAgICAgICAgIC8vIEJTT04gb3B0aW9uc1xuICAgICAgICAgICAgYnNvbk9wdGlvbnM6ICgwLCBic29uXzEucmVzb2x2ZUJTT05PcHRpb25zKShvcHRpb25zKSxcbiAgICAgICAgICAgIC8vIEN1cnJlbnQgb3BlcmF0aW9uXG4gICAgICAgICAgICBjdXJyZW50T3AsXG4gICAgICAgICAgICAvLyBFeGVjdXRlZFxuICAgICAgICAgICAgZXhlY3V0ZWQsXG4gICAgICAgICAgICAvLyBDb2xsZWN0aW9uXG4gICAgICAgICAgICBjb2xsZWN0aW9uLFxuICAgICAgICAgICAgLy8gRnVuZGFtZW50YWwgZXJyb3JcbiAgICAgICAgICAgIGVycjogdW5kZWZpbmVkLFxuICAgICAgICAgICAgLy8gY2hlY2sga2V5c1xuICAgICAgICAgICAgY2hlY2tLZXlzOiB0eXBlb2Ygb3B0aW9ucy5jaGVja0tleXMgPT09ICdib29sZWFuJyA/IG9wdGlvbnMuY2hlY2tLZXlzIDogZmFsc2VcbiAgICAgICAgfTtcbiAgICAgICAgLy8gYnlwYXNzIFZhbGlkYXRpb25cbiAgICAgICAgaWYgKG9wdGlvbnMuYnlwYXNzRG9jdW1lbnRWYWxpZGF0aW9uID09PSB0cnVlKSB7XG4gICAgICAgICAgICB0aGlzLnMuYnlwYXNzRG9jdW1lbnRWYWxpZGF0aW9uID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBBZGQgYSBzaW5nbGUgaW5zZXJ0IGRvY3VtZW50IHRvIHRoZSBidWxrIG9wZXJhdGlvblxuICAgICAqXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiBgYGB0c1xuICAgICAqIGNvbnN0IGJ1bGtPcCA9IGNvbGxlY3Rpb24uaW5pdGlhbGl6ZU9yZGVyZWRCdWxrT3AoKTtcbiAgICAgKlxuICAgICAqIC8vIEFkZHMgdGhyZWUgaW5zZXJ0cyB0byB0aGUgYnVsa09wLlxuICAgICAqIGJ1bGtPcFxuICAgICAqICAgLmluc2VydCh7IGE6IDEgfSlcbiAgICAgKiAgIC5pbnNlcnQoeyBiOiAyIH0pXG4gICAgICogICAuaW5zZXJ0KHsgYzogMyB9KTtcbiAgICAgKiBhd2FpdCBidWxrT3AuZXhlY3V0ZSgpO1xuICAgICAqIGBgYFxuICAgICAqL1xuICAgIGluc2VydChkb2N1bWVudCkge1xuICAgICAgICBpZiAoZG9jdW1lbnQuX2lkID09IG51bGwgJiYgIXNob3VsZEZvcmNlU2VydmVyT2JqZWN0SWQodGhpcykpIHtcbiAgICAgICAgICAgIGRvY3VtZW50Ll9pZCA9IG5ldyBic29uXzEuT2JqZWN0SWQoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5hZGRUb09wZXJhdGlvbnNMaXN0KGV4cG9ydHMuQmF0Y2hUeXBlLklOU0VSVCwgZG9jdW1lbnQpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBCdWlsZHMgYSBmaW5kIG9wZXJhdGlvbiBmb3IgYW4gdXBkYXRlL3VwZGF0ZU9uZS9kZWxldGUvZGVsZXRlT25lL3JlcGxhY2VPbmUuXG4gICAgICogUmV0dXJucyBhIGJ1aWxkZXIgb2JqZWN0IHVzZWQgdG8gY29tcGxldGUgdGhlIGRlZmluaXRpb24gb2YgdGhlIG9wZXJhdGlvbi5cbiAgICAgKlxuICAgICAqIEBleGFtcGxlXG4gICAgICogYGBgdHNcbiAgICAgKiBjb25zdCBidWxrT3AgPSBjb2xsZWN0aW9uLmluaXRpYWxpemVPcmRlcmVkQnVsa09wKCk7XG4gICAgICpcbiAgICAgKiAvLyBBZGQgYW4gdXBkYXRlT25lIHRvIHRoZSBidWxrT3BcbiAgICAgKiBidWxrT3AuZmluZCh7IGE6IDEgfSkudXBkYXRlT25lKHsgJHNldDogeyBiOiAyIH0gfSk7XG4gICAgICpcbiAgICAgKiAvLyBBZGQgYW4gdXBkYXRlTWFueSB0byB0aGUgYnVsa09wXG4gICAgICogYnVsa09wLmZpbmQoeyBjOiAzIH0pLnVwZGF0ZSh7ICRzZXQ6IHsgZDogNCB9IH0pO1xuICAgICAqXG4gICAgICogLy8gQWRkIGFuIHVwc2VydFxuICAgICAqIGJ1bGtPcC5maW5kKHsgZTogNSB9KS51cHNlcnQoKS51cGRhdGVPbmUoeyAkc2V0OiB7IGY6IDYgfSB9KTtcbiAgICAgKlxuICAgICAqIC8vIEFkZCBhIGRlbGV0aW9uXG4gICAgICogYnVsa09wLmZpbmQoeyBnOiA3IH0pLmRlbGV0ZU9uZSgpO1xuICAgICAqXG4gICAgICogLy8gQWRkIGEgbXVsdGkgZGVsZXRpb25cbiAgICAgKiBidWxrT3AuZmluZCh7IGg6IDggfSkuZGVsZXRlKCk7XG4gICAgICpcbiAgICAgKiAvLyBBZGQgYSByZXBsYWNlT25lXG4gICAgICogYnVsa09wLmZpbmQoeyBpOiA5IH0pLnJlcGxhY2VPbmUoe3dyaXRlQ29uY2VybjogeyBqOiAxMCB9fSk7XG4gICAgICpcbiAgICAgKiAvLyBVcGRhdGUgdXNpbmcgYSBwaXBlbGluZSAocmVxdWlyZXMgTW9uZ29kYiA0LjIgb3IgaGlnaGVyKVxuICAgICAqIGJ1bGsuZmluZCh7IGs6IDExLCB5OiB7ICRleGlzdHM6IHRydWUgfSwgejogeyAkZXhpc3RzOiB0cnVlIH0gfSkudXBkYXRlT25lKFtcbiAgICAgKiAgIHsgJHNldDogeyB0b3RhbDogeyAkc3VtOiBbICckeScsICckeicgXSB9IH0gfVxuICAgICAqIF0pO1xuICAgICAqXG4gICAgICogLy8gQWxsIG9mIHRoZSBvcHMgd2lsbCBub3cgYmUgZXhlY3V0ZWRcbiAgICAgKiBhd2FpdCBidWxrT3AuZXhlY3V0ZSgpO1xuICAgICAqIGBgYFxuICAgICAqL1xuICAgIGZpbmQoc2VsZWN0b3IpIHtcbiAgICAgICAgaWYgKCFzZWxlY3Rvcikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignQnVsayBmaW5kIG9wZXJhdGlvbiBtdXN0IHNwZWNpZnkgYSBzZWxlY3RvcicpO1xuICAgICAgICB9XG4gICAgICAgIC8vIFNhdmUgYSBjdXJyZW50IHNlbGVjdG9yXG4gICAgICAgIHRoaXMucy5jdXJyZW50T3AgPSB7XG4gICAgICAgICAgICBzZWxlY3Rvcjogc2VsZWN0b3JcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIG5ldyBGaW5kT3BlcmF0b3JzKHRoaXMpO1xuICAgIH1cbiAgICAvKiogU3BlY2lmaWVzIGEgcmF3IG9wZXJhdGlvbiB0byBwZXJmb3JtIGluIHRoZSBidWxrIHdyaXRlLiAqL1xuICAgIHJhdyhvcCkge1xuICAgICAgICBpZiAob3AgPT0gbnVsbCB8fCB0eXBlb2Ygb3AgIT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdPcGVyYXRpb24gbXVzdCBiZSBhbiBvYmplY3Qgd2l0aCBhbiBvcGVyYXRpb24ga2V5Jyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCdpbnNlcnRPbmUnIGluIG9wKSB7XG4gICAgICAgICAgICBjb25zdCBmb3JjZVNlcnZlck9iamVjdElkID0gc2hvdWxkRm9yY2VTZXJ2ZXJPYmplY3RJZCh0aGlzKTtcbiAgICAgICAgICAgIGlmIChvcC5pbnNlcnRPbmUgJiYgb3AuaW5zZXJ0T25lLmRvY3VtZW50ID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAvLyBOT1RFOiBwcm92aWRlZCBmb3IgbGVnYWN5IHN1cHBvcnQsIGJ1dCB0aGlzIGlzIGEgbWFsZm9ybWVkIG9wZXJhdGlvblxuICAgICAgICAgICAgICAgIGlmIChmb3JjZVNlcnZlck9iamVjdElkICE9PSB0cnVlICYmIG9wLmluc2VydE9uZS5faWQgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBvcC5pbnNlcnRPbmUuX2lkID0gbmV3IGJzb25fMS5PYmplY3RJZCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5hZGRUb09wZXJhdGlvbnNMaXN0KGV4cG9ydHMuQmF0Y2hUeXBlLklOU0VSVCwgb3AuaW5zZXJ0T25lKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChmb3JjZVNlcnZlck9iamVjdElkICE9PSB0cnVlICYmIG9wLmluc2VydE9uZS5kb2N1bWVudC5faWQgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIG9wLmluc2VydE9uZS5kb2N1bWVudC5faWQgPSBuZXcgYnNvbl8xLk9iamVjdElkKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5hZGRUb09wZXJhdGlvbnNMaXN0KGV4cG9ydHMuQmF0Y2hUeXBlLklOU0VSVCwgb3AuaW5zZXJ0T25lLmRvY3VtZW50KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoJ3JlcGxhY2VPbmUnIGluIG9wIHx8ICd1cGRhdGVPbmUnIGluIG9wIHx8ICd1cGRhdGVNYW55JyBpbiBvcCkge1xuICAgICAgICAgICAgaWYgKCdyZXBsYWNlT25lJyBpbiBvcCkge1xuICAgICAgICAgICAgICAgIGlmICgncScgaW4gb3AucmVwbGFjZU9uZSkge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdSYXcgb3BlcmF0aW9ucyBhcmUgbm90IGFsbG93ZWQnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc3QgdXBkYXRlU3RhdGVtZW50ID0gKDAsIHVwZGF0ZV8xLm1ha2VVcGRhdGVTdGF0ZW1lbnQpKG9wLnJlcGxhY2VPbmUuZmlsdGVyLCBvcC5yZXBsYWNlT25lLnJlcGxhY2VtZW50LCB7IC4uLm9wLnJlcGxhY2VPbmUsIG11bHRpOiBmYWxzZSB9KTtcbiAgICAgICAgICAgICAgICBpZiAoKDAsIHV0aWxzXzEuaGFzQXRvbWljT3BlcmF0b3JzKSh1cGRhdGVTdGF0ZW1lbnQudSkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignUmVwbGFjZW1lbnQgZG9jdW1lbnQgbXVzdCBub3QgdXNlIGF0b21pYyBvcGVyYXRvcnMnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYWRkVG9PcGVyYXRpb25zTGlzdChleHBvcnRzLkJhdGNoVHlwZS5VUERBVEUsIHVwZGF0ZVN0YXRlbWVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoJ3VwZGF0ZU9uZScgaW4gb3ApIHtcbiAgICAgICAgICAgICAgICBpZiAoJ3EnIGluIG9wLnVwZGF0ZU9uZSkge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdSYXcgb3BlcmF0aW9ucyBhcmUgbm90IGFsbG93ZWQnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc3QgdXBkYXRlU3RhdGVtZW50ID0gKDAsIHVwZGF0ZV8xLm1ha2VVcGRhdGVTdGF0ZW1lbnQpKG9wLnVwZGF0ZU9uZS5maWx0ZXIsIG9wLnVwZGF0ZU9uZS51cGRhdGUsIHtcbiAgICAgICAgICAgICAgICAgICAgLi4ub3AudXBkYXRlT25lLFxuICAgICAgICAgICAgICAgICAgICBtdWx0aTogZmFsc2VcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpZiAoISgwLCB1dGlsc18xLmhhc0F0b21pY09wZXJhdG9ycykodXBkYXRlU3RhdGVtZW50LnUpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoJ1VwZGF0ZSBkb2N1bWVudCByZXF1aXJlcyBhdG9taWMgb3BlcmF0b3JzJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmFkZFRvT3BlcmF0aW9uc0xpc3QoZXhwb3J0cy5CYXRjaFR5cGUuVVBEQVRFLCB1cGRhdGVTdGF0ZW1lbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCd1cGRhdGVNYW55JyBpbiBvcCkge1xuICAgICAgICAgICAgICAgIGlmICgncScgaW4gb3AudXBkYXRlTWFueSkge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdSYXcgb3BlcmF0aW9ucyBhcmUgbm90IGFsbG93ZWQnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc3QgdXBkYXRlU3RhdGVtZW50ID0gKDAsIHVwZGF0ZV8xLm1ha2VVcGRhdGVTdGF0ZW1lbnQpKG9wLnVwZGF0ZU1hbnkuZmlsdGVyLCBvcC51cGRhdGVNYW55LnVwZGF0ZSwge1xuICAgICAgICAgICAgICAgICAgICAuLi5vcC51cGRhdGVNYW55LFxuICAgICAgICAgICAgICAgICAgICBtdWx0aTogdHJ1ZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGlmICghKDAsIHV0aWxzXzEuaGFzQXRvbWljT3BlcmF0b3JzKSh1cGRhdGVTdGF0ZW1lbnQudSkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignVXBkYXRlIGRvY3VtZW50IHJlcXVpcmVzIGF0b21pYyBvcGVyYXRvcnMnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYWRkVG9PcGVyYXRpb25zTGlzdChleHBvcnRzLkJhdGNoVHlwZS5VUERBVEUsIHVwZGF0ZVN0YXRlbWVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCdkZWxldGVPbmUnIGluIG9wKSB7XG4gICAgICAgICAgICBpZiAoJ3EnIGluIG9wLmRlbGV0ZU9uZSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoJ1JhdyBvcGVyYXRpb25zIGFyZSBub3QgYWxsb3dlZCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuYWRkVG9PcGVyYXRpb25zTGlzdChleHBvcnRzLkJhdGNoVHlwZS5ERUxFVEUsICgwLCBkZWxldGVfMS5tYWtlRGVsZXRlU3RhdGVtZW50KShvcC5kZWxldGVPbmUuZmlsdGVyLCB7IC4uLm9wLmRlbGV0ZU9uZSwgbGltaXQ6IDEgfSkpO1xuICAgICAgICB9XG4gICAgICAgIGlmICgnZGVsZXRlTWFueScgaW4gb3ApIHtcbiAgICAgICAgICAgIGlmICgncScgaW4gb3AuZGVsZXRlTWFueSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoJ1JhdyBvcGVyYXRpb25zIGFyZSBub3QgYWxsb3dlZCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuYWRkVG9PcGVyYXRpb25zTGlzdChleHBvcnRzLkJhdGNoVHlwZS5ERUxFVEUsICgwLCBkZWxldGVfMS5tYWtlRGVsZXRlU3RhdGVtZW50KShvcC5kZWxldGVNYW55LmZpbHRlciwgeyAuLi5vcC5kZWxldGVNYW55LCBsaW1pdDogMCB9KSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gb3RoZXJ3aXNlIGFuIHVua25vd24gb3BlcmF0aW9uIHdhcyBwcm92aWRlZFxuICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdidWxrV3JpdGUgb25seSBzdXBwb3J0cyBpbnNlcnRPbmUsIHVwZGF0ZU9uZSwgdXBkYXRlTWFueSwgZGVsZXRlT25lLCBkZWxldGVNYW55Jyk7XG4gICAgfVxuICAgIGdldCBic29uT3B0aW9ucygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucy5ic29uT3B0aW9ucztcbiAgICB9XG4gICAgZ2V0IHdyaXRlQ29uY2VybigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucy53cml0ZUNvbmNlcm47XG4gICAgfVxuICAgIGdldCBiYXRjaGVzKCkge1xuICAgICAgICBjb25zdCBiYXRjaGVzID0gWy4uLnRoaXMucy5iYXRjaGVzXTtcbiAgICAgICAgaWYgKHRoaXMuaXNPcmRlcmVkKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5zLmN1cnJlbnRCYXRjaClcbiAgICAgICAgICAgICAgICBiYXRjaGVzLnB1c2godGhpcy5zLmN1cnJlbnRCYXRjaCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpZiAodGhpcy5zLmN1cnJlbnRJbnNlcnRCYXRjaClcbiAgICAgICAgICAgICAgICBiYXRjaGVzLnB1c2godGhpcy5zLmN1cnJlbnRJbnNlcnRCYXRjaCk7XG4gICAgICAgICAgICBpZiAodGhpcy5zLmN1cnJlbnRVcGRhdGVCYXRjaClcbiAgICAgICAgICAgICAgICBiYXRjaGVzLnB1c2godGhpcy5zLmN1cnJlbnRVcGRhdGVCYXRjaCk7XG4gICAgICAgICAgICBpZiAodGhpcy5zLmN1cnJlbnRSZW1vdmVCYXRjaClcbiAgICAgICAgICAgICAgICBiYXRjaGVzLnB1c2godGhpcy5zLmN1cnJlbnRSZW1vdmVCYXRjaCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGJhdGNoZXM7XG4gICAgfVxuICAgIGFzeW5jIGV4ZWN1dGUob3B0aW9ucyA9IHt9KSB7XG4gICAgICAgIGlmICh0aGlzLnMuZXhlY3V0ZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvQmF0Y2hSZUV4ZWN1dGlvbkVycm9yKCk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgd3JpdGVDb25jZXJuID0gd3JpdGVfY29uY2Vybl8xLldyaXRlQ29uY2Vybi5mcm9tT3B0aW9ucyhvcHRpb25zKTtcbiAgICAgICAgaWYgKHdyaXRlQ29uY2Vybikge1xuICAgICAgICAgICAgdGhpcy5zLndyaXRlQ29uY2VybiA9IHdyaXRlQ29uY2VybjtcbiAgICAgICAgfVxuICAgICAgICAvLyBJZiB3ZSBoYXZlIGN1cnJlbnQgYmF0Y2hcbiAgICAgICAgaWYgKHRoaXMuaXNPcmRlcmVkKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5zLmN1cnJlbnRCYXRjaClcbiAgICAgICAgICAgICAgICB0aGlzLnMuYmF0Y2hlcy5wdXNoKHRoaXMucy5jdXJyZW50QmF0Y2gpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKHRoaXMucy5jdXJyZW50SW5zZXJ0QmF0Y2gpXG4gICAgICAgICAgICAgICAgdGhpcy5zLmJhdGNoZXMucHVzaCh0aGlzLnMuY3VycmVudEluc2VydEJhdGNoKTtcbiAgICAgICAgICAgIGlmICh0aGlzLnMuY3VycmVudFVwZGF0ZUJhdGNoKVxuICAgICAgICAgICAgICAgIHRoaXMucy5iYXRjaGVzLnB1c2godGhpcy5zLmN1cnJlbnRVcGRhdGVCYXRjaCk7XG4gICAgICAgICAgICBpZiAodGhpcy5zLmN1cnJlbnRSZW1vdmVCYXRjaClcbiAgICAgICAgICAgICAgICB0aGlzLnMuYmF0Y2hlcy5wdXNoKHRoaXMucy5jdXJyZW50UmVtb3ZlQmF0Y2gpO1xuICAgICAgICB9XG4gICAgICAgIC8vIElmIHdlIGhhdmUgbm8gb3BlcmF0aW9ucyBpbiB0aGUgYnVsayByYWlzZSBhbiBlcnJvclxuICAgICAgICBpZiAodGhpcy5zLmJhdGNoZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdJbnZhbGlkIEJ1bGtPcGVyYXRpb24sIEJhdGNoIGNhbm5vdCBiZSBlbXB0eScpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucy5leGVjdXRlZCA9IHRydWU7XG4gICAgICAgIGNvbnN0IGZpbmFsT3B0aW9ucyA9IHsgLi4udGhpcy5zLm9wdGlvbnMsIC4uLm9wdGlvbnMgfTtcbiAgICAgICAgY29uc3Qgb3BlcmF0aW9uID0gbmV3IEJ1bGtXcml0ZVNoaW1PcGVyYXRpb24odGhpcywgZmluYWxPcHRpb25zKTtcbiAgICAgICAgcmV0dXJuICgwLCBleGVjdXRlX29wZXJhdGlvbl8xLmV4ZWN1dGVPcGVyYXRpb24pKHRoaXMucy5jb2xsZWN0aW9uLmNsaWVudCwgb3BlcmF0aW9uKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogSGFuZGxlcyB0aGUgd3JpdGUgZXJyb3IgYmVmb3JlIGV4ZWN1dGluZyBjb21tYW5kc1xuICAgICAqIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIGhhbmRsZVdyaXRlRXJyb3IoY2FsbGJhY2ssIHdyaXRlUmVzdWx0KSB7XG4gICAgICAgIGlmICh0aGlzLnMuYnVsa1Jlc3VsdC53cml0ZUVycm9ycy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBjb25zdCBtc2cgPSB0aGlzLnMuYnVsa1Jlc3VsdC53cml0ZUVycm9yc1swXS5lcnJtc2dcbiAgICAgICAgICAgICAgICA/IHRoaXMucy5idWxrUmVzdWx0LndyaXRlRXJyb3JzWzBdLmVycm1zZ1xuICAgICAgICAgICAgICAgIDogJ3dyaXRlIG9wZXJhdGlvbiBmYWlsZWQnO1xuICAgICAgICAgICAgY2FsbGJhY2sobmV3IE1vbmdvQnVsa1dyaXRlRXJyb3Ioe1xuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IG1zZyxcbiAgICAgICAgICAgICAgICBjb2RlOiB0aGlzLnMuYnVsa1Jlc3VsdC53cml0ZUVycm9yc1swXS5jb2RlLFxuICAgICAgICAgICAgICAgIHdyaXRlRXJyb3JzOiB0aGlzLnMuYnVsa1Jlc3VsdC53cml0ZUVycm9yc1xuICAgICAgICAgICAgfSwgd3JpdGVSZXN1bHQpKTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHdyaXRlQ29uY2VybkVycm9yID0gd3JpdGVSZXN1bHQuZ2V0V3JpdGVDb25jZXJuRXJyb3IoKTtcbiAgICAgICAgaWYgKHdyaXRlQ29uY2VybkVycm9yKSB7XG4gICAgICAgICAgICBjYWxsYmFjayhuZXcgTW9uZ29CdWxrV3JpdGVFcnJvcih3cml0ZUNvbmNlcm5FcnJvciwgd3JpdGVSZXN1bHQpKTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG59XG5leHBvcnRzLkJ1bGtPcGVyYXRpb25CYXNlID0gQnVsa09wZXJhdGlvbkJhc2U7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoQnVsa09wZXJhdGlvbkJhc2UucHJvdG90eXBlLCAnbGVuZ3RoJywge1xuICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgZ2V0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zLmN1cnJlbnRJbmRleDtcbiAgICB9XG59KTtcbmZ1bmN0aW9uIHNob3VsZEZvcmNlU2VydmVyT2JqZWN0SWQoYnVsa09wZXJhdGlvbikge1xuICAgIGlmICh0eXBlb2YgYnVsa09wZXJhdGlvbi5zLm9wdGlvbnMuZm9yY2VTZXJ2ZXJPYmplY3RJZCA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgIHJldHVybiBidWxrT3BlcmF0aW9uLnMub3B0aW9ucy5mb3JjZVNlcnZlck9iamVjdElkO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIGJ1bGtPcGVyYXRpb24ucy5jb2xsZWN0aW9uLnMuZGIub3B0aW9ucz8uZm9yY2VTZXJ2ZXJPYmplY3RJZCA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgIHJldHVybiBidWxrT3BlcmF0aW9uLnMuY29sbGVjdGlvbi5zLmRiLm9wdGlvbnM/LmZvcmNlU2VydmVyT2JqZWN0SWQ7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbn1cbmZ1bmN0aW9uIGlzSW5zZXJ0QmF0Y2goYmF0Y2gpIHtcbiAgICByZXR1cm4gYmF0Y2guYmF0Y2hUeXBlID09PSBleHBvcnRzLkJhdGNoVHlwZS5JTlNFUlQ7XG59XG5mdW5jdGlvbiBpc1VwZGF0ZUJhdGNoKGJhdGNoKSB7XG4gICAgcmV0dXJuIGJhdGNoLmJhdGNoVHlwZSA9PT0gZXhwb3J0cy5CYXRjaFR5cGUuVVBEQVRFO1xufVxuZnVuY3Rpb24gaXNEZWxldGVCYXRjaChiYXRjaCkge1xuICAgIHJldHVybiBiYXRjaC5iYXRjaFR5cGUgPT09IGV4cG9ydHMuQmF0Y2hUeXBlLkRFTEVURTtcbn1cbmZ1bmN0aW9uIGJ1aWxkQ3VycmVudE9wKGJ1bGtPcCkge1xuICAgIGxldCB7IGN1cnJlbnRPcCB9ID0gYnVsa09wLnM7XG4gICAgYnVsa09wLnMuY3VycmVudE9wID0gdW5kZWZpbmVkO1xuICAgIGlmICghY3VycmVudE9wKVxuICAgICAgICBjdXJyZW50T3AgPSB7fTtcbiAgICByZXR1cm4gY3VycmVudE9wO1xufVxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y29tbW9uLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/bulk/common.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/bulk/ordered.js":
/*!**********************************************************!*\
  !*** ../server/node_modules/mongodb/lib/bulk/ordered.js ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.OrderedBulkOperation = void 0;\nconst BSON = __webpack_require__(/*! ../bson */ \"(api)/../server/node_modules/mongodb/lib/bson.js\");\nconst error_1 = __webpack_require__(/*! ../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst common_1 = __webpack_require__(/*! ./common */ \"(api)/../server/node_modules/mongodb/lib/bulk/common.js\");\n/** @public */\nclass OrderedBulkOperation extends common_1.BulkOperationBase {\n    /** @internal */\n    constructor(collection, options) {\n        super(collection, options, true);\n    }\n    addToOperationsList(batchType, document) {\n        // Get the bsonSize\n        const bsonSize = BSON.calculateObjectSize(document, {\n            checkKeys: false,\n            // Since we don't know what the user selected for BSON options here,\n            // err on the safe side, and check the size with ignoreUndefined: false.\n            ignoreUndefined: false\n        });\n        // Throw error if the doc is bigger than the max BSON size\n        if (bsonSize >= this.s.maxBsonObjectSize)\n            // TODO(NODE-3483): Change this to MongoBSONError\n            throw new error_1.MongoInvalidArgumentError(`Document is larger than the maximum size ${this.s.maxBsonObjectSize}`);\n        // Create a new batch object if we don't have a current one\n        if (this.s.currentBatch == null) {\n            this.s.currentBatch = new common_1.Batch(batchType, this.s.currentIndex);\n        }\n        const maxKeySize = this.s.maxKeySize;\n        // Check if we need to create a new batch\n        if (\n        // New batch if we exceed the max batch op size\n        this.s.currentBatchSize + 1 >= this.s.maxWriteBatchSize ||\n            // New batch if we exceed the maxBatchSizeBytes. Only matters if batch already has a doc,\n            // since we can't sent an empty batch\n            (this.s.currentBatchSize > 0 &&\n                this.s.currentBatchSizeBytes + maxKeySize + bsonSize >= this.s.maxBatchSizeBytes) ||\n            // New batch if the new op does not have the same op type as the current batch\n            this.s.currentBatch.batchType !== batchType) {\n            // Save the batch to the execution stack\n            this.s.batches.push(this.s.currentBatch);\n            // Create a new batch\n            this.s.currentBatch = new common_1.Batch(batchType, this.s.currentIndex);\n            // Reset the current size trackers\n            this.s.currentBatchSize = 0;\n            this.s.currentBatchSizeBytes = 0;\n        }\n        if (batchType === common_1.BatchType.INSERT) {\n            this.s.bulkResult.insertedIds.push({\n                index: this.s.currentIndex,\n                _id: document._id\n            });\n        }\n        // We have an array of documents\n        if (Array.isArray(document)) {\n            throw new error_1.MongoInvalidArgumentError('Operation passed in cannot be an Array');\n        }\n        this.s.currentBatch.originalIndexes.push(this.s.currentIndex);\n        this.s.currentBatch.operations.push(document);\n        this.s.currentBatchSize += 1;\n        this.s.currentBatchSizeBytes += maxKeySize + bsonSize;\n        this.s.currentIndex += 1;\n        return this;\n    }\n}\nexports.OrderedBulkOperation = OrderedBulkOperation;\n//# sourceMappingURL=ordered.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9idWxrL29yZGVyZWQuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsNEJBQTRCO0FBQzVCLGFBQWEsbUJBQU8sQ0FBQyxpRUFBUztBQUM5QixnQkFBZ0IsbUJBQU8sQ0FBQyxtRUFBVTtBQUNsQyxpQkFBaUIsbUJBQU8sQ0FBQyx5RUFBVTtBQUNuQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxvR0FBb0cseUJBQXlCO0FBQzdIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QjtBQUM1QiIsInNvdXJjZXMiOlsiRDpcXHNhbG9uaVxcYXBwcmFpc2FsLXN5c3RlbVxcc2VydmVyXFxub2RlX21vZHVsZXNcXG1vbmdvZGJcXGxpYlxcYnVsa1xcb3JkZXJlZC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuT3JkZXJlZEJ1bGtPcGVyYXRpb24gPSB2b2lkIDA7XG5jb25zdCBCU09OID0gcmVxdWlyZShcIi4uL2Jzb25cIik7XG5jb25zdCBlcnJvcl8xID0gcmVxdWlyZShcIi4uL2Vycm9yXCIpO1xuY29uc3QgY29tbW9uXzEgPSByZXF1aXJlKFwiLi9jb21tb25cIik7XG4vKiogQHB1YmxpYyAqL1xuY2xhc3MgT3JkZXJlZEJ1bGtPcGVyYXRpb24gZXh0ZW5kcyBjb21tb25fMS5CdWxrT3BlcmF0aW9uQmFzZSB7XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGNvbnN0cnVjdG9yKGNvbGxlY3Rpb24sIG9wdGlvbnMpIHtcbiAgICAgICAgc3VwZXIoY29sbGVjdGlvbiwgb3B0aW9ucywgdHJ1ZSk7XG4gICAgfVxuICAgIGFkZFRvT3BlcmF0aW9uc0xpc3QoYmF0Y2hUeXBlLCBkb2N1bWVudCkge1xuICAgICAgICAvLyBHZXQgdGhlIGJzb25TaXplXG4gICAgICAgIGNvbnN0IGJzb25TaXplID0gQlNPTi5jYWxjdWxhdGVPYmplY3RTaXplKGRvY3VtZW50LCB7XG4gICAgICAgICAgICBjaGVja0tleXM6IGZhbHNlLFxuICAgICAgICAgICAgLy8gU2luY2Ugd2UgZG9uJ3Qga25vdyB3aGF0IHRoZSB1c2VyIHNlbGVjdGVkIGZvciBCU09OIG9wdGlvbnMgaGVyZSxcbiAgICAgICAgICAgIC8vIGVyciBvbiB0aGUgc2FmZSBzaWRlLCBhbmQgY2hlY2sgdGhlIHNpemUgd2l0aCBpZ25vcmVVbmRlZmluZWQ6IGZhbHNlLlxuICAgICAgICAgICAgaWdub3JlVW5kZWZpbmVkOiBmYWxzZVxuICAgICAgICB9KTtcbiAgICAgICAgLy8gVGhyb3cgZXJyb3IgaWYgdGhlIGRvYyBpcyBiaWdnZXIgdGhhbiB0aGUgbWF4IEJTT04gc2l6ZVxuICAgICAgICBpZiAoYnNvblNpemUgPj0gdGhpcy5zLm1heEJzb25PYmplY3RTaXplKVxuICAgICAgICAgICAgLy8gVE9ETyhOT0RFLTM0ODMpOiBDaGFuZ2UgdGhpcyB0byBNb25nb0JTT05FcnJvclxuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcihgRG9jdW1lbnQgaXMgbGFyZ2VyIHRoYW4gdGhlIG1heGltdW0gc2l6ZSAke3RoaXMucy5tYXhCc29uT2JqZWN0U2l6ZX1gKTtcbiAgICAgICAgLy8gQ3JlYXRlIGEgbmV3IGJhdGNoIG9iamVjdCBpZiB3ZSBkb24ndCBoYXZlIGEgY3VycmVudCBvbmVcbiAgICAgICAgaWYgKHRoaXMucy5jdXJyZW50QmF0Y2ggPT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy5zLmN1cnJlbnRCYXRjaCA9IG5ldyBjb21tb25fMS5CYXRjaChiYXRjaFR5cGUsIHRoaXMucy5jdXJyZW50SW5kZXgpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG1heEtleVNpemUgPSB0aGlzLnMubWF4S2V5U2l6ZTtcbiAgICAgICAgLy8gQ2hlY2sgaWYgd2UgbmVlZCB0byBjcmVhdGUgYSBuZXcgYmF0Y2hcbiAgICAgICAgaWYgKFxuICAgICAgICAvLyBOZXcgYmF0Y2ggaWYgd2UgZXhjZWVkIHRoZSBtYXggYmF0Y2ggb3Agc2l6ZVxuICAgICAgICB0aGlzLnMuY3VycmVudEJhdGNoU2l6ZSArIDEgPj0gdGhpcy5zLm1heFdyaXRlQmF0Y2hTaXplIHx8XG4gICAgICAgICAgICAvLyBOZXcgYmF0Y2ggaWYgd2UgZXhjZWVkIHRoZSBtYXhCYXRjaFNpemVCeXRlcy4gT25seSBtYXR0ZXJzIGlmIGJhdGNoIGFscmVhZHkgaGFzIGEgZG9jLFxuICAgICAgICAgICAgLy8gc2luY2Ugd2UgY2FuJ3Qgc2VudCBhbiBlbXB0eSBiYXRjaFxuICAgICAgICAgICAgKHRoaXMucy5jdXJyZW50QmF0Y2hTaXplID4gMCAmJlxuICAgICAgICAgICAgICAgIHRoaXMucy5jdXJyZW50QmF0Y2hTaXplQnl0ZXMgKyBtYXhLZXlTaXplICsgYnNvblNpemUgPj0gdGhpcy5zLm1heEJhdGNoU2l6ZUJ5dGVzKSB8fFxuICAgICAgICAgICAgLy8gTmV3IGJhdGNoIGlmIHRoZSBuZXcgb3AgZG9lcyBub3QgaGF2ZSB0aGUgc2FtZSBvcCB0eXBlIGFzIHRoZSBjdXJyZW50IGJhdGNoXG4gICAgICAgICAgICB0aGlzLnMuY3VycmVudEJhdGNoLmJhdGNoVHlwZSAhPT0gYmF0Y2hUeXBlKSB7XG4gICAgICAgICAgICAvLyBTYXZlIHRoZSBiYXRjaCB0byB0aGUgZXhlY3V0aW9uIHN0YWNrXG4gICAgICAgICAgICB0aGlzLnMuYmF0Y2hlcy5wdXNoKHRoaXMucy5jdXJyZW50QmF0Y2gpO1xuICAgICAgICAgICAgLy8gQ3JlYXRlIGEgbmV3IGJhdGNoXG4gICAgICAgICAgICB0aGlzLnMuY3VycmVudEJhdGNoID0gbmV3IGNvbW1vbl8xLkJhdGNoKGJhdGNoVHlwZSwgdGhpcy5zLmN1cnJlbnRJbmRleCk7XG4gICAgICAgICAgICAvLyBSZXNldCB0aGUgY3VycmVudCBzaXplIHRyYWNrZXJzXG4gICAgICAgICAgICB0aGlzLnMuY3VycmVudEJhdGNoU2l6ZSA9IDA7XG4gICAgICAgICAgICB0aGlzLnMuY3VycmVudEJhdGNoU2l6ZUJ5dGVzID0gMDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoYmF0Y2hUeXBlID09PSBjb21tb25fMS5CYXRjaFR5cGUuSU5TRVJUKSB7XG4gICAgICAgICAgICB0aGlzLnMuYnVsa1Jlc3VsdC5pbnNlcnRlZElkcy5wdXNoKHtcbiAgICAgICAgICAgICAgICBpbmRleDogdGhpcy5zLmN1cnJlbnRJbmRleCxcbiAgICAgICAgICAgICAgICBfaWQ6IGRvY3VtZW50Ll9pZFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gV2UgaGF2ZSBhbiBhcnJheSBvZiBkb2N1bWVudHNcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoZG9jdW1lbnQpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdPcGVyYXRpb24gcGFzc2VkIGluIGNhbm5vdCBiZSBhbiBBcnJheScpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucy5jdXJyZW50QmF0Y2gub3JpZ2luYWxJbmRleGVzLnB1c2godGhpcy5zLmN1cnJlbnRJbmRleCk7XG4gICAgICAgIHRoaXMucy5jdXJyZW50QmF0Y2gub3BlcmF0aW9ucy5wdXNoKGRvY3VtZW50KTtcbiAgICAgICAgdGhpcy5zLmN1cnJlbnRCYXRjaFNpemUgKz0gMTtcbiAgICAgICAgdGhpcy5zLmN1cnJlbnRCYXRjaFNpemVCeXRlcyArPSBtYXhLZXlTaXplICsgYnNvblNpemU7XG4gICAgICAgIHRoaXMucy5jdXJyZW50SW5kZXggKz0gMTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxufVxuZXhwb3J0cy5PcmRlcmVkQnVsa09wZXJhdGlvbiA9IE9yZGVyZWRCdWxrT3BlcmF0aW9uO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9b3JkZXJlZC5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/bulk/ordered.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/bulk/unordered.js":
/*!************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/bulk/unordered.js ***!
  \************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.UnorderedBulkOperation = void 0;\nconst BSON = __webpack_require__(/*! ../bson */ \"(api)/../server/node_modules/mongodb/lib/bson.js\");\nconst error_1 = __webpack_require__(/*! ../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst common_1 = __webpack_require__(/*! ./common */ \"(api)/../server/node_modules/mongodb/lib/bulk/common.js\");\n/** @public */\nclass UnorderedBulkOperation extends common_1.BulkOperationBase {\n    /** @internal */\n    constructor(collection, options) {\n        super(collection, options, false);\n    }\n    handleWriteError(callback, writeResult) {\n        if (this.s.batches.length) {\n            return false;\n        }\n        return super.handleWriteError(callback, writeResult);\n    }\n    addToOperationsList(batchType, document) {\n        // Get the bsonSize\n        const bsonSize = BSON.calculateObjectSize(document, {\n            checkKeys: false,\n            // Since we don't know what the user selected for BSON options here,\n            // err on the safe side, and check the size with ignoreUndefined: false.\n            ignoreUndefined: false\n        });\n        // Throw error if the doc is bigger than the max BSON size\n        if (bsonSize >= this.s.maxBsonObjectSize) {\n            // TODO(NODE-3483): Change this to MongoBSONError\n            throw new error_1.MongoInvalidArgumentError(`Document is larger than the maximum size ${this.s.maxBsonObjectSize}`);\n        }\n        // Holds the current batch\n        this.s.currentBatch = undefined;\n        // Get the right type of batch\n        if (batchType === common_1.BatchType.INSERT) {\n            this.s.currentBatch = this.s.currentInsertBatch;\n        }\n        else if (batchType === common_1.BatchType.UPDATE) {\n            this.s.currentBatch = this.s.currentUpdateBatch;\n        }\n        else if (batchType === common_1.BatchType.DELETE) {\n            this.s.currentBatch = this.s.currentRemoveBatch;\n        }\n        const maxKeySize = this.s.maxKeySize;\n        // Create a new batch object if we don't have a current one\n        if (this.s.currentBatch == null) {\n            this.s.currentBatch = new common_1.Batch(batchType, this.s.currentIndex);\n        }\n        // Check if we need to create a new batch\n        if (\n        // New batch if we exceed the max batch op size\n        this.s.currentBatch.size + 1 >= this.s.maxWriteBatchSize ||\n            // New batch if we exceed the maxBatchSizeBytes. Only matters if batch already has a doc,\n            // since we can't sent an empty batch\n            (this.s.currentBatch.size > 0 &&\n                this.s.currentBatch.sizeBytes + maxKeySize + bsonSize >= this.s.maxBatchSizeBytes) ||\n            // New batch if the new op does not have the same op type as the current batch\n            this.s.currentBatch.batchType !== batchType) {\n            // Save the batch to the execution stack\n            this.s.batches.push(this.s.currentBatch);\n            // Create a new batch\n            this.s.currentBatch = new common_1.Batch(batchType, this.s.currentIndex);\n        }\n        // We have an array of documents\n        if (Array.isArray(document)) {\n            throw new error_1.MongoInvalidArgumentError('Operation passed in cannot be an Array');\n        }\n        this.s.currentBatch.operations.push(document);\n        this.s.currentBatch.originalIndexes.push(this.s.currentIndex);\n        this.s.currentIndex = this.s.currentIndex + 1;\n        // Save back the current Batch to the right type\n        if (batchType === common_1.BatchType.INSERT) {\n            this.s.currentInsertBatch = this.s.currentBatch;\n            this.s.bulkResult.insertedIds.push({\n                index: this.s.bulkResult.insertedIds.length,\n                _id: document._id\n            });\n        }\n        else if (batchType === common_1.BatchType.UPDATE) {\n            this.s.currentUpdateBatch = this.s.currentBatch;\n        }\n        else if (batchType === common_1.BatchType.DELETE) {\n            this.s.currentRemoveBatch = this.s.currentBatch;\n        }\n        // Update current batch size\n        this.s.currentBatch.size += 1;\n        this.s.currentBatch.sizeBytes += maxKeySize + bsonSize;\n        return this;\n    }\n}\nexports.UnorderedBulkOperation = UnorderedBulkOperation;\n//# sourceMappingURL=unordered.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9idWxrL3Vub3JkZXJlZC5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCw4QkFBOEI7QUFDOUIsYUFBYSxtQkFBTyxDQUFDLGlFQUFTO0FBQzlCLGdCQUFnQixtQkFBTyxDQUFDLG1FQUFVO0FBQ2xDLGlCQUFpQixtQkFBTyxDQUFDLHlFQUFVO0FBQ25DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLG9HQUFvRyx5QkFBeUI7QUFDN0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFBOEI7QUFDOUIiLCJzb3VyY2VzIjpbIkQ6XFxzYWxvbmlcXGFwcHJhaXNhbC1zeXN0ZW1cXHNlcnZlclxcbm9kZV9tb2R1bGVzXFxtb25nb2RiXFxsaWJcXGJ1bGtcXHVub3JkZXJlZC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuVW5vcmRlcmVkQnVsa09wZXJhdGlvbiA9IHZvaWQgMDtcbmNvbnN0IEJTT04gPSByZXF1aXJlKFwiLi4vYnNvblwiKTtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi4vZXJyb3JcIik7XG5jb25zdCBjb21tb25fMSA9IHJlcXVpcmUoXCIuL2NvbW1vblwiKTtcbi8qKiBAcHVibGljICovXG5jbGFzcyBVbm9yZGVyZWRCdWxrT3BlcmF0aW9uIGV4dGVuZHMgY29tbW9uXzEuQnVsa09wZXJhdGlvbkJhc2Uge1xuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBjb25zdHJ1Y3Rvcihjb2xsZWN0aW9uLCBvcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKGNvbGxlY3Rpb24sIG9wdGlvbnMsIGZhbHNlKTtcbiAgICB9XG4gICAgaGFuZGxlV3JpdGVFcnJvcihjYWxsYmFjaywgd3JpdGVSZXN1bHQpIHtcbiAgICAgICAgaWYgKHRoaXMucy5iYXRjaGVzLmxlbmd0aCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzdXBlci5oYW5kbGVXcml0ZUVycm9yKGNhbGxiYWNrLCB3cml0ZVJlc3VsdCk7XG4gICAgfVxuICAgIGFkZFRvT3BlcmF0aW9uc0xpc3QoYmF0Y2hUeXBlLCBkb2N1bWVudCkge1xuICAgICAgICAvLyBHZXQgdGhlIGJzb25TaXplXG4gICAgICAgIGNvbnN0IGJzb25TaXplID0gQlNPTi5jYWxjdWxhdGVPYmplY3RTaXplKGRvY3VtZW50LCB7XG4gICAgICAgICAgICBjaGVja0tleXM6IGZhbHNlLFxuICAgICAgICAgICAgLy8gU2luY2Ugd2UgZG9uJ3Qga25vdyB3aGF0IHRoZSB1c2VyIHNlbGVjdGVkIGZvciBCU09OIG9wdGlvbnMgaGVyZSxcbiAgICAgICAgICAgIC8vIGVyciBvbiB0aGUgc2FmZSBzaWRlLCBhbmQgY2hlY2sgdGhlIHNpemUgd2l0aCBpZ25vcmVVbmRlZmluZWQ6IGZhbHNlLlxuICAgICAgICAgICAgaWdub3JlVW5kZWZpbmVkOiBmYWxzZVxuICAgICAgICB9KTtcbiAgICAgICAgLy8gVGhyb3cgZXJyb3IgaWYgdGhlIGRvYyBpcyBiaWdnZXIgdGhhbiB0aGUgbWF4IEJTT04gc2l6ZVxuICAgICAgICBpZiAoYnNvblNpemUgPj0gdGhpcy5zLm1heEJzb25PYmplY3RTaXplKSB7XG4gICAgICAgICAgICAvLyBUT0RPKE5PREUtMzQ4Myk6IENoYW5nZSB0aGlzIHRvIE1vbmdvQlNPTkVycm9yXG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKGBEb2N1bWVudCBpcyBsYXJnZXIgdGhhbiB0aGUgbWF4aW11bSBzaXplICR7dGhpcy5zLm1heEJzb25PYmplY3RTaXplfWApO1xuICAgICAgICB9XG4gICAgICAgIC8vIEhvbGRzIHRoZSBjdXJyZW50IGJhdGNoXG4gICAgICAgIHRoaXMucy5jdXJyZW50QmF0Y2ggPSB1bmRlZmluZWQ7XG4gICAgICAgIC8vIEdldCB0aGUgcmlnaHQgdHlwZSBvZiBiYXRjaFxuICAgICAgICBpZiAoYmF0Y2hUeXBlID09PSBjb21tb25fMS5CYXRjaFR5cGUuSU5TRVJUKSB7XG4gICAgICAgICAgICB0aGlzLnMuY3VycmVudEJhdGNoID0gdGhpcy5zLmN1cnJlbnRJbnNlcnRCYXRjaDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChiYXRjaFR5cGUgPT09IGNvbW1vbl8xLkJhdGNoVHlwZS5VUERBVEUpIHtcbiAgICAgICAgICAgIHRoaXMucy5jdXJyZW50QmF0Y2ggPSB0aGlzLnMuY3VycmVudFVwZGF0ZUJhdGNoO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGJhdGNoVHlwZSA9PT0gY29tbW9uXzEuQmF0Y2hUeXBlLkRFTEVURSkge1xuICAgICAgICAgICAgdGhpcy5zLmN1cnJlbnRCYXRjaCA9IHRoaXMucy5jdXJyZW50UmVtb3ZlQmF0Y2g7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbWF4S2V5U2l6ZSA9IHRoaXMucy5tYXhLZXlTaXplO1xuICAgICAgICAvLyBDcmVhdGUgYSBuZXcgYmF0Y2ggb2JqZWN0IGlmIHdlIGRvbid0IGhhdmUgYSBjdXJyZW50IG9uZVxuICAgICAgICBpZiAodGhpcy5zLmN1cnJlbnRCYXRjaCA9PSBudWxsKSB7XG4gICAgICAgICAgICB0aGlzLnMuY3VycmVudEJhdGNoID0gbmV3IGNvbW1vbl8xLkJhdGNoKGJhdGNoVHlwZSwgdGhpcy5zLmN1cnJlbnRJbmRleCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gQ2hlY2sgaWYgd2UgbmVlZCB0byBjcmVhdGUgYSBuZXcgYmF0Y2hcbiAgICAgICAgaWYgKFxuICAgICAgICAvLyBOZXcgYmF0Y2ggaWYgd2UgZXhjZWVkIHRoZSBtYXggYmF0Y2ggb3Agc2l6ZVxuICAgICAgICB0aGlzLnMuY3VycmVudEJhdGNoLnNpemUgKyAxID49IHRoaXMucy5tYXhXcml0ZUJhdGNoU2l6ZSB8fFxuICAgICAgICAgICAgLy8gTmV3IGJhdGNoIGlmIHdlIGV4Y2VlZCB0aGUgbWF4QmF0Y2hTaXplQnl0ZXMuIE9ubHkgbWF0dGVycyBpZiBiYXRjaCBhbHJlYWR5IGhhcyBhIGRvYyxcbiAgICAgICAgICAgIC8vIHNpbmNlIHdlIGNhbid0IHNlbnQgYW4gZW1wdHkgYmF0Y2hcbiAgICAgICAgICAgICh0aGlzLnMuY3VycmVudEJhdGNoLnNpemUgPiAwICYmXG4gICAgICAgICAgICAgICAgdGhpcy5zLmN1cnJlbnRCYXRjaC5zaXplQnl0ZXMgKyBtYXhLZXlTaXplICsgYnNvblNpemUgPj0gdGhpcy5zLm1heEJhdGNoU2l6ZUJ5dGVzKSB8fFxuICAgICAgICAgICAgLy8gTmV3IGJhdGNoIGlmIHRoZSBuZXcgb3AgZG9lcyBub3QgaGF2ZSB0aGUgc2FtZSBvcCB0eXBlIGFzIHRoZSBjdXJyZW50IGJhdGNoXG4gICAgICAgICAgICB0aGlzLnMuY3VycmVudEJhdGNoLmJhdGNoVHlwZSAhPT0gYmF0Y2hUeXBlKSB7XG4gICAgICAgICAgICAvLyBTYXZlIHRoZSBiYXRjaCB0byB0aGUgZXhlY3V0aW9uIHN0YWNrXG4gICAgICAgICAgICB0aGlzLnMuYmF0Y2hlcy5wdXNoKHRoaXMucy5jdXJyZW50QmF0Y2gpO1xuICAgICAgICAgICAgLy8gQ3JlYXRlIGEgbmV3IGJhdGNoXG4gICAgICAgICAgICB0aGlzLnMuY3VycmVudEJhdGNoID0gbmV3IGNvbW1vbl8xLkJhdGNoKGJhdGNoVHlwZSwgdGhpcy5zLmN1cnJlbnRJbmRleCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gV2UgaGF2ZSBhbiBhcnJheSBvZiBkb2N1bWVudHNcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoZG9jdW1lbnQpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdPcGVyYXRpb24gcGFzc2VkIGluIGNhbm5vdCBiZSBhbiBBcnJheScpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucy5jdXJyZW50QmF0Y2gub3BlcmF0aW9ucy5wdXNoKGRvY3VtZW50KTtcbiAgICAgICAgdGhpcy5zLmN1cnJlbnRCYXRjaC5vcmlnaW5hbEluZGV4ZXMucHVzaCh0aGlzLnMuY3VycmVudEluZGV4KTtcbiAgICAgICAgdGhpcy5zLmN1cnJlbnRJbmRleCA9IHRoaXMucy5jdXJyZW50SW5kZXggKyAxO1xuICAgICAgICAvLyBTYXZlIGJhY2sgdGhlIGN1cnJlbnQgQmF0Y2ggdG8gdGhlIHJpZ2h0IHR5cGVcbiAgICAgICAgaWYgKGJhdGNoVHlwZSA9PT0gY29tbW9uXzEuQmF0Y2hUeXBlLklOU0VSVCkge1xuICAgICAgICAgICAgdGhpcy5zLmN1cnJlbnRJbnNlcnRCYXRjaCA9IHRoaXMucy5jdXJyZW50QmF0Y2g7XG4gICAgICAgICAgICB0aGlzLnMuYnVsa1Jlc3VsdC5pbnNlcnRlZElkcy5wdXNoKHtcbiAgICAgICAgICAgICAgICBpbmRleDogdGhpcy5zLmJ1bGtSZXN1bHQuaW5zZXJ0ZWRJZHMubGVuZ3RoLFxuICAgICAgICAgICAgICAgIF9pZDogZG9jdW1lbnQuX2lkXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChiYXRjaFR5cGUgPT09IGNvbW1vbl8xLkJhdGNoVHlwZS5VUERBVEUpIHtcbiAgICAgICAgICAgIHRoaXMucy5jdXJyZW50VXBkYXRlQmF0Y2ggPSB0aGlzLnMuY3VycmVudEJhdGNoO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGJhdGNoVHlwZSA9PT0gY29tbW9uXzEuQmF0Y2hUeXBlLkRFTEVURSkge1xuICAgICAgICAgICAgdGhpcy5zLmN1cnJlbnRSZW1vdmVCYXRjaCA9IHRoaXMucy5jdXJyZW50QmF0Y2g7XG4gICAgICAgIH1cbiAgICAgICAgLy8gVXBkYXRlIGN1cnJlbnQgYmF0Y2ggc2l6ZVxuICAgICAgICB0aGlzLnMuY3VycmVudEJhdGNoLnNpemUgKz0gMTtcbiAgICAgICAgdGhpcy5zLmN1cnJlbnRCYXRjaC5zaXplQnl0ZXMgKz0gbWF4S2V5U2l6ZSArIGJzb25TaXplO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG59XG5leHBvcnRzLlVub3JkZXJlZEJ1bGtPcGVyYXRpb24gPSBVbm9yZGVyZWRCdWxrT3BlcmF0aW9uO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9dW5vcmRlcmVkLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/bulk/unordered.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/change_stream.js":
/*!***********************************************************!*\
  !*** ../server/node_modules/mongodb/lib/change_stream.js ***!
  \***********************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.ChangeStream = void 0;\nconst collection_1 = __webpack_require__(/*! ./collection */ \"(api)/../server/node_modules/mongodb/lib/collection.js\");\nconst constants_1 = __webpack_require__(/*! ./constants */ \"(api)/../server/node_modules/mongodb/lib/constants.js\");\nconst change_stream_cursor_1 = __webpack_require__(/*! ./cursor/change_stream_cursor */ \"(api)/../server/node_modules/mongodb/lib/cursor/change_stream_cursor.js\");\nconst db_1 = __webpack_require__(/*! ./db */ \"(api)/../server/node_modules/mongodb/lib/db.js\");\nconst error_1 = __webpack_require__(/*! ./error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst mongo_client_1 = __webpack_require__(/*! ./mongo_client */ \"(api)/../server/node_modules/mongodb/lib/mongo_client.js\");\nconst mongo_types_1 = __webpack_require__(/*! ./mongo_types */ \"(api)/../server/node_modules/mongodb/lib/mongo_types.js\");\nconst utils_1 = __webpack_require__(/*! ./utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\n/** @internal */\nconst kCursorStream = Symbol('cursorStream');\n/** @internal */\nconst kClosed = Symbol('closed');\n/** @internal */\nconst kMode = Symbol('mode');\nconst CHANGE_STREAM_OPTIONS = [\n    'resumeAfter',\n    'startAfter',\n    'startAtOperationTime',\n    'fullDocument',\n    'fullDocumentBeforeChange',\n    'showExpandedEvents'\n];\nconst CHANGE_DOMAIN_TYPES = {\n    COLLECTION: Symbol('Collection'),\n    DATABASE: Symbol('Database'),\n    CLUSTER: Symbol('Cluster')\n};\nconst CHANGE_STREAM_EVENTS = [constants_1.RESUME_TOKEN_CHANGED, constants_1.END, constants_1.CLOSE];\nconst NO_RESUME_TOKEN_ERROR = 'A change stream document has been received that lacks a resume token (_id).';\nconst CHANGESTREAM_CLOSED_ERROR = 'ChangeStream is closed';\n/**\n * Creates a new Change Stream instance. Normally created using {@link Collection#watch|Collection.watch()}.\n * @public\n */\nclass ChangeStream extends mongo_types_1.TypedEventEmitter {\n    /**\n     * @internal\n     *\n     * @param parent - The parent object that created this change stream\n     * @param pipeline - An array of {@link https://www.mongodb.com/docs/manual/reference/operator/aggregation-pipeline/|aggregation pipeline stages} through which to pass change stream documents\n     */\n    constructor(parent, pipeline = [], options = {}) {\n        super();\n        this.pipeline = pipeline;\n        this.options = { ...options };\n        delete this.options.writeConcern;\n        if (parent instanceof collection_1.Collection) {\n            this.type = CHANGE_DOMAIN_TYPES.COLLECTION;\n        }\n        else if (parent instanceof db_1.Db) {\n            this.type = CHANGE_DOMAIN_TYPES.DATABASE;\n        }\n        else if (parent instanceof mongo_client_1.MongoClient) {\n            this.type = CHANGE_DOMAIN_TYPES.CLUSTER;\n        }\n        else {\n            throw new error_1.MongoChangeStreamError('Parent provided to ChangeStream constructor must be an instance of Collection, Db, or MongoClient');\n        }\n        this.parent = parent;\n        this.namespace = parent.s.namespace;\n        if (!this.options.readPreference && parent.readPreference) {\n            this.options.readPreference = parent.readPreference;\n        }\n        // Create contained Change Stream cursor\n        this.cursor = this._createChangeStreamCursor(options);\n        this[kClosed] = false;\n        this[kMode] = false;\n        // Listen for any `change` listeners being added to ChangeStream\n        this.on('newListener', eventName => {\n            if (eventName === 'change' && this.cursor && this.listenerCount('change') === 0) {\n                this._streamEvents(this.cursor);\n            }\n        });\n        this.on('removeListener', eventName => {\n            if (eventName === 'change' && this.listenerCount('change') === 0 && this.cursor) {\n                this[kCursorStream]?.removeAllListeners('data');\n            }\n        });\n    }\n    /** @internal */\n    get cursorStream() {\n        return this[kCursorStream];\n    }\n    /** The cached resume token that is used to resume after the most recently returned change. */\n    get resumeToken() {\n        return this.cursor?.resumeToken;\n    }\n    /** Check if there is any document still available in the Change Stream */\n    async hasNext() {\n        this._setIsIterator();\n        // Change streams must resume indefinitely while each resume event succeeds.\n        // This loop continues until either a change event is received or until a resume attempt\n        // fails.\n        // eslint-disable-next-line no-constant-condition\n        while (true) {\n            try {\n                const hasNext = await this.cursor.hasNext();\n                return hasNext;\n            }\n            catch (error) {\n                try {\n                    await this._processErrorIteratorMode(error);\n                }\n                catch (error) {\n                    try {\n                        await this.close();\n                    }\n                    catch {\n                        // We are not concerned with errors from close()\n                    }\n                    throw error;\n                }\n            }\n        }\n    }\n    /** Get the next available document from the Change Stream. */\n    async next() {\n        this._setIsIterator();\n        // Change streams must resume indefinitely while each resume event succeeds.\n        // This loop continues until either a change event is received or until a resume attempt\n        // fails.\n        // eslint-disable-next-line no-constant-condition\n        while (true) {\n            try {\n                const change = await this.cursor.next();\n                const processedChange = this._processChange(change ?? null);\n                return processedChange;\n            }\n            catch (error) {\n                try {\n                    await this._processErrorIteratorMode(error);\n                }\n                catch (error) {\n                    try {\n                        await this.close();\n                    }\n                    catch {\n                        // We are not concerned with errors from close()\n                    }\n                    throw error;\n                }\n            }\n        }\n    }\n    /**\n     * Try to get the next available document from the Change Stream's cursor or `null` if an empty batch is returned\n     */\n    async tryNext() {\n        this._setIsIterator();\n        // Change streams must resume indefinitely while each resume event succeeds.\n        // This loop continues until either a change event is received or until a resume attempt\n        // fails.\n        // eslint-disable-next-line no-constant-condition\n        while (true) {\n            try {\n                const change = await this.cursor.tryNext();\n                return change ?? null;\n            }\n            catch (error) {\n                try {\n                    await this._processErrorIteratorMode(error);\n                }\n                catch (error) {\n                    try {\n                        await this.close();\n                    }\n                    catch {\n                        // We are not concerned with errors from close()\n                    }\n                    throw error;\n                }\n            }\n        }\n    }\n    async *[Symbol.asyncIterator]() {\n        if (this.closed) {\n            return;\n        }\n        try {\n            // Change streams run indefinitely as long as errors are resumable\n            // So the only loop breaking condition is if `next()` throws\n            while (true) {\n                yield await this.next();\n            }\n        }\n        finally {\n            try {\n                await this.close();\n            }\n            catch {\n                // we're not concerned with errors from close()\n            }\n        }\n    }\n    /** Is the cursor closed */\n    get closed() {\n        return this[kClosed] || this.cursor.closed;\n    }\n    /** Close the Change Stream */\n    async close() {\n        this[kClosed] = true;\n        const cursor = this.cursor;\n        try {\n            await cursor.close();\n        }\n        finally {\n            this._endStream();\n        }\n    }\n    /**\n     * Return a modified Readable stream including a possible transform method.\n     *\n     * NOTE: When using a Stream to process change stream events, the stream will\n     * NOT automatically resume in the case a resumable error is encountered.\n     *\n     * @throws MongoChangeStreamError if the underlying cursor or the change stream is closed\n     */\n    stream(options) {\n        if (this.closed) {\n            throw new error_1.MongoChangeStreamError(CHANGESTREAM_CLOSED_ERROR);\n        }\n        this.streamOptions = options;\n        return this.cursor.stream(options);\n    }\n    /** @internal */\n    _setIsEmitter() {\n        if (this[kMode] === 'iterator') {\n            // TODO(NODE-3485): Replace with MongoChangeStreamModeError\n            throw new error_1.MongoAPIError('ChangeStream cannot be used as an EventEmitter after being used as an iterator');\n        }\n        this[kMode] = 'emitter';\n    }\n    /** @internal */\n    _setIsIterator() {\n        if (this[kMode] === 'emitter') {\n            // TODO(NODE-3485): Replace with MongoChangeStreamModeError\n            throw new error_1.MongoAPIError('ChangeStream cannot be used as an iterator after being used as an EventEmitter');\n        }\n        this[kMode] = 'iterator';\n    }\n    /**\n     * Create a new change stream cursor based on self's configuration\n     * @internal\n     */\n    _createChangeStreamCursor(options) {\n        const changeStreamStageOptions = (0, utils_1.filterOptions)(options, CHANGE_STREAM_OPTIONS);\n        if (this.type === CHANGE_DOMAIN_TYPES.CLUSTER) {\n            changeStreamStageOptions.allChangesForCluster = true;\n        }\n        const pipeline = [{ $changeStream: changeStreamStageOptions }, ...this.pipeline];\n        const client = this.type === CHANGE_DOMAIN_TYPES.CLUSTER\n            ? this.parent\n            : this.type === CHANGE_DOMAIN_TYPES.DATABASE\n                ? this.parent.client\n                : this.type === CHANGE_DOMAIN_TYPES.COLLECTION\n                    ? this.parent.client\n                    : null;\n        if (client == null) {\n            // This should never happen because of the assertion in the constructor\n            throw new error_1.MongoRuntimeError(`Changestream type should only be one of cluster, database, collection. Found ${this.type.toString()}`);\n        }\n        const changeStreamCursor = new change_stream_cursor_1.ChangeStreamCursor(client, this.namespace, pipeline, options);\n        for (const event of CHANGE_STREAM_EVENTS) {\n            changeStreamCursor.on(event, e => this.emit(event, e));\n        }\n        if (this.listenerCount(ChangeStream.CHANGE) > 0) {\n            this._streamEvents(changeStreamCursor);\n        }\n        return changeStreamCursor;\n    }\n    /** @internal */\n    _closeEmitterModeWithError(error) {\n        this.emit(ChangeStream.ERROR, error);\n        this.close().catch(() => null);\n    }\n    /** @internal */\n    _streamEvents(cursor) {\n        this._setIsEmitter();\n        const stream = this[kCursorStream] ?? cursor.stream();\n        this[kCursorStream] = stream;\n        stream.on('data', change => {\n            try {\n                const processedChange = this._processChange(change);\n                this.emit(ChangeStream.CHANGE, processedChange);\n            }\n            catch (error) {\n                this.emit(ChangeStream.ERROR, error);\n            }\n        });\n        stream.on('error', error => this._processErrorStreamMode(error));\n    }\n    /** @internal */\n    _endStream() {\n        const cursorStream = this[kCursorStream];\n        if (cursorStream) {\n            ['data', 'close', 'end', 'error'].forEach(event => cursorStream.removeAllListeners(event));\n            cursorStream.destroy();\n        }\n        this[kCursorStream] = undefined;\n    }\n    /** @internal */\n    _processChange(change) {\n        if (this[kClosed]) {\n            // TODO(NODE-3485): Replace with MongoChangeStreamClosedError\n            throw new error_1.MongoAPIError(CHANGESTREAM_CLOSED_ERROR);\n        }\n        // a null change means the cursor has been notified, implicitly closing the change stream\n        if (change == null) {\n            // TODO(NODE-3485): Replace with MongoChangeStreamClosedError\n            throw new error_1.MongoRuntimeError(CHANGESTREAM_CLOSED_ERROR);\n        }\n        if (change && !change._id) {\n            throw new error_1.MongoChangeStreamError(NO_RESUME_TOKEN_ERROR);\n        }\n        // cache the resume token\n        this.cursor.cacheResumeToken(change._id);\n        // wipe the startAtOperationTime if there was one so that there won't be a conflict\n        // between resumeToken and startAtOperationTime if we need to reconnect the cursor\n        this.options.startAtOperationTime = undefined;\n        return change;\n    }\n    /** @internal */\n    _processErrorStreamMode(changeStreamError) {\n        // If the change stream has been closed explicitly, do not process error.\n        if (this[kClosed])\n            return;\n        if ((0, error_1.isResumableError)(changeStreamError, this.cursor.maxWireVersion)) {\n            this._endStream();\n            this.cursor.close().catch(() => null);\n            const topology = (0, utils_1.getTopology)(this.parent);\n            topology.selectServer(this.cursor.readPreference, {}, serverSelectionError => {\n                if (serverSelectionError)\n                    return this._closeEmitterModeWithError(changeStreamError);\n                this.cursor = this._createChangeStreamCursor(this.cursor.resumeOptions);\n            });\n        }\n        else {\n            this._closeEmitterModeWithError(changeStreamError);\n        }\n    }\n    /** @internal */\n    async _processErrorIteratorMode(changeStreamError) {\n        if (this[kClosed]) {\n            // TODO(NODE-3485): Replace with MongoChangeStreamClosedError\n            throw new error_1.MongoAPIError(CHANGESTREAM_CLOSED_ERROR);\n        }\n        if (!(0, error_1.isResumableError)(changeStreamError, this.cursor.maxWireVersion)) {\n            try {\n                await this.close();\n            }\n            catch {\n                // ignore errors from close\n            }\n            throw changeStreamError;\n        }\n        await this.cursor.close().catch(() => null);\n        const topology = (0, utils_1.getTopology)(this.parent);\n        try {\n            await topology.selectServerAsync(this.cursor.readPreference, {});\n            this.cursor = this._createChangeStreamCursor(this.cursor.resumeOptions);\n        }\n        catch {\n            // if the topology can't reconnect, close the stream\n            await this.close();\n            throw changeStreamError;\n        }\n    }\n}\n/** @event */\nChangeStream.RESPONSE = constants_1.RESPONSE;\n/** @event */\nChangeStream.MORE = constants_1.MORE;\n/** @event */\nChangeStream.INIT = constants_1.INIT;\n/** @event */\nChangeStream.CLOSE = constants_1.CLOSE;\n/**\n * Fired for each new matching change in the specified namespace. Attaching a `change`\n * event listener to a Change Stream will switch the stream into flowing mode. Data will\n * then be passed as soon as it is available.\n * @event\n */\nChangeStream.CHANGE = constants_1.CHANGE;\n/** @event */\nChangeStream.END = constants_1.END;\n/** @event */\nChangeStream.ERROR = constants_1.ERROR;\n/**\n * Emitted each time the change stream stores a new resume token.\n * @event\n */\nChangeStream.RESUME_TOKEN_CHANGED = constants_1.RESUME_TOKEN_CHANGED;\nexports.ChangeStream = ChangeStream;\n//# sourceMappingURL=change_stream.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jaGFuZ2Vfc3RyZWFtLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELG9CQUFvQjtBQUNwQixxQkFBcUIsbUJBQU8sQ0FBQyw0RUFBYztBQUMzQyxvQkFBb0IsbUJBQU8sQ0FBQywwRUFBYTtBQUN6QywrQkFBK0IsbUJBQU8sQ0FBQyw4R0FBK0I7QUFDdEUsYUFBYSxtQkFBTyxDQUFDLDREQUFNO0FBQzNCLGdCQUFnQixtQkFBTyxDQUFDLGtFQUFTO0FBQ2pDLHVCQUF1QixtQkFBTyxDQUFDLGdGQUFnQjtBQUMvQyxzQkFBc0IsbUJBQU8sQ0FBQyw4RUFBZTtBQUM3QyxnQkFBZ0IsbUJBQU8sQ0FBQyxrRUFBUztBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUVBQWlFLDBDQUEwQztBQUMzRztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNDQUFzQyxnSEFBZ0g7QUFDdEo7QUFDQSxtREFBbUQ7QUFDbkQ7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLHlDQUF5QztBQUNyRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnSUFBZ0kscUJBQXFCO0FBQ3JKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnRUFBZ0U7QUFDaEU7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyRUFBMkU7QUFDM0U7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CO0FBQ3BCIiwic291cmNlcyI6WyJEOlxcc2Fsb25pXFxhcHByYWlzYWwtc3lzdGVtXFxzZXJ2ZXJcXG5vZGVfbW9kdWxlc1xcbW9uZ29kYlxcbGliXFxjaGFuZ2Vfc3RyZWFtLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5DaGFuZ2VTdHJlYW0gPSB2b2lkIDA7XG5jb25zdCBjb2xsZWN0aW9uXzEgPSByZXF1aXJlKFwiLi9jb2xsZWN0aW9uXCIpO1xuY29uc3QgY29uc3RhbnRzXzEgPSByZXF1aXJlKFwiLi9jb25zdGFudHNcIik7XG5jb25zdCBjaGFuZ2Vfc3RyZWFtX2N1cnNvcl8xID0gcmVxdWlyZShcIi4vY3Vyc29yL2NoYW5nZV9zdHJlYW1fY3Vyc29yXCIpO1xuY29uc3QgZGJfMSA9IHJlcXVpcmUoXCIuL2RiXCIpO1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuL2Vycm9yXCIpO1xuY29uc3QgbW9uZ29fY2xpZW50XzEgPSByZXF1aXJlKFwiLi9tb25nb19jbGllbnRcIik7XG5jb25zdCBtb25nb190eXBlc18xID0gcmVxdWlyZShcIi4vbW9uZ29fdHlwZXNcIik7XG5jb25zdCB1dGlsc18xID0gcmVxdWlyZShcIi4vdXRpbHNcIik7XG4vKiogQGludGVybmFsICovXG5jb25zdCBrQ3Vyc29yU3RyZWFtID0gU3ltYm9sKCdjdXJzb3JTdHJlYW0nKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNvbnN0IGtDbG9zZWQgPSBTeW1ib2woJ2Nsb3NlZCcpO1xuLyoqIEBpbnRlcm5hbCAqL1xuY29uc3Qga01vZGUgPSBTeW1ib2woJ21vZGUnKTtcbmNvbnN0IENIQU5HRV9TVFJFQU1fT1BUSU9OUyA9IFtcbiAgICAncmVzdW1lQWZ0ZXInLFxuICAgICdzdGFydEFmdGVyJyxcbiAgICAnc3RhcnRBdE9wZXJhdGlvblRpbWUnLFxuICAgICdmdWxsRG9jdW1lbnQnLFxuICAgICdmdWxsRG9jdW1lbnRCZWZvcmVDaGFuZ2UnLFxuICAgICdzaG93RXhwYW5kZWRFdmVudHMnXG5dO1xuY29uc3QgQ0hBTkdFX0RPTUFJTl9UWVBFUyA9IHtcbiAgICBDT0xMRUNUSU9OOiBTeW1ib2woJ0NvbGxlY3Rpb24nKSxcbiAgICBEQVRBQkFTRTogU3ltYm9sKCdEYXRhYmFzZScpLFxuICAgIENMVVNURVI6IFN5bWJvbCgnQ2x1c3RlcicpXG59O1xuY29uc3QgQ0hBTkdFX1NUUkVBTV9FVkVOVFMgPSBbY29uc3RhbnRzXzEuUkVTVU1FX1RPS0VOX0NIQU5HRUQsIGNvbnN0YW50c18xLkVORCwgY29uc3RhbnRzXzEuQ0xPU0VdO1xuY29uc3QgTk9fUkVTVU1FX1RPS0VOX0VSUk9SID0gJ0EgY2hhbmdlIHN0cmVhbSBkb2N1bWVudCBoYXMgYmVlbiByZWNlaXZlZCB0aGF0IGxhY2tzIGEgcmVzdW1lIHRva2VuIChfaWQpLic7XG5jb25zdCBDSEFOR0VTVFJFQU1fQ0xPU0VEX0VSUk9SID0gJ0NoYW5nZVN0cmVhbSBpcyBjbG9zZWQnO1xuLyoqXG4gKiBDcmVhdGVzIGEgbmV3IENoYW5nZSBTdHJlYW0gaW5zdGFuY2UuIE5vcm1hbGx5IGNyZWF0ZWQgdXNpbmcge0BsaW5rIENvbGxlY3Rpb24jd2F0Y2h8Q29sbGVjdGlvbi53YXRjaCgpfS5cbiAqIEBwdWJsaWNcbiAqL1xuY2xhc3MgQ2hhbmdlU3RyZWFtIGV4dGVuZHMgbW9uZ29fdHlwZXNfMS5UeXBlZEV2ZW50RW1pdHRlciB7XG4gICAgLyoqXG4gICAgICogQGludGVybmFsXG4gICAgICpcbiAgICAgKiBAcGFyYW0gcGFyZW50IC0gVGhlIHBhcmVudCBvYmplY3QgdGhhdCBjcmVhdGVkIHRoaXMgY2hhbmdlIHN0cmVhbVxuICAgICAqIEBwYXJhbSBwaXBlbGluZSAtIEFuIGFycmF5IG9mIHtAbGluayBodHRwczovL3d3dy5tb25nb2RiLmNvbS9kb2NzL21hbnVhbC9yZWZlcmVuY2Uvb3BlcmF0b3IvYWdncmVnYXRpb24tcGlwZWxpbmUvfGFnZ3JlZ2F0aW9uIHBpcGVsaW5lIHN0YWdlc30gdGhyb3VnaCB3aGljaCB0byBwYXNzIGNoYW5nZSBzdHJlYW0gZG9jdW1lbnRzXG4gICAgICovXG4gICAgY29uc3RydWN0b3IocGFyZW50LCBwaXBlbGluZSA9IFtdLCBvcHRpb25zID0ge30pIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5waXBlbGluZSA9IHBpcGVsaW5lO1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSB7IC4uLm9wdGlvbnMgfTtcbiAgICAgICAgZGVsZXRlIHRoaXMub3B0aW9ucy53cml0ZUNvbmNlcm47XG4gICAgICAgIGlmIChwYXJlbnQgaW5zdGFuY2VvZiBjb2xsZWN0aW9uXzEuQ29sbGVjdGlvbikge1xuICAgICAgICAgICAgdGhpcy50eXBlID0gQ0hBTkdFX0RPTUFJTl9UWVBFUy5DT0xMRUNUSU9OO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHBhcmVudCBpbnN0YW5jZW9mIGRiXzEuRGIpIHtcbiAgICAgICAgICAgIHRoaXMudHlwZSA9IENIQU5HRV9ET01BSU5fVFlQRVMuREFUQUJBU0U7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAocGFyZW50IGluc3RhbmNlb2YgbW9uZ29fY2xpZW50XzEuTW9uZ29DbGllbnQpIHtcbiAgICAgICAgICAgIHRoaXMudHlwZSA9IENIQU5HRV9ET01BSU5fVFlQRVMuQ0xVU1RFUjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvQ2hhbmdlU3RyZWFtRXJyb3IoJ1BhcmVudCBwcm92aWRlZCB0byBDaGFuZ2VTdHJlYW0gY29uc3RydWN0b3IgbXVzdCBiZSBhbiBpbnN0YW5jZSBvZiBDb2xsZWN0aW9uLCBEYiwgb3IgTW9uZ29DbGllbnQnKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnBhcmVudCA9IHBhcmVudDtcbiAgICAgICAgdGhpcy5uYW1lc3BhY2UgPSBwYXJlbnQucy5uYW1lc3BhY2U7XG4gICAgICAgIGlmICghdGhpcy5vcHRpb25zLnJlYWRQcmVmZXJlbmNlICYmIHBhcmVudC5yZWFkUHJlZmVyZW5jZSkge1xuICAgICAgICAgICAgdGhpcy5vcHRpb25zLnJlYWRQcmVmZXJlbmNlID0gcGFyZW50LnJlYWRQcmVmZXJlbmNlO1xuICAgICAgICB9XG4gICAgICAgIC8vIENyZWF0ZSBjb250YWluZWQgQ2hhbmdlIFN0cmVhbSBjdXJzb3JcbiAgICAgICAgdGhpcy5jdXJzb3IgPSB0aGlzLl9jcmVhdGVDaGFuZ2VTdHJlYW1DdXJzb3Iob3B0aW9ucyk7XG4gICAgICAgIHRoaXNba0Nsb3NlZF0gPSBmYWxzZTtcbiAgICAgICAgdGhpc1trTW9kZV0gPSBmYWxzZTtcbiAgICAgICAgLy8gTGlzdGVuIGZvciBhbnkgYGNoYW5nZWAgbGlzdGVuZXJzIGJlaW5nIGFkZGVkIHRvIENoYW5nZVN0cmVhbVxuICAgICAgICB0aGlzLm9uKCduZXdMaXN0ZW5lcicsIGV2ZW50TmFtZSA9PiB7XG4gICAgICAgICAgICBpZiAoZXZlbnROYW1lID09PSAnY2hhbmdlJyAmJiB0aGlzLmN1cnNvciAmJiB0aGlzLmxpc3RlbmVyQ291bnQoJ2NoYW5nZScpID09PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fc3RyZWFtRXZlbnRzKHRoaXMuY3Vyc29yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMub24oJ3JlbW92ZUxpc3RlbmVyJywgZXZlbnROYW1lID0+IHtcbiAgICAgICAgICAgIGlmIChldmVudE5hbWUgPT09ICdjaGFuZ2UnICYmIHRoaXMubGlzdGVuZXJDb3VudCgnY2hhbmdlJykgPT09IDAgJiYgdGhpcy5jdXJzb3IpIHtcbiAgICAgICAgICAgICAgICB0aGlzW2tDdXJzb3JTdHJlYW1dPy5yZW1vdmVBbGxMaXN0ZW5lcnMoJ2RhdGEnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBnZXQgY3Vyc29yU3RyZWFtKCkge1xuICAgICAgICByZXR1cm4gdGhpc1trQ3Vyc29yU3RyZWFtXTtcbiAgICB9XG4gICAgLyoqIFRoZSBjYWNoZWQgcmVzdW1lIHRva2VuIHRoYXQgaXMgdXNlZCB0byByZXN1bWUgYWZ0ZXIgdGhlIG1vc3QgcmVjZW50bHkgcmV0dXJuZWQgY2hhbmdlLiAqL1xuICAgIGdldCByZXN1bWVUb2tlbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY3Vyc29yPy5yZXN1bWVUb2tlbjtcbiAgICB9XG4gICAgLyoqIENoZWNrIGlmIHRoZXJlIGlzIGFueSBkb2N1bWVudCBzdGlsbCBhdmFpbGFibGUgaW4gdGhlIENoYW5nZSBTdHJlYW0gKi9cbiAgICBhc3luYyBoYXNOZXh0KCkge1xuICAgICAgICB0aGlzLl9zZXRJc0l0ZXJhdG9yKCk7XG4gICAgICAgIC8vIENoYW5nZSBzdHJlYW1zIG11c3QgcmVzdW1lIGluZGVmaW5pdGVseSB3aGlsZSBlYWNoIHJlc3VtZSBldmVudCBzdWNjZWVkcy5cbiAgICAgICAgLy8gVGhpcyBsb29wIGNvbnRpbnVlcyB1bnRpbCBlaXRoZXIgYSBjaGFuZ2UgZXZlbnQgaXMgcmVjZWl2ZWQgb3IgdW50aWwgYSByZXN1bWUgYXR0ZW1wdFxuICAgICAgICAvLyBmYWlscy5cbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnN0YW50LWNvbmRpdGlvblxuICAgICAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBjb25zdCBoYXNOZXh0ID0gYXdhaXQgdGhpcy5jdXJzb3IuaGFzTmV4dCgpO1xuICAgICAgICAgICAgICAgIHJldHVybiBoYXNOZXh0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5fcHJvY2Vzc0Vycm9ySXRlcmF0b3JNb2RlKGVycm9yKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY2F0Y2gge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gV2UgYXJlIG5vdCBjb25jZXJuZWQgd2l0aCBlcnJvcnMgZnJvbSBjbG9zZSgpXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIC8qKiBHZXQgdGhlIG5leHQgYXZhaWxhYmxlIGRvY3VtZW50IGZyb20gdGhlIENoYW5nZSBTdHJlYW0uICovXG4gICAgYXN5bmMgbmV4dCgpIHtcbiAgICAgICAgdGhpcy5fc2V0SXNJdGVyYXRvcigpO1xuICAgICAgICAvLyBDaGFuZ2Ugc3RyZWFtcyBtdXN0IHJlc3VtZSBpbmRlZmluaXRlbHkgd2hpbGUgZWFjaCByZXN1bWUgZXZlbnQgc3VjY2VlZHMuXG4gICAgICAgIC8vIFRoaXMgbG9vcCBjb250aW51ZXMgdW50aWwgZWl0aGVyIGEgY2hhbmdlIGV2ZW50IGlzIHJlY2VpdmVkIG9yIHVudGlsIGEgcmVzdW1lIGF0dGVtcHRcbiAgICAgICAgLy8gZmFpbHMuXG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb25zdGFudC1jb25kaXRpb25cbiAgICAgICAgd2hpbGUgKHRydWUpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgY29uc3QgY2hhbmdlID0gYXdhaXQgdGhpcy5jdXJzb3IubmV4dCgpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHByb2Nlc3NlZENoYW5nZSA9IHRoaXMuX3Byb2Nlc3NDaGFuZ2UoY2hhbmdlID8/IG51bGwpO1xuICAgICAgICAgICAgICAgIHJldHVybiBwcm9jZXNzZWRDaGFuZ2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLl9wcm9jZXNzRXJyb3JJdGVyYXRvck1vZGUoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjYXRjaCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBXZSBhcmUgbm90IGNvbmNlcm5lZCB3aXRoIGVycm9ycyBmcm9tIGNsb3NlKClcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogVHJ5IHRvIGdldCB0aGUgbmV4dCBhdmFpbGFibGUgZG9jdW1lbnQgZnJvbSB0aGUgQ2hhbmdlIFN0cmVhbSdzIGN1cnNvciBvciBgbnVsbGAgaWYgYW4gZW1wdHkgYmF0Y2ggaXMgcmV0dXJuZWRcbiAgICAgKi9cbiAgICBhc3luYyB0cnlOZXh0KCkge1xuICAgICAgICB0aGlzLl9zZXRJc0l0ZXJhdG9yKCk7XG4gICAgICAgIC8vIENoYW5nZSBzdHJlYW1zIG11c3QgcmVzdW1lIGluZGVmaW5pdGVseSB3aGlsZSBlYWNoIHJlc3VtZSBldmVudCBzdWNjZWVkcy5cbiAgICAgICAgLy8gVGhpcyBsb29wIGNvbnRpbnVlcyB1bnRpbCBlaXRoZXIgYSBjaGFuZ2UgZXZlbnQgaXMgcmVjZWl2ZWQgb3IgdW50aWwgYSByZXN1bWUgYXR0ZW1wdFxuICAgICAgICAvLyBmYWlscy5cbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnN0YW50LWNvbmRpdGlvblxuICAgICAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBjb25zdCBjaGFuZ2UgPSBhd2FpdCB0aGlzLmN1cnNvci50cnlOZXh0KCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNoYW5nZSA/PyBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5fcHJvY2Vzc0Vycm9ySXRlcmF0b3JNb2RlKGVycm9yKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY2F0Y2gge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gV2UgYXJlIG5vdCBjb25jZXJuZWQgd2l0aCBlcnJvcnMgZnJvbSBjbG9zZSgpXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGFzeW5jICpbU3ltYm9sLmFzeW5jSXRlcmF0b3JdKCkge1xuICAgICAgICBpZiAodGhpcy5jbG9zZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgLy8gQ2hhbmdlIHN0cmVhbXMgcnVuIGluZGVmaW5pdGVseSBhcyBsb25nIGFzIGVycm9ycyBhcmUgcmVzdW1hYmxlXG4gICAgICAgICAgICAvLyBTbyB0aGUgb25seSBsb29wIGJyZWFraW5nIGNvbmRpdGlvbiBpcyBpZiBgbmV4dCgpYCB0aHJvd3NcbiAgICAgICAgICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICAgICAgICAgICAgeWllbGQgYXdhaXQgdGhpcy5uZXh0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZmluYWxseSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuY2xvc2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIHtcbiAgICAgICAgICAgICAgICAvLyB3ZSdyZSBub3QgY29uY2VybmVkIHdpdGggZXJyb3JzIGZyb20gY2xvc2UoKVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIC8qKiBJcyB0aGUgY3Vyc29yIGNsb3NlZCAqL1xuICAgIGdldCBjbG9zZWQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzW2tDbG9zZWRdIHx8IHRoaXMuY3Vyc29yLmNsb3NlZDtcbiAgICB9XG4gICAgLyoqIENsb3NlIHRoZSBDaGFuZ2UgU3RyZWFtICovXG4gICAgYXN5bmMgY2xvc2UoKSB7XG4gICAgICAgIHRoaXNba0Nsb3NlZF0gPSB0cnVlO1xuICAgICAgICBjb25zdCBjdXJzb3IgPSB0aGlzLmN1cnNvcjtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IGN1cnNvci5jbG9zZSgpO1xuICAgICAgICB9XG4gICAgICAgIGZpbmFsbHkge1xuICAgICAgICAgICAgdGhpcy5fZW5kU3RyZWFtKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJuIGEgbW9kaWZpZWQgUmVhZGFibGUgc3RyZWFtIGluY2x1ZGluZyBhIHBvc3NpYmxlIHRyYW5zZm9ybSBtZXRob2QuXG4gICAgICpcbiAgICAgKiBOT1RFOiBXaGVuIHVzaW5nIGEgU3RyZWFtIHRvIHByb2Nlc3MgY2hhbmdlIHN0cmVhbSBldmVudHMsIHRoZSBzdHJlYW0gd2lsbFxuICAgICAqIE5PVCBhdXRvbWF0aWNhbGx5IHJlc3VtZSBpbiB0aGUgY2FzZSBhIHJlc3VtYWJsZSBlcnJvciBpcyBlbmNvdW50ZXJlZC5cbiAgICAgKlxuICAgICAqIEB0aHJvd3MgTW9uZ29DaGFuZ2VTdHJlYW1FcnJvciBpZiB0aGUgdW5kZXJseWluZyBjdXJzb3Igb3IgdGhlIGNoYW5nZSBzdHJlYW0gaXMgY2xvc2VkXG4gICAgICovXG4gICAgc3RyZWFtKG9wdGlvbnMpIHtcbiAgICAgICAgaWYgKHRoaXMuY2xvc2VkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0NoYW5nZVN0cmVhbUVycm9yKENIQU5HRVNUUkVBTV9DTE9TRURfRVJST1IpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc3RyZWFtT3B0aW9ucyA9IG9wdGlvbnM7XG4gICAgICAgIHJldHVybiB0aGlzLmN1cnNvci5zdHJlYW0ob3B0aW9ucyk7XG4gICAgfVxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBfc2V0SXNFbWl0dGVyKCkge1xuICAgICAgICBpZiAodGhpc1trTW9kZV0gPT09ICdpdGVyYXRvcicpIHtcbiAgICAgICAgICAgIC8vIFRPRE8oTk9ERS0zNDg1KTogUmVwbGFjZSB3aXRoIE1vbmdvQ2hhbmdlU3RyZWFtTW9kZUVycm9yXG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0FQSUVycm9yKCdDaGFuZ2VTdHJlYW0gY2Fubm90IGJlIHVzZWQgYXMgYW4gRXZlbnRFbWl0dGVyIGFmdGVyIGJlaW5nIHVzZWQgYXMgYW4gaXRlcmF0b3InKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzW2tNb2RlXSA9ICdlbWl0dGVyJztcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIF9zZXRJc0l0ZXJhdG9yKCkge1xuICAgICAgICBpZiAodGhpc1trTW9kZV0gPT09ICdlbWl0dGVyJykge1xuICAgICAgICAgICAgLy8gVE9ETyhOT0RFLTM0ODUpOiBSZXBsYWNlIHdpdGggTW9uZ29DaGFuZ2VTdHJlYW1Nb2RlRXJyb3JcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvQVBJRXJyb3IoJ0NoYW5nZVN0cmVhbSBjYW5ub3QgYmUgdXNlZCBhcyBhbiBpdGVyYXRvciBhZnRlciBiZWluZyB1c2VkIGFzIGFuIEV2ZW50RW1pdHRlcicpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXNba01vZGVdID0gJ2l0ZXJhdG9yJztcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgbmV3IGNoYW5nZSBzdHJlYW0gY3Vyc29yIGJhc2VkIG9uIHNlbGYncyBjb25maWd1cmF0aW9uXG4gICAgICogQGludGVybmFsXG4gICAgICovXG4gICAgX2NyZWF0ZUNoYW5nZVN0cmVhbUN1cnNvcihvcHRpb25zKSB7XG4gICAgICAgIGNvbnN0IGNoYW5nZVN0cmVhbVN0YWdlT3B0aW9ucyA9ICgwLCB1dGlsc18xLmZpbHRlck9wdGlvbnMpKG9wdGlvbnMsIENIQU5HRV9TVFJFQU1fT1BUSU9OUyk7XG4gICAgICAgIGlmICh0aGlzLnR5cGUgPT09IENIQU5HRV9ET01BSU5fVFlQRVMuQ0xVU1RFUikge1xuICAgICAgICAgICAgY2hhbmdlU3RyZWFtU3RhZ2VPcHRpb25zLmFsbENoYW5nZXNGb3JDbHVzdGVyID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBwaXBlbGluZSA9IFt7ICRjaGFuZ2VTdHJlYW06IGNoYW5nZVN0cmVhbVN0YWdlT3B0aW9ucyB9LCAuLi50aGlzLnBpcGVsaW5lXTtcbiAgICAgICAgY29uc3QgY2xpZW50ID0gdGhpcy50eXBlID09PSBDSEFOR0VfRE9NQUlOX1RZUEVTLkNMVVNURVJcbiAgICAgICAgICAgID8gdGhpcy5wYXJlbnRcbiAgICAgICAgICAgIDogdGhpcy50eXBlID09PSBDSEFOR0VfRE9NQUlOX1RZUEVTLkRBVEFCQVNFXG4gICAgICAgICAgICAgICAgPyB0aGlzLnBhcmVudC5jbGllbnRcbiAgICAgICAgICAgICAgICA6IHRoaXMudHlwZSA9PT0gQ0hBTkdFX0RPTUFJTl9UWVBFUy5DT0xMRUNUSU9OXG4gICAgICAgICAgICAgICAgICAgID8gdGhpcy5wYXJlbnQuY2xpZW50XG4gICAgICAgICAgICAgICAgICAgIDogbnVsbDtcbiAgICAgICAgaWYgKGNsaWVudCA9PSBudWxsKSB7XG4gICAgICAgICAgICAvLyBUaGlzIHNob3VsZCBuZXZlciBoYXBwZW4gYmVjYXVzZSBvZiB0aGUgYXNzZXJ0aW9uIGluIHRoZSBjb25zdHJ1Y3RvclxuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29SdW50aW1lRXJyb3IoYENoYW5nZXN0cmVhbSB0eXBlIHNob3VsZCBvbmx5IGJlIG9uZSBvZiBjbHVzdGVyLCBkYXRhYmFzZSwgY29sbGVjdGlvbi4gRm91bmQgJHt0aGlzLnR5cGUudG9TdHJpbmcoKX1gKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjaGFuZ2VTdHJlYW1DdXJzb3IgPSBuZXcgY2hhbmdlX3N0cmVhbV9jdXJzb3JfMS5DaGFuZ2VTdHJlYW1DdXJzb3IoY2xpZW50LCB0aGlzLm5hbWVzcGFjZSwgcGlwZWxpbmUsIG9wdGlvbnMpO1xuICAgICAgICBmb3IgKGNvbnN0IGV2ZW50IG9mIENIQU5HRV9TVFJFQU1fRVZFTlRTKSB7XG4gICAgICAgICAgICBjaGFuZ2VTdHJlYW1DdXJzb3Iub24oZXZlbnQsIGUgPT4gdGhpcy5lbWl0KGV2ZW50LCBlKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMubGlzdGVuZXJDb3VudChDaGFuZ2VTdHJlYW0uQ0hBTkdFKSA+IDApIHtcbiAgICAgICAgICAgIHRoaXMuX3N0cmVhbUV2ZW50cyhjaGFuZ2VTdHJlYW1DdXJzb3IpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjaGFuZ2VTdHJlYW1DdXJzb3I7XG4gICAgfVxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBfY2xvc2VFbWl0dGVyTW9kZVdpdGhFcnJvcihlcnJvcikge1xuICAgICAgICB0aGlzLmVtaXQoQ2hhbmdlU3RyZWFtLkVSUk9SLCBlcnJvcik7XG4gICAgICAgIHRoaXMuY2xvc2UoKS5jYXRjaCgoKSA9PiBudWxsKTtcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIF9zdHJlYW1FdmVudHMoY3Vyc29yKSB7XG4gICAgICAgIHRoaXMuX3NldElzRW1pdHRlcigpO1xuICAgICAgICBjb25zdCBzdHJlYW0gPSB0aGlzW2tDdXJzb3JTdHJlYW1dID8/IGN1cnNvci5zdHJlYW0oKTtcbiAgICAgICAgdGhpc1trQ3Vyc29yU3RyZWFtXSA9IHN0cmVhbTtcbiAgICAgICAgc3RyZWFtLm9uKCdkYXRhJywgY2hhbmdlID0+IHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcHJvY2Vzc2VkQ2hhbmdlID0gdGhpcy5fcHJvY2Vzc0NoYW5nZShjaGFuZ2UpO1xuICAgICAgICAgICAgICAgIHRoaXMuZW1pdChDaGFuZ2VTdHJlYW0uQ0hBTkdFLCBwcm9jZXNzZWRDaGFuZ2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lbWl0KENoYW5nZVN0cmVhbS5FUlJPUiwgZXJyb3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgc3RyZWFtLm9uKCdlcnJvcicsIGVycm9yID0+IHRoaXMuX3Byb2Nlc3NFcnJvclN0cmVhbU1vZGUoZXJyb3IpKTtcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIF9lbmRTdHJlYW0oKSB7XG4gICAgICAgIGNvbnN0IGN1cnNvclN0cmVhbSA9IHRoaXNba0N1cnNvclN0cmVhbV07XG4gICAgICAgIGlmIChjdXJzb3JTdHJlYW0pIHtcbiAgICAgICAgICAgIFsnZGF0YScsICdjbG9zZScsICdlbmQnLCAnZXJyb3InXS5mb3JFYWNoKGV2ZW50ID0+IGN1cnNvclN0cmVhbS5yZW1vdmVBbGxMaXN0ZW5lcnMoZXZlbnQpKTtcbiAgICAgICAgICAgIGN1cnNvclN0cmVhbS5kZXN0cm95KCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpc1trQ3Vyc29yU3RyZWFtXSA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIF9wcm9jZXNzQ2hhbmdlKGNoYW5nZSkge1xuICAgICAgICBpZiAodGhpc1trQ2xvc2VkXSkge1xuICAgICAgICAgICAgLy8gVE9ETyhOT0RFLTM0ODUpOiBSZXBsYWNlIHdpdGggTW9uZ29DaGFuZ2VTdHJlYW1DbG9zZWRFcnJvclxuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29BUElFcnJvcihDSEFOR0VTVFJFQU1fQ0xPU0VEX0VSUk9SKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBhIG51bGwgY2hhbmdlIG1lYW5zIHRoZSBjdXJzb3IgaGFzIGJlZW4gbm90aWZpZWQsIGltcGxpY2l0bHkgY2xvc2luZyB0aGUgY2hhbmdlIHN0cmVhbVxuICAgICAgICBpZiAoY2hhbmdlID09IG51bGwpIHtcbiAgICAgICAgICAgIC8vIFRPRE8oTk9ERS0zNDg1KTogUmVwbGFjZSB3aXRoIE1vbmdvQ2hhbmdlU3RyZWFtQ2xvc2VkRXJyb3JcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUnVudGltZUVycm9yKENIQU5HRVNUUkVBTV9DTE9TRURfRVJST1IpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjaGFuZ2UgJiYgIWNoYW5nZS5faWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvQ2hhbmdlU3RyZWFtRXJyb3IoTk9fUkVTVU1FX1RPS0VOX0VSUk9SKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBjYWNoZSB0aGUgcmVzdW1lIHRva2VuXG4gICAgICAgIHRoaXMuY3Vyc29yLmNhY2hlUmVzdW1lVG9rZW4oY2hhbmdlLl9pZCk7XG4gICAgICAgIC8vIHdpcGUgdGhlIHN0YXJ0QXRPcGVyYXRpb25UaW1lIGlmIHRoZXJlIHdhcyBvbmUgc28gdGhhdCB0aGVyZSB3b24ndCBiZSBhIGNvbmZsaWN0XG4gICAgICAgIC8vIGJldHdlZW4gcmVzdW1lVG9rZW4gYW5kIHN0YXJ0QXRPcGVyYXRpb25UaW1lIGlmIHdlIG5lZWQgdG8gcmVjb25uZWN0IHRoZSBjdXJzb3JcbiAgICAgICAgdGhpcy5vcHRpb25zLnN0YXJ0QXRPcGVyYXRpb25UaW1lID0gdW5kZWZpbmVkO1xuICAgICAgICByZXR1cm4gY2hhbmdlO1xuICAgIH1cbiAgICAvKiogQGludGVybmFsICovXG4gICAgX3Byb2Nlc3NFcnJvclN0cmVhbU1vZGUoY2hhbmdlU3RyZWFtRXJyb3IpIHtcbiAgICAgICAgLy8gSWYgdGhlIGNoYW5nZSBzdHJlYW0gaGFzIGJlZW4gY2xvc2VkIGV4cGxpY2l0bHksIGRvIG5vdCBwcm9jZXNzIGVycm9yLlxuICAgICAgICBpZiAodGhpc1trQ2xvc2VkXSlcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgaWYgKCgwLCBlcnJvcl8xLmlzUmVzdW1hYmxlRXJyb3IpKGNoYW5nZVN0cmVhbUVycm9yLCB0aGlzLmN1cnNvci5tYXhXaXJlVmVyc2lvbikpIHtcbiAgICAgICAgICAgIHRoaXMuX2VuZFN0cmVhbSgpO1xuICAgICAgICAgICAgdGhpcy5jdXJzb3IuY2xvc2UoKS5jYXRjaCgoKSA9PiBudWxsKTtcbiAgICAgICAgICAgIGNvbnN0IHRvcG9sb2d5ID0gKDAsIHV0aWxzXzEuZ2V0VG9wb2xvZ3kpKHRoaXMucGFyZW50KTtcbiAgICAgICAgICAgIHRvcG9sb2d5LnNlbGVjdFNlcnZlcih0aGlzLmN1cnNvci5yZWFkUHJlZmVyZW5jZSwge30sIHNlcnZlclNlbGVjdGlvbkVycm9yID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoc2VydmVyU2VsZWN0aW9uRXJyb3IpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9jbG9zZUVtaXR0ZXJNb2RlV2l0aEVycm9yKGNoYW5nZVN0cmVhbUVycm9yKTtcbiAgICAgICAgICAgICAgICB0aGlzLmN1cnNvciA9IHRoaXMuX2NyZWF0ZUNoYW5nZVN0cmVhbUN1cnNvcih0aGlzLmN1cnNvci5yZXN1bWVPcHRpb25zKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5fY2xvc2VFbWl0dGVyTW9kZVdpdGhFcnJvcihjaGFuZ2VTdHJlYW1FcnJvcik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGFzeW5jIF9wcm9jZXNzRXJyb3JJdGVyYXRvck1vZGUoY2hhbmdlU3RyZWFtRXJyb3IpIHtcbiAgICAgICAgaWYgKHRoaXNba0Nsb3NlZF0pIHtcbiAgICAgICAgICAgIC8vIFRPRE8oTk9ERS0zNDg1KTogUmVwbGFjZSB3aXRoIE1vbmdvQ2hhbmdlU3RyZWFtQ2xvc2VkRXJyb3JcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvQVBJRXJyb3IoQ0hBTkdFU1RSRUFNX0NMT1NFRF9FUlJPUik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCEoMCwgZXJyb3JfMS5pc1Jlc3VtYWJsZUVycm9yKShjaGFuZ2VTdHJlYW1FcnJvciwgdGhpcy5jdXJzb3IubWF4V2lyZVZlcnNpb24pKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuY2xvc2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIHtcbiAgICAgICAgICAgICAgICAvLyBpZ25vcmUgZXJyb3JzIGZyb20gY2xvc2VcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRocm93IGNoYW5nZVN0cmVhbUVycm9yO1xuICAgICAgICB9XG4gICAgICAgIGF3YWl0IHRoaXMuY3Vyc29yLmNsb3NlKCkuY2F0Y2goKCkgPT4gbnVsbCk7XG4gICAgICAgIGNvbnN0IHRvcG9sb2d5ID0gKDAsIHV0aWxzXzEuZ2V0VG9wb2xvZ3kpKHRoaXMucGFyZW50KTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IHRvcG9sb2d5LnNlbGVjdFNlcnZlckFzeW5jKHRoaXMuY3Vyc29yLnJlYWRQcmVmZXJlbmNlLCB7fSk7XG4gICAgICAgICAgICB0aGlzLmN1cnNvciA9IHRoaXMuX2NyZWF0ZUNoYW5nZVN0cmVhbUN1cnNvcih0aGlzLmN1cnNvci5yZXN1bWVPcHRpb25zKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCB7XG4gICAgICAgICAgICAvLyBpZiB0aGUgdG9wb2xvZ3kgY2FuJ3QgcmVjb25uZWN0LCBjbG9zZSB0aGUgc3RyZWFtXG4gICAgICAgICAgICBhd2FpdCB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICB0aHJvdyBjaGFuZ2VTdHJlYW1FcnJvcjtcbiAgICAgICAgfVxuICAgIH1cbn1cbi8qKiBAZXZlbnQgKi9cbkNoYW5nZVN0cmVhbS5SRVNQT05TRSA9IGNvbnN0YW50c18xLlJFU1BPTlNFO1xuLyoqIEBldmVudCAqL1xuQ2hhbmdlU3RyZWFtLk1PUkUgPSBjb25zdGFudHNfMS5NT1JFO1xuLyoqIEBldmVudCAqL1xuQ2hhbmdlU3RyZWFtLklOSVQgPSBjb25zdGFudHNfMS5JTklUO1xuLyoqIEBldmVudCAqL1xuQ2hhbmdlU3RyZWFtLkNMT1NFID0gY29uc3RhbnRzXzEuQ0xPU0U7XG4vKipcbiAqIEZpcmVkIGZvciBlYWNoIG5ldyBtYXRjaGluZyBjaGFuZ2UgaW4gdGhlIHNwZWNpZmllZCBuYW1lc3BhY2UuIEF0dGFjaGluZyBhIGBjaGFuZ2VgXG4gKiBldmVudCBsaXN0ZW5lciB0byBhIENoYW5nZSBTdHJlYW0gd2lsbCBzd2l0Y2ggdGhlIHN0cmVhbSBpbnRvIGZsb3dpbmcgbW9kZS4gRGF0YSB3aWxsXG4gKiB0aGVuIGJlIHBhc3NlZCBhcyBzb29uIGFzIGl0IGlzIGF2YWlsYWJsZS5cbiAqIEBldmVudFxuICovXG5DaGFuZ2VTdHJlYW0uQ0hBTkdFID0gY29uc3RhbnRzXzEuQ0hBTkdFO1xuLyoqIEBldmVudCAqL1xuQ2hhbmdlU3RyZWFtLkVORCA9IGNvbnN0YW50c18xLkVORDtcbi8qKiBAZXZlbnQgKi9cbkNoYW5nZVN0cmVhbS5FUlJPUiA9IGNvbnN0YW50c18xLkVSUk9SO1xuLyoqXG4gKiBFbWl0dGVkIGVhY2ggdGltZSB0aGUgY2hhbmdlIHN0cmVhbSBzdG9yZXMgYSBuZXcgcmVzdW1lIHRva2VuLlxuICogQGV2ZW50XG4gKi9cbkNoYW5nZVN0cmVhbS5SRVNVTUVfVE9LRU5fQ0hBTkdFRCA9IGNvbnN0YW50c18xLlJFU1VNRV9UT0tFTl9DSEFOR0VEO1xuZXhwb3J0cy5DaGFuZ2VTdHJlYW0gPSBDaGFuZ2VTdHJlYW07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1jaGFuZ2Vfc3RyZWFtLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/change_stream.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/cmap/auth/auth_provider.js":
/*!*********************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/cmap/auth/auth_provider.js ***!
  \*********************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.AuthProvider = exports.AuthContext = void 0;\nconst error_1 = __webpack_require__(/*! ../../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\n/**\n * Context used during authentication\n * @internal\n */\nclass AuthContext {\n    constructor(connection, credentials, options) {\n        /** If the context is for reauthentication. */\n        this.reauthenticating = false;\n        this.connection = connection;\n        this.credentials = credentials;\n        this.options = options;\n    }\n}\nexports.AuthContext = AuthContext;\nclass AuthProvider {\n    /**\n     * Prepare the handshake document before the initial handshake.\n     *\n     * @param handshakeDoc - The document used for the initial handshake on a connection\n     * @param authContext - Context for authentication flow\n     */\n    async prepare(handshakeDoc, _authContext) {\n        return handshakeDoc;\n    }\n    /**\n     * Reauthenticate.\n     * @param context - The shared auth context.\n     */\n    async reauth(context) {\n        if (context.reauthenticating) {\n            throw new error_1.MongoRuntimeError('Reauthentication already in progress.');\n        }\n        try {\n            context.reauthenticating = true;\n            await this.auth(context);\n        }\n        finally {\n            context.reauthenticating = false;\n        }\n    }\n}\nexports.AuthProvider = AuthProvider;\n//# sourceMappingURL=auth_provider.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jbWFwL2F1dGgvYXV0aF9wcm92aWRlci5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxvQkFBb0IsR0FBRyxtQkFBbUI7QUFDMUMsZ0JBQWdCLG1CQUFPLENBQUMsc0VBQWE7QUFDckM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUI7QUFDbkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CO0FBQ3BCIiwic291cmNlcyI6WyJEOlxcc2Fsb25pXFxhcHByYWlzYWwtc3lzdGVtXFxzZXJ2ZXJcXG5vZGVfbW9kdWxlc1xcbW9uZ29kYlxcbGliXFxjbWFwXFxhdXRoXFxhdXRoX3Byb3ZpZGVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5BdXRoUHJvdmlkZXIgPSBleHBvcnRzLkF1dGhDb250ZXh0ID0gdm9pZCAwO1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuLi8uLi9lcnJvclwiKTtcbi8qKlxuICogQ29udGV4dCB1c2VkIGR1cmluZyBhdXRoZW50aWNhdGlvblxuICogQGludGVybmFsXG4gKi9cbmNsYXNzIEF1dGhDb250ZXh0IHtcbiAgICBjb25zdHJ1Y3Rvcihjb25uZWN0aW9uLCBjcmVkZW50aWFscywgb3B0aW9ucykge1xuICAgICAgICAvKiogSWYgdGhlIGNvbnRleHQgaXMgZm9yIHJlYXV0aGVudGljYXRpb24uICovXG4gICAgICAgIHRoaXMucmVhdXRoZW50aWNhdGluZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLmNvbm5lY3Rpb24gPSBjb25uZWN0aW9uO1xuICAgICAgICB0aGlzLmNyZWRlbnRpYWxzID0gY3JlZGVudGlhbHM7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XG4gICAgfVxufVxuZXhwb3J0cy5BdXRoQ29udGV4dCA9IEF1dGhDb250ZXh0O1xuY2xhc3MgQXV0aFByb3ZpZGVyIHtcbiAgICAvKipcbiAgICAgKiBQcmVwYXJlIHRoZSBoYW5kc2hha2UgZG9jdW1lbnQgYmVmb3JlIHRoZSBpbml0aWFsIGhhbmRzaGFrZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBoYW5kc2hha2VEb2MgLSBUaGUgZG9jdW1lbnQgdXNlZCBmb3IgdGhlIGluaXRpYWwgaGFuZHNoYWtlIG9uIGEgY29ubmVjdGlvblxuICAgICAqIEBwYXJhbSBhdXRoQ29udGV4dCAtIENvbnRleHQgZm9yIGF1dGhlbnRpY2F0aW9uIGZsb3dcbiAgICAgKi9cbiAgICBhc3luYyBwcmVwYXJlKGhhbmRzaGFrZURvYywgX2F1dGhDb250ZXh0KSB7XG4gICAgICAgIHJldHVybiBoYW5kc2hha2VEb2M7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJlYXV0aGVudGljYXRlLlxuICAgICAqIEBwYXJhbSBjb250ZXh0IC0gVGhlIHNoYXJlZCBhdXRoIGNvbnRleHQuXG4gICAgICovXG4gICAgYXN5bmMgcmVhdXRoKGNvbnRleHQpIHtcbiAgICAgICAgaWYgKGNvbnRleHQucmVhdXRoZW50aWNhdGluZykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29SdW50aW1lRXJyb3IoJ1JlYXV0aGVudGljYXRpb24gYWxyZWFkeSBpbiBwcm9ncmVzcy4nKTtcbiAgICAgICAgfVxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29udGV4dC5yZWF1dGhlbnRpY2F0aW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuYXV0aChjb250ZXh0KTtcbiAgICAgICAgfVxuICAgICAgICBmaW5hbGx5IHtcbiAgICAgICAgICAgIGNvbnRleHQucmVhdXRoZW50aWNhdGluZyA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxufVxuZXhwb3J0cy5BdXRoUHJvdmlkZXIgPSBBdXRoUHJvdmlkZXI7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1hdXRoX3Byb3ZpZGVyLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/cmap/auth/auth_provider.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/cmap/auth/gssapi.js":
/*!**************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/cmap/auth/gssapi.js ***!
  \**************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.resolveCname = exports.performGSSAPICanonicalizeHostName = exports.GSSAPI = exports.GSSAPICanonicalizationValue = void 0;\nconst dns = __webpack_require__(/*! dns */ \"dns\");\nconst deps_1 = __webpack_require__(/*! ../../deps */ \"(api)/../server/node_modules/mongodb/lib/deps.js\");\nconst error_1 = __webpack_require__(/*! ../../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst utils_1 = __webpack_require__(/*! ../../utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\nconst auth_provider_1 = __webpack_require__(/*! ./auth_provider */ \"(api)/../server/node_modules/mongodb/lib/cmap/auth/auth_provider.js\");\n/** @public */\nexports.GSSAPICanonicalizationValue = Object.freeze({\n    on: true,\n    off: false,\n    none: 'none',\n    forward: 'forward',\n    forwardAndReverse: 'forwardAndReverse'\n});\nasync function externalCommand(connection, command) {\n    return connection.commandAsync((0, utils_1.ns)('$external.$cmd'), command, undefined);\n}\nlet krb;\nclass GSSAPI extends auth_provider_1.AuthProvider {\n    async auth(authContext) {\n        const { connection, credentials } = authContext;\n        if (credentials == null) {\n            throw new error_1.MongoMissingCredentialsError('Credentials required for GSSAPI authentication');\n        }\n        const { username } = credentials;\n        const client = await makeKerberosClient(authContext);\n        const payload = await client.step('');\n        const saslStartResponse = await externalCommand(connection, saslStart(payload));\n        const negotiatedPayload = await negotiate(client, 10, saslStartResponse.payload);\n        const saslContinueResponse = await externalCommand(connection, saslContinue(negotiatedPayload, saslStartResponse.conversationId));\n        const finalizePayload = await finalize(client, username, saslContinueResponse.payload);\n        await externalCommand(connection, {\n            saslContinue: 1,\n            conversationId: saslContinueResponse.conversationId,\n            payload: finalizePayload\n        });\n    }\n}\nexports.GSSAPI = GSSAPI;\nasync function makeKerberosClient(authContext) {\n    const { hostAddress } = authContext.options;\n    const { credentials } = authContext;\n    if (!hostAddress || typeof hostAddress.host !== 'string' || !credentials) {\n        throw new error_1.MongoInvalidArgumentError('Connection must have host and port and credentials defined.');\n    }\n    loadKrb();\n    if ('kModuleError' in krb) {\n        throw krb['kModuleError'];\n    }\n    const { initializeClient } = krb;\n    const { username, password } = credentials;\n    const mechanismProperties = credentials.mechanismProperties;\n    const serviceName = mechanismProperties.SERVICE_NAME ?? 'mongodb';\n    const host = await performGSSAPICanonicalizeHostName(hostAddress.host, mechanismProperties);\n    const initOptions = {};\n    if (password != null) {\n        // TODO(NODE-5139): These do not match the typescript options in initializeClient\n        Object.assign(initOptions, { user: username, password: password });\n    }\n    const spnHost = mechanismProperties.SERVICE_HOST ?? host;\n    let spn = `${serviceName}${process.platform === 'win32' ? '/' : '@'}${spnHost}`;\n    if ('SERVICE_REALM' in mechanismProperties) {\n        spn = `${spn}@${mechanismProperties.SERVICE_REALM}`;\n    }\n    return initializeClient(spn, initOptions);\n}\nfunction saslStart(payload) {\n    return {\n        saslStart: 1,\n        mechanism: 'GSSAPI',\n        payload,\n        autoAuthorize: 1\n    };\n}\nfunction saslContinue(payload, conversationId) {\n    return {\n        saslContinue: 1,\n        conversationId,\n        payload\n    };\n}\nasync function negotiate(client, retries, payload) {\n    try {\n        const response = await client.step(payload);\n        return response || '';\n    }\n    catch (error) {\n        if (retries === 0) {\n            // Retries exhausted, raise error\n            throw error;\n        }\n        // Adjust number of retries and call step again\n        return negotiate(client, retries - 1, payload);\n    }\n}\nasync function finalize(client, user, payload) {\n    // GSS Client Unwrap\n    const response = await client.unwrap(payload);\n    return client.wrap(response || '', { user });\n}\nasync function performGSSAPICanonicalizeHostName(host, mechanismProperties) {\n    const mode = mechanismProperties.CANONICALIZE_HOST_NAME;\n    if (!mode || mode === exports.GSSAPICanonicalizationValue.none) {\n        return host;\n    }\n    // If forward and reverse or true\n    if (mode === exports.GSSAPICanonicalizationValue.on ||\n        mode === exports.GSSAPICanonicalizationValue.forwardAndReverse) {\n        // Perform the lookup of the ip address.\n        const { address } = await dns.promises.lookup(host);\n        try {\n            // Perform a reverse ptr lookup on the ip address.\n            const results = await dns.promises.resolvePtr(address);\n            // If the ptr did not error but had no results, return the host.\n            return results.length > 0 ? results[0] : host;\n        }\n        catch (error) {\n            // This can error as ptr records may not exist for all ips. In this case\n            // fallback to a cname lookup as dns.lookup() does not return the\n            // cname.\n            return resolveCname(host);\n        }\n    }\n    else {\n        // The case for forward is just to resolve the cname as dns.lookup()\n        // will not return it.\n        return resolveCname(host);\n    }\n}\nexports.performGSSAPICanonicalizeHostName = performGSSAPICanonicalizeHostName;\nasync function resolveCname(host) {\n    // Attempt to resolve the host name\n    try {\n        const results = await dns.promises.resolveCname(host);\n        // Get the first resolved host id\n        return results.length > 0 ? results[0] : host;\n    }\n    catch {\n        return host;\n    }\n}\nexports.resolveCname = resolveCname;\n/**\n * Load the Kerberos library.\n */\nfunction loadKrb() {\n    if (!krb) {\n        krb = (0, deps_1.getKerberos)();\n    }\n}\n//# sourceMappingURL=gssapi.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jbWFwL2F1dGgvZ3NzYXBpLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELG9CQUFvQixHQUFHLHlDQUF5QyxHQUFHLGNBQWMsR0FBRyxtQ0FBbUM7QUFDdkgsWUFBWSxtQkFBTyxDQUFDLGdCQUFLO0FBQ3pCLGVBQWUsbUJBQU8sQ0FBQyxvRUFBWTtBQUNuQyxnQkFBZ0IsbUJBQU8sQ0FBQyxzRUFBYTtBQUNyQyxnQkFBZ0IsbUJBQU8sQ0FBQyxzRUFBYTtBQUNyQyx3QkFBd0IsbUJBQU8sQ0FBQyw0RkFBaUI7QUFDakQ7QUFDQSxtQ0FBbUM7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsMEJBQTBCO0FBQzFDO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixXQUFXO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQSxZQUFZLGNBQWM7QUFDMUIsWUFBWSxjQUFjO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxtQkFBbUI7QUFDL0IsWUFBWSxxQkFBcUI7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUNBQXFDLG9DQUFvQztBQUN6RTtBQUNBO0FBQ0EsaUJBQWlCLFlBQVksRUFBRSx5Q0FBeUMsRUFBRSxRQUFRO0FBQ2xGO0FBQ0EsaUJBQWlCLElBQUksR0FBRyxrQ0FBa0M7QUFDMUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlDQUF5QyxNQUFNO0FBQy9DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLFVBQVU7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5Q0FBeUM7QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQjtBQUNwQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIkQ6XFxzYWxvbmlcXGFwcHJhaXNhbC1zeXN0ZW1cXHNlcnZlclxcbm9kZV9tb2R1bGVzXFxtb25nb2RiXFxsaWJcXGNtYXBcXGF1dGhcXGdzc2FwaS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMucmVzb2x2ZUNuYW1lID0gZXhwb3J0cy5wZXJmb3JtR1NTQVBJQ2Fub25pY2FsaXplSG9zdE5hbWUgPSBleHBvcnRzLkdTU0FQSSA9IGV4cG9ydHMuR1NTQVBJQ2Fub25pY2FsaXphdGlvblZhbHVlID0gdm9pZCAwO1xuY29uc3QgZG5zID0gcmVxdWlyZShcImRuc1wiKTtcbmNvbnN0IGRlcHNfMSA9IHJlcXVpcmUoXCIuLi8uLi9kZXBzXCIpO1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuLi8uLi9lcnJvclwiKTtcbmNvbnN0IHV0aWxzXzEgPSByZXF1aXJlKFwiLi4vLi4vdXRpbHNcIik7XG5jb25zdCBhdXRoX3Byb3ZpZGVyXzEgPSByZXF1aXJlKFwiLi9hdXRoX3Byb3ZpZGVyXCIpO1xuLyoqIEBwdWJsaWMgKi9cbmV4cG9ydHMuR1NTQVBJQ2Fub25pY2FsaXphdGlvblZhbHVlID0gT2JqZWN0LmZyZWV6ZSh7XG4gICAgb246IHRydWUsXG4gICAgb2ZmOiBmYWxzZSxcbiAgICBub25lOiAnbm9uZScsXG4gICAgZm9yd2FyZDogJ2ZvcndhcmQnLFxuICAgIGZvcndhcmRBbmRSZXZlcnNlOiAnZm9yd2FyZEFuZFJldmVyc2UnXG59KTtcbmFzeW5jIGZ1bmN0aW9uIGV4dGVybmFsQ29tbWFuZChjb25uZWN0aW9uLCBjb21tYW5kKSB7XG4gICAgcmV0dXJuIGNvbm5lY3Rpb24uY29tbWFuZEFzeW5jKCgwLCB1dGlsc18xLm5zKSgnJGV4dGVybmFsLiRjbWQnKSwgY29tbWFuZCwgdW5kZWZpbmVkKTtcbn1cbmxldCBrcmI7XG5jbGFzcyBHU1NBUEkgZXh0ZW5kcyBhdXRoX3Byb3ZpZGVyXzEuQXV0aFByb3ZpZGVyIHtcbiAgICBhc3luYyBhdXRoKGF1dGhDb250ZXh0KSB7XG4gICAgICAgIGNvbnN0IHsgY29ubmVjdGlvbiwgY3JlZGVudGlhbHMgfSA9IGF1dGhDb250ZXh0O1xuICAgICAgICBpZiAoY3JlZGVudGlhbHMgPT0gbnVsbCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29NaXNzaW5nQ3JlZGVudGlhbHNFcnJvcignQ3JlZGVudGlhbHMgcmVxdWlyZWQgZm9yIEdTU0FQSSBhdXRoZW50aWNhdGlvbicpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHsgdXNlcm5hbWUgfSA9IGNyZWRlbnRpYWxzO1xuICAgICAgICBjb25zdCBjbGllbnQgPSBhd2FpdCBtYWtlS2VyYmVyb3NDbGllbnQoYXV0aENvbnRleHQpO1xuICAgICAgICBjb25zdCBwYXlsb2FkID0gYXdhaXQgY2xpZW50LnN0ZXAoJycpO1xuICAgICAgICBjb25zdCBzYXNsU3RhcnRSZXNwb25zZSA9IGF3YWl0IGV4dGVybmFsQ29tbWFuZChjb25uZWN0aW9uLCBzYXNsU3RhcnQocGF5bG9hZCkpO1xuICAgICAgICBjb25zdCBuZWdvdGlhdGVkUGF5bG9hZCA9IGF3YWl0IG5lZ290aWF0ZShjbGllbnQsIDEwLCBzYXNsU3RhcnRSZXNwb25zZS5wYXlsb2FkKTtcbiAgICAgICAgY29uc3Qgc2FzbENvbnRpbnVlUmVzcG9uc2UgPSBhd2FpdCBleHRlcm5hbENvbW1hbmQoY29ubmVjdGlvbiwgc2FzbENvbnRpbnVlKG5lZ290aWF0ZWRQYXlsb2FkLCBzYXNsU3RhcnRSZXNwb25zZS5jb252ZXJzYXRpb25JZCkpO1xuICAgICAgICBjb25zdCBmaW5hbGl6ZVBheWxvYWQgPSBhd2FpdCBmaW5hbGl6ZShjbGllbnQsIHVzZXJuYW1lLCBzYXNsQ29udGludWVSZXNwb25zZS5wYXlsb2FkKTtcbiAgICAgICAgYXdhaXQgZXh0ZXJuYWxDb21tYW5kKGNvbm5lY3Rpb24sIHtcbiAgICAgICAgICAgIHNhc2xDb250aW51ZTogMSxcbiAgICAgICAgICAgIGNvbnZlcnNhdGlvbklkOiBzYXNsQ29udGludWVSZXNwb25zZS5jb252ZXJzYXRpb25JZCxcbiAgICAgICAgICAgIHBheWxvYWQ6IGZpbmFsaXplUGF5bG9hZFxuICAgICAgICB9KTtcbiAgICB9XG59XG5leHBvcnRzLkdTU0FQSSA9IEdTU0FQSTtcbmFzeW5jIGZ1bmN0aW9uIG1ha2VLZXJiZXJvc0NsaWVudChhdXRoQ29udGV4dCkge1xuICAgIGNvbnN0IHsgaG9zdEFkZHJlc3MgfSA9IGF1dGhDb250ZXh0Lm9wdGlvbnM7XG4gICAgY29uc3QgeyBjcmVkZW50aWFscyB9ID0gYXV0aENvbnRleHQ7XG4gICAgaWYgKCFob3N0QWRkcmVzcyB8fCB0eXBlb2YgaG9zdEFkZHJlc3MuaG9zdCAhPT0gJ3N0cmluZycgfHwgIWNyZWRlbnRpYWxzKSB7XG4gICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoJ0Nvbm5lY3Rpb24gbXVzdCBoYXZlIGhvc3QgYW5kIHBvcnQgYW5kIGNyZWRlbnRpYWxzIGRlZmluZWQuJyk7XG4gICAgfVxuICAgIGxvYWRLcmIoKTtcbiAgICBpZiAoJ2tNb2R1bGVFcnJvcicgaW4ga3JiKSB7XG4gICAgICAgIHRocm93IGtyYlsna01vZHVsZUVycm9yJ107XG4gICAgfVxuICAgIGNvbnN0IHsgaW5pdGlhbGl6ZUNsaWVudCB9ID0ga3JiO1xuICAgIGNvbnN0IHsgdXNlcm5hbWUsIHBhc3N3b3JkIH0gPSBjcmVkZW50aWFscztcbiAgICBjb25zdCBtZWNoYW5pc21Qcm9wZXJ0aWVzID0gY3JlZGVudGlhbHMubWVjaGFuaXNtUHJvcGVydGllcztcbiAgICBjb25zdCBzZXJ2aWNlTmFtZSA9IG1lY2hhbmlzbVByb3BlcnRpZXMuU0VSVklDRV9OQU1FID8/ICdtb25nb2RiJztcbiAgICBjb25zdCBob3N0ID0gYXdhaXQgcGVyZm9ybUdTU0FQSUNhbm9uaWNhbGl6ZUhvc3ROYW1lKGhvc3RBZGRyZXNzLmhvc3QsIG1lY2hhbmlzbVByb3BlcnRpZXMpO1xuICAgIGNvbnN0IGluaXRPcHRpb25zID0ge307XG4gICAgaWYgKHBhc3N3b3JkICE9IG51bGwpIHtcbiAgICAgICAgLy8gVE9ETyhOT0RFLTUxMzkpOiBUaGVzZSBkbyBub3QgbWF0Y2ggdGhlIHR5cGVzY3JpcHQgb3B0aW9ucyBpbiBpbml0aWFsaXplQ2xpZW50XG4gICAgICAgIE9iamVjdC5hc3NpZ24oaW5pdE9wdGlvbnMsIHsgdXNlcjogdXNlcm5hbWUsIHBhc3N3b3JkOiBwYXNzd29yZCB9KTtcbiAgICB9XG4gICAgY29uc3Qgc3BuSG9zdCA9IG1lY2hhbmlzbVByb3BlcnRpZXMuU0VSVklDRV9IT1NUID8/IGhvc3Q7XG4gICAgbGV0IHNwbiA9IGAke3NlcnZpY2VOYW1lfSR7cHJvY2Vzcy5wbGF0Zm9ybSA9PT0gJ3dpbjMyJyA/ICcvJyA6ICdAJ30ke3Nwbkhvc3R9YDtcbiAgICBpZiAoJ1NFUlZJQ0VfUkVBTE0nIGluIG1lY2hhbmlzbVByb3BlcnRpZXMpIHtcbiAgICAgICAgc3BuID0gYCR7c3BufUAke21lY2hhbmlzbVByb3BlcnRpZXMuU0VSVklDRV9SRUFMTX1gO1xuICAgIH1cbiAgICByZXR1cm4gaW5pdGlhbGl6ZUNsaWVudChzcG4sIGluaXRPcHRpb25zKTtcbn1cbmZ1bmN0aW9uIHNhc2xTdGFydChwYXlsb2FkKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgc2FzbFN0YXJ0OiAxLFxuICAgICAgICBtZWNoYW5pc206ICdHU1NBUEknLFxuICAgICAgICBwYXlsb2FkLFxuICAgICAgICBhdXRvQXV0aG9yaXplOiAxXG4gICAgfTtcbn1cbmZ1bmN0aW9uIHNhc2xDb250aW51ZShwYXlsb2FkLCBjb252ZXJzYXRpb25JZCkge1xuICAgIHJldHVybiB7XG4gICAgICAgIHNhc2xDb250aW51ZTogMSxcbiAgICAgICAgY29udmVyc2F0aW9uSWQsXG4gICAgICAgIHBheWxvYWRcbiAgICB9O1xufVxuYXN5bmMgZnVuY3Rpb24gbmVnb3RpYXRlKGNsaWVudCwgcmV0cmllcywgcGF5bG9hZCkge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgY2xpZW50LnN0ZXAocGF5bG9hZCk7XG4gICAgICAgIHJldHVybiByZXNwb25zZSB8fCAnJztcbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGlmIChyZXRyaWVzID09PSAwKSB7XG4gICAgICAgICAgICAvLyBSZXRyaWVzIGV4aGF1c3RlZCwgcmFpc2UgZXJyb3JcbiAgICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICB9XG4gICAgICAgIC8vIEFkanVzdCBudW1iZXIgb2YgcmV0cmllcyBhbmQgY2FsbCBzdGVwIGFnYWluXG4gICAgICAgIHJldHVybiBuZWdvdGlhdGUoY2xpZW50LCByZXRyaWVzIC0gMSwgcGF5bG9hZCk7XG4gICAgfVxufVxuYXN5bmMgZnVuY3Rpb24gZmluYWxpemUoY2xpZW50LCB1c2VyLCBwYXlsb2FkKSB7XG4gICAgLy8gR1NTIENsaWVudCBVbndyYXBcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGNsaWVudC51bndyYXAocGF5bG9hZCk7XG4gICAgcmV0dXJuIGNsaWVudC53cmFwKHJlc3BvbnNlIHx8ICcnLCB7IHVzZXIgfSk7XG59XG5hc3luYyBmdW5jdGlvbiBwZXJmb3JtR1NTQVBJQ2Fub25pY2FsaXplSG9zdE5hbWUoaG9zdCwgbWVjaGFuaXNtUHJvcGVydGllcykge1xuICAgIGNvbnN0IG1vZGUgPSBtZWNoYW5pc21Qcm9wZXJ0aWVzLkNBTk9OSUNBTElaRV9IT1NUX05BTUU7XG4gICAgaWYgKCFtb2RlIHx8IG1vZGUgPT09IGV4cG9ydHMuR1NTQVBJQ2Fub25pY2FsaXphdGlvblZhbHVlLm5vbmUpIHtcbiAgICAgICAgcmV0dXJuIGhvc3Q7XG4gICAgfVxuICAgIC8vIElmIGZvcndhcmQgYW5kIHJldmVyc2Ugb3IgdHJ1ZVxuICAgIGlmIChtb2RlID09PSBleHBvcnRzLkdTU0FQSUNhbm9uaWNhbGl6YXRpb25WYWx1ZS5vbiB8fFxuICAgICAgICBtb2RlID09PSBleHBvcnRzLkdTU0FQSUNhbm9uaWNhbGl6YXRpb25WYWx1ZS5mb3J3YXJkQW5kUmV2ZXJzZSkge1xuICAgICAgICAvLyBQZXJmb3JtIHRoZSBsb29rdXAgb2YgdGhlIGlwIGFkZHJlc3MuXG4gICAgICAgIGNvbnN0IHsgYWRkcmVzcyB9ID0gYXdhaXQgZG5zLnByb21pc2VzLmxvb2t1cChob3N0KTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIFBlcmZvcm0gYSByZXZlcnNlIHB0ciBsb29rdXAgb24gdGhlIGlwIGFkZHJlc3MuXG4gICAgICAgICAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgZG5zLnByb21pc2VzLnJlc29sdmVQdHIoYWRkcmVzcyk7XG4gICAgICAgICAgICAvLyBJZiB0aGUgcHRyIGRpZCBub3QgZXJyb3IgYnV0IGhhZCBubyByZXN1bHRzLCByZXR1cm4gdGhlIGhvc3QuXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0cy5sZW5ndGggPiAwID8gcmVzdWx0c1swXSA6IGhvc3Q7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAvLyBUaGlzIGNhbiBlcnJvciBhcyBwdHIgcmVjb3JkcyBtYXkgbm90IGV4aXN0IGZvciBhbGwgaXBzLiBJbiB0aGlzIGNhc2VcbiAgICAgICAgICAgIC8vIGZhbGxiYWNrIHRvIGEgY25hbWUgbG9va3VwIGFzIGRucy5sb29rdXAoKSBkb2VzIG5vdCByZXR1cm4gdGhlXG4gICAgICAgICAgICAvLyBjbmFtZS5cbiAgICAgICAgICAgIHJldHVybiByZXNvbHZlQ25hbWUoaG9zdCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIC8vIFRoZSBjYXNlIGZvciBmb3J3YXJkIGlzIGp1c3QgdG8gcmVzb2x2ZSB0aGUgY25hbWUgYXMgZG5zLmxvb2t1cCgpXG4gICAgICAgIC8vIHdpbGwgbm90IHJldHVybiBpdC5cbiAgICAgICAgcmV0dXJuIHJlc29sdmVDbmFtZShob3N0KTtcbiAgICB9XG59XG5leHBvcnRzLnBlcmZvcm1HU1NBUElDYW5vbmljYWxpemVIb3N0TmFtZSA9IHBlcmZvcm1HU1NBUElDYW5vbmljYWxpemVIb3N0TmFtZTtcbmFzeW5jIGZ1bmN0aW9uIHJlc29sdmVDbmFtZShob3N0KSB7XG4gICAgLy8gQXR0ZW1wdCB0byByZXNvbHZlIHRoZSBob3N0IG5hbWVcbiAgICB0cnkge1xuICAgICAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgZG5zLnByb21pc2VzLnJlc29sdmVDbmFtZShob3N0KTtcbiAgICAgICAgLy8gR2V0IHRoZSBmaXJzdCByZXNvbHZlZCBob3N0IGlkXG4gICAgICAgIHJldHVybiByZXN1bHRzLmxlbmd0aCA+IDAgPyByZXN1bHRzWzBdIDogaG9zdDtcbiAgICB9XG4gICAgY2F0Y2gge1xuICAgICAgICByZXR1cm4gaG9zdDtcbiAgICB9XG59XG5leHBvcnRzLnJlc29sdmVDbmFtZSA9IHJlc29sdmVDbmFtZTtcbi8qKlxuICogTG9hZCB0aGUgS2VyYmVyb3MgbGlicmFyeS5cbiAqL1xuZnVuY3Rpb24gbG9hZEtyYigpIHtcbiAgICBpZiAoIWtyYikge1xuICAgICAgICBrcmIgPSAoMCwgZGVwc18xLmdldEtlcmJlcm9zKSgpO1xuICAgIH1cbn1cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWdzc2FwaS5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/cmap/auth/gssapi.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/cmap/auth/mongo_credentials.js":
/*!*************************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/cmap/auth/mongo_credentials.js ***!
  \*************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.MongoCredentials = exports.DEFAULT_ALLOWED_HOSTS = void 0;\nconst error_1 = __webpack_require__(/*! ../../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst gssapi_1 = __webpack_require__(/*! ./gssapi */ \"(api)/../server/node_modules/mongodb/lib/cmap/auth/gssapi.js\");\nconst providers_1 = __webpack_require__(/*! ./providers */ \"(api)/../server/node_modules/mongodb/lib/cmap/auth/providers.js\");\n// https://github.com/mongodb/specifications/blob/master/source/auth/auth.rst\nfunction getDefaultAuthMechanism(hello) {\n    if (hello) {\n        // If hello contains saslSupportedMechs, use scram-sha-256\n        // if it is available, else scram-sha-1\n        if (Array.isArray(hello.saslSupportedMechs)) {\n            return hello.saslSupportedMechs.includes(providers_1.AuthMechanism.MONGODB_SCRAM_SHA256)\n                ? providers_1.AuthMechanism.MONGODB_SCRAM_SHA256\n                : providers_1.AuthMechanism.MONGODB_SCRAM_SHA1;\n        }\n        // Fallback to legacy selection method. If wire version >= 3, use scram-sha-1\n        if (hello.maxWireVersion >= 3) {\n            return providers_1.AuthMechanism.MONGODB_SCRAM_SHA1;\n        }\n    }\n    // Default for wireprotocol < 3\n    return providers_1.AuthMechanism.MONGODB_CR;\n}\nconst ALLOWED_PROVIDER_NAMES = ['aws', 'azure'];\nconst ALLOWED_HOSTS_ERROR = 'Auth mechanism property ALLOWED_HOSTS must be an array of strings.';\n/** @internal */\nexports.DEFAULT_ALLOWED_HOSTS = [\n    '*.mongodb.net',\n    '*.mongodb-dev.net',\n    '*.mongodbgov.net',\n    'localhost',\n    '127.0.0.1',\n    '::1'\n];\n/** Error for when the token audience is missing in the environment. */\nconst TOKEN_AUDIENCE_MISSING_ERROR = 'TOKEN_AUDIENCE must be set in the auth mechanism properties when PROVIDER_NAME is azure.';\n/**\n * A representation of the credentials used by MongoDB\n * @public\n */\nclass MongoCredentials {\n    constructor(options) {\n        this.username = options.username ?? '';\n        this.password = options.password;\n        this.source = options.source;\n        if (!this.source && options.db) {\n            this.source = options.db;\n        }\n        this.mechanism = options.mechanism || providers_1.AuthMechanism.MONGODB_DEFAULT;\n        this.mechanismProperties = options.mechanismProperties || {};\n        if (this.mechanism.match(/MONGODB-AWS/i)) {\n            if (!this.username && process.env.AWS_ACCESS_KEY_ID) {\n                this.username = process.env.AWS_ACCESS_KEY_ID;\n            }\n            if (!this.password && process.env.AWS_SECRET_ACCESS_KEY) {\n                this.password = process.env.AWS_SECRET_ACCESS_KEY;\n            }\n            if (this.mechanismProperties.AWS_SESSION_TOKEN == null &&\n                process.env.AWS_SESSION_TOKEN != null) {\n                this.mechanismProperties = {\n                    ...this.mechanismProperties,\n                    AWS_SESSION_TOKEN: process.env.AWS_SESSION_TOKEN\n                };\n            }\n        }\n        if (this.mechanism === providers_1.AuthMechanism.MONGODB_OIDC && !this.mechanismProperties.ALLOWED_HOSTS) {\n            this.mechanismProperties = {\n                ...this.mechanismProperties,\n                ALLOWED_HOSTS: exports.DEFAULT_ALLOWED_HOSTS\n            };\n        }\n        Object.freeze(this.mechanismProperties);\n        Object.freeze(this);\n    }\n    /** Determines if two MongoCredentials objects are equivalent */\n    equals(other) {\n        return (this.mechanism === other.mechanism &&\n            this.username === other.username &&\n            this.password === other.password &&\n            this.source === other.source);\n    }\n    /**\n     * If the authentication mechanism is set to \"default\", resolves the authMechanism\n     * based on the server version and server supported sasl mechanisms.\n     *\n     * @param hello - A hello response from the server\n     */\n    resolveAuthMechanism(hello) {\n        // If the mechanism is not \"default\", then it does not need to be resolved\n        if (this.mechanism.match(/DEFAULT/i)) {\n            return new MongoCredentials({\n                username: this.username,\n                password: this.password,\n                source: this.source,\n                mechanism: getDefaultAuthMechanism(hello),\n                mechanismProperties: this.mechanismProperties\n            });\n        }\n        return this;\n    }\n    validate() {\n        if ((this.mechanism === providers_1.AuthMechanism.MONGODB_GSSAPI ||\n            this.mechanism === providers_1.AuthMechanism.MONGODB_CR ||\n            this.mechanism === providers_1.AuthMechanism.MONGODB_PLAIN ||\n            this.mechanism === providers_1.AuthMechanism.MONGODB_SCRAM_SHA1 ||\n            this.mechanism === providers_1.AuthMechanism.MONGODB_SCRAM_SHA256) &&\n            !this.username) {\n            throw new error_1.MongoMissingCredentialsError(`Username required for mechanism '${this.mechanism}'`);\n        }\n        if (this.mechanism === providers_1.AuthMechanism.MONGODB_OIDC) {\n            if (this.username && this.mechanismProperties.PROVIDER_NAME) {\n                throw new error_1.MongoInvalidArgumentError(`username and PROVIDER_NAME may not be used together for mechanism '${this.mechanism}'.`);\n            }\n            if (this.mechanismProperties.PROVIDER_NAME === 'azure' &&\n                !this.mechanismProperties.TOKEN_AUDIENCE) {\n                throw new error_1.MongoAzureError(TOKEN_AUDIENCE_MISSING_ERROR);\n            }\n            if (this.mechanismProperties.PROVIDER_NAME &&\n                !ALLOWED_PROVIDER_NAMES.includes(this.mechanismProperties.PROVIDER_NAME)) {\n                throw new error_1.MongoInvalidArgumentError(`Currently only a PROVIDER_NAME in ${ALLOWED_PROVIDER_NAMES.join(',')} is supported for mechanism '${this.mechanism}'.`);\n            }\n            if (this.mechanismProperties.REFRESH_TOKEN_CALLBACK &&\n                !this.mechanismProperties.REQUEST_TOKEN_CALLBACK) {\n                throw new error_1.MongoInvalidArgumentError(`A REQUEST_TOKEN_CALLBACK must be provided when using a REFRESH_TOKEN_CALLBACK for mechanism '${this.mechanism}'`);\n            }\n            if (!this.mechanismProperties.PROVIDER_NAME &&\n                !this.mechanismProperties.REQUEST_TOKEN_CALLBACK) {\n                throw new error_1.MongoInvalidArgumentError(`Either a PROVIDER_NAME or a REQUEST_TOKEN_CALLBACK must be specified for mechanism '${this.mechanism}'.`);\n            }\n            if (this.mechanismProperties.ALLOWED_HOSTS) {\n                const hosts = this.mechanismProperties.ALLOWED_HOSTS;\n                if (!Array.isArray(hosts)) {\n                    throw new error_1.MongoInvalidArgumentError(ALLOWED_HOSTS_ERROR);\n                }\n                for (const host of hosts) {\n                    if (typeof host !== 'string') {\n                        throw new error_1.MongoInvalidArgumentError(ALLOWED_HOSTS_ERROR);\n                    }\n                }\n            }\n        }\n        if (providers_1.AUTH_MECHS_AUTH_SRC_EXTERNAL.has(this.mechanism)) {\n            if (this.source != null && this.source !== '$external') {\n                // TODO(NODE-3485): Replace this with a MongoAuthValidationError\n                throw new error_1.MongoAPIError(`Invalid source '${this.source}' for mechanism '${this.mechanism}' specified.`);\n            }\n        }\n        if (this.mechanism === providers_1.AuthMechanism.MONGODB_PLAIN && this.source == null) {\n            // TODO(NODE-3485): Replace this with a MongoAuthValidationError\n            throw new error_1.MongoAPIError('PLAIN Authentication Mechanism needs an auth source');\n        }\n        if (this.mechanism === providers_1.AuthMechanism.MONGODB_X509 && this.password != null) {\n            if (this.password === '') {\n                Reflect.set(this, 'password', undefined);\n                return;\n            }\n            // TODO(NODE-3485): Replace this with a MongoAuthValidationError\n            throw new error_1.MongoAPIError(`Password not allowed for mechanism MONGODB-X509`);\n        }\n        const canonicalization = this.mechanismProperties.CANONICALIZE_HOST_NAME ?? false;\n        if (!Object.values(gssapi_1.GSSAPICanonicalizationValue).includes(canonicalization)) {\n            throw new error_1.MongoAPIError(`Invalid CANONICALIZE_HOST_NAME value: ${canonicalization}`);\n        }\n    }\n    static merge(creds, options) {\n        return new MongoCredentials({\n            username: options.username ?? creds?.username ?? '',\n            password: options.password ?? creds?.password ?? '',\n            mechanism: options.mechanism ?? creds?.mechanism ?? providers_1.AuthMechanism.MONGODB_DEFAULT,\n            mechanismProperties: options.mechanismProperties ?? creds?.mechanismProperties ?? {},\n            source: options.source ?? options.db ?? creds?.source ?? 'admin'\n        });\n    }\n}\nexports.MongoCredentials = MongoCredentials;\n//# sourceMappingURL=mongo_credentials.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jbWFwL2F1dGgvbW9uZ29fY3JlZGVudGlhbHMuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0Qsd0JBQXdCLEdBQUcsNkJBQTZCO0FBQ3hELGdCQUFnQixtQkFBTyxDQUFDLHNFQUFhO0FBQ3JDLGlCQUFpQixtQkFBTyxDQUFDLDhFQUFVO0FBQ25DLG9CQUFvQixtQkFBTyxDQUFDLG9GQUFhO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QjtBQUM3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrRkFBK0YsZUFBZTtBQUM5RztBQUNBO0FBQ0E7QUFDQSxrSUFBa0ksZUFBZTtBQUNqSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlHQUFpRyxrQ0FBa0MsOEJBQThCLGVBQWU7QUFDaEw7QUFDQTtBQUNBO0FBQ0EsNEpBQTRKLGVBQWU7QUFDM0s7QUFDQTtBQUNBO0FBQ0EsbUpBQW1KLGVBQWU7QUFDbEs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtRUFBbUUsWUFBWSxtQkFBbUIsZUFBZTtBQUNqSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFGQUFxRixpQkFBaUI7QUFDdEc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnR0FBZ0c7QUFDaEc7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLHdCQUF3QjtBQUN4QiIsInNvdXJjZXMiOlsiRDpcXHNhbG9uaVxcYXBwcmFpc2FsLXN5c3RlbVxcc2VydmVyXFxub2RlX21vZHVsZXNcXG1vbmdvZGJcXGxpYlxcY21hcFxcYXV0aFxcbW9uZ29fY3JlZGVudGlhbHMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1vbmdvQ3JlZGVudGlhbHMgPSBleHBvcnRzLkRFRkFVTFRfQUxMT1dFRF9IT1NUUyA9IHZvaWQgMDtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi4vLi4vZXJyb3JcIik7XG5jb25zdCBnc3NhcGlfMSA9IHJlcXVpcmUoXCIuL2dzc2FwaVwiKTtcbmNvbnN0IHByb3ZpZGVyc18xID0gcmVxdWlyZShcIi4vcHJvdmlkZXJzXCIpO1xuLy8gaHR0cHM6Ly9naXRodWIuY29tL21vbmdvZGIvc3BlY2lmaWNhdGlvbnMvYmxvYi9tYXN0ZXIvc291cmNlL2F1dGgvYXV0aC5yc3RcbmZ1bmN0aW9uIGdldERlZmF1bHRBdXRoTWVjaGFuaXNtKGhlbGxvKSB7XG4gICAgaWYgKGhlbGxvKSB7XG4gICAgICAgIC8vIElmIGhlbGxvIGNvbnRhaW5zIHNhc2xTdXBwb3J0ZWRNZWNocywgdXNlIHNjcmFtLXNoYS0yNTZcbiAgICAgICAgLy8gaWYgaXQgaXMgYXZhaWxhYmxlLCBlbHNlIHNjcmFtLXNoYS0xXG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KGhlbGxvLnNhc2xTdXBwb3J0ZWRNZWNocykpIHtcbiAgICAgICAgICAgIHJldHVybiBoZWxsby5zYXNsU3VwcG9ydGVkTWVjaHMuaW5jbHVkZXMocHJvdmlkZXJzXzEuQXV0aE1lY2hhbmlzbS5NT05HT0RCX1NDUkFNX1NIQTI1NilcbiAgICAgICAgICAgICAgICA/IHByb3ZpZGVyc18xLkF1dGhNZWNoYW5pc20uTU9OR09EQl9TQ1JBTV9TSEEyNTZcbiAgICAgICAgICAgICAgICA6IHByb3ZpZGVyc18xLkF1dGhNZWNoYW5pc20uTU9OR09EQl9TQ1JBTV9TSEExO1xuICAgICAgICB9XG4gICAgICAgIC8vIEZhbGxiYWNrIHRvIGxlZ2FjeSBzZWxlY3Rpb24gbWV0aG9kLiBJZiB3aXJlIHZlcnNpb24gPj0gMywgdXNlIHNjcmFtLXNoYS0xXG4gICAgICAgIGlmIChoZWxsby5tYXhXaXJlVmVyc2lvbiA+PSAzKSB7XG4gICAgICAgICAgICByZXR1cm4gcHJvdmlkZXJzXzEuQXV0aE1lY2hhbmlzbS5NT05HT0RCX1NDUkFNX1NIQTE7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gRGVmYXVsdCBmb3Igd2lyZXByb3RvY29sIDwgM1xuICAgIHJldHVybiBwcm92aWRlcnNfMS5BdXRoTWVjaGFuaXNtLk1PTkdPREJfQ1I7XG59XG5jb25zdCBBTExPV0VEX1BST1ZJREVSX05BTUVTID0gWydhd3MnLCAnYXp1cmUnXTtcbmNvbnN0IEFMTE9XRURfSE9TVFNfRVJST1IgPSAnQXV0aCBtZWNoYW5pc20gcHJvcGVydHkgQUxMT1dFRF9IT1NUUyBtdXN0IGJlIGFuIGFycmF5IG9mIHN0cmluZ3MuJztcbi8qKiBAaW50ZXJuYWwgKi9cbmV4cG9ydHMuREVGQVVMVF9BTExPV0VEX0hPU1RTID0gW1xuICAgICcqLm1vbmdvZGIubmV0JyxcbiAgICAnKi5tb25nb2RiLWRldi5uZXQnLFxuICAgICcqLm1vbmdvZGJnb3YubmV0JyxcbiAgICAnbG9jYWxob3N0JyxcbiAgICAnMTI3LjAuMC4xJyxcbiAgICAnOjoxJ1xuXTtcbi8qKiBFcnJvciBmb3Igd2hlbiB0aGUgdG9rZW4gYXVkaWVuY2UgaXMgbWlzc2luZyBpbiB0aGUgZW52aXJvbm1lbnQuICovXG5jb25zdCBUT0tFTl9BVURJRU5DRV9NSVNTSU5HX0VSUk9SID0gJ1RPS0VOX0FVRElFTkNFIG11c3QgYmUgc2V0IGluIHRoZSBhdXRoIG1lY2hhbmlzbSBwcm9wZXJ0aWVzIHdoZW4gUFJPVklERVJfTkFNRSBpcyBhenVyZS4nO1xuLyoqXG4gKiBBIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBjcmVkZW50aWFscyB1c2VkIGJ5IE1vbmdvREJcbiAqIEBwdWJsaWNcbiAqL1xuY2xhc3MgTW9uZ29DcmVkZW50aWFscyB7XG4gICAgY29uc3RydWN0b3Iob3B0aW9ucykge1xuICAgICAgICB0aGlzLnVzZXJuYW1lID0gb3B0aW9ucy51c2VybmFtZSA/PyAnJztcbiAgICAgICAgdGhpcy5wYXNzd29yZCA9IG9wdGlvbnMucGFzc3dvcmQ7XG4gICAgICAgIHRoaXMuc291cmNlID0gb3B0aW9ucy5zb3VyY2U7XG4gICAgICAgIGlmICghdGhpcy5zb3VyY2UgJiYgb3B0aW9ucy5kYikge1xuICAgICAgICAgICAgdGhpcy5zb3VyY2UgPSBvcHRpb25zLmRiO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubWVjaGFuaXNtID0gb3B0aW9ucy5tZWNoYW5pc20gfHwgcHJvdmlkZXJzXzEuQXV0aE1lY2hhbmlzbS5NT05HT0RCX0RFRkFVTFQ7XG4gICAgICAgIHRoaXMubWVjaGFuaXNtUHJvcGVydGllcyA9IG9wdGlvbnMubWVjaGFuaXNtUHJvcGVydGllcyB8fCB7fTtcbiAgICAgICAgaWYgKHRoaXMubWVjaGFuaXNtLm1hdGNoKC9NT05HT0RCLUFXUy9pKSkge1xuICAgICAgICAgICAgaWYgKCF0aGlzLnVzZXJuYW1lICYmIHByb2Nlc3MuZW52LkFXU19BQ0NFU1NfS0VZX0lEKSB7XG4gICAgICAgICAgICAgICAgdGhpcy51c2VybmFtZSA9IHByb2Nlc3MuZW52LkFXU19BQ0NFU1NfS0VZX0lEO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCF0aGlzLnBhc3N3b3JkICYmIHByb2Nlc3MuZW52LkFXU19TRUNSRVRfQUNDRVNTX0tFWSkge1xuICAgICAgICAgICAgICAgIHRoaXMucGFzc3dvcmQgPSBwcm9jZXNzLmVudi5BV1NfU0VDUkVUX0FDQ0VTU19LRVk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5tZWNoYW5pc21Qcm9wZXJ0aWVzLkFXU19TRVNTSU9OX1RPS0VOID09IG51bGwgJiZcbiAgICAgICAgICAgICAgICBwcm9jZXNzLmVudi5BV1NfU0VTU0lPTl9UT0tFTiAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5tZWNoYW5pc21Qcm9wZXJ0aWVzID0ge1xuICAgICAgICAgICAgICAgICAgICAuLi50aGlzLm1lY2hhbmlzbVByb3BlcnRpZXMsXG4gICAgICAgICAgICAgICAgICAgIEFXU19TRVNTSU9OX1RPS0VOOiBwcm9jZXNzLmVudi5BV1NfU0VTU0lPTl9UT0tFTlxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMubWVjaGFuaXNtID09PSBwcm92aWRlcnNfMS5BdXRoTWVjaGFuaXNtLk1PTkdPREJfT0lEQyAmJiAhdGhpcy5tZWNoYW5pc21Qcm9wZXJ0aWVzLkFMTE9XRURfSE9TVFMpIHtcbiAgICAgICAgICAgIHRoaXMubWVjaGFuaXNtUHJvcGVydGllcyA9IHtcbiAgICAgICAgICAgICAgICAuLi50aGlzLm1lY2hhbmlzbVByb3BlcnRpZXMsXG4gICAgICAgICAgICAgICAgQUxMT1dFRF9IT1NUUzogZXhwb3J0cy5ERUZBVUxUX0FMTE9XRURfSE9TVFNcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgT2JqZWN0LmZyZWV6ZSh0aGlzLm1lY2hhbmlzbVByb3BlcnRpZXMpO1xuICAgICAgICBPYmplY3QuZnJlZXplKHRoaXMpO1xuICAgIH1cbiAgICAvKiogRGV0ZXJtaW5lcyBpZiB0d28gTW9uZ29DcmVkZW50aWFscyBvYmplY3RzIGFyZSBlcXVpdmFsZW50ICovXG4gICAgZXF1YWxzKG90aGVyKSB7XG4gICAgICAgIHJldHVybiAodGhpcy5tZWNoYW5pc20gPT09IG90aGVyLm1lY2hhbmlzbSAmJlxuICAgICAgICAgICAgdGhpcy51c2VybmFtZSA9PT0gb3RoZXIudXNlcm5hbWUgJiZcbiAgICAgICAgICAgIHRoaXMucGFzc3dvcmQgPT09IG90aGVyLnBhc3N3b3JkICYmXG4gICAgICAgICAgICB0aGlzLnNvdXJjZSA9PT0gb3RoZXIuc291cmNlKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogSWYgdGhlIGF1dGhlbnRpY2F0aW9uIG1lY2hhbmlzbSBpcyBzZXQgdG8gXCJkZWZhdWx0XCIsIHJlc29sdmVzIHRoZSBhdXRoTWVjaGFuaXNtXG4gICAgICogYmFzZWQgb24gdGhlIHNlcnZlciB2ZXJzaW9uIGFuZCBzZXJ2ZXIgc3VwcG9ydGVkIHNhc2wgbWVjaGFuaXNtcy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBoZWxsbyAtIEEgaGVsbG8gcmVzcG9uc2UgZnJvbSB0aGUgc2VydmVyXG4gICAgICovXG4gICAgcmVzb2x2ZUF1dGhNZWNoYW5pc20oaGVsbG8pIHtcbiAgICAgICAgLy8gSWYgdGhlIG1lY2hhbmlzbSBpcyBub3QgXCJkZWZhdWx0XCIsIHRoZW4gaXQgZG9lcyBub3QgbmVlZCB0byBiZSByZXNvbHZlZFxuICAgICAgICBpZiAodGhpcy5tZWNoYW5pc20ubWF0Y2goL0RFRkFVTFQvaSkpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgTW9uZ29DcmVkZW50aWFscyh7XG4gICAgICAgICAgICAgICAgdXNlcm5hbWU6IHRoaXMudXNlcm5hbWUsXG4gICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHRoaXMucGFzc3dvcmQsXG4gICAgICAgICAgICAgICAgc291cmNlOiB0aGlzLnNvdXJjZSxcbiAgICAgICAgICAgICAgICBtZWNoYW5pc206IGdldERlZmF1bHRBdXRoTWVjaGFuaXNtKGhlbGxvKSxcbiAgICAgICAgICAgICAgICBtZWNoYW5pc21Qcm9wZXJ0aWVzOiB0aGlzLm1lY2hhbmlzbVByb3BlcnRpZXNcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICB2YWxpZGF0ZSgpIHtcbiAgICAgICAgaWYgKCh0aGlzLm1lY2hhbmlzbSA9PT0gcHJvdmlkZXJzXzEuQXV0aE1lY2hhbmlzbS5NT05HT0RCX0dTU0FQSSB8fFxuICAgICAgICAgICAgdGhpcy5tZWNoYW5pc20gPT09IHByb3ZpZGVyc18xLkF1dGhNZWNoYW5pc20uTU9OR09EQl9DUiB8fFxuICAgICAgICAgICAgdGhpcy5tZWNoYW5pc20gPT09IHByb3ZpZGVyc18xLkF1dGhNZWNoYW5pc20uTU9OR09EQl9QTEFJTiB8fFxuICAgICAgICAgICAgdGhpcy5tZWNoYW5pc20gPT09IHByb3ZpZGVyc18xLkF1dGhNZWNoYW5pc20uTU9OR09EQl9TQ1JBTV9TSEExIHx8XG4gICAgICAgICAgICB0aGlzLm1lY2hhbmlzbSA9PT0gcHJvdmlkZXJzXzEuQXV0aE1lY2hhbmlzbS5NT05HT0RCX1NDUkFNX1NIQTI1NikgJiZcbiAgICAgICAgICAgICF0aGlzLnVzZXJuYW1lKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb01pc3NpbmdDcmVkZW50aWFsc0Vycm9yKGBVc2VybmFtZSByZXF1aXJlZCBmb3IgbWVjaGFuaXNtICcke3RoaXMubWVjaGFuaXNtfSdgKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5tZWNoYW5pc20gPT09IHByb3ZpZGVyc18xLkF1dGhNZWNoYW5pc20uTU9OR09EQl9PSURDKSB7XG4gICAgICAgICAgICBpZiAodGhpcy51c2VybmFtZSAmJiB0aGlzLm1lY2hhbmlzbVByb3BlcnRpZXMuUFJPVklERVJfTkFNRSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoYHVzZXJuYW1lIGFuZCBQUk9WSURFUl9OQU1FIG1heSBub3QgYmUgdXNlZCB0b2dldGhlciBmb3IgbWVjaGFuaXNtICcke3RoaXMubWVjaGFuaXNtfScuYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5tZWNoYW5pc21Qcm9wZXJ0aWVzLlBST1ZJREVSX05BTUUgPT09ICdhenVyZScgJiZcbiAgICAgICAgICAgICAgICAhdGhpcy5tZWNoYW5pc21Qcm9wZXJ0aWVzLlRPS0VOX0FVRElFTkNFKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29BenVyZUVycm9yKFRPS0VOX0FVRElFTkNFX01JU1NJTkdfRVJST1IpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMubWVjaGFuaXNtUHJvcGVydGllcy5QUk9WSURFUl9OQU1FICYmXG4gICAgICAgICAgICAgICAgIUFMTE9XRURfUFJPVklERVJfTkFNRVMuaW5jbHVkZXModGhpcy5tZWNoYW5pc21Qcm9wZXJ0aWVzLlBST1ZJREVSX05BTUUpKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcihgQ3VycmVudGx5IG9ubHkgYSBQUk9WSURFUl9OQU1FIGluICR7QUxMT1dFRF9QUk9WSURFUl9OQU1FUy5qb2luKCcsJyl9IGlzIHN1cHBvcnRlZCBmb3IgbWVjaGFuaXNtICcke3RoaXMubWVjaGFuaXNtfScuYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5tZWNoYW5pc21Qcm9wZXJ0aWVzLlJFRlJFU0hfVE9LRU5fQ0FMTEJBQ0sgJiZcbiAgICAgICAgICAgICAgICAhdGhpcy5tZWNoYW5pc21Qcm9wZXJ0aWVzLlJFUVVFU1RfVE9LRU5fQ0FMTEJBQ0spIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKGBBIFJFUVVFU1RfVE9LRU5fQ0FMTEJBQ0sgbXVzdCBiZSBwcm92aWRlZCB3aGVuIHVzaW5nIGEgUkVGUkVTSF9UT0tFTl9DQUxMQkFDSyBmb3IgbWVjaGFuaXNtICcke3RoaXMubWVjaGFuaXNtfSdgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghdGhpcy5tZWNoYW5pc21Qcm9wZXJ0aWVzLlBST1ZJREVSX05BTUUgJiZcbiAgICAgICAgICAgICAgICAhdGhpcy5tZWNoYW5pc21Qcm9wZXJ0aWVzLlJFUVVFU1RfVE9LRU5fQ0FMTEJBQ0spIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKGBFaXRoZXIgYSBQUk9WSURFUl9OQU1FIG9yIGEgUkVRVUVTVF9UT0tFTl9DQUxMQkFDSyBtdXN0IGJlIHNwZWNpZmllZCBmb3IgbWVjaGFuaXNtICcke3RoaXMubWVjaGFuaXNtfScuYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5tZWNoYW5pc21Qcm9wZXJ0aWVzLkFMTE9XRURfSE9TVFMpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBob3N0cyA9IHRoaXMubWVjaGFuaXNtUHJvcGVydGllcy5BTExPV0VEX0hPU1RTO1xuICAgICAgICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheShob3N0cykpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcihBTExPV0VEX0hPU1RTX0VSUk9SKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBob3N0IG9mIGhvc3RzKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgaG9zdCAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoQUxMT1dFRF9IT1NUU19FUlJPUik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHByb3ZpZGVyc18xLkFVVEhfTUVDSFNfQVVUSF9TUkNfRVhURVJOQUwuaGFzKHRoaXMubWVjaGFuaXNtKSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuc291cmNlICE9IG51bGwgJiYgdGhpcy5zb3VyY2UgIT09ICckZXh0ZXJuYWwnKSB7XG4gICAgICAgICAgICAgICAgLy8gVE9ETyhOT0RFLTM0ODUpOiBSZXBsYWNlIHRoaXMgd2l0aCBhIE1vbmdvQXV0aFZhbGlkYXRpb25FcnJvclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvQVBJRXJyb3IoYEludmFsaWQgc291cmNlICcke3RoaXMuc291cmNlfScgZm9yIG1lY2hhbmlzbSAnJHt0aGlzLm1lY2hhbmlzbX0nIHNwZWNpZmllZC5gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5tZWNoYW5pc20gPT09IHByb3ZpZGVyc18xLkF1dGhNZWNoYW5pc20uTU9OR09EQl9QTEFJTiAmJiB0aGlzLnNvdXJjZSA9PSBudWxsKSB7XG4gICAgICAgICAgICAvLyBUT0RPKE5PREUtMzQ4NSk6IFJlcGxhY2UgdGhpcyB3aXRoIGEgTW9uZ29BdXRoVmFsaWRhdGlvbkVycm9yXG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0FQSUVycm9yKCdQTEFJTiBBdXRoZW50aWNhdGlvbiBNZWNoYW5pc20gbmVlZHMgYW4gYXV0aCBzb3VyY2UnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5tZWNoYW5pc20gPT09IHByb3ZpZGVyc18xLkF1dGhNZWNoYW5pc20uTU9OR09EQl9YNTA5ICYmIHRoaXMucGFzc3dvcmQgIT0gbnVsbCkge1xuICAgICAgICAgICAgaWYgKHRoaXMucGFzc3dvcmQgPT09ICcnKSB7XG4gICAgICAgICAgICAgICAgUmVmbGVjdC5zZXQodGhpcywgJ3Bhc3N3b3JkJywgdW5kZWZpbmVkKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBUT0RPKE5PREUtMzQ4NSk6IFJlcGxhY2UgdGhpcyB3aXRoIGEgTW9uZ29BdXRoVmFsaWRhdGlvbkVycm9yXG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0FQSUVycm9yKGBQYXNzd29yZCBub3QgYWxsb3dlZCBmb3IgbWVjaGFuaXNtIE1PTkdPREItWDUwOWApO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNhbm9uaWNhbGl6YXRpb24gPSB0aGlzLm1lY2hhbmlzbVByb3BlcnRpZXMuQ0FOT05JQ0FMSVpFX0hPU1RfTkFNRSA/PyBmYWxzZTtcbiAgICAgICAgaWYgKCFPYmplY3QudmFsdWVzKGdzc2FwaV8xLkdTU0FQSUNhbm9uaWNhbGl6YXRpb25WYWx1ZSkuaW5jbHVkZXMoY2Fub25pY2FsaXphdGlvbikpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvQVBJRXJyb3IoYEludmFsaWQgQ0FOT05JQ0FMSVpFX0hPU1RfTkFNRSB2YWx1ZTogJHtjYW5vbmljYWxpemF0aW9ufWApO1xuICAgICAgICB9XG4gICAgfVxuICAgIHN0YXRpYyBtZXJnZShjcmVkcywgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4gbmV3IE1vbmdvQ3JlZGVudGlhbHMoe1xuICAgICAgICAgICAgdXNlcm5hbWU6IG9wdGlvbnMudXNlcm5hbWUgPz8gY3JlZHM/LnVzZXJuYW1lID8/ICcnLFxuICAgICAgICAgICAgcGFzc3dvcmQ6IG9wdGlvbnMucGFzc3dvcmQgPz8gY3JlZHM/LnBhc3N3b3JkID8/ICcnLFxuICAgICAgICAgICAgbWVjaGFuaXNtOiBvcHRpb25zLm1lY2hhbmlzbSA/PyBjcmVkcz8ubWVjaGFuaXNtID8/IHByb3ZpZGVyc18xLkF1dGhNZWNoYW5pc20uTU9OR09EQl9ERUZBVUxULFxuICAgICAgICAgICAgbWVjaGFuaXNtUHJvcGVydGllczogb3B0aW9ucy5tZWNoYW5pc21Qcm9wZXJ0aWVzID8/IGNyZWRzPy5tZWNoYW5pc21Qcm9wZXJ0aWVzID8/IHt9LFxuICAgICAgICAgICAgc291cmNlOiBvcHRpb25zLnNvdXJjZSA/PyBvcHRpb25zLmRiID8/IGNyZWRzPy5zb3VyY2UgPz8gJ2FkbWluJ1xuICAgICAgICB9KTtcbiAgICB9XG59XG5leHBvcnRzLk1vbmdvQ3JlZGVudGlhbHMgPSBNb25nb0NyZWRlbnRpYWxzO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9bW9uZ29fY3JlZGVudGlhbHMuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/cmap/auth/mongo_credentials.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/cmap/auth/mongocr.js":
/*!***************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/cmap/auth/mongocr.js ***!
  \***************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.MongoCR = void 0;\nconst crypto = __webpack_require__(/*! crypto */ \"crypto\");\nconst error_1 = __webpack_require__(/*! ../../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst utils_1 = __webpack_require__(/*! ../../utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\nconst auth_provider_1 = __webpack_require__(/*! ./auth_provider */ \"(api)/../server/node_modules/mongodb/lib/cmap/auth/auth_provider.js\");\nclass MongoCR extends auth_provider_1.AuthProvider {\n    async auth(authContext) {\n        const { connection, credentials } = authContext;\n        if (!credentials) {\n            throw new error_1.MongoMissingCredentialsError('AuthContext must provide credentials.');\n        }\n        const { username, password, source } = credentials;\n        const { nonce } = await connection.commandAsync((0, utils_1.ns)(`${source}.$cmd`), { getnonce: 1 }, undefined);\n        const hashPassword = crypto\n            .createHash('md5')\n            .update(`${username}:mongo:${password}`, 'utf8')\n            .digest('hex');\n        // Final key\n        const key = crypto\n            .createHash('md5')\n            .update(`${nonce}${username}${hashPassword}`, 'utf8')\n            .digest('hex');\n        const authenticateCommand = {\n            authenticate: 1,\n            user: username,\n            nonce,\n            key\n        };\n        await connection.commandAsync((0, utils_1.ns)(`${source}.$cmd`), authenticateCommand, undefined);\n    }\n}\nexports.MongoCR = MongoCR;\n//# sourceMappingURL=mongocr.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jbWFwL2F1dGgvbW9uZ29jci5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxlQUFlO0FBQ2YsZUFBZSxtQkFBTyxDQUFDLHNCQUFRO0FBQy9CLGdCQUFnQixtQkFBTyxDQUFDLHNFQUFhO0FBQ3JDLGdCQUFnQixtQkFBTyxDQUFDLHNFQUFhO0FBQ3JDLHdCQUF3QixtQkFBTyxDQUFDLDRGQUFpQjtBQUNqRDtBQUNBO0FBQ0EsZ0JBQWdCLDBCQUEwQjtBQUMxQztBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsNkJBQTZCO0FBQzdDLGdCQUFnQixRQUFRLG1EQUFtRCxPQUFPLFdBQVcsYUFBYTtBQUMxRztBQUNBO0FBQ0EsdUJBQXVCLFNBQVMsU0FBUyxTQUFTO0FBQ2xEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLE1BQU0sRUFBRSxTQUFTLEVBQUUsYUFBYTtBQUN2RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlEQUF5RCxPQUFPO0FBQ2hFO0FBQ0E7QUFDQSxlQUFlO0FBQ2YiLCJzb3VyY2VzIjpbIkQ6XFxzYWxvbmlcXGFwcHJhaXNhbC1zeXN0ZW1cXHNlcnZlclxcbm9kZV9tb2R1bGVzXFxtb25nb2RiXFxsaWJcXGNtYXBcXGF1dGhcXG1vbmdvY3IuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1vbmdvQ1IgPSB2b2lkIDA7XG5jb25zdCBjcnlwdG8gPSByZXF1aXJlKFwiY3J5cHRvXCIpO1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuLi8uLi9lcnJvclwiKTtcbmNvbnN0IHV0aWxzXzEgPSByZXF1aXJlKFwiLi4vLi4vdXRpbHNcIik7XG5jb25zdCBhdXRoX3Byb3ZpZGVyXzEgPSByZXF1aXJlKFwiLi9hdXRoX3Byb3ZpZGVyXCIpO1xuY2xhc3MgTW9uZ29DUiBleHRlbmRzIGF1dGhfcHJvdmlkZXJfMS5BdXRoUHJvdmlkZXIge1xuICAgIGFzeW5jIGF1dGgoYXV0aENvbnRleHQpIHtcbiAgICAgICAgY29uc3QgeyBjb25uZWN0aW9uLCBjcmVkZW50aWFscyB9ID0gYXV0aENvbnRleHQ7XG4gICAgICAgIGlmICghY3JlZGVudGlhbHMpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvTWlzc2luZ0NyZWRlbnRpYWxzRXJyb3IoJ0F1dGhDb250ZXh0IG11c3QgcHJvdmlkZSBjcmVkZW50aWFscy4nKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB7IHVzZXJuYW1lLCBwYXNzd29yZCwgc291cmNlIH0gPSBjcmVkZW50aWFscztcbiAgICAgICAgY29uc3QgeyBub25jZSB9ID0gYXdhaXQgY29ubmVjdGlvbi5jb21tYW5kQXN5bmMoKDAsIHV0aWxzXzEubnMpKGAke3NvdXJjZX0uJGNtZGApLCB7IGdldG5vbmNlOiAxIH0sIHVuZGVmaW5lZCk7XG4gICAgICAgIGNvbnN0IGhhc2hQYXNzd29yZCA9IGNyeXB0b1xuICAgICAgICAgICAgLmNyZWF0ZUhhc2goJ21kNScpXG4gICAgICAgICAgICAudXBkYXRlKGAke3VzZXJuYW1lfTptb25nbzoke3Bhc3N3b3JkfWAsICd1dGY4JylcbiAgICAgICAgICAgIC5kaWdlc3QoJ2hleCcpO1xuICAgICAgICAvLyBGaW5hbCBrZXlcbiAgICAgICAgY29uc3Qga2V5ID0gY3J5cHRvXG4gICAgICAgICAgICAuY3JlYXRlSGFzaCgnbWQ1JylcbiAgICAgICAgICAgIC51cGRhdGUoYCR7bm9uY2V9JHt1c2VybmFtZX0ke2hhc2hQYXNzd29yZH1gLCAndXRmOCcpXG4gICAgICAgICAgICAuZGlnZXN0KCdoZXgnKTtcbiAgICAgICAgY29uc3QgYXV0aGVudGljYXRlQ29tbWFuZCA9IHtcbiAgICAgICAgICAgIGF1dGhlbnRpY2F0ZTogMSxcbiAgICAgICAgICAgIHVzZXI6IHVzZXJuYW1lLFxuICAgICAgICAgICAgbm9uY2UsXG4gICAgICAgICAgICBrZXlcbiAgICAgICAgfTtcbiAgICAgICAgYXdhaXQgY29ubmVjdGlvbi5jb21tYW5kQXN5bmMoKDAsIHV0aWxzXzEubnMpKGAke3NvdXJjZX0uJGNtZGApLCBhdXRoZW50aWNhdGVDb21tYW5kLCB1bmRlZmluZWQpO1xuICAgIH1cbn1cbmV4cG9ydHMuTW9uZ29DUiA9IE1vbmdvQ1I7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1tb25nb2NyLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/cmap/auth/mongocr.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/cmap/auth/mongodb_aws.js":
/*!*******************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/cmap/auth/mongodb_aws.js ***!
  \*******************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.MongoDBAWS = void 0;\nconst crypto = __webpack_require__(/*! crypto */ \"crypto\");\nconst process = __webpack_require__(/*! process */ \"process\");\nconst util_1 = __webpack_require__(/*! util */ \"util\");\nconst BSON = __webpack_require__(/*! ../../bson */ \"(api)/../server/node_modules/mongodb/lib/bson.js\");\nconst deps_1 = __webpack_require__(/*! ../../deps */ \"(api)/../server/node_modules/mongodb/lib/deps.js\");\nconst error_1 = __webpack_require__(/*! ../../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst utils_1 = __webpack_require__(/*! ../../utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\nconst auth_provider_1 = __webpack_require__(/*! ./auth_provider */ \"(api)/../server/node_modules/mongodb/lib/cmap/auth/auth_provider.js\");\nconst mongo_credentials_1 = __webpack_require__(/*! ./mongo_credentials */ \"(api)/../server/node_modules/mongodb/lib/cmap/auth/mongo_credentials.js\");\nconst providers_1 = __webpack_require__(/*! ./providers */ \"(api)/../server/node_modules/mongodb/lib/cmap/auth/providers.js\");\n/**\n * The following regions use the global AWS STS endpoint, sts.amazonaws.com, by default\n * https://docs.aws.amazon.com/sdkref/latest/guide/feature-sts-regionalized-endpoints.html\n */\nconst LEGACY_REGIONS = new Set([\n    'ap-northeast-1',\n    'ap-south-1',\n    'ap-southeast-1',\n    'ap-southeast-2',\n    'aws-global',\n    'ca-central-1',\n    'eu-central-1',\n    'eu-north-1',\n    'eu-west-1',\n    'eu-west-2',\n    'eu-west-3',\n    'sa-east-1',\n    'us-east-1',\n    'us-east-2',\n    'us-west-1',\n    'us-west-2'\n]);\nconst ASCII_N = 110;\nconst AWS_RELATIVE_URI = 'http://169.254.170.2';\nconst AWS_EC2_URI = 'http://169.254.169.254';\nconst AWS_EC2_PATH = '/latest/meta-data/iam/security-credentials';\nconst bsonOptions = {\n    useBigInt64: false,\n    promoteLongs: true,\n    promoteValues: true,\n    promoteBuffers: false,\n    bsonRegExp: false\n};\nclass MongoDBAWS extends auth_provider_1.AuthProvider {\n    constructor() {\n        super();\n        this.randomBytesAsync = (0, util_1.promisify)(crypto.randomBytes);\n    }\n    async auth(authContext) {\n        const { connection } = authContext;\n        if (!authContext.credentials) {\n            throw new error_1.MongoMissingCredentialsError('AuthContext must provide credentials.');\n        }\n        if ('kModuleError' in deps_1.aws4) {\n            throw deps_1.aws4['kModuleError'];\n        }\n        const { sign } = deps_1.aws4;\n        if ((0, utils_1.maxWireVersion)(connection) < 9) {\n            throw new error_1.MongoCompatibilityError('MONGODB-AWS authentication requires MongoDB version 4.4 or later');\n        }\n        if (!authContext.credentials.username) {\n            authContext.credentials = await makeTempCredentials(authContext.credentials);\n        }\n        const { credentials } = authContext;\n        const accessKeyId = credentials.username;\n        const secretAccessKey = credentials.password;\n        const sessionToken = credentials.mechanismProperties.AWS_SESSION_TOKEN;\n        // If all three defined, include sessionToken, else include username and pass, else no credentials\n        const awsCredentials = accessKeyId && secretAccessKey && sessionToken\n            ? { accessKeyId, secretAccessKey, sessionToken }\n            : accessKeyId && secretAccessKey\n                ? { accessKeyId, secretAccessKey }\n                : undefined;\n        const db = credentials.source;\n        const nonce = await this.randomBytesAsync(32);\n        const saslStart = {\n            saslStart: 1,\n            mechanism: 'MONGODB-AWS',\n            payload: BSON.serialize({ r: nonce, p: ASCII_N }, bsonOptions)\n        };\n        const saslStartResponse = await connection.commandAsync((0, utils_1.ns)(`${db}.$cmd`), saslStart, undefined);\n        const serverResponse = BSON.deserialize(saslStartResponse.payload.buffer, bsonOptions);\n        const host = serverResponse.h;\n        const serverNonce = serverResponse.s.buffer;\n        if (serverNonce.length !== 64) {\n            // TODO(NODE-3483)\n            throw new error_1.MongoRuntimeError(`Invalid server nonce length ${serverNonce.length}, expected 64`);\n        }\n        if (!utils_1.ByteUtils.equals(serverNonce.subarray(0, nonce.byteLength), nonce)) {\n            // throw because the serverNonce's leading 32 bytes must equal the client nonce's 32 bytes\n            // https://github.com/mongodb/specifications/blob/875446db44aade414011731840831f38a6c668df/source/auth/auth.rst#id11\n            // TODO(NODE-3483)\n            throw new error_1.MongoRuntimeError('Server nonce does not begin with client nonce');\n        }\n        if (host.length < 1 || host.length > 255 || host.indexOf('..') !== -1) {\n            // TODO(NODE-3483)\n            throw new error_1.MongoRuntimeError(`Server returned an invalid host: \"${host}\"`);\n        }\n        const body = 'Action=GetCallerIdentity&Version=2011-06-15';\n        const options = sign({\n            method: 'POST',\n            host,\n            region: deriveRegion(serverResponse.h),\n            service: 'sts',\n            headers: {\n                'Content-Type': 'application/x-www-form-urlencoded',\n                'Content-Length': body.length,\n                'X-MongoDB-Server-Nonce': utils_1.ByteUtils.toBase64(serverNonce),\n                'X-MongoDB-GS2-CB-Flag': 'n'\n            },\n            path: '/',\n            body\n        }, awsCredentials);\n        const payload = {\n            a: options.headers.Authorization,\n            d: options.headers['X-Amz-Date']\n        };\n        if (sessionToken) {\n            payload.t = sessionToken;\n        }\n        const saslContinue = {\n            saslContinue: 1,\n            conversationId: 1,\n            payload: BSON.serialize(payload, bsonOptions)\n        };\n        await connection.commandAsync((0, utils_1.ns)(`${db}.$cmd`), saslContinue, undefined);\n    }\n}\nMongoDBAWS.credentialProvider = null;\nexports.MongoDBAWS = MongoDBAWS;\nasync function makeTempCredentials(credentials) {\n    function makeMongoCredentialsFromAWSTemp(creds) {\n        if (!creds.AccessKeyId || !creds.SecretAccessKey || !creds.Token) {\n            throw new error_1.MongoMissingCredentialsError('Could not obtain temporary MONGODB-AWS credentials');\n        }\n        return new mongo_credentials_1.MongoCredentials({\n            username: creds.AccessKeyId,\n            password: creds.SecretAccessKey,\n            source: credentials.source,\n            mechanism: providers_1.AuthMechanism.MONGODB_AWS,\n            mechanismProperties: {\n                AWS_SESSION_TOKEN: creds.Token\n            }\n        });\n    }\n    MongoDBAWS.credentialProvider ?? (MongoDBAWS.credentialProvider = (0, deps_1.getAwsCredentialProvider)());\n    // Check if the AWS credential provider from the SDK is present. If not,\n    // use the old method.\n    if ('kModuleError' in MongoDBAWS.credentialProvider) {\n        // If the environment variable AWS_CONTAINER_CREDENTIALS_RELATIVE_URI\n        // is set then drivers MUST assume that it was set by an AWS ECS agent\n        if (process.env.AWS_CONTAINER_CREDENTIALS_RELATIVE_URI) {\n            return makeMongoCredentialsFromAWSTemp(await (0, utils_1.request)(`${AWS_RELATIVE_URI}${process.env.AWS_CONTAINER_CREDENTIALS_RELATIVE_URI}`));\n        }\n        // Otherwise assume we are on an EC2 instance\n        // get a token\n        const token = await (0, utils_1.request)(`${AWS_EC2_URI}/latest/api/token`, {\n            method: 'PUT',\n            json: false,\n            headers: { 'X-aws-ec2-metadata-token-ttl-seconds': 30 }\n        });\n        // get role name\n        const roleName = await (0, utils_1.request)(`${AWS_EC2_URI}/${AWS_EC2_PATH}`, {\n            json: false,\n            headers: { 'X-aws-ec2-metadata-token': token }\n        });\n        // get temp credentials\n        const creds = await (0, utils_1.request)(`${AWS_EC2_URI}/${AWS_EC2_PATH}/${roleName}`, {\n            headers: { 'X-aws-ec2-metadata-token': token }\n        });\n        return makeMongoCredentialsFromAWSTemp(creds);\n    }\n    else {\n        let { AWS_STS_REGIONAL_ENDPOINTS = '', AWS_REGION = '' } = process.env;\n        AWS_STS_REGIONAL_ENDPOINTS = AWS_STS_REGIONAL_ENDPOINTS.toLowerCase();\n        AWS_REGION = AWS_REGION.toLowerCase();\n        /** The option setting should work only for users who have explicit settings in their environment, the driver should not encode \"defaults\" */\n        const awsRegionSettingsExist = AWS_REGION.length !== 0 && AWS_STS_REGIONAL_ENDPOINTS.length !== 0;\n        /**\n         * If AWS_STS_REGIONAL_ENDPOINTS is set to regional, users are opting into the new behavior of respecting the region settings\n         *\n         * If AWS_STS_REGIONAL_ENDPOINTS is set to legacy, then \"old\" regions need to keep using the global setting.\n         * Technically the SDK gets this wrong, it reaches out to 'sts.us-east-1.amazonaws.com' when it should be 'sts.amazonaws.com'.\n         * That is not our bug to fix here. We leave that up to the SDK.\n         */\n        const useRegionalSts = AWS_STS_REGIONAL_ENDPOINTS === 'regional' ||\n            (AWS_STS_REGIONAL_ENDPOINTS === 'legacy' && !LEGACY_REGIONS.has(AWS_REGION));\n        const provider = awsRegionSettingsExist && useRegionalSts\n            ? MongoDBAWS.credentialProvider.fromNodeProviderChain({\n                clientConfig: { region: AWS_REGION }\n            })\n            : MongoDBAWS.credentialProvider.fromNodeProviderChain();\n        /*\n         * Creates a credential provider that will attempt to find credentials from the\n         * following sources (listed in order of precedence):\n         *\n         * - Environment variables exposed via process.env\n         * - SSO credentials from token cache\n         * - Web identity token credentials\n         * - Shared credentials and config ini files\n         * - The EC2/ECS Instance Metadata Service\n         */\n        try {\n            const creds = await provider();\n            return makeMongoCredentialsFromAWSTemp({\n                AccessKeyId: creds.accessKeyId,\n                SecretAccessKey: creds.secretAccessKey,\n                Token: creds.sessionToken,\n                Expiration: creds.expiration\n            });\n        }\n        catch (error) {\n            throw new error_1.MongoAWSError(error.message);\n        }\n    }\n}\nfunction deriveRegion(host) {\n    const parts = host.split('.');\n    if (parts.length === 1 || parts[1] === 'amazonaws') {\n        return 'us-east-1';\n    }\n    return parts[1];\n}\n//# sourceMappingURL=mongodb_aws.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jbWFwL2F1dGgvbW9uZ29kYl9hd3MuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0Qsa0JBQWtCO0FBQ2xCLGVBQWUsbUJBQU8sQ0FBQyxzQkFBUTtBQUMvQixnQkFBZ0IsbUJBQU8sQ0FBQyx3QkFBUztBQUNqQyxlQUFlLG1CQUFPLENBQUMsa0JBQU07QUFDN0IsYUFBYSxtQkFBTyxDQUFDLG9FQUFZO0FBQ2pDLGVBQWUsbUJBQU8sQ0FBQyxvRUFBWTtBQUNuQyxnQkFBZ0IsbUJBQU8sQ0FBQyxzRUFBYTtBQUNyQyxnQkFBZ0IsbUJBQU8sQ0FBQyxzRUFBYTtBQUNyQyx3QkFBd0IsbUJBQU8sQ0FBQyw0RkFBaUI7QUFDakQsNEJBQTRCLG1CQUFPLENBQUMsb0dBQXFCO0FBQ3pELG9CQUFvQixtQkFBTyxDQUFDLG9GQUFhO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixhQUFhO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixPQUFPO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixjQUFjO0FBQzlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0I7QUFDaEI7QUFDQSxvQkFBb0I7QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0NBQXNDLHNCQUFzQjtBQUM1RDtBQUNBLG1GQUFtRixHQUFHO0FBQ3RGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrRUFBK0UsbUJBQW1CO0FBQ2xHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFGQUFxRixLQUFLO0FBQzFGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlEQUF5RCxHQUFHO0FBQzVEO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQjtBQUNsQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUZBQWlGLGlCQUFpQixFQUFFLG1EQUFtRDtBQUN2SjtBQUNBO0FBQ0E7QUFDQSxvREFBb0QsWUFBWTtBQUNoRTtBQUNBO0FBQ0EsdUJBQXVCO0FBQ3ZCLFNBQVM7QUFDVDtBQUNBLHVEQUF1RCxZQUFZLEdBQUcsYUFBYTtBQUNuRjtBQUNBLHVCQUF1QjtBQUN2QixTQUFTO0FBQ1Q7QUFDQSxvREFBb0QsWUFBWSxHQUFHLGFBQWEsR0FBRyxTQUFTO0FBQzVGLHVCQUF1QjtBQUN2QixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsY0FBYyxtREFBbUQ7QUFDakU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDO0FBQ2hDLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsiRDpcXHNhbG9uaVxcYXBwcmFpc2FsLXN5c3RlbVxcc2VydmVyXFxub2RlX21vZHVsZXNcXG1vbmdvZGJcXGxpYlxcY21hcFxcYXV0aFxcbW9uZ29kYl9hd3MuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1vbmdvREJBV1MgPSB2b2lkIDA7XG5jb25zdCBjcnlwdG8gPSByZXF1aXJlKFwiY3J5cHRvXCIpO1xuY29uc3QgcHJvY2VzcyA9IHJlcXVpcmUoXCJwcm9jZXNzXCIpO1xuY29uc3QgdXRpbF8xID0gcmVxdWlyZShcInV0aWxcIik7XG5jb25zdCBCU09OID0gcmVxdWlyZShcIi4uLy4uL2Jzb25cIik7XG5jb25zdCBkZXBzXzEgPSByZXF1aXJlKFwiLi4vLi4vZGVwc1wiKTtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi4vLi4vZXJyb3JcIik7XG5jb25zdCB1dGlsc18xID0gcmVxdWlyZShcIi4uLy4uL3V0aWxzXCIpO1xuY29uc3QgYXV0aF9wcm92aWRlcl8xID0gcmVxdWlyZShcIi4vYXV0aF9wcm92aWRlclwiKTtcbmNvbnN0IG1vbmdvX2NyZWRlbnRpYWxzXzEgPSByZXF1aXJlKFwiLi9tb25nb19jcmVkZW50aWFsc1wiKTtcbmNvbnN0IHByb3ZpZGVyc18xID0gcmVxdWlyZShcIi4vcHJvdmlkZXJzXCIpO1xuLyoqXG4gKiBUaGUgZm9sbG93aW5nIHJlZ2lvbnMgdXNlIHRoZSBnbG9iYWwgQVdTIFNUUyBlbmRwb2ludCwgc3RzLmFtYXpvbmF3cy5jb20sIGJ5IGRlZmF1bHRcbiAqIGh0dHBzOi8vZG9jcy5hd3MuYW1hem9uLmNvbS9zZGtyZWYvbGF0ZXN0L2d1aWRlL2ZlYXR1cmUtc3RzLXJlZ2lvbmFsaXplZC1lbmRwb2ludHMuaHRtbFxuICovXG5jb25zdCBMRUdBQ1lfUkVHSU9OUyA9IG5ldyBTZXQoW1xuICAgICdhcC1ub3J0aGVhc3QtMScsXG4gICAgJ2FwLXNvdXRoLTEnLFxuICAgICdhcC1zb3V0aGVhc3QtMScsXG4gICAgJ2FwLXNvdXRoZWFzdC0yJyxcbiAgICAnYXdzLWdsb2JhbCcsXG4gICAgJ2NhLWNlbnRyYWwtMScsXG4gICAgJ2V1LWNlbnRyYWwtMScsXG4gICAgJ2V1LW5vcnRoLTEnLFxuICAgICdldS13ZXN0LTEnLFxuICAgICdldS13ZXN0LTInLFxuICAgICdldS13ZXN0LTMnLFxuICAgICdzYS1lYXN0LTEnLFxuICAgICd1cy1lYXN0LTEnLFxuICAgICd1cy1lYXN0LTInLFxuICAgICd1cy13ZXN0LTEnLFxuICAgICd1cy13ZXN0LTInXG5dKTtcbmNvbnN0IEFTQ0lJX04gPSAxMTA7XG5jb25zdCBBV1NfUkVMQVRJVkVfVVJJID0gJ2h0dHA6Ly8xNjkuMjU0LjE3MC4yJztcbmNvbnN0IEFXU19FQzJfVVJJID0gJ2h0dHA6Ly8xNjkuMjU0LjE2OS4yNTQnO1xuY29uc3QgQVdTX0VDMl9QQVRIID0gJy9sYXRlc3QvbWV0YS1kYXRhL2lhbS9zZWN1cml0eS1jcmVkZW50aWFscyc7XG5jb25zdCBic29uT3B0aW9ucyA9IHtcbiAgICB1c2VCaWdJbnQ2NDogZmFsc2UsXG4gICAgcHJvbW90ZUxvbmdzOiB0cnVlLFxuICAgIHByb21vdGVWYWx1ZXM6IHRydWUsXG4gICAgcHJvbW90ZUJ1ZmZlcnM6IGZhbHNlLFxuICAgIGJzb25SZWdFeHA6IGZhbHNlXG59O1xuY2xhc3MgTW9uZ29EQkFXUyBleHRlbmRzIGF1dGhfcHJvdmlkZXJfMS5BdXRoUHJvdmlkZXIge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLnJhbmRvbUJ5dGVzQXN5bmMgPSAoMCwgdXRpbF8xLnByb21pc2lmeSkoY3J5cHRvLnJhbmRvbUJ5dGVzKTtcbiAgICB9XG4gICAgYXN5bmMgYXV0aChhdXRoQ29udGV4dCkge1xuICAgICAgICBjb25zdCB7IGNvbm5lY3Rpb24gfSA9IGF1dGhDb250ZXh0O1xuICAgICAgICBpZiAoIWF1dGhDb250ZXh0LmNyZWRlbnRpYWxzKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb01pc3NpbmdDcmVkZW50aWFsc0Vycm9yKCdBdXRoQ29udGV4dCBtdXN0IHByb3ZpZGUgY3JlZGVudGlhbHMuJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCdrTW9kdWxlRXJyb3InIGluIGRlcHNfMS5hd3M0KSB7XG4gICAgICAgICAgICB0aHJvdyBkZXBzXzEuYXdzNFsna01vZHVsZUVycm9yJ107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgeyBzaWduIH0gPSBkZXBzXzEuYXdzNDtcbiAgICAgICAgaWYgKCgwLCB1dGlsc18xLm1heFdpcmVWZXJzaW9uKShjb25uZWN0aW9uKSA8IDkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvQ29tcGF0aWJpbGl0eUVycm9yKCdNT05HT0RCLUFXUyBhdXRoZW50aWNhdGlvbiByZXF1aXJlcyBNb25nb0RCIHZlcnNpb24gNC40IG9yIGxhdGVyJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFhdXRoQ29udGV4dC5jcmVkZW50aWFscy51c2VybmFtZSkge1xuICAgICAgICAgICAgYXV0aENvbnRleHQuY3JlZGVudGlhbHMgPSBhd2FpdCBtYWtlVGVtcENyZWRlbnRpYWxzKGF1dGhDb250ZXh0LmNyZWRlbnRpYWxzKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB7IGNyZWRlbnRpYWxzIH0gPSBhdXRoQ29udGV4dDtcbiAgICAgICAgY29uc3QgYWNjZXNzS2V5SWQgPSBjcmVkZW50aWFscy51c2VybmFtZTtcbiAgICAgICAgY29uc3Qgc2VjcmV0QWNjZXNzS2V5ID0gY3JlZGVudGlhbHMucGFzc3dvcmQ7XG4gICAgICAgIGNvbnN0IHNlc3Npb25Ub2tlbiA9IGNyZWRlbnRpYWxzLm1lY2hhbmlzbVByb3BlcnRpZXMuQVdTX1NFU1NJT05fVE9LRU47XG4gICAgICAgIC8vIElmIGFsbCB0aHJlZSBkZWZpbmVkLCBpbmNsdWRlIHNlc3Npb25Ub2tlbiwgZWxzZSBpbmNsdWRlIHVzZXJuYW1lIGFuZCBwYXNzLCBlbHNlIG5vIGNyZWRlbnRpYWxzXG4gICAgICAgIGNvbnN0IGF3c0NyZWRlbnRpYWxzID0gYWNjZXNzS2V5SWQgJiYgc2VjcmV0QWNjZXNzS2V5ICYmIHNlc3Npb25Ub2tlblxuICAgICAgICAgICAgPyB7IGFjY2Vzc0tleUlkLCBzZWNyZXRBY2Nlc3NLZXksIHNlc3Npb25Ub2tlbiB9XG4gICAgICAgICAgICA6IGFjY2Vzc0tleUlkICYmIHNlY3JldEFjY2Vzc0tleVxuICAgICAgICAgICAgICAgID8geyBhY2Nlc3NLZXlJZCwgc2VjcmV0QWNjZXNzS2V5IH1cbiAgICAgICAgICAgICAgICA6IHVuZGVmaW5lZDtcbiAgICAgICAgY29uc3QgZGIgPSBjcmVkZW50aWFscy5zb3VyY2U7XG4gICAgICAgIGNvbnN0IG5vbmNlID0gYXdhaXQgdGhpcy5yYW5kb21CeXRlc0FzeW5jKDMyKTtcbiAgICAgICAgY29uc3Qgc2FzbFN0YXJ0ID0ge1xuICAgICAgICAgICAgc2FzbFN0YXJ0OiAxLFxuICAgICAgICAgICAgbWVjaGFuaXNtOiAnTU9OR09EQi1BV1MnLFxuICAgICAgICAgICAgcGF5bG9hZDogQlNPTi5zZXJpYWxpemUoeyByOiBub25jZSwgcDogQVNDSUlfTiB9LCBic29uT3B0aW9ucylcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3Qgc2FzbFN0YXJ0UmVzcG9uc2UgPSBhd2FpdCBjb25uZWN0aW9uLmNvbW1hbmRBc3luYygoMCwgdXRpbHNfMS5ucykoYCR7ZGJ9LiRjbWRgKSwgc2FzbFN0YXJ0LCB1bmRlZmluZWQpO1xuICAgICAgICBjb25zdCBzZXJ2ZXJSZXNwb25zZSA9IEJTT04uZGVzZXJpYWxpemUoc2FzbFN0YXJ0UmVzcG9uc2UucGF5bG9hZC5idWZmZXIsIGJzb25PcHRpb25zKTtcbiAgICAgICAgY29uc3QgaG9zdCA9IHNlcnZlclJlc3BvbnNlLmg7XG4gICAgICAgIGNvbnN0IHNlcnZlck5vbmNlID0gc2VydmVyUmVzcG9uc2Uucy5idWZmZXI7XG4gICAgICAgIGlmIChzZXJ2ZXJOb25jZS5sZW5ndGggIT09IDY0KSB7XG4gICAgICAgICAgICAvLyBUT0RPKE5PREUtMzQ4MylcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUnVudGltZUVycm9yKGBJbnZhbGlkIHNlcnZlciBub25jZSBsZW5ndGggJHtzZXJ2ZXJOb25jZS5sZW5ndGh9LCBleHBlY3RlZCA2NGApO1xuICAgICAgICB9XG4gICAgICAgIGlmICghdXRpbHNfMS5CeXRlVXRpbHMuZXF1YWxzKHNlcnZlck5vbmNlLnN1YmFycmF5KDAsIG5vbmNlLmJ5dGVMZW5ndGgpLCBub25jZSkpIHtcbiAgICAgICAgICAgIC8vIHRocm93IGJlY2F1c2UgdGhlIHNlcnZlck5vbmNlJ3MgbGVhZGluZyAzMiBieXRlcyBtdXN0IGVxdWFsIHRoZSBjbGllbnQgbm9uY2UncyAzMiBieXRlc1xuICAgICAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL21vbmdvZGIvc3BlY2lmaWNhdGlvbnMvYmxvYi84NzU0NDZkYjQ0YWFkZTQxNDAxMTczMTg0MDgzMWYzOGE2YzY2OGRmL3NvdXJjZS9hdXRoL2F1dGgucnN0I2lkMTFcbiAgICAgICAgICAgIC8vIFRPRE8oTk9ERS0zNDgzKVxuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29SdW50aW1lRXJyb3IoJ1NlcnZlciBub25jZSBkb2VzIG5vdCBiZWdpbiB3aXRoIGNsaWVudCBub25jZScpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChob3N0Lmxlbmd0aCA8IDEgfHwgaG9zdC5sZW5ndGggPiAyNTUgfHwgaG9zdC5pbmRleE9mKCcuLicpICE9PSAtMSkge1xuICAgICAgICAgICAgLy8gVE9ETyhOT0RFLTM0ODMpXG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1J1bnRpbWVFcnJvcihgU2VydmVyIHJldHVybmVkIGFuIGludmFsaWQgaG9zdDogXCIke2hvc3R9XCJgKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBib2R5ID0gJ0FjdGlvbj1HZXRDYWxsZXJJZGVudGl0eSZWZXJzaW9uPTIwMTEtMDYtMTUnO1xuICAgICAgICBjb25zdCBvcHRpb25zID0gc2lnbih7XG4gICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgIGhvc3QsXG4gICAgICAgICAgICByZWdpb246IGRlcml2ZVJlZ2lvbihzZXJ2ZXJSZXNwb25zZS5oKSxcbiAgICAgICAgICAgIHNlcnZpY2U6ICdzdHMnLFxuICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJyxcbiAgICAgICAgICAgICAgICAnQ29udGVudC1MZW5ndGgnOiBib2R5Lmxlbmd0aCxcbiAgICAgICAgICAgICAgICAnWC1Nb25nb0RCLVNlcnZlci1Ob25jZSc6IHV0aWxzXzEuQnl0ZVV0aWxzLnRvQmFzZTY0KHNlcnZlck5vbmNlKSxcbiAgICAgICAgICAgICAgICAnWC1Nb25nb0RCLUdTMi1DQi1GbGFnJzogJ24nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcGF0aDogJy8nLFxuICAgICAgICAgICAgYm9keVxuICAgICAgICB9LCBhd3NDcmVkZW50aWFscyk7XG4gICAgICAgIGNvbnN0IHBheWxvYWQgPSB7XG4gICAgICAgICAgICBhOiBvcHRpb25zLmhlYWRlcnMuQXV0aG9yaXphdGlvbixcbiAgICAgICAgICAgIGQ6IG9wdGlvbnMuaGVhZGVyc1snWC1BbXotRGF0ZSddXG4gICAgICAgIH07XG4gICAgICAgIGlmIChzZXNzaW9uVG9rZW4pIHtcbiAgICAgICAgICAgIHBheWxvYWQudCA9IHNlc3Npb25Ub2tlbjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBzYXNsQ29udGludWUgPSB7XG4gICAgICAgICAgICBzYXNsQ29udGludWU6IDEsXG4gICAgICAgICAgICBjb252ZXJzYXRpb25JZDogMSxcbiAgICAgICAgICAgIHBheWxvYWQ6IEJTT04uc2VyaWFsaXplKHBheWxvYWQsIGJzb25PcHRpb25zKVxuICAgICAgICB9O1xuICAgICAgICBhd2FpdCBjb25uZWN0aW9uLmNvbW1hbmRBc3luYygoMCwgdXRpbHNfMS5ucykoYCR7ZGJ9LiRjbWRgKSwgc2FzbENvbnRpbnVlLCB1bmRlZmluZWQpO1xuICAgIH1cbn1cbk1vbmdvREJBV1MuY3JlZGVudGlhbFByb3ZpZGVyID0gbnVsbDtcbmV4cG9ydHMuTW9uZ29EQkFXUyA9IE1vbmdvREJBV1M7XG5hc3luYyBmdW5jdGlvbiBtYWtlVGVtcENyZWRlbnRpYWxzKGNyZWRlbnRpYWxzKSB7XG4gICAgZnVuY3Rpb24gbWFrZU1vbmdvQ3JlZGVudGlhbHNGcm9tQVdTVGVtcChjcmVkcykge1xuICAgICAgICBpZiAoIWNyZWRzLkFjY2Vzc0tleUlkIHx8ICFjcmVkcy5TZWNyZXRBY2Nlc3NLZXkgfHwgIWNyZWRzLlRva2VuKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb01pc3NpbmdDcmVkZW50aWFsc0Vycm9yKCdDb3VsZCBub3Qgb2J0YWluIHRlbXBvcmFyeSBNT05HT0RCLUFXUyBjcmVkZW50aWFscycpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgbW9uZ29fY3JlZGVudGlhbHNfMS5Nb25nb0NyZWRlbnRpYWxzKHtcbiAgICAgICAgICAgIHVzZXJuYW1lOiBjcmVkcy5BY2Nlc3NLZXlJZCxcbiAgICAgICAgICAgIHBhc3N3b3JkOiBjcmVkcy5TZWNyZXRBY2Nlc3NLZXksXG4gICAgICAgICAgICBzb3VyY2U6IGNyZWRlbnRpYWxzLnNvdXJjZSxcbiAgICAgICAgICAgIG1lY2hhbmlzbTogcHJvdmlkZXJzXzEuQXV0aE1lY2hhbmlzbS5NT05HT0RCX0FXUyxcbiAgICAgICAgICAgIG1lY2hhbmlzbVByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgICAgICBBV1NfU0VTU0lPTl9UT0tFTjogY3JlZHMuVG9rZW5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIE1vbmdvREJBV1MuY3JlZGVudGlhbFByb3ZpZGVyID8/IChNb25nb0RCQVdTLmNyZWRlbnRpYWxQcm92aWRlciA9ICgwLCBkZXBzXzEuZ2V0QXdzQ3JlZGVudGlhbFByb3ZpZGVyKSgpKTtcbiAgICAvLyBDaGVjayBpZiB0aGUgQVdTIGNyZWRlbnRpYWwgcHJvdmlkZXIgZnJvbSB0aGUgU0RLIGlzIHByZXNlbnQuIElmIG5vdCxcbiAgICAvLyB1c2UgdGhlIG9sZCBtZXRob2QuXG4gICAgaWYgKCdrTW9kdWxlRXJyb3InIGluIE1vbmdvREJBV1MuY3JlZGVudGlhbFByb3ZpZGVyKSB7XG4gICAgICAgIC8vIElmIHRoZSBlbnZpcm9ubWVudCB2YXJpYWJsZSBBV1NfQ09OVEFJTkVSX0NSRURFTlRJQUxTX1JFTEFUSVZFX1VSSVxuICAgICAgICAvLyBpcyBzZXQgdGhlbiBkcml2ZXJzIE1VU1QgYXNzdW1lIHRoYXQgaXQgd2FzIHNldCBieSBhbiBBV1MgRUNTIGFnZW50XG4gICAgICAgIGlmIChwcm9jZXNzLmVudi5BV1NfQ09OVEFJTkVSX0NSRURFTlRJQUxTX1JFTEFUSVZFX1VSSSkge1xuICAgICAgICAgICAgcmV0dXJuIG1ha2VNb25nb0NyZWRlbnRpYWxzRnJvbUFXU1RlbXAoYXdhaXQgKDAsIHV0aWxzXzEucmVxdWVzdCkoYCR7QVdTX1JFTEFUSVZFX1VSSX0ke3Byb2Nlc3MuZW52LkFXU19DT05UQUlORVJfQ1JFREVOVElBTFNfUkVMQVRJVkVfVVJJfWApKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBPdGhlcndpc2UgYXNzdW1lIHdlIGFyZSBvbiBhbiBFQzIgaW5zdGFuY2VcbiAgICAgICAgLy8gZ2V0IGEgdG9rZW5cbiAgICAgICAgY29uc3QgdG9rZW4gPSBhd2FpdCAoMCwgdXRpbHNfMS5yZXF1ZXN0KShgJHtBV1NfRUMyX1VSSX0vbGF0ZXN0L2FwaS90b2tlbmAsIHtcbiAgICAgICAgICAgIG1ldGhvZDogJ1BVVCcsXG4gICAgICAgICAgICBqc29uOiBmYWxzZSxcbiAgICAgICAgICAgIGhlYWRlcnM6IHsgJ1gtYXdzLWVjMi1tZXRhZGF0YS10b2tlbi10dGwtc2Vjb25kcyc6IDMwIH1cbiAgICAgICAgfSk7XG4gICAgICAgIC8vIGdldCByb2xlIG5hbWVcbiAgICAgICAgY29uc3Qgcm9sZU5hbWUgPSBhd2FpdCAoMCwgdXRpbHNfMS5yZXF1ZXN0KShgJHtBV1NfRUMyX1VSSX0vJHtBV1NfRUMyX1BBVEh9YCwge1xuICAgICAgICAgICAganNvbjogZmFsc2UsXG4gICAgICAgICAgICBoZWFkZXJzOiB7ICdYLWF3cy1lYzItbWV0YWRhdGEtdG9rZW4nOiB0b2tlbiB9XG4gICAgICAgIH0pO1xuICAgICAgICAvLyBnZXQgdGVtcCBjcmVkZW50aWFsc1xuICAgICAgICBjb25zdCBjcmVkcyA9IGF3YWl0ICgwLCB1dGlsc18xLnJlcXVlc3QpKGAke0FXU19FQzJfVVJJfS8ke0FXU19FQzJfUEFUSH0vJHtyb2xlTmFtZX1gLCB7XG4gICAgICAgICAgICBoZWFkZXJzOiB7ICdYLWF3cy1lYzItbWV0YWRhdGEtdG9rZW4nOiB0b2tlbiB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gbWFrZU1vbmdvQ3JlZGVudGlhbHNGcm9tQVdTVGVtcChjcmVkcyk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBsZXQgeyBBV1NfU1RTX1JFR0lPTkFMX0VORFBPSU5UUyA9ICcnLCBBV1NfUkVHSU9OID0gJycgfSA9IHByb2Nlc3MuZW52O1xuICAgICAgICBBV1NfU1RTX1JFR0lPTkFMX0VORFBPSU5UUyA9IEFXU19TVFNfUkVHSU9OQUxfRU5EUE9JTlRTLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIEFXU19SRUdJT04gPSBBV1NfUkVHSU9OLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIC8qKiBUaGUgb3B0aW9uIHNldHRpbmcgc2hvdWxkIHdvcmsgb25seSBmb3IgdXNlcnMgd2hvIGhhdmUgZXhwbGljaXQgc2V0dGluZ3MgaW4gdGhlaXIgZW52aXJvbm1lbnQsIHRoZSBkcml2ZXIgc2hvdWxkIG5vdCBlbmNvZGUgXCJkZWZhdWx0c1wiICovXG4gICAgICAgIGNvbnN0IGF3c1JlZ2lvblNldHRpbmdzRXhpc3QgPSBBV1NfUkVHSU9OLmxlbmd0aCAhPT0gMCAmJiBBV1NfU1RTX1JFR0lPTkFMX0VORFBPSU5UUy5sZW5ndGggIT09IDA7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJZiBBV1NfU1RTX1JFR0lPTkFMX0VORFBPSU5UUyBpcyBzZXQgdG8gcmVnaW9uYWwsIHVzZXJzIGFyZSBvcHRpbmcgaW50byB0aGUgbmV3IGJlaGF2aW9yIG9mIHJlc3BlY3RpbmcgdGhlIHJlZ2lvbiBzZXR0aW5nc1xuICAgICAgICAgKlxuICAgICAgICAgKiBJZiBBV1NfU1RTX1JFR0lPTkFMX0VORFBPSU5UUyBpcyBzZXQgdG8gbGVnYWN5LCB0aGVuIFwib2xkXCIgcmVnaW9ucyBuZWVkIHRvIGtlZXAgdXNpbmcgdGhlIGdsb2JhbCBzZXR0aW5nLlxuICAgICAgICAgKiBUZWNobmljYWxseSB0aGUgU0RLIGdldHMgdGhpcyB3cm9uZywgaXQgcmVhY2hlcyBvdXQgdG8gJ3N0cy51cy1lYXN0LTEuYW1hem9uYXdzLmNvbScgd2hlbiBpdCBzaG91bGQgYmUgJ3N0cy5hbWF6b25hd3MuY29tJy5cbiAgICAgICAgICogVGhhdCBpcyBub3Qgb3VyIGJ1ZyB0byBmaXggaGVyZS4gV2UgbGVhdmUgdGhhdCB1cCB0byB0aGUgU0RLLlxuICAgICAgICAgKi9cbiAgICAgICAgY29uc3QgdXNlUmVnaW9uYWxTdHMgPSBBV1NfU1RTX1JFR0lPTkFMX0VORFBPSU5UUyA9PT0gJ3JlZ2lvbmFsJyB8fFxuICAgICAgICAgICAgKEFXU19TVFNfUkVHSU9OQUxfRU5EUE9JTlRTID09PSAnbGVnYWN5JyAmJiAhTEVHQUNZX1JFR0lPTlMuaGFzKEFXU19SRUdJT04pKTtcbiAgICAgICAgY29uc3QgcHJvdmlkZXIgPSBhd3NSZWdpb25TZXR0aW5nc0V4aXN0ICYmIHVzZVJlZ2lvbmFsU3RzXG4gICAgICAgICAgICA/IE1vbmdvREJBV1MuY3JlZGVudGlhbFByb3ZpZGVyLmZyb21Ob2RlUHJvdmlkZXJDaGFpbih7XG4gICAgICAgICAgICAgICAgY2xpZW50Q29uZmlnOiB7IHJlZ2lvbjogQVdTX1JFR0lPTiB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgOiBNb25nb0RCQVdTLmNyZWRlbnRpYWxQcm92aWRlci5mcm9tTm9kZVByb3ZpZGVyQ2hhaW4oKTtcbiAgICAgICAgLypcbiAgICAgICAgICogQ3JlYXRlcyBhIGNyZWRlbnRpYWwgcHJvdmlkZXIgdGhhdCB3aWxsIGF0dGVtcHQgdG8gZmluZCBjcmVkZW50aWFscyBmcm9tIHRoZVxuICAgICAgICAgKiBmb2xsb3dpbmcgc291cmNlcyAobGlzdGVkIGluIG9yZGVyIG9mIHByZWNlZGVuY2UpOlxuICAgICAgICAgKlxuICAgICAgICAgKiAtIEVudmlyb25tZW50IHZhcmlhYmxlcyBleHBvc2VkIHZpYSBwcm9jZXNzLmVudlxuICAgICAgICAgKiAtIFNTTyBjcmVkZW50aWFscyBmcm9tIHRva2VuIGNhY2hlXG4gICAgICAgICAqIC0gV2ViIGlkZW50aXR5IHRva2VuIGNyZWRlbnRpYWxzXG4gICAgICAgICAqIC0gU2hhcmVkIGNyZWRlbnRpYWxzIGFuZCBjb25maWcgaW5pIGZpbGVzXG4gICAgICAgICAqIC0gVGhlIEVDMi9FQ1MgSW5zdGFuY2UgTWV0YWRhdGEgU2VydmljZVxuICAgICAgICAgKi9cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IGNyZWRzID0gYXdhaXQgcHJvdmlkZXIoKTtcbiAgICAgICAgICAgIHJldHVybiBtYWtlTW9uZ29DcmVkZW50aWFsc0Zyb21BV1NUZW1wKHtcbiAgICAgICAgICAgICAgICBBY2Nlc3NLZXlJZDogY3JlZHMuYWNjZXNzS2V5SWQsXG4gICAgICAgICAgICAgICAgU2VjcmV0QWNjZXNzS2V5OiBjcmVkcy5zZWNyZXRBY2Nlc3NLZXksXG4gICAgICAgICAgICAgICAgVG9rZW46IGNyZWRzLnNlc3Npb25Ub2tlbixcbiAgICAgICAgICAgICAgICBFeHBpcmF0aW9uOiBjcmVkcy5leHBpcmF0aW9uXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvQVdTRXJyb3IoZXJyb3IubWVzc2FnZSk7XG4gICAgICAgIH1cbiAgICB9XG59XG5mdW5jdGlvbiBkZXJpdmVSZWdpb24oaG9zdCkge1xuICAgIGNvbnN0IHBhcnRzID0gaG9zdC5zcGxpdCgnLicpO1xuICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDEgfHwgcGFydHNbMV0gPT09ICdhbWF6b25hd3MnKSB7XG4gICAgICAgIHJldHVybiAndXMtZWFzdC0xJztcbiAgICB9XG4gICAgcmV0dXJuIHBhcnRzWzFdO1xufVxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9bW9uZ29kYl9hd3MuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/cmap/auth/mongodb_aws.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/cmap/auth/mongodb_oidc.js":
/*!********************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/cmap/auth/mongodb_oidc.js ***!
  \********************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.MongoDBOIDC = exports.OIDC_WORKFLOWS = void 0;\nconst error_1 = __webpack_require__(/*! ../../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst auth_provider_1 = __webpack_require__(/*! ./auth_provider */ \"(api)/../server/node_modules/mongodb/lib/cmap/auth/auth_provider.js\");\nconst aws_service_workflow_1 = __webpack_require__(/*! ./mongodb_oidc/aws_service_workflow */ \"(api)/../server/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/aws_service_workflow.js\");\nconst azure_service_workflow_1 = __webpack_require__(/*! ./mongodb_oidc/azure_service_workflow */ \"(api)/../server/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/azure_service_workflow.js\");\nconst callback_workflow_1 = __webpack_require__(/*! ./mongodb_oidc/callback_workflow */ \"(api)/../server/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/callback_workflow.js\");\n/** Error when credentials are missing. */\nconst MISSING_CREDENTIALS_ERROR = 'AuthContext must provide credentials.';\n/** @internal */\nexports.OIDC_WORKFLOWS = new Map();\nexports.OIDC_WORKFLOWS.set('callback', new callback_workflow_1.CallbackWorkflow());\nexports.OIDC_WORKFLOWS.set('aws', new aws_service_workflow_1.AwsServiceWorkflow());\nexports.OIDC_WORKFLOWS.set('azure', new azure_service_workflow_1.AzureServiceWorkflow());\n/**\n * OIDC auth provider.\n * @experimental\n */\nclass MongoDBOIDC extends auth_provider_1.AuthProvider {\n    /**\n     * Instantiate the auth provider.\n     */\n    constructor() {\n        super();\n    }\n    /**\n     * Authenticate using OIDC\n     */\n    async auth(authContext) {\n        const { connection, reauthenticating, response } = authContext;\n        const credentials = getCredentials(authContext);\n        const workflow = getWorkflow(credentials);\n        await workflow.execute(connection, credentials, reauthenticating, response);\n    }\n    /**\n     * Add the speculative auth for the initial handshake.\n     */\n    async prepare(handshakeDoc, authContext) {\n        const credentials = getCredentials(authContext);\n        const workflow = getWorkflow(credentials);\n        const result = await workflow.speculativeAuth(credentials);\n        return { ...handshakeDoc, ...result };\n    }\n}\nexports.MongoDBOIDC = MongoDBOIDC;\n/**\n * Get credentials from the auth context, throwing if they do not exist.\n */\nfunction getCredentials(authContext) {\n    const { credentials } = authContext;\n    if (!credentials) {\n        throw new error_1.MongoMissingCredentialsError(MISSING_CREDENTIALS_ERROR);\n    }\n    return credentials;\n}\n/**\n * Gets either a device workflow or callback workflow.\n */\nfunction getWorkflow(credentials) {\n    const providerName = credentials.mechanismProperties.PROVIDER_NAME;\n    const workflow = exports.OIDC_WORKFLOWS.get(providerName || 'callback');\n    if (!workflow) {\n        throw new error_1.MongoInvalidArgumentError(`Could not load workflow for provider ${credentials.mechanismProperties.PROVIDER_NAME}`);\n    }\n    return workflow;\n}\n//# sourceMappingURL=mongodb_oidc.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jbWFwL2F1dGgvbW9uZ29kYl9vaWRjLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELG1CQUFtQixHQUFHLHNCQUFzQjtBQUM1QyxnQkFBZ0IsbUJBQU8sQ0FBQyxzRUFBYTtBQUNyQyx3QkFBd0IsbUJBQU8sQ0FBQyw0RkFBaUI7QUFDakQsK0JBQStCLG1CQUFPLENBQUMsb0lBQXFDO0FBQzVFLGlDQUFpQyxtQkFBTyxDQUFDLHdJQUF1QztBQUNoRiw0QkFBNEIsbUJBQU8sQ0FBQyw4SEFBa0M7QUFDdEU7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQix5Q0FBeUM7QUFDekQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsbUJBQW1CO0FBQ25CO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxjQUFjO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRGQUE0Riw4Q0FBOEM7QUFDMUk7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIkQ6XFxzYWxvbmlcXGFwcHJhaXNhbC1zeXN0ZW1cXHNlcnZlclxcbm9kZV9tb2R1bGVzXFxtb25nb2RiXFxsaWJcXGNtYXBcXGF1dGhcXG1vbmdvZGJfb2lkYy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuTW9uZ29EQk9JREMgPSBleHBvcnRzLk9JRENfV09SS0ZMT1dTID0gdm9pZCAwO1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuLi8uLi9lcnJvclwiKTtcbmNvbnN0IGF1dGhfcHJvdmlkZXJfMSA9IHJlcXVpcmUoXCIuL2F1dGhfcHJvdmlkZXJcIik7XG5jb25zdCBhd3Nfc2VydmljZV93b3JrZmxvd18xID0gcmVxdWlyZShcIi4vbW9uZ29kYl9vaWRjL2F3c19zZXJ2aWNlX3dvcmtmbG93XCIpO1xuY29uc3QgYXp1cmVfc2VydmljZV93b3JrZmxvd18xID0gcmVxdWlyZShcIi4vbW9uZ29kYl9vaWRjL2F6dXJlX3NlcnZpY2Vfd29ya2Zsb3dcIik7XG5jb25zdCBjYWxsYmFja193b3JrZmxvd18xID0gcmVxdWlyZShcIi4vbW9uZ29kYl9vaWRjL2NhbGxiYWNrX3dvcmtmbG93XCIpO1xuLyoqIEVycm9yIHdoZW4gY3JlZGVudGlhbHMgYXJlIG1pc3NpbmcuICovXG5jb25zdCBNSVNTSU5HX0NSRURFTlRJQUxTX0VSUk9SID0gJ0F1dGhDb250ZXh0IG11c3QgcHJvdmlkZSBjcmVkZW50aWFscy4nO1xuLyoqIEBpbnRlcm5hbCAqL1xuZXhwb3J0cy5PSURDX1dPUktGTE9XUyA9IG5ldyBNYXAoKTtcbmV4cG9ydHMuT0lEQ19XT1JLRkxPV1Muc2V0KCdjYWxsYmFjaycsIG5ldyBjYWxsYmFja193b3JrZmxvd18xLkNhbGxiYWNrV29ya2Zsb3coKSk7XG5leHBvcnRzLk9JRENfV09SS0ZMT1dTLnNldCgnYXdzJywgbmV3IGF3c19zZXJ2aWNlX3dvcmtmbG93XzEuQXdzU2VydmljZVdvcmtmbG93KCkpO1xuZXhwb3J0cy5PSURDX1dPUktGTE9XUy5zZXQoJ2F6dXJlJywgbmV3IGF6dXJlX3NlcnZpY2Vfd29ya2Zsb3dfMS5BenVyZVNlcnZpY2VXb3JrZmxvdygpKTtcbi8qKlxuICogT0lEQyBhdXRoIHByb3ZpZGVyLlxuICogQGV4cGVyaW1lbnRhbFxuICovXG5jbGFzcyBNb25nb0RCT0lEQyBleHRlbmRzIGF1dGhfcHJvdmlkZXJfMS5BdXRoUHJvdmlkZXIge1xuICAgIC8qKlxuICAgICAqIEluc3RhbnRpYXRlIHRoZSBhdXRoIHByb3ZpZGVyLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcigpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBdXRoZW50aWNhdGUgdXNpbmcgT0lEQ1xuICAgICAqL1xuICAgIGFzeW5jIGF1dGgoYXV0aENvbnRleHQpIHtcbiAgICAgICAgY29uc3QgeyBjb25uZWN0aW9uLCByZWF1dGhlbnRpY2F0aW5nLCByZXNwb25zZSB9ID0gYXV0aENvbnRleHQ7XG4gICAgICAgIGNvbnN0IGNyZWRlbnRpYWxzID0gZ2V0Q3JlZGVudGlhbHMoYXV0aENvbnRleHQpO1xuICAgICAgICBjb25zdCB3b3JrZmxvdyA9IGdldFdvcmtmbG93KGNyZWRlbnRpYWxzKTtcbiAgICAgICAgYXdhaXQgd29ya2Zsb3cuZXhlY3V0ZShjb25uZWN0aW9uLCBjcmVkZW50aWFscywgcmVhdXRoZW50aWNhdGluZywgcmVzcG9uc2UpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBZGQgdGhlIHNwZWN1bGF0aXZlIGF1dGggZm9yIHRoZSBpbml0aWFsIGhhbmRzaGFrZS5cbiAgICAgKi9cbiAgICBhc3luYyBwcmVwYXJlKGhhbmRzaGFrZURvYywgYXV0aENvbnRleHQpIHtcbiAgICAgICAgY29uc3QgY3JlZGVudGlhbHMgPSBnZXRDcmVkZW50aWFscyhhdXRoQ29udGV4dCk7XG4gICAgICAgIGNvbnN0IHdvcmtmbG93ID0gZ2V0V29ya2Zsb3coY3JlZGVudGlhbHMpO1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB3b3JrZmxvdy5zcGVjdWxhdGl2ZUF1dGgoY3JlZGVudGlhbHMpO1xuICAgICAgICByZXR1cm4geyAuLi5oYW5kc2hha2VEb2MsIC4uLnJlc3VsdCB9O1xuICAgIH1cbn1cbmV4cG9ydHMuTW9uZ29EQk9JREMgPSBNb25nb0RCT0lEQztcbi8qKlxuICogR2V0IGNyZWRlbnRpYWxzIGZyb20gdGhlIGF1dGggY29udGV4dCwgdGhyb3dpbmcgaWYgdGhleSBkbyBub3QgZXhpc3QuXG4gKi9cbmZ1bmN0aW9uIGdldENyZWRlbnRpYWxzKGF1dGhDb250ZXh0KSB7XG4gICAgY29uc3QgeyBjcmVkZW50aWFscyB9ID0gYXV0aENvbnRleHQ7XG4gICAgaWYgKCFjcmVkZW50aWFscykge1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb01pc3NpbmdDcmVkZW50aWFsc0Vycm9yKE1JU1NJTkdfQ1JFREVOVElBTFNfRVJST1IpO1xuICAgIH1cbiAgICByZXR1cm4gY3JlZGVudGlhbHM7XG59XG4vKipcbiAqIEdldHMgZWl0aGVyIGEgZGV2aWNlIHdvcmtmbG93IG9yIGNhbGxiYWNrIHdvcmtmbG93LlxuICovXG5mdW5jdGlvbiBnZXRXb3JrZmxvdyhjcmVkZW50aWFscykge1xuICAgIGNvbnN0IHByb3ZpZGVyTmFtZSA9IGNyZWRlbnRpYWxzLm1lY2hhbmlzbVByb3BlcnRpZXMuUFJPVklERVJfTkFNRTtcbiAgICBjb25zdCB3b3JrZmxvdyA9IGV4cG9ydHMuT0lEQ19XT1JLRkxPV1MuZ2V0KHByb3ZpZGVyTmFtZSB8fCAnY2FsbGJhY2snKTtcbiAgICBpZiAoIXdvcmtmbG93KSB7XG4gICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoYENvdWxkIG5vdCBsb2FkIHdvcmtmbG93IGZvciBwcm92aWRlciAke2NyZWRlbnRpYWxzLm1lY2hhbmlzbVByb3BlcnRpZXMuUFJPVklERVJfTkFNRX1gKTtcbiAgICB9XG4gICAgcmV0dXJuIHdvcmtmbG93O1xufVxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9bW9uZ29kYl9vaWRjLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/cmap/auth/mongodb_oidc.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/aws_service_workflow.js":
/*!*****************************************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/aws_service_workflow.js ***!
  \*****************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.AwsServiceWorkflow = void 0;\nconst fs = __webpack_require__(/*! fs */ \"fs\");\nconst error_1 = __webpack_require__(/*! ../../../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst service_workflow_1 = __webpack_require__(/*! ./service_workflow */ \"(api)/../server/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/service_workflow.js\");\n/** Error for when the token is missing in the environment. */\nconst TOKEN_MISSING_ERROR = 'AWS_WEB_IDENTITY_TOKEN_FILE must be set in the environment.';\n/**\n * Device workflow implementation for AWS.\n *\n * @internal\n */\nclass AwsServiceWorkflow extends service_workflow_1.ServiceWorkflow {\n    constructor() {\n        super();\n    }\n    /**\n     * Get the token from the environment.\n     */\n    async getToken() {\n        const tokenFile = process.env.AWS_WEB_IDENTITY_TOKEN_FILE;\n        if (!tokenFile) {\n            throw new error_1.MongoAWSError(TOKEN_MISSING_ERROR);\n        }\n        return fs.promises.readFile(tokenFile, 'utf8');\n    }\n}\nexports.AwsServiceWorkflow = AwsServiceWorkflow;\n//# sourceMappingURL=aws_service_workflow.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jbWFwL2F1dGgvbW9uZ29kYl9vaWRjL2F3c19zZXJ2aWNlX3dvcmtmbG93LmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELDBCQUEwQjtBQUMxQixXQUFXLG1CQUFPLENBQUMsY0FBSTtBQUN2QixnQkFBZ0IsbUJBQU8sQ0FBQyx5RUFBZ0I7QUFDeEMsMkJBQTJCLG1CQUFPLENBQUMsK0dBQW9CO0FBQ3ZEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCO0FBQzFCIiwic291cmNlcyI6WyJEOlxcc2Fsb25pXFxhcHByYWlzYWwtc3lzdGVtXFxzZXJ2ZXJcXG5vZGVfbW9kdWxlc1xcbW9uZ29kYlxcbGliXFxjbWFwXFxhdXRoXFxtb25nb2RiX29pZGNcXGF3c19zZXJ2aWNlX3dvcmtmbG93LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5Bd3NTZXJ2aWNlV29ya2Zsb3cgPSB2b2lkIDA7XG5jb25zdCBmcyA9IHJlcXVpcmUoXCJmc1wiKTtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vZXJyb3JcIik7XG5jb25zdCBzZXJ2aWNlX3dvcmtmbG93XzEgPSByZXF1aXJlKFwiLi9zZXJ2aWNlX3dvcmtmbG93XCIpO1xuLyoqIEVycm9yIGZvciB3aGVuIHRoZSB0b2tlbiBpcyBtaXNzaW5nIGluIHRoZSBlbnZpcm9ubWVudC4gKi9cbmNvbnN0IFRPS0VOX01JU1NJTkdfRVJST1IgPSAnQVdTX1dFQl9JREVOVElUWV9UT0tFTl9GSUxFIG11c3QgYmUgc2V0IGluIHRoZSBlbnZpcm9ubWVudC4nO1xuLyoqXG4gKiBEZXZpY2Ugd29ya2Zsb3cgaW1wbGVtZW50YXRpb24gZm9yIEFXUy5cbiAqXG4gKiBAaW50ZXJuYWxcbiAqL1xuY2xhc3MgQXdzU2VydmljZVdvcmtmbG93IGV4dGVuZHMgc2VydmljZV93b3JrZmxvd18xLlNlcnZpY2VXb3JrZmxvdyB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEdldCB0aGUgdG9rZW4gZnJvbSB0aGUgZW52aXJvbm1lbnQuXG4gICAgICovXG4gICAgYXN5bmMgZ2V0VG9rZW4oKSB7XG4gICAgICAgIGNvbnN0IHRva2VuRmlsZSA9IHByb2Nlc3MuZW52LkFXU19XRUJfSURFTlRJVFlfVE9LRU5fRklMRTtcbiAgICAgICAgaWYgKCF0b2tlbkZpbGUpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvQVdTRXJyb3IoVE9LRU5fTUlTU0lOR19FUlJPUik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZzLnByb21pc2VzLnJlYWRGaWxlKHRva2VuRmlsZSwgJ3V0ZjgnKTtcbiAgICB9XG59XG5leHBvcnRzLkF3c1NlcnZpY2VXb3JrZmxvdyA9IEF3c1NlcnZpY2VXb3JrZmxvdztcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWF3c19zZXJ2aWNlX3dvcmtmbG93LmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/aws_service_workflow.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/azure_service_workflow.js":
/*!*******************************************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/azure_service_workflow.js ***!
  \*******************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.AzureServiceWorkflow = void 0;\nconst error_1 = __webpack_require__(/*! ../../../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst utils_1 = __webpack_require__(/*! ../../../utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\nconst azure_token_cache_1 = __webpack_require__(/*! ./azure_token_cache */ \"(api)/../server/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/azure_token_cache.js\");\nconst service_workflow_1 = __webpack_require__(/*! ./service_workflow */ \"(api)/../server/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/service_workflow.js\");\n/** Base URL for getting Azure tokens. */\nconst AZURE_BASE_URL = 'http://169.254.169.254/metadata/identity/oauth2/token?api-version=2018-02-01';\n/** Azure request headers. */\nconst AZURE_HEADERS = Object.freeze({ Metadata: 'true', Accept: 'application/json' });\n/** Invalid endpoint result error. */\nconst ENDPOINT_RESULT_ERROR = 'Azure endpoint did not return a value with only access_token and expires_in properties';\n/** Error for when the token audience is missing in the environment. */\nconst TOKEN_AUDIENCE_MISSING_ERROR = 'TOKEN_AUDIENCE must be set in the auth mechanism properties when PROVIDER_NAME is azure.';\n/**\n * Device workflow implementation for Azure.\n *\n * @internal\n */\nclass AzureServiceWorkflow extends service_workflow_1.ServiceWorkflow {\n    constructor() {\n        super(...arguments);\n        this.cache = new azure_token_cache_1.AzureTokenCache();\n    }\n    /**\n     * Get the token from the environment.\n     */\n    async getToken(credentials) {\n        const tokenAudience = credentials?.mechanismProperties.TOKEN_AUDIENCE;\n        if (!tokenAudience) {\n            throw new error_1.MongoAzureError(TOKEN_AUDIENCE_MISSING_ERROR);\n        }\n        let token;\n        const entry = this.cache.getEntry(tokenAudience);\n        if (entry?.isValid()) {\n            token = entry.token;\n        }\n        else {\n            this.cache.deleteEntry(tokenAudience);\n            const response = await getAzureTokenData(tokenAudience);\n            if (!isEndpointResultValid(response)) {\n                throw new error_1.MongoAzureError(ENDPOINT_RESULT_ERROR);\n            }\n            this.cache.addEntry(tokenAudience, response);\n            token = response.access_token;\n        }\n        return token;\n    }\n}\nexports.AzureServiceWorkflow = AzureServiceWorkflow;\n/**\n * Hit the Azure endpoint to get the token data.\n */\nasync function getAzureTokenData(tokenAudience) {\n    const url = `${AZURE_BASE_URL}&resource=${tokenAudience}`;\n    const data = await (0, utils_1.request)(url, {\n        json: true,\n        headers: AZURE_HEADERS\n    });\n    return data;\n}\n/**\n * Determines if a result returned from the endpoint is valid.\n * This means the result is not nullish, contains the access_token required field\n * and the expires_in required field.\n */\nfunction isEndpointResultValid(token) {\n    if (token == null || typeof token !== 'object')\n        return false;\n    return 'access_token' in token && 'expires_in' in token;\n}\n//# sourceMappingURL=azure_service_workflow.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jbWFwL2F1dGgvbW9uZ29kYl9vaWRjL2F6dXJlX3NlcnZpY2Vfd29ya2Zsb3cuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsNEJBQTRCO0FBQzVCLGdCQUFnQixtQkFBTyxDQUFDLHlFQUFnQjtBQUN4QyxnQkFBZ0IsbUJBQU8sQ0FBQyx5RUFBZ0I7QUFDeEMsNEJBQTRCLG1CQUFPLENBQUMsaUhBQXFCO0FBQ3pELDJCQUEyQixtQkFBTyxDQUFDLCtHQUFvQjtBQUN2RDtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0MsOENBQThDO0FBQ3BGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QjtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQixlQUFlLFlBQVksY0FBYztBQUM1RDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIkQ6XFxzYWxvbmlcXGFwcHJhaXNhbC1zeXN0ZW1cXHNlcnZlclxcbm9kZV9tb2R1bGVzXFxtb25nb2RiXFxsaWJcXGNtYXBcXGF1dGhcXG1vbmdvZGJfb2lkY1xcYXp1cmVfc2VydmljZV93b3JrZmxvdy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuQXp1cmVTZXJ2aWNlV29ya2Zsb3cgPSB2b2lkIDA7XG5jb25zdCBlcnJvcl8xID0gcmVxdWlyZShcIi4uLy4uLy4uL2Vycm9yXCIpO1xuY29uc3QgdXRpbHNfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi91dGlsc1wiKTtcbmNvbnN0IGF6dXJlX3Rva2VuX2NhY2hlXzEgPSByZXF1aXJlKFwiLi9henVyZV90b2tlbl9jYWNoZVwiKTtcbmNvbnN0IHNlcnZpY2Vfd29ya2Zsb3dfMSA9IHJlcXVpcmUoXCIuL3NlcnZpY2Vfd29ya2Zsb3dcIik7XG4vKiogQmFzZSBVUkwgZm9yIGdldHRpbmcgQXp1cmUgdG9rZW5zLiAqL1xuY29uc3QgQVpVUkVfQkFTRV9VUkwgPSAnaHR0cDovLzE2OS4yNTQuMTY5LjI1NC9tZXRhZGF0YS9pZGVudGl0eS9vYXV0aDIvdG9rZW4/YXBpLXZlcnNpb249MjAxOC0wMi0wMSc7XG4vKiogQXp1cmUgcmVxdWVzdCBoZWFkZXJzLiAqL1xuY29uc3QgQVpVUkVfSEVBREVSUyA9IE9iamVjdC5mcmVlemUoeyBNZXRhZGF0YTogJ3RydWUnLCBBY2NlcHQ6ICdhcHBsaWNhdGlvbi9qc29uJyB9KTtcbi8qKiBJbnZhbGlkIGVuZHBvaW50IHJlc3VsdCBlcnJvci4gKi9cbmNvbnN0IEVORFBPSU5UX1JFU1VMVF9FUlJPUiA9ICdBenVyZSBlbmRwb2ludCBkaWQgbm90IHJldHVybiBhIHZhbHVlIHdpdGggb25seSBhY2Nlc3NfdG9rZW4gYW5kIGV4cGlyZXNfaW4gcHJvcGVydGllcyc7XG4vKiogRXJyb3IgZm9yIHdoZW4gdGhlIHRva2VuIGF1ZGllbmNlIGlzIG1pc3NpbmcgaW4gdGhlIGVudmlyb25tZW50LiAqL1xuY29uc3QgVE9LRU5fQVVESUVOQ0VfTUlTU0lOR19FUlJPUiA9ICdUT0tFTl9BVURJRU5DRSBtdXN0IGJlIHNldCBpbiB0aGUgYXV0aCBtZWNoYW5pc20gcHJvcGVydGllcyB3aGVuIFBST1ZJREVSX05BTUUgaXMgYXp1cmUuJztcbi8qKlxuICogRGV2aWNlIHdvcmtmbG93IGltcGxlbWVudGF0aW9uIGZvciBBenVyZS5cbiAqXG4gKiBAaW50ZXJuYWxcbiAqL1xuY2xhc3MgQXp1cmVTZXJ2aWNlV29ya2Zsb3cgZXh0ZW5kcyBzZXJ2aWNlX3dvcmtmbG93XzEuU2VydmljZVdvcmtmbG93IHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoLi4uYXJndW1lbnRzKTtcbiAgICAgICAgdGhpcy5jYWNoZSA9IG5ldyBhenVyZV90b2tlbl9jYWNoZV8xLkF6dXJlVG9rZW5DYWNoZSgpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBHZXQgdGhlIHRva2VuIGZyb20gdGhlIGVudmlyb25tZW50LlxuICAgICAqL1xuICAgIGFzeW5jIGdldFRva2VuKGNyZWRlbnRpYWxzKSB7XG4gICAgICAgIGNvbnN0IHRva2VuQXVkaWVuY2UgPSBjcmVkZW50aWFscz8ubWVjaGFuaXNtUHJvcGVydGllcy5UT0tFTl9BVURJRU5DRTtcbiAgICAgICAgaWYgKCF0b2tlbkF1ZGllbmNlKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0F6dXJlRXJyb3IoVE9LRU5fQVVESUVOQ0VfTUlTU0lOR19FUlJPUik7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHRva2VuO1xuICAgICAgICBjb25zdCBlbnRyeSA9IHRoaXMuY2FjaGUuZ2V0RW50cnkodG9rZW5BdWRpZW5jZSk7XG4gICAgICAgIGlmIChlbnRyeT8uaXNWYWxpZCgpKSB7XG4gICAgICAgICAgICB0b2tlbiA9IGVudHJ5LnRva2VuO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5jYWNoZS5kZWxldGVFbnRyeSh0b2tlbkF1ZGllbmNlKTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZ2V0QXp1cmVUb2tlbkRhdGEodG9rZW5BdWRpZW5jZSk7XG4gICAgICAgICAgICBpZiAoIWlzRW5kcG9pbnRSZXN1bHRWYWxpZChyZXNwb25zZSkpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0F6dXJlRXJyb3IoRU5EUE9JTlRfUkVTVUxUX0VSUk9SKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuY2FjaGUuYWRkRW50cnkodG9rZW5BdWRpZW5jZSwgcmVzcG9uc2UpO1xuICAgICAgICAgICAgdG9rZW4gPSByZXNwb25zZS5hY2Nlc3NfdG9rZW47XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRva2VuO1xuICAgIH1cbn1cbmV4cG9ydHMuQXp1cmVTZXJ2aWNlV29ya2Zsb3cgPSBBenVyZVNlcnZpY2VXb3JrZmxvdztcbi8qKlxuICogSGl0IHRoZSBBenVyZSBlbmRwb2ludCB0byBnZXQgdGhlIHRva2VuIGRhdGEuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGdldEF6dXJlVG9rZW5EYXRhKHRva2VuQXVkaWVuY2UpIHtcbiAgICBjb25zdCB1cmwgPSBgJHtBWlVSRV9CQVNFX1VSTH0mcmVzb3VyY2U9JHt0b2tlbkF1ZGllbmNlfWA7XG4gICAgY29uc3QgZGF0YSA9IGF3YWl0ICgwLCB1dGlsc18xLnJlcXVlc3QpKHVybCwge1xuICAgICAgICBqc29uOiB0cnVlLFxuICAgICAgICBoZWFkZXJzOiBBWlVSRV9IRUFERVJTXG4gICAgfSk7XG4gICAgcmV0dXJuIGRhdGE7XG59XG4vKipcbiAqIERldGVybWluZXMgaWYgYSByZXN1bHQgcmV0dXJuZWQgZnJvbSB0aGUgZW5kcG9pbnQgaXMgdmFsaWQuXG4gKiBUaGlzIG1lYW5zIHRoZSByZXN1bHQgaXMgbm90IG51bGxpc2gsIGNvbnRhaW5zIHRoZSBhY2Nlc3NfdG9rZW4gcmVxdWlyZWQgZmllbGRcbiAqIGFuZCB0aGUgZXhwaXJlc19pbiByZXF1aXJlZCBmaWVsZC5cbiAqL1xuZnVuY3Rpb24gaXNFbmRwb2ludFJlc3VsdFZhbGlkKHRva2VuKSB7XG4gICAgaWYgKHRva2VuID09IG51bGwgfHwgdHlwZW9mIHRva2VuICE9PSAnb2JqZWN0JylcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIHJldHVybiAnYWNjZXNzX3Rva2VuJyBpbiB0b2tlbiAmJiAnZXhwaXJlc19pbicgaW4gdG9rZW47XG59XG4vLyMgc291cmNlTWFwcGluZ1VSTD1henVyZV9zZXJ2aWNlX3dvcmtmbG93LmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/azure_service_workflow.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/azure_token_cache.js":
/*!**************************************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/azure_token_cache.js ***!
  \**************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.AzureTokenCache = exports.AzureTokenEntry = void 0;\nconst cache_1 = __webpack_require__(/*! ./cache */ \"(api)/../server/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/cache.js\");\n/** @internal */\nclass AzureTokenEntry extends cache_1.ExpiringCacheEntry {\n    /**\n     * Instantiate the entry.\n     */\n    constructor(token, expiration) {\n        super(expiration);\n        this.token = token;\n    }\n}\nexports.AzureTokenEntry = AzureTokenEntry;\n/**\n * A cache of access tokens from Azure.\n * @internal\n */\nclass AzureTokenCache extends cache_1.Cache {\n    /**\n     * Add an entry to the cache.\n     */\n    addEntry(tokenAudience, token) {\n        const entry = new AzureTokenEntry(token.access_token, token.expires_in);\n        this.entries.set(tokenAudience, entry);\n        return entry;\n    }\n    /**\n     * Create a cache key.\n     */\n    cacheKey(tokenAudience) {\n        return tokenAudience;\n    }\n    /**\n     * Delete an entry from the cache.\n     */\n    deleteEntry(tokenAudience) {\n        this.entries.delete(tokenAudience);\n    }\n    /**\n     * Get an Azure token entry from the cache.\n     */\n    getEntry(tokenAudience) {\n        return this.entries.get(tokenAudience);\n    }\n}\nexports.AzureTokenCache = AzureTokenCache;\n//# sourceMappingURL=azure_token_cache.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jbWFwL2F1dGgvbW9uZ29kYl9vaWRjL2F6dXJlX3Rva2VuX2NhY2hlLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELHVCQUF1QixHQUFHLHVCQUF1QjtBQUNqRCxnQkFBZ0IsbUJBQU8sQ0FBQyx5RkFBUztBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QjtBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCO0FBQ3ZCIiwic291cmNlcyI6WyJEOlxcc2Fsb25pXFxhcHByYWlzYWwtc3lzdGVtXFxzZXJ2ZXJcXG5vZGVfbW9kdWxlc1xcbW9uZ29kYlxcbGliXFxjbWFwXFxhdXRoXFxtb25nb2RiX29pZGNcXGF6dXJlX3Rva2VuX2NhY2hlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5BenVyZVRva2VuQ2FjaGUgPSBleHBvcnRzLkF6dXJlVG9rZW5FbnRyeSA9IHZvaWQgMDtcbmNvbnN0IGNhY2hlXzEgPSByZXF1aXJlKFwiLi9jYWNoZVwiKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIEF6dXJlVG9rZW5FbnRyeSBleHRlbmRzIGNhY2hlXzEuRXhwaXJpbmdDYWNoZUVudHJ5IHtcbiAgICAvKipcbiAgICAgKiBJbnN0YW50aWF0ZSB0aGUgZW50cnkuXG4gICAgICovXG4gICAgY29uc3RydWN0b3IodG9rZW4sIGV4cGlyYXRpb24pIHtcbiAgICAgICAgc3VwZXIoZXhwaXJhdGlvbik7XG4gICAgICAgIHRoaXMudG9rZW4gPSB0b2tlbjtcbiAgICB9XG59XG5leHBvcnRzLkF6dXJlVG9rZW5FbnRyeSA9IEF6dXJlVG9rZW5FbnRyeTtcbi8qKlxuICogQSBjYWNoZSBvZiBhY2Nlc3MgdG9rZW5zIGZyb20gQXp1cmUuXG4gKiBAaW50ZXJuYWxcbiAqL1xuY2xhc3MgQXp1cmVUb2tlbkNhY2hlIGV4dGVuZHMgY2FjaGVfMS5DYWNoZSB7XG4gICAgLyoqXG4gICAgICogQWRkIGFuIGVudHJ5IHRvIHRoZSBjYWNoZS5cbiAgICAgKi9cbiAgICBhZGRFbnRyeSh0b2tlbkF1ZGllbmNlLCB0b2tlbikge1xuICAgICAgICBjb25zdCBlbnRyeSA9IG5ldyBBenVyZVRva2VuRW50cnkodG9rZW4uYWNjZXNzX3Rva2VuLCB0b2tlbi5leHBpcmVzX2luKTtcbiAgICAgICAgdGhpcy5lbnRyaWVzLnNldCh0b2tlbkF1ZGllbmNlLCBlbnRyeSk7XG4gICAgICAgIHJldHVybiBlbnRyeTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgY2FjaGUga2V5LlxuICAgICAqL1xuICAgIGNhY2hlS2V5KHRva2VuQXVkaWVuY2UpIHtcbiAgICAgICAgcmV0dXJuIHRva2VuQXVkaWVuY2U7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIERlbGV0ZSBhbiBlbnRyeSBmcm9tIHRoZSBjYWNoZS5cbiAgICAgKi9cbiAgICBkZWxldGVFbnRyeSh0b2tlbkF1ZGllbmNlKSB7XG4gICAgICAgIHRoaXMuZW50cmllcy5kZWxldGUodG9rZW5BdWRpZW5jZSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEdldCBhbiBBenVyZSB0b2tlbiBlbnRyeSBmcm9tIHRoZSBjYWNoZS5cbiAgICAgKi9cbiAgICBnZXRFbnRyeSh0b2tlbkF1ZGllbmNlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmVudHJpZXMuZ2V0KHRva2VuQXVkaWVuY2UpO1xuICAgIH1cbn1cbmV4cG9ydHMuQXp1cmVUb2tlbkNhY2hlID0gQXp1cmVUb2tlbkNhY2hlO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXp1cmVfdG9rZW5fY2FjaGUuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/azure_token_cache.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/cache.js":
/*!**************************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/cache.js ***!
  \**************************************************************************/
/***/ ((__unused_webpack_module, exports) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.Cache = exports.ExpiringCacheEntry = void 0;\n/* 5 minutes in milliseconds */\nconst EXPIRATION_BUFFER_MS = 300000;\n/**\n * An entry in a cache that can expire in a certain amount of time.\n */\nclass ExpiringCacheEntry {\n    /**\n     * Create a new expiring token entry.\n     */\n    constructor(expiration) {\n        this.expiration = this.expirationTime(expiration);\n    }\n    /**\n     * The entry is still valid if the expiration is more than\n     * 5 minutes from the expiration time.\n     */\n    isValid() {\n        return this.expiration - Date.now() > EXPIRATION_BUFFER_MS;\n    }\n    /**\n     * Get an expiration time in milliseconds past epoch.\n     */\n    expirationTime(expiresInSeconds) {\n        return Date.now() + expiresInSeconds * 1000;\n    }\n}\nexports.ExpiringCacheEntry = ExpiringCacheEntry;\n/**\n * Base class for OIDC caches.\n */\nclass Cache {\n    /**\n     * Create a new cache.\n     */\n    constructor() {\n        this.entries = new Map();\n    }\n    /**\n     * Clear the cache.\n     */\n    clear() {\n        this.entries.clear();\n    }\n    /**\n     * Create a cache key from the address and username.\n     */\n    hashedCacheKey(address, username, callbackHash) {\n        return JSON.stringify([address, username, callbackHash]);\n    }\n}\nexports.Cache = Cache;\n//# sourceMappingURL=cache.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jbWFwL2F1dGgvbW9uZ29kYl9vaWRjL2NhY2hlLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELGFBQWEsR0FBRywwQkFBMEI7QUFDMUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQjtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiIiwic291cmNlcyI6WyJEOlxcc2Fsb25pXFxhcHByYWlzYWwtc3lzdGVtXFxzZXJ2ZXJcXG5vZGVfbW9kdWxlc1xcbW9uZ29kYlxcbGliXFxjbWFwXFxhdXRoXFxtb25nb2RiX29pZGNcXGNhY2hlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5DYWNoZSA9IGV4cG9ydHMuRXhwaXJpbmdDYWNoZUVudHJ5ID0gdm9pZCAwO1xuLyogNSBtaW51dGVzIGluIG1pbGxpc2Vjb25kcyAqL1xuY29uc3QgRVhQSVJBVElPTl9CVUZGRVJfTVMgPSAzMDAwMDA7XG4vKipcbiAqIEFuIGVudHJ5IGluIGEgY2FjaGUgdGhhdCBjYW4gZXhwaXJlIGluIGEgY2VydGFpbiBhbW91bnQgb2YgdGltZS5cbiAqL1xuY2xhc3MgRXhwaXJpbmdDYWNoZUVudHJ5IHtcbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBuZXcgZXhwaXJpbmcgdG9rZW4gZW50cnkuXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoZXhwaXJhdGlvbikge1xuICAgICAgICB0aGlzLmV4cGlyYXRpb24gPSB0aGlzLmV4cGlyYXRpb25UaW1lKGV4cGlyYXRpb24pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBUaGUgZW50cnkgaXMgc3RpbGwgdmFsaWQgaWYgdGhlIGV4cGlyYXRpb24gaXMgbW9yZSB0aGFuXG4gICAgICogNSBtaW51dGVzIGZyb20gdGhlIGV4cGlyYXRpb24gdGltZS5cbiAgICAgKi9cbiAgICBpc1ZhbGlkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5leHBpcmF0aW9uIC0gRGF0ZS5ub3coKSA+IEVYUElSQVRJT05fQlVGRkVSX01TO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBHZXQgYW4gZXhwaXJhdGlvbiB0aW1lIGluIG1pbGxpc2Vjb25kcyBwYXN0IGVwb2NoLlxuICAgICAqL1xuICAgIGV4cGlyYXRpb25UaW1lKGV4cGlyZXNJblNlY29uZHMpIHtcbiAgICAgICAgcmV0dXJuIERhdGUubm93KCkgKyBleHBpcmVzSW5TZWNvbmRzICogMTAwMDtcbiAgICB9XG59XG5leHBvcnRzLkV4cGlyaW5nQ2FjaGVFbnRyeSA9IEV4cGlyaW5nQ2FjaGVFbnRyeTtcbi8qKlxuICogQmFzZSBjbGFzcyBmb3IgT0lEQyBjYWNoZXMuXG4gKi9cbmNsYXNzIENhY2hlIHtcbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBuZXcgY2FjaGUuXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuZW50cmllcyA9IG5ldyBNYXAoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2xlYXIgdGhlIGNhY2hlLlxuICAgICAqL1xuICAgIGNsZWFyKCkge1xuICAgICAgICB0aGlzLmVudHJpZXMuY2xlYXIoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgY2FjaGUga2V5IGZyb20gdGhlIGFkZHJlc3MgYW5kIHVzZXJuYW1lLlxuICAgICAqL1xuICAgIGhhc2hlZENhY2hlS2V5KGFkZHJlc3MsIHVzZXJuYW1lLCBjYWxsYmFja0hhc2gpIHtcbiAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KFthZGRyZXNzLCB1c2VybmFtZSwgY2FsbGJhY2tIYXNoXSk7XG4gICAgfVxufVxuZXhwb3J0cy5DYWNoZSA9IENhY2hlO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y2FjaGUuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/cache.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/callback_lock_cache.js":
/*!****************************************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/callback_lock_cache.js ***!
  \****************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.CallbackLockCache = void 0;\nconst error_1 = __webpack_require__(/*! ../../../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst cache_1 = __webpack_require__(/*! ./cache */ \"(api)/../server/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/cache.js\");\n/** Error message for when request callback is missing. */\nconst REQUEST_CALLBACK_REQUIRED_ERROR = 'Auth mechanism property REQUEST_TOKEN_CALLBACK is required.';\n/* Counter for function \"hashes\".*/\nlet FN_HASH_COUNTER = 0;\n/* No function present function */\nconst NO_FUNCTION = async () => ({ accessToken: 'test' });\n/* The map of function hashes */\nconst FN_HASHES = new WeakMap();\n/* Put the no function hash in the map. */\nFN_HASHES.set(NO_FUNCTION, FN_HASH_COUNTER);\n/**\n * A cache of request and refresh callbacks per server/user.\n */\nclass CallbackLockCache extends cache_1.Cache {\n    /**\n     * Get the callbacks for the connection and credentials. If an entry does not\n     * exist a new one will get set.\n     */\n    getEntry(connection, credentials) {\n        const requestCallback = credentials.mechanismProperties.REQUEST_TOKEN_CALLBACK;\n        const refreshCallback = credentials.mechanismProperties.REFRESH_TOKEN_CALLBACK;\n        if (!requestCallback) {\n            throw new error_1.MongoInvalidArgumentError(REQUEST_CALLBACK_REQUIRED_ERROR);\n        }\n        const callbackHash = hashFunctions(requestCallback, refreshCallback);\n        const key = this.cacheKey(connection.address, credentials.username, callbackHash);\n        const entry = this.entries.get(key);\n        if (entry) {\n            return entry;\n        }\n        return this.addEntry(key, callbackHash, requestCallback, refreshCallback);\n    }\n    /**\n     * Set locked callbacks on for connection and credentials.\n     */\n    addEntry(key, callbackHash, requestCallback, refreshCallback) {\n        const entry = {\n            requestCallback: withLock(requestCallback),\n            refreshCallback: refreshCallback ? withLock(refreshCallback) : undefined,\n            callbackHash: callbackHash\n        };\n        this.entries.set(key, entry);\n        return entry;\n    }\n    /**\n     * Create a cache key from the address and username.\n     */\n    cacheKey(address, username, callbackHash) {\n        return this.hashedCacheKey(address, username, callbackHash);\n    }\n}\nexports.CallbackLockCache = CallbackLockCache;\n/**\n * Ensure the callback is only executed one at a time.\n */\nfunction withLock(callback) {\n    let lock = Promise.resolve();\n    return async (info, context) => {\n        await lock;\n        lock = lock.then(() => callback(info, context));\n        return lock;\n    };\n}\n/**\n * Get the hash string for the request and refresh functions.\n */\nfunction hashFunctions(requestFn, refreshFn) {\n    let requestHash = FN_HASHES.get(requestFn);\n    let refreshHash = FN_HASHES.get(refreshFn ?? NO_FUNCTION);\n    if (requestHash == null) {\n        // Create a new one for the function and put it in the map.\n        FN_HASH_COUNTER++;\n        requestHash = FN_HASH_COUNTER;\n        FN_HASHES.set(requestFn, FN_HASH_COUNTER);\n    }\n    if (refreshHash == null && refreshFn) {\n        // Create a new one for the function and put it in the map.\n        FN_HASH_COUNTER++;\n        refreshHash = FN_HASH_COUNTER;\n        FN_HASHES.set(refreshFn, FN_HASH_COUNTER);\n    }\n    return `${requestHash}-${refreshHash}`;\n}\n//# sourceMappingURL=callback_lock_cache.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jbWFwL2F1dGgvbW9uZ29kYl9vaWRjL2NhbGxiYWNrX2xvY2tfY2FjaGUuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QseUJBQXlCO0FBQ3pCLGdCQUFnQixtQkFBTyxDQUFDLHlFQUFnQjtBQUN4QyxnQkFBZ0IsbUJBQU8sQ0FBQyx5RkFBUztBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUNBQW1DLHFCQUFxQjtBQUN4RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWMsWUFBWSxHQUFHLFlBQVk7QUFDekM7QUFDQSIsInNvdXJjZXMiOlsiRDpcXHNhbG9uaVxcYXBwcmFpc2FsLXN5c3RlbVxcc2VydmVyXFxub2RlX21vZHVsZXNcXG1vbmdvZGJcXGxpYlxcY21hcFxcYXV0aFxcbW9uZ29kYl9vaWRjXFxjYWxsYmFja19sb2NrX2NhY2hlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5DYWxsYmFja0xvY2tDYWNoZSA9IHZvaWQgMDtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vZXJyb3JcIik7XG5jb25zdCBjYWNoZV8xID0gcmVxdWlyZShcIi4vY2FjaGVcIik7XG4vKiogRXJyb3IgbWVzc2FnZSBmb3Igd2hlbiByZXF1ZXN0IGNhbGxiYWNrIGlzIG1pc3NpbmcuICovXG5jb25zdCBSRVFVRVNUX0NBTExCQUNLX1JFUVVJUkVEX0VSUk9SID0gJ0F1dGggbWVjaGFuaXNtIHByb3BlcnR5IFJFUVVFU1RfVE9LRU5fQ0FMTEJBQ0sgaXMgcmVxdWlyZWQuJztcbi8qIENvdW50ZXIgZm9yIGZ1bmN0aW9uIFwiaGFzaGVzXCIuKi9cbmxldCBGTl9IQVNIX0NPVU5URVIgPSAwO1xuLyogTm8gZnVuY3Rpb24gcHJlc2VudCBmdW5jdGlvbiAqL1xuY29uc3QgTk9fRlVOQ1RJT04gPSBhc3luYyAoKSA9PiAoeyBhY2Nlc3NUb2tlbjogJ3Rlc3QnIH0pO1xuLyogVGhlIG1hcCBvZiBmdW5jdGlvbiBoYXNoZXMgKi9cbmNvbnN0IEZOX0hBU0hFUyA9IG5ldyBXZWFrTWFwKCk7XG4vKiBQdXQgdGhlIG5vIGZ1bmN0aW9uIGhhc2ggaW4gdGhlIG1hcC4gKi9cbkZOX0hBU0hFUy5zZXQoTk9fRlVOQ1RJT04sIEZOX0hBU0hfQ09VTlRFUik7XG4vKipcbiAqIEEgY2FjaGUgb2YgcmVxdWVzdCBhbmQgcmVmcmVzaCBjYWxsYmFja3MgcGVyIHNlcnZlci91c2VyLlxuICovXG5jbGFzcyBDYWxsYmFja0xvY2tDYWNoZSBleHRlbmRzIGNhY2hlXzEuQ2FjaGUge1xuICAgIC8qKlxuICAgICAqIEdldCB0aGUgY2FsbGJhY2tzIGZvciB0aGUgY29ubmVjdGlvbiBhbmQgY3JlZGVudGlhbHMuIElmIGFuIGVudHJ5IGRvZXMgbm90XG4gICAgICogZXhpc3QgYSBuZXcgb25lIHdpbGwgZ2V0IHNldC5cbiAgICAgKi9cbiAgICBnZXRFbnRyeShjb25uZWN0aW9uLCBjcmVkZW50aWFscykge1xuICAgICAgICBjb25zdCByZXF1ZXN0Q2FsbGJhY2sgPSBjcmVkZW50aWFscy5tZWNoYW5pc21Qcm9wZXJ0aWVzLlJFUVVFU1RfVE9LRU5fQ0FMTEJBQ0s7XG4gICAgICAgIGNvbnN0IHJlZnJlc2hDYWxsYmFjayA9IGNyZWRlbnRpYWxzLm1lY2hhbmlzbVByb3BlcnRpZXMuUkVGUkVTSF9UT0tFTl9DQUxMQkFDSztcbiAgICAgICAgaWYgKCFyZXF1ZXN0Q2FsbGJhY2spIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoUkVRVUVTVF9DQUxMQkFDS19SRVFVSVJFRF9FUlJPUik7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2FsbGJhY2tIYXNoID0gaGFzaEZ1bmN0aW9ucyhyZXF1ZXN0Q2FsbGJhY2ssIHJlZnJlc2hDYWxsYmFjayk7XG4gICAgICAgIGNvbnN0IGtleSA9IHRoaXMuY2FjaGVLZXkoY29ubmVjdGlvbi5hZGRyZXNzLCBjcmVkZW50aWFscy51c2VybmFtZSwgY2FsbGJhY2tIYXNoKTtcbiAgICAgICAgY29uc3QgZW50cnkgPSB0aGlzLmVudHJpZXMuZ2V0KGtleSk7XG4gICAgICAgIGlmIChlbnRyeSkge1xuICAgICAgICAgICAgcmV0dXJuIGVudHJ5O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLmFkZEVudHJ5KGtleSwgY2FsbGJhY2tIYXNoLCByZXF1ZXN0Q2FsbGJhY2ssIHJlZnJlc2hDYWxsYmFjayk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNldCBsb2NrZWQgY2FsbGJhY2tzIG9uIGZvciBjb25uZWN0aW9uIGFuZCBjcmVkZW50aWFscy5cbiAgICAgKi9cbiAgICBhZGRFbnRyeShrZXksIGNhbGxiYWNrSGFzaCwgcmVxdWVzdENhbGxiYWNrLCByZWZyZXNoQ2FsbGJhY2spIHtcbiAgICAgICAgY29uc3QgZW50cnkgPSB7XG4gICAgICAgICAgICByZXF1ZXN0Q2FsbGJhY2s6IHdpdGhMb2NrKHJlcXVlc3RDYWxsYmFjayksXG4gICAgICAgICAgICByZWZyZXNoQ2FsbGJhY2s6IHJlZnJlc2hDYWxsYmFjayA/IHdpdGhMb2NrKHJlZnJlc2hDYWxsYmFjaykgOiB1bmRlZmluZWQsXG4gICAgICAgICAgICBjYWxsYmFja0hhc2g6IGNhbGxiYWNrSGFzaFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmVudHJpZXMuc2V0KGtleSwgZW50cnkpO1xuICAgICAgICByZXR1cm4gZW50cnk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIGNhY2hlIGtleSBmcm9tIHRoZSBhZGRyZXNzIGFuZCB1c2VybmFtZS5cbiAgICAgKi9cbiAgICBjYWNoZUtleShhZGRyZXNzLCB1c2VybmFtZSwgY2FsbGJhY2tIYXNoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmhhc2hlZENhY2hlS2V5KGFkZHJlc3MsIHVzZXJuYW1lLCBjYWxsYmFja0hhc2gpO1xuICAgIH1cbn1cbmV4cG9ydHMuQ2FsbGJhY2tMb2NrQ2FjaGUgPSBDYWxsYmFja0xvY2tDYWNoZTtcbi8qKlxuICogRW5zdXJlIHRoZSBjYWxsYmFjayBpcyBvbmx5IGV4ZWN1dGVkIG9uZSBhdCBhIHRpbWUuXG4gKi9cbmZ1bmN0aW9uIHdpdGhMb2NrKGNhbGxiYWNrKSB7XG4gICAgbGV0IGxvY2sgPSBQcm9taXNlLnJlc29sdmUoKTtcbiAgICByZXR1cm4gYXN5bmMgKGluZm8sIGNvbnRleHQpID0+IHtcbiAgICAgICAgYXdhaXQgbG9jaztcbiAgICAgICAgbG9jayA9IGxvY2sudGhlbigoKSA9PiBjYWxsYmFjayhpbmZvLCBjb250ZXh0KSk7XG4gICAgICAgIHJldHVybiBsb2NrO1xuICAgIH07XG59XG4vKipcbiAqIEdldCB0aGUgaGFzaCBzdHJpbmcgZm9yIHRoZSByZXF1ZXN0IGFuZCByZWZyZXNoIGZ1bmN0aW9ucy5cbiAqL1xuZnVuY3Rpb24gaGFzaEZ1bmN0aW9ucyhyZXF1ZXN0Rm4sIHJlZnJlc2hGbikge1xuICAgIGxldCByZXF1ZXN0SGFzaCA9IEZOX0hBU0hFUy5nZXQocmVxdWVzdEZuKTtcbiAgICBsZXQgcmVmcmVzaEhhc2ggPSBGTl9IQVNIRVMuZ2V0KHJlZnJlc2hGbiA/PyBOT19GVU5DVElPTik7XG4gICAgaWYgKHJlcXVlc3RIYXNoID09IG51bGwpIHtcbiAgICAgICAgLy8gQ3JlYXRlIGEgbmV3IG9uZSBmb3IgdGhlIGZ1bmN0aW9uIGFuZCBwdXQgaXQgaW4gdGhlIG1hcC5cbiAgICAgICAgRk5fSEFTSF9DT1VOVEVSKys7XG4gICAgICAgIHJlcXVlc3RIYXNoID0gRk5fSEFTSF9DT1VOVEVSO1xuICAgICAgICBGTl9IQVNIRVMuc2V0KHJlcXVlc3RGbiwgRk5fSEFTSF9DT1VOVEVSKTtcbiAgICB9XG4gICAgaWYgKHJlZnJlc2hIYXNoID09IG51bGwgJiYgcmVmcmVzaEZuKSB7XG4gICAgICAgIC8vIENyZWF0ZSBhIG5ldyBvbmUgZm9yIHRoZSBmdW5jdGlvbiBhbmQgcHV0IGl0IGluIHRoZSBtYXAuXG4gICAgICAgIEZOX0hBU0hfQ09VTlRFUisrO1xuICAgICAgICByZWZyZXNoSGFzaCA9IEZOX0hBU0hfQ09VTlRFUjtcbiAgICAgICAgRk5fSEFTSEVTLnNldChyZWZyZXNoRm4sIEZOX0hBU0hfQ09VTlRFUik7XG4gICAgfVxuICAgIHJldHVybiBgJHtyZXF1ZXN0SGFzaH0tJHtyZWZyZXNoSGFzaH1gO1xufVxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y2FsbGJhY2tfbG9ja19jYWNoZS5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/callback_lock_cache.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/callback_workflow.js":
/*!**************************************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/callback_workflow.js ***!
  \**************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.CallbackWorkflow = void 0;\nconst bson_1 = __webpack_require__(/*! bson */ \"(api)/../server/node_modules/bson/lib/bson.cjs\");\nconst error_1 = __webpack_require__(/*! ../../../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst utils_1 = __webpack_require__(/*! ../../../utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\nconst providers_1 = __webpack_require__(/*! ../providers */ \"(api)/../server/node_modules/mongodb/lib/cmap/auth/providers.js\");\nconst callback_lock_cache_1 = __webpack_require__(/*! ./callback_lock_cache */ \"(api)/../server/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/callback_lock_cache.js\");\nconst token_entry_cache_1 = __webpack_require__(/*! ./token_entry_cache */ \"(api)/../server/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/token_entry_cache.js\");\n/** The current version of OIDC implementation. */\nconst OIDC_VERSION = 0;\n/** 5 minutes in seconds */\nconst TIMEOUT_S = 300;\n/** Properties allowed on results of callbacks. */\nconst RESULT_PROPERTIES = ['accessToken', 'expiresInSeconds', 'refreshToken'];\n/** Error message when the callback result is invalid. */\nconst CALLBACK_RESULT_ERROR = 'User provided OIDC callbacks must return a valid object with an accessToken.';\n/**\n * OIDC implementation of a callback based workflow.\n * @internal\n */\nclass CallbackWorkflow {\n    /**\n     * Instantiate the workflow\n     */\n    constructor() {\n        this.cache = new token_entry_cache_1.TokenEntryCache();\n        this.callbackCache = new callback_lock_cache_1.CallbackLockCache();\n    }\n    /**\n     * Get the document to add for speculative authentication. This also needs\n     * to add a db field from the credentials source.\n     */\n    async speculativeAuth(credentials) {\n        const document = startCommandDocument(credentials);\n        document.db = credentials.source;\n        return { speculativeAuthenticate: document };\n    }\n    /**\n     * Execute the OIDC callback workflow.\n     */\n    async execute(connection, credentials, reauthenticating, response) {\n        // Get the callbacks with locks from the callback lock cache.\n        const { requestCallback, refreshCallback, callbackHash } = this.callbackCache.getEntry(connection, credentials);\n        // Look for an existing entry in the cache.\n        const entry = this.cache.getEntry(connection.address, credentials.username, callbackHash);\n        let result;\n        if (entry) {\n            // Reauthentication cannot use a token from the cache since the server has\n            // stated it is invalid by the request for reauthentication.\n            if (entry.isValid() && !reauthenticating) {\n                // Presence of a valid cache entry means we can skip to the finishing step.\n                result = await this.finishAuthentication(connection, credentials, entry.tokenResult, response?.speculativeAuthenticate?.conversationId);\n            }\n            else {\n                // Presence of an expired cache entry means we must fetch a new one and\n                // then execute the final step.\n                const tokenResult = await this.fetchAccessToken(connection, credentials, entry.serverInfo, reauthenticating, callbackHash, requestCallback, refreshCallback);\n                try {\n                    result = await this.finishAuthentication(connection, credentials, tokenResult, reauthenticating ? undefined : response?.speculativeAuthenticate?.conversationId);\n                }\n                catch (error) {\n                    // If we are reauthenticating and this errors with reauthentication\n                    // required, we need to do the entire process over again and clear\n                    // the cache entry.\n                    if (reauthenticating &&\n                        error instanceof error_1.MongoError &&\n                        error.code === error_1.MONGODB_ERROR_CODES.Reauthenticate) {\n                        this.cache.deleteEntry(connection.address, credentials.username, callbackHash);\n                        result = await this.execute(connection, credentials, reauthenticating);\n                    }\n                    else {\n                        throw error;\n                    }\n                }\n            }\n        }\n        else {\n            // No entry in the cache requires us to do all authentication steps\n            // from start to finish, including getting a fresh token for the cache.\n            const startDocument = await this.startAuthentication(connection, credentials, reauthenticating, response);\n            const conversationId = startDocument.conversationId;\n            const serverResult = bson_1.BSON.deserialize(startDocument.payload.buffer);\n            const tokenResult = await this.fetchAccessToken(connection, credentials, serverResult, reauthenticating, callbackHash, requestCallback, refreshCallback);\n            result = await this.finishAuthentication(connection, credentials, tokenResult, conversationId);\n        }\n        return result;\n    }\n    /**\n     * Starts the callback authentication process. If there is a speculative\n     * authentication document from the initial handshake, then we will use that\n     * value to get the issuer, otherwise we will send the saslStart command.\n     */\n    async startAuthentication(connection, credentials, reauthenticating, response) {\n        let result;\n        if (!reauthenticating && response?.speculativeAuthenticate) {\n            result = response.speculativeAuthenticate;\n        }\n        else {\n            result = await connection.commandAsync((0, utils_1.ns)(credentials.source), startCommandDocument(credentials), undefined);\n        }\n        return result;\n    }\n    /**\n     * Finishes the callback authentication process.\n     */\n    async finishAuthentication(connection, credentials, tokenResult, conversationId) {\n        const result = await connection.commandAsync((0, utils_1.ns)(credentials.source), finishCommandDocument(tokenResult.accessToken, conversationId), undefined);\n        return result;\n    }\n    /**\n     * Fetches an access token using either the request or refresh callbacks and\n     * puts it in the cache.\n     */\n    async fetchAccessToken(connection, credentials, serverInfo, reauthenticating, callbackHash, requestCallback, refreshCallback) {\n        // Get the token from the cache.\n        const entry = this.cache.getEntry(connection.address, credentials.username, callbackHash);\n        let result;\n        const context = { timeoutSeconds: TIMEOUT_S, version: OIDC_VERSION };\n        // Check if there's a token in the cache.\n        if (entry) {\n            // If the cache entry is valid, return the token result.\n            if (entry.isValid() && !reauthenticating) {\n                return entry.tokenResult;\n            }\n            // If the cache entry is not valid, remove it from the cache and first attempt\n            // to use the refresh callback to get a new token. If no refresh callback\n            // exists, then fallback to the request callback.\n            if (refreshCallback) {\n                context.refreshToken = entry.tokenResult.refreshToken;\n                result = await refreshCallback(serverInfo, context);\n            }\n            else {\n                result = await requestCallback(serverInfo, context);\n            }\n        }\n        else {\n            // With no token in the cache we use the request callback.\n            result = await requestCallback(serverInfo, context);\n        }\n        // Validate that the result returned by the callback is acceptable. If it is not\n        // we must clear the token result from the cache.\n        if (isCallbackResultInvalid(result)) {\n            this.cache.deleteEntry(connection.address, credentials.username, callbackHash);\n            throw new error_1.MongoMissingCredentialsError(CALLBACK_RESULT_ERROR);\n        }\n        // Cleanup the cache.\n        this.cache.deleteExpiredEntries();\n        // Put the new entry into the cache.\n        this.cache.addEntry(connection.address, credentials.username || '', callbackHash, result, serverInfo);\n        return result;\n    }\n}\nexports.CallbackWorkflow = CallbackWorkflow;\n/**\n * Generate the finishing command document for authentication. Will be a\n * saslStart or saslContinue depending on the presence of a conversation id.\n */\nfunction finishCommandDocument(token, conversationId) {\n    if (conversationId != null && typeof conversationId === 'number') {\n        return {\n            saslContinue: 1,\n            conversationId: conversationId,\n            payload: new bson_1.Binary(bson_1.BSON.serialize({ jwt: token }))\n        };\n    }\n    // saslContinue requires a conversationId in the command to be valid so in this\n    // case the server allows \"step two\" to actually be a saslStart with the token\n    // as the jwt since the use of the cached value has no correlating conversating\n    // on the particular connection.\n    return {\n        saslStart: 1,\n        mechanism: providers_1.AuthMechanism.MONGODB_OIDC,\n        payload: new bson_1.Binary(bson_1.BSON.serialize({ jwt: token }))\n    };\n}\n/**\n * Determines if a result returned from a request or refresh callback\n * function is invalid. This means the result is nullish, doesn't contain\n * the accessToken required field, and does not contain extra fields.\n */\nfunction isCallbackResultInvalid(tokenResult) {\n    if (tokenResult == null || typeof tokenResult !== 'object')\n        return true;\n    if (!('accessToken' in tokenResult))\n        return true;\n    return !Object.getOwnPropertyNames(tokenResult).every(prop => RESULT_PROPERTIES.includes(prop));\n}\n/**\n * Generate the saslStart command document.\n */\nfunction startCommandDocument(credentials) {\n    const payload = {};\n    if (credentials.username) {\n        payload.n = credentials.username;\n    }\n    return {\n        saslStart: 1,\n        autoAuthorize: 1,\n        mechanism: providers_1.AuthMechanism.MONGODB_OIDC,\n        payload: new bson_1.Binary(bson_1.BSON.serialize(payload))\n    };\n}\n//# sourceMappingURL=callback_workflow.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jbWFwL2F1dGgvbW9uZ29kYl9vaWRjL2NhbGxiYWNrX3dvcmtmbG93LmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELHdCQUF3QjtBQUN4QixlQUFlLG1CQUFPLENBQUMsNERBQU07QUFDN0IsZ0JBQWdCLG1CQUFPLENBQUMseUVBQWdCO0FBQ3hDLGdCQUFnQixtQkFBTyxDQUFDLHlFQUFnQjtBQUN4QyxvQkFBb0IsbUJBQU8sQ0FBQyxxRkFBYztBQUMxQyw4QkFBOEIsbUJBQU8sQ0FBQyxxSEFBdUI7QUFDN0QsNEJBQTRCLG1CQUFPLENBQUMsaUhBQXFCO0FBQ3pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsaURBQWlEO0FBQ2pFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEI7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0I7QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0RBQStELFlBQVk7QUFDM0U7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkRBQTJELFlBQVk7QUFDdkU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJEOlxcc2Fsb25pXFxhcHByYWlzYWwtc3lzdGVtXFxzZXJ2ZXJcXG5vZGVfbW9kdWxlc1xcbW9uZ29kYlxcbGliXFxjbWFwXFxhdXRoXFxtb25nb2RiX29pZGNcXGNhbGxiYWNrX3dvcmtmbG93LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5DYWxsYmFja1dvcmtmbG93ID0gdm9pZCAwO1xuY29uc3QgYnNvbl8xID0gcmVxdWlyZShcImJzb25cIik7XG5jb25zdCBlcnJvcl8xID0gcmVxdWlyZShcIi4uLy4uLy4uL2Vycm9yXCIpO1xuY29uc3QgdXRpbHNfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi91dGlsc1wiKTtcbmNvbnN0IHByb3ZpZGVyc18xID0gcmVxdWlyZShcIi4uL3Byb3ZpZGVyc1wiKTtcbmNvbnN0IGNhbGxiYWNrX2xvY2tfY2FjaGVfMSA9IHJlcXVpcmUoXCIuL2NhbGxiYWNrX2xvY2tfY2FjaGVcIik7XG5jb25zdCB0b2tlbl9lbnRyeV9jYWNoZV8xID0gcmVxdWlyZShcIi4vdG9rZW5fZW50cnlfY2FjaGVcIik7XG4vKiogVGhlIGN1cnJlbnQgdmVyc2lvbiBvZiBPSURDIGltcGxlbWVudGF0aW9uLiAqL1xuY29uc3QgT0lEQ19WRVJTSU9OID0gMDtcbi8qKiA1IG1pbnV0ZXMgaW4gc2Vjb25kcyAqL1xuY29uc3QgVElNRU9VVF9TID0gMzAwO1xuLyoqIFByb3BlcnRpZXMgYWxsb3dlZCBvbiByZXN1bHRzIG9mIGNhbGxiYWNrcy4gKi9cbmNvbnN0IFJFU1VMVF9QUk9QRVJUSUVTID0gWydhY2Nlc3NUb2tlbicsICdleHBpcmVzSW5TZWNvbmRzJywgJ3JlZnJlc2hUb2tlbiddO1xuLyoqIEVycm9yIG1lc3NhZ2Ugd2hlbiB0aGUgY2FsbGJhY2sgcmVzdWx0IGlzIGludmFsaWQuICovXG5jb25zdCBDQUxMQkFDS19SRVNVTFRfRVJST1IgPSAnVXNlciBwcm92aWRlZCBPSURDIGNhbGxiYWNrcyBtdXN0IHJldHVybiBhIHZhbGlkIG9iamVjdCB3aXRoIGFuIGFjY2Vzc1Rva2VuLic7XG4vKipcbiAqIE9JREMgaW1wbGVtZW50YXRpb24gb2YgYSBjYWxsYmFjayBiYXNlZCB3b3JrZmxvdy5cbiAqIEBpbnRlcm5hbFxuICovXG5jbGFzcyBDYWxsYmFja1dvcmtmbG93IHtcbiAgICAvKipcbiAgICAgKiBJbnN0YW50aWF0ZSB0aGUgd29ya2Zsb3dcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5jYWNoZSA9IG5ldyB0b2tlbl9lbnRyeV9jYWNoZV8xLlRva2VuRW50cnlDYWNoZSgpO1xuICAgICAgICB0aGlzLmNhbGxiYWNrQ2FjaGUgPSBuZXcgY2FsbGJhY2tfbG9ja19jYWNoZV8xLkNhbGxiYWNrTG9ja0NhY2hlKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEdldCB0aGUgZG9jdW1lbnQgdG8gYWRkIGZvciBzcGVjdWxhdGl2ZSBhdXRoZW50aWNhdGlvbi4gVGhpcyBhbHNvIG5lZWRzXG4gICAgICogdG8gYWRkIGEgZGIgZmllbGQgZnJvbSB0aGUgY3JlZGVudGlhbHMgc291cmNlLlxuICAgICAqL1xuICAgIGFzeW5jIHNwZWN1bGF0aXZlQXV0aChjcmVkZW50aWFscykge1xuICAgICAgICBjb25zdCBkb2N1bWVudCA9IHN0YXJ0Q29tbWFuZERvY3VtZW50KGNyZWRlbnRpYWxzKTtcbiAgICAgICAgZG9jdW1lbnQuZGIgPSBjcmVkZW50aWFscy5zb3VyY2U7XG4gICAgICAgIHJldHVybiB7IHNwZWN1bGF0aXZlQXV0aGVudGljYXRlOiBkb2N1bWVudCB9O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBFeGVjdXRlIHRoZSBPSURDIGNhbGxiYWNrIHdvcmtmbG93LlxuICAgICAqL1xuICAgIGFzeW5jIGV4ZWN1dGUoY29ubmVjdGlvbiwgY3JlZGVudGlhbHMsIHJlYXV0aGVudGljYXRpbmcsIHJlc3BvbnNlKSB7XG4gICAgICAgIC8vIEdldCB0aGUgY2FsbGJhY2tzIHdpdGggbG9ja3MgZnJvbSB0aGUgY2FsbGJhY2sgbG9jayBjYWNoZS5cbiAgICAgICAgY29uc3QgeyByZXF1ZXN0Q2FsbGJhY2ssIHJlZnJlc2hDYWxsYmFjaywgY2FsbGJhY2tIYXNoIH0gPSB0aGlzLmNhbGxiYWNrQ2FjaGUuZ2V0RW50cnkoY29ubmVjdGlvbiwgY3JlZGVudGlhbHMpO1xuICAgICAgICAvLyBMb29rIGZvciBhbiBleGlzdGluZyBlbnRyeSBpbiB0aGUgY2FjaGUuXG4gICAgICAgIGNvbnN0IGVudHJ5ID0gdGhpcy5jYWNoZS5nZXRFbnRyeShjb25uZWN0aW9uLmFkZHJlc3MsIGNyZWRlbnRpYWxzLnVzZXJuYW1lLCBjYWxsYmFja0hhc2gpO1xuICAgICAgICBsZXQgcmVzdWx0O1xuICAgICAgICBpZiAoZW50cnkpIHtcbiAgICAgICAgICAgIC8vIFJlYXV0aGVudGljYXRpb24gY2Fubm90IHVzZSBhIHRva2VuIGZyb20gdGhlIGNhY2hlIHNpbmNlIHRoZSBzZXJ2ZXIgaGFzXG4gICAgICAgICAgICAvLyBzdGF0ZWQgaXQgaXMgaW52YWxpZCBieSB0aGUgcmVxdWVzdCBmb3IgcmVhdXRoZW50aWNhdGlvbi5cbiAgICAgICAgICAgIGlmIChlbnRyeS5pc1ZhbGlkKCkgJiYgIXJlYXV0aGVudGljYXRpbmcpIHtcbiAgICAgICAgICAgICAgICAvLyBQcmVzZW5jZSBvZiBhIHZhbGlkIGNhY2hlIGVudHJ5IG1lYW5zIHdlIGNhbiBza2lwIHRvIHRoZSBmaW5pc2hpbmcgc3RlcC5cbiAgICAgICAgICAgICAgICByZXN1bHQgPSBhd2FpdCB0aGlzLmZpbmlzaEF1dGhlbnRpY2F0aW9uKGNvbm5lY3Rpb24sIGNyZWRlbnRpYWxzLCBlbnRyeS50b2tlblJlc3VsdCwgcmVzcG9uc2U/LnNwZWN1bGF0aXZlQXV0aGVudGljYXRlPy5jb252ZXJzYXRpb25JZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBQcmVzZW5jZSBvZiBhbiBleHBpcmVkIGNhY2hlIGVudHJ5IG1lYW5zIHdlIG11c3QgZmV0Y2ggYSBuZXcgb25lIGFuZFxuICAgICAgICAgICAgICAgIC8vIHRoZW4gZXhlY3V0ZSB0aGUgZmluYWwgc3RlcC5cbiAgICAgICAgICAgICAgICBjb25zdCB0b2tlblJlc3VsdCA9IGF3YWl0IHRoaXMuZmV0Y2hBY2Nlc3NUb2tlbihjb25uZWN0aW9uLCBjcmVkZW50aWFscywgZW50cnkuc2VydmVySW5mbywgcmVhdXRoZW50aWNhdGluZywgY2FsbGJhY2tIYXNoLCByZXF1ZXN0Q2FsbGJhY2ssIHJlZnJlc2hDYWxsYmFjayk7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gYXdhaXQgdGhpcy5maW5pc2hBdXRoZW50aWNhdGlvbihjb25uZWN0aW9uLCBjcmVkZW50aWFscywgdG9rZW5SZXN1bHQsIHJlYXV0aGVudGljYXRpbmcgPyB1bmRlZmluZWQgOiByZXNwb25zZT8uc3BlY3VsYXRpdmVBdXRoZW50aWNhdGU/LmNvbnZlcnNhdGlvbklkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIElmIHdlIGFyZSByZWF1dGhlbnRpY2F0aW5nIGFuZCB0aGlzIGVycm9ycyB3aXRoIHJlYXV0aGVudGljYXRpb25cbiAgICAgICAgICAgICAgICAgICAgLy8gcmVxdWlyZWQsIHdlIG5lZWQgdG8gZG8gdGhlIGVudGlyZSBwcm9jZXNzIG92ZXIgYWdhaW4gYW5kIGNsZWFyXG4gICAgICAgICAgICAgICAgICAgIC8vIHRoZSBjYWNoZSBlbnRyeS5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlYXV0aGVudGljYXRpbmcgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yIGluc3RhbmNlb2YgZXJyb3JfMS5Nb25nb0Vycm9yICYmXG4gICAgICAgICAgICAgICAgICAgICAgICBlcnJvci5jb2RlID09PSBlcnJvcl8xLk1PTkdPREJfRVJST1JfQ09ERVMuUmVhdXRoZW50aWNhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2FjaGUuZGVsZXRlRW50cnkoY29ubmVjdGlvbi5hZGRyZXNzLCBjcmVkZW50aWFscy51c2VybmFtZSwgY2FsbGJhY2tIYXNoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IGF3YWl0IHRoaXMuZXhlY3V0ZShjb25uZWN0aW9uLCBjcmVkZW50aWFscywgcmVhdXRoZW50aWNhdGluZyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIC8vIE5vIGVudHJ5IGluIHRoZSBjYWNoZSByZXF1aXJlcyB1cyB0byBkbyBhbGwgYXV0aGVudGljYXRpb24gc3RlcHNcbiAgICAgICAgICAgIC8vIGZyb20gc3RhcnQgdG8gZmluaXNoLCBpbmNsdWRpbmcgZ2V0dGluZyBhIGZyZXNoIHRva2VuIGZvciB0aGUgY2FjaGUuXG4gICAgICAgICAgICBjb25zdCBzdGFydERvY3VtZW50ID0gYXdhaXQgdGhpcy5zdGFydEF1dGhlbnRpY2F0aW9uKGNvbm5lY3Rpb24sIGNyZWRlbnRpYWxzLCByZWF1dGhlbnRpY2F0aW5nLCByZXNwb25zZSk7XG4gICAgICAgICAgICBjb25zdCBjb252ZXJzYXRpb25JZCA9IHN0YXJ0RG9jdW1lbnQuY29udmVyc2F0aW9uSWQ7XG4gICAgICAgICAgICBjb25zdCBzZXJ2ZXJSZXN1bHQgPSBic29uXzEuQlNPTi5kZXNlcmlhbGl6ZShzdGFydERvY3VtZW50LnBheWxvYWQuYnVmZmVyKTtcbiAgICAgICAgICAgIGNvbnN0IHRva2VuUmVzdWx0ID0gYXdhaXQgdGhpcy5mZXRjaEFjY2Vzc1Rva2VuKGNvbm5lY3Rpb24sIGNyZWRlbnRpYWxzLCBzZXJ2ZXJSZXN1bHQsIHJlYXV0aGVudGljYXRpbmcsIGNhbGxiYWNrSGFzaCwgcmVxdWVzdENhbGxiYWNrLCByZWZyZXNoQ2FsbGJhY2spO1xuICAgICAgICAgICAgcmVzdWx0ID0gYXdhaXQgdGhpcy5maW5pc2hBdXRoZW50aWNhdGlvbihjb25uZWN0aW9uLCBjcmVkZW50aWFscywgdG9rZW5SZXN1bHQsIGNvbnZlcnNhdGlvbklkKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTdGFydHMgdGhlIGNhbGxiYWNrIGF1dGhlbnRpY2F0aW9uIHByb2Nlc3MuIElmIHRoZXJlIGlzIGEgc3BlY3VsYXRpdmVcbiAgICAgKiBhdXRoZW50aWNhdGlvbiBkb2N1bWVudCBmcm9tIHRoZSBpbml0aWFsIGhhbmRzaGFrZSwgdGhlbiB3ZSB3aWxsIHVzZSB0aGF0XG4gICAgICogdmFsdWUgdG8gZ2V0IHRoZSBpc3N1ZXIsIG90aGVyd2lzZSB3ZSB3aWxsIHNlbmQgdGhlIHNhc2xTdGFydCBjb21tYW5kLlxuICAgICAqL1xuICAgIGFzeW5jIHN0YXJ0QXV0aGVudGljYXRpb24oY29ubmVjdGlvbiwgY3JlZGVudGlhbHMsIHJlYXV0aGVudGljYXRpbmcsIHJlc3BvbnNlKSB7XG4gICAgICAgIGxldCByZXN1bHQ7XG4gICAgICAgIGlmICghcmVhdXRoZW50aWNhdGluZyAmJiByZXNwb25zZT8uc3BlY3VsYXRpdmVBdXRoZW50aWNhdGUpIHtcbiAgICAgICAgICAgIHJlc3VsdCA9IHJlc3BvbnNlLnNwZWN1bGF0aXZlQXV0aGVudGljYXRlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmVzdWx0ID0gYXdhaXQgY29ubmVjdGlvbi5jb21tYW5kQXN5bmMoKDAsIHV0aWxzXzEubnMpKGNyZWRlbnRpYWxzLnNvdXJjZSksIHN0YXJ0Q29tbWFuZERvY3VtZW50KGNyZWRlbnRpYWxzKSwgdW5kZWZpbmVkKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBGaW5pc2hlcyB0aGUgY2FsbGJhY2sgYXV0aGVudGljYXRpb24gcHJvY2Vzcy5cbiAgICAgKi9cbiAgICBhc3luYyBmaW5pc2hBdXRoZW50aWNhdGlvbihjb25uZWN0aW9uLCBjcmVkZW50aWFscywgdG9rZW5SZXN1bHQsIGNvbnZlcnNhdGlvbklkKSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbm5lY3Rpb24uY29tbWFuZEFzeW5jKCgwLCB1dGlsc18xLm5zKShjcmVkZW50aWFscy5zb3VyY2UpLCBmaW5pc2hDb21tYW5kRG9jdW1lbnQodG9rZW5SZXN1bHQuYWNjZXNzVG9rZW4sIGNvbnZlcnNhdGlvbklkKSwgdW5kZWZpbmVkKTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRmV0Y2hlcyBhbiBhY2Nlc3MgdG9rZW4gdXNpbmcgZWl0aGVyIHRoZSByZXF1ZXN0IG9yIHJlZnJlc2ggY2FsbGJhY2tzIGFuZFxuICAgICAqIHB1dHMgaXQgaW4gdGhlIGNhY2hlLlxuICAgICAqL1xuICAgIGFzeW5jIGZldGNoQWNjZXNzVG9rZW4oY29ubmVjdGlvbiwgY3JlZGVudGlhbHMsIHNlcnZlckluZm8sIHJlYXV0aGVudGljYXRpbmcsIGNhbGxiYWNrSGFzaCwgcmVxdWVzdENhbGxiYWNrLCByZWZyZXNoQ2FsbGJhY2spIHtcbiAgICAgICAgLy8gR2V0IHRoZSB0b2tlbiBmcm9tIHRoZSBjYWNoZS5cbiAgICAgICAgY29uc3QgZW50cnkgPSB0aGlzLmNhY2hlLmdldEVudHJ5KGNvbm5lY3Rpb24uYWRkcmVzcywgY3JlZGVudGlhbHMudXNlcm5hbWUsIGNhbGxiYWNrSGFzaCk7XG4gICAgICAgIGxldCByZXN1bHQ7XG4gICAgICAgIGNvbnN0IGNvbnRleHQgPSB7IHRpbWVvdXRTZWNvbmRzOiBUSU1FT1VUX1MsIHZlcnNpb246IE9JRENfVkVSU0lPTiB9O1xuICAgICAgICAvLyBDaGVjayBpZiB0aGVyZSdzIGEgdG9rZW4gaW4gdGhlIGNhY2hlLlxuICAgICAgICBpZiAoZW50cnkpIHtcbiAgICAgICAgICAgIC8vIElmIHRoZSBjYWNoZSBlbnRyeSBpcyB2YWxpZCwgcmV0dXJuIHRoZSB0b2tlbiByZXN1bHQuXG4gICAgICAgICAgICBpZiAoZW50cnkuaXNWYWxpZCgpICYmICFyZWF1dGhlbnRpY2F0aW5nKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGVudHJ5LnRva2VuUmVzdWx0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gSWYgdGhlIGNhY2hlIGVudHJ5IGlzIG5vdCB2YWxpZCwgcmVtb3ZlIGl0IGZyb20gdGhlIGNhY2hlIGFuZCBmaXJzdCBhdHRlbXB0XG4gICAgICAgICAgICAvLyB0byB1c2UgdGhlIHJlZnJlc2ggY2FsbGJhY2sgdG8gZ2V0IGEgbmV3IHRva2VuLiBJZiBubyByZWZyZXNoIGNhbGxiYWNrXG4gICAgICAgICAgICAvLyBleGlzdHMsIHRoZW4gZmFsbGJhY2sgdG8gdGhlIHJlcXVlc3QgY2FsbGJhY2suXG4gICAgICAgICAgICBpZiAocmVmcmVzaENhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgY29udGV4dC5yZWZyZXNoVG9rZW4gPSBlbnRyeS50b2tlblJlc3VsdC5yZWZyZXNoVG9rZW47XG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gYXdhaXQgcmVmcmVzaENhbGxiYWNrKHNlcnZlckluZm8sIGNvbnRleHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gYXdhaXQgcmVxdWVzdENhbGxiYWNrKHNlcnZlckluZm8sIGNvbnRleHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgLy8gV2l0aCBubyB0b2tlbiBpbiB0aGUgY2FjaGUgd2UgdXNlIHRoZSByZXF1ZXN0IGNhbGxiYWNrLlxuICAgICAgICAgICAgcmVzdWx0ID0gYXdhaXQgcmVxdWVzdENhbGxiYWNrKHNlcnZlckluZm8sIGNvbnRleHQpO1xuICAgICAgICB9XG4gICAgICAgIC8vIFZhbGlkYXRlIHRoYXQgdGhlIHJlc3VsdCByZXR1cm5lZCBieSB0aGUgY2FsbGJhY2sgaXMgYWNjZXB0YWJsZS4gSWYgaXQgaXMgbm90XG4gICAgICAgIC8vIHdlIG11c3QgY2xlYXIgdGhlIHRva2VuIHJlc3VsdCBmcm9tIHRoZSBjYWNoZS5cbiAgICAgICAgaWYgKGlzQ2FsbGJhY2tSZXN1bHRJbnZhbGlkKHJlc3VsdCkpIHtcbiAgICAgICAgICAgIHRoaXMuY2FjaGUuZGVsZXRlRW50cnkoY29ubmVjdGlvbi5hZGRyZXNzLCBjcmVkZW50aWFscy51c2VybmFtZSwgY2FsbGJhY2tIYXNoKTtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvTWlzc2luZ0NyZWRlbnRpYWxzRXJyb3IoQ0FMTEJBQ0tfUkVTVUxUX0VSUk9SKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBDbGVhbnVwIHRoZSBjYWNoZS5cbiAgICAgICAgdGhpcy5jYWNoZS5kZWxldGVFeHBpcmVkRW50cmllcygpO1xuICAgICAgICAvLyBQdXQgdGhlIG5ldyBlbnRyeSBpbnRvIHRoZSBjYWNoZS5cbiAgICAgICAgdGhpcy5jYWNoZS5hZGRFbnRyeShjb25uZWN0aW9uLmFkZHJlc3MsIGNyZWRlbnRpYWxzLnVzZXJuYW1lIHx8ICcnLCBjYWxsYmFja0hhc2gsIHJlc3VsdCwgc2VydmVySW5mbyk7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxufVxuZXhwb3J0cy5DYWxsYmFja1dvcmtmbG93ID0gQ2FsbGJhY2tXb3JrZmxvdztcbi8qKlxuICogR2VuZXJhdGUgdGhlIGZpbmlzaGluZyBjb21tYW5kIGRvY3VtZW50IGZvciBhdXRoZW50aWNhdGlvbi4gV2lsbCBiZSBhXG4gKiBzYXNsU3RhcnQgb3Igc2FzbENvbnRpbnVlIGRlcGVuZGluZyBvbiB0aGUgcHJlc2VuY2Ugb2YgYSBjb252ZXJzYXRpb24gaWQuXG4gKi9cbmZ1bmN0aW9uIGZpbmlzaENvbW1hbmREb2N1bWVudCh0b2tlbiwgY29udmVyc2F0aW9uSWQpIHtcbiAgICBpZiAoY29udmVyc2F0aW9uSWQgIT0gbnVsbCAmJiB0eXBlb2YgY29udmVyc2F0aW9uSWQgPT09ICdudW1iZXInKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzYXNsQ29udGludWU6IDEsXG4gICAgICAgICAgICBjb252ZXJzYXRpb25JZDogY29udmVyc2F0aW9uSWQsXG4gICAgICAgICAgICBwYXlsb2FkOiBuZXcgYnNvbl8xLkJpbmFyeShic29uXzEuQlNPTi5zZXJpYWxpemUoeyBqd3Q6IHRva2VuIH0pKVxuICAgICAgICB9O1xuICAgIH1cbiAgICAvLyBzYXNsQ29udGludWUgcmVxdWlyZXMgYSBjb252ZXJzYXRpb25JZCBpbiB0aGUgY29tbWFuZCB0byBiZSB2YWxpZCBzbyBpbiB0aGlzXG4gICAgLy8gY2FzZSB0aGUgc2VydmVyIGFsbG93cyBcInN0ZXAgdHdvXCIgdG8gYWN0dWFsbHkgYmUgYSBzYXNsU3RhcnQgd2l0aCB0aGUgdG9rZW5cbiAgICAvLyBhcyB0aGUgand0IHNpbmNlIHRoZSB1c2Ugb2YgdGhlIGNhY2hlZCB2YWx1ZSBoYXMgbm8gY29ycmVsYXRpbmcgY29udmVyc2F0aW5nXG4gICAgLy8gb24gdGhlIHBhcnRpY3VsYXIgY29ubmVjdGlvbi5cbiAgICByZXR1cm4ge1xuICAgICAgICBzYXNsU3RhcnQ6IDEsXG4gICAgICAgIG1lY2hhbmlzbTogcHJvdmlkZXJzXzEuQXV0aE1lY2hhbmlzbS5NT05HT0RCX09JREMsXG4gICAgICAgIHBheWxvYWQ6IG5ldyBic29uXzEuQmluYXJ5KGJzb25fMS5CU09OLnNlcmlhbGl6ZSh7IGp3dDogdG9rZW4gfSkpXG4gICAgfTtcbn1cbi8qKlxuICogRGV0ZXJtaW5lcyBpZiBhIHJlc3VsdCByZXR1cm5lZCBmcm9tIGEgcmVxdWVzdCBvciByZWZyZXNoIGNhbGxiYWNrXG4gKiBmdW5jdGlvbiBpcyBpbnZhbGlkLiBUaGlzIG1lYW5zIHRoZSByZXN1bHQgaXMgbnVsbGlzaCwgZG9lc24ndCBjb250YWluXG4gKiB0aGUgYWNjZXNzVG9rZW4gcmVxdWlyZWQgZmllbGQsIGFuZCBkb2VzIG5vdCBjb250YWluIGV4dHJhIGZpZWxkcy5cbiAqL1xuZnVuY3Rpb24gaXNDYWxsYmFja1Jlc3VsdEludmFsaWQodG9rZW5SZXN1bHQpIHtcbiAgICBpZiAodG9rZW5SZXN1bHQgPT0gbnVsbCB8fCB0eXBlb2YgdG9rZW5SZXN1bHQgIT09ICdvYmplY3QnKVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICBpZiAoISgnYWNjZXNzVG9rZW4nIGluIHRva2VuUmVzdWx0KSlcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgcmV0dXJuICFPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyh0b2tlblJlc3VsdCkuZXZlcnkocHJvcCA9PiBSRVNVTFRfUFJPUEVSVElFUy5pbmNsdWRlcyhwcm9wKSk7XG59XG4vKipcbiAqIEdlbmVyYXRlIHRoZSBzYXNsU3RhcnQgY29tbWFuZCBkb2N1bWVudC5cbiAqL1xuZnVuY3Rpb24gc3RhcnRDb21tYW5kRG9jdW1lbnQoY3JlZGVudGlhbHMpIHtcbiAgICBjb25zdCBwYXlsb2FkID0ge307XG4gICAgaWYgKGNyZWRlbnRpYWxzLnVzZXJuYW1lKSB7XG4gICAgICAgIHBheWxvYWQubiA9IGNyZWRlbnRpYWxzLnVzZXJuYW1lO1xuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgICBzYXNsU3RhcnQ6IDEsXG4gICAgICAgIGF1dG9BdXRob3JpemU6IDEsXG4gICAgICAgIG1lY2hhbmlzbTogcHJvdmlkZXJzXzEuQXV0aE1lY2hhbmlzbS5NT05HT0RCX09JREMsXG4gICAgICAgIHBheWxvYWQ6IG5ldyBic29uXzEuQmluYXJ5KGJzb25fMS5CU09OLnNlcmlhbGl6ZShwYXlsb2FkKSlcbiAgICB9O1xufVxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y2FsbGJhY2tfd29ya2Zsb3cuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/callback_workflow.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/service_workflow.js":
/*!*************************************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/service_workflow.js ***!
  \*************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.commandDocument = exports.ServiceWorkflow = void 0;\nconst bson_1 = __webpack_require__(/*! bson */ \"(api)/../server/node_modules/bson/lib/bson.cjs\");\nconst utils_1 = __webpack_require__(/*! ../../../utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\nconst providers_1 = __webpack_require__(/*! ../providers */ \"(api)/../server/node_modules/mongodb/lib/cmap/auth/providers.js\");\n/**\n * Common behaviour for OIDC device workflows.\n * @internal\n */\nclass ServiceWorkflow {\n    /**\n     * Execute the workflow. Looks for AWS_WEB_IDENTITY_TOKEN_FILE in the environment\n     * and then attempts to read the token from that path.\n     */\n    async execute(connection, credentials) {\n        const token = await this.getToken(credentials);\n        const command = commandDocument(token);\n        return connection.commandAsync((0, utils_1.ns)(credentials.source), command, undefined);\n    }\n    /**\n     * Get the document to add for speculative authentication.\n     */\n    async speculativeAuth(credentials) {\n        const token = await this.getToken(credentials);\n        const document = commandDocument(token);\n        document.db = credentials.source;\n        return { speculativeAuthenticate: document };\n    }\n}\nexports.ServiceWorkflow = ServiceWorkflow;\n/**\n * Create the saslStart command document.\n */\nfunction commandDocument(token) {\n    return {\n        saslStart: 1,\n        mechanism: providers_1.AuthMechanism.MONGODB_OIDC,\n        payload: bson_1.BSON.serialize({ jwt: token })\n    };\n}\nexports.commandDocument = commandDocument;\n//# sourceMappingURL=service_workflow.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jbWFwL2F1dGgvbW9uZ29kYl9vaWRjL3NlcnZpY2Vfd29ya2Zsb3cuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsdUJBQXVCLEdBQUcsdUJBQXVCO0FBQ2pELGVBQWUsbUJBQU8sQ0FBQyw0REFBTTtBQUM3QixnQkFBZ0IsbUJBQU8sQ0FBQyx5RUFBZ0I7QUFDeEMsb0JBQW9CLG1CQUFPLENBQUMscUZBQWM7QUFDMUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSx1QkFBdUI7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5Q0FBeUMsWUFBWTtBQUNyRDtBQUNBO0FBQ0EsdUJBQXVCO0FBQ3ZCIiwic291cmNlcyI6WyJEOlxcc2Fsb25pXFxhcHByYWlzYWwtc3lzdGVtXFxzZXJ2ZXJcXG5vZGVfbW9kdWxlc1xcbW9uZ29kYlxcbGliXFxjbWFwXFxhdXRoXFxtb25nb2RiX29pZGNcXHNlcnZpY2Vfd29ya2Zsb3cuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmNvbW1hbmREb2N1bWVudCA9IGV4cG9ydHMuU2VydmljZVdvcmtmbG93ID0gdm9pZCAwO1xuY29uc3QgYnNvbl8xID0gcmVxdWlyZShcImJzb25cIik7XG5jb25zdCB1dGlsc18xID0gcmVxdWlyZShcIi4uLy4uLy4uL3V0aWxzXCIpO1xuY29uc3QgcHJvdmlkZXJzXzEgPSByZXF1aXJlKFwiLi4vcHJvdmlkZXJzXCIpO1xuLyoqXG4gKiBDb21tb24gYmVoYXZpb3VyIGZvciBPSURDIGRldmljZSB3b3JrZmxvd3MuXG4gKiBAaW50ZXJuYWxcbiAqL1xuY2xhc3MgU2VydmljZVdvcmtmbG93IHtcbiAgICAvKipcbiAgICAgKiBFeGVjdXRlIHRoZSB3b3JrZmxvdy4gTG9va3MgZm9yIEFXU19XRUJfSURFTlRJVFlfVE9LRU5fRklMRSBpbiB0aGUgZW52aXJvbm1lbnRcbiAgICAgKiBhbmQgdGhlbiBhdHRlbXB0cyB0byByZWFkIHRoZSB0b2tlbiBmcm9tIHRoYXQgcGF0aC5cbiAgICAgKi9cbiAgICBhc3luYyBleGVjdXRlKGNvbm5lY3Rpb24sIGNyZWRlbnRpYWxzKSB7XG4gICAgICAgIGNvbnN0IHRva2VuID0gYXdhaXQgdGhpcy5nZXRUb2tlbihjcmVkZW50aWFscyk7XG4gICAgICAgIGNvbnN0IGNvbW1hbmQgPSBjb21tYW5kRG9jdW1lbnQodG9rZW4pO1xuICAgICAgICByZXR1cm4gY29ubmVjdGlvbi5jb21tYW5kQXN5bmMoKDAsIHV0aWxzXzEubnMpKGNyZWRlbnRpYWxzLnNvdXJjZSksIGNvbW1hbmQsIHVuZGVmaW5lZCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEdldCB0aGUgZG9jdW1lbnQgdG8gYWRkIGZvciBzcGVjdWxhdGl2ZSBhdXRoZW50aWNhdGlvbi5cbiAgICAgKi9cbiAgICBhc3luYyBzcGVjdWxhdGl2ZUF1dGgoY3JlZGVudGlhbHMpIHtcbiAgICAgICAgY29uc3QgdG9rZW4gPSBhd2FpdCB0aGlzLmdldFRva2VuKGNyZWRlbnRpYWxzKTtcbiAgICAgICAgY29uc3QgZG9jdW1lbnQgPSBjb21tYW5kRG9jdW1lbnQodG9rZW4pO1xuICAgICAgICBkb2N1bWVudC5kYiA9IGNyZWRlbnRpYWxzLnNvdXJjZTtcbiAgICAgICAgcmV0dXJuIHsgc3BlY3VsYXRpdmVBdXRoZW50aWNhdGU6IGRvY3VtZW50IH07XG4gICAgfVxufVxuZXhwb3J0cy5TZXJ2aWNlV29ya2Zsb3cgPSBTZXJ2aWNlV29ya2Zsb3c7XG4vKipcbiAqIENyZWF0ZSB0aGUgc2FzbFN0YXJ0IGNvbW1hbmQgZG9jdW1lbnQuXG4gKi9cbmZ1bmN0aW9uIGNvbW1hbmREb2N1bWVudCh0b2tlbikge1xuICAgIHJldHVybiB7XG4gICAgICAgIHNhc2xTdGFydDogMSxcbiAgICAgICAgbWVjaGFuaXNtOiBwcm92aWRlcnNfMS5BdXRoTWVjaGFuaXNtLk1PTkdPREJfT0lEQyxcbiAgICAgICAgcGF5bG9hZDogYnNvbl8xLkJTT04uc2VyaWFsaXplKHsgand0OiB0b2tlbiB9KVxuICAgIH07XG59XG5leHBvcnRzLmNvbW1hbmREb2N1bWVudCA9IGNvbW1hbmREb2N1bWVudDtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXNlcnZpY2Vfd29ya2Zsb3cuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/service_workflow.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/token_entry_cache.js":
/*!**************************************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/token_entry_cache.js ***!
  \**************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.TokenEntryCache = exports.TokenEntry = void 0;\nconst cache_1 = __webpack_require__(/*! ./cache */ \"(api)/../server/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/cache.js\");\n/* Default expiration is now for when no expiration provided */\nconst DEFAULT_EXPIRATION_SECS = 0;\n/** @internal */\nclass TokenEntry extends cache_1.ExpiringCacheEntry {\n    /**\n     * Instantiate the entry.\n     */\n    constructor(tokenResult, serverInfo, expiration) {\n        super(expiration);\n        this.tokenResult = tokenResult;\n        this.serverInfo = serverInfo;\n    }\n}\nexports.TokenEntry = TokenEntry;\n/**\n * Cache of OIDC token entries.\n * @internal\n */\nclass TokenEntryCache extends cache_1.Cache {\n    /**\n     * Set an entry in the token cache.\n     */\n    addEntry(address, username, callbackHash, tokenResult, serverInfo) {\n        const entry = new TokenEntry(tokenResult, serverInfo, tokenResult.expiresInSeconds ?? DEFAULT_EXPIRATION_SECS);\n        this.entries.set(this.cacheKey(address, username, callbackHash), entry);\n        return entry;\n    }\n    /**\n     * Delete an entry from the cache.\n     */\n    deleteEntry(address, username, callbackHash) {\n        this.entries.delete(this.cacheKey(address, username, callbackHash));\n    }\n    /**\n     * Get an entry from the cache.\n     */\n    getEntry(address, username, callbackHash) {\n        return this.entries.get(this.cacheKey(address, username, callbackHash));\n    }\n    /**\n     * Delete all expired entries from the cache.\n     */\n    deleteExpiredEntries() {\n        for (const [key, entry] of this.entries) {\n            if (!entry.isValid()) {\n                this.entries.delete(key);\n            }\n        }\n    }\n    /**\n     * Create a cache key from the address and username.\n     */\n    cacheKey(address, username, callbackHash) {\n        return this.hashedCacheKey(address, username, callbackHash);\n    }\n}\nexports.TokenEntryCache = TokenEntryCache;\n//# sourceMappingURL=token_entry_cache.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jbWFwL2F1dGgvbW9uZ29kYl9vaWRjL3Rva2VuX2VudHJ5X2NhY2hlLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELHVCQUF1QixHQUFHLGtCQUFrQjtBQUM1QyxnQkFBZ0IsbUJBQU8sQ0FBQyx5RkFBUztBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQjtBQUNsQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUI7QUFDdkIiLCJzb3VyY2VzIjpbIkQ6XFxzYWxvbmlcXGFwcHJhaXNhbC1zeXN0ZW1cXHNlcnZlclxcbm9kZV9tb2R1bGVzXFxtb25nb2RiXFxsaWJcXGNtYXBcXGF1dGhcXG1vbmdvZGJfb2lkY1xcdG9rZW5fZW50cnlfY2FjaGUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLlRva2VuRW50cnlDYWNoZSA9IGV4cG9ydHMuVG9rZW5FbnRyeSA9IHZvaWQgMDtcbmNvbnN0IGNhY2hlXzEgPSByZXF1aXJlKFwiLi9jYWNoZVwiKTtcbi8qIERlZmF1bHQgZXhwaXJhdGlvbiBpcyBub3cgZm9yIHdoZW4gbm8gZXhwaXJhdGlvbiBwcm92aWRlZCAqL1xuY29uc3QgREVGQVVMVF9FWFBJUkFUSU9OX1NFQ1MgPSAwO1xuLyoqIEBpbnRlcm5hbCAqL1xuY2xhc3MgVG9rZW5FbnRyeSBleHRlbmRzIGNhY2hlXzEuRXhwaXJpbmdDYWNoZUVudHJ5IHtcbiAgICAvKipcbiAgICAgKiBJbnN0YW50aWF0ZSB0aGUgZW50cnkuXG4gICAgICovXG4gICAgY29uc3RydWN0b3IodG9rZW5SZXN1bHQsIHNlcnZlckluZm8sIGV4cGlyYXRpb24pIHtcbiAgICAgICAgc3VwZXIoZXhwaXJhdGlvbik7XG4gICAgICAgIHRoaXMudG9rZW5SZXN1bHQgPSB0b2tlblJlc3VsdDtcbiAgICAgICAgdGhpcy5zZXJ2ZXJJbmZvID0gc2VydmVySW5mbztcbiAgICB9XG59XG5leHBvcnRzLlRva2VuRW50cnkgPSBUb2tlbkVudHJ5O1xuLyoqXG4gKiBDYWNoZSBvZiBPSURDIHRva2VuIGVudHJpZXMuXG4gKiBAaW50ZXJuYWxcbiAqL1xuY2xhc3MgVG9rZW5FbnRyeUNhY2hlIGV4dGVuZHMgY2FjaGVfMS5DYWNoZSB7XG4gICAgLyoqXG4gICAgICogU2V0IGFuIGVudHJ5IGluIHRoZSB0b2tlbiBjYWNoZS5cbiAgICAgKi9cbiAgICBhZGRFbnRyeShhZGRyZXNzLCB1c2VybmFtZSwgY2FsbGJhY2tIYXNoLCB0b2tlblJlc3VsdCwgc2VydmVySW5mbykge1xuICAgICAgICBjb25zdCBlbnRyeSA9IG5ldyBUb2tlbkVudHJ5KHRva2VuUmVzdWx0LCBzZXJ2ZXJJbmZvLCB0b2tlblJlc3VsdC5leHBpcmVzSW5TZWNvbmRzID8/IERFRkFVTFRfRVhQSVJBVElPTl9TRUNTKTtcbiAgICAgICAgdGhpcy5lbnRyaWVzLnNldCh0aGlzLmNhY2hlS2V5KGFkZHJlc3MsIHVzZXJuYW1lLCBjYWxsYmFja0hhc2gpLCBlbnRyeSk7XG4gICAgICAgIHJldHVybiBlbnRyeTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRGVsZXRlIGFuIGVudHJ5IGZyb20gdGhlIGNhY2hlLlxuICAgICAqL1xuICAgIGRlbGV0ZUVudHJ5KGFkZHJlc3MsIHVzZXJuYW1lLCBjYWxsYmFja0hhc2gpIHtcbiAgICAgICAgdGhpcy5lbnRyaWVzLmRlbGV0ZSh0aGlzLmNhY2hlS2V5KGFkZHJlc3MsIHVzZXJuYW1lLCBjYWxsYmFja0hhc2gpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogR2V0IGFuIGVudHJ5IGZyb20gdGhlIGNhY2hlLlxuICAgICAqL1xuICAgIGdldEVudHJ5KGFkZHJlc3MsIHVzZXJuYW1lLCBjYWxsYmFja0hhc2gpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZW50cmllcy5nZXQodGhpcy5jYWNoZUtleShhZGRyZXNzLCB1c2VybmFtZSwgY2FsbGJhY2tIYXNoKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIERlbGV0ZSBhbGwgZXhwaXJlZCBlbnRyaWVzIGZyb20gdGhlIGNhY2hlLlxuICAgICAqL1xuICAgIGRlbGV0ZUV4cGlyZWRFbnRyaWVzKCkge1xuICAgICAgICBmb3IgKGNvbnN0IFtrZXksIGVudHJ5XSBvZiB0aGlzLmVudHJpZXMpIHtcbiAgICAgICAgICAgIGlmICghZW50cnkuaXNWYWxpZCgpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lbnRyaWVzLmRlbGV0ZShrZXkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIGNhY2hlIGtleSBmcm9tIHRoZSBhZGRyZXNzIGFuZCB1c2VybmFtZS5cbiAgICAgKi9cbiAgICBjYWNoZUtleShhZGRyZXNzLCB1c2VybmFtZSwgY2FsbGJhY2tIYXNoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmhhc2hlZENhY2hlS2V5KGFkZHJlc3MsIHVzZXJuYW1lLCBjYWxsYmFja0hhc2gpO1xuICAgIH1cbn1cbmV4cG9ydHMuVG9rZW5FbnRyeUNhY2hlID0gVG9rZW5FbnRyeUNhY2hlO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9dG9rZW5fZW50cnlfY2FjaGUuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/token_entry_cache.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/cmap/auth/plain.js":
/*!*************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/cmap/auth/plain.js ***!
  \*************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.Plain = void 0;\nconst bson_1 = __webpack_require__(/*! ../../bson */ \"(api)/../server/node_modules/mongodb/lib/bson.js\");\nconst error_1 = __webpack_require__(/*! ../../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst utils_1 = __webpack_require__(/*! ../../utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\nconst auth_provider_1 = __webpack_require__(/*! ./auth_provider */ \"(api)/../server/node_modules/mongodb/lib/cmap/auth/auth_provider.js\");\nclass Plain extends auth_provider_1.AuthProvider {\n    async auth(authContext) {\n        const { connection, credentials } = authContext;\n        if (!credentials) {\n            throw new error_1.MongoMissingCredentialsError('AuthContext must provide credentials.');\n        }\n        const { username, password } = credentials;\n        const payload = new bson_1.Binary(Buffer.from(`\\x00${username}\\x00${password}`));\n        const command = {\n            saslStart: 1,\n            mechanism: 'PLAIN',\n            payload: payload,\n            autoAuthorize: 1\n        };\n        await connection.commandAsync((0, utils_1.ns)('$external.$cmd'), command, undefined);\n    }\n}\nexports.Plain = Plain;\n//# sourceMappingURL=plain.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jbWFwL2F1dGgvcGxhaW4uanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsYUFBYTtBQUNiLGVBQWUsbUJBQU8sQ0FBQyxvRUFBWTtBQUNuQyxnQkFBZ0IsbUJBQU8sQ0FBQyxzRUFBYTtBQUNyQyxnQkFBZ0IsbUJBQU8sQ0FBQyxzRUFBYTtBQUNyQyx3QkFBd0IsbUJBQU8sQ0FBQyw0RkFBaUI7QUFDakQ7QUFDQTtBQUNBLGdCQUFnQiwwQkFBMEI7QUFDMUM7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLHFCQUFxQjtBQUNyQyw2REFBNkQsU0FBUyxNQUFNLFNBQVM7QUFDckY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiIiwic291cmNlcyI6WyJEOlxcc2Fsb25pXFxhcHByYWlzYWwtc3lzdGVtXFxzZXJ2ZXJcXG5vZGVfbW9kdWxlc1xcbW9uZ29kYlxcbGliXFxjbWFwXFxhdXRoXFxwbGFpbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuUGxhaW4gPSB2b2lkIDA7XG5jb25zdCBic29uXzEgPSByZXF1aXJlKFwiLi4vLi4vYnNvblwiKTtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi4vLi4vZXJyb3JcIik7XG5jb25zdCB1dGlsc18xID0gcmVxdWlyZShcIi4uLy4uL3V0aWxzXCIpO1xuY29uc3QgYXV0aF9wcm92aWRlcl8xID0gcmVxdWlyZShcIi4vYXV0aF9wcm92aWRlclwiKTtcbmNsYXNzIFBsYWluIGV4dGVuZHMgYXV0aF9wcm92aWRlcl8xLkF1dGhQcm92aWRlciB7XG4gICAgYXN5bmMgYXV0aChhdXRoQ29udGV4dCkge1xuICAgICAgICBjb25zdCB7IGNvbm5lY3Rpb24sIGNyZWRlbnRpYWxzIH0gPSBhdXRoQ29udGV4dDtcbiAgICAgICAgaWYgKCFjcmVkZW50aWFscykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29NaXNzaW5nQ3JlZGVudGlhbHNFcnJvcignQXV0aENvbnRleHQgbXVzdCBwcm92aWRlIGNyZWRlbnRpYWxzLicpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHsgdXNlcm5hbWUsIHBhc3N3b3JkIH0gPSBjcmVkZW50aWFscztcbiAgICAgICAgY29uc3QgcGF5bG9hZCA9IG5ldyBic29uXzEuQmluYXJ5KEJ1ZmZlci5mcm9tKGBcXHgwMCR7dXNlcm5hbWV9XFx4MDAke3Bhc3N3b3JkfWApKTtcbiAgICAgICAgY29uc3QgY29tbWFuZCA9IHtcbiAgICAgICAgICAgIHNhc2xTdGFydDogMSxcbiAgICAgICAgICAgIG1lY2hhbmlzbTogJ1BMQUlOJyxcbiAgICAgICAgICAgIHBheWxvYWQ6IHBheWxvYWQsXG4gICAgICAgICAgICBhdXRvQXV0aG9yaXplOiAxXG4gICAgICAgIH07XG4gICAgICAgIGF3YWl0IGNvbm5lY3Rpb24uY29tbWFuZEFzeW5jKCgwLCB1dGlsc18xLm5zKSgnJGV4dGVybmFsLiRjbWQnKSwgY29tbWFuZCwgdW5kZWZpbmVkKTtcbiAgICB9XG59XG5leHBvcnRzLlBsYWluID0gUGxhaW47XG4vLyMgc291cmNlTWFwcGluZ1VSTD1wbGFpbi5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/cmap/auth/plain.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/cmap/auth/providers.js":
/*!*****************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/cmap/auth/providers.js ***!
  \*****************************************************************/
/***/ ((__unused_webpack_module, exports) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.AUTH_MECHS_AUTH_SRC_EXTERNAL = exports.AuthMechanism = void 0;\n/** @public */\nexports.AuthMechanism = Object.freeze({\n    MONGODB_AWS: 'MONGODB-AWS',\n    MONGODB_CR: 'MONGODB-CR',\n    MONGODB_DEFAULT: 'DEFAULT',\n    MONGODB_GSSAPI: 'GSSAPI',\n    MONGODB_PLAIN: 'PLAIN',\n    MONGODB_SCRAM_SHA1: 'SCRAM-SHA-1',\n    MONGODB_SCRAM_SHA256: 'SCRAM-SHA-256',\n    MONGODB_X509: 'MONGODB-X509',\n    /** @experimental */\n    MONGODB_OIDC: 'MONGODB-OIDC'\n});\n/** @internal */\nexports.AUTH_MECHS_AUTH_SRC_EXTERNAL = new Set([\n    exports.AuthMechanism.MONGODB_GSSAPI,\n    exports.AuthMechanism.MONGODB_AWS,\n    exports.AuthMechanism.MONGODB_OIDC,\n    exports.AuthMechanism.MONGODB_X509\n]);\n//# sourceMappingURL=providers.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jbWFwL2F1dGgvcHJvdmlkZXJzLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELG9DQUFvQyxHQUFHLHFCQUFxQjtBQUM1RDtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBLG9DQUFvQztBQUNwQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIkQ6XFxzYWxvbmlcXGFwcHJhaXNhbC1zeXN0ZW1cXHNlcnZlclxcbm9kZV9tb2R1bGVzXFxtb25nb2RiXFxsaWJcXGNtYXBcXGF1dGhcXHByb3ZpZGVycy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuQVVUSF9NRUNIU19BVVRIX1NSQ19FWFRFUk5BTCA9IGV4cG9ydHMuQXV0aE1lY2hhbmlzbSA9IHZvaWQgMDtcbi8qKiBAcHVibGljICovXG5leHBvcnRzLkF1dGhNZWNoYW5pc20gPSBPYmplY3QuZnJlZXplKHtcbiAgICBNT05HT0RCX0FXUzogJ01PTkdPREItQVdTJyxcbiAgICBNT05HT0RCX0NSOiAnTU9OR09EQi1DUicsXG4gICAgTU9OR09EQl9ERUZBVUxUOiAnREVGQVVMVCcsXG4gICAgTU9OR09EQl9HU1NBUEk6ICdHU1NBUEknLFxuICAgIE1PTkdPREJfUExBSU46ICdQTEFJTicsXG4gICAgTU9OR09EQl9TQ1JBTV9TSEExOiAnU0NSQU0tU0hBLTEnLFxuICAgIE1PTkdPREJfU0NSQU1fU0hBMjU2OiAnU0NSQU0tU0hBLTI1NicsXG4gICAgTU9OR09EQl9YNTA5OiAnTU9OR09EQi1YNTA5JyxcbiAgICAvKiogQGV4cGVyaW1lbnRhbCAqL1xuICAgIE1PTkdPREJfT0lEQzogJ01PTkdPREItT0lEQydcbn0pO1xuLyoqIEBpbnRlcm5hbCAqL1xuZXhwb3J0cy5BVVRIX01FQ0hTX0FVVEhfU1JDX0VYVEVSTkFMID0gbmV3IFNldChbXG4gICAgZXhwb3J0cy5BdXRoTWVjaGFuaXNtLk1PTkdPREJfR1NTQVBJLFxuICAgIGV4cG9ydHMuQXV0aE1lY2hhbmlzbS5NT05HT0RCX0FXUyxcbiAgICBleHBvcnRzLkF1dGhNZWNoYW5pc20uTU9OR09EQl9PSURDLFxuICAgIGV4cG9ydHMuQXV0aE1lY2hhbmlzbS5NT05HT0RCX1g1MDlcbl0pO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cHJvdmlkZXJzLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/cmap/auth/providers.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/cmap/auth/scram.js":
/*!*************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/cmap/auth/scram.js ***!
  \*************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.ScramSHA256 = exports.ScramSHA1 = void 0;\nconst crypto = __webpack_require__(/*! crypto */ \"crypto\");\nconst util_1 = __webpack_require__(/*! util */ \"util\");\nconst bson_1 = __webpack_require__(/*! ../../bson */ \"(api)/../server/node_modules/mongodb/lib/bson.js\");\nconst deps_1 = __webpack_require__(/*! ../../deps */ \"(api)/../server/node_modules/mongodb/lib/deps.js\");\nconst error_1 = __webpack_require__(/*! ../../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst utils_1 = __webpack_require__(/*! ../../utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\nconst auth_provider_1 = __webpack_require__(/*! ./auth_provider */ \"(api)/../server/node_modules/mongodb/lib/cmap/auth/auth_provider.js\");\nconst providers_1 = __webpack_require__(/*! ./providers */ \"(api)/../server/node_modules/mongodb/lib/cmap/auth/providers.js\");\nclass ScramSHA extends auth_provider_1.AuthProvider {\n    constructor(cryptoMethod) {\n        super();\n        this.cryptoMethod = cryptoMethod || 'sha1';\n        this.randomBytesAsync = (0, util_1.promisify)(crypto.randomBytes);\n    }\n    async prepare(handshakeDoc, authContext) {\n        const cryptoMethod = this.cryptoMethod;\n        const credentials = authContext.credentials;\n        if (!credentials) {\n            throw new error_1.MongoMissingCredentialsError('AuthContext must provide credentials.');\n        }\n        if (cryptoMethod === 'sha256' &&\n            ('kModuleError' in deps_1.saslprep || typeof deps_1.saslprep !== 'function')) {\n            (0, utils_1.emitWarning)('Warning: no saslprep library specified. Passwords will not be sanitized');\n        }\n        const nonce = await this.randomBytesAsync(24);\n        // store the nonce for later use\n        authContext.nonce = nonce;\n        const request = {\n            ...handshakeDoc,\n            speculativeAuthenticate: {\n                ...makeFirstMessage(cryptoMethod, credentials, nonce),\n                db: credentials.source\n            }\n        };\n        return request;\n    }\n    async auth(authContext) {\n        const { reauthenticating, response } = authContext;\n        if (response?.speculativeAuthenticate && !reauthenticating) {\n            return continueScramConversation(this.cryptoMethod, response.speculativeAuthenticate, authContext);\n        }\n        return executeScram(this.cryptoMethod, authContext);\n    }\n}\nfunction cleanUsername(username) {\n    return username.replace('=', '=3D').replace(',', '=2C');\n}\nfunction clientFirstMessageBare(username, nonce) {\n    // NOTE: This is done b/c Javascript uses UTF-16, but the server is hashing in UTF-8.\n    // Since the username is not sasl-prep-d, we need to do this here.\n    return Buffer.concat([\n        Buffer.from('n=', 'utf8'),\n        Buffer.from(username, 'utf8'),\n        Buffer.from(',r=', 'utf8'),\n        Buffer.from(nonce.toString('base64'), 'utf8')\n    ]);\n}\nfunction makeFirstMessage(cryptoMethod, credentials, nonce) {\n    const username = cleanUsername(credentials.username);\n    const mechanism = cryptoMethod === 'sha1' ? providers_1.AuthMechanism.MONGODB_SCRAM_SHA1 : providers_1.AuthMechanism.MONGODB_SCRAM_SHA256;\n    // NOTE: This is done b/c Javascript uses UTF-16, but the server is hashing in UTF-8.\n    // Since the username is not sasl-prep-d, we need to do this here.\n    return {\n        saslStart: 1,\n        mechanism,\n        payload: new bson_1.Binary(Buffer.concat([Buffer.from('n,,', 'utf8'), clientFirstMessageBare(username, nonce)])),\n        autoAuthorize: 1,\n        options: { skipEmptyExchange: true }\n    };\n}\nasync function executeScram(cryptoMethod, authContext) {\n    const { connection, credentials } = authContext;\n    if (!credentials) {\n        throw new error_1.MongoMissingCredentialsError('AuthContext must provide credentials.');\n    }\n    if (!authContext.nonce) {\n        throw new error_1.MongoInvalidArgumentError('AuthContext must contain a valid nonce property');\n    }\n    const nonce = authContext.nonce;\n    const db = credentials.source;\n    const saslStartCmd = makeFirstMessage(cryptoMethod, credentials, nonce);\n    const response = await connection.commandAsync((0, utils_1.ns)(`${db}.$cmd`), saslStartCmd, undefined);\n    await continueScramConversation(cryptoMethod, response, authContext);\n}\nasync function continueScramConversation(cryptoMethod, response, authContext) {\n    const connection = authContext.connection;\n    const credentials = authContext.credentials;\n    if (!credentials) {\n        throw new error_1.MongoMissingCredentialsError('AuthContext must provide credentials.');\n    }\n    if (!authContext.nonce) {\n        throw new error_1.MongoInvalidArgumentError('Unable to continue SCRAM without valid nonce');\n    }\n    const nonce = authContext.nonce;\n    const db = credentials.source;\n    const username = cleanUsername(credentials.username);\n    const password = credentials.password;\n    let processedPassword;\n    if (cryptoMethod === 'sha256') {\n        processedPassword =\n            'kModuleError' in deps_1.saslprep || typeof deps_1.saslprep !== 'function' ? password : (0, deps_1.saslprep)(password);\n    }\n    else {\n        processedPassword = passwordDigest(username, password);\n    }\n    const payload = Buffer.isBuffer(response.payload)\n        ? new bson_1.Binary(response.payload)\n        : response.payload;\n    const dict = parsePayload(payload.value());\n    const iterations = parseInt(dict.i, 10);\n    if (iterations && iterations < 4096) {\n        // TODO(NODE-3483)\n        throw new error_1.MongoRuntimeError(`Server returned an invalid iteration count ${iterations}`);\n    }\n    const salt = dict.s;\n    const rnonce = dict.r;\n    if (rnonce.startsWith('nonce')) {\n        // TODO(NODE-3483)\n        throw new error_1.MongoRuntimeError(`Server returned an invalid nonce: ${rnonce}`);\n    }\n    // Set up start of proof\n    const withoutProof = `c=biws,r=${rnonce}`;\n    const saltedPassword = HI(processedPassword, Buffer.from(salt, 'base64'), iterations, cryptoMethod);\n    const clientKey = HMAC(cryptoMethod, saltedPassword, 'Client Key');\n    const serverKey = HMAC(cryptoMethod, saltedPassword, 'Server Key');\n    const storedKey = H(cryptoMethod, clientKey);\n    const authMessage = [clientFirstMessageBare(username, nonce), payload.value(), withoutProof].join(',');\n    const clientSignature = HMAC(cryptoMethod, storedKey, authMessage);\n    const clientProof = `p=${xor(clientKey, clientSignature)}`;\n    const clientFinal = [withoutProof, clientProof].join(',');\n    const serverSignature = HMAC(cryptoMethod, serverKey, authMessage);\n    const saslContinueCmd = {\n        saslContinue: 1,\n        conversationId: response.conversationId,\n        payload: new bson_1.Binary(Buffer.from(clientFinal))\n    };\n    const r = await connection.commandAsync((0, utils_1.ns)(`${db}.$cmd`), saslContinueCmd, undefined);\n    const parsedResponse = parsePayload(r.payload.value());\n    if (!compareDigest(Buffer.from(parsedResponse.v, 'base64'), serverSignature)) {\n        throw new error_1.MongoRuntimeError('Server returned an invalid signature');\n    }\n    if (r.done !== false) {\n        // If the server sends r.done === true we can save one RTT\n        return;\n    }\n    const retrySaslContinueCmd = {\n        saslContinue: 1,\n        conversationId: r.conversationId,\n        payload: Buffer.alloc(0)\n    };\n    await connection.commandAsync((0, utils_1.ns)(`${db}.$cmd`), retrySaslContinueCmd, undefined);\n}\nfunction parsePayload(payload) {\n    const dict = {};\n    const parts = payload.split(',');\n    for (let i = 0; i < parts.length; i++) {\n        const valueParts = parts[i].split('=');\n        dict[valueParts[0]] = valueParts[1];\n    }\n    return dict;\n}\nfunction passwordDigest(username, password) {\n    if (typeof username !== 'string') {\n        throw new error_1.MongoInvalidArgumentError('Username must be a string');\n    }\n    if (typeof password !== 'string') {\n        throw new error_1.MongoInvalidArgumentError('Password must be a string');\n    }\n    if (password.length === 0) {\n        throw new error_1.MongoInvalidArgumentError('Password cannot be empty');\n    }\n    let md5;\n    try {\n        md5 = crypto.createHash('md5');\n    }\n    catch (err) {\n        if (crypto.getFips()) {\n            // This error is (slightly) more helpful than what comes from OpenSSL directly, e.g.\n            // 'Error: error:060800C8:digital envelope routines:EVP_DigestInit_ex:disabled for FIPS'\n            throw new Error('Auth mechanism SCRAM-SHA-1 is not supported in FIPS mode');\n        }\n        throw err;\n    }\n    md5.update(`${username}:mongo:${password}`, 'utf8');\n    return md5.digest('hex');\n}\n// XOR two buffers\nfunction xor(a, b) {\n    if (!Buffer.isBuffer(a)) {\n        a = Buffer.from(a);\n    }\n    if (!Buffer.isBuffer(b)) {\n        b = Buffer.from(b);\n    }\n    const length = Math.max(a.length, b.length);\n    const res = [];\n    for (let i = 0; i < length; i += 1) {\n        res.push(a[i] ^ b[i]);\n    }\n    return Buffer.from(res).toString('base64');\n}\nfunction H(method, text) {\n    return crypto.createHash(method).update(text).digest();\n}\nfunction HMAC(method, key, text) {\n    return crypto.createHmac(method, key).update(text).digest();\n}\nlet _hiCache = {};\nlet _hiCacheCount = 0;\nfunction _hiCachePurge() {\n    _hiCache = {};\n    _hiCacheCount = 0;\n}\nconst hiLengthMap = {\n    sha256: 32,\n    sha1: 20\n};\nfunction HI(data, salt, iterations, cryptoMethod) {\n    // omit the work if already generated\n    const key = [data, salt.toString('base64'), iterations].join('_');\n    if (_hiCache[key] != null) {\n        return _hiCache[key];\n    }\n    // generate the salt\n    const saltedData = crypto.pbkdf2Sync(data, salt, iterations, hiLengthMap[cryptoMethod], cryptoMethod);\n    // cache a copy to speed up the next lookup, but prevent unbounded cache growth\n    if (_hiCacheCount >= 200) {\n        _hiCachePurge();\n    }\n    _hiCache[key] = saltedData;\n    _hiCacheCount += 1;\n    return saltedData;\n}\nfunction compareDigest(lhs, rhs) {\n    if (lhs.length !== rhs.length) {\n        return false;\n    }\n    if (typeof crypto.timingSafeEqual === 'function') {\n        return crypto.timingSafeEqual(lhs, rhs);\n    }\n    let result = 0;\n    for (let i = 0; i < lhs.length; i++) {\n        result |= lhs[i] ^ rhs[i];\n    }\n    return result === 0;\n}\nclass ScramSHA1 extends ScramSHA {\n    constructor() {\n        super('sha1');\n    }\n}\nexports.ScramSHA1 = ScramSHA1;\nclass ScramSHA256 extends ScramSHA {\n    constructor() {\n        super('sha256');\n    }\n}\nexports.ScramSHA256 = ScramSHA256;\n//# sourceMappingURL=scram.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jbWFwL2F1dGgvc2NyYW0uanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsbUJBQW1CLEdBQUcsaUJBQWlCO0FBQ3ZDLGVBQWUsbUJBQU8sQ0FBQyxzQkFBUTtBQUMvQixlQUFlLG1CQUFPLENBQUMsa0JBQU07QUFDN0IsZUFBZSxtQkFBTyxDQUFDLG9FQUFZO0FBQ25DLGVBQWUsbUJBQU8sQ0FBQyxvRUFBWTtBQUNuQyxnQkFBZ0IsbUJBQU8sQ0FBQyxzRUFBYTtBQUNyQyxnQkFBZ0IsbUJBQU8sQ0FBQyxzRUFBYTtBQUNyQyx3QkFBd0IsbUJBQU8sQ0FBQyw0RkFBaUI7QUFDakQsb0JBQW9CLG1CQUFPLENBQUMsb0ZBQWE7QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQiw2QkFBNkI7QUFDN0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQjtBQUNuQjtBQUNBO0FBQ0E7QUFDQSxZQUFZLDBCQUEwQjtBQUN0QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzRUFBc0UsR0FBRztBQUN6RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwRkFBMEYsV0FBVztBQUNyRztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUZBQWlGLE9BQU87QUFDeEY7QUFDQTtBQUNBLHFDQUFxQyxPQUFPO0FBQzVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QixnQ0FBZ0M7QUFDN0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrREFBK0QsR0FBRztBQUNsRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFEQUFxRCxHQUFHO0FBQ3hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLGtCQUFrQjtBQUN0QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0IsU0FBUyxTQUFTLFNBQVM7QUFDN0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLFlBQVk7QUFDaEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixnQkFBZ0I7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUI7QUFDbkIiLCJzb3VyY2VzIjpbIkQ6XFxzYWxvbmlcXGFwcHJhaXNhbC1zeXN0ZW1cXHNlcnZlclxcbm9kZV9tb2R1bGVzXFxtb25nb2RiXFxsaWJcXGNtYXBcXGF1dGhcXHNjcmFtLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5TY3JhbVNIQTI1NiA9IGV4cG9ydHMuU2NyYW1TSEExID0gdm9pZCAwO1xuY29uc3QgY3J5cHRvID0gcmVxdWlyZShcImNyeXB0b1wiKTtcbmNvbnN0IHV0aWxfMSA9IHJlcXVpcmUoXCJ1dGlsXCIpO1xuY29uc3QgYnNvbl8xID0gcmVxdWlyZShcIi4uLy4uL2Jzb25cIik7XG5jb25zdCBkZXBzXzEgPSByZXF1aXJlKFwiLi4vLi4vZGVwc1wiKTtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi4vLi4vZXJyb3JcIik7XG5jb25zdCB1dGlsc18xID0gcmVxdWlyZShcIi4uLy4uL3V0aWxzXCIpO1xuY29uc3QgYXV0aF9wcm92aWRlcl8xID0gcmVxdWlyZShcIi4vYXV0aF9wcm92aWRlclwiKTtcbmNvbnN0IHByb3ZpZGVyc18xID0gcmVxdWlyZShcIi4vcHJvdmlkZXJzXCIpO1xuY2xhc3MgU2NyYW1TSEEgZXh0ZW5kcyBhdXRoX3Byb3ZpZGVyXzEuQXV0aFByb3ZpZGVyIHtcbiAgICBjb25zdHJ1Y3RvcihjcnlwdG9NZXRob2QpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5jcnlwdG9NZXRob2QgPSBjcnlwdG9NZXRob2QgfHwgJ3NoYTEnO1xuICAgICAgICB0aGlzLnJhbmRvbUJ5dGVzQXN5bmMgPSAoMCwgdXRpbF8xLnByb21pc2lmeSkoY3J5cHRvLnJhbmRvbUJ5dGVzKTtcbiAgICB9XG4gICAgYXN5bmMgcHJlcGFyZShoYW5kc2hha2VEb2MsIGF1dGhDb250ZXh0KSB7XG4gICAgICAgIGNvbnN0IGNyeXB0b01ldGhvZCA9IHRoaXMuY3J5cHRvTWV0aG9kO1xuICAgICAgICBjb25zdCBjcmVkZW50aWFscyA9IGF1dGhDb250ZXh0LmNyZWRlbnRpYWxzO1xuICAgICAgICBpZiAoIWNyZWRlbnRpYWxzKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb01pc3NpbmdDcmVkZW50aWFsc0Vycm9yKCdBdXRoQ29udGV4dCBtdXN0IHByb3ZpZGUgY3JlZGVudGlhbHMuJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNyeXB0b01ldGhvZCA9PT0gJ3NoYTI1NicgJiZcbiAgICAgICAgICAgICgna01vZHVsZUVycm9yJyBpbiBkZXBzXzEuc2FzbHByZXAgfHwgdHlwZW9mIGRlcHNfMS5zYXNscHJlcCAhPT0gJ2Z1bmN0aW9uJykpIHtcbiAgICAgICAgICAgICgwLCB1dGlsc18xLmVtaXRXYXJuaW5nKSgnV2FybmluZzogbm8gc2FzbHByZXAgbGlicmFyeSBzcGVjaWZpZWQuIFBhc3N3b3JkcyB3aWxsIG5vdCBiZSBzYW5pdGl6ZWQnKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBub25jZSA9IGF3YWl0IHRoaXMucmFuZG9tQnl0ZXNBc3luYygyNCk7XG4gICAgICAgIC8vIHN0b3JlIHRoZSBub25jZSBmb3IgbGF0ZXIgdXNlXG4gICAgICAgIGF1dGhDb250ZXh0Lm5vbmNlID0gbm9uY2U7XG4gICAgICAgIGNvbnN0IHJlcXVlc3QgPSB7XG4gICAgICAgICAgICAuLi5oYW5kc2hha2VEb2MsXG4gICAgICAgICAgICBzcGVjdWxhdGl2ZUF1dGhlbnRpY2F0ZToge1xuICAgICAgICAgICAgICAgIC4uLm1ha2VGaXJzdE1lc3NhZ2UoY3J5cHRvTWV0aG9kLCBjcmVkZW50aWFscywgbm9uY2UpLFxuICAgICAgICAgICAgICAgIGRiOiBjcmVkZW50aWFscy5zb3VyY2VcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIHJlcXVlc3Q7XG4gICAgfVxuICAgIGFzeW5jIGF1dGgoYXV0aENvbnRleHQpIHtcbiAgICAgICAgY29uc3QgeyByZWF1dGhlbnRpY2F0aW5nLCByZXNwb25zZSB9ID0gYXV0aENvbnRleHQ7XG4gICAgICAgIGlmIChyZXNwb25zZT8uc3BlY3VsYXRpdmVBdXRoZW50aWNhdGUgJiYgIXJlYXV0aGVudGljYXRpbmcpIHtcbiAgICAgICAgICAgIHJldHVybiBjb250aW51ZVNjcmFtQ29udmVyc2F0aW9uKHRoaXMuY3J5cHRvTWV0aG9kLCByZXNwb25zZS5zcGVjdWxhdGl2ZUF1dGhlbnRpY2F0ZSwgYXV0aENvbnRleHQpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBleGVjdXRlU2NyYW0odGhpcy5jcnlwdG9NZXRob2QsIGF1dGhDb250ZXh0KTtcbiAgICB9XG59XG5mdW5jdGlvbiBjbGVhblVzZXJuYW1lKHVzZXJuYW1lKSB7XG4gICAgcmV0dXJuIHVzZXJuYW1lLnJlcGxhY2UoJz0nLCAnPTNEJykucmVwbGFjZSgnLCcsICc9MkMnKTtcbn1cbmZ1bmN0aW9uIGNsaWVudEZpcnN0TWVzc2FnZUJhcmUodXNlcm5hbWUsIG5vbmNlKSB7XG4gICAgLy8gTk9URTogVGhpcyBpcyBkb25lIGIvYyBKYXZhc2NyaXB0IHVzZXMgVVRGLTE2LCBidXQgdGhlIHNlcnZlciBpcyBoYXNoaW5nIGluIFVURi04LlxuICAgIC8vIFNpbmNlIHRoZSB1c2VybmFtZSBpcyBub3Qgc2FzbC1wcmVwLWQsIHdlIG5lZWQgdG8gZG8gdGhpcyBoZXJlLlxuICAgIHJldHVybiBCdWZmZXIuY29uY2F0KFtcbiAgICAgICAgQnVmZmVyLmZyb20oJ249JywgJ3V0ZjgnKSxcbiAgICAgICAgQnVmZmVyLmZyb20odXNlcm5hbWUsICd1dGY4JyksXG4gICAgICAgIEJ1ZmZlci5mcm9tKCcscj0nLCAndXRmOCcpLFxuICAgICAgICBCdWZmZXIuZnJvbShub25jZS50b1N0cmluZygnYmFzZTY0JyksICd1dGY4JylcbiAgICBdKTtcbn1cbmZ1bmN0aW9uIG1ha2VGaXJzdE1lc3NhZ2UoY3J5cHRvTWV0aG9kLCBjcmVkZW50aWFscywgbm9uY2UpIHtcbiAgICBjb25zdCB1c2VybmFtZSA9IGNsZWFuVXNlcm5hbWUoY3JlZGVudGlhbHMudXNlcm5hbWUpO1xuICAgIGNvbnN0IG1lY2hhbmlzbSA9IGNyeXB0b01ldGhvZCA9PT0gJ3NoYTEnID8gcHJvdmlkZXJzXzEuQXV0aE1lY2hhbmlzbS5NT05HT0RCX1NDUkFNX1NIQTEgOiBwcm92aWRlcnNfMS5BdXRoTWVjaGFuaXNtLk1PTkdPREJfU0NSQU1fU0hBMjU2O1xuICAgIC8vIE5PVEU6IFRoaXMgaXMgZG9uZSBiL2MgSmF2YXNjcmlwdCB1c2VzIFVURi0xNiwgYnV0IHRoZSBzZXJ2ZXIgaXMgaGFzaGluZyBpbiBVVEYtOC5cbiAgICAvLyBTaW5jZSB0aGUgdXNlcm5hbWUgaXMgbm90IHNhc2wtcHJlcC1kLCB3ZSBuZWVkIHRvIGRvIHRoaXMgaGVyZS5cbiAgICByZXR1cm4ge1xuICAgICAgICBzYXNsU3RhcnQ6IDEsXG4gICAgICAgIG1lY2hhbmlzbSxcbiAgICAgICAgcGF5bG9hZDogbmV3IGJzb25fMS5CaW5hcnkoQnVmZmVyLmNvbmNhdChbQnVmZmVyLmZyb20oJ24sLCcsICd1dGY4JyksIGNsaWVudEZpcnN0TWVzc2FnZUJhcmUodXNlcm5hbWUsIG5vbmNlKV0pKSxcbiAgICAgICAgYXV0b0F1dGhvcml6ZTogMSxcbiAgICAgICAgb3B0aW9uczogeyBza2lwRW1wdHlFeGNoYW5nZTogdHJ1ZSB9XG4gICAgfTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGV4ZWN1dGVTY3JhbShjcnlwdG9NZXRob2QsIGF1dGhDb250ZXh0KSB7XG4gICAgY29uc3QgeyBjb25uZWN0aW9uLCBjcmVkZW50aWFscyB9ID0gYXV0aENvbnRleHQ7XG4gICAgaWYgKCFjcmVkZW50aWFscykge1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb01pc3NpbmdDcmVkZW50aWFsc0Vycm9yKCdBdXRoQ29udGV4dCBtdXN0IHByb3ZpZGUgY3JlZGVudGlhbHMuJyk7XG4gICAgfVxuICAgIGlmICghYXV0aENvbnRleHQubm9uY2UpIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignQXV0aENvbnRleHQgbXVzdCBjb250YWluIGEgdmFsaWQgbm9uY2UgcHJvcGVydHknKTtcbiAgICB9XG4gICAgY29uc3Qgbm9uY2UgPSBhdXRoQ29udGV4dC5ub25jZTtcbiAgICBjb25zdCBkYiA9IGNyZWRlbnRpYWxzLnNvdXJjZTtcbiAgICBjb25zdCBzYXNsU3RhcnRDbWQgPSBtYWtlRmlyc3RNZXNzYWdlKGNyeXB0b01ldGhvZCwgY3JlZGVudGlhbHMsIG5vbmNlKTtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGNvbm5lY3Rpb24uY29tbWFuZEFzeW5jKCgwLCB1dGlsc18xLm5zKShgJHtkYn0uJGNtZGApLCBzYXNsU3RhcnRDbWQsIHVuZGVmaW5lZCk7XG4gICAgYXdhaXQgY29udGludWVTY3JhbUNvbnZlcnNhdGlvbihjcnlwdG9NZXRob2QsIHJlc3BvbnNlLCBhdXRoQ29udGV4dCk7XG59XG5hc3luYyBmdW5jdGlvbiBjb250aW51ZVNjcmFtQ29udmVyc2F0aW9uKGNyeXB0b01ldGhvZCwgcmVzcG9uc2UsIGF1dGhDb250ZXh0KSB7XG4gICAgY29uc3QgY29ubmVjdGlvbiA9IGF1dGhDb250ZXh0LmNvbm5lY3Rpb247XG4gICAgY29uc3QgY3JlZGVudGlhbHMgPSBhdXRoQ29udGV4dC5jcmVkZW50aWFscztcbiAgICBpZiAoIWNyZWRlbnRpYWxzKSB7XG4gICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvTWlzc2luZ0NyZWRlbnRpYWxzRXJyb3IoJ0F1dGhDb250ZXh0IG11c3QgcHJvdmlkZSBjcmVkZW50aWFscy4nKTtcbiAgICB9XG4gICAgaWYgKCFhdXRoQ29udGV4dC5ub25jZSkge1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdVbmFibGUgdG8gY29udGludWUgU0NSQU0gd2l0aG91dCB2YWxpZCBub25jZScpO1xuICAgIH1cbiAgICBjb25zdCBub25jZSA9IGF1dGhDb250ZXh0Lm5vbmNlO1xuICAgIGNvbnN0IGRiID0gY3JlZGVudGlhbHMuc291cmNlO1xuICAgIGNvbnN0IHVzZXJuYW1lID0gY2xlYW5Vc2VybmFtZShjcmVkZW50aWFscy51c2VybmFtZSk7XG4gICAgY29uc3QgcGFzc3dvcmQgPSBjcmVkZW50aWFscy5wYXNzd29yZDtcbiAgICBsZXQgcHJvY2Vzc2VkUGFzc3dvcmQ7XG4gICAgaWYgKGNyeXB0b01ldGhvZCA9PT0gJ3NoYTI1NicpIHtcbiAgICAgICAgcHJvY2Vzc2VkUGFzc3dvcmQgPVxuICAgICAgICAgICAgJ2tNb2R1bGVFcnJvcicgaW4gZGVwc18xLnNhc2xwcmVwIHx8IHR5cGVvZiBkZXBzXzEuc2FzbHByZXAgIT09ICdmdW5jdGlvbicgPyBwYXNzd29yZCA6ICgwLCBkZXBzXzEuc2FzbHByZXApKHBhc3N3b3JkKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHByb2Nlc3NlZFBhc3N3b3JkID0gcGFzc3dvcmREaWdlc3QodXNlcm5hbWUsIHBhc3N3b3JkKTtcbiAgICB9XG4gICAgY29uc3QgcGF5bG9hZCA9IEJ1ZmZlci5pc0J1ZmZlcihyZXNwb25zZS5wYXlsb2FkKVxuICAgICAgICA/IG5ldyBic29uXzEuQmluYXJ5KHJlc3BvbnNlLnBheWxvYWQpXG4gICAgICAgIDogcmVzcG9uc2UucGF5bG9hZDtcbiAgICBjb25zdCBkaWN0ID0gcGFyc2VQYXlsb2FkKHBheWxvYWQudmFsdWUoKSk7XG4gICAgY29uc3QgaXRlcmF0aW9ucyA9IHBhcnNlSW50KGRpY3QuaSwgMTApO1xuICAgIGlmIChpdGVyYXRpb25zICYmIGl0ZXJhdGlvbnMgPCA0MDk2KSB7XG4gICAgICAgIC8vIFRPRE8oTk9ERS0zNDgzKVxuICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1J1bnRpbWVFcnJvcihgU2VydmVyIHJldHVybmVkIGFuIGludmFsaWQgaXRlcmF0aW9uIGNvdW50ICR7aXRlcmF0aW9uc31gKTtcbiAgICB9XG4gICAgY29uc3Qgc2FsdCA9IGRpY3QucztcbiAgICBjb25zdCBybm9uY2UgPSBkaWN0LnI7XG4gICAgaWYgKHJub25jZS5zdGFydHNXaXRoKCdub25jZScpKSB7XG4gICAgICAgIC8vIFRPRE8oTk9ERS0zNDgzKVxuICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1J1bnRpbWVFcnJvcihgU2VydmVyIHJldHVybmVkIGFuIGludmFsaWQgbm9uY2U6ICR7cm5vbmNlfWApO1xuICAgIH1cbiAgICAvLyBTZXQgdXAgc3RhcnQgb2YgcHJvb2ZcbiAgICBjb25zdCB3aXRob3V0UHJvb2YgPSBgYz1iaXdzLHI9JHtybm9uY2V9YDtcbiAgICBjb25zdCBzYWx0ZWRQYXNzd29yZCA9IEhJKHByb2Nlc3NlZFBhc3N3b3JkLCBCdWZmZXIuZnJvbShzYWx0LCAnYmFzZTY0JyksIGl0ZXJhdGlvbnMsIGNyeXB0b01ldGhvZCk7XG4gICAgY29uc3QgY2xpZW50S2V5ID0gSE1BQyhjcnlwdG9NZXRob2QsIHNhbHRlZFBhc3N3b3JkLCAnQ2xpZW50IEtleScpO1xuICAgIGNvbnN0IHNlcnZlcktleSA9IEhNQUMoY3J5cHRvTWV0aG9kLCBzYWx0ZWRQYXNzd29yZCwgJ1NlcnZlciBLZXknKTtcbiAgICBjb25zdCBzdG9yZWRLZXkgPSBIKGNyeXB0b01ldGhvZCwgY2xpZW50S2V5KTtcbiAgICBjb25zdCBhdXRoTWVzc2FnZSA9IFtjbGllbnRGaXJzdE1lc3NhZ2VCYXJlKHVzZXJuYW1lLCBub25jZSksIHBheWxvYWQudmFsdWUoKSwgd2l0aG91dFByb29mXS5qb2luKCcsJyk7XG4gICAgY29uc3QgY2xpZW50U2lnbmF0dXJlID0gSE1BQyhjcnlwdG9NZXRob2QsIHN0b3JlZEtleSwgYXV0aE1lc3NhZ2UpO1xuICAgIGNvbnN0IGNsaWVudFByb29mID0gYHA9JHt4b3IoY2xpZW50S2V5LCBjbGllbnRTaWduYXR1cmUpfWA7XG4gICAgY29uc3QgY2xpZW50RmluYWwgPSBbd2l0aG91dFByb29mLCBjbGllbnRQcm9vZl0uam9pbignLCcpO1xuICAgIGNvbnN0IHNlcnZlclNpZ25hdHVyZSA9IEhNQUMoY3J5cHRvTWV0aG9kLCBzZXJ2ZXJLZXksIGF1dGhNZXNzYWdlKTtcbiAgICBjb25zdCBzYXNsQ29udGludWVDbWQgPSB7XG4gICAgICAgIHNhc2xDb250aW51ZTogMSxcbiAgICAgICAgY29udmVyc2F0aW9uSWQ6IHJlc3BvbnNlLmNvbnZlcnNhdGlvbklkLFxuICAgICAgICBwYXlsb2FkOiBuZXcgYnNvbl8xLkJpbmFyeShCdWZmZXIuZnJvbShjbGllbnRGaW5hbCkpXG4gICAgfTtcbiAgICBjb25zdCByID0gYXdhaXQgY29ubmVjdGlvbi5jb21tYW5kQXN5bmMoKDAsIHV0aWxzXzEubnMpKGAke2RifS4kY21kYCksIHNhc2xDb250aW51ZUNtZCwgdW5kZWZpbmVkKTtcbiAgICBjb25zdCBwYXJzZWRSZXNwb25zZSA9IHBhcnNlUGF5bG9hZChyLnBheWxvYWQudmFsdWUoKSk7XG4gICAgaWYgKCFjb21wYXJlRGlnZXN0KEJ1ZmZlci5mcm9tKHBhcnNlZFJlc3BvbnNlLnYsICdiYXNlNjQnKSwgc2VydmVyU2lnbmF0dXJlKSkge1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1J1bnRpbWVFcnJvcignU2VydmVyIHJldHVybmVkIGFuIGludmFsaWQgc2lnbmF0dXJlJyk7XG4gICAgfVxuICAgIGlmIChyLmRvbmUgIT09IGZhbHNlKSB7XG4gICAgICAgIC8vIElmIHRoZSBzZXJ2ZXIgc2VuZHMgci5kb25lID09PSB0cnVlIHdlIGNhbiBzYXZlIG9uZSBSVFRcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCByZXRyeVNhc2xDb250aW51ZUNtZCA9IHtcbiAgICAgICAgc2FzbENvbnRpbnVlOiAxLFxuICAgICAgICBjb252ZXJzYXRpb25JZDogci5jb252ZXJzYXRpb25JZCxcbiAgICAgICAgcGF5bG9hZDogQnVmZmVyLmFsbG9jKDApXG4gICAgfTtcbiAgICBhd2FpdCBjb25uZWN0aW9uLmNvbW1hbmRBc3luYygoMCwgdXRpbHNfMS5ucykoYCR7ZGJ9LiRjbWRgKSwgcmV0cnlTYXNsQ29udGludWVDbWQsIHVuZGVmaW5lZCk7XG59XG5mdW5jdGlvbiBwYXJzZVBheWxvYWQocGF5bG9hZCkge1xuICAgIGNvbnN0IGRpY3QgPSB7fTtcbiAgICBjb25zdCBwYXJ0cyA9IHBheWxvYWQuc3BsaXQoJywnKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHBhcnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IHZhbHVlUGFydHMgPSBwYXJ0c1tpXS5zcGxpdCgnPScpO1xuICAgICAgICBkaWN0W3ZhbHVlUGFydHNbMF1dID0gdmFsdWVQYXJ0c1sxXTtcbiAgICB9XG4gICAgcmV0dXJuIGRpY3Q7XG59XG5mdW5jdGlvbiBwYXNzd29yZERpZ2VzdCh1c2VybmFtZSwgcGFzc3dvcmQpIHtcbiAgICBpZiAodHlwZW9mIHVzZXJuYW1lICE9PSAnc3RyaW5nJykge1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdVc2VybmFtZSBtdXN0IGJlIGEgc3RyaW5nJyk7XG4gICAgfVxuICAgIGlmICh0eXBlb2YgcGFzc3dvcmQgIT09ICdzdHJpbmcnKSB7XG4gICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoJ1Bhc3N3b3JkIG11c3QgYmUgYSBzdHJpbmcnKTtcbiAgICB9XG4gICAgaWYgKHBhc3N3b3JkLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdQYXNzd29yZCBjYW5ub3QgYmUgZW1wdHknKTtcbiAgICB9XG4gICAgbGV0IG1kNTtcbiAgICB0cnkge1xuICAgICAgICBtZDUgPSBjcnlwdG8uY3JlYXRlSGFzaCgnbWQ1Jyk7XG4gICAgfVxuICAgIGNhdGNoIChlcnIpIHtcbiAgICAgICAgaWYgKGNyeXB0by5nZXRGaXBzKCkpIHtcbiAgICAgICAgICAgIC8vIFRoaXMgZXJyb3IgaXMgKHNsaWdodGx5KSBtb3JlIGhlbHBmdWwgdGhhbiB3aGF0IGNvbWVzIGZyb20gT3BlblNTTCBkaXJlY3RseSwgZS5nLlxuICAgICAgICAgICAgLy8gJ0Vycm9yOiBlcnJvcjowNjA4MDBDODpkaWdpdGFsIGVudmVsb3BlIHJvdXRpbmVzOkVWUF9EaWdlc3RJbml0X2V4OmRpc2FibGVkIGZvciBGSVBTJ1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdBdXRoIG1lY2hhbmlzbSBTQ1JBTS1TSEEtMSBpcyBub3Qgc3VwcG9ydGVkIGluIEZJUFMgbW9kZScpO1xuICAgICAgICB9XG4gICAgICAgIHRocm93IGVycjtcbiAgICB9XG4gICAgbWQ1LnVwZGF0ZShgJHt1c2VybmFtZX06bW9uZ286JHtwYXNzd29yZH1gLCAndXRmOCcpO1xuICAgIHJldHVybiBtZDUuZGlnZXN0KCdoZXgnKTtcbn1cbi8vIFhPUiB0d28gYnVmZmVyc1xuZnVuY3Rpb24geG9yKGEsIGIpIHtcbiAgICBpZiAoIUJ1ZmZlci5pc0J1ZmZlcihhKSkge1xuICAgICAgICBhID0gQnVmZmVyLmZyb20oYSk7XG4gICAgfVxuICAgIGlmICghQnVmZmVyLmlzQnVmZmVyKGIpKSB7XG4gICAgICAgIGIgPSBCdWZmZXIuZnJvbShiKTtcbiAgICB9XG4gICAgY29uc3QgbGVuZ3RoID0gTWF0aC5tYXgoYS5sZW5ndGgsIGIubGVuZ3RoKTtcbiAgICBjb25zdCByZXMgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSArPSAxKSB7XG4gICAgICAgIHJlcy5wdXNoKGFbaV0gXiBiW2ldKTtcbiAgICB9XG4gICAgcmV0dXJuIEJ1ZmZlci5mcm9tKHJlcykudG9TdHJpbmcoJ2Jhc2U2NCcpO1xufVxuZnVuY3Rpb24gSChtZXRob2QsIHRleHQpIHtcbiAgICByZXR1cm4gY3J5cHRvLmNyZWF0ZUhhc2gobWV0aG9kKS51cGRhdGUodGV4dCkuZGlnZXN0KCk7XG59XG5mdW5jdGlvbiBITUFDKG1ldGhvZCwga2V5LCB0ZXh0KSB7XG4gICAgcmV0dXJuIGNyeXB0by5jcmVhdGVIbWFjKG1ldGhvZCwga2V5KS51cGRhdGUodGV4dCkuZGlnZXN0KCk7XG59XG5sZXQgX2hpQ2FjaGUgPSB7fTtcbmxldCBfaGlDYWNoZUNvdW50ID0gMDtcbmZ1bmN0aW9uIF9oaUNhY2hlUHVyZ2UoKSB7XG4gICAgX2hpQ2FjaGUgPSB7fTtcbiAgICBfaGlDYWNoZUNvdW50ID0gMDtcbn1cbmNvbnN0IGhpTGVuZ3RoTWFwID0ge1xuICAgIHNoYTI1NjogMzIsXG4gICAgc2hhMTogMjBcbn07XG5mdW5jdGlvbiBISShkYXRhLCBzYWx0LCBpdGVyYXRpb25zLCBjcnlwdG9NZXRob2QpIHtcbiAgICAvLyBvbWl0IHRoZSB3b3JrIGlmIGFscmVhZHkgZ2VuZXJhdGVkXG4gICAgY29uc3Qga2V5ID0gW2RhdGEsIHNhbHQudG9TdHJpbmcoJ2Jhc2U2NCcpLCBpdGVyYXRpb25zXS5qb2luKCdfJyk7XG4gICAgaWYgKF9oaUNhY2hlW2tleV0gIT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gX2hpQ2FjaGVba2V5XTtcbiAgICB9XG4gICAgLy8gZ2VuZXJhdGUgdGhlIHNhbHRcbiAgICBjb25zdCBzYWx0ZWREYXRhID0gY3J5cHRvLnBia2RmMlN5bmMoZGF0YSwgc2FsdCwgaXRlcmF0aW9ucywgaGlMZW5ndGhNYXBbY3J5cHRvTWV0aG9kXSwgY3J5cHRvTWV0aG9kKTtcbiAgICAvLyBjYWNoZSBhIGNvcHkgdG8gc3BlZWQgdXAgdGhlIG5leHQgbG9va3VwLCBidXQgcHJldmVudCB1bmJvdW5kZWQgY2FjaGUgZ3Jvd3RoXG4gICAgaWYgKF9oaUNhY2hlQ291bnQgPj0gMjAwKSB7XG4gICAgICAgIF9oaUNhY2hlUHVyZ2UoKTtcbiAgICB9XG4gICAgX2hpQ2FjaGVba2V5XSA9IHNhbHRlZERhdGE7XG4gICAgX2hpQ2FjaGVDb3VudCArPSAxO1xuICAgIHJldHVybiBzYWx0ZWREYXRhO1xufVxuZnVuY3Rpb24gY29tcGFyZURpZ2VzdChsaHMsIHJocykge1xuICAgIGlmIChsaHMubGVuZ3RoICE9PSByaHMubGVuZ3RoKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBjcnlwdG8udGltaW5nU2FmZUVxdWFsID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIHJldHVybiBjcnlwdG8udGltaW5nU2FmZUVxdWFsKGxocywgcmhzKTtcbiAgICB9XG4gICAgbGV0IHJlc3VsdCA9IDA7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsaHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgcmVzdWx0IHw9IGxoc1tpXSBeIHJoc1tpXTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdCA9PT0gMDtcbn1cbmNsYXNzIFNjcmFtU0hBMSBleHRlbmRzIFNjcmFtU0hBIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoJ3NoYTEnKTtcbiAgICB9XG59XG5leHBvcnRzLlNjcmFtU0hBMSA9IFNjcmFtU0hBMTtcbmNsYXNzIFNjcmFtU0hBMjU2IGV4dGVuZHMgU2NyYW1TSEEge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcignc2hhMjU2Jyk7XG4gICAgfVxufVxuZXhwb3J0cy5TY3JhbVNIQTI1NiA9IFNjcmFtU0hBMjU2O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9c2NyYW0uanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/cmap/auth/scram.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/cmap/auth/x509.js":
/*!************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/cmap/auth/x509.js ***!
  \************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.X509 = void 0;\nconst error_1 = __webpack_require__(/*! ../../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst utils_1 = __webpack_require__(/*! ../../utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\nconst auth_provider_1 = __webpack_require__(/*! ./auth_provider */ \"(api)/../server/node_modules/mongodb/lib/cmap/auth/auth_provider.js\");\nclass X509 extends auth_provider_1.AuthProvider {\n    async prepare(handshakeDoc, authContext) {\n        const { credentials } = authContext;\n        if (!credentials) {\n            throw new error_1.MongoMissingCredentialsError('AuthContext must provide credentials.');\n        }\n        return { ...handshakeDoc, speculativeAuthenticate: x509AuthenticateCommand(credentials) };\n    }\n    async auth(authContext) {\n        const connection = authContext.connection;\n        const credentials = authContext.credentials;\n        if (!credentials) {\n            throw new error_1.MongoMissingCredentialsError('AuthContext must provide credentials.');\n        }\n        const response = authContext.response;\n        if (response?.speculativeAuthenticate) {\n            return;\n        }\n        await connection.commandAsync((0, utils_1.ns)('$external.$cmd'), x509AuthenticateCommand(credentials), undefined);\n    }\n}\nexports.X509 = X509;\nfunction x509AuthenticateCommand(credentials) {\n    const command = { authenticate: 1, mechanism: 'MONGODB-X509' };\n    if (credentials.username) {\n        command.user = credentials.username;\n    }\n    return command;\n}\n//# sourceMappingURL=x509.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jbWFwL2F1dGgveDUwOS5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxZQUFZO0FBQ1osZ0JBQWdCLG1CQUFPLENBQUMsc0VBQWE7QUFDckMsZ0JBQWdCLG1CQUFPLENBQUMsc0VBQWE7QUFDckMsd0JBQXdCLG1CQUFPLENBQUMsNEZBQWlCO0FBQ2pEO0FBQ0E7QUFDQSxnQkFBZ0IsY0FBYztBQUM5QjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVk7QUFDWjtBQUNBLHNCQUFzQjtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIkQ6XFxzYWxvbmlcXGFwcHJhaXNhbC1zeXN0ZW1cXHNlcnZlclxcbm9kZV9tb2R1bGVzXFxtb25nb2RiXFxsaWJcXGNtYXBcXGF1dGhcXHg1MDkuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLlg1MDkgPSB2b2lkIDA7XG5jb25zdCBlcnJvcl8xID0gcmVxdWlyZShcIi4uLy4uL2Vycm9yXCIpO1xuY29uc3QgdXRpbHNfMSA9IHJlcXVpcmUoXCIuLi8uLi91dGlsc1wiKTtcbmNvbnN0IGF1dGhfcHJvdmlkZXJfMSA9IHJlcXVpcmUoXCIuL2F1dGhfcHJvdmlkZXJcIik7XG5jbGFzcyBYNTA5IGV4dGVuZHMgYXV0aF9wcm92aWRlcl8xLkF1dGhQcm92aWRlciB7XG4gICAgYXN5bmMgcHJlcGFyZShoYW5kc2hha2VEb2MsIGF1dGhDb250ZXh0KSB7XG4gICAgICAgIGNvbnN0IHsgY3JlZGVudGlhbHMgfSA9IGF1dGhDb250ZXh0O1xuICAgICAgICBpZiAoIWNyZWRlbnRpYWxzKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb01pc3NpbmdDcmVkZW50aWFsc0Vycm9yKCdBdXRoQ29udGV4dCBtdXN0IHByb3ZpZGUgY3JlZGVudGlhbHMuJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgLi4uaGFuZHNoYWtlRG9jLCBzcGVjdWxhdGl2ZUF1dGhlbnRpY2F0ZTogeDUwOUF1dGhlbnRpY2F0ZUNvbW1hbmQoY3JlZGVudGlhbHMpIH07XG4gICAgfVxuICAgIGFzeW5jIGF1dGgoYXV0aENvbnRleHQpIHtcbiAgICAgICAgY29uc3QgY29ubmVjdGlvbiA9IGF1dGhDb250ZXh0LmNvbm5lY3Rpb247XG4gICAgICAgIGNvbnN0IGNyZWRlbnRpYWxzID0gYXV0aENvbnRleHQuY3JlZGVudGlhbHM7XG4gICAgICAgIGlmICghY3JlZGVudGlhbHMpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvTWlzc2luZ0NyZWRlbnRpYWxzRXJyb3IoJ0F1dGhDb250ZXh0IG11c3QgcHJvdmlkZSBjcmVkZW50aWFscy4nKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF1dGhDb250ZXh0LnJlc3BvbnNlO1xuICAgICAgICBpZiAocmVzcG9uc2U/LnNwZWN1bGF0aXZlQXV0aGVudGljYXRlKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgYXdhaXQgY29ubmVjdGlvbi5jb21tYW5kQXN5bmMoKDAsIHV0aWxzXzEubnMpKCckZXh0ZXJuYWwuJGNtZCcpLCB4NTA5QXV0aGVudGljYXRlQ29tbWFuZChjcmVkZW50aWFscyksIHVuZGVmaW5lZCk7XG4gICAgfVxufVxuZXhwb3J0cy5YNTA5ID0gWDUwOTtcbmZ1bmN0aW9uIHg1MDlBdXRoZW50aWNhdGVDb21tYW5kKGNyZWRlbnRpYWxzKSB7XG4gICAgY29uc3QgY29tbWFuZCA9IHsgYXV0aGVudGljYXRlOiAxLCBtZWNoYW5pc206ICdNT05HT0RCLVg1MDknIH07XG4gICAgaWYgKGNyZWRlbnRpYWxzLnVzZXJuYW1lKSB7XG4gICAgICAgIGNvbW1hbmQudXNlciA9IGNyZWRlbnRpYWxzLnVzZXJuYW1lO1xuICAgIH1cbiAgICByZXR1cm4gY29tbWFuZDtcbn1cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXg1MDkuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/cmap/auth/x509.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/cmap/command_monitoring_events.js":
/*!****************************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/cmap/command_monitoring_events.js ***!
  \****************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.SENSITIVE_COMMANDS = exports.CommandFailedEvent = exports.CommandSucceededEvent = exports.CommandStartedEvent = void 0;\nconst constants_1 = __webpack_require__(/*! ../constants */ \"(api)/../server/node_modules/mongodb/lib/constants.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\nconst commands_1 = __webpack_require__(/*! ./commands */ \"(api)/../server/node_modules/mongodb/lib/cmap/commands.js\");\n/**\n * An event indicating the start of a given command\n * @public\n * @category Event\n */\nclass CommandStartedEvent {\n    /**\n     * Create a started event\n     *\n     * @internal\n     * @param pool - the pool that originated the command\n     * @param command - the command\n     */\n    constructor(connection, command) {\n        /** @internal */\n        this.name = constants_1.COMMAND_STARTED;\n        const cmd = extractCommand(command);\n        const commandName = extractCommandName(cmd);\n        const { address, connectionId, serviceId } = extractConnectionDetails(connection);\n        // TODO: remove in major revision, this is not spec behavior\n        if (exports.SENSITIVE_COMMANDS.has(commandName)) {\n            this.commandObj = {};\n            this.commandObj[commandName] = true;\n        }\n        this.address = address;\n        this.connectionId = connectionId;\n        this.serviceId = serviceId;\n        this.requestId = command.requestId;\n        this.databaseName = databaseName(command);\n        this.commandName = commandName;\n        this.command = maybeRedact(commandName, cmd, cmd);\n    }\n    /* @internal */\n    get hasServiceId() {\n        return !!this.serviceId;\n    }\n}\nexports.CommandStartedEvent = CommandStartedEvent;\n/**\n * An event indicating the success of a given command\n * @public\n * @category Event\n */\nclass CommandSucceededEvent {\n    /**\n     * Create a succeeded event\n     *\n     * @internal\n     * @param pool - the pool that originated the command\n     * @param command - the command\n     * @param reply - the reply for this command from the server\n     * @param started - a high resolution tuple timestamp of when the command was first sent, to calculate duration\n     */\n    constructor(connection, command, reply, started) {\n        /** @internal */\n        this.name = constants_1.COMMAND_SUCCEEDED;\n        const cmd = extractCommand(command);\n        const commandName = extractCommandName(cmd);\n        const { address, connectionId, serviceId } = extractConnectionDetails(connection);\n        this.address = address;\n        this.connectionId = connectionId;\n        this.serviceId = serviceId;\n        this.requestId = command.requestId;\n        this.commandName = commandName;\n        this.duration = (0, utils_1.calculateDurationInMs)(started);\n        this.reply = maybeRedact(commandName, cmd, extractReply(command, reply));\n    }\n    /* @internal */\n    get hasServiceId() {\n        return !!this.serviceId;\n    }\n}\nexports.CommandSucceededEvent = CommandSucceededEvent;\n/**\n * An event indicating the failure of a given command\n * @public\n * @category Event\n */\nclass CommandFailedEvent {\n    /**\n     * Create a failure event\n     *\n     * @internal\n     * @param pool - the pool that originated the command\n     * @param command - the command\n     * @param error - the generated error or a server error response\n     * @param started - a high resolution tuple timestamp of when the command was first sent, to calculate duration\n     */\n    constructor(connection, command, error, started) {\n        /** @internal */\n        this.name = constants_1.COMMAND_FAILED;\n        const cmd = extractCommand(command);\n        const commandName = extractCommandName(cmd);\n        const { address, connectionId, serviceId } = extractConnectionDetails(connection);\n        this.address = address;\n        this.connectionId = connectionId;\n        this.serviceId = serviceId;\n        this.requestId = command.requestId;\n        this.commandName = commandName;\n        this.duration = (0, utils_1.calculateDurationInMs)(started);\n        this.failure = maybeRedact(commandName, cmd, error);\n    }\n    /* @internal */\n    get hasServiceId() {\n        return !!this.serviceId;\n    }\n}\nexports.CommandFailedEvent = CommandFailedEvent;\n/**\n * Commands that we want to redact because of the sensitive nature of their contents\n * @internal\n */\nexports.SENSITIVE_COMMANDS = new Set([\n    'authenticate',\n    'saslStart',\n    'saslContinue',\n    'getnonce',\n    'createUser',\n    'updateUser',\n    'copydbgetnonce',\n    'copydbsaslstart',\n    'copydb'\n]);\nconst HELLO_COMMANDS = new Set(['hello', constants_1.LEGACY_HELLO_COMMAND, constants_1.LEGACY_HELLO_COMMAND_CAMEL_CASE]);\n// helper methods\nconst extractCommandName = (commandDoc) => Object.keys(commandDoc)[0];\nconst namespace = (command) => command.ns;\nconst databaseName = (command) => command.ns.split('.')[0];\nconst collectionName = (command) => command.ns.split('.')[1];\nconst maybeRedact = (commandName, commandDoc, result) => exports.SENSITIVE_COMMANDS.has(commandName) ||\n    (HELLO_COMMANDS.has(commandName) && commandDoc.speculativeAuthenticate)\n    ? {}\n    : result;\nconst LEGACY_FIND_QUERY_MAP = {\n    $query: 'filter',\n    $orderby: 'sort',\n    $hint: 'hint',\n    $comment: 'comment',\n    $maxScan: 'maxScan',\n    $max: 'max',\n    $min: 'min',\n    $returnKey: 'returnKey',\n    $showDiskLoc: 'showRecordId',\n    $maxTimeMS: 'maxTimeMS',\n    $snapshot: 'snapshot'\n};\nconst LEGACY_FIND_OPTIONS_MAP = {\n    numberToSkip: 'skip',\n    numberToReturn: 'batchSize',\n    returnFieldSelector: 'projection'\n};\nconst OP_QUERY_KEYS = [\n    'tailable',\n    'oplogReplay',\n    'noCursorTimeout',\n    'awaitData',\n    'partial',\n    'exhaust'\n];\n/** Extract the actual command from the query, possibly up-converting if it's a legacy format */\nfunction extractCommand(command) {\n    if (command instanceof commands_1.Msg) {\n        return (0, utils_1.deepCopy)(command.command);\n    }\n    if (command.query?.$query) {\n        let result;\n        if (command.ns === 'admin.$cmd') {\n            // up-convert legacy command\n            result = Object.assign({}, command.query.$query);\n        }\n        else {\n            // up-convert legacy find command\n            result = { find: collectionName(command) };\n            Object.keys(LEGACY_FIND_QUERY_MAP).forEach(key => {\n                if (command.query[key] != null) {\n                    result[LEGACY_FIND_QUERY_MAP[key]] = (0, utils_1.deepCopy)(command.query[key]);\n                }\n            });\n        }\n        Object.keys(LEGACY_FIND_OPTIONS_MAP).forEach(key => {\n            const legacyKey = key;\n            if (command[legacyKey] != null) {\n                result[LEGACY_FIND_OPTIONS_MAP[legacyKey]] = (0, utils_1.deepCopy)(command[legacyKey]);\n            }\n        });\n        OP_QUERY_KEYS.forEach(key => {\n            if (command[key]) {\n                result[key] = command[key];\n            }\n        });\n        if (command.pre32Limit != null) {\n            result.limit = command.pre32Limit;\n        }\n        if (command.query.$explain) {\n            return { explain: result };\n        }\n        return result;\n    }\n    const clonedQuery = {};\n    const clonedCommand = {};\n    if (command.query) {\n        for (const k in command.query) {\n            clonedQuery[k] = (0, utils_1.deepCopy)(command.query[k]);\n        }\n        clonedCommand.query = clonedQuery;\n    }\n    for (const k in command) {\n        if (k === 'query')\n            continue;\n        clonedCommand[k] = (0, utils_1.deepCopy)(command[k]);\n    }\n    return command.query ? clonedQuery : clonedCommand;\n}\nfunction extractReply(command, reply) {\n    if (!reply) {\n        return reply;\n    }\n    if (command instanceof commands_1.Msg) {\n        return (0, utils_1.deepCopy)(reply.result ? reply.result : reply);\n    }\n    // is this a legacy find command?\n    if (command.query && command.query.$query != null) {\n        return {\n            ok: 1,\n            cursor: {\n                id: (0, utils_1.deepCopy)(reply.cursorId),\n                ns: namespace(command),\n                firstBatch: (0, utils_1.deepCopy)(reply.documents)\n            }\n        };\n    }\n    return (0, utils_1.deepCopy)(reply.result ? reply.result : reply);\n}\nfunction extractConnectionDetails(connection) {\n    let connectionId;\n    if ('id' in connection) {\n        connectionId = connection.id;\n    }\n    return {\n        address: connection.address,\n        serviceId: connection.serviceId,\n        connectionId\n    };\n}\n//# sourceMappingURL=command_monitoring_events.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jbWFwL2NvbW1hbmRfbW9uaXRvcmluZ19ldmVudHMuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsMEJBQTBCLEdBQUcsMEJBQTBCLEdBQUcsNkJBQTZCLEdBQUcsMkJBQTJCO0FBQ3JILG9CQUFvQixtQkFBTyxDQUFDLDJFQUFjO0FBQzFDLGdCQUFnQixtQkFBTyxDQUFDLG1FQUFVO0FBQ2xDLG1CQUFtQixtQkFBTyxDQUFDLDZFQUFZO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixtQ0FBbUM7QUFDbkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsbUNBQW1DO0FBQ25EO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsbUNBQW1DO0FBQ25EO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUNBQXFDO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QjtBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsiRDpcXHNhbG9uaVxcYXBwcmFpc2FsLXN5c3RlbVxcc2VydmVyXFxub2RlX21vZHVsZXNcXG1vbmdvZGJcXGxpYlxcY21hcFxcY29tbWFuZF9tb25pdG9yaW5nX2V2ZW50cy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuU0VOU0lUSVZFX0NPTU1BTkRTID0gZXhwb3J0cy5Db21tYW5kRmFpbGVkRXZlbnQgPSBleHBvcnRzLkNvbW1hbmRTdWNjZWVkZWRFdmVudCA9IGV4cG9ydHMuQ29tbWFuZFN0YXJ0ZWRFdmVudCA9IHZvaWQgMDtcbmNvbnN0IGNvbnN0YW50c18xID0gcmVxdWlyZShcIi4uL2NvbnN0YW50c1wiKTtcbmNvbnN0IHV0aWxzXzEgPSByZXF1aXJlKFwiLi4vdXRpbHNcIik7XG5jb25zdCBjb21tYW5kc18xID0gcmVxdWlyZShcIi4vY29tbWFuZHNcIik7XG4vKipcbiAqIEFuIGV2ZW50IGluZGljYXRpbmcgdGhlIHN0YXJ0IG9mIGEgZ2l2ZW4gY29tbWFuZFxuICogQHB1YmxpY1xuICogQGNhdGVnb3J5IEV2ZW50XG4gKi9cbmNsYXNzIENvbW1hbmRTdGFydGVkRXZlbnQge1xuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIHN0YXJ0ZWQgZXZlbnRcbiAgICAgKlxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqIEBwYXJhbSBwb29sIC0gdGhlIHBvb2wgdGhhdCBvcmlnaW5hdGVkIHRoZSBjb21tYW5kXG4gICAgICogQHBhcmFtIGNvbW1hbmQgLSB0aGUgY29tbWFuZFxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGNvbm5lY3Rpb24sIGNvbW1hbmQpIHtcbiAgICAgICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgICAgICB0aGlzLm5hbWUgPSBjb25zdGFudHNfMS5DT01NQU5EX1NUQVJURUQ7XG4gICAgICAgIGNvbnN0IGNtZCA9IGV4dHJhY3RDb21tYW5kKGNvbW1hbmQpO1xuICAgICAgICBjb25zdCBjb21tYW5kTmFtZSA9IGV4dHJhY3RDb21tYW5kTmFtZShjbWQpO1xuICAgICAgICBjb25zdCB7IGFkZHJlc3MsIGNvbm5lY3Rpb25JZCwgc2VydmljZUlkIH0gPSBleHRyYWN0Q29ubmVjdGlvbkRldGFpbHMoY29ubmVjdGlvbik7XG4gICAgICAgIC8vIFRPRE86IHJlbW92ZSBpbiBtYWpvciByZXZpc2lvbiwgdGhpcyBpcyBub3Qgc3BlYyBiZWhhdmlvclxuICAgICAgICBpZiAoZXhwb3J0cy5TRU5TSVRJVkVfQ09NTUFORFMuaGFzKGNvbW1hbmROYW1lKSkge1xuICAgICAgICAgICAgdGhpcy5jb21tYW5kT2JqID0ge307XG4gICAgICAgICAgICB0aGlzLmNvbW1hbmRPYmpbY29tbWFuZE5hbWVdID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmFkZHJlc3MgPSBhZGRyZXNzO1xuICAgICAgICB0aGlzLmNvbm5lY3Rpb25JZCA9IGNvbm5lY3Rpb25JZDtcbiAgICAgICAgdGhpcy5zZXJ2aWNlSWQgPSBzZXJ2aWNlSWQ7XG4gICAgICAgIHRoaXMucmVxdWVzdElkID0gY29tbWFuZC5yZXF1ZXN0SWQ7XG4gICAgICAgIHRoaXMuZGF0YWJhc2VOYW1lID0gZGF0YWJhc2VOYW1lKGNvbW1hbmQpO1xuICAgICAgICB0aGlzLmNvbW1hbmROYW1lID0gY29tbWFuZE5hbWU7XG4gICAgICAgIHRoaXMuY29tbWFuZCA9IG1heWJlUmVkYWN0KGNvbW1hbmROYW1lLCBjbWQsIGNtZCk7XG4gICAgfVxuICAgIC8qIEBpbnRlcm5hbCAqL1xuICAgIGdldCBoYXNTZXJ2aWNlSWQoKSB7XG4gICAgICAgIHJldHVybiAhIXRoaXMuc2VydmljZUlkO1xuICAgIH1cbn1cbmV4cG9ydHMuQ29tbWFuZFN0YXJ0ZWRFdmVudCA9IENvbW1hbmRTdGFydGVkRXZlbnQ7XG4vKipcbiAqIEFuIGV2ZW50IGluZGljYXRpbmcgdGhlIHN1Y2Nlc3Mgb2YgYSBnaXZlbiBjb21tYW5kXG4gKiBAcHVibGljXG4gKiBAY2F0ZWdvcnkgRXZlbnRcbiAqL1xuY2xhc3MgQ29tbWFuZFN1Y2NlZWRlZEV2ZW50IHtcbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBzdWNjZWVkZWQgZXZlbnRcbiAgICAgKlxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqIEBwYXJhbSBwb29sIC0gdGhlIHBvb2wgdGhhdCBvcmlnaW5hdGVkIHRoZSBjb21tYW5kXG4gICAgICogQHBhcmFtIGNvbW1hbmQgLSB0aGUgY29tbWFuZFxuICAgICAqIEBwYXJhbSByZXBseSAtIHRoZSByZXBseSBmb3IgdGhpcyBjb21tYW5kIGZyb20gdGhlIHNlcnZlclxuICAgICAqIEBwYXJhbSBzdGFydGVkIC0gYSBoaWdoIHJlc29sdXRpb24gdHVwbGUgdGltZXN0YW1wIG9mIHdoZW4gdGhlIGNvbW1hbmQgd2FzIGZpcnN0IHNlbnQsIHRvIGNhbGN1bGF0ZSBkdXJhdGlvblxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGNvbm5lY3Rpb24sIGNvbW1hbmQsIHJlcGx5LCBzdGFydGVkKSB7XG4gICAgICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICAgICAgdGhpcy5uYW1lID0gY29uc3RhbnRzXzEuQ09NTUFORF9TVUNDRUVERUQ7XG4gICAgICAgIGNvbnN0IGNtZCA9IGV4dHJhY3RDb21tYW5kKGNvbW1hbmQpO1xuICAgICAgICBjb25zdCBjb21tYW5kTmFtZSA9IGV4dHJhY3RDb21tYW5kTmFtZShjbWQpO1xuICAgICAgICBjb25zdCB7IGFkZHJlc3MsIGNvbm5lY3Rpb25JZCwgc2VydmljZUlkIH0gPSBleHRyYWN0Q29ubmVjdGlvbkRldGFpbHMoY29ubmVjdGlvbik7XG4gICAgICAgIHRoaXMuYWRkcmVzcyA9IGFkZHJlc3M7XG4gICAgICAgIHRoaXMuY29ubmVjdGlvbklkID0gY29ubmVjdGlvbklkO1xuICAgICAgICB0aGlzLnNlcnZpY2VJZCA9IHNlcnZpY2VJZDtcbiAgICAgICAgdGhpcy5yZXF1ZXN0SWQgPSBjb21tYW5kLnJlcXVlc3RJZDtcbiAgICAgICAgdGhpcy5jb21tYW5kTmFtZSA9IGNvbW1hbmROYW1lO1xuICAgICAgICB0aGlzLmR1cmF0aW9uID0gKDAsIHV0aWxzXzEuY2FsY3VsYXRlRHVyYXRpb25Jbk1zKShzdGFydGVkKTtcbiAgICAgICAgdGhpcy5yZXBseSA9IG1heWJlUmVkYWN0KGNvbW1hbmROYW1lLCBjbWQsIGV4dHJhY3RSZXBseShjb21tYW5kLCByZXBseSkpO1xuICAgIH1cbiAgICAvKiBAaW50ZXJuYWwgKi9cbiAgICBnZXQgaGFzU2VydmljZUlkKCkge1xuICAgICAgICByZXR1cm4gISF0aGlzLnNlcnZpY2VJZDtcbiAgICB9XG59XG5leHBvcnRzLkNvbW1hbmRTdWNjZWVkZWRFdmVudCA9IENvbW1hbmRTdWNjZWVkZWRFdmVudDtcbi8qKlxuICogQW4gZXZlbnQgaW5kaWNhdGluZyB0aGUgZmFpbHVyZSBvZiBhIGdpdmVuIGNvbW1hbmRcbiAqIEBwdWJsaWNcbiAqIEBjYXRlZ29yeSBFdmVudFxuICovXG5jbGFzcyBDb21tYW5kRmFpbGVkRXZlbnQge1xuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIGZhaWx1cmUgZXZlbnRcbiAgICAgKlxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqIEBwYXJhbSBwb29sIC0gdGhlIHBvb2wgdGhhdCBvcmlnaW5hdGVkIHRoZSBjb21tYW5kXG4gICAgICogQHBhcmFtIGNvbW1hbmQgLSB0aGUgY29tbWFuZFxuICAgICAqIEBwYXJhbSBlcnJvciAtIHRoZSBnZW5lcmF0ZWQgZXJyb3Igb3IgYSBzZXJ2ZXIgZXJyb3IgcmVzcG9uc2VcbiAgICAgKiBAcGFyYW0gc3RhcnRlZCAtIGEgaGlnaCByZXNvbHV0aW9uIHR1cGxlIHRpbWVzdGFtcCBvZiB3aGVuIHRoZSBjb21tYW5kIHdhcyBmaXJzdCBzZW50LCB0byBjYWxjdWxhdGUgZHVyYXRpb25cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3Rvcihjb25uZWN0aW9uLCBjb21tYW5kLCBlcnJvciwgc3RhcnRlZCkge1xuICAgICAgICAvKiogQGludGVybmFsICovXG4gICAgICAgIHRoaXMubmFtZSA9IGNvbnN0YW50c18xLkNPTU1BTkRfRkFJTEVEO1xuICAgICAgICBjb25zdCBjbWQgPSBleHRyYWN0Q29tbWFuZChjb21tYW5kKTtcbiAgICAgICAgY29uc3QgY29tbWFuZE5hbWUgPSBleHRyYWN0Q29tbWFuZE5hbWUoY21kKTtcbiAgICAgICAgY29uc3QgeyBhZGRyZXNzLCBjb25uZWN0aW9uSWQsIHNlcnZpY2VJZCB9ID0gZXh0cmFjdENvbm5lY3Rpb25EZXRhaWxzKGNvbm5lY3Rpb24pO1xuICAgICAgICB0aGlzLmFkZHJlc3MgPSBhZGRyZXNzO1xuICAgICAgICB0aGlzLmNvbm5lY3Rpb25JZCA9IGNvbm5lY3Rpb25JZDtcbiAgICAgICAgdGhpcy5zZXJ2aWNlSWQgPSBzZXJ2aWNlSWQ7XG4gICAgICAgIHRoaXMucmVxdWVzdElkID0gY29tbWFuZC5yZXF1ZXN0SWQ7XG4gICAgICAgIHRoaXMuY29tbWFuZE5hbWUgPSBjb21tYW5kTmFtZTtcbiAgICAgICAgdGhpcy5kdXJhdGlvbiA9ICgwLCB1dGlsc18xLmNhbGN1bGF0ZUR1cmF0aW9uSW5Ncykoc3RhcnRlZCk7XG4gICAgICAgIHRoaXMuZmFpbHVyZSA9IG1heWJlUmVkYWN0KGNvbW1hbmROYW1lLCBjbWQsIGVycm9yKTtcbiAgICB9XG4gICAgLyogQGludGVybmFsICovXG4gICAgZ2V0IGhhc1NlcnZpY2VJZCgpIHtcbiAgICAgICAgcmV0dXJuICEhdGhpcy5zZXJ2aWNlSWQ7XG4gICAgfVxufVxuZXhwb3J0cy5Db21tYW5kRmFpbGVkRXZlbnQgPSBDb21tYW5kRmFpbGVkRXZlbnQ7XG4vKipcbiAqIENvbW1hbmRzIHRoYXQgd2Ugd2FudCB0byByZWRhY3QgYmVjYXVzZSBvZiB0aGUgc2Vuc2l0aXZlIG5hdHVyZSBvZiB0aGVpciBjb250ZW50c1xuICogQGludGVybmFsXG4gKi9cbmV4cG9ydHMuU0VOU0lUSVZFX0NPTU1BTkRTID0gbmV3IFNldChbXG4gICAgJ2F1dGhlbnRpY2F0ZScsXG4gICAgJ3Nhc2xTdGFydCcsXG4gICAgJ3Nhc2xDb250aW51ZScsXG4gICAgJ2dldG5vbmNlJyxcbiAgICAnY3JlYXRlVXNlcicsXG4gICAgJ3VwZGF0ZVVzZXInLFxuICAgICdjb3B5ZGJnZXRub25jZScsXG4gICAgJ2NvcHlkYnNhc2xzdGFydCcsXG4gICAgJ2NvcHlkYidcbl0pO1xuY29uc3QgSEVMTE9fQ09NTUFORFMgPSBuZXcgU2V0KFsnaGVsbG8nLCBjb25zdGFudHNfMS5MRUdBQ1lfSEVMTE9fQ09NTUFORCwgY29uc3RhbnRzXzEuTEVHQUNZX0hFTExPX0NPTU1BTkRfQ0FNRUxfQ0FTRV0pO1xuLy8gaGVscGVyIG1ldGhvZHNcbmNvbnN0IGV4dHJhY3RDb21tYW5kTmFtZSA9IChjb21tYW5kRG9jKSA9PiBPYmplY3Qua2V5cyhjb21tYW5kRG9jKVswXTtcbmNvbnN0IG5hbWVzcGFjZSA9IChjb21tYW5kKSA9PiBjb21tYW5kLm5zO1xuY29uc3QgZGF0YWJhc2VOYW1lID0gKGNvbW1hbmQpID0+IGNvbW1hbmQubnMuc3BsaXQoJy4nKVswXTtcbmNvbnN0IGNvbGxlY3Rpb25OYW1lID0gKGNvbW1hbmQpID0+IGNvbW1hbmQubnMuc3BsaXQoJy4nKVsxXTtcbmNvbnN0IG1heWJlUmVkYWN0ID0gKGNvbW1hbmROYW1lLCBjb21tYW5kRG9jLCByZXN1bHQpID0+IGV4cG9ydHMuU0VOU0lUSVZFX0NPTU1BTkRTLmhhcyhjb21tYW5kTmFtZSkgfHxcbiAgICAoSEVMTE9fQ09NTUFORFMuaGFzKGNvbW1hbmROYW1lKSAmJiBjb21tYW5kRG9jLnNwZWN1bGF0aXZlQXV0aGVudGljYXRlKVxuICAgID8ge31cbiAgICA6IHJlc3VsdDtcbmNvbnN0IExFR0FDWV9GSU5EX1FVRVJZX01BUCA9IHtcbiAgICAkcXVlcnk6ICdmaWx0ZXInLFxuICAgICRvcmRlcmJ5OiAnc29ydCcsXG4gICAgJGhpbnQ6ICdoaW50JyxcbiAgICAkY29tbWVudDogJ2NvbW1lbnQnLFxuICAgICRtYXhTY2FuOiAnbWF4U2NhbicsXG4gICAgJG1heDogJ21heCcsXG4gICAgJG1pbjogJ21pbicsXG4gICAgJHJldHVybktleTogJ3JldHVybktleScsXG4gICAgJHNob3dEaXNrTG9jOiAnc2hvd1JlY29yZElkJyxcbiAgICAkbWF4VGltZU1TOiAnbWF4VGltZU1TJyxcbiAgICAkc25hcHNob3Q6ICdzbmFwc2hvdCdcbn07XG5jb25zdCBMRUdBQ1lfRklORF9PUFRJT05TX01BUCA9IHtcbiAgICBudW1iZXJUb1NraXA6ICdza2lwJyxcbiAgICBudW1iZXJUb1JldHVybjogJ2JhdGNoU2l6ZScsXG4gICAgcmV0dXJuRmllbGRTZWxlY3RvcjogJ3Byb2plY3Rpb24nXG59O1xuY29uc3QgT1BfUVVFUllfS0VZUyA9IFtcbiAgICAndGFpbGFibGUnLFxuICAgICdvcGxvZ1JlcGxheScsXG4gICAgJ25vQ3Vyc29yVGltZW91dCcsXG4gICAgJ2F3YWl0RGF0YScsXG4gICAgJ3BhcnRpYWwnLFxuICAgICdleGhhdXN0J1xuXTtcbi8qKiBFeHRyYWN0IHRoZSBhY3R1YWwgY29tbWFuZCBmcm9tIHRoZSBxdWVyeSwgcG9zc2libHkgdXAtY29udmVydGluZyBpZiBpdCdzIGEgbGVnYWN5IGZvcm1hdCAqL1xuZnVuY3Rpb24gZXh0cmFjdENvbW1hbmQoY29tbWFuZCkge1xuICAgIGlmIChjb21tYW5kIGluc3RhbmNlb2YgY29tbWFuZHNfMS5Nc2cpIHtcbiAgICAgICAgcmV0dXJuICgwLCB1dGlsc18xLmRlZXBDb3B5KShjb21tYW5kLmNvbW1hbmQpO1xuICAgIH1cbiAgICBpZiAoY29tbWFuZC5xdWVyeT8uJHF1ZXJ5KSB7XG4gICAgICAgIGxldCByZXN1bHQ7XG4gICAgICAgIGlmIChjb21tYW5kLm5zID09PSAnYWRtaW4uJGNtZCcpIHtcbiAgICAgICAgICAgIC8vIHVwLWNvbnZlcnQgbGVnYWN5IGNvbW1hbmRcbiAgICAgICAgICAgIHJlc3VsdCA9IE9iamVjdC5hc3NpZ24oe30sIGNvbW1hbmQucXVlcnkuJHF1ZXJ5KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIC8vIHVwLWNvbnZlcnQgbGVnYWN5IGZpbmQgY29tbWFuZFxuICAgICAgICAgICAgcmVzdWx0ID0geyBmaW5kOiBjb2xsZWN0aW9uTmFtZShjb21tYW5kKSB9O1xuICAgICAgICAgICAgT2JqZWN0LmtleXMoTEVHQUNZX0ZJTkRfUVVFUllfTUFQKS5mb3JFYWNoKGtleSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGNvbW1hbmQucXVlcnlba2V5XSAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdFtMRUdBQ1lfRklORF9RVUVSWV9NQVBba2V5XV0gPSAoMCwgdXRpbHNfMS5kZWVwQ29weSkoY29tbWFuZC5xdWVyeVtrZXldKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBPYmplY3Qua2V5cyhMRUdBQ1lfRklORF9PUFRJT05TX01BUCkuZm9yRWFjaChrZXkgPT4ge1xuICAgICAgICAgICAgY29uc3QgbGVnYWN5S2V5ID0ga2V5O1xuICAgICAgICAgICAgaWYgKGNvbW1hbmRbbGVnYWN5S2V5XSAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0W0xFR0FDWV9GSU5EX09QVElPTlNfTUFQW2xlZ2FjeUtleV1dID0gKDAsIHV0aWxzXzEuZGVlcENvcHkpKGNvbW1hbmRbbGVnYWN5S2V5XSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBPUF9RVUVSWV9LRVlTLmZvckVhY2goa2V5ID0+IHtcbiAgICAgICAgICAgIGlmIChjb21tYW5kW2tleV0pIHtcbiAgICAgICAgICAgICAgICByZXN1bHRba2V5XSA9IGNvbW1hbmRba2V5XTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChjb21tYW5kLnByZTMyTGltaXQgIT0gbnVsbCkge1xuICAgICAgICAgICAgcmVzdWx0LmxpbWl0ID0gY29tbWFuZC5wcmUzMkxpbWl0O1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb21tYW5kLnF1ZXJ5LiRleHBsYWluKSB7XG4gICAgICAgICAgICByZXR1cm4geyBleHBsYWluOiByZXN1bHQgfTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cbiAgICBjb25zdCBjbG9uZWRRdWVyeSA9IHt9O1xuICAgIGNvbnN0IGNsb25lZENvbW1hbmQgPSB7fTtcbiAgICBpZiAoY29tbWFuZC5xdWVyeSkge1xuICAgICAgICBmb3IgKGNvbnN0IGsgaW4gY29tbWFuZC5xdWVyeSkge1xuICAgICAgICAgICAgY2xvbmVkUXVlcnlba10gPSAoMCwgdXRpbHNfMS5kZWVwQ29weSkoY29tbWFuZC5xdWVyeVtrXSk7XG4gICAgICAgIH1cbiAgICAgICAgY2xvbmVkQ29tbWFuZC5xdWVyeSA9IGNsb25lZFF1ZXJ5O1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IGsgaW4gY29tbWFuZCkge1xuICAgICAgICBpZiAoayA9PT0gJ3F1ZXJ5JylcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICBjbG9uZWRDb21tYW5kW2tdID0gKDAsIHV0aWxzXzEuZGVlcENvcHkpKGNvbW1hbmRba10pO1xuICAgIH1cbiAgICByZXR1cm4gY29tbWFuZC5xdWVyeSA/IGNsb25lZFF1ZXJ5IDogY2xvbmVkQ29tbWFuZDtcbn1cbmZ1bmN0aW9uIGV4dHJhY3RSZXBseShjb21tYW5kLCByZXBseSkge1xuICAgIGlmICghcmVwbHkpIHtcbiAgICAgICAgcmV0dXJuIHJlcGx5O1xuICAgIH1cbiAgICBpZiAoY29tbWFuZCBpbnN0YW5jZW9mIGNvbW1hbmRzXzEuTXNnKSB7XG4gICAgICAgIHJldHVybiAoMCwgdXRpbHNfMS5kZWVwQ29weSkocmVwbHkucmVzdWx0ID8gcmVwbHkucmVzdWx0IDogcmVwbHkpO1xuICAgIH1cbiAgICAvLyBpcyB0aGlzIGEgbGVnYWN5IGZpbmQgY29tbWFuZD9cbiAgICBpZiAoY29tbWFuZC5xdWVyeSAmJiBjb21tYW5kLnF1ZXJ5LiRxdWVyeSAhPSBudWxsKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBvazogMSxcbiAgICAgICAgICAgIGN1cnNvcjoge1xuICAgICAgICAgICAgICAgIGlkOiAoMCwgdXRpbHNfMS5kZWVwQ29weSkocmVwbHkuY3Vyc29ySWQpLFxuICAgICAgICAgICAgICAgIG5zOiBuYW1lc3BhY2UoY29tbWFuZCksXG4gICAgICAgICAgICAgICAgZmlyc3RCYXRjaDogKDAsIHV0aWxzXzEuZGVlcENvcHkpKHJlcGx5LmRvY3VtZW50cylcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuICgwLCB1dGlsc18xLmRlZXBDb3B5KShyZXBseS5yZXN1bHQgPyByZXBseS5yZXN1bHQgOiByZXBseSk7XG59XG5mdW5jdGlvbiBleHRyYWN0Q29ubmVjdGlvbkRldGFpbHMoY29ubmVjdGlvbikge1xuICAgIGxldCBjb25uZWN0aW9uSWQ7XG4gICAgaWYgKCdpZCcgaW4gY29ubmVjdGlvbikge1xuICAgICAgICBjb25uZWN0aW9uSWQgPSBjb25uZWN0aW9uLmlkO1xuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgICBhZGRyZXNzOiBjb25uZWN0aW9uLmFkZHJlc3MsXG4gICAgICAgIHNlcnZpY2VJZDogY29ubmVjdGlvbi5zZXJ2aWNlSWQsXG4gICAgICAgIGNvbm5lY3Rpb25JZFxuICAgIH07XG59XG4vLyMgc291cmNlTWFwcGluZ1VSTD1jb21tYW5kX21vbml0b3JpbmdfZXZlbnRzLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/cmap/command_monitoring_events.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/cmap/commands.js":
/*!***********************************************************!*\
  !*** ../server/node_modules/mongodb/lib/cmap/commands.js ***!
  \***********************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.BinMsg = exports.Msg = exports.Response = exports.Query = void 0;\nconst BSON = __webpack_require__(/*! ../bson */ \"(api)/../server/node_modules/mongodb/lib/bson.js\");\nconst error_1 = __webpack_require__(/*! ../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst read_preference_1 = __webpack_require__(/*! ../read_preference */ \"(api)/../server/node_modules/mongodb/lib/read_preference.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\nconst constants_1 = __webpack_require__(/*! ./wire_protocol/constants */ \"(api)/../server/node_modules/mongodb/lib/cmap/wire_protocol/constants.js\");\n// Incrementing request id\nlet _requestId = 0;\n// Query flags\nconst OPTS_TAILABLE_CURSOR = 2;\nconst OPTS_SECONDARY = 4;\nconst OPTS_OPLOG_REPLAY = 8;\nconst OPTS_NO_CURSOR_TIMEOUT = 16;\nconst OPTS_AWAIT_DATA = 32;\nconst OPTS_EXHAUST = 64;\nconst OPTS_PARTIAL = 128;\n// Response flags\nconst CURSOR_NOT_FOUND = 1;\nconst QUERY_FAILURE = 2;\nconst SHARD_CONFIG_STALE = 4;\nconst AWAIT_CAPABLE = 8;\n/**************************************************************\n * QUERY\n **************************************************************/\n/** @internal */\nclass Query {\n    constructor(ns, query, options) {\n        // Basic options needed to be passed in\n        // TODO(NODE-3483): Replace with MongoCommandError\n        if (ns == null)\n            throw new error_1.MongoRuntimeError('Namespace must be specified for query');\n        // TODO(NODE-3483): Replace with MongoCommandError\n        if (query == null)\n            throw new error_1.MongoRuntimeError('A query document must be specified for query');\n        // Validate that we are not passing 0x00 in the collection name\n        if (ns.indexOf('\\x00') !== -1) {\n            // TODO(NODE-3483): Use MongoNamespace static method\n            throw new error_1.MongoRuntimeError('Namespace cannot contain a null character');\n        }\n        // Basic options\n        this.ns = ns;\n        this.query = query;\n        // Additional options\n        this.numberToSkip = options.numberToSkip || 0;\n        this.numberToReturn = options.numberToReturn || 0;\n        this.returnFieldSelector = options.returnFieldSelector || undefined;\n        this.requestId = Query.getRequestId();\n        // special case for pre-3.2 find commands, delete ASAP\n        this.pre32Limit = options.pre32Limit;\n        // Serialization option\n        this.serializeFunctions =\n            typeof options.serializeFunctions === 'boolean' ? options.serializeFunctions : false;\n        this.ignoreUndefined =\n            typeof options.ignoreUndefined === 'boolean' ? options.ignoreUndefined : false;\n        this.maxBsonSize = options.maxBsonSize || 1024 * 1024 * 16;\n        this.checkKeys = typeof options.checkKeys === 'boolean' ? options.checkKeys : false;\n        this.batchSize = this.numberToReturn;\n        // Flags\n        this.tailable = false;\n        this.secondaryOk = typeof options.secondaryOk === 'boolean' ? options.secondaryOk : false;\n        this.oplogReplay = false;\n        this.noCursorTimeout = false;\n        this.awaitData = false;\n        this.exhaust = false;\n        this.partial = false;\n    }\n    /** Assign next request Id. */\n    incRequestId() {\n        this.requestId = _requestId++;\n    }\n    /** Peek next request Id. */\n    nextRequestId() {\n        return _requestId + 1;\n    }\n    /** Increment then return next request Id. */\n    static getRequestId() {\n        return ++_requestId;\n    }\n    // Uses a single allocated buffer for the process, avoiding multiple memory allocations\n    toBin() {\n        const buffers = [];\n        let projection = null;\n        // Set up the flags\n        let flags = 0;\n        if (this.tailable) {\n            flags |= OPTS_TAILABLE_CURSOR;\n        }\n        if (this.secondaryOk) {\n            flags |= OPTS_SECONDARY;\n        }\n        if (this.oplogReplay) {\n            flags |= OPTS_OPLOG_REPLAY;\n        }\n        if (this.noCursorTimeout) {\n            flags |= OPTS_NO_CURSOR_TIMEOUT;\n        }\n        if (this.awaitData) {\n            flags |= OPTS_AWAIT_DATA;\n        }\n        if (this.exhaust) {\n            flags |= OPTS_EXHAUST;\n        }\n        if (this.partial) {\n            flags |= OPTS_PARTIAL;\n        }\n        // If batchSize is different to this.numberToReturn\n        if (this.batchSize !== this.numberToReturn)\n            this.numberToReturn = this.batchSize;\n        // Allocate write protocol header buffer\n        const header = Buffer.alloc(4 * 4 + // Header\n            4 + // Flags\n            Buffer.byteLength(this.ns) +\n            1 + // namespace\n            4 + // numberToSkip\n            4 // numberToReturn\n        );\n        // Add header to buffers\n        buffers.push(header);\n        // Serialize the query\n        const query = BSON.serialize(this.query, {\n            checkKeys: this.checkKeys,\n            serializeFunctions: this.serializeFunctions,\n            ignoreUndefined: this.ignoreUndefined\n        });\n        // Add query document\n        buffers.push(query);\n        if (this.returnFieldSelector && Object.keys(this.returnFieldSelector).length > 0) {\n            // Serialize the projection document\n            projection = BSON.serialize(this.returnFieldSelector, {\n                checkKeys: this.checkKeys,\n                serializeFunctions: this.serializeFunctions,\n                ignoreUndefined: this.ignoreUndefined\n            });\n            // Add projection document\n            buffers.push(projection);\n        }\n        // Total message size\n        const totalLength = header.length + query.length + (projection ? projection.length : 0);\n        // Set up the index\n        let index = 4;\n        // Write total document length\n        header[3] = (totalLength >> 24) & 0xff;\n        header[2] = (totalLength >> 16) & 0xff;\n        header[1] = (totalLength >> 8) & 0xff;\n        header[0] = totalLength & 0xff;\n        // Write header information requestId\n        header[index + 3] = (this.requestId >> 24) & 0xff;\n        header[index + 2] = (this.requestId >> 16) & 0xff;\n        header[index + 1] = (this.requestId >> 8) & 0xff;\n        header[index] = this.requestId & 0xff;\n        index = index + 4;\n        // Write header information responseTo\n        header[index + 3] = (0 >> 24) & 0xff;\n        header[index + 2] = (0 >> 16) & 0xff;\n        header[index + 1] = (0 >> 8) & 0xff;\n        header[index] = 0 & 0xff;\n        index = index + 4;\n        // Write header information OP_QUERY\n        header[index + 3] = (constants_1.OP_QUERY >> 24) & 0xff;\n        header[index + 2] = (constants_1.OP_QUERY >> 16) & 0xff;\n        header[index + 1] = (constants_1.OP_QUERY >> 8) & 0xff;\n        header[index] = constants_1.OP_QUERY & 0xff;\n        index = index + 4;\n        // Write header information flags\n        header[index + 3] = (flags >> 24) & 0xff;\n        header[index + 2] = (flags >> 16) & 0xff;\n        header[index + 1] = (flags >> 8) & 0xff;\n        header[index] = flags & 0xff;\n        index = index + 4;\n        // Write collection name\n        index = index + header.write(this.ns, index, 'utf8') + 1;\n        header[index - 1] = 0;\n        // Write header information flags numberToSkip\n        header[index + 3] = (this.numberToSkip >> 24) & 0xff;\n        header[index + 2] = (this.numberToSkip >> 16) & 0xff;\n        header[index + 1] = (this.numberToSkip >> 8) & 0xff;\n        header[index] = this.numberToSkip & 0xff;\n        index = index + 4;\n        // Write header information flags numberToReturn\n        header[index + 3] = (this.numberToReturn >> 24) & 0xff;\n        header[index + 2] = (this.numberToReturn >> 16) & 0xff;\n        header[index + 1] = (this.numberToReturn >> 8) & 0xff;\n        header[index] = this.numberToReturn & 0xff;\n        index = index + 4;\n        // Return the buffers\n        return buffers;\n    }\n}\nexports.Query = Query;\n/** @internal */\nclass Response {\n    constructor(message, msgHeader, msgBody, opts) {\n        this.documents = new Array(0);\n        this.parsed = false;\n        this.raw = message;\n        this.data = msgBody;\n        this.opts = opts ?? {\n            useBigInt64: false,\n            promoteLongs: true,\n            promoteValues: true,\n            promoteBuffers: false,\n            bsonRegExp: false\n        };\n        // Read the message header\n        this.length = msgHeader.length;\n        this.requestId = msgHeader.requestId;\n        this.responseTo = msgHeader.responseTo;\n        this.opCode = msgHeader.opCode;\n        this.fromCompressed = msgHeader.fromCompressed;\n        // Flag values\n        this.useBigInt64 = typeof this.opts.useBigInt64 === 'boolean' ? this.opts.useBigInt64 : false;\n        this.promoteLongs = typeof this.opts.promoteLongs === 'boolean' ? this.opts.promoteLongs : true;\n        this.promoteValues =\n            typeof this.opts.promoteValues === 'boolean' ? this.opts.promoteValues : true;\n        this.promoteBuffers =\n            typeof this.opts.promoteBuffers === 'boolean' ? this.opts.promoteBuffers : false;\n        this.bsonRegExp = typeof this.opts.bsonRegExp === 'boolean' ? this.opts.bsonRegExp : false;\n    }\n    isParsed() {\n        return this.parsed;\n    }\n    parse(options) {\n        // Don't parse again if not needed\n        if (this.parsed)\n            return;\n        options = options ?? {};\n        // Allow the return of raw documents instead of parsing\n        const raw = options.raw || false;\n        const documentsReturnedIn = options.documentsReturnedIn || null;\n        const useBigInt64 = options.useBigInt64 ?? this.opts.useBigInt64;\n        const promoteLongs = options.promoteLongs ?? this.opts.promoteLongs;\n        const promoteValues = options.promoteValues ?? this.opts.promoteValues;\n        const promoteBuffers = options.promoteBuffers ?? this.opts.promoteBuffers;\n        const bsonRegExp = options.bsonRegExp ?? this.opts.bsonRegExp;\n        let bsonSize;\n        // Set up the options\n        const _options = {\n            useBigInt64,\n            promoteLongs,\n            promoteValues,\n            promoteBuffers,\n            bsonRegExp\n        };\n        // Position within OP_REPLY at which documents start\n        // (See https://www.mongodb.com/docs/manual/reference/mongodb-wire-protocol/#wire-op-reply)\n        this.index = 20;\n        // Read the message body\n        this.responseFlags = this.data.readInt32LE(0);\n        this.cursorId = new BSON.Long(this.data.readInt32LE(4), this.data.readInt32LE(8));\n        this.startingFrom = this.data.readInt32LE(12);\n        this.numberReturned = this.data.readInt32LE(16);\n        // Preallocate document array\n        this.documents = new Array(this.numberReturned);\n        this.cursorNotFound = (this.responseFlags & CURSOR_NOT_FOUND) !== 0;\n        this.queryFailure = (this.responseFlags & QUERY_FAILURE) !== 0;\n        this.shardConfigStale = (this.responseFlags & SHARD_CONFIG_STALE) !== 0;\n        this.awaitCapable = (this.responseFlags & AWAIT_CAPABLE) !== 0;\n        // Parse Body\n        for (let i = 0; i < this.numberReturned; i++) {\n            bsonSize =\n                this.data[this.index] |\n                    (this.data[this.index + 1] << 8) |\n                    (this.data[this.index + 2] << 16) |\n                    (this.data[this.index + 3] << 24);\n            // If we have raw results specified slice the return document\n            if (raw) {\n                this.documents[i] = this.data.slice(this.index, this.index + bsonSize);\n            }\n            else {\n                this.documents[i] = BSON.deserialize(this.data.slice(this.index, this.index + bsonSize), _options);\n            }\n            // Adjust the index\n            this.index = this.index + bsonSize;\n        }\n        if (this.documents.length === 1 && documentsReturnedIn != null && raw) {\n            const fieldsAsRaw = {};\n            fieldsAsRaw[documentsReturnedIn] = true;\n            _options.fieldsAsRaw = fieldsAsRaw;\n            const doc = BSON.deserialize(this.documents[0], _options);\n            this.documents = [doc];\n        }\n        // Set parsed\n        this.parsed = true;\n    }\n}\nexports.Response = Response;\n// Implementation of OP_MSG spec:\n// https://github.com/mongodb/specifications/blob/master/source/message/OP_MSG.rst\n//\n// struct Section {\n//   uint8 payloadType;\n//   union payload {\n//       document  document; // payloadType == 0\n//       struct sequence { // payloadType == 1\n//           int32      size;\n//           cstring    identifier;\n//           document*  documents;\n//       };\n//   };\n// };\n// struct OP_MSG {\n//   struct MsgHeader {\n//       int32  messageLength;\n//       int32  requestID;\n//       int32  responseTo;\n//       int32  opCode = 2013;\n//   };\n//   uint32      flagBits;\n//   Section+    sections;\n//   [uint32     checksum;]\n// };\n// Msg Flags\nconst OPTS_CHECKSUM_PRESENT = 1;\nconst OPTS_MORE_TO_COME = 2;\nconst OPTS_EXHAUST_ALLOWED = 1 << 16;\n/** @internal */\nclass Msg {\n    constructor(ns, command, options) {\n        // Basic options needed to be passed in\n        if (command == null)\n            throw new error_1.MongoInvalidArgumentError('Query document must be specified for query');\n        // Basic options\n        this.ns = ns;\n        this.command = command;\n        this.command.$db = (0, utils_1.databaseNamespace)(ns);\n        if (options.readPreference && options.readPreference.mode !== read_preference_1.ReadPreference.PRIMARY) {\n            this.command.$readPreference = options.readPreference.toJSON();\n        }\n        // Ensure empty options\n        this.options = options ?? {};\n        // Additional options\n        this.requestId = options.requestId ? options.requestId : Msg.getRequestId();\n        // Serialization option\n        this.serializeFunctions =\n            typeof options.serializeFunctions === 'boolean' ? options.serializeFunctions : false;\n        this.ignoreUndefined =\n            typeof options.ignoreUndefined === 'boolean' ? options.ignoreUndefined : false;\n        this.checkKeys = typeof options.checkKeys === 'boolean' ? options.checkKeys : false;\n        this.maxBsonSize = options.maxBsonSize || 1024 * 1024 * 16;\n        // flags\n        this.checksumPresent = false;\n        this.moreToCome = options.moreToCome || false;\n        this.exhaustAllowed =\n            typeof options.exhaustAllowed === 'boolean' ? options.exhaustAllowed : false;\n    }\n    toBin() {\n        const buffers = [];\n        let flags = 0;\n        if (this.checksumPresent) {\n            flags |= OPTS_CHECKSUM_PRESENT;\n        }\n        if (this.moreToCome) {\n            flags |= OPTS_MORE_TO_COME;\n        }\n        if (this.exhaustAllowed) {\n            flags |= OPTS_EXHAUST_ALLOWED;\n        }\n        const header = Buffer.alloc(4 * 4 + // Header\n            4 // Flags\n        );\n        buffers.push(header);\n        let totalLength = header.length;\n        const command = this.command;\n        totalLength += this.makeDocumentSegment(buffers, command);\n        header.writeInt32LE(totalLength, 0); // messageLength\n        header.writeInt32LE(this.requestId, 4); // requestID\n        header.writeInt32LE(0, 8); // responseTo\n        header.writeInt32LE(constants_1.OP_MSG, 12); // opCode\n        header.writeUInt32LE(flags, 16); // flags\n        return buffers;\n    }\n    makeDocumentSegment(buffers, document) {\n        const payloadTypeBuffer = Buffer.alloc(1);\n        payloadTypeBuffer[0] = 0;\n        const documentBuffer = this.serializeBson(document);\n        buffers.push(payloadTypeBuffer);\n        buffers.push(documentBuffer);\n        return payloadTypeBuffer.length + documentBuffer.length;\n    }\n    serializeBson(document) {\n        return BSON.serialize(document, {\n            checkKeys: this.checkKeys,\n            serializeFunctions: this.serializeFunctions,\n            ignoreUndefined: this.ignoreUndefined\n        });\n    }\n    static getRequestId() {\n        _requestId = (_requestId + 1) & 0x7fffffff;\n        return _requestId;\n    }\n}\nexports.Msg = Msg;\n/** @internal */\nclass BinMsg {\n    constructor(message, msgHeader, msgBody, opts) {\n        this.parsed = false;\n        this.raw = message;\n        this.data = msgBody;\n        this.opts = opts ?? {\n            useBigInt64: false,\n            promoteLongs: true,\n            promoteValues: true,\n            promoteBuffers: false,\n            bsonRegExp: false\n        };\n        // Read the message header\n        this.length = msgHeader.length;\n        this.requestId = msgHeader.requestId;\n        this.responseTo = msgHeader.responseTo;\n        this.opCode = msgHeader.opCode;\n        this.fromCompressed = msgHeader.fromCompressed;\n        // Read response flags\n        this.responseFlags = msgBody.readInt32LE(0);\n        this.checksumPresent = (this.responseFlags & OPTS_CHECKSUM_PRESENT) !== 0;\n        this.moreToCome = (this.responseFlags & OPTS_MORE_TO_COME) !== 0;\n        this.exhaustAllowed = (this.responseFlags & OPTS_EXHAUST_ALLOWED) !== 0;\n        this.useBigInt64 = typeof this.opts.useBigInt64 === 'boolean' ? this.opts.useBigInt64 : false;\n        this.promoteLongs = typeof this.opts.promoteLongs === 'boolean' ? this.opts.promoteLongs : true;\n        this.promoteValues =\n            typeof this.opts.promoteValues === 'boolean' ? this.opts.promoteValues : true;\n        this.promoteBuffers =\n            typeof this.opts.promoteBuffers === 'boolean' ? this.opts.promoteBuffers : false;\n        this.bsonRegExp = typeof this.opts.bsonRegExp === 'boolean' ? this.opts.bsonRegExp : false;\n        this.documents = [];\n    }\n    isParsed() {\n        return this.parsed;\n    }\n    parse(options) {\n        // Don't parse again if not needed\n        if (this.parsed)\n            return;\n        options = options ?? {};\n        this.index = 4;\n        // Allow the return of raw documents instead of parsing\n        const raw = options.raw || false;\n        const documentsReturnedIn = options.documentsReturnedIn || null;\n        const useBigInt64 = options.useBigInt64 ?? this.opts.useBigInt64;\n        const promoteLongs = options.promoteLongs ?? this.opts.promoteLongs;\n        const promoteValues = options.promoteValues ?? this.opts.promoteValues;\n        const promoteBuffers = options.promoteBuffers ?? this.opts.promoteBuffers;\n        const bsonRegExp = options.bsonRegExp ?? this.opts.bsonRegExp;\n        const validation = this.parseBsonSerializationOptions(options);\n        // Set up the options\n        const bsonOptions = {\n            useBigInt64,\n            promoteLongs,\n            promoteValues,\n            promoteBuffers,\n            bsonRegExp,\n            validation\n            // Due to the strictness of the BSON libraries validation option we need this cast\n        };\n        while (this.index < this.data.length) {\n            const payloadType = this.data.readUInt8(this.index++);\n            if (payloadType === 0) {\n                const bsonSize = this.data.readUInt32LE(this.index);\n                const bin = this.data.slice(this.index, this.index + bsonSize);\n                this.documents.push(raw ? bin : BSON.deserialize(bin, bsonOptions));\n                this.index += bsonSize;\n            }\n            else if (payloadType === 1) {\n                // It was decided that no driver makes use of payload type 1\n                // TODO(NODE-3483): Replace with MongoDeprecationError\n                throw new error_1.MongoRuntimeError('OP_MSG Payload Type 1 detected unsupported protocol');\n            }\n        }\n        if (this.documents.length === 1 && documentsReturnedIn != null && raw) {\n            const fieldsAsRaw = {};\n            fieldsAsRaw[documentsReturnedIn] = true;\n            bsonOptions.fieldsAsRaw = fieldsAsRaw;\n            const doc = BSON.deserialize(this.documents[0], bsonOptions);\n            this.documents = [doc];\n        }\n        this.parsed = true;\n    }\n    parseBsonSerializationOptions({ enableUtf8Validation }) {\n        if (enableUtf8Validation === false) {\n            return { utf8: false };\n        }\n        return { utf8: { writeErrors: false } };\n    }\n}\nexports.BinMsg = BinMsg;\n//# sourceMappingURL=commands.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jbWFwL2NvbW1hbmRzLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELGNBQWMsR0FBRyxXQUFXLEdBQUcsZ0JBQWdCLEdBQUcsYUFBYTtBQUMvRCxhQUFhLG1CQUFPLENBQUMsaUVBQVM7QUFDOUIsZ0JBQWdCLG1CQUFPLENBQUMsbUVBQVU7QUFDbEMsMEJBQTBCLG1CQUFPLENBQUMsdUZBQW9CO0FBQ3RELGdCQUFnQixtQkFBTyxDQUFDLG1FQUFVO0FBQ2xDLG9CQUFvQixtQkFBTyxDQUFDLDJHQUEyQjtBQUN2RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IseUJBQXlCO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0I7QUFDaEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCO0FBQzdCLDJCQUEyQjtBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEI7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkNBQTZDO0FBQzdDLGdEQUFnRDtBQUNoRCxtQ0FBbUM7QUFDbkMscURBQXFEO0FBQ3JELHlDQUF5QztBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9DQUFvQyxzQkFBc0I7QUFDMUQ7QUFDQSxxQkFBcUI7QUFDckI7QUFDQSxpQkFBaUIsUUFBUTtBQUN6QjtBQUNBO0FBQ0EsY0FBYztBQUNkIiwic291cmNlcyI6WyJEOlxcc2Fsb25pXFxhcHByYWlzYWwtc3lzdGVtXFxzZXJ2ZXJcXG5vZGVfbW9kdWxlc1xcbW9uZ29kYlxcbGliXFxjbWFwXFxjb21tYW5kcy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuQmluTXNnID0gZXhwb3J0cy5Nc2cgPSBleHBvcnRzLlJlc3BvbnNlID0gZXhwb3J0cy5RdWVyeSA9IHZvaWQgMDtcbmNvbnN0IEJTT04gPSByZXF1aXJlKFwiLi4vYnNvblwiKTtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi4vZXJyb3JcIik7XG5jb25zdCByZWFkX3ByZWZlcmVuY2VfMSA9IHJlcXVpcmUoXCIuLi9yZWFkX3ByZWZlcmVuY2VcIik7XG5jb25zdCB1dGlsc18xID0gcmVxdWlyZShcIi4uL3V0aWxzXCIpO1xuY29uc3QgY29uc3RhbnRzXzEgPSByZXF1aXJlKFwiLi93aXJlX3Byb3RvY29sL2NvbnN0YW50c1wiKTtcbi8vIEluY3JlbWVudGluZyByZXF1ZXN0IGlkXG5sZXQgX3JlcXVlc3RJZCA9IDA7XG4vLyBRdWVyeSBmbGFnc1xuY29uc3QgT1BUU19UQUlMQUJMRV9DVVJTT1IgPSAyO1xuY29uc3QgT1BUU19TRUNPTkRBUlkgPSA0O1xuY29uc3QgT1BUU19PUExPR19SRVBMQVkgPSA4O1xuY29uc3QgT1BUU19OT19DVVJTT1JfVElNRU9VVCA9IDE2O1xuY29uc3QgT1BUU19BV0FJVF9EQVRBID0gMzI7XG5jb25zdCBPUFRTX0VYSEFVU1QgPSA2NDtcbmNvbnN0IE9QVFNfUEFSVElBTCA9IDEyODtcbi8vIFJlc3BvbnNlIGZsYWdzXG5jb25zdCBDVVJTT1JfTk9UX0ZPVU5EID0gMTtcbmNvbnN0IFFVRVJZX0ZBSUxVUkUgPSAyO1xuY29uc3QgU0hBUkRfQ09ORklHX1NUQUxFID0gNDtcbmNvbnN0IEFXQUlUX0NBUEFCTEUgPSA4O1xuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gKiBRVUVSWVxuICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuLyoqIEBpbnRlcm5hbCAqL1xuY2xhc3MgUXVlcnkge1xuICAgIGNvbnN0cnVjdG9yKG5zLCBxdWVyeSwgb3B0aW9ucykge1xuICAgICAgICAvLyBCYXNpYyBvcHRpb25zIG5lZWRlZCB0byBiZSBwYXNzZWQgaW5cbiAgICAgICAgLy8gVE9ETyhOT0RFLTM0ODMpOiBSZXBsYWNlIHdpdGggTW9uZ29Db21tYW5kRXJyb3JcbiAgICAgICAgaWYgKG5zID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1J1bnRpbWVFcnJvcignTmFtZXNwYWNlIG11c3QgYmUgc3BlY2lmaWVkIGZvciBxdWVyeScpO1xuICAgICAgICAvLyBUT0RPKE5PREUtMzQ4Myk6IFJlcGxhY2Ugd2l0aCBNb25nb0NvbW1hbmRFcnJvclxuICAgICAgICBpZiAocXVlcnkgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUnVudGltZUVycm9yKCdBIHF1ZXJ5IGRvY3VtZW50IG11c3QgYmUgc3BlY2lmaWVkIGZvciBxdWVyeScpO1xuICAgICAgICAvLyBWYWxpZGF0ZSB0aGF0IHdlIGFyZSBub3QgcGFzc2luZyAweDAwIGluIHRoZSBjb2xsZWN0aW9uIG5hbWVcbiAgICAgICAgaWYgKG5zLmluZGV4T2YoJ1xceDAwJykgIT09IC0xKSB7XG4gICAgICAgICAgICAvLyBUT0RPKE5PREUtMzQ4Myk6IFVzZSBNb25nb05hbWVzcGFjZSBzdGF0aWMgbWV0aG9kXG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1J1bnRpbWVFcnJvcignTmFtZXNwYWNlIGNhbm5vdCBjb250YWluIGEgbnVsbCBjaGFyYWN0ZXInKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBCYXNpYyBvcHRpb25zXG4gICAgICAgIHRoaXMubnMgPSBucztcbiAgICAgICAgdGhpcy5xdWVyeSA9IHF1ZXJ5O1xuICAgICAgICAvLyBBZGRpdGlvbmFsIG9wdGlvbnNcbiAgICAgICAgdGhpcy5udW1iZXJUb1NraXAgPSBvcHRpb25zLm51bWJlclRvU2tpcCB8fCAwO1xuICAgICAgICB0aGlzLm51bWJlclRvUmV0dXJuID0gb3B0aW9ucy5udW1iZXJUb1JldHVybiB8fCAwO1xuICAgICAgICB0aGlzLnJldHVybkZpZWxkU2VsZWN0b3IgPSBvcHRpb25zLnJldHVybkZpZWxkU2VsZWN0b3IgfHwgdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnJlcXVlc3RJZCA9IFF1ZXJ5LmdldFJlcXVlc3RJZCgpO1xuICAgICAgICAvLyBzcGVjaWFsIGNhc2UgZm9yIHByZS0zLjIgZmluZCBjb21tYW5kcywgZGVsZXRlIEFTQVBcbiAgICAgICAgdGhpcy5wcmUzMkxpbWl0ID0gb3B0aW9ucy5wcmUzMkxpbWl0O1xuICAgICAgICAvLyBTZXJpYWxpemF0aW9uIG9wdGlvblxuICAgICAgICB0aGlzLnNlcmlhbGl6ZUZ1bmN0aW9ucyA9XG4gICAgICAgICAgICB0eXBlb2Ygb3B0aW9ucy5zZXJpYWxpemVGdW5jdGlvbnMgPT09ICdib29sZWFuJyA/IG9wdGlvbnMuc2VyaWFsaXplRnVuY3Rpb25zIDogZmFsc2U7XG4gICAgICAgIHRoaXMuaWdub3JlVW5kZWZpbmVkID1cbiAgICAgICAgICAgIHR5cGVvZiBvcHRpb25zLmlnbm9yZVVuZGVmaW5lZCA9PT0gJ2Jvb2xlYW4nID8gb3B0aW9ucy5pZ25vcmVVbmRlZmluZWQgOiBmYWxzZTtcbiAgICAgICAgdGhpcy5tYXhCc29uU2l6ZSA9IG9wdGlvbnMubWF4QnNvblNpemUgfHwgMTAyNCAqIDEwMjQgKiAxNjtcbiAgICAgICAgdGhpcy5jaGVja0tleXMgPSB0eXBlb2Ygb3B0aW9ucy5jaGVja0tleXMgPT09ICdib29sZWFuJyA/IG9wdGlvbnMuY2hlY2tLZXlzIDogZmFsc2U7XG4gICAgICAgIHRoaXMuYmF0Y2hTaXplID0gdGhpcy5udW1iZXJUb1JldHVybjtcbiAgICAgICAgLy8gRmxhZ3NcbiAgICAgICAgdGhpcy50YWlsYWJsZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLnNlY29uZGFyeU9rID0gdHlwZW9mIG9wdGlvbnMuc2Vjb25kYXJ5T2sgPT09ICdib29sZWFuJyA/IG9wdGlvbnMuc2Vjb25kYXJ5T2sgOiBmYWxzZTtcbiAgICAgICAgdGhpcy5vcGxvZ1JlcGxheSA9IGZhbHNlO1xuICAgICAgICB0aGlzLm5vQ3Vyc29yVGltZW91dCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmF3YWl0RGF0YSA9IGZhbHNlO1xuICAgICAgICB0aGlzLmV4aGF1c3QgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5wYXJ0aWFsID0gZmFsc2U7XG4gICAgfVxuICAgIC8qKiBBc3NpZ24gbmV4dCByZXF1ZXN0IElkLiAqL1xuICAgIGluY1JlcXVlc3RJZCgpIHtcbiAgICAgICAgdGhpcy5yZXF1ZXN0SWQgPSBfcmVxdWVzdElkKys7XG4gICAgfVxuICAgIC8qKiBQZWVrIG5leHQgcmVxdWVzdCBJZC4gKi9cbiAgICBuZXh0UmVxdWVzdElkKCkge1xuICAgICAgICByZXR1cm4gX3JlcXVlc3RJZCArIDE7XG4gICAgfVxuICAgIC8qKiBJbmNyZW1lbnQgdGhlbiByZXR1cm4gbmV4dCByZXF1ZXN0IElkLiAqL1xuICAgIHN0YXRpYyBnZXRSZXF1ZXN0SWQoKSB7XG4gICAgICAgIHJldHVybiArK19yZXF1ZXN0SWQ7XG4gICAgfVxuICAgIC8vIFVzZXMgYSBzaW5nbGUgYWxsb2NhdGVkIGJ1ZmZlciBmb3IgdGhlIHByb2Nlc3MsIGF2b2lkaW5nIG11bHRpcGxlIG1lbW9yeSBhbGxvY2F0aW9uc1xuICAgIHRvQmluKCkge1xuICAgICAgICBjb25zdCBidWZmZXJzID0gW107XG4gICAgICAgIGxldCBwcm9qZWN0aW9uID0gbnVsbDtcbiAgICAgICAgLy8gU2V0IHVwIHRoZSBmbGFnc1xuICAgICAgICBsZXQgZmxhZ3MgPSAwO1xuICAgICAgICBpZiAodGhpcy50YWlsYWJsZSkge1xuICAgICAgICAgICAgZmxhZ3MgfD0gT1BUU19UQUlMQUJMRV9DVVJTT1I7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuc2Vjb25kYXJ5T2spIHtcbiAgICAgICAgICAgIGZsYWdzIHw9IE9QVFNfU0VDT05EQVJZO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLm9wbG9nUmVwbGF5KSB7XG4gICAgICAgICAgICBmbGFncyB8PSBPUFRTX09QTE9HX1JFUExBWTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5ub0N1cnNvclRpbWVvdXQpIHtcbiAgICAgICAgICAgIGZsYWdzIHw9IE9QVFNfTk9fQ1VSU09SX1RJTUVPVVQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuYXdhaXREYXRhKSB7XG4gICAgICAgICAgICBmbGFncyB8PSBPUFRTX0FXQUlUX0RBVEE7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuZXhoYXVzdCkge1xuICAgICAgICAgICAgZmxhZ3MgfD0gT1BUU19FWEhBVVNUO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnBhcnRpYWwpIHtcbiAgICAgICAgICAgIGZsYWdzIHw9IE9QVFNfUEFSVElBTDtcbiAgICAgICAgfVxuICAgICAgICAvLyBJZiBiYXRjaFNpemUgaXMgZGlmZmVyZW50IHRvIHRoaXMubnVtYmVyVG9SZXR1cm5cbiAgICAgICAgaWYgKHRoaXMuYmF0Y2hTaXplICE9PSB0aGlzLm51bWJlclRvUmV0dXJuKVxuICAgICAgICAgICAgdGhpcy5udW1iZXJUb1JldHVybiA9IHRoaXMuYmF0Y2hTaXplO1xuICAgICAgICAvLyBBbGxvY2F0ZSB3cml0ZSBwcm90b2NvbCBoZWFkZXIgYnVmZmVyXG4gICAgICAgIGNvbnN0IGhlYWRlciA9IEJ1ZmZlci5hbGxvYyg0ICogNCArIC8vIEhlYWRlclxuICAgICAgICAgICAgNCArIC8vIEZsYWdzXG4gICAgICAgICAgICBCdWZmZXIuYnl0ZUxlbmd0aCh0aGlzLm5zKSArXG4gICAgICAgICAgICAxICsgLy8gbmFtZXNwYWNlXG4gICAgICAgICAgICA0ICsgLy8gbnVtYmVyVG9Ta2lwXG4gICAgICAgICAgICA0IC8vIG51bWJlclRvUmV0dXJuXG4gICAgICAgICk7XG4gICAgICAgIC8vIEFkZCBoZWFkZXIgdG8gYnVmZmVyc1xuICAgICAgICBidWZmZXJzLnB1c2goaGVhZGVyKTtcbiAgICAgICAgLy8gU2VyaWFsaXplIHRoZSBxdWVyeVxuICAgICAgICBjb25zdCBxdWVyeSA9IEJTT04uc2VyaWFsaXplKHRoaXMucXVlcnksIHtcbiAgICAgICAgICAgIGNoZWNrS2V5czogdGhpcy5jaGVja0tleXMsXG4gICAgICAgICAgICBzZXJpYWxpemVGdW5jdGlvbnM6IHRoaXMuc2VyaWFsaXplRnVuY3Rpb25zLFxuICAgICAgICAgICAgaWdub3JlVW5kZWZpbmVkOiB0aGlzLmlnbm9yZVVuZGVmaW5lZFxuICAgICAgICB9KTtcbiAgICAgICAgLy8gQWRkIHF1ZXJ5IGRvY3VtZW50XG4gICAgICAgIGJ1ZmZlcnMucHVzaChxdWVyeSk7XG4gICAgICAgIGlmICh0aGlzLnJldHVybkZpZWxkU2VsZWN0b3IgJiYgT2JqZWN0LmtleXModGhpcy5yZXR1cm5GaWVsZFNlbGVjdG9yKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAvLyBTZXJpYWxpemUgdGhlIHByb2plY3Rpb24gZG9jdW1lbnRcbiAgICAgICAgICAgIHByb2plY3Rpb24gPSBCU09OLnNlcmlhbGl6ZSh0aGlzLnJldHVybkZpZWxkU2VsZWN0b3IsIHtcbiAgICAgICAgICAgICAgICBjaGVja0tleXM6IHRoaXMuY2hlY2tLZXlzLFxuICAgICAgICAgICAgICAgIHNlcmlhbGl6ZUZ1bmN0aW9uczogdGhpcy5zZXJpYWxpemVGdW5jdGlvbnMsXG4gICAgICAgICAgICAgICAgaWdub3JlVW5kZWZpbmVkOiB0aGlzLmlnbm9yZVVuZGVmaW5lZFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAvLyBBZGQgcHJvamVjdGlvbiBkb2N1bWVudFxuICAgICAgICAgICAgYnVmZmVycy5wdXNoKHByb2plY3Rpb24pO1xuICAgICAgICB9XG4gICAgICAgIC8vIFRvdGFsIG1lc3NhZ2Ugc2l6ZVxuICAgICAgICBjb25zdCB0b3RhbExlbmd0aCA9IGhlYWRlci5sZW5ndGggKyBxdWVyeS5sZW5ndGggKyAocHJvamVjdGlvbiA/IHByb2plY3Rpb24ubGVuZ3RoIDogMCk7XG4gICAgICAgIC8vIFNldCB1cCB0aGUgaW5kZXhcbiAgICAgICAgbGV0IGluZGV4ID0gNDtcbiAgICAgICAgLy8gV3JpdGUgdG90YWwgZG9jdW1lbnQgbGVuZ3RoXG4gICAgICAgIGhlYWRlclszXSA9ICh0b3RhbExlbmd0aCA+PiAyNCkgJiAweGZmO1xuICAgICAgICBoZWFkZXJbMl0gPSAodG90YWxMZW5ndGggPj4gMTYpICYgMHhmZjtcbiAgICAgICAgaGVhZGVyWzFdID0gKHRvdGFsTGVuZ3RoID4+IDgpICYgMHhmZjtcbiAgICAgICAgaGVhZGVyWzBdID0gdG90YWxMZW5ndGggJiAweGZmO1xuICAgICAgICAvLyBXcml0ZSBoZWFkZXIgaW5mb3JtYXRpb24gcmVxdWVzdElkXG4gICAgICAgIGhlYWRlcltpbmRleCArIDNdID0gKHRoaXMucmVxdWVzdElkID4+IDI0KSAmIDB4ZmY7XG4gICAgICAgIGhlYWRlcltpbmRleCArIDJdID0gKHRoaXMucmVxdWVzdElkID4+IDE2KSAmIDB4ZmY7XG4gICAgICAgIGhlYWRlcltpbmRleCArIDFdID0gKHRoaXMucmVxdWVzdElkID4+IDgpICYgMHhmZjtcbiAgICAgICAgaGVhZGVyW2luZGV4XSA9IHRoaXMucmVxdWVzdElkICYgMHhmZjtcbiAgICAgICAgaW5kZXggPSBpbmRleCArIDQ7XG4gICAgICAgIC8vIFdyaXRlIGhlYWRlciBpbmZvcm1hdGlvbiByZXNwb25zZVRvXG4gICAgICAgIGhlYWRlcltpbmRleCArIDNdID0gKDAgPj4gMjQpICYgMHhmZjtcbiAgICAgICAgaGVhZGVyW2luZGV4ICsgMl0gPSAoMCA+PiAxNikgJiAweGZmO1xuICAgICAgICBoZWFkZXJbaW5kZXggKyAxXSA9ICgwID4+IDgpICYgMHhmZjtcbiAgICAgICAgaGVhZGVyW2luZGV4XSA9IDAgJiAweGZmO1xuICAgICAgICBpbmRleCA9IGluZGV4ICsgNDtcbiAgICAgICAgLy8gV3JpdGUgaGVhZGVyIGluZm9ybWF0aW9uIE9QX1FVRVJZXG4gICAgICAgIGhlYWRlcltpbmRleCArIDNdID0gKGNvbnN0YW50c18xLk9QX1FVRVJZID4+IDI0KSAmIDB4ZmY7XG4gICAgICAgIGhlYWRlcltpbmRleCArIDJdID0gKGNvbnN0YW50c18xLk9QX1FVRVJZID4+IDE2KSAmIDB4ZmY7XG4gICAgICAgIGhlYWRlcltpbmRleCArIDFdID0gKGNvbnN0YW50c18xLk9QX1FVRVJZID4+IDgpICYgMHhmZjtcbiAgICAgICAgaGVhZGVyW2luZGV4XSA9IGNvbnN0YW50c18xLk9QX1FVRVJZICYgMHhmZjtcbiAgICAgICAgaW5kZXggPSBpbmRleCArIDQ7XG4gICAgICAgIC8vIFdyaXRlIGhlYWRlciBpbmZvcm1hdGlvbiBmbGFnc1xuICAgICAgICBoZWFkZXJbaW5kZXggKyAzXSA9IChmbGFncyA+PiAyNCkgJiAweGZmO1xuICAgICAgICBoZWFkZXJbaW5kZXggKyAyXSA9IChmbGFncyA+PiAxNikgJiAweGZmO1xuICAgICAgICBoZWFkZXJbaW5kZXggKyAxXSA9IChmbGFncyA+PiA4KSAmIDB4ZmY7XG4gICAgICAgIGhlYWRlcltpbmRleF0gPSBmbGFncyAmIDB4ZmY7XG4gICAgICAgIGluZGV4ID0gaW5kZXggKyA0O1xuICAgICAgICAvLyBXcml0ZSBjb2xsZWN0aW9uIG5hbWVcbiAgICAgICAgaW5kZXggPSBpbmRleCArIGhlYWRlci53cml0ZSh0aGlzLm5zLCBpbmRleCwgJ3V0ZjgnKSArIDE7XG4gICAgICAgIGhlYWRlcltpbmRleCAtIDFdID0gMDtcbiAgICAgICAgLy8gV3JpdGUgaGVhZGVyIGluZm9ybWF0aW9uIGZsYWdzIG51bWJlclRvU2tpcFxuICAgICAgICBoZWFkZXJbaW5kZXggKyAzXSA9ICh0aGlzLm51bWJlclRvU2tpcCA+PiAyNCkgJiAweGZmO1xuICAgICAgICBoZWFkZXJbaW5kZXggKyAyXSA9ICh0aGlzLm51bWJlclRvU2tpcCA+PiAxNikgJiAweGZmO1xuICAgICAgICBoZWFkZXJbaW5kZXggKyAxXSA9ICh0aGlzLm51bWJlclRvU2tpcCA+PiA4KSAmIDB4ZmY7XG4gICAgICAgIGhlYWRlcltpbmRleF0gPSB0aGlzLm51bWJlclRvU2tpcCAmIDB4ZmY7XG4gICAgICAgIGluZGV4ID0gaW5kZXggKyA0O1xuICAgICAgICAvLyBXcml0ZSBoZWFkZXIgaW5mb3JtYXRpb24gZmxhZ3MgbnVtYmVyVG9SZXR1cm5cbiAgICAgICAgaGVhZGVyW2luZGV4ICsgM10gPSAodGhpcy5udW1iZXJUb1JldHVybiA+PiAyNCkgJiAweGZmO1xuICAgICAgICBoZWFkZXJbaW5kZXggKyAyXSA9ICh0aGlzLm51bWJlclRvUmV0dXJuID4+IDE2KSAmIDB4ZmY7XG4gICAgICAgIGhlYWRlcltpbmRleCArIDFdID0gKHRoaXMubnVtYmVyVG9SZXR1cm4gPj4gOCkgJiAweGZmO1xuICAgICAgICBoZWFkZXJbaW5kZXhdID0gdGhpcy5udW1iZXJUb1JldHVybiAmIDB4ZmY7XG4gICAgICAgIGluZGV4ID0gaW5kZXggKyA0O1xuICAgICAgICAvLyBSZXR1cm4gdGhlIGJ1ZmZlcnNcbiAgICAgICAgcmV0dXJuIGJ1ZmZlcnM7XG4gICAgfVxufVxuZXhwb3J0cy5RdWVyeSA9IFF1ZXJ5O1xuLyoqIEBpbnRlcm5hbCAqL1xuY2xhc3MgUmVzcG9uc2Uge1xuICAgIGNvbnN0cnVjdG9yKG1lc3NhZ2UsIG1zZ0hlYWRlciwgbXNnQm9keSwgb3B0cykge1xuICAgICAgICB0aGlzLmRvY3VtZW50cyA9IG5ldyBBcnJheSgwKTtcbiAgICAgICAgdGhpcy5wYXJzZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5yYXcgPSBtZXNzYWdlO1xuICAgICAgICB0aGlzLmRhdGEgPSBtc2dCb2R5O1xuICAgICAgICB0aGlzLm9wdHMgPSBvcHRzID8/IHtcbiAgICAgICAgICAgIHVzZUJpZ0ludDY0OiBmYWxzZSxcbiAgICAgICAgICAgIHByb21vdGVMb25nczogdHJ1ZSxcbiAgICAgICAgICAgIHByb21vdGVWYWx1ZXM6IHRydWUsXG4gICAgICAgICAgICBwcm9tb3RlQnVmZmVyczogZmFsc2UsXG4gICAgICAgICAgICBic29uUmVnRXhwOiBmYWxzZVxuICAgICAgICB9O1xuICAgICAgICAvLyBSZWFkIHRoZSBtZXNzYWdlIGhlYWRlclxuICAgICAgICB0aGlzLmxlbmd0aCA9IG1zZ0hlYWRlci5sZW5ndGg7XG4gICAgICAgIHRoaXMucmVxdWVzdElkID0gbXNnSGVhZGVyLnJlcXVlc3RJZDtcbiAgICAgICAgdGhpcy5yZXNwb25zZVRvID0gbXNnSGVhZGVyLnJlc3BvbnNlVG87XG4gICAgICAgIHRoaXMub3BDb2RlID0gbXNnSGVhZGVyLm9wQ29kZTtcbiAgICAgICAgdGhpcy5mcm9tQ29tcHJlc3NlZCA9IG1zZ0hlYWRlci5mcm9tQ29tcHJlc3NlZDtcbiAgICAgICAgLy8gRmxhZyB2YWx1ZXNcbiAgICAgICAgdGhpcy51c2VCaWdJbnQ2NCA9IHR5cGVvZiB0aGlzLm9wdHMudXNlQmlnSW50NjQgPT09ICdib29sZWFuJyA/IHRoaXMub3B0cy51c2VCaWdJbnQ2NCA6IGZhbHNlO1xuICAgICAgICB0aGlzLnByb21vdGVMb25ncyA9IHR5cGVvZiB0aGlzLm9wdHMucHJvbW90ZUxvbmdzID09PSAnYm9vbGVhbicgPyB0aGlzLm9wdHMucHJvbW90ZUxvbmdzIDogdHJ1ZTtcbiAgICAgICAgdGhpcy5wcm9tb3RlVmFsdWVzID1cbiAgICAgICAgICAgIHR5cGVvZiB0aGlzLm9wdHMucHJvbW90ZVZhbHVlcyA9PT0gJ2Jvb2xlYW4nID8gdGhpcy5vcHRzLnByb21vdGVWYWx1ZXMgOiB0cnVlO1xuICAgICAgICB0aGlzLnByb21vdGVCdWZmZXJzID1cbiAgICAgICAgICAgIHR5cGVvZiB0aGlzLm9wdHMucHJvbW90ZUJ1ZmZlcnMgPT09ICdib29sZWFuJyA/IHRoaXMub3B0cy5wcm9tb3RlQnVmZmVycyA6IGZhbHNlO1xuICAgICAgICB0aGlzLmJzb25SZWdFeHAgPSB0eXBlb2YgdGhpcy5vcHRzLmJzb25SZWdFeHAgPT09ICdib29sZWFuJyA/IHRoaXMub3B0cy5ic29uUmVnRXhwIDogZmFsc2U7XG4gICAgfVxuICAgIGlzUGFyc2VkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wYXJzZWQ7XG4gICAgfVxuICAgIHBhcnNlKG9wdGlvbnMpIHtcbiAgICAgICAgLy8gRG9uJ3QgcGFyc2UgYWdhaW4gaWYgbm90IG5lZWRlZFxuICAgICAgICBpZiAodGhpcy5wYXJzZWQpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIG9wdGlvbnMgPSBvcHRpb25zID8/IHt9O1xuICAgICAgICAvLyBBbGxvdyB0aGUgcmV0dXJuIG9mIHJhdyBkb2N1bWVudHMgaW5zdGVhZCBvZiBwYXJzaW5nXG4gICAgICAgIGNvbnN0IHJhdyA9IG9wdGlvbnMucmF3IHx8IGZhbHNlO1xuICAgICAgICBjb25zdCBkb2N1bWVudHNSZXR1cm5lZEluID0gb3B0aW9ucy5kb2N1bWVudHNSZXR1cm5lZEluIHx8IG51bGw7XG4gICAgICAgIGNvbnN0IHVzZUJpZ0ludDY0ID0gb3B0aW9ucy51c2VCaWdJbnQ2NCA/PyB0aGlzLm9wdHMudXNlQmlnSW50NjQ7XG4gICAgICAgIGNvbnN0IHByb21vdGVMb25ncyA9IG9wdGlvbnMucHJvbW90ZUxvbmdzID8/IHRoaXMub3B0cy5wcm9tb3RlTG9uZ3M7XG4gICAgICAgIGNvbnN0IHByb21vdGVWYWx1ZXMgPSBvcHRpb25zLnByb21vdGVWYWx1ZXMgPz8gdGhpcy5vcHRzLnByb21vdGVWYWx1ZXM7XG4gICAgICAgIGNvbnN0IHByb21vdGVCdWZmZXJzID0gb3B0aW9ucy5wcm9tb3RlQnVmZmVycyA/PyB0aGlzLm9wdHMucHJvbW90ZUJ1ZmZlcnM7XG4gICAgICAgIGNvbnN0IGJzb25SZWdFeHAgPSBvcHRpb25zLmJzb25SZWdFeHAgPz8gdGhpcy5vcHRzLmJzb25SZWdFeHA7XG4gICAgICAgIGxldCBic29uU2l6ZTtcbiAgICAgICAgLy8gU2V0IHVwIHRoZSBvcHRpb25zXG4gICAgICAgIGNvbnN0IF9vcHRpb25zID0ge1xuICAgICAgICAgICAgdXNlQmlnSW50NjQsXG4gICAgICAgICAgICBwcm9tb3RlTG9uZ3MsXG4gICAgICAgICAgICBwcm9tb3RlVmFsdWVzLFxuICAgICAgICAgICAgcHJvbW90ZUJ1ZmZlcnMsXG4gICAgICAgICAgICBic29uUmVnRXhwXG4gICAgICAgIH07XG4gICAgICAgIC8vIFBvc2l0aW9uIHdpdGhpbiBPUF9SRVBMWSBhdCB3aGljaCBkb2N1bWVudHMgc3RhcnRcbiAgICAgICAgLy8gKFNlZSBodHRwczovL3d3dy5tb25nb2RiLmNvbS9kb2NzL21hbnVhbC9yZWZlcmVuY2UvbW9uZ29kYi13aXJlLXByb3RvY29sLyN3aXJlLW9wLXJlcGx5KVxuICAgICAgICB0aGlzLmluZGV4ID0gMjA7XG4gICAgICAgIC8vIFJlYWQgdGhlIG1lc3NhZ2UgYm9keVxuICAgICAgICB0aGlzLnJlc3BvbnNlRmxhZ3MgPSB0aGlzLmRhdGEucmVhZEludDMyTEUoMCk7XG4gICAgICAgIHRoaXMuY3Vyc29ySWQgPSBuZXcgQlNPTi5Mb25nKHRoaXMuZGF0YS5yZWFkSW50MzJMRSg0KSwgdGhpcy5kYXRhLnJlYWRJbnQzMkxFKDgpKTtcbiAgICAgICAgdGhpcy5zdGFydGluZ0Zyb20gPSB0aGlzLmRhdGEucmVhZEludDMyTEUoMTIpO1xuICAgICAgICB0aGlzLm51bWJlclJldHVybmVkID0gdGhpcy5kYXRhLnJlYWRJbnQzMkxFKDE2KTtcbiAgICAgICAgLy8gUHJlYWxsb2NhdGUgZG9jdW1lbnQgYXJyYXlcbiAgICAgICAgdGhpcy5kb2N1bWVudHMgPSBuZXcgQXJyYXkodGhpcy5udW1iZXJSZXR1cm5lZCk7XG4gICAgICAgIHRoaXMuY3Vyc29yTm90Rm91bmQgPSAodGhpcy5yZXNwb25zZUZsYWdzICYgQ1VSU09SX05PVF9GT1VORCkgIT09IDA7XG4gICAgICAgIHRoaXMucXVlcnlGYWlsdXJlID0gKHRoaXMucmVzcG9uc2VGbGFncyAmIFFVRVJZX0ZBSUxVUkUpICE9PSAwO1xuICAgICAgICB0aGlzLnNoYXJkQ29uZmlnU3RhbGUgPSAodGhpcy5yZXNwb25zZUZsYWdzICYgU0hBUkRfQ09ORklHX1NUQUxFKSAhPT0gMDtcbiAgICAgICAgdGhpcy5hd2FpdENhcGFibGUgPSAodGhpcy5yZXNwb25zZUZsYWdzICYgQVdBSVRfQ0FQQUJMRSkgIT09IDA7XG4gICAgICAgIC8vIFBhcnNlIEJvZHlcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLm51bWJlclJldHVybmVkOyBpKyspIHtcbiAgICAgICAgICAgIGJzb25TaXplID1cbiAgICAgICAgICAgICAgICB0aGlzLmRhdGFbdGhpcy5pbmRleF0gfFxuICAgICAgICAgICAgICAgICAgICAodGhpcy5kYXRhW3RoaXMuaW5kZXggKyAxXSA8PCA4KSB8XG4gICAgICAgICAgICAgICAgICAgICh0aGlzLmRhdGFbdGhpcy5pbmRleCArIDJdIDw8IDE2KSB8XG4gICAgICAgICAgICAgICAgICAgICh0aGlzLmRhdGFbdGhpcy5pbmRleCArIDNdIDw8IDI0KTtcbiAgICAgICAgICAgIC8vIElmIHdlIGhhdmUgcmF3IHJlc3VsdHMgc3BlY2lmaWVkIHNsaWNlIHRoZSByZXR1cm4gZG9jdW1lbnRcbiAgICAgICAgICAgIGlmIChyYXcpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRvY3VtZW50c1tpXSA9IHRoaXMuZGF0YS5zbGljZSh0aGlzLmluZGV4LCB0aGlzLmluZGV4ICsgYnNvblNpemUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kb2N1bWVudHNbaV0gPSBCU09OLmRlc2VyaWFsaXplKHRoaXMuZGF0YS5zbGljZSh0aGlzLmluZGV4LCB0aGlzLmluZGV4ICsgYnNvblNpemUpLCBfb3B0aW9ucyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBBZGp1c3QgdGhlIGluZGV4XG4gICAgICAgICAgICB0aGlzLmluZGV4ID0gdGhpcy5pbmRleCArIGJzb25TaXplO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmRvY3VtZW50cy5sZW5ndGggPT09IDEgJiYgZG9jdW1lbnRzUmV0dXJuZWRJbiAhPSBudWxsICYmIHJhdykge1xuICAgICAgICAgICAgY29uc3QgZmllbGRzQXNSYXcgPSB7fTtcbiAgICAgICAgICAgIGZpZWxkc0FzUmF3W2RvY3VtZW50c1JldHVybmVkSW5dID0gdHJ1ZTtcbiAgICAgICAgICAgIF9vcHRpb25zLmZpZWxkc0FzUmF3ID0gZmllbGRzQXNSYXc7XG4gICAgICAgICAgICBjb25zdCBkb2MgPSBCU09OLmRlc2VyaWFsaXplKHRoaXMuZG9jdW1lbnRzWzBdLCBfb3B0aW9ucyk7XG4gICAgICAgICAgICB0aGlzLmRvY3VtZW50cyA9IFtkb2NdO1xuICAgICAgICB9XG4gICAgICAgIC8vIFNldCBwYXJzZWRcbiAgICAgICAgdGhpcy5wYXJzZWQgPSB0cnVlO1xuICAgIH1cbn1cbmV4cG9ydHMuUmVzcG9uc2UgPSBSZXNwb25zZTtcbi8vIEltcGxlbWVudGF0aW9uIG9mIE9QX01TRyBzcGVjOlxuLy8gaHR0cHM6Ly9naXRodWIuY29tL21vbmdvZGIvc3BlY2lmaWNhdGlvbnMvYmxvYi9tYXN0ZXIvc291cmNlL21lc3NhZ2UvT1BfTVNHLnJzdFxuLy9cbi8vIHN0cnVjdCBTZWN0aW9uIHtcbi8vICAgdWludDggcGF5bG9hZFR5cGU7XG4vLyAgIHVuaW9uIHBheWxvYWQge1xuLy8gICAgICAgZG9jdW1lbnQgIGRvY3VtZW50OyAvLyBwYXlsb2FkVHlwZSA9PSAwXG4vLyAgICAgICBzdHJ1Y3Qgc2VxdWVuY2UgeyAvLyBwYXlsb2FkVHlwZSA9PSAxXG4vLyAgICAgICAgICAgaW50MzIgICAgICBzaXplO1xuLy8gICAgICAgICAgIGNzdHJpbmcgICAgaWRlbnRpZmllcjtcbi8vICAgICAgICAgICBkb2N1bWVudCogIGRvY3VtZW50cztcbi8vICAgICAgIH07XG4vLyAgIH07XG4vLyB9O1xuLy8gc3RydWN0IE9QX01TRyB7XG4vLyAgIHN0cnVjdCBNc2dIZWFkZXIge1xuLy8gICAgICAgaW50MzIgIG1lc3NhZ2VMZW5ndGg7XG4vLyAgICAgICBpbnQzMiAgcmVxdWVzdElEO1xuLy8gICAgICAgaW50MzIgIHJlc3BvbnNlVG87XG4vLyAgICAgICBpbnQzMiAgb3BDb2RlID0gMjAxMztcbi8vICAgfTtcbi8vICAgdWludDMyICAgICAgZmxhZ0JpdHM7XG4vLyAgIFNlY3Rpb24rICAgIHNlY3Rpb25zO1xuLy8gICBbdWludDMyICAgICBjaGVja3N1bTtdXG4vLyB9O1xuLy8gTXNnIEZsYWdzXG5jb25zdCBPUFRTX0NIRUNLU1VNX1BSRVNFTlQgPSAxO1xuY29uc3QgT1BUU19NT1JFX1RPX0NPTUUgPSAyO1xuY29uc3QgT1BUU19FWEhBVVNUX0FMTE9XRUQgPSAxIDw8IDE2O1xuLyoqIEBpbnRlcm5hbCAqL1xuY2xhc3MgTXNnIHtcbiAgICBjb25zdHJ1Y3RvcihucywgY29tbWFuZCwgb3B0aW9ucykge1xuICAgICAgICAvLyBCYXNpYyBvcHRpb25zIG5lZWRlZCB0byBiZSBwYXNzZWQgaW5cbiAgICAgICAgaWYgKGNvbW1hbmQgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoJ1F1ZXJ5IGRvY3VtZW50IG11c3QgYmUgc3BlY2lmaWVkIGZvciBxdWVyeScpO1xuICAgICAgICAvLyBCYXNpYyBvcHRpb25zXG4gICAgICAgIHRoaXMubnMgPSBucztcbiAgICAgICAgdGhpcy5jb21tYW5kID0gY29tbWFuZDtcbiAgICAgICAgdGhpcy5jb21tYW5kLiRkYiA9ICgwLCB1dGlsc18xLmRhdGFiYXNlTmFtZXNwYWNlKShucyk7XG4gICAgICAgIGlmIChvcHRpb25zLnJlYWRQcmVmZXJlbmNlICYmIG9wdGlvbnMucmVhZFByZWZlcmVuY2UubW9kZSAhPT0gcmVhZF9wcmVmZXJlbmNlXzEuUmVhZFByZWZlcmVuY2UuUFJJTUFSWSkge1xuICAgICAgICAgICAgdGhpcy5jb21tYW5kLiRyZWFkUHJlZmVyZW5jZSA9IG9wdGlvbnMucmVhZFByZWZlcmVuY2UudG9KU09OKCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gRW5zdXJlIGVtcHR5IG9wdGlvbnNcbiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucyA/PyB7fTtcbiAgICAgICAgLy8gQWRkaXRpb25hbCBvcHRpb25zXG4gICAgICAgIHRoaXMucmVxdWVzdElkID0gb3B0aW9ucy5yZXF1ZXN0SWQgPyBvcHRpb25zLnJlcXVlc3RJZCA6IE1zZy5nZXRSZXF1ZXN0SWQoKTtcbiAgICAgICAgLy8gU2VyaWFsaXphdGlvbiBvcHRpb25cbiAgICAgICAgdGhpcy5zZXJpYWxpemVGdW5jdGlvbnMgPVxuICAgICAgICAgICAgdHlwZW9mIG9wdGlvbnMuc2VyaWFsaXplRnVuY3Rpb25zID09PSAnYm9vbGVhbicgPyBvcHRpb25zLnNlcmlhbGl6ZUZ1bmN0aW9ucyA6IGZhbHNlO1xuICAgICAgICB0aGlzLmlnbm9yZVVuZGVmaW5lZCA9XG4gICAgICAgICAgICB0eXBlb2Ygb3B0aW9ucy5pZ25vcmVVbmRlZmluZWQgPT09ICdib29sZWFuJyA/IG9wdGlvbnMuaWdub3JlVW5kZWZpbmVkIDogZmFsc2U7XG4gICAgICAgIHRoaXMuY2hlY2tLZXlzID0gdHlwZW9mIG9wdGlvbnMuY2hlY2tLZXlzID09PSAnYm9vbGVhbicgPyBvcHRpb25zLmNoZWNrS2V5cyA6IGZhbHNlO1xuICAgICAgICB0aGlzLm1heEJzb25TaXplID0gb3B0aW9ucy5tYXhCc29uU2l6ZSB8fCAxMDI0ICogMTAyNCAqIDE2O1xuICAgICAgICAvLyBmbGFnc1xuICAgICAgICB0aGlzLmNoZWNrc3VtUHJlc2VudCA9IGZhbHNlO1xuICAgICAgICB0aGlzLm1vcmVUb0NvbWUgPSBvcHRpb25zLm1vcmVUb0NvbWUgfHwgZmFsc2U7XG4gICAgICAgIHRoaXMuZXhoYXVzdEFsbG93ZWQgPVxuICAgICAgICAgICAgdHlwZW9mIG9wdGlvbnMuZXhoYXVzdEFsbG93ZWQgPT09ICdib29sZWFuJyA/IG9wdGlvbnMuZXhoYXVzdEFsbG93ZWQgOiBmYWxzZTtcbiAgICB9XG4gICAgdG9CaW4oKSB7XG4gICAgICAgIGNvbnN0IGJ1ZmZlcnMgPSBbXTtcbiAgICAgICAgbGV0IGZsYWdzID0gMDtcbiAgICAgICAgaWYgKHRoaXMuY2hlY2tzdW1QcmVzZW50KSB7XG4gICAgICAgICAgICBmbGFncyB8PSBPUFRTX0NIRUNLU1VNX1BSRVNFTlQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMubW9yZVRvQ29tZSkge1xuICAgICAgICAgICAgZmxhZ3MgfD0gT1BUU19NT1JFX1RPX0NPTUU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuZXhoYXVzdEFsbG93ZWQpIHtcbiAgICAgICAgICAgIGZsYWdzIHw9IE9QVFNfRVhIQVVTVF9BTExPV0VEO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGhlYWRlciA9IEJ1ZmZlci5hbGxvYyg0ICogNCArIC8vIEhlYWRlclxuICAgICAgICAgICAgNCAvLyBGbGFnc1xuICAgICAgICApO1xuICAgICAgICBidWZmZXJzLnB1c2goaGVhZGVyKTtcbiAgICAgICAgbGV0IHRvdGFsTGVuZ3RoID0gaGVhZGVyLmxlbmd0aDtcbiAgICAgICAgY29uc3QgY29tbWFuZCA9IHRoaXMuY29tbWFuZDtcbiAgICAgICAgdG90YWxMZW5ndGggKz0gdGhpcy5tYWtlRG9jdW1lbnRTZWdtZW50KGJ1ZmZlcnMsIGNvbW1hbmQpO1xuICAgICAgICBoZWFkZXIud3JpdGVJbnQzMkxFKHRvdGFsTGVuZ3RoLCAwKTsgLy8gbWVzc2FnZUxlbmd0aFxuICAgICAgICBoZWFkZXIud3JpdGVJbnQzMkxFKHRoaXMucmVxdWVzdElkLCA0KTsgLy8gcmVxdWVzdElEXG4gICAgICAgIGhlYWRlci53cml0ZUludDMyTEUoMCwgOCk7IC8vIHJlc3BvbnNlVG9cbiAgICAgICAgaGVhZGVyLndyaXRlSW50MzJMRShjb25zdGFudHNfMS5PUF9NU0csIDEyKTsgLy8gb3BDb2RlXG4gICAgICAgIGhlYWRlci53cml0ZVVJbnQzMkxFKGZsYWdzLCAxNik7IC8vIGZsYWdzXG4gICAgICAgIHJldHVybiBidWZmZXJzO1xuICAgIH1cbiAgICBtYWtlRG9jdW1lbnRTZWdtZW50KGJ1ZmZlcnMsIGRvY3VtZW50KSB7XG4gICAgICAgIGNvbnN0IHBheWxvYWRUeXBlQnVmZmVyID0gQnVmZmVyLmFsbG9jKDEpO1xuICAgICAgICBwYXlsb2FkVHlwZUJ1ZmZlclswXSA9IDA7XG4gICAgICAgIGNvbnN0IGRvY3VtZW50QnVmZmVyID0gdGhpcy5zZXJpYWxpemVCc29uKGRvY3VtZW50KTtcbiAgICAgICAgYnVmZmVycy5wdXNoKHBheWxvYWRUeXBlQnVmZmVyKTtcbiAgICAgICAgYnVmZmVycy5wdXNoKGRvY3VtZW50QnVmZmVyKTtcbiAgICAgICAgcmV0dXJuIHBheWxvYWRUeXBlQnVmZmVyLmxlbmd0aCArIGRvY3VtZW50QnVmZmVyLmxlbmd0aDtcbiAgICB9XG4gICAgc2VyaWFsaXplQnNvbihkb2N1bWVudCkge1xuICAgICAgICByZXR1cm4gQlNPTi5zZXJpYWxpemUoZG9jdW1lbnQsIHtcbiAgICAgICAgICAgIGNoZWNrS2V5czogdGhpcy5jaGVja0tleXMsXG4gICAgICAgICAgICBzZXJpYWxpemVGdW5jdGlvbnM6IHRoaXMuc2VyaWFsaXplRnVuY3Rpb25zLFxuICAgICAgICAgICAgaWdub3JlVW5kZWZpbmVkOiB0aGlzLmlnbm9yZVVuZGVmaW5lZFxuICAgICAgICB9KTtcbiAgICB9XG4gICAgc3RhdGljIGdldFJlcXVlc3RJZCgpIHtcbiAgICAgICAgX3JlcXVlc3RJZCA9IChfcmVxdWVzdElkICsgMSkgJiAweDdmZmZmZmZmO1xuICAgICAgICByZXR1cm4gX3JlcXVlc3RJZDtcbiAgICB9XG59XG5leHBvcnRzLk1zZyA9IE1zZztcbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIEJpbk1zZyB7XG4gICAgY29uc3RydWN0b3IobWVzc2FnZSwgbXNnSGVhZGVyLCBtc2dCb2R5LCBvcHRzKSB7XG4gICAgICAgIHRoaXMucGFyc2VkID0gZmFsc2U7XG4gICAgICAgIHRoaXMucmF3ID0gbWVzc2FnZTtcbiAgICAgICAgdGhpcy5kYXRhID0gbXNnQm9keTtcbiAgICAgICAgdGhpcy5vcHRzID0gb3B0cyA/PyB7XG4gICAgICAgICAgICB1c2VCaWdJbnQ2NDogZmFsc2UsXG4gICAgICAgICAgICBwcm9tb3RlTG9uZ3M6IHRydWUsXG4gICAgICAgICAgICBwcm9tb3RlVmFsdWVzOiB0cnVlLFxuICAgICAgICAgICAgcHJvbW90ZUJ1ZmZlcnM6IGZhbHNlLFxuICAgICAgICAgICAgYnNvblJlZ0V4cDogZmFsc2VcbiAgICAgICAgfTtcbiAgICAgICAgLy8gUmVhZCB0aGUgbWVzc2FnZSBoZWFkZXJcbiAgICAgICAgdGhpcy5sZW5ndGggPSBtc2dIZWFkZXIubGVuZ3RoO1xuICAgICAgICB0aGlzLnJlcXVlc3RJZCA9IG1zZ0hlYWRlci5yZXF1ZXN0SWQ7XG4gICAgICAgIHRoaXMucmVzcG9uc2VUbyA9IG1zZ0hlYWRlci5yZXNwb25zZVRvO1xuICAgICAgICB0aGlzLm9wQ29kZSA9IG1zZ0hlYWRlci5vcENvZGU7XG4gICAgICAgIHRoaXMuZnJvbUNvbXByZXNzZWQgPSBtc2dIZWFkZXIuZnJvbUNvbXByZXNzZWQ7XG4gICAgICAgIC8vIFJlYWQgcmVzcG9uc2UgZmxhZ3NcbiAgICAgICAgdGhpcy5yZXNwb25zZUZsYWdzID0gbXNnQm9keS5yZWFkSW50MzJMRSgwKTtcbiAgICAgICAgdGhpcy5jaGVja3N1bVByZXNlbnQgPSAodGhpcy5yZXNwb25zZUZsYWdzICYgT1BUU19DSEVDS1NVTV9QUkVTRU5UKSAhPT0gMDtcbiAgICAgICAgdGhpcy5tb3JlVG9Db21lID0gKHRoaXMucmVzcG9uc2VGbGFncyAmIE9QVFNfTU9SRV9UT19DT01FKSAhPT0gMDtcbiAgICAgICAgdGhpcy5leGhhdXN0QWxsb3dlZCA9ICh0aGlzLnJlc3BvbnNlRmxhZ3MgJiBPUFRTX0VYSEFVU1RfQUxMT1dFRCkgIT09IDA7XG4gICAgICAgIHRoaXMudXNlQmlnSW50NjQgPSB0eXBlb2YgdGhpcy5vcHRzLnVzZUJpZ0ludDY0ID09PSAnYm9vbGVhbicgPyB0aGlzLm9wdHMudXNlQmlnSW50NjQgOiBmYWxzZTtcbiAgICAgICAgdGhpcy5wcm9tb3RlTG9uZ3MgPSB0eXBlb2YgdGhpcy5vcHRzLnByb21vdGVMb25ncyA9PT0gJ2Jvb2xlYW4nID8gdGhpcy5vcHRzLnByb21vdGVMb25ncyA6IHRydWU7XG4gICAgICAgIHRoaXMucHJvbW90ZVZhbHVlcyA9XG4gICAgICAgICAgICB0eXBlb2YgdGhpcy5vcHRzLnByb21vdGVWYWx1ZXMgPT09ICdib29sZWFuJyA/IHRoaXMub3B0cy5wcm9tb3RlVmFsdWVzIDogdHJ1ZTtcbiAgICAgICAgdGhpcy5wcm9tb3RlQnVmZmVycyA9XG4gICAgICAgICAgICB0eXBlb2YgdGhpcy5vcHRzLnByb21vdGVCdWZmZXJzID09PSAnYm9vbGVhbicgPyB0aGlzLm9wdHMucHJvbW90ZUJ1ZmZlcnMgOiBmYWxzZTtcbiAgICAgICAgdGhpcy5ic29uUmVnRXhwID0gdHlwZW9mIHRoaXMub3B0cy5ic29uUmVnRXhwID09PSAnYm9vbGVhbicgPyB0aGlzLm9wdHMuYnNvblJlZ0V4cCA6IGZhbHNlO1xuICAgICAgICB0aGlzLmRvY3VtZW50cyA9IFtdO1xuICAgIH1cbiAgICBpc1BhcnNlZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VkO1xuICAgIH1cbiAgICBwYXJzZShvcHRpb25zKSB7XG4gICAgICAgIC8vIERvbid0IHBhcnNlIGFnYWluIGlmIG5vdCBuZWVkZWRcbiAgICAgICAgaWYgKHRoaXMucGFyc2VkKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBvcHRpb25zID0gb3B0aW9ucyA/PyB7fTtcbiAgICAgICAgdGhpcy5pbmRleCA9IDQ7XG4gICAgICAgIC8vIEFsbG93IHRoZSByZXR1cm4gb2YgcmF3IGRvY3VtZW50cyBpbnN0ZWFkIG9mIHBhcnNpbmdcbiAgICAgICAgY29uc3QgcmF3ID0gb3B0aW9ucy5yYXcgfHwgZmFsc2U7XG4gICAgICAgIGNvbnN0IGRvY3VtZW50c1JldHVybmVkSW4gPSBvcHRpb25zLmRvY3VtZW50c1JldHVybmVkSW4gfHwgbnVsbDtcbiAgICAgICAgY29uc3QgdXNlQmlnSW50NjQgPSBvcHRpb25zLnVzZUJpZ0ludDY0ID8/IHRoaXMub3B0cy51c2VCaWdJbnQ2NDtcbiAgICAgICAgY29uc3QgcHJvbW90ZUxvbmdzID0gb3B0aW9ucy5wcm9tb3RlTG9uZ3MgPz8gdGhpcy5vcHRzLnByb21vdGVMb25ncztcbiAgICAgICAgY29uc3QgcHJvbW90ZVZhbHVlcyA9IG9wdGlvbnMucHJvbW90ZVZhbHVlcyA/PyB0aGlzLm9wdHMucHJvbW90ZVZhbHVlcztcbiAgICAgICAgY29uc3QgcHJvbW90ZUJ1ZmZlcnMgPSBvcHRpb25zLnByb21vdGVCdWZmZXJzID8/IHRoaXMub3B0cy5wcm9tb3RlQnVmZmVycztcbiAgICAgICAgY29uc3QgYnNvblJlZ0V4cCA9IG9wdGlvbnMuYnNvblJlZ0V4cCA/PyB0aGlzLm9wdHMuYnNvblJlZ0V4cDtcbiAgICAgICAgY29uc3QgdmFsaWRhdGlvbiA9IHRoaXMucGFyc2VCc29uU2VyaWFsaXphdGlvbk9wdGlvbnMob3B0aW9ucyk7XG4gICAgICAgIC8vIFNldCB1cCB0aGUgb3B0aW9uc1xuICAgICAgICBjb25zdCBic29uT3B0aW9ucyA9IHtcbiAgICAgICAgICAgIHVzZUJpZ0ludDY0LFxuICAgICAgICAgICAgcHJvbW90ZUxvbmdzLFxuICAgICAgICAgICAgcHJvbW90ZVZhbHVlcyxcbiAgICAgICAgICAgIHByb21vdGVCdWZmZXJzLFxuICAgICAgICAgICAgYnNvblJlZ0V4cCxcbiAgICAgICAgICAgIHZhbGlkYXRpb25cbiAgICAgICAgICAgIC8vIER1ZSB0byB0aGUgc3RyaWN0bmVzcyBvZiB0aGUgQlNPTiBsaWJyYXJpZXMgdmFsaWRhdGlvbiBvcHRpb24gd2UgbmVlZCB0aGlzIGNhc3RcbiAgICAgICAgfTtcbiAgICAgICAgd2hpbGUgKHRoaXMuaW5kZXggPCB0aGlzLmRhdGEubGVuZ3RoKSB7XG4gICAgICAgICAgICBjb25zdCBwYXlsb2FkVHlwZSA9IHRoaXMuZGF0YS5yZWFkVUludDgodGhpcy5pbmRleCsrKTtcbiAgICAgICAgICAgIGlmIChwYXlsb2FkVHlwZSA9PT0gMCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGJzb25TaXplID0gdGhpcy5kYXRhLnJlYWRVSW50MzJMRSh0aGlzLmluZGV4KTtcbiAgICAgICAgICAgICAgICBjb25zdCBiaW4gPSB0aGlzLmRhdGEuc2xpY2UodGhpcy5pbmRleCwgdGhpcy5pbmRleCArIGJzb25TaXplKTtcbiAgICAgICAgICAgICAgICB0aGlzLmRvY3VtZW50cy5wdXNoKHJhdyA/IGJpbiA6IEJTT04uZGVzZXJpYWxpemUoYmluLCBic29uT3B0aW9ucykpO1xuICAgICAgICAgICAgICAgIHRoaXMuaW5kZXggKz0gYnNvblNpemU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChwYXlsb2FkVHlwZSA9PT0gMSkge1xuICAgICAgICAgICAgICAgIC8vIEl0IHdhcyBkZWNpZGVkIHRoYXQgbm8gZHJpdmVyIG1ha2VzIHVzZSBvZiBwYXlsb2FkIHR5cGUgMVxuICAgICAgICAgICAgICAgIC8vIFRPRE8oTk9ERS0zNDgzKTogUmVwbGFjZSB3aXRoIE1vbmdvRGVwcmVjYXRpb25FcnJvclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUnVudGltZUVycm9yKCdPUF9NU0cgUGF5bG9hZCBUeXBlIDEgZGV0ZWN0ZWQgdW5zdXBwb3J0ZWQgcHJvdG9jb2wnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5kb2N1bWVudHMubGVuZ3RoID09PSAxICYmIGRvY3VtZW50c1JldHVybmVkSW4gIT0gbnVsbCAmJiByYXcpIHtcbiAgICAgICAgICAgIGNvbnN0IGZpZWxkc0FzUmF3ID0ge307XG4gICAgICAgICAgICBmaWVsZHNBc1Jhd1tkb2N1bWVudHNSZXR1cm5lZEluXSA9IHRydWU7XG4gICAgICAgICAgICBic29uT3B0aW9ucy5maWVsZHNBc1JhdyA9IGZpZWxkc0FzUmF3O1xuICAgICAgICAgICAgY29uc3QgZG9jID0gQlNPTi5kZXNlcmlhbGl6ZSh0aGlzLmRvY3VtZW50c1swXSwgYnNvbk9wdGlvbnMpO1xuICAgICAgICAgICAgdGhpcy5kb2N1bWVudHMgPSBbZG9jXTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnBhcnNlZCA9IHRydWU7XG4gICAgfVxuICAgIHBhcnNlQnNvblNlcmlhbGl6YXRpb25PcHRpb25zKHsgZW5hYmxlVXRmOFZhbGlkYXRpb24gfSkge1xuICAgICAgICBpZiAoZW5hYmxlVXRmOFZhbGlkYXRpb24gPT09IGZhbHNlKSB7XG4gICAgICAgICAgICByZXR1cm4geyB1dGY4OiBmYWxzZSB9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7IHV0Zjg6IHsgd3JpdGVFcnJvcnM6IGZhbHNlIH0gfTtcbiAgICB9XG59XG5leHBvcnRzLkJpbk1zZyA9IEJpbk1zZztcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWNvbW1hbmRzLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/cmap/commands.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/cmap/connect.js":
/*!**********************************************************!*\
  !*** ../server/node_modules/mongodb/lib/cmap/connect.js ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.LEGAL_TCP_SOCKET_OPTIONS = exports.LEGAL_TLS_SOCKET_OPTIONS = exports.prepareHandshakeDocument = exports.connect = exports.AUTH_PROVIDERS = void 0;\nconst net = __webpack_require__(/*! net */ \"net\");\nconst socks_1 = __webpack_require__(/*! socks */ \"(api)/../server/node_modules/socks/build/index.js\");\nconst tls = __webpack_require__(/*! tls */ \"tls\");\nconst constants_1 = __webpack_require__(/*! ../constants */ \"(api)/../server/node_modules/mongodb/lib/constants.js\");\nconst error_1 = __webpack_require__(/*! ../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\nconst auth_provider_1 = __webpack_require__(/*! ./auth/auth_provider */ \"(api)/../server/node_modules/mongodb/lib/cmap/auth/auth_provider.js\");\nconst gssapi_1 = __webpack_require__(/*! ./auth/gssapi */ \"(api)/../server/node_modules/mongodb/lib/cmap/auth/gssapi.js\");\nconst mongocr_1 = __webpack_require__(/*! ./auth/mongocr */ \"(api)/../server/node_modules/mongodb/lib/cmap/auth/mongocr.js\");\nconst mongodb_aws_1 = __webpack_require__(/*! ./auth/mongodb_aws */ \"(api)/../server/node_modules/mongodb/lib/cmap/auth/mongodb_aws.js\");\nconst mongodb_oidc_1 = __webpack_require__(/*! ./auth/mongodb_oidc */ \"(api)/../server/node_modules/mongodb/lib/cmap/auth/mongodb_oidc.js\");\nconst plain_1 = __webpack_require__(/*! ./auth/plain */ \"(api)/../server/node_modules/mongodb/lib/cmap/auth/plain.js\");\nconst providers_1 = __webpack_require__(/*! ./auth/providers */ \"(api)/../server/node_modules/mongodb/lib/cmap/auth/providers.js\");\nconst scram_1 = __webpack_require__(/*! ./auth/scram */ \"(api)/../server/node_modules/mongodb/lib/cmap/auth/scram.js\");\nconst x509_1 = __webpack_require__(/*! ./auth/x509 */ \"(api)/../server/node_modules/mongodb/lib/cmap/auth/x509.js\");\nconst connection_1 = __webpack_require__(/*! ./connection */ \"(api)/../server/node_modules/mongodb/lib/cmap/connection.js\");\nconst constants_2 = __webpack_require__(/*! ./wire_protocol/constants */ \"(api)/../server/node_modules/mongodb/lib/cmap/wire_protocol/constants.js\");\n/** @internal */\nexports.AUTH_PROVIDERS = new Map([\n    [providers_1.AuthMechanism.MONGODB_AWS, new mongodb_aws_1.MongoDBAWS()],\n    [providers_1.AuthMechanism.MONGODB_CR, new mongocr_1.MongoCR()],\n    [providers_1.AuthMechanism.MONGODB_GSSAPI, new gssapi_1.GSSAPI()],\n    [providers_1.AuthMechanism.MONGODB_OIDC, new mongodb_oidc_1.MongoDBOIDC()],\n    [providers_1.AuthMechanism.MONGODB_PLAIN, new plain_1.Plain()],\n    [providers_1.AuthMechanism.MONGODB_SCRAM_SHA1, new scram_1.ScramSHA1()],\n    [providers_1.AuthMechanism.MONGODB_SCRAM_SHA256, new scram_1.ScramSHA256()],\n    [providers_1.AuthMechanism.MONGODB_X509, new x509_1.X509()]\n]);\nfunction connect(options, callback) {\n    makeConnection({ ...options, existingSocket: undefined }, (err, socket) => {\n        if (err || !socket) {\n            return callback(err);\n        }\n        let ConnectionType = options.connectionType ?? connection_1.Connection;\n        if (options.autoEncrypter) {\n            ConnectionType = connection_1.CryptoConnection;\n        }\n        const connection = new ConnectionType(socket, options);\n        performInitialHandshake(connection, options).then(() => callback(undefined, connection), error => {\n            connection.destroy({ force: false });\n            callback(error);\n        });\n    });\n}\nexports.connect = connect;\nfunction checkSupportedServer(hello, options) {\n    const maxWireVersion = Number(hello.maxWireVersion);\n    const minWireVersion = Number(hello.minWireVersion);\n    const serverVersionHighEnough = !Number.isNaN(maxWireVersion) && maxWireVersion >= constants_2.MIN_SUPPORTED_WIRE_VERSION;\n    const serverVersionLowEnough = !Number.isNaN(minWireVersion) && minWireVersion <= constants_2.MAX_SUPPORTED_WIRE_VERSION;\n    if (serverVersionHighEnough) {\n        if (serverVersionLowEnough) {\n            return null;\n        }\n        const message = `Server at ${options.hostAddress} reports minimum wire version ${JSON.stringify(hello.minWireVersion)}, but this version of the Node.js Driver requires at most ${constants_2.MAX_SUPPORTED_WIRE_VERSION} (MongoDB ${constants_2.MAX_SUPPORTED_SERVER_VERSION})`;\n        return new error_1.MongoCompatibilityError(message);\n    }\n    const message = `Server at ${options.hostAddress} reports maximum wire version ${JSON.stringify(hello.maxWireVersion) ?? 0}, but this version of the Node.js Driver requires at least ${constants_2.MIN_SUPPORTED_WIRE_VERSION} (MongoDB ${constants_2.MIN_SUPPORTED_SERVER_VERSION})`;\n    return new error_1.MongoCompatibilityError(message);\n}\nasync function performInitialHandshake(conn, options) {\n    const credentials = options.credentials;\n    if (credentials) {\n        if (!(credentials.mechanism === providers_1.AuthMechanism.MONGODB_DEFAULT) &&\n            !exports.AUTH_PROVIDERS.get(credentials.mechanism)) {\n            throw new error_1.MongoInvalidArgumentError(`AuthMechanism '${credentials.mechanism}' not supported`);\n        }\n    }\n    const authContext = new auth_provider_1.AuthContext(conn, credentials, options);\n    conn.authContext = authContext;\n    const handshakeDoc = await prepareHandshakeDocument(authContext);\n    // @ts-expect-error: TODO(NODE-5141): The options need to be filtered properly, Connection options differ from Command options\n    const handshakeOptions = { ...options };\n    if (typeof options.connectTimeoutMS === 'number') {\n        // The handshake technically is a monitoring check, so its socket timeout should be connectTimeoutMS\n        handshakeOptions.socketTimeoutMS = options.connectTimeoutMS;\n    }\n    const start = new Date().getTime();\n    const response = await conn.commandAsync((0, utils_1.ns)('admin.$cmd'), handshakeDoc, handshakeOptions);\n    if (!('isWritablePrimary' in response)) {\n        // Provide hello-style response document.\n        response.isWritablePrimary = response[constants_1.LEGACY_HELLO_COMMAND];\n    }\n    if (response.helloOk) {\n        conn.helloOk = true;\n    }\n    const supportedServerErr = checkSupportedServer(response, options);\n    if (supportedServerErr) {\n        throw supportedServerErr;\n    }\n    if (options.loadBalanced) {\n        if (!response.serviceId) {\n            throw new error_1.MongoCompatibilityError('Driver attempted to initialize in load balancing mode, ' +\n                'but the server does not support this mode.');\n        }\n    }\n    // NOTE: This is metadata attached to the connection while porting away from\n    //       handshake being done in the `Server` class. Likely, it should be\n    //       relocated, or at very least restructured.\n    conn.hello = response;\n    conn.lastHelloMS = new Date().getTime() - start;\n    if (!response.arbiterOnly && credentials) {\n        // store the response on auth context\n        authContext.response = response;\n        const resolvedCredentials = credentials.resolveAuthMechanism(response);\n        const provider = exports.AUTH_PROVIDERS.get(resolvedCredentials.mechanism);\n        if (!provider) {\n            throw new error_1.MongoInvalidArgumentError(`No AuthProvider for ${resolvedCredentials.mechanism} defined.`);\n        }\n        try {\n            await provider.auth(authContext);\n        }\n        catch (error) {\n            if (error instanceof error_1.MongoError) {\n                error.addErrorLabel(error_1.MongoErrorLabel.HandshakeError);\n                if ((0, error_1.needsRetryableWriteLabel)(error, response.maxWireVersion)) {\n                    error.addErrorLabel(error_1.MongoErrorLabel.RetryableWriteError);\n                }\n            }\n            throw error;\n        }\n    }\n}\n/**\n * @internal\n *\n * This function is only exposed for testing purposes.\n */\nasync function prepareHandshakeDocument(authContext) {\n    const options = authContext.options;\n    const compressors = options.compressors ? options.compressors : [];\n    const { serverApi } = authContext.connection;\n    const handshakeDoc = {\n        [serverApi?.version ? 'hello' : constants_1.LEGACY_HELLO_COMMAND]: 1,\n        helloOk: true,\n        client: options.metadata,\n        compression: compressors\n    };\n    if (options.loadBalanced === true) {\n        handshakeDoc.loadBalanced = true;\n    }\n    const credentials = authContext.credentials;\n    if (credentials) {\n        if (credentials.mechanism === providers_1.AuthMechanism.MONGODB_DEFAULT && credentials.username) {\n            handshakeDoc.saslSupportedMechs = `${credentials.source}.${credentials.username}`;\n            const provider = exports.AUTH_PROVIDERS.get(providers_1.AuthMechanism.MONGODB_SCRAM_SHA256);\n            if (!provider) {\n                // This auth mechanism is always present.\n                throw new error_1.MongoInvalidArgumentError(`No AuthProvider for ${providers_1.AuthMechanism.MONGODB_SCRAM_SHA256} defined.`);\n            }\n            return provider.prepare(handshakeDoc, authContext);\n        }\n        const provider = exports.AUTH_PROVIDERS.get(credentials.mechanism);\n        if (!provider) {\n            throw new error_1.MongoInvalidArgumentError(`No AuthProvider for ${credentials.mechanism} defined.`);\n        }\n        return provider.prepare(handshakeDoc, authContext);\n    }\n    return handshakeDoc;\n}\nexports.prepareHandshakeDocument = prepareHandshakeDocument;\n/** @public */\nexports.LEGAL_TLS_SOCKET_OPTIONS = [\n    'ALPNProtocols',\n    'ca',\n    'cert',\n    'checkServerIdentity',\n    'ciphers',\n    'crl',\n    'ecdhCurve',\n    'key',\n    'minDHSize',\n    'passphrase',\n    'pfx',\n    'rejectUnauthorized',\n    'secureContext',\n    'secureProtocol',\n    'servername',\n    'session'\n];\n/** @public */\nexports.LEGAL_TCP_SOCKET_OPTIONS = [\n    'family',\n    'hints',\n    'localAddress',\n    'localPort',\n    'lookup'\n];\nfunction parseConnectOptions(options) {\n    const hostAddress = options.hostAddress;\n    if (!hostAddress)\n        throw new error_1.MongoInvalidArgumentError('Option \"hostAddress\" is required');\n    const result = {};\n    for (const name of exports.LEGAL_TCP_SOCKET_OPTIONS) {\n        if (options[name] != null) {\n            result[name] = options[name];\n        }\n    }\n    if (typeof hostAddress.socketPath === 'string') {\n        result.path = hostAddress.socketPath;\n        return result;\n    }\n    else if (typeof hostAddress.host === 'string') {\n        result.host = hostAddress.host;\n        result.port = hostAddress.port;\n        return result;\n    }\n    else {\n        // This should never happen since we set up HostAddresses\n        // But if we don't throw here the socket could hang until timeout\n        // TODO(NODE-3483)\n        throw new error_1.MongoRuntimeError(`Unexpected HostAddress ${JSON.stringify(hostAddress)}`);\n    }\n}\nfunction parseSslOptions(options) {\n    const result = parseConnectOptions(options);\n    // Merge in valid SSL options\n    for (const name of exports.LEGAL_TLS_SOCKET_OPTIONS) {\n        if (options[name] != null) {\n            result[name] = options[name];\n        }\n    }\n    if (options.existingSocket) {\n        result.socket = options.existingSocket;\n    }\n    // Set default sni servername to be the same as host\n    if (result.servername == null && result.host && !net.isIP(result.host)) {\n        result.servername = result.host;\n    }\n    return result;\n}\nconst SOCKET_ERROR_EVENT_LIST = ['error', 'close', 'timeout', 'parseError'];\nconst SOCKET_ERROR_EVENTS = new Set(SOCKET_ERROR_EVENT_LIST);\nfunction makeConnection(options, _callback) {\n    const useTLS = options.tls ?? false;\n    const keepAlive = options.keepAlive ?? true;\n    const socketTimeoutMS = options.socketTimeoutMS ?? Reflect.get(options, 'socketTimeout') ?? 0;\n    const noDelay = options.noDelay ?? true;\n    const connectTimeoutMS = options.connectTimeoutMS ?? 30000;\n    const rejectUnauthorized = options.rejectUnauthorized ?? true;\n    const keepAliveInitialDelay = ((options.keepAliveInitialDelay ?? 120000) > socketTimeoutMS\n        ? Math.round(socketTimeoutMS / 2)\n        : options.keepAliveInitialDelay) ?? 120000;\n    const existingSocket = options.existingSocket;\n    let socket;\n    const callback = function (err, ret) {\n        if (err && socket) {\n            socket.destroy();\n        }\n        _callback(err, ret);\n    };\n    if (options.proxyHost != null) {\n        // Currently, only Socks5 is supported.\n        return makeSocks5Connection({\n            ...options,\n            connectTimeoutMS // Should always be present for Socks5\n        }, callback);\n    }\n    if (useTLS) {\n        const tlsSocket = tls.connect(parseSslOptions(options));\n        if (typeof tlsSocket.disableRenegotiation === 'function') {\n            tlsSocket.disableRenegotiation();\n        }\n        socket = tlsSocket;\n    }\n    else if (existingSocket) {\n        // In the TLS case, parseSslOptions() sets options.socket to existingSocket,\n        // so we only need to handle the non-TLS case here (where existingSocket\n        // gives us all we need out of the box).\n        socket = existingSocket;\n    }\n    else {\n        socket = net.createConnection(parseConnectOptions(options));\n    }\n    socket.setKeepAlive(keepAlive, keepAliveInitialDelay);\n    socket.setTimeout(connectTimeoutMS);\n    socket.setNoDelay(noDelay);\n    const connectEvent = useTLS ? 'secureConnect' : 'connect';\n    let cancellationHandler;\n    function errorHandler(eventName) {\n        return (err) => {\n            SOCKET_ERROR_EVENTS.forEach(event => socket.removeAllListeners(event));\n            if (cancellationHandler && options.cancellationToken) {\n                options.cancellationToken.removeListener('cancel', cancellationHandler);\n            }\n            socket.removeListener(connectEvent, connectHandler);\n            callback(connectionFailureError(eventName, err));\n        };\n    }\n    function connectHandler() {\n        SOCKET_ERROR_EVENTS.forEach(event => socket.removeAllListeners(event));\n        if (cancellationHandler && options.cancellationToken) {\n            options.cancellationToken.removeListener('cancel', cancellationHandler);\n        }\n        if ('authorizationError' in socket) {\n            if (socket.authorizationError && rejectUnauthorized) {\n                // TODO(NODE-5192): wrap this with a MongoError subclass\n                return callback(socket.authorizationError);\n            }\n        }\n        socket.setTimeout(0);\n        callback(undefined, socket);\n    }\n    SOCKET_ERROR_EVENTS.forEach(event => socket.once(event, errorHandler(event)));\n    if (options.cancellationToken) {\n        cancellationHandler = errorHandler('cancel');\n        options.cancellationToken.once('cancel', cancellationHandler);\n    }\n    if (existingSocket) {\n        process.nextTick(connectHandler);\n    }\n    else {\n        socket.once(connectEvent, connectHandler);\n    }\n}\nfunction makeSocks5Connection(options, callback) {\n    const hostAddress = utils_1.HostAddress.fromHostPort(options.proxyHost ?? '', // proxyHost is guaranteed to set here\n    options.proxyPort ?? 1080);\n    // First, connect to the proxy server itself:\n    makeConnection({\n        ...options,\n        hostAddress,\n        tls: false,\n        proxyHost: undefined\n    }, (err, rawSocket) => {\n        if (err) {\n            return callback(err);\n        }\n        const destination = parseConnectOptions(options);\n        if (typeof destination.host !== 'string' || typeof destination.port !== 'number') {\n            return callback(new error_1.MongoInvalidArgumentError('Can only make Socks5 connections to TCP hosts'));\n        }\n        // Then, establish the Socks5 proxy connection:\n        socks_1.SocksClient.createConnection({\n            existing_socket: rawSocket,\n            timeout: options.connectTimeoutMS,\n            command: 'connect',\n            destination: {\n                host: destination.host,\n                port: destination.port\n            },\n            proxy: {\n                // host and port are ignored because we pass existing_socket\n                host: 'iLoveJavaScript',\n                port: 0,\n                type: 5,\n                userId: options.proxyUsername || undefined,\n                password: options.proxyPassword || undefined\n            }\n        }).then(({ socket }) => {\n            // Finally, now treat the resulting duplex stream as the\n            // socket over which we send and receive wire protocol messages:\n            makeConnection({\n                ...options,\n                existingSocket: socket,\n                proxyHost: undefined\n            }, callback);\n        }, error => callback(connectionFailureError('error', error)));\n    });\n}\nfunction connectionFailureError(type, err) {\n    switch (type) {\n        case 'error':\n            return new error_1.MongoNetworkError(err);\n        case 'timeout':\n            return new error_1.MongoNetworkTimeoutError('connection timed out');\n        case 'close':\n            return new error_1.MongoNetworkError('connection closed');\n        case 'cancel':\n            return new error_1.MongoNetworkError('connection establishment was cancelled');\n        default:\n            return new error_1.MongoNetworkError('unknown network error');\n    }\n}\n//# sourceMappingURL=connect.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jbWFwL2Nvbm5lY3QuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsZ0NBQWdDLEdBQUcsZ0NBQWdDLEdBQUcsZ0NBQWdDLEdBQUcsZUFBZSxHQUFHLHNCQUFzQjtBQUNqSixZQUFZLG1CQUFPLENBQUMsZ0JBQUs7QUFDekIsZ0JBQWdCLG1CQUFPLENBQUMsZ0VBQU87QUFDL0IsWUFBWSxtQkFBTyxDQUFDLGdCQUFLO0FBQ3pCLG9CQUFvQixtQkFBTyxDQUFDLDJFQUFjO0FBQzFDLGdCQUFnQixtQkFBTyxDQUFDLG1FQUFVO0FBQ2xDLGdCQUFnQixtQkFBTyxDQUFDLG1FQUFVO0FBQ2xDLHdCQUF3QixtQkFBTyxDQUFDLGlHQUFzQjtBQUN0RCxpQkFBaUIsbUJBQU8sQ0FBQyxtRkFBZTtBQUN4QyxrQkFBa0IsbUJBQU8sQ0FBQyxxRkFBZ0I7QUFDMUMsc0JBQXNCLG1CQUFPLENBQUMsNkZBQW9CO0FBQ2xELHVCQUF1QixtQkFBTyxDQUFDLCtGQUFxQjtBQUNwRCxnQkFBZ0IsbUJBQU8sQ0FBQyxpRkFBYztBQUN0QyxvQkFBb0IsbUJBQU8sQ0FBQyx5RkFBa0I7QUFDOUMsZ0JBQWdCLG1CQUFPLENBQUMsaUZBQWM7QUFDdEMsZUFBZSxtQkFBTyxDQUFDLCtFQUFhO0FBQ3BDLHFCQUFxQixtQkFBTyxDQUFDLGlGQUFjO0FBQzNDLG9CQUFvQixtQkFBTyxDQUFDLDJHQUEyQjtBQUN2RDtBQUNBLHNCQUFzQjtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQix1Q0FBdUM7QUFDNUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDLGNBQWM7QUFDL0M7QUFDQSxTQUFTO0FBQ1QsS0FBSztBQUNMO0FBQ0EsZUFBZTtBQUNmO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFDQUFxQyxxQkFBcUIsK0JBQStCLHFDQUFxQyw0REFBNEQsd0NBQXdDLFdBQVcseUNBQXlDO0FBQ3RSO0FBQ0E7QUFDQSxpQ0FBaUMscUJBQXFCLCtCQUErQiwwQ0FBMEMsNkRBQTZELHdDQUF3QyxXQUFXLHlDQUF5QztBQUN4UjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBFQUEwRSxzQkFBc0I7QUFDaEc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0JBQStCO0FBQy9CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0VBQStFLCtCQUErQjtBQUM5RztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxZQUFZO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlEQUFpRCxtQkFBbUIsR0FBRyxxQkFBcUI7QUFDNUY7QUFDQTtBQUNBO0FBQ0EsbUZBQW1GLGdEQUFnRDtBQUNuSTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0VBQStFLHVCQUF1QjtBQUN0RztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDO0FBQ2hDO0FBQ0EsZ0NBQWdDO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQztBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0VBQXNFLDRCQUE0QjtBQUNsRztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUyxVQUFVLFFBQVE7QUFDM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIkQ6XFxzYWxvbmlcXGFwcHJhaXNhbC1zeXN0ZW1cXHNlcnZlclxcbm9kZV9tb2R1bGVzXFxtb25nb2RiXFxsaWJcXGNtYXBcXGNvbm5lY3QuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkxFR0FMX1RDUF9TT0NLRVRfT1BUSU9OUyA9IGV4cG9ydHMuTEVHQUxfVExTX1NPQ0tFVF9PUFRJT05TID0gZXhwb3J0cy5wcmVwYXJlSGFuZHNoYWtlRG9jdW1lbnQgPSBleHBvcnRzLmNvbm5lY3QgPSBleHBvcnRzLkFVVEhfUFJPVklERVJTID0gdm9pZCAwO1xuY29uc3QgbmV0ID0gcmVxdWlyZShcIm5ldFwiKTtcbmNvbnN0IHNvY2tzXzEgPSByZXF1aXJlKFwic29ja3NcIik7XG5jb25zdCB0bHMgPSByZXF1aXJlKFwidGxzXCIpO1xuY29uc3QgY29uc3RhbnRzXzEgPSByZXF1aXJlKFwiLi4vY29uc3RhbnRzXCIpO1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuLi9lcnJvclwiKTtcbmNvbnN0IHV0aWxzXzEgPSByZXF1aXJlKFwiLi4vdXRpbHNcIik7XG5jb25zdCBhdXRoX3Byb3ZpZGVyXzEgPSByZXF1aXJlKFwiLi9hdXRoL2F1dGhfcHJvdmlkZXJcIik7XG5jb25zdCBnc3NhcGlfMSA9IHJlcXVpcmUoXCIuL2F1dGgvZ3NzYXBpXCIpO1xuY29uc3QgbW9uZ29jcl8xID0gcmVxdWlyZShcIi4vYXV0aC9tb25nb2NyXCIpO1xuY29uc3QgbW9uZ29kYl9hd3NfMSA9IHJlcXVpcmUoXCIuL2F1dGgvbW9uZ29kYl9hd3NcIik7XG5jb25zdCBtb25nb2RiX29pZGNfMSA9IHJlcXVpcmUoXCIuL2F1dGgvbW9uZ29kYl9vaWRjXCIpO1xuY29uc3QgcGxhaW5fMSA9IHJlcXVpcmUoXCIuL2F1dGgvcGxhaW5cIik7XG5jb25zdCBwcm92aWRlcnNfMSA9IHJlcXVpcmUoXCIuL2F1dGgvcHJvdmlkZXJzXCIpO1xuY29uc3Qgc2NyYW1fMSA9IHJlcXVpcmUoXCIuL2F1dGgvc2NyYW1cIik7XG5jb25zdCB4NTA5XzEgPSByZXF1aXJlKFwiLi9hdXRoL3g1MDlcIik7XG5jb25zdCBjb25uZWN0aW9uXzEgPSByZXF1aXJlKFwiLi9jb25uZWN0aW9uXCIpO1xuY29uc3QgY29uc3RhbnRzXzIgPSByZXF1aXJlKFwiLi93aXJlX3Byb3RvY29sL2NvbnN0YW50c1wiKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmV4cG9ydHMuQVVUSF9QUk9WSURFUlMgPSBuZXcgTWFwKFtcbiAgICBbcHJvdmlkZXJzXzEuQXV0aE1lY2hhbmlzbS5NT05HT0RCX0FXUywgbmV3IG1vbmdvZGJfYXdzXzEuTW9uZ29EQkFXUygpXSxcbiAgICBbcHJvdmlkZXJzXzEuQXV0aE1lY2hhbmlzbS5NT05HT0RCX0NSLCBuZXcgbW9uZ29jcl8xLk1vbmdvQ1IoKV0sXG4gICAgW3Byb3ZpZGVyc18xLkF1dGhNZWNoYW5pc20uTU9OR09EQl9HU1NBUEksIG5ldyBnc3NhcGlfMS5HU1NBUEkoKV0sXG4gICAgW3Byb3ZpZGVyc18xLkF1dGhNZWNoYW5pc20uTU9OR09EQl9PSURDLCBuZXcgbW9uZ29kYl9vaWRjXzEuTW9uZ29EQk9JREMoKV0sXG4gICAgW3Byb3ZpZGVyc18xLkF1dGhNZWNoYW5pc20uTU9OR09EQl9QTEFJTiwgbmV3IHBsYWluXzEuUGxhaW4oKV0sXG4gICAgW3Byb3ZpZGVyc18xLkF1dGhNZWNoYW5pc20uTU9OR09EQl9TQ1JBTV9TSEExLCBuZXcgc2NyYW1fMS5TY3JhbVNIQTEoKV0sXG4gICAgW3Byb3ZpZGVyc18xLkF1dGhNZWNoYW5pc20uTU9OR09EQl9TQ1JBTV9TSEEyNTYsIG5ldyBzY3JhbV8xLlNjcmFtU0hBMjU2KCldLFxuICAgIFtwcm92aWRlcnNfMS5BdXRoTWVjaGFuaXNtLk1PTkdPREJfWDUwOSwgbmV3IHg1MDlfMS5YNTA5KCldXG5dKTtcbmZ1bmN0aW9uIGNvbm5lY3Qob3B0aW9ucywgY2FsbGJhY2spIHtcbiAgICBtYWtlQ29ubmVjdGlvbih7IC4uLm9wdGlvbnMsIGV4aXN0aW5nU29ja2V0OiB1bmRlZmluZWQgfSwgKGVyciwgc29ja2V0KSA9PiB7XG4gICAgICAgIGlmIChlcnIgfHwgIXNvY2tldCkge1xuICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IENvbm5lY3Rpb25UeXBlID0gb3B0aW9ucy5jb25uZWN0aW9uVHlwZSA/PyBjb25uZWN0aW9uXzEuQ29ubmVjdGlvbjtcbiAgICAgICAgaWYgKG9wdGlvbnMuYXV0b0VuY3J5cHRlcikge1xuICAgICAgICAgICAgQ29ubmVjdGlvblR5cGUgPSBjb25uZWN0aW9uXzEuQ3J5cHRvQ29ubmVjdGlvbjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjb25uZWN0aW9uID0gbmV3IENvbm5lY3Rpb25UeXBlKHNvY2tldCwgb3B0aW9ucyk7XG4gICAgICAgIHBlcmZvcm1Jbml0aWFsSGFuZHNoYWtlKGNvbm5lY3Rpb24sIG9wdGlvbnMpLnRoZW4oKCkgPT4gY2FsbGJhY2sodW5kZWZpbmVkLCBjb25uZWN0aW9uKSwgZXJyb3IgPT4ge1xuICAgICAgICAgICAgY29ubmVjdGlvbi5kZXN0cm95KHsgZm9yY2U6IGZhbHNlIH0pO1xuICAgICAgICAgICAgY2FsbGJhY2soZXJyb3IpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuY29ubmVjdCA9IGNvbm5lY3Q7XG5mdW5jdGlvbiBjaGVja1N1cHBvcnRlZFNlcnZlcihoZWxsbywgb3B0aW9ucykge1xuICAgIGNvbnN0IG1heFdpcmVWZXJzaW9uID0gTnVtYmVyKGhlbGxvLm1heFdpcmVWZXJzaW9uKTtcbiAgICBjb25zdCBtaW5XaXJlVmVyc2lvbiA9IE51bWJlcihoZWxsby5taW5XaXJlVmVyc2lvbik7XG4gICAgY29uc3Qgc2VydmVyVmVyc2lvbkhpZ2hFbm91Z2ggPSAhTnVtYmVyLmlzTmFOKG1heFdpcmVWZXJzaW9uKSAmJiBtYXhXaXJlVmVyc2lvbiA+PSBjb25zdGFudHNfMi5NSU5fU1VQUE9SVEVEX1dJUkVfVkVSU0lPTjtcbiAgICBjb25zdCBzZXJ2ZXJWZXJzaW9uTG93RW5vdWdoID0gIU51bWJlci5pc05hTihtaW5XaXJlVmVyc2lvbikgJiYgbWluV2lyZVZlcnNpb24gPD0gY29uc3RhbnRzXzIuTUFYX1NVUFBPUlRFRF9XSVJFX1ZFUlNJT047XG4gICAgaWYgKHNlcnZlclZlcnNpb25IaWdoRW5vdWdoKSB7XG4gICAgICAgIGlmIChzZXJ2ZXJWZXJzaW9uTG93RW5vdWdoKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBtZXNzYWdlID0gYFNlcnZlciBhdCAke29wdGlvbnMuaG9zdEFkZHJlc3N9IHJlcG9ydHMgbWluaW11bSB3aXJlIHZlcnNpb24gJHtKU09OLnN0cmluZ2lmeShoZWxsby5taW5XaXJlVmVyc2lvbil9LCBidXQgdGhpcyB2ZXJzaW9uIG9mIHRoZSBOb2RlLmpzIERyaXZlciByZXF1aXJlcyBhdCBtb3N0ICR7Y29uc3RhbnRzXzIuTUFYX1NVUFBPUlRFRF9XSVJFX1ZFUlNJT059IChNb25nb0RCICR7Y29uc3RhbnRzXzIuTUFYX1NVUFBPUlRFRF9TRVJWRVJfVkVSU0lPTn0pYDtcbiAgICAgICAgcmV0dXJuIG5ldyBlcnJvcl8xLk1vbmdvQ29tcGF0aWJpbGl0eUVycm9yKG1lc3NhZ2UpO1xuICAgIH1cbiAgICBjb25zdCBtZXNzYWdlID0gYFNlcnZlciBhdCAke29wdGlvbnMuaG9zdEFkZHJlc3N9IHJlcG9ydHMgbWF4aW11bSB3aXJlIHZlcnNpb24gJHtKU09OLnN0cmluZ2lmeShoZWxsby5tYXhXaXJlVmVyc2lvbikgPz8gMH0sIGJ1dCB0aGlzIHZlcnNpb24gb2YgdGhlIE5vZGUuanMgRHJpdmVyIHJlcXVpcmVzIGF0IGxlYXN0ICR7Y29uc3RhbnRzXzIuTUlOX1NVUFBPUlRFRF9XSVJFX1ZFUlNJT059IChNb25nb0RCICR7Y29uc3RhbnRzXzIuTUlOX1NVUFBPUlRFRF9TRVJWRVJfVkVSU0lPTn0pYDtcbiAgICByZXR1cm4gbmV3IGVycm9yXzEuTW9uZ29Db21wYXRpYmlsaXR5RXJyb3IobWVzc2FnZSk7XG59XG5hc3luYyBmdW5jdGlvbiBwZXJmb3JtSW5pdGlhbEhhbmRzaGFrZShjb25uLCBvcHRpb25zKSB7XG4gICAgY29uc3QgY3JlZGVudGlhbHMgPSBvcHRpb25zLmNyZWRlbnRpYWxzO1xuICAgIGlmIChjcmVkZW50aWFscykge1xuICAgICAgICBpZiAoIShjcmVkZW50aWFscy5tZWNoYW5pc20gPT09IHByb3ZpZGVyc18xLkF1dGhNZWNoYW5pc20uTU9OR09EQl9ERUZBVUxUKSAmJlxuICAgICAgICAgICAgIWV4cG9ydHMuQVVUSF9QUk9WSURFUlMuZ2V0KGNyZWRlbnRpYWxzLm1lY2hhbmlzbSkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoYEF1dGhNZWNoYW5pc20gJyR7Y3JlZGVudGlhbHMubWVjaGFuaXNtfScgbm90IHN1cHBvcnRlZGApO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbnN0IGF1dGhDb250ZXh0ID0gbmV3IGF1dGhfcHJvdmlkZXJfMS5BdXRoQ29udGV4dChjb25uLCBjcmVkZW50aWFscywgb3B0aW9ucyk7XG4gICAgY29ubi5hdXRoQ29udGV4dCA9IGF1dGhDb250ZXh0O1xuICAgIGNvbnN0IGhhbmRzaGFrZURvYyA9IGF3YWl0IHByZXBhcmVIYW5kc2hha2VEb2N1bWVudChhdXRoQ29udGV4dCk7XG4gICAgLy8gQHRzLWV4cGVjdC1lcnJvcjogVE9ETyhOT0RFLTUxNDEpOiBUaGUgb3B0aW9ucyBuZWVkIHRvIGJlIGZpbHRlcmVkIHByb3Blcmx5LCBDb25uZWN0aW9uIG9wdGlvbnMgZGlmZmVyIGZyb20gQ29tbWFuZCBvcHRpb25zXG4gICAgY29uc3QgaGFuZHNoYWtlT3B0aW9ucyA9IHsgLi4ub3B0aW9ucyB9O1xuICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5jb25uZWN0VGltZW91dE1TID09PSAnbnVtYmVyJykge1xuICAgICAgICAvLyBUaGUgaGFuZHNoYWtlIHRlY2huaWNhbGx5IGlzIGEgbW9uaXRvcmluZyBjaGVjaywgc28gaXRzIHNvY2tldCB0aW1lb3V0IHNob3VsZCBiZSBjb25uZWN0VGltZW91dE1TXG4gICAgICAgIGhhbmRzaGFrZU9wdGlvbnMuc29ja2V0VGltZW91dE1TID0gb3B0aW9ucy5jb25uZWN0VGltZW91dE1TO1xuICAgIH1cbiAgICBjb25zdCBzdGFydCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgY29ubi5jb21tYW5kQXN5bmMoKDAsIHV0aWxzXzEubnMpKCdhZG1pbi4kY21kJyksIGhhbmRzaGFrZURvYywgaGFuZHNoYWtlT3B0aW9ucyk7XG4gICAgaWYgKCEoJ2lzV3JpdGFibGVQcmltYXJ5JyBpbiByZXNwb25zZSkpIHtcbiAgICAgICAgLy8gUHJvdmlkZSBoZWxsby1zdHlsZSByZXNwb25zZSBkb2N1bWVudC5cbiAgICAgICAgcmVzcG9uc2UuaXNXcml0YWJsZVByaW1hcnkgPSByZXNwb25zZVtjb25zdGFudHNfMS5MRUdBQ1lfSEVMTE9fQ09NTUFORF07XG4gICAgfVxuICAgIGlmIChyZXNwb25zZS5oZWxsb09rKSB7XG4gICAgICAgIGNvbm4uaGVsbG9PayA9IHRydWU7XG4gICAgfVxuICAgIGNvbnN0IHN1cHBvcnRlZFNlcnZlckVyciA9IGNoZWNrU3VwcG9ydGVkU2VydmVyKHJlc3BvbnNlLCBvcHRpb25zKTtcbiAgICBpZiAoc3VwcG9ydGVkU2VydmVyRXJyKSB7XG4gICAgICAgIHRocm93IHN1cHBvcnRlZFNlcnZlckVycjtcbiAgICB9XG4gICAgaWYgKG9wdGlvbnMubG9hZEJhbGFuY2VkKSB7XG4gICAgICAgIGlmICghcmVzcG9uc2Uuc2VydmljZUlkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0NvbXBhdGliaWxpdHlFcnJvcignRHJpdmVyIGF0dGVtcHRlZCB0byBpbml0aWFsaXplIGluIGxvYWQgYmFsYW5jaW5nIG1vZGUsICcgK1xuICAgICAgICAgICAgICAgICdidXQgdGhlIHNlcnZlciBkb2VzIG5vdCBzdXBwb3J0IHRoaXMgbW9kZS4nKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvLyBOT1RFOiBUaGlzIGlzIG1ldGFkYXRhIGF0dGFjaGVkIHRvIHRoZSBjb25uZWN0aW9uIHdoaWxlIHBvcnRpbmcgYXdheSBmcm9tXG4gICAgLy8gICAgICAgaGFuZHNoYWtlIGJlaW5nIGRvbmUgaW4gdGhlIGBTZXJ2ZXJgIGNsYXNzLiBMaWtlbHksIGl0IHNob3VsZCBiZVxuICAgIC8vICAgICAgIHJlbG9jYXRlZCwgb3IgYXQgdmVyeSBsZWFzdCByZXN0cnVjdHVyZWQuXG4gICAgY29ubi5oZWxsbyA9IHJlc3BvbnNlO1xuICAgIGNvbm4ubGFzdEhlbGxvTVMgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIHN0YXJ0O1xuICAgIGlmICghcmVzcG9uc2UuYXJiaXRlck9ubHkgJiYgY3JlZGVudGlhbHMpIHtcbiAgICAgICAgLy8gc3RvcmUgdGhlIHJlc3BvbnNlIG9uIGF1dGggY29udGV4dFxuICAgICAgICBhdXRoQ29udGV4dC5yZXNwb25zZSA9IHJlc3BvbnNlO1xuICAgICAgICBjb25zdCByZXNvbHZlZENyZWRlbnRpYWxzID0gY3JlZGVudGlhbHMucmVzb2x2ZUF1dGhNZWNoYW5pc20ocmVzcG9uc2UpO1xuICAgICAgICBjb25zdCBwcm92aWRlciA9IGV4cG9ydHMuQVVUSF9QUk9WSURFUlMuZ2V0KHJlc29sdmVkQ3JlZGVudGlhbHMubWVjaGFuaXNtKTtcbiAgICAgICAgaWYgKCFwcm92aWRlcikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcihgTm8gQXV0aFByb3ZpZGVyIGZvciAke3Jlc29sdmVkQ3JlZGVudGlhbHMubWVjaGFuaXNtfSBkZWZpbmVkLmApO1xuICAgICAgICB9XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCBwcm92aWRlci5hdXRoKGF1dGhDb250ZXh0KTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIGVycm9yXzEuTW9uZ29FcnJvcikge1xuICAgICAgICAgICAgICAgIGVycm9yLmFkZEVycm9yTGFiZWwoZXJyb3JfMS5Nb25nb0Vycm9yTGFiZWwuSGFuZHNoYWtlRXJyb3IpO1xuICAgICAgICAgICAgICAgIGlmICgoMCwgZXJyb3JfMS5uZWVkc1JldHJ5YWJsZVdyaXRlTGFiZWwpKGVycm9yLCByZXNwb25zZS5tYXhXaXJlVmVyc2lvbikpIHtcbiAgICAgICAgICAgICAgICAgICAgZXJyb3IuYWRkRXJyb3JMYWJlbChlcnJvcl8xLk1vbmdvRXJyb3JMYWJlbC5SZXRyeWFibGVXcml0ZUVycm9yKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgfVxuICAgIH1cbn1cbi8qKlxuICogQGludGVybmFsXG4gKlxuICogVGhpcyBmdW5jdGlvbiBpcyBvbmx5IGV4cG9zZWQgZm9yIHRlc3RpbmcgcHVycG9zZXMuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHByZXBhcmVIYW5kc2hha2VEb2N1bWVudChhdXRoQ29udGV4dCkge1xuICAgIGNvbnN0IG9wdGlvbnMgPSBhdXRoQ29udGV4dC5vcHRpb25zO1xuICAgIGNvbnN0IGNvbXByZXNzb3JzID0gb3B0aW9ucy5jb21wcmVzc29ycyA/IG9wdGlvbnMuY29tcHJlc3NvcnMgOiBbXTtcbiAgICBjb25zdCB7IHNlcnZlckFwaSB9ID0gYXV0aENvbnRleHQuY29ubmVjdGlvbjtcbiAgICBjb25zdCBoYW5kc2hha2VEb2MgPSB7XG4gICAgICAgIFtzZXJ2ZXJBcGk/LnZlcnNpb24gPyAnaGVsbG8nIDogY29uc3RhbnRzXzEuTEVHQUNZX0hFTExPX0NPTU1BTkRdOiAxLFxuICAgICAgICBoZWxsb09rOiB0cnVlLFxuICAgICAgICBjbGllbnQ6IG9wdGlvbnMubWV0YWRhdGEsXG4gICAgICAgIGNvbXByZXNzaW9uOiBjb21wcmVzc29yc1xuICAgIH07XG4gICAgaWYgKG9wdGlvbnMubG9hZEJhbGFuY2VkID09PSB0cnVlKSB7XG4gICAgICAgIGhhbmRzaGFrZURvYy5sb2FkQmFsYW5jZWQgPSB0cnVlO1xuICAgIH1cbiAgICBjb25zdCBjcmVkZW50aWFscyA9IGF1dGhDb250ZXh0LmNyZWRlbnRpYWxzO1xuICAgIGlmIChjcmVkZW50aWFscykge1xuICAgICAgICBpZiAoY3JlZGVudGlhbHMubWVjaGFuaXNtID09PSBwcm92aWRlcnNfMS5BdXRoTWVjaGFuaXNtLk1PTkdPREJfREVGQVVMVCAmJiBjcmVkZW50aWFscy51c2VybmFtZSkge1xuICAgICAgICAgICAgaGFuZHNoYWtlRG9jLnNhc2xTdXBwb3J0ZWRNZWNocyA9IGAke2NyZWRlbnRpYWxzLnNvdXJjZX0uJHtjcmVkZW50aWFscy51c2VybmFtZX1gO1xuICAgICAgICAgICAgY29uc3QgcHJvdmlkZXIgPSBleHBvcnRzLkFVVEhfUFJPVklERVJTLmdldChwcm92aWRlcnNfMS5BdXRoTWVjaGFuaXNtLk1PTkdPREJfU0NSQU1fU0hBMjU2KTtcbiAgICAgICAgICAgIGlmICghcHJvdmlkZXIpIHtcbiAgICAgICAgICAgICAgICAvLyBUaGlzIGF1dGggbWVjaGFuaXNtIGlzIGFsd2F5cyBwcmVzZW50LlxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoYE5vIEF1dGhQcm92aWRlciBmb3IgJHtwcm92aWRlcnNfMS5BdXRoTWVjaGFuaXNtLk1PTkdPREJfU0NSQU1fU0hBMjU2fSBkZWZpbmVkLmApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHByb3ZpZGVyLnByZXBhcmUoaGFuZHNoYWtlRG9jLCBhdXRoQ29udGV4dCk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcHJvdmlkZXIgPSBleHBvcnRzLkFVVEhfUFJPVklERVJTLmdldChjcmVkZW50aWFscy5tZWNoYW5pc20pO1xuICAgICAgICBpZiAoIXByb3ZpZGVyKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKGBObyBBdXRoUHJvdmlkZXIgZm9yICR7Y3JlZGVudGlhbHMubWVjaGFuaXNtfSBkZWZpbmVkLmApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBwcm92aWRlci5wcmVwYXJlKGhhbmRzaGFrZURvYywgYXV0aENvbnRleHQpO1xuICAgIH1cbiAgICByZXR1cm4gaGFuZHNoYWtlRG9jO1xufVxuZXhwb3J0cy5wcmVwYXJlSGFuZHNoYWtlRG9jdW1lbnQgPSBwcmVwYXJlSGFuZHNoYWtlRG9jdW1lbnQ7XG4vKiogQHB1YmxpYyAqL1xuZXhwb3J0cy5MRUdBTF9UTFNfU09DS0VUX09QVElPTlMgPSBbXG4gICAgJ0FMUE5Qcm90b2NvbHMnLFxuICAgICdjYScsXG4gICAgJ2NlcnQnLFxuICAgICdjaGVja1NlcnZlcklkZW50aXR5JyxcbiAgICAnY2lwaGVycycsXG4gICAgJ2NybCcsXG4gICAgJ2VjZGhDdXJ2ZScsXG4gICAgJ2tleScsXG4gICAgJ21pbkRIU2l6ZScsXG4gICAgJ3Bhc3NwaHJhc2UnLFxuICAgICdwZngnLFxuICAgICdyZWplY3RVbmF1dGhvcml6ZWQnLFxuICAgICdzZWN1cmVDb250ZXh0JyxcbiAgICAnc2VjdXJlUHJvdG9jb2wnLFxuICAgICdzZXJ2ZXJuYW1lJyxcbiAgICAnc2Vzc2lvbidcbl07XG4vKiogQHB1YmxpYyAqL1xuZXhwb3J0cy5MRUdBTF9UQ1BfU09DS0VUX09QVElPTlMgPSBbXG4gICAgJ2ZhbWlseScsXG4gICAgJ2hpbnRzJyxcbiAgICAnbG9jYWxBZGRyZXNzJyxcbiAgICAnbG9jYWxQb3J0JyxcbiAgICAnbG9va3VwJ1xuXTtcbmZ1bmN0aW9uIHBhcnNlQ29ubmVjdE9wdGlvbnMob3B0aW9ucykge1xuICAgIGNvbnN0IGhvc3RBZGRyZXNzID0gb3B0aW9ucy5ob3N0QWRkcmVzcztcbiAgICBpZiAoIWhvc3RBZGRyZXNzKVxuICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdPcHRpb24gXCJob3N0QWRkcmVzc1wiIGlzIHJlcXVpcmVkJyk7XG4gICAgY29uc3QgcmVzdWx0ID0ge307XG4gICAgZm9yIChjb25zdCBuYW1lIG9mIGV4cG9ydHMuTEVHQUxfVENQX1NPQ0tFVF9PUFRJT05TKSB7XG4gICAgICAgIGlmIChvcHRpb25zW25hbWVdICE9IG51bGwpIHtcbiAgICAgICAgICAgIHJlc3VsdFtuYW1lXSA9IG9wdGlvbnNbbmFtZV07XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKHR5cGVvZiBob3N0QWRkcmVzcy5zb2NrZXRQYXRoID09PSAnc3RyaW5nJykge1xuICAgICAgICByZXN1bHQucGF0aCA9IGhvc3RBZGRyZXNzLnNvY2tldFBhdGg7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuICAgIGVsc2UgaWYgKHR5cGVvZiBob3N0QWRkcmVzcy5ob3N0ID09PSAnc3RyaW5nJykge1xuICAgICAgICByZXN1bHQuaG9zdCA9IGhvc3RBZGRyZXNzLmhvc3Q7XG4gICAgICAgIHJlc3VsdC5wb3J0ID0gaG9zdEFkZHJlc3MucG9ydDtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIC8vIFRoaXMgc2hvdWxkIG5ldmVyIGhhcHBlbiBzaW5jZSB3ZSBzZXQgdXAgSG9zdEFkZHJlc3Nlc1xuICAgICAgICAvLyBCdXQgaWYgd2UgZG9uJ3QgdGhyb3cgaGVyZSB0aGUgc29ja2V0IGNvdWxkIGhhbmcgdW50aWwgdGltZW91dFxuICAgICAgICAvLyBUT0RPKE5PREUtMzQ4MylcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29SdW50aW1lRXJyb3IoYFVuZXhwZWN0ZWQgSG9zdEFkZHJlc3MgJHtKU09OLnN0cmluZ2lmeShob3N0QWRkcmVzcyl9YCk7XG4gICAgfVxufVxuZnVuY3Rpb24gcGFyc2VTc2xPcHRpb25zKG9wdGlvbnMpIHtcbiAgICBjb25zdCByZXN1bHQgPSBwYXJzZUNvbm5lY3RPcHRpb25zKG9wdGlvbnMpO1xuICAgIC8vIE1lcmdlIGluIHZhbGlkIFNTTCBvcHRpb25zXG4gICAgZm9yIChjb25zdCBuYW1lIG9mIGV4cG9ydHMuTEVHQUxfVExTX1NPQ0tFVF9PUFRJT05TKSB7XG4gICAgICAgIGlmIChvcHRpb25zW25hbWVdICE9IG51bGwpIHtcbiAgICAgICAgICAgIHJlc3VsdFtuYW1lXSA9IG9wdGlvbnNbbmFtZV07XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKG9wdGlvbnMuZXhpc3RpbmdTb2NrZXQpIHtcbiAgICAgICAgcmVzdWx0LnNvY2tldCA9IG9wdGlvbnMuZXhpc3RpbmdTb2NrZXQ7XG4gICAgfVxuICAgIC8vIFNldCBkZWZhdWx0IHNuaSBzZXJ2ZXJuYW1lIHRvIGJlIHRoZSBzYW1lIGFzIGhvc3RcbiAgICBpZiAocmVzdWx0LnNlcnZlcm5hbWUgPT0gbnVsbCAmJiByZXN1bHQuaG9zdCAmJiAhbmV0LmlzSVAocmVzdWx0Lmhvc3QpKSB7XG4gICAgICAgIHJlc3VsdC5zZXJ2ZXJuYW1lID0gcmVzdWx0Lmhvc3Q7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG59XG5jb25zdCBTT0NLRVRfRVJST1JfRVZFTlRfTElTVCA9IFsnZXJyb3InLCAnY2xvc2UnLCAndGltZW91dCcsICdwYXJzZUVycm9yJ107XG5jb25zdCBTT0NLRVRfRVJST1JfRVZFTlRTID0gbmV3IFNldChTT0NLRVRfRVJST1JfRVZFTlRfTElTVCk7XG5mdW5jdGlvbiBtYWtlQ29ubmVjdGlvbihvcHRpb25zLCBfY2FsbGJhY2spIHtcbiAgICBjb25zdCB1c2VUTFMgPSBvcHRpb25zLnRscyA/PyBmYWxzZTtcbiAgICBjb25zdCBrZWVwQWxpdmUgPSBvcHRpb25zLmtlZXBBbGl2ZSA/PyB0cnVlO1xuICAgIGNvbnN0IHNvY2tldFRpbWVvdXRNUyA9IG9wdGlvbnMuc29ja2V0VGltZW91dE1TID8/IFJlZmxlY3QuZ2V0KG9wdGlvbnMsICdzb2NrZXRUaW1lb3V0JykgPz8gMDtcbiAgICBjb25zdCBub0RlbGF5ID0gb3B0aW9ucy5ub0RlbGF5ID8/IHRydWU7XG4gICAgY29uc3QgY29ubmVjdFRpbWVvdXRNUyA9IG9wdGlvbnMuY29ubmVjdFRpbWVvdXRNUyA/PyAzMDAwMDtcbiAgICBjb25zdCByZWplY3RVbmF1dGhvcml6ZWQgPSBvcHRpb25zLnJlamVjdFVuYXV0aG9yaXplZCA/PyB0cnVlO1xuICAgIGNvbnN0IGtlZXBBbGl2ZUluaXRpYWxEZWxheSA9ICgob3B0aW9ucy5rZWVwQWxpdmVJbml0aWFsRGVsYXkgPz8gMTIwMDAwKSA+IHNvY2tldFRpbWVvdXRNU1xuICAgICAgICA/IE1hdGgucm91bmQoc29ja2V0VGltZW91dE1TIC8gMilcbiAgICAgICAgOiBvcHRpb25zLmtlZXBBbGl2ZUluaXRpYWxEZWxheSkgPz8gMTIwMDAwO1xuICAgIGNvbnN0IGV4aXN0aW5nU29ja2V0ID0gb3B0aW9ucy5leGlzdGluZ1NvY2tldDtcbiAgICBsZXQgc29ja2V0O1xuICAgIGNvbnN0IGNhbGxiYWNrID0gZnVuY3Rpb24gKGVyciwgcmV0KSB7XG4gICAgICAgIGlmIChlcnIgJiYgc29ja2V0KSB7XG4gICAgICAgICAgICBzb2NrZXQuZGVzdHJveSgpO1xuICAgICAgICB9XG4gICAgICAgIF9jYWxsYmFjayhlcnIsIHJldCk7XG4gICAgfTtcbiAgICBpZiAob3B0aW9ucy5wcm94eUhvc3QgIT0gbnVsbCkge1xuICAgICAgICAvLyBDdXJyZW50bHksIG9ubHkgU29ja3M1IGlzIHN1cHBvcnRlZC5cbiAgICAgICAgcmV0dXJuIG1ha2VTb2NrczVDb25uZWN0aW9uKHtcbiAgICAgICAgICAgIC4uLm9wdGlvbnMsXG4gICAgICAgICAgICBjb25uZWN0VGltZW91dE1TIC8vIFNob3VsZCBhbHdheXMgYmUgcHJlc2VudCBmb3IgU29ja3M1XG4gICAgICAgIH0sIGNhbGxiYWNrKTtcbiAgICB9XG4gICAgaWYgKHVzZVRMUykge1xuICAgICAgICBjb25zdCB0bHNTb2NrZXQgPSB0bHMuY29ubmVjdChwYXJzZVNzbE9wdGlvbnMob3B0aW9ucykpO1xuICAgICAgICBpZiAodHlwZW9mIHRsc1NvY2tldC5kaXNhYmxlUmVuZWdvdGlhdGlvbiA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgdGxzU29ja2V0LmRpc2FibGVSZW5lZ290aWF0aW9uKCk7XG4gICAgICAgIH1cbiAgICAgICAgc29ja2V0ID0gdGxzU29ja2V0O1xuICAgIH1cbiAgICBlbHNlIGlmIChleGlzdGluZ1NvY2tldCkge1xuICAgICAgICAvLyBJbiB0aGUgVExTIGNhc2UsIHBhcnNlU3NsT3B0aW9ucygpIHNldHMgb3B0aW9ucy5zb2NrZXQgdG8gZXhpc3RpbmdTb2NrZXQsXG4gICAgICAgIC8vIHNvIHdlIG9ubHkgbmVlZCB0byBoYW5kbGUgdGhlIG5vbi1UTFMgY2FzZSBoZXJlICh3aGVyZSBleGlzdGluZ1NvY2tldFxuICAgICAgICAvLyBnaXZlcyB1cyBhbGwgd2UgbmVlZCBvdXQgb2YgdGhlIGJveCkuXG4gICAgICAgIHNvY2tldCA9IGV4aXN0aW5nU29ja2V0O1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgc29ja2V0ID0gbmV0LmNyZWF0ZUNvbm5lY3Rpb24ocGFyc2VDb25uZWN0T3B0aW9ucyhvcHRpb25zKSk7XG4gICAgfVxuICAgIHNvY2tldC5zZXRLZWVwQWxpdmUoa2VlcEFsaXZlLCBrZWVwQWxpdmVJbml0aWFsRGVsYXkpO1xuICAgIHNvY2tldC5zZXRUaW1lb3V0KGNvbm5lY3RUaW1lb3V0TVMpO1xuICAgIHNvY2tldC5zZXROb0RlbGF5KG5vRGVsYXkpO1xuICAgIGNvbnN0IGNvbm5lY3RFdmVudCA9IHVzZVRMUyA/ICdzZWN1cmVDb25uZWN0JyA6ICdjb25uZWN0JztcbiAgICBsZXQgY2FuY2VsbGF0aW9uSGFuZGxlcjtcbiAgICBmdW5jdGlvbiBlcnJvckhhbmRsZXIoZXZlbnROYW1lKSB7XG4gICAgICAgIHJldHVybiAoZXJyKSA9PiB7XG4gICAgICAgICAgICBTT0NLRVRfRVJST1JfRVZFTlRTLmZvckVhY2goZXZlbnQgPT4gc29ja2V0LnJlbW92ZUFsbExpc3RlbmVycyhldmVudCkpO1xuICAgICAgICAgICAgaWYgKGNhbmNlbGxhdGlvbkhhbmRsZXIgJiYgb3B0aW9ucy5jYW5jZWxsYXRpb25Ub2tlbikge1xuICAgICAgICAgICAgICAgIG9wdGlvbnMuY2FuY2VsbGF0aW9uVG9rZW4ucmVtb3ZlTGlzdGVuZXIoJ2NhbmNlbCcsIGNhbmNlbGxhdGlvbkhhbmRsZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc29ja2V0LnJlbW92ZUxpc3RlbmVyKGNvbm5lY3RFdmVudCwgY29ubmVjdEhhbmRsZXIpO1xuICAgICAgICAgICAgY2FsbGJhY2soY29ubmVjdGlvbkZhaWx1cmVFcnJvcihldmVudE5hbWUsIGVycikpO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBmdW5jdGlvbiBjb25uZWN0SGFuZGxlcigpIHtcbiAgICAgICAgU09DS0VUX0VSUk9SX0VWRU5UUy5mb3JFYWNoKGV2ZW50ID0+IHNvY2tldC5yZW1vdmVBbGxMaXN0ZW5lcnMoZXZlbnQpKTtcbiAgICAgICAgaWYgKGNhbmNlbGxhdGlvbkhhbmRsZXIgJiYgb3B0aW9ucy5jYW5jZWxsYXRpb25Ub2tlbikge1xuICAgICAgICAgICAgb3B0aW9ucy5jYW5jZWxsYXRpb25Ub2tlbi5yZW1vdmVMaXN0ZW5lcignY2FuY2VsJywgY2FuY2VsbGF0aW9uSGFuZGxlcik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCdhdXRob3JpemF0aW9uRXJyb3InIGluIHNvY2tldCkge1xuICAgICAgICAgICAgaWYgKHNvY2tldC5hdXRob3JpemF0aW9uRXJyb3IgJiYgcmVqZWN0VW5hdXRob3JpemVkKSB7XG4gICAgICAgICAgICAgICAgLy8gVE9ETyhOT0RFLTUxOTIpOiB3cmFwIHRoaXMgd2l0aCBhIE1vbmdvRXJyb3Igc3ViY2xhc3NcbiAgICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2soc29ja2V0LmF1dGhvcml6YXRpb25FcnJvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgc29ja2V0LnNldFRpbWVvdXQoMCk7XG4gICAgICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwgc29ja2V0KTtcbiAgICB9XG4gICAgU09DS0VUX0VSUk9SX0VWRU5UUy5mb3JFYWNoKGV2ZW50ID0+IHNvY2tldC5vbmNlKGV2ZW50LCBlcnJvckhhbmRsZXIoZXZlbnQpKSk7XG4gICAgaWYgKG9wdGlvbnMuY2FuY2VsbGF0aW9uVG9rZW4pIHtcbiAgICAgICAgY2FuY2VsbGF0aW9uSGFuZGxlciA9IGVycm9ySGFuZGxlcignY2FuY2VsJyk7XG4gICAgICAgIG9wdGlvbnMuY2FuY2VsbGF0aW9uVG9rZW4ub25jZSgnY2FuY2VsJywgY2FuY2VsbGF0aW9uSGFuZGxlcik7XG4gICAgfVxuICAgIGlmIChleGlzdGluZ1NvY2tldCkge1xuICAgICAgICBwcm9jZXNzLm5leHRUaWNrKGNvbm5lY3RIYW5kbGVyKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHNvY2tldC5vbmNlKGNvbm5lY3RFdmVudCwgY29ubmVjdEhhbmRsZXIpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIG1ha2VTb2NrczVDb25uZWN0aW9uKG9wdGlvbnMsIGNhbGxiYWNrKSB7XG4gICAgY29uc3QgaG9zdEFkZHJlc3MgPSB1dGlsc18xLkhvc3RBZGRyZXNzLmZyb21Ib3N0UG9ydChvcHRpb25zLnByb3h5SG9zdCA/PyAnJywgLy8gcHJveHlIb3N0IGlzIGd1YXJhbnRlZWQgdG8gc2V0IGhlcmVcbiAgICBvcHRpb25zLnByb3h5UG9ydCA/PyAxMDgwKTtcbiAgICAvLyBGaXJzdCwgY29ubmVjdCB0byB0aGUgcHJveHkgc2VydmVyIGl0c2VsZjpcbiAgICBtYWtlQ29ubmVjdGlvbih7XG4gICAgICAgIC4uLm9wdGlvbnMsXG4gICAgICAgIGhvc3RBZGRyZXNzLFxuICAgICAgICB0bHM6IGZhbHNlLFxuICAgICAgICBwcm94eUhvc3Q6IHVuZGVmaW5lZFxuICAgIH0sIChlcnIsIHJhd1NvY2tldCkgPT4ge1xuICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBkZXN0aW5hdGlvbiA9IHBhcnNlQ29ubmVjdE9wdGlvbnMob3B0aW9ucyk7XG4gICAgICAgIGlmICh0eXBlb2YgZGVzdGluYXRpb24uaG9zdCAhPT0gJ3N0cmluZycgfHwgdHlwZW9mIGRlc3RpbmF0aW9uLnBvcnQgIT09ICdudW1iZXInKSB7XG4gICAgICAgICAgICByZXR1cm4gY2FsbGJhY2sobmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignQ2FuIG9ubHkgbWFrZSBTb2NrczUgY29ubmVjdGlvbnMgdG8gVENQIGhvc3RzJykpO1xuICAgICAgICB9XG4gICAgICAgIC8vIFRoZW4sIGVzdGFibGlzaCB0aGUgU29ja3M1IHByb3h5IGNvbm5lY3Rpb246XG4gICAgICAgIHNvY2tzXzEuU29ja3NDbGllbnQuY3JlYXRlQ29ubmVjdGlvbih7XG4gICAgICAgICAgICBleGlzdGluZ19zb2NrZXQ6IHJhd1NvY2tldCxcbiAgICAgICAgICAgIHRpbWVvdXQ6IG9wdGlvbnMuY29ubmVjdFRpbWVvdXRNUyxcbiAgICAgICAgICAgIGNvbW1hbmQ6ICdjb25uZWN0JyxcbiAgICAgICAgICAgIGRlc3RpbmF0aW9uOiB7XG4gICAgICAgICAgICAgICAgaG9zdDogZGVzdGluYXRpb24uaG9zdCxcbiAgICAgICAgICAgICAgICBwb3J0OiBkZXN0aW5hdGlvbi5wb3J0XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcHJveHk6IHtcbiAgICAgICAgICAgICAgICAvLyBob3N0IGFuZCBwb3J0IGFyZSBpZ25vcmVkIGJlY2F1c2Ugd2UgcGFzcyBleGlzdGluZ19zb2NrZXRcbiAgICAgICAgICAgICAgICBob3N0OiAnaUxvdmVKYXZhU2NyaXB0JyxcbiAgICAgICAgICAgICAgICBwb3J0OiAwLFxuICAgICAgICAgICAgICAgIHR5cGU6IDUsXG4gICAgICAgICAgICAgICAgdXNlcklkOiBvcHRpb25zLnByb3h5VXNlcm5hbWUgfHwgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIHBhc3N3b3JkOiBvcHRpb25zLnByb3h5UGFzc3dvcmQgfHwgdW5kZWZpbmVkXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pLnRoZW4oKHsgc29ja2V0IH0pID0+IHtcbiAgICAgICAgICAgIC8vIEZpbmFsbHksIG5vdyB0cmVhdCB0aGUgcmVzdWx0aW5nIGR1cGxleCBzdHJlYW0gYXMgdGhlXG4gICAgICAgICAgICAvLyBzb2NrZXQgb3ZlciB3aGljaCB3ZSBzZW5kIGFuZCByZWNlaXZlIHdpcmUgcHJvdG9jb2wgbWVzc2FnZXM6XG4gICAgICAgICAgICBtYWtlQ29ubmVjdGlvbih7XG4gICAgICAgICAgICAgICAgLi4ub3B0aW9ucyxcbiAgICAgICAgICAgICAgICBleGlzdGluZ1NvY2tldDogc29ja2V0LFxuICAgICAgICAgICAgICAgIHByb3h5SG9zdDogdW5kZWZpbmVkXG4gICAgICAgICAgICB9LCBjYWxsYmFjayk7XG4gICAgICAgIH0sIGVycm9yID0+IGNhbGxiYWNrKGNvbm5lY3Rpb25GYWlsdXJlRXJyb3IoJ2Vycm9yJywgZXJyb3IpKSk7XG4gICAgfSk7XG59XG5mdW5jdGlvbiBjb25uZWN0aW9uRmFpbHVyZUVycm9yKHR5cGUsIGVycikge1xuICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgICBjYXNlICdlcnJvcic6XG4gICAgICAgICAgICByZXR1cm4gbmV3IGVycm9yXzEuTW9uZ29OZXR3b3JrRXJyb3IoZXJyKTtcbiAgICAgICAgY2FzZSAndGltZW91dCc6XG4gICAgICAgICAgICByZXR1cm4gbmV3IGVycm9yXzEuTW9uZ29OZXR3b3JrVGltZW91dEVycm9yKCdjb25uZWN0aW9uIHRpbWVkIG91dCcpO1xuICAgICAgICBjYXNlICdjbG9zZSc6XG4gICAgICAgICAgICByZXR1cm4gbmV3IGVycm9yXzEuTW9uZ29OZXR3b3JrRXJyb3IoJ2Nvbm5lY3Rpb24gY2xvc2VkJyk7XG4gICAgICAgIGNhc2UgJ2NhbmNlbCc6XG4gICAgICAgICAgICByZXR1cm4gbmV3IGVycm9yXzEuTW9uZ29OZXR3b3JrRXJyb3IoJ2Nvbm5lY3Rpb24gZXN0YWJsaXNobWVudCB3YXMgY2FuY2VsbGVkJyk7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICByZXR1cm4gbmV3IGVycm9yXzEuTW9uZ29OZXR3b3JrRXJyb3IoJ3Vua25vd24gbmV0d29yayBlcnJvcicpO1xuICAgIH1cbn1cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWNvbm5lY3QuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/cmap/connect.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/cmap/connection.js":
/*!*************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/cmap/connection.js ***!
  \*************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.hasSessionSupport = exports.CryptoConnection = exports.Connection = void 0;\nconst timers_1 = __webpack_require__(/*! timers */ \"timers\");\nconst util_1 = __webpack_require__(/*! util */ \"util\");\nconst constants_1 = __webpack_require__(/*! ../constants */ \"(api)/../server/node_modules/mongodb/lib/constants.js\");\nconst error_1 = __webpack_require__(/*! ../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst mongo_types_1 = __webpack_require__(/*! ../mongo_types */ \"(api)/../server/node_modules/mongodb/lib/mongo_types.js\");\nconst sessions_1 = __webpack_require__(/*! ../sessions */ \"(api)/../server/node_modules/mongodb/lib/sessions.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\nconst command_monitoring_events_1 = __webpack_require__(/*! ./command_monitoring_events */ \"(api)/../server/node_modules/mongodb/lib/cmap/command_monitoring_events.js\");\nconst commands_1 = __webpack_require__(/*! ./commands */ \"(api)/../server/node_modules/mongodb/lib/cmap/commands.js\");\nconst message_stream_1 = __webpack_require__(/*! ./message_stream */ \"(api)/../server/node_modules/mongodb/lib/cmap/message_stream.js\");\nconst stream_description_1 = __webpack_require__(/*! ./stream_description */ \"(api)/../server/node_modules/mongodb/lib/cmap/stream_description.js\");\nconst shared_1 = __webpack_require__(/*! ./wire_protocol/shared */ \"(api)/../server/node_modules/mongodb/lib/cmap/wire_protocol/shared.js\");\n/** @internal */\nconst kStream = Symbol('stream');\n/** @internal */\nconst kQueue = Symbol('queue');\n/** @internal */\nconst kMessageStream = Symbol('messageStream');\n/** @internal */\nconst kGeneration = Symbol('generation');\n/** @internal */\nconst kLastUseTime = Symbol('lastUseTime');\n/** @internal */\nconst kClusterTime = Symbol('clusterTime');\n/** @internal */\nconst kDescription = Symbol('description');\n/** @internal */\nconst kHello = Symbol('hello');\n/** @internal */\nconst kAutoEncrypter = Symbol('autoEncrypter');\n/** @internal */\nconst kDelayedTimeoutId = Symbol('delayedTimeoutId');\nconst INVALID_QUEUE_SIZE = 'Connection internal queue contains more than 1 operation description';\n/** @internal */\nclass Connection extends mongo_types_1.TypedEventEmitter {\n    constructor(stream, options) {\n        super();\n        this.commandAsync = (0, util_1.promisify)((ns, cmd, options, callback) => this.command(ns, cmd, options, callback));\n        this.id = options.id;\n        this.address = streamIdentifier(stream, options);\n        this.socketTimeoutMS = options.socketTimeoutMS ?? 0;\n        this.monitorCommands = options.monitorCommands;\n        this.serverApi = options.serverApi;\n        this.closed = false;\n        this[kHello] = null;\n        this[kClusterTime] = null;\n        this[kDescription] = new stream_description_1.StreamDescription(this.address, options);\n        this[kGeneration] = options.generation;\n        this[kLastUseTime] = (0, utils_1.now)();\n        // setup parser stream and message handling\n        this[kQueue] = new Map();\n        this[kMessageStream] = new message_stream_1.MessageStream({\n            ...options,\n            maxBsonMessageSize: this.hello?.maxBsonMessageSize\n        });\n        this[kStream] = stream;\n        this[kDelayedTimeoutId] = null;\n        this[kMessageStream].on('message', message => this.onMessage(message));\n        this[kMessageStream].on('error', error => this.onError(error));\n        this[kStream].on('close', () => this.onClose());\n        this[kStream].on('timeout', () => this.onTimeout());\n        this[kStream].on('error', () => {\n            /* ignore errors, listen to `close` instead */\n        });\n        // hook the message stream up to the passed in stream\n        this[kStream].pipe(this[kMessageStream]);\n        this[kMessageStream].pipe(this[kStream]);\n    }\n    get description() {\n        return this[kDescription];\n    }\n    get hello() {\n        return this[kHello];\n    }\n    // the `connect` method stores the result of the handshake hello on the connection\n    set hello(response) {\n        this[kDescription].receiveResponse(response);\n        this[kDescription] = Object.freeze(this[kDescription]);\n        // TODO: remove this, and only use the `StreamDescription` in the future\n        this[kHello] = response;\n    }\n    // Set the whether the message stream is for a monitoring connection.\n    set isMonitoringConnection(value) {\n        this[kMessageStream].isMonitoringConnection = value;\n    }\n    get isMonitoringConnection() {\n        return this[kMessageStream].isMonitoringConnection;\n    }\n    get serviceId() {\n        return this.hello?.serviceId;\n    }\n    get loadBalanced() {\n        return this.description.loadBalanced;\n    }\n    get generation() {\n        return this[kGeneration] || 0;\n    }\n    set generation(generation) {\n        this[kGeneration] = generation;\n    }\n    get idleTime() {\n        return (0, utils_1.calculateDurationInMs)(this[kLastUseTime]);\n    }\n    get clusterTime() {\n        return this[kClusterTime];\n    }\n    get stream() {\n        return this[kStream];\n    }\n    markAvailable() {\n        this[kLastUseTime] = (0, utils_1.now)();\n    }\n    onError(error) {\n        this.cleanup(true, error);\n    }\n    onClose() {\n        const message = `connection ${this.id} to ${this.address} closed`;\n        this.cleanup(true, new error_1.MongoNetworkError(message));\n    }\n    onTimeout() {\n        this[kDelayedTimeoutId] = (0, timers_1.setTimeout)(() => {\n            const message = `connection ${this.id} to ${this.address} timed out`;\n            const beforeHandshake = this.hello == null;\n            this.cleanup(true, new error_1.MongoNetworkTimeoutError(message, { beforeHandshake }));\n        }, 1).unref(); // No need for this timer to hold the event loop open\n    }\n    onMessage(message) {\n        const delayedTimeoutId = this[kDelayedTimeoutId];\n        if (delayedTimeoutId != null) {\n            (0, timers_1.clearTimeout)(delayedTimeoutId);\n            this[kDelayedTimeoutId] = null;\n        }\n        const socketTimeoutMS = this[kStream].timeout ?? 0;\n        this[kStream].setTimeout(0);\n        // always emit the message, in case we are streaming\n        this.emit('message', message);\n        let operationDescription = this[kQueue].get(message.responseTo);\n        if (!operationDescription && this.isMonitoringConnection) {\n            // This is how we recover when the initial hello's requestId is not\n            // the responseTo when hello responses have been skipped:\n            // First check if the map is of invalid size\n            if (this[kQueue].size > 1) {\n                this.cleanup(true, new error_1.MongoRuntimeError(INVALID_QUEUE_SIZE));\n            }\n            else {\n                // Get the first orphaned operation description.\n                const entry = this[kQueue].entries().next();\n                if (entry.value != null) {\n                    const [requestId, orphaned] = entry.value;\n                    // If the orphaned operation description exists then set it.\n                    operationDescription = orphaned;\n                    // Remove the entry with the bad request id from the queue.\n                    this[kQueue].delete(requestId);\n                }\n            }\n        }\n        if (!operationDescription) {\n            return;\n        }\n        const callback = operationDescription.cb;\n        // SERVER-45775: For exhaust responses we should be able to use the same requestId to\n        // track response, however the server currently synthetically produces remote requests\n        // making the `responseTo` change on each response\n        this[kQueue].delete(message.responseTo);\n        if ('moreToCome' in message && message.moreToCome) {\n            // If the operation description check above does find an orphaned\n            // description and sets the operationDescription then this line will put one\n            // back in the queue with the correct requestId and will resolve not being able\n            // to find the next one via the responseTo of the next streaming hello.\n            this[kQueue].set(message.requestId, operationDescription);\n            this[kStream].setTimeout(socketTimeoutMS);\n        }\n        try {\n            // Pass in the entire description because it has BSON parsing options\n            message.parse(operationDescription);\n        }\n        catch (err) {\n            // If this error is generated by our own code, it will already have the correct class applied\n            // if it is not, then it is coming from a catastrophic data parse failure or the BSON library\n            // in either case, it should not be wrapped\n            callback(err);\n            return;\n        }\n        if (message.documents[0]) {\n            const document = message.documents[0];\n            const session = operationDescription.session;\n            if (session) {\n                (0, sessions_1.updateSessionFromResponse)(session, document);\n            }\n            if (document.$clusterTime) {\n                this[kClusterTime] = document.$clusterTime;\n                this.emit(Connection.CLUSTER_TIME_RECEIVED, document.$clusterTime);\n            }\n            if (document.writeConcernError) {\n                callback(new error_1.MongoWriteConcernError(document.writeConcernError, document), document);\n                return;\n            }\n            if (document.ok === 0 || document.$err || document.errmsg || document.code) {\n                callback(new error_1.MongoServerError(document));\n                return;\n            }\n        }\n        callback(undefined, message.documents[0]);\n    }\n    destroy(options, callback) {\n        if (this.closed) {\n            process.nextTick(() => callback?.());\n            return;\n        }\n        if (typeof callback === 'function') {\n            this.once('close', () => process.nextTick(() => callback()));\n        }\n        // load balanced mode requires that these listeners remain on the connection\n        // after cleanup on timeouts, errors or close so we remove them before calling\n        // cleanup.\n        this.removeAllListeners(Connection.PINNED);\n        this.removeAllListeners(Connection.UNPINNED);\n        const message = `connection ${this.id} to ${this.address} closed`;\n        this.cleanup(options.force, new error_1.MongoNetworkError(message));\n    }\n    /**\n     * A method that cleans up the connection.  When `force` is true, this method\n     * forcibly destroys the socket.\n     *\n     * If an error is provided, any in-flight operations will be closed with the error.\n     *\n     * This method does nothing if the connection is already closed.\n     */\n    cleanup(force, error) {\n        if (this.closed) {\n            return;\n        }\n        this.closed = true;\n        const completeCleanup = () => {\n            for (const op of this[kQueue].values()) {\n                op.cb(error);\n            }\n            this[kQueue].clear();\n            this.emit(Connection.CLOSE);\n        };\n        this[kStream].removeAllListeners();\n        this[kMessageStream].removeAllListeners();\n        this[kMessageStream].destroy();\n        if (force) {\n            this[kStream].destroy();\n            completeCleanup();\n            return;\n        }\n        if (!this[kStream].writableEnded) {\n            this[kStream].end(() => {\n                this[kStream].destroy();\n                completeCleanup();\n            });\n        }\n        else {\n            completeCleanup();\n        }\n    }\n    command(ns, command, options, callback) {\n        let cmd = { ...command };\n        const readPreference = (0, shared_1.getReadPreference)(options);\n        const shouldUseOpMsg = supportsOpMsg(this);\n        const session = options?.session;\n        let clusterTime = this.clusterTime;\n        if (this.serverApi) {\n            const { version, strict, deprecationErrors } = this.serverApi;\n            cmd.apiVersion = version;\n            if (strict != null)\n                cmd.apiStrict = strict;\n            if (deprecationErrors != null)\n                cmd.apiDeprecationErrors = deprecationErrors;\n        }\n        if (hasSessionSupport(this) && session) {\n            if (session.clusterTime &&\n                clusterTime &&\n                session.clusterTime.clusterTime.greaterThan(clusterTime.clusterTime)) {\n                clusterTime = session.clusterTime;\n            }\n            const err = (0, sessions_1.applySession)(session, cmd, options);\n            if (err) {\n                return callback(err);\n            }\n        }\n        else if (session?.explicit) {\n            return callback(new error_1.MongoCompatibilityError('Current topology does not support sessions'));\n        }\n        // if we have a known cluster time, gossip it\n        if (clusterTime) {\n            cmd.$clusterTime = clusterTime;\n        }\n        if ((0, shared_1.isSharded)(this) && !shouldUseOpMsg && readPreference && readPreference.mode !== 'primary') {\n            cmd = {\n                $query: cmd,\n                $readPreference: readPreference.toJSON()\n            };\n        }\n        const commandOptions = Object.assign({\n            numberToSkip: 0,\n            numberToReturn: -1,\n            checkKeys: false,\n            // This value is not overridable\n            secondaryOk: readPreference.secondaryOk()\n        }, options);\n        const cmdNs = `${ns.db}.$cmd`;\n        const message = shouldUseOpMsg\n            ? new commands_1.Msg(cmdNs, cmd, commandOptions)\n            : new commands_1.Query(cmdNs, cmd, commandOptions);\n        try {\n            write(this, message, commandOptions, callback);\n        }\n        catch (err) {\n            callback(err);\n        }\n    }\n}\n/** @event */\nConnection.COMMAND_STARTED = constants_1.COMMAND_STARTED;\n/** @event */\nConnection.COMMAND_SUCCEEDED = constants_1.COMMAND_SUCCEEDED;\n/** @event */\nConnection.COMMAND_FAILED = constants_1.COMMAND_FAILED;\n/** @event */\nConnection.CLUSTER_TIME_RECEIVED = constants_1.CLUSTER_TIME_RECEIVED;\n/** @event */\nConnection.CLOSE = constants_1.CLOSE;\n/** @event */\nConnection.MESSAGE = constants_1.MESSAGE;\n/** @event */\nConnection.PINNED = constants_1.PINNED;\n/** @event */\nConnection.UNPINNED = constants_1.UNPINNED;\nexports.Connection = Connection;\n/** @internal */\nclass CryptoConnection extends Connection {\n    constructor(stream, options) {\n        super(stream, options);\n        this[kAutoEncrypter] = options.autoEncrypter;\n    }\n    /** @internal @override */\n    command(ns, cmd, options, callback) {\n        const autoEncrypter = this[kAutoEncrypter];\n        if (!autoEncrypter) {\n            return callback(new error_1.MongoMissingDependencyError('No AutoEncrypter available for encryption'));\n        }\n        const serverWireVersion = (0, utils_1.maxWireVersion)(this);\n        if (serverWireVersion === 0) {\n            // This means the initial handshake hasn't happened yet\n            return super.command(ns, cmd, options, callback);\n        }\n        if (serverWireVersion < 8) {\n            callback(new error_1.MongoCompatibilityError('Auto-encryption requires a minimum MongoDB version of 4.2'));\n            return;\n        }\n        // Save sort or indexKeys based on the command being run\n        // the encrypt API serializes our JS objects to BSON to pass to the native code layer\n        // and then deserializes the encrypted result, the protocol level components\n        // of the command (ex. sort) are then converted to JS objects potentially losing\n        // import key order information. These fields are never encrypted so we can save the values\n        // from before the encryption and replace them after encryption has been performed\n        const sort = cmd.find || cmd.findAndModify ? cmd.sort : null;\n        const indexKeys = cmd.createIndexes\n            ? cmd.indexes.map((index) => index.key)\n            : null;\n        autoEncrypter.encrypt(ns.toString(), cmd, options, (err, encrypted) => {\n            if (err || encrypted == null) {\n                callback(err, null);\n                return;\n            }\n            // Replace the saved values\n            if (sort != null && (cmd.find || cmd.findAndModify)) {\n                encrypted.sort = sort;\n            }\n            if (indexKeys != null && cmd.createIndexes) {\n                for (const [offset, index] of indexKeys.entries()) {\n                    encrypted.indexes[offset].key = index;\n                }\n            }\n            super.command(ns, encrypted, options, (err, response) => {\n                if (err || response == null) {\n                    callback(err, response);\n                    return;\n                }\n                autoEncrypter.decrypt(response, options, callback);\n            });\n        });\n    }\n}\nexports.CryptoConnection = CryptoConnection;\n/** @internal */\nfunction hasSessionSupport(conn) {\n    const description = conn.description;\n    return description.logicalSessionTimeoutMinutes != null;\n}\nexports.hasSessionSupport = hasSessionSupport;\nfunction supportsOpMsg(conn) {\n    const description = conn.description;\n    if (description == null) {\n        return false;\n    }\n    return (0, utils_1.maxWireVersion)(conn) >= 6 && !description.__nodejs_mock_server__;\n}\nfunction streamIdentifier(stream, options) {\n    if (options.proxyHost) {\n        // If proxy options are specified, the properties of `stream` itself\n        // will not accurately reflect what endpoint this is connected to.\n        return options.hostAddress.toString();\n    }\n    const { remoteAddress, remotePort } = stream;\n    if (typeof remoteAddress === 'string' && typeof remotePort === 'number') {\n        return utils_1.HostAddress.fromHostPort(remoteAddress, remotePort).toString();\n    }\n    return (0, utils_1.uuidV4)().toString('hex');\n}\nfunction write(conn, command, options, callback) {\n    options = options ?? {};\n    const operationDescription = {\n        requestId: command.requestId,\n        cb: callback,\n        session: options.session,\n        noResponse: typeof options.noResponse === 'boolean' ? options.noResponse : false,\n        documentsReturnedIn: options.documentsReturnedIn,\n        // for BSON parsing\n        useBigInt64: typeof options.useBigInt64 === 'boolean' ? options.useBigInt64 : false,\n        promoteLongs: typeof options.promoteLongs === 'boolean' ? options.promoteLongs : true,\n        promoteValues: typeof options.promoteValues === 'boolean' ? options.promoteValues : true,\n        promoteBuffers: typeof options.promoteBuffers === 'boolean' ? options.promoteBuffers : false,\n        bsonRegExp: typeof options.bsonRegExp === 'boolean' ? options.bsonRegExp : false,\n        enableUtf8Validation: typeof options.enableUtf8Validation === 'boolean' ? options.enableUtf8Validation : true,\n        raw: typeof options.raw === 'boolean' ? options.raw : false,\n        started: 0\n    };\n    if (conn[kDescription] && conn[kDescription].compressor) {\n        operationDescription.agreedCompressor = conn[kDescription].compressor;\n        if (conn[kDescription].zlibCompressionLevel) {\n            operationDescription.zlibCompressionLevel = conn[kDescription].zlibCompressionLevel;\n        }\n    }\n    if (typeof options.socketTimeoutMS === 'number') {\n        conn[kStream].setTimeout(options.socketTimeoutMS);\n    }\n    else if (conn.socketTimeoutMS !== 0) {\n        conn[kStream].setTimeout(conn.socketTimeoutMS);\n    }\n    // if command monitoring is enabled we need to modify the callback here\n    if (conn.monitorCommands) {\n        conn.emit(Connection.COMMAND_STARTED, new command_monitoring_events_1.CommandStartedEvent(conn, command));\n        operationDescription.started = (0, utils_1.now)();\n        operationDescription.cb = (err, reply) => {\n            // Command monitoring spec states that if ok is 1, then we must always emit\n            // a command succeeded event, even if there's an error. Write concern errors\n            // will have an ok: 1 in their reply.\n            if (err && reply?.ok !== 1) {\n                conn.emit(Connection.COMMAND_FAILED, new command_monitoring_events_1.CommandFailedEvent(conn, command, err, operationDescription.started));\n            }\n            else {\n                if (reply && (reply.ok === 0 || reply.$err)) {\n                    conn.emit(Connection.COMMAND_FAILED, new command_monitoring_events_1.CommandFailedEvent(conn, command, reply, operationDescription.started));\n                }\n                else {\n                    conn.emit(Connection.COMMAND_SUCCEEDED, new command_monitoring_events_1.CommandSucceededEvent(conn, command, reply, operationDescription.started));\n                }\n            }\n            if (typeof callback === 'function') {\n                // Since we're passing through the reply with the write concern error now, we\n                // need it not to be provided to the original callback in this case so\n                // retryability does not get tricked into thinking the command actually\n                // succeeded.\n                callback(err, err instanceof error_1.MongoWriteConcernError ? undefined : reply);\n            }\n        };\n    }\n    if (!operationDescription.noResponse) {\n        conn[kQueue].set(operationDescription.requestId, operationDescription);\n    }\n    try {\n        conn[kMessageStream].writeCommand(command, operationDescription);\n    }\n    catch (e) {\n        if (!operationDescription.noResponse) {\n            conn[kQueue].delete(operationDescription.requestId);\n            operationDescription.cb(e);\n            return;\n        }\n    }\n    if (operationDescription.noResponse) {\n        operationDescription.cb();\n    }\n}\n//# sourceMappingURL=connection.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jbWFwL2Nvbm5lY3Rpb24uanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QseUJBQXlCLEdBQUcsd0JBQXdCLEdBQUcsa0JBQWtCO0FBQ3pFLGlCQUFpQixtQkFBTyxDQUFDLHNCQUFRO0FBQ2pDLGVBQWUsbUJBQU8sQ0FBQyxrQkFBTTtBQUM3QixvQkFBb0IsbUJBQU8sQ0FBQywyRUFBYztBQUMxQyxnQkFBZ0IsbUJBQU8sQ0FBQyxtRUFBVTtBQUNsQyxzQkFBc0IsbUJBQU8sQ0FBQywrRUFBZ0I7QUFDOUMsbUJBQW1CLG1CQUFPLENBQUMseUVBQWE7QUFDeEMsZ0JBQWdCLG1CQUFPLENBQUMsbUVBQVU7QUFDbEMsb0NBQW9DLG1CQUFPLENBQUMsK0dBQTZCO0FBQ3pFLG1CQUFtQixtQkFBTyxDQUFDLDZFQUFZO0FBQ3ZDLHlCQUF5QixtQkFBTyxDQUFDLHlGQUFrQjtBQUNuRCw2QkFBNkIsbUJBQU8sQ0FBQyxpR0FBc0I7QUFDM0QsaUJBQWlCLG1CQUFPLENBQUMscUdBQXdCO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0NBQXNDLFNBQVMsS0FBSyxjQUFjO0FBQ2xFO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMENBQTBDLFNBQVMsS0FBSyxjQUFjO0FBQ3RFO0FBQ0EsK0VBQStFLGlCQUFpQjtBQUNoRyxTQUFTLGNBQWM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNDQUFzQyxTQUFTLEtBQUssY0FBYztBQUNsRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0I7QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixxQ0FBcUM7QUFDekQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULHlCQUF5QixNQUFNO0FBQy9CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQjtBQUNsQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQSx3QkFBd0I7QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksNEJBQTRCO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsiRDpcXHNhbG9uaVxcYXBwcmFpc2FsLXN5c3RlbVxcc2VydmVyXFxub2RlX21vZHVsZXNcXG1vbmdvZGJcXGxpYlxcY21hcFxcY29ubmVjdGlvbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuaGFzU2Vzc2lvblN1cHBvcnQgPSBleHBvcnRzLkNyeXB0b0Nvbm5lY3Rpb24gPSBleHBvcnRzLkNvbm5lY3Rpb24gPSB2b2lkIDA7XG5jb25zdCB0aW1lcnNfMSA9IHJlcXVpcmUoXCJ0aW1lcnNcIik7XG5jb25zdCB1dGlsXzEgPSByZXF1aXJlKFwidXRpbFwiKTtcbmNvbnN0IGNvbnN0YW50c18xID0gcmVxdWlyZShcIi4uL2NvbnN0YW50c1wiKTtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi4vZXJyb3JcIik7XG5jb25zdCBtb25nb190eXBlc18xID0gcmVxdWlyZShcIi4uL21vbmdvX3R5cGVzXCIpO1xuY29uc3Qgc2Vzc2lvbnNfMSA9IHJlcXVpcmUoXCIuLi9zZXNzaW9uc1wiKTtcbmNvbnN0IHV0aWxzXzEgPSByZXF1aXJlKFwiLi4vdXRpbHNcIik7XG5jb25zdCBjb21tYW5kX21vbml0b3JpbmdfZXZlbnRzXzEgPSByZXF1aXJlKFwiLi9jb21tYW5kX21vbml0b3JpbmdfZXZlbnRzXCIpO1xuY29uc3QgY29tbWFuZHNfMSA9IHJlcXVpcmUoXCIuL2NvbW1hbmRzXCIpO1xuY29uc3QgbWVzc2FnZV9zdHJlYW1fMSA9IHJlcXVpcmUoXCIuL21lc3NhZ2Vfc3RyZWFtXCIpO1xuY29uc3Qgc3RyZWFtX2Rlc2NyaXB0aW9uXzEgPSByZXF1aXJlKFwiLi9zdHJlYW1fZGVzY3JpcHRpb25cIik7XG5jb25zdCBzaGFyZWRfMSA9IHJlcXVpcmUoXCIuL3dpcmVfcHJvdG9jb2wvc2hhcmVkXCIpO1xuLyoqIEBpbnRlcm5hbCAqL1xuY29uc3Qga1N0cmVhbSA9IFN5bWJvbCgnc3RyZWFtJyk7XG4vKiogQGludGVybmFsICovXG5jb25zdCBrUXVldWUgPSBTeW1ib2woJ3F1ZXVlJyk7XG4vKiogQGludGVybmFsICovXG5jb25zdCBrTWVzc2FnZVN0cmVhbSA9IFN5bWJvbCgnbWVzc2FnZVN0cmVhbScpO1xuLyoqIEBpbnRlcm5hbCAqL1xuY29uc3Qga0dlbmVyYXRpb24gPSBTeW1ib2woJ2dlbmVyYXRpb24nKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNvbnN0IGtMYXN0VXNlVGltZSA9IFN5bWJvbCgnbGFzdFVzZVRpbWUnKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNvbnN0IGtDbHVzdGVyVGltZSA9IFN5bWJvbCgnY2x1c3RlclRpbWUnKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNvbnN0IGtEZXNjcmlwdGlvbiA9IFN5bWJvbCgnZGVzY3JpcHRpb24nKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNvbnN0IGtIZWxsbyA9IFN5bWJvbCgnaGVsbG8nKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNvbnN0IGtBdXRvRW5jcnlwdGVyID0gU3ltYm9sKCdhdXRvRW5jcnlwdGVyJyk7XG4vKiogQGludGVybmFsICovXG5jb25zdCBrRGVsYXllZFRpbWVvdXRJZCA9IFN5bWJvbCgnZGVsYXllZFRpbWVvdXRJZCcpO1xuY29uc3QgSU5WQUxJRF9RVUVVRV9TSVpFID0gJ0Nvbm5lY3Rpb24gaW50ZXJuYWwgcXVldWUgY29udGFpbnMgbW9yZSB0aGFuIDEgb3BlcmF0aW9uIGRlc2NyaXB0aW9uJztcbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIENvbm5lY3Rpb24gZXh0ZW5kcyBtb25nb190eXBlc18xLlR5cGVkRXZlbnRFbWl0dGVyIHtcbiAgICBjb25zdHJ1Y3RvcihzdHJlYW0sIG9wdGlvbnMpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5jb21tYW5kQXN5bmMgPSAoMCwgdXRpbF8xLnByb21pc2lmeSkoKG5zLCBjbWQsIG9wdGlvbnMsIGNhbGxiYWNrKSA9PiB0aGlzLmNvbW1hbmQobnMsIGNtZCwgb3B0aW9ucywgY2FsbGJhY2spKTtcbiAgICAgICAgdGhpcy5pZCA9IG9wdGlvbnMuaWQ7XG4gICAgICAgIHRoaXMuYWRkcmVzcyA9IHN0cmVhbUlkZW50aWZpZXIoc3RyZWFtLCBvcHRpb25zKTtcbiAgICAgICAgdGhpcy5zb2NrZXRUaW1lb3V0TVMgPSBvcHRpb25zLnNvY2tldFRpbWVvdXRNUyA/PyAwO1xuICAgICAgICB0aGlzLm1vbml0b3JDb21tYW5kcyA9IG9wdGlvbnMubW9uaXRvckNvbW1hbmRzO1xuICAgICAgICB0aGlzLnNlcnZlckFwaSA9IG9wdGlvbnMuc2VydmVyQXBpO1xuICAgICAgICB0aGlzLmNsb3NlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzW2tIZWxsb10gPSBudWxsO1xuICAgICAgICB0aGlzW2tDbHVzdGVyVGltZV0gPSBudWxsO1xuICAgICAgICB0aGlzW2tEZXNjcmlwdGlvbl0gPSBuZXcgc3RyZWFtX2Rlc2NyaXB0aW9uXzEuU3RyZWFtRGVzY3JpcHRpb24odGhpcy5hZGRyZXNzLCBvcHRpb25zKTtcbiAgICAgICAgdGhpc1trR2VuZXJhdGlvbl0gPSBvcHRpb25zLmdlbmVyYXRpb247XG4gICAgICAgIHRoaXNba0xhc3RVc2VUaW1lXSA9ICgwLCB1dGlsc18xLm5vdykoKTtcbiAgICAgICAgLy8gc2V0dXAgcGFyc2VyIHN0cmVhbSBhbmQgbWVzc2FnZSBoYW5kbGluZ1xuICAgICAgICB0aGlzW2tRdWV1ZV0gPSBuZXcgTWFwKCk7XG4gICAgICAgIHRoaXNba01lc3NhZ2VTdHJlYW1dID0gbmV3IG1lc3NhZ2Vfc3RyZWFtXzEuTWVzc2FnZVN0cmVhbSh7XG4gICAgICAgICAgICAuLi5vcHRpb25zLFxuICAgICAgICAgICAgbWF4QnNvbk1lc3NhZ2VTaXplOiB0aGlzLmhlbGxvPy5tYXhCc29uTWVzc2FnZVNpemVcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXNba1N0cmVhbV0gPSBzdHJlYW07XG4gICAgICAgIHRoaXNba0RlbGF5ZWRUaW1lb3V0SWRdID0gbnVsbDtcbiAgICAgICAgdGhpc1trTWVzc2FnZVN0cmVhbV0ub24oJ21lc3NhZ2UnLCBtZXNzYWdlID0+IHRoaXMub25NZXNzYWdlKG1lc3NhZ2UpKTtcbiAgICAgICAgdGhpc1trTWVzc2FnZVN0cmVhbV0ub24oJ2Vycm9yJywgZXJyb3IgPT4gdGhpcy5vbkVycm9yKGVycm9yKSk7XG4gICAgICAgIHRoaXNba1N0cmVhbV0ub24oJ2Nsb3NlJywgKCkgPT4gdGhpcy5vbkNsb3NlKCkpO1xuICAgICAgICB0aGlzW2tTdHJlYW1dLm9uKCd0aW1lb3V0JywgKCkgPT4gdGhpcy5vblRpbWVvdXQoKSk7XG4gICAgICAgIHRoaXNba1N0cmVhbV0ub24oJ2Vycm9yJywgKCkgPT4ge1xuICAgICAgICAgICAgLyogaWdub3JlIGVycm9ycywgbGlzdGVuIHRvIGBjbG9zZWAgaW5zdGVhZCAqL1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gaG9vayB0aGUgbWVzc2FnZSBzdHJlYW0gdXAgdG8gdGhlIHBhc3NlZCBpbiBzdHJlYW1cbiAgICAgICAgdGhpc1trU3RyZWFtXS5waXBlKHRoaXNba01lc3NhZ2VTdHJlYW1dKTtcbiAgICAgICAgdGhpc1trTWVzc2FnZVN0cmVhbV0ucGlwZSh0aGlzW2tTdHJlYW1dKTtcbiAgICB9XG4gICAgZ2V0IGRlc2NyaXB0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpc1trRGVzY3JpcHRpb25dO1xuICAgIH1cbiAgICBnZXQgaGVsbG8oKSB7XG4gICAgICAgIHJldHVybiB0aGlzW2tIZWxsb107XG4gICAgfVxuICAgIC8vIHRoZSBgY29ubmVjdGAgbWV0aG9kIHN0b3JlcyB0aGUgcmVzdWx0IG9mIHRoZSBoYW5kc2hha2UgaGVsbG8gb24gdGhlIGNvbm5lY3Rpb25cbiAgICBzZXQgaGVsbG8ocmVzcG9uc2UpIHtcbiAgICAgICAgdGhpc1trRGVzY3JpcHRpb25dLnJlY2VpdmVSZXNwb25zZShyZXNwb25zZSk7XG4gICAgICAgIHRoaXNba0Rlc2NyaXB0aW9uXSA9IE9iamVjdC5mcmVlemUodGhpc1trRGVzY3JpcHRpb25dKTtcbiAgICAgICAgLy8gVE9ETzogcmVtb3ZlIHRoaXMsIGFuZCBvbmx5IHVzZSB0aGUgYFN0cmVhbURlc2NyaXB0aW9uYCBpbiB0aGUgZnV0dXJlXG4gICAgICAgIHRoaXNba0hlbGxvXSA9IHJlc3BvbnNlO1xuICAgIH1cbiAgICAvLyBTZXQgdGhlIHdoZXRoZXIgdGhlIG1lc3NhZ2Ugc3RyZWFtIGlzIGZvciBhIG1vbml0b3JpbmcgY29ubmVjdGlvbi5cbiAgICBzZXQgaXNNb25pdG9yaW5nQ29ubmVjdGlvbih2YWx1ZSkge1xuICAgICAgICB0aGlzW2tNZXNzYWdlU3RyZWFtXS5pc01vbml0b3JpbmdDb25uZWN0aW9uID0gdmFsdWU7XG4gICAgfVxuICAgIGdldCBpc01vbml0b3JpbmdDb25uZWN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpc1trTWVzc2FnZVN0cmVhbV0uaXNNb25pdG9yaW5nQ29ubmVjdGlvbjtcbiAgICB9XG4gICAgZ2V0IHNlcnZpY2VJZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaGVsbG8/LnNlcnZpY2VJZDtcbiAgICB9XG4gICAgZ2V0IGxvYWRCYWxhbmNlZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGVzY3JpcHRpb24ubG9hZEJhbGFuY2VkO1xuICAgIH1cbiAgICBnZXQgZ2VuZXJhdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXNba0dlbmVyYXRpb25dIHx8IDA7XG4gICAgfVxuICAgIHNldCBnZW5lcmF0aW9uKGdlbmVyYXRpb24pIHtcbiAgICAgICAgdGhpc1trR2VuZXJhdGlvbl0gPSBnZW5lcmF0aW9uO1xuICAgIH1cbiAgICBnZXQgaWRsZVRpbWUoKSB7XG4gICAgICAgIHJldHVybiAoMCwgdXRpbHNfMS5jYWxjdWxhdGVEdXJhdGlvbkluTXMpKHRoaXNba0xhc3RVc2VUaW1lXSk7XG4gICAgfVxuICAgIGdldCBjbHVzdGVyVGltZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXNba0NsdXN0ZXJUaW1lXTtcbiAgICB9XG4gICAgZ2V0IHN0cmVhbSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXNba1N0cmVhbV07XG4gICAgfVxuICAgIG1hcmtBdmFpbGFibGUoKSB7XG4gICAgICAgIHRoaXNba0xhc3RVc2VUaW1lXSA9ICgwLCB1dGlsc18xLm5vdykoKTtcbiAgICB9XG4gICAgb25FcnJvcihlcnJvcikge1xuICAgICAgICB0aGlzLmNsZWFudXAodHJ1ZSwgZXJyb3IpO1xuICAgIH1cbiAgICBvbkNsb3NlKCkge1xuICAgICAgICBjb25zdCBtZXNzYWdlID0gYGNvbm5lY3Rpb24gJHt0aGlzLmlkfSB0byAke3RoaXMuYWRkcmVzc30gY2xvc2VkYDtcbiAgICAgICAgdGhpcy5jbGVhbnVwKHRydWUsIG5ldyBlcnJvcl8xLk1vbmdvTmV0d29ya0Vycm9yKG1lc3NhZ2UpKTtcbiAgICB9XG4gICAgb25UaW1lb3V0KCkge1xuICAgICAgICB0aGlzW2tEZWxheWVkVGltZW91dElkXSA9ICgwLCB0aW1lcnNfMS5zZXRUaW1lb3V0KSgoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBtZXNzYWdlID0gYGNvbm5lY3Rpb24gJHt0aGlzLmlkfSB0byAke3RoaXMuYWRkcmVzc30gdGltZWQgb3V0YDtcbiAgICAgICAgICAgIGNvbnN0IGJlZm9yZUhhbmRzaGFrZSA9IHRoaXMuaGVsbG8gPT0gbnVsbDtcbiAgICAgICAgICAgIHRoaXMuY2xlYW51cCh0cnVlLCBuZXcgZXJyb3JfMS5Nb25nb05ldHdvcmtUaW1lb3V0RXJyb3IobWVzc2FnZSwgeyBiZWZvcmVIYW5kc2hha2UgfSkpO1xuICAgICAgICB9LCAxKS51bnJlZigpOyAvLyBObyBuZWVkIGZvciB0aGlzIHRpbWVyIHRvIGhvbGQgdGhlIGV2ZW50IGxvb3Agb3BlblxuICAgIH1cbiAgICBvbk1lc3NhZ2UobWVzc2FnZSkge1xuICAgICAgICBjb25zdCBkZWxheWVkVGltZW91dElkID0gdGhpc1trRGVsYXllZFRpbWVvdXRJZF07XG4gICAgICAgIGlmIChkZWxheWVkVGltZW91dElkICE9IG51bGwpIHtcbiAgICAgICAgICAgICgwLCB0aW1lcnNfMS5jbGVhclRpbWVvdXQpKGRlbGF5ZWRUaW1lb3V0SWQpO1xuICAgICAgICAgICAgdGhpc1trRGVsYXllZFRpbWVvdXRJZF0gPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHNvY2tldFRpbWVvdXRNUyA9IHRoaXNba1N0cmVhbV0udGltZW91dCA/PyAwO1xuICAgICAgICB0aGlzW2tTdHJlYW1dLnNldFRpbWVvdXQoMCk7XG4gICAgICAgIC8vIGFsd2F5cyBlbWl0IHRoZSBtZXNzYWdlLCBpbiBjYXNlIHdlIGFyZSBzdHJlYW1pbmdcbiAgICAgICAgdGhpcy5lbWl0KCdtZXNzYWdlJywgbWVzc2FnZSk7XG4gICAgICAgIGxldCBvcGVyYXRpb25EZXNjcmlwdGlvbiA9IHRoaXNba1F1ZXVlXS5nZXQobWVzc2FnZS5yZXNwb25zZVRvKTtcbiAgICAgICAgaWYgKCFvcGVyYXRpb25EZXNjcmlwdGlvbiAmJiB0aGlzLmlzTW9uaXRvcmluZ0Nvbm5lY3Rpb24pIHtcbiAgICAgICAgICAgIC8vIFRoaXMgaXMgaG93IHdlIHJlY292ZXIgd2hlbiB0aGUgaW5pdGlhbCBoZWxsbydzIHJlcXVlc3RJZCBpcyBub3RcbiAgICAgICAgICAgIC8vIHRoZSByZXNwb25zZVRvIHdoZW4gaGVsbG8gcmVzcG9uc2VzIGhhdmUgYmVlbiBza2lwcGVkOlxuICAgICAgICAgICAgLy8gRmlyc3QgY2hlY2sgaWYgdGhlIG1hcCBpcyBvZiBpbnZhbGlkIHNpemVcbiAgICAgICAgICAgIGlmICh0aGlzW2tRdWV1ZV0uc2l6ZSA+IDEpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNsZWFudXAodHJ1ZSwgbmV3IGVycm9yXzEuTW9uZ29SdW50aW1lRXJyb3IoSU5WQUxJRF9RVUVVRV9TSVpFKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBHZXQgdGhlIGZpcnN0IG9ycGhhbmVkIG9wZXJhdGlvbiBkZXNjcmlwdGlvbi5cbiAgICAgICAgICAgICAgICBjb25zdCBlbnRyeSA9IHRoaXNba1F1ZXVlXS5lbnRyaWVzKCkubmV4dCgpO1xuICAgICAgICAgICAgICAgIGlmIChlbnRyeS52YWx1ZSAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IFtyZXF1ZXN0SWQsIG9ycGhhbmVkXSA9IGVudHJ5LnZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGUgb3JwaGFuZWQgb3BlcmF0aW9uIGRlc2NyaXB0aW9uIGV4aXN0cyB0aGVuIHNldCBpdC5cbiAgICAgICAgICAgICAgICAgICAgb3BlcmF0aW9uRGVzY3JpcHRpb24gPSBvcnBoYW5lZDtcbiAgICAgICAgICAgICAgICAgICAgLy8gUmVtb3ZlIHRoZSBlbnRyeSB3aXRoIHRoZSBiYWQgcmVxdWVzdCBpZCBmcm9tIHRoZSBxdWV1ZS5cbiAgICAgICAgICAgICAgICAgICAgdGhpc1trUXVldWVdLmRlbGV0ZShyZXF1ZXN0SWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoIW9wZXJhdGlvbkRlc2NyaXB0aW9uKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2FsbGJhY2sgPSBvcGVyYXRpb25EZXNjcmlwdGlvbi5jYjtcbiAgICAgICAgLy8gU0VSVkVSLTQ1Nzc1OiBGb3IgZXhoYXVzdCByZXNwb25zZXMgd2Ugc2hvdWxkIGJlIGFibGUgdG8gdXNlIHRoZSBzYW1lIHJlcXVlc3RJZCB0b1xuICAgICAgICAvLyB0cmFjayByZXNwb25zZSwgaG93ZXZlciB0aGUgc2VydmVyIGN1cnJlbnRseSBzeW50aGV0aWNhbGx5IHByb2R1Y2VzIHJlbW90ZSByZXF1ZXN0c1xuICAgICAgICAvLyBtYWtpbmcgdGhlIGByZXNwb25zZVRvYCBjaGFuZ2Ugb24gZWFjaCByZXNwb25zZVxuICAgICAgICB0aGlzW2tRdWV1ZV0uZGVsZXRlKG1lc3NhZ2UucmVzcG9uc2VUbyk7XG4gICAgICAgIGlmICgnbW9yZVRvQ29tZScgaW4gbWVzc2FnZSAmJiBtZXNzYWdlLm1vcmVUb0NvbWUpIHtcbiAgICAgICAgICAgIC8vIElmIHRoZSBvcGVyYXRpb24gZGVzY3JpcHRpb24gY2hlY2sgYWJvdmUgZG9lcyBmaW5kIGFuIG9ycGhhbmVkXG4gICAgICAgICAgICAvLyBkZXNjcmlwdGlvbiBhbmQgc2V0cyB0aGUgb3BlcmF0aW9uRGVzY3JpcHRpb24gdGhlbiB0aGlzIGxpbmUgd2lsbCBwdXQgb25lXG4gICAgICAgICAgICAvLyBiYWNrIGluIHRoZSBxdWV1ZSB3aXRoIHRoZSBjb3JyZWN0IHJlcXVlc3RJZCBhbmQgd2lsbCByZXNvbHZlIG5vdCBiZWluZyBhYmxlXG4gICAgICAgICAgICAvLyB0byBmaW5kIHRoZSBuZXh0IG9uZSB2aWEgdGhlIHJlc3BvbnNlVG8gb2YgdGhlIG5leHQgc3RyZWFtaW5nIGhlbGxvLlxuICAgICAgICAgICAgdGhpc1trUXVldWVdLnNldChtZXNzYWdlLnJlcXVlc3RJZCwgb3BlcmF0aW9uRGVzY3JpcHRpb24pO1xuICAgICAgICAgICAgdGhpc1trU3RyZWFtXS5zZXRUaW1lb3V0KHNvY2tldFRpbWVvdXRNUyk7XG4gICAgICAgIH1cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIFBhc3MgaW4gdGhlIGVudGlyZSBkZXNjcmlwdGlvbiBiZWNhdXNlIGl0IGhhcyBCU09OIHBhcnNpbmcgb3B0aW9uc1xuICAgICAgICAgICAgbWVzc2FnZS5wYXJzZShvcGVyYXRpb25EZXNjcmlwdGlvbik7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgLy8gSWYgdGhpcyBlcnJvciBpcyBnZW5lcmF0ZWQgYnkgb3VyIG93biBjb2RlLCBpdCB3aWxsIGFscmVhZHkgaGF2ZSB0aGUgY29ycmVjdCBjbGFzcyBhcHBsaWVkXG4gICAgICAgICAgICAvLyBpZiBpdCBpcyBub3QsIHRoZW4gaXQgaXMgY29taW5nIGZyb20gYSBjYXRhc3Ryb3BoaWMgZGF0YSBwYXJzZSBmYWlsdXJlIG9yIHRoZSBCU09OIGxpYnJhcnlcbiAgICAgICAgICAgIC8vIGluIGVpdGhlciBjYXNlLCBpdCBzaG91bGQgbm90IGJlIHdyYXBwZWRcbiAgICAgICAgICAgIGNhbGxiYWNrKGVycik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG1lc3NhZ2UuZG9jdW1lbnRzWzBdKSB7XG4gICAgICAgICAgICBjb25zdCBkb2N1bWVudCA9IG1lc3NhZ2UuZG9jdW1lbnRzWzBdO1xuICAgICAgICAgICAgY29uc3Qgc2Vzc2lvbiA9IG9wZXJhdGlvbkRlc2NyaXB0aW9uLnNlc3Npb247XG4gICAgICAgICAgICBpZiAoc2Vzc2lvbikge1xuICAgICAgICAgICAgICAgICgwLCBzZXNzaW9uc18xLnVwZGF0ZVNlc3Npb25Gcm9tUmVzcG9uc2UpKHNlc3Npb24sIGRvY3VtZW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChkb2N1bWVudC4kY2x1c3RlclRpbWUpIHtcbiAgICAgICAgICAgICAgICB0aGlzW2tDbHVzdGVyVGltZV0gPSBkb2N1bWVudC4kY2x1c3RlclRpbWU7XG4gICAgICAgICAgICAgICAgdGhpcy5lbWl0KENvbm5lY3Rpb24uQ0xVU1RFUl9USU1FX1JFQ0VJVkVELCBkb2N1bWVudC4kY2x1c3RlclRpbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGRvY3VtZW50LndyaXRlQ29uY2VybkVycm9yKSB7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2sobmV3IGVycm9yXzEuTW9uZ29Xcml0ZUNvbmNlcm5FcnJvcihkb2N1bWVudC53cml0ZUNvbmNlcm5FcnJvciwgZG9jdW1lbnQpLCBkb2N1bWVudCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGRvY3VtZW50Lm9rID09PSAwIHx8IGRvY3VtZW50LiRlcnIgfHwgZG9jdW1lbnQuZXJybXNnIHx8IGRvY3VtZW50LmNvZGUpIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhuZXcgZXJyb3JfMS5Nb25nb1NlcnZlckVycm9yKGRvY3VtZW50KSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwgbWVzc2FnZS5kb2N1bWVudHNbMF0pO1xuICAgIH1cbiAgICBkZXN0cm95KG9wdGlvbnMsIGNhbGxiYWNrKSB7XG4gICAgICAgIGlmICh0aGlzLmNsb3NlZCkge1xuICAgICAgICAgICAgcHJvY2Vzcy5uZXh0VGljaygoKSA9PiBjYWxsYmFjaz8uKCkpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIHRoaXMub25jZSgnY2xvc2UnLCAoKSA9PiBwcm9jZXNzLm5leHRUaWNrKCgpID0+IGNhbGxiYWNrKCkpKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBsb2FkIGJhbGFuY2VkIG1vZGUgcmVxdWlyZXMgdGhhdCB0aGVzZSBsaXN0ZW5lcnMgcmVtYWluIG9uIHRoZSBjb25uZWN0aW9uXG4gICAgICAgIC8vIGFmdGVyIGNsZWFudXAgb24gdGltZW91dHMsIGVycm9ycyBvciBjbG9zZSBzbyB3ZSByZW1vdmUgdGhlbSBiZWZvcmUgY2FsbGluZ1xuICAgICAgICAvLyBjbGVhbnVwLlxuICAgICAgICB0aGlzLnJlbW92ZUFsbExpc3RlbmVycyhDb25uZWN0aW9uLlBJTk5FRCk7XG4gICAgICAgIHRoaXMucmVtb3ZlQWxsTGlzdGVuZXJzKENvbm5lY3Rpb24uVU5QSU5ORUQpO1xuICAgICAgICBjb25zdCBtZXNzYWdlID0gYGNvbm5lY3Rpb24gJHt0aGlzLmlkfSB0byAke3RoaXMuYWRkcmVzc30gY2xvc2VkYDtcbiAgICAgICAgdGhpcy5jbGVhbnVwKG9wdGlvbnMuZm9yY2UsIG5ldyBlcnJvcl8xLk1vbmdvTmV0d29ya0Vycm9yKG1lc3NhZ2UpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQSBtZXRob2QgdGhhdCBjbGVhbnMgdXAgdGhlIGNvbm5lY3Rpb24uICBXaGVuIGBmb3JjZWAgaXMgdHJ1ZSwgdGhpcyBtZXRob2RcbiAgICAgKiBmb3JjaWJseSBkZXN0cm95cyB0aGUgc29ja2V0LlxuICAgICAqXG4gICAgICogSWYgYW4gZXJyb3IgaXMgcHJvdmlkZWQsIGFueSBpbi1mbGlnaHQgb3BlcmF0aW9ucyB3aWxsIGJlIGNsb3NlZCB3aXRoIHRoZSBlcnJvci5cbiAgICAgKlxuICAgICAqIFRoaXMgbWV0aG9kIGRvZXMgbm90aGluZyBpZiB0aGUgY29ubmVjdGlvbiBpcyBhbHJlYWR5IGNsb3NlZC5cbiAgICAgKi9cbiAgICBjbGVhbnVwKGZvcmNlLCBlcnJvcikge1xuICAgICAgICBpZiAodGhpcy5jbG9zZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNsb3NlZCA9IHRydWU7XG4gICAgICAgIGNvbnN0IGNvbXBsZXRlQ2xlYW51cCA9ICgpID0+IHtcbiAgICAgICAgICAgIGZvciAoY29uc3Qgb3Agb2YgdGhpc1trUXVldWVdLnZhbHVlcygpKSB7XG4gICAgICAgICAgICAgICAgb3AuY2IoZXJyb3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpc1trUXVldWVdLmNsZWFyKCk7XG4gICAgICAgICAgICB0aGlzLmVtaXQoQ29ubmVjdGlvbi5DTE9TRSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXNba1N0cmVhbV0ucmVtb3ZlQWxsTGlzdGVuZXJzKCk7XG4gICAgICAgIHRoaXNba01lc3NhZ2VTdHJlYW1dLnJlbW92ZUFsbExpc3RlbmVycygpO1xuICAgICAgICB0aGlzW2tNZXNzYWdlU3RyZWFtXS5kZXN0cm95KCk7XG4gICAgICAgIGlmIChmb3JjZSkge1xuICAgICAgICAgICAgdGhpc1trU3RyZWFtXS5kZXN0cm95KCk7XG4gICAgICAgICAgICBjb21wbGV0ZUNsZWFudXAoKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXRoaXNba1N0cmVhbV0ud3JpdGFibGVFbmRlZCkge1xuICAgICAgICAgICAgdGhpc1trU3RyZWFtXS5lbmQoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXNba1N0cmVhbV0uZGVzdHJveSgpO1xuICAgICAgICAgICAgICAgIGNvbXBsZXRlQ2xlYW51cCgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb21wbGV0ZUNsZWFudXAoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjb21tYW5kKG5zLCBjb21tYW5kLCBvcHRpb25zLCBjYWxsYmFjaykge1xuICAgICAgICBsZXQgY21kID0geyAuLi5jb21tYW5kIH07XG4gICAgICAgIGNvbnN0IHJlYWRQcmVmZXJlbmNlID0gKDAsIHNoYXJlZF8xLmdldFJlYWRQcmVmZXJlbmNlKShvcHRpb25zKTtcbiAgICAgICAgY29uc3Qgc2hvdWxkVXNlT3BNc2cgPSBzdXBwb3J0c09wTXNnKHRoaXMpO1xuICAgICAgICBjb25zdCBzZXNzaW9uID0gb3B0aW9ucz8uc2Vzc2lvbjtcbiAgICAgICAgbGV0IGNsdXN0ZXJUaW1lID0gdGhpcy5jbHVzdGVyVGltZTtcbiAgICAgICAgaWYgKHRoaXMuc2VydmVyQXBpKSB7XG4gICAgICAgICAgICBjb25zdCB7IHZlcnNpb24sIHN0cmljdCwgZGVwcmVjYXRpb25FcnJvcnMgfSA9IHRoaXMuc2VydmVyQXBpO1xuICAgICAgICAgICAgY21kLmFwaVZlcnNpb24gPSB2ZXJzaW9uO1xuICAgICAgICAgICAgaWYgKHN0cmljdCAhPSBudWxsKVxuICAgICAgICAgICAgICAgIGNtZC5hcGlTdHJpY3QgPSBzdHJpY3Q7XG4gICAgICAgICAgICBpZiAoZGVwcmVjYXRpb25FcnJvcnMgIT0gbnVsbClcbiAgICAgICAgICAgICAgICBjbWQuYXBpRGVwcmVjYXRpb25FcnJvcnMgPSBkZXByZWNhdGlvbkVycm9ycztcbiAgICAgICAgfVxuICAgICAgICBpZiAoaGFzU2Vzc2lvblN1cHBvcnQodGhpcykgJiYgc2Vzc2lvbikge1xuICAgICAgICAgICAgaWYgKHNlc3Npb24uY2x1c3RlclRpbWUgJiZcbiAgICAgICAgICAgICAgICBjbHVzdGVyVGltZSAmJlxuICAgICAgICAgICAgICAgIHNlc3Npb24uY2x1c3RlclRpbWUuY2x1c3RlclRpbWUuZ3JlYXRlclRoYW4oY2x1c3RlclRpbWUuY2x1c3RlclRpbWUpKSB7XG4gICAgICAgICAgICAgICAgY2x1c3RlclRpbWUgPSBzZXNzaW9uLmNsdXN0ZXJUaW1lO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgZXJyID0gKDAsIHNlc3Npb25zXzEuYXBwbHlTZXNzaW9uKShzZXNzaW9uLCBjbWQsIG9wdGlvbnMpO1xuICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHNlc3Npb24/LmV4cGxpY2l0KSB7XG4gICAgICAgICAgICByZXR1cm4gY2FsbGJhY2sobmV3IGVycm9yXzEuTW9uZ29Db21wYXRpYmlsaXR5RXJyb3IoJ0N1cnJlbnQgdG9wb2xvZ3kgZG9lcyBub3Qgc3VwcG9ydCBzZXNzaW9ucycpKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBpZiB3ZSBoYXZlIGEga25vd24gY2x1c3RlciB0aW1lLCBnb3NzaXAgaXRcbiAgICAgICAgaWYgKGNsdXN0ZXJUaW1lKSB7XG4gICAgICAgICAgICBjbWQuJGNsdXN0ZXJUaW1lID0gY2x1c3RlclRpbWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCgwLCBzaGFyZWRfMS5pc1NoYXJkZWQpKHRoaXMpICYmICFzaG91bGRVc2VPcE1zZyAmJiByZWFkUHJlZmVyZW5jZSAmJiByZWFkUHJlZmVyZW5jZS5tb2RlICE9PSAncHJpbWFyeScpIHtcbiAgICAgICAgICAgIGNtZCA9IHtcbiAgICAgICAgICAgICAgICAkcXVlcnk6IGNtZCxcbiAgICAgICAgICAgICAgICAkcmVhZFByZWZlcmVuY2U6IHJlYWRQcmVmZXJlbmNlLnRvSlNPTigpXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNvbW1hbmRPcHRpb25zID0gT2JqZWN0LmFzc2lnbih7XG4gICAgICAgICAgICBudW1iZXJUb1NraXA6IDAsXG4gICAgICAgICAgICBudW1iZXJUb1JldHVybjogLTEsXG4gICAgICAgICAgICBjaGVja0tleXM6IGZhbHNlLFxuICAgICAgICAgICAgLy8gVGhpcyB2YWx1ZSBpcyBub3Qgb3ZlcnJpZGFibGVcbiAgICAgICAgICAgIHNlY29uZGFyeU9rOiByZWFkUHJlZmVyZW5jZS5zZWNvbmRhcnlPaygpXG4gICAgICAgIH0sIG9wdGlvbnMpO1xuICAgICAgICBjb25zdCBjbWROcyA9IGAke25zLmRifS4kY21kYDtcbiAgICAgICAgY29uc3QgbWVzc2FnZSA9IHNob3VsZFVzZU9wTXNnXG4gICAgICAgICAgICA/IG5ldyBjb21tYW5kc18xLk1zZyhjbWROcywgY21kLCBjb21tYW5kT3B0aW9ucylcbiAgICAgICAgICAgIDogbmV3IGNvbW1hbmRzXzEuUXVlcnkoY21kTnMsIGNtZCwgY29tbWFuZE9wdGlvbnMpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgd3JpdGUodGhpcywgbWVzc2FnZSwgY29tbWFuZE9wdGlvbnMsIGNhbGxiYWNrKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICBjYWxsYmFjayhlcnIpO1xuICAgICAgICB9XG4gICAgfVxufVxuLyoqIEBldmVudCAqL1xuQ29ubmVjdGlvbi5DT01NQU5EX1NUQVJURUQgPSBjb25zdGFudHNfMS5DT01NQU5EX1NUQVJURUQ7XG4vKiogQGV2ZW50ICovXG5Db25uZWN0aW9uLkNPTU1BTkRfU1VDQ0VFREVEID0gY29uc3RhbnRzXzEuQ09NTUFORF9TVUNDRUVERUQ7XG4vKiogQGV2ZW50ICovXG5Db25uZWN0aW9uLkNPTU1BTkRfRkFJTEVEID0gY29uc3RhbnRzXzEuQ09NTUFORF9GQUlMRUQ7XG4vKiogQGV2ZW50ICovXG5Db25uZWN0aW9uLkNMVVNURVJfVElNRV9SRUNFSVZFRCA9IGNvbnN0YW50c18xLkNMVVNURVJfVElNRV9SRUNFSVZFRDtcbi8qKiBAZXZlbnQgKi9cbkNvbm5lY3Rpb24uQ0xPU0UgPSBjb25zdGFudHNfMS5DTE9TRTtcbi8qKiBAZXZlbnQgKi9cbkNvbm5lY3Rpb24uTUVTU0FHRSA9IGNvbnN0YW50c18xLk1FU1NBR0U7XG4vKiogQGV2ZW50ICovXG5Db25uZWN0aW9uLlBJTk5FRCA9IGNvbnN0YW50c18xLlBJTk5FRDtcbi8qKiBAZXZlbnQgKi9cbkNvbm5lY3Rpb24uVU5QSU5ORUQgPSBjb25zdGFudHNfMS5VTlBJTk5FRDtcbmV4cG9ydHMuQ29ubmVjdGlvbiA9IENvbm5lY3Rpb247XG4vKiogQGludGVybmFsICovXG5jbGFzcyBDcnlwdG9Db25uZWN0aW9uIGV4dGVuZHMgQ29ubmVjdGlvbiB7XG4gICAgY29uc3RydWN0b3Ioc3RyZWFtLCBvcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKHN0cmVhbSwgb3B0aW9ucyk7XG4gICAgICAgIHRoaXNba0F1dG9FbmNyeXB0ZXJdID0gb3B0aW9ucy5hdXRvRW5jcnlwdGVyO1xuICAgIH1cbiAgICAvKiogQGludGVybmFsIEBvdmVycmlkZSAqL1xuICAgIGNvbW1hbmQobnMsIGNtZCwgb3B0aW9ucywgY2FsbGJhY2spIHtcbiAgICAgICAgY29uc3QgYXV0b0VuY3J5cHRlciA9IHRoaXNba0F1dG9FbmNyeXB0ZXJdO1xuICAgICAgICBpZiAoIWF1dG9FbmNyeXB0ZXIpIHtcbiAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhuZXcgZXJyb3JfMS5Nb25nb01pc3NpbmdEZXBlbmRlbmN5RXJyb3IoJ05vIEF1dG9FbmNyeXB0ZXIgYXZhaWxhYmxlIGZvciBlbmNyeXB0aW9uJykpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHNlcnZlcldpcmVWZXJzaW9uID0gKDAsIHV0aWxzXzEubWF4V2lyZVZlcnNpb24pKHRoaXMpO1xuICAgICAgICBpZiAoc2VydmVyV2lyZVZlcnNpb24gPT09IDApIHtcbiAgICAgICAgICAgIC8vIFRoaXMgbWVhbnMgdGhlIGluaXRpYWwgaGFuZHNoYWtlIGhhc24ndCBoYXBwZW5lZCB5ZXRcbiAgICAgICAgICAgIHJldHVybiBzdXBlci5jb21tYW5kKG5zLCBjbWQsIG9wdGlvbnMsIGNhbGxiYWNrKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc2VydmVyV2lyZVZlcnNpb24gPCA4KSB7XG4gICAgICAgICAgICBjYWxsYmFjayhuZXcgZXJyb3JfMS5Nb25nb0NvbXBhdGliaWxpdHlFcnJvcignQXV0by1lbmNyeXB0aW9uIHJlcXVpcmVzIGEgbWluaW11bSBNb25nb0RCIHZlcnNpb24gb2YgNC4yJykpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIFNhdmUgc29ydCBvciBpbmRleEtleXMgYmFzZWQgb24gdGhlIGNvbW1hbmQgYmVpbmcgcnVuXG4gICAgICAgIC8vIHRoZSBlbmNyeXB0IEFQSSBzZXJpYWxpemVzIG91ciBKUyBvYmplY3RzIHRvIEJTT04gdG8gcGFzcyB0byB0aGUgbmF0aXZlIGNvZGUgbGF5ZXJcbiAgICAgICAgLy8gYW5kIHRoZW4gZGVzZXJpYWxpemVzIHRoZSBlbmNyeXB0ZWQgcmVzdWx0LCB0aGUgcHJvdG9jb2wgbGV2ZWwgY29tcG9uZW50c1xuICAgICAgICAvLyBvZiB0aGUgY29tbWFuZCAoZXguIHNvcnQpIGFyZSB0aGVuIGNvbnZlcnRlZCB0byBKUyBvYmplY3RzIHBvdGVudGlhbGx5IGxvc2luZ1xuICAgICAgICAvLyBpbXBvcnQga2V5IG9yZGVyIGluZm9ybWF0aW9uLiBUaGVzZSBmaWVsZHMgYXJlIG5ldmVyIGVuY3J5cHRlZCBzbyB3ZSBjYW4gc2F2ZSB0aGUgdmFsdWVzXG4gICAgICAgIC8vIGZyb20gYmVmb3JlIHRoZSBlbmNyeXB0aW9uIGFuZCByZXBsYWNlIHRoZW0gYWZ0ZXIgZW5jcnlwdGlvbiBoYXMgYmVlbiBwZXJmb3JtZWRcbiAgICAgICAgY29uc3Qgc29ydCA9IGNtZC5maW5kIHx8IGNtZC5maW5kQW5kTW9kaWZ5ID8gY21kLnNvcnQgOiBudWxsO1xuICAgICAgICBjb25zdCBpbmRleEtleXMgPSBjbWQuY3JlYXRlSW5kZXhlc1xuICAgICAgICAgICAgPyBjbWQuaW5kZXhlcy5tYXAoKGluZGV4KSA9PiBpbmRleC5rZXkpXG4gICAgICAgICAgICA6IG51bGw7XG4gICAgICAgIGF1dG9FbmNyeXB0ZXIuZW5jcnlwdChucy50b1N0cmluZygpLCBjbWQsIG9wdGlvbnMsIChlcnIsIGVuY3J5cHRlZCkgPT4ge1xuICAgICAgICAgICAgaWYgKGVyciB8fCBlbmNyeXB0ZWQgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVyciwgbnVsbCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gUmVwbGFjZSB0aGUgc2F2ZWQgdmFsdWVzXG4gICAgICAgICAgICBpZiAoc29ydCAhPSBudWxsICYmIChjbWQuZmluZCB8fCBjbWQuZmluZEFuZE1vZGlmeSkpIHtcbiAgICAgICAgICAgICAgICBlbmNyeXB0ZWQuc29ydCA9IHNvcnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaW5kZXhLZXlzICE9IG51bGwgJiYgY21kLmNyZWF0ZUluZGV4ZXMpIHtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IFtvZmZzZXQsIGluZGV4XSBvZiBpbmRleEtleXMuZW50cmllcygpKSB7XG4gICAgICAgICAgICAgICAgICAgIGVuY3J5cHRlZC5pbmRleGVzW29mZnNldF0ua2V5ID0gaW5kZXg7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc3VwZXIuY29tbWFuZChucywgZW5jcnlwdGVkLCBvcHRpb25zLCAoZXJyLCByZXNwb25zZSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChlcnIgfHwgcmVzcG9uc2UgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnIsIHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBhdXRvRW5jcnlwdGVyLmRlY3J5cHQocmVzcG9uc2UsIG9wdGlvbnMsIGNhbGxiYWNrKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5leHBvcnRzLkNyeXB0b0Nvbm5lY3Rpb24gPSBDcnlwdG9Db25uZWN0aW9uO1xuLyoqIEBpbnRlcm5hbCAqL1xuZnVuY3Rpb24gaGFzU2Vzc2lvblN1cHBvcnQoY29ubikge1xuICAgIGNvbnN0IGRlc2NyaXB0aW9uID0gY29ubi5kZXNjcmlwdGlvbjtcbiAgICByZXR1cm4gZGVzY3JpcHRpb24ubG9naWNhbFNlc3Npb25UaW1lb3V0TWludXRlcyAhPSBudWxsO1xufVxuZXhwb3J0cy5oYXNTZXNzaW9uU3VwcG9ydCA9IGhhc1Nlc3Npb25TdXBwb3J0O1xuZnVuY3Rpb24gc3VwcG9ydHNPcE1zZyhjb25uKSB7XG4gICAgY29uc3QgZGVzY3JpcHRpb24gPSBjb25uLmRlc2NyaXB0aW9uO1xuICAgIGlmIChkZXNjcmlwdGlvbiA9PSBudWxsKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuICgwLCB1dGlsc18xLm1heFdpcmVWZXJzaW9uKShjb25uKSA+PSA2ICYmICFkZXNjcmlwdGlvbi5fX25vZGVqc19tb2NrX3NlcnZlcl9fO1xufVxuZnVuY3Rpb24gc3RyZWFtSWRlbnRpZmllcihzdHJlYW0sIG9wdGlvbnMpIHtcbiAgICBpZiAob3B0aW9ucy5wcm94eUhvc3QpIHtcbiAgICAgICAgLy8gSWYgcHJveHkgb3B0aW9ucyBhcmUgc3BlY2lmaWVkLCB0aGUgcHJvcGVydGllcyBvZiBgc3RyZWFtYCBpdHNlbGZcbiAgICAgICAgLy8gd2lsbCBub3QgYWNjdXJhdGVseSByZWZsZWN0IHdoYXQgZW5kcG9pbnQgdGhpcyBpcyBjb25uZWN0ZWQgdG8uXG4gICAgICAgIHJldHVybiBvcHRpb25zLmhvc3RBZGRyZXNzLnRvU3RyaW5nKCk7XG4gICAgfVxuICAgIGNvbnN0IHsgcmVtb3RlQWRkcmVzcywgcmVtb3RlUG9ydCB9ID0gc3RyZWFtO1xuICAgIGlmICh0eXBlb2YgcmVtb3RlQWRkcmVzcyA9PT0gJ3N0cmluZycgJiYgdHlwZW9mIHJlbW90ZVBvcnQgPT09ICdudW1iZXInKSB7XG4gICAgICAgIHJldHVybiB1dGlsc18xLkhvc3RBZGRyZXNzLmZyb21Ib3N0UG9ydChyZW1vdGVBZGRyZXNzLCByZW1vdGVQb3J0KS50b1N0cmluZygpO1xuICAgIH1cbiAgICByZXR1cm4gKDAsIHV0aWxzXzEudXVpZFY0KSgpLnRvU3RyaW5nKCdoZXgnKTtcbn1cbmZ1bmN0aW9uIHdyaXRlKGNvbm4sIGNvbW1hbmQsIG9wdGlvbnMsIGNhbGxiYWNrKSB7XG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgPz8ge307XG4gICAgY29uc3Qgb3BlcmF0aW9uRGVzY3JpcHRpb24gPSB7XG4gICAgICAgIHJlcXVlc3RJZDogY29tbWFuZC5yZXF1ZXN0SWQsXG4gICAgICAgIGNiOiBjYWxsYmFjayxcbiAgICAgICAgc2Vzc2lvbjogb3B0aW9ucy5zZXNzaW9uLFxuICAgICAgICBub1Jlc3BvbnNlOiB0eXBlb2Ygb3B0aW9ucy5ub1Jlc3BvbnNlID09PSAnYm9vbGVhbicgPyBvcHRpb25zLm5vUmVzcG9uc2UgOiBmYWxzZSxcbiAgICAgICAgZG9jdW1lbnRzUmV0dXJuZWRJbjogb3B0aW9ucy5kb2N1bWVudHNSZXR1cm5lZEluLFxuICAgICAgICAvLyBmb3IgQlNPTiBwYXJzaW5nXG4gICAgICAgIHVzZUJpZ0ludDY0OiB0eXBlb2Ygb3B0aW9ucy51c2VCaWdJbnQ2NCA9PT0gJ2Jvb2xlYW4nID8gb3B0aW9ucy51c2VCaWdJbnQ2NCA6IGZhbHNlLFxuICAgICAgICBwcm9tb3RlTG9uZ3M6IHR5cGVvZiBvcHRpb25zLnByb21vdGVMb25ncyA9PT0gJ2Jvb2xlYW4nID8gb3B0aW9ucy5wcm9tb3RlTG9uZ3MgOiB0cnVlLFxuICAgICAgICBwcm9tb3RlVmFsdWVzOiB0eXBlb2Ygb3B0aW9ucy5wcm9tb3RlVmFsdWVzID09PSAnYm9vbGVhbicgPyBvcHRpb25zLnByb21vdGVWYWx1ZXMgOiB0cnVlLFxuICAgICAgICBwcm9tb3RlQnVmZmVyczogdHlwZW9mIG9wdGlvbnMucHJvbW90ZUJ1ZmZlcnMgPT09ICdib29sZWFuJyA/IG9wdGlvbnMucHJvbW90ZUJ1ZmZlcnMgOiBmYWxzZSxcbiAgICAgICAgYnNvblJlZ0V4cDogdHlwZW9mIG9wdGlvbnMuYnNvblJlZ0V4cCA9PT0gJ2Jvb2xlYW4nID8gb3B0aW9ucy5ic29uUmVnRXhwIDogZmFsc2UsXG4gICAgICAgIGVuYWJsZVV0ZjhWYWxpZGF0aW9uOiB0eXBlb2Ygb3B0aW9ucy5lbmFibGVVdGY4VmFsaWRhdGlvbiA9PT0gJ2Jvb2xlYW4nID8gb3B0aW9ucy5lbmFibGVVdGY4VmFsaWRhdGlvbiA6IHRydWUsXG4gICAgICAgIHJhdzogdHlwZW9mIG9wdGlvbnMucmF3ID09PSAnYm9vbGVhbicgPyBvcHRpb25zLnJhdyA6IGZhbHNlLFxuICAgICAgICBzdGFydGVkOiAwXG4gICAgfTtcbiAgICBpZiAoY29ubltrRGVzY3JpcHRpb25dICYmIGNvbm5ba0Rlc2NyaXB0aW9uXS5jb21wcmVzc29yKSB7XG4gICAgICAgIG9wZXJhdGlvbkRlc2NyaXB0aW9uLmFncmVlZENvbXByZXNzb3IgPSBjb25uW2tEZXNjcmlwdGlvbl0uY29tcHJlc3NvcjtcbiAgICAgICAgaWYgKGNvbm5ba0Rlc2NyaXB0aW9uXS56bGliQ29tcHJlc3Npb25MZXZlbCkge1xuICAgICAgICAgICAgb3BlcmF0aW9uRGVzY3JpcHRpb24uemxpYkNvbXByZXNzaW9uTGV2ZWwgPSBjb25uW2tEZXNjcmlwdGlvbl0uemxpYkNvbXByZXNzaW9uTGV2ZWw7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKHR5cGVvZiBvcHRpb25zLnNvY2tldFRpbWVvdXRNUyA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgY29ubltrU3RyZWFtXS5zZXRUaW1lb3V0KG9wdGlvbnMuc29ja2V0VGltZW91dE1TKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoY29ubi5zb2NrZXRUaW1lb3V0TVMgIT09IDApIHtcbiAgICAgICAgY29ubltrU3RyZWFtXS5zZXRUaW1lb3V0KGNvbm4uc29ja2V0VGltZW91dE1TKTtcbiAgICB9XG4gICAgLy8gaWYgY29tbWFuZCBtb25pdG9yaW5nIGlzIGVuYWJsZWQgd2UgbmVlZCB0byBtb2RpZnkgdGhlIGNhbGxiYWNrIGhlcmVcbiAgICBpZiAoY29ubi5tb25pdG9yQ29tbWFuZHMpIHtcbiAgICAgICAgY29ubi5lbWl0KENvbm5lY3Rpb24uQ09NTUFORF9TVEFSVEVELCBuZXcgY29tbWFuZF9tb25pdG9yaW5nX2V2ZW50c18xLkNvbW1hbmRTdGFydGVkRXZlbnQoY29ubiwgY29tbWFuZCkpO1xuICAgICAgICBvcGVyYXRpb25EZXNjcmlwdGlvbi5zdGFydGVkID0gKDAsIHV0aWxzXzEubm93KSgpO1xuICAgICAgICBvcGVyYXRpb25EZXNjcmlwdGlvbi5jYiA9IChlcnIsIHJlcGx5KSA9PiB7XG4gICAgICAgICAgICAvLyBDb21tYW5kIG1vbml0b3Jpbmcgc3BlYyBzdGF0ZXMgdGhhdCBpZiBvayBpcyAxLCB0aGVuIHdlIG11c3QgYWx3YXlzIGVtaXRcbiAgICAgICAgICAgIC8vIGEgY29tbWFuZCBzdWNjZWVkZWQgZXZlbnQsIGV2ZW4gaWYgdGhlcmUncyBhbiBlcnJvci4gV3JpdGUgY29uY2VybiBlcnJvcnNcbiAgICAgICAgICAgIC8vIHdpbGwgaGF2ZSBhbiBvazogMSBpbiB0aGVpciByZXBseS5cbiAgICAgICAgICAgIGlmIChlcnIgJiYgcmVwbHk/Lm9rICE9PSAxKSB7XG4gICAgICAgICAgICAgICAgY29ubi5lbWl0KENvbm5lY3Rpb24uQ09NTUFORF9GQUlMRUQsIG5ldyBjb21tYW5kX21vbml0b3JpbmdfZXZlbnRzXzEuQ29tbWFuZEZhaWxlZEV2ZW50KGNvbm4sIGNvbW1hbmQsIGVyciwgb3BlcmF0aW9uRGVzY3JpcHRpb24uc3RhcnRlZCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKHJlcGx5ICYmIChyZXBseS5vayA9PT0gMCB8fCByZXBseS4kZXJyKSkge1xuICAgICAgICAgICAgICAgICAgICBjb25uLmVtaXQoQ29ubmVjdGlvbi5DT01NQU5EX0ZBSUxFRCwgbmV3IGNvbW1hbmRfbW9uaXRvcmluZ19ldmVudHNfMS5Db21tYW5kRmFpbGVkRXZlbnQoY29ubiwgY29tbWFuZCwgcmVwbHksIG9wZXJhdGlvbkRlc2NyaXB0aW9uLnN0YXJ0ZWQpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbm4uZW1pdChDb25uZWN0aW9uLkNPTU1BTkRfU1VDQ0VFREVELCBuZXcgY29tbWFuZF9tb25pdG9yaW5nX2V2ZW50c18xLkNvbW1hbmRTdWNjZWVkZWRFdmVudChjb25uLCBjb21tYW5kLCByZXBseSwgb3BlcmF0aW9uRGVzY3JpcHRpb24uc3RhcnRlZCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICAvLyBTaW5jZSB3ZSdyZSBwYXNzaW5nIHRocm91Z2ggdGhlIHJlcGx5IHdpdGggdGhlIHdyaXRlIGNvbmNlcm4gZXJyb3Igbm93LCB3ZVxuICAgICAgICAgICAgICAgIC8vIG5lZWQgaXQgbm90IHRvIGJlIHByb3ZpZGVkIHRvIHRoZSBvcmlnaW5hbCBjYWxsYmFjayBpbiB0aGlzIGNhc2Ugc29cbiAgICAgICAgICAgICAgICAvLyByZXRyeWFiaWxpdHkgZG9lcyBub3QgZ2V0IHRyaWNrZWQgaW50byB0aGlua2luZyB0aGUgY29tbWFuZCBhY3R1YWxseVxuICAgICAgICAgICAgICAgIC8vIHN1Y2NlZWRlZC5cbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnIsIGVyciBpbnN0YW5jZW9mIGVycm9yXzEuTW9uZ29Xcml0ZUNvbmNlcm5FcnJvciA/IHVuZGVmaW5lZCA6IHJlcGx5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9XG4gICAgaWYgKCFvcGVyYXRpb25EZXNjcmlwdGlvbi5ub1Jlc3BvbnNlKSB7XG4gICAgICAgIGNvbm5ba1F1ZXVlXS5zZXQob3BlcmF0aW9uRGVzY3JpcHRpb24ucmVxdWVzdElkLCBvcGVyYXRpb25EZXNjcmlwdGlvbik7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICAgIGNvbm5ba01lc3NhZ2VTdHJlYW1dLndyaXRlQ29tbWFuZChjb21tYW5kLCBvcGVyYXRpb25EZXNjcmlwdGlvbik7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIGlmICghb3BlcmF0aW9uRGVzY3JpcHRpb24ubm9SZXNwb25zZSkge1xuICAgICAgICAgICAgY29ubltrUXVldWVdLmRlbGV0ZShvcGVyYXRpb25EZXNjcmlwdGlvbi5yZXF1ZXN0SWQpO1xuICAgICAgICAgICAgb3BlcmF0aW9uRGVzY3JpcHRpb24uY2IoZSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKG9wZXJhdGlvbkRlc2NyaXB0aW9uLm5vUmVzcG9uc2UpIHtcbiAgICAgICAgb3BlcmF0aW9uRGVzY3JpcHRpb24uY2IoKTtcbiAgICB9XG59XG4vLyMgc291cmNlTWFwcGluZ1VSTD1jb25uZWN0aW9uLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/cmap/connection.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/cmap/connection_pool.js":
/*!******************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/cmap/connection_pool.js ***!
  \******************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.ConnectionPool = exports.PoolState = void 0;\nconst timers_1 = __webpack_require__(/*! timers */ \"timers\");\nconst constants_1 = __webpack_require__(/*! ../constants */ \"(api)/../server/node_modules/mongodb/lib/constants.js\");\nconst error_1 = __webpack_require__(/*! ../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst mongo_types_1 = __webpack_require__(/*! ../mongo_types */ \"(api)/../server/node_modules/mongodb/lib/mongo_types.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\nconst connect_1 = __webpack_require__(/*! ./connect */ \"(api)/../server/node_modules/mongodb/lib/cmap/connect.js\");\nconst connection_1 = __webpack_require__(/*! ./connection */ \"(api)/../server/node_modules/mongodb/lib/cmap/connection.js\");\nconst connection_pool_events_1 = __webpack_require__(/*! ./connection_pool_events */ \"(api)/../server/node_modules/mongodb/lib/cmap/connection_pool_events.js\");\nconst errors_1 = __webpack_require__(/*! ./errors */ \"(api)/../server/node_modules/mongodb/lib/cmap/errors.js\");\nconst metrics_1 = __webpack_require__(/*! ./metrics */ \"(api)/../server/node_modules/mongodb/lib/cmap/metrics.js\");\n/** @internal */\nconst kServer = Symbol('server');\n/** @internal */\nconst kConnections = Symbol('connections');\n/** @internal */\nconst kPending = Symbol('pending');\n/** @internal */\nconst kCheckedOut = Symbol('checkedOut');\n/** @internal */\nconst kMinPoolSizeTimer = Symbol('minPoolSizeTimer');\n/** @internal */\nconst kGeneration = Symbol('generation');\n/** @internal */\nconst kServiceGenerations = Symbol('serviceGenerations');\n/** @internal */\nconst kConnectionCounter = Symbol('connectionCounter');\n/** @internal */\nconst kCancellationToken = Symbol('cancellationToken');\n/** @internal */\nconst kWaitQueue = Symbol('waitQueue');\n/** @internal */\nconst kCancelled = Symbol('cancelled');\n/** @internal */\nconst kMetrics = Symbol('metrics');\n/** @internal */\nconst kProcessingWaitQueue = Symbol('processingWaitQueue');\n/** @internal */\nconst kPoolState = Symbol('poolState');\n/** @internal */\nexports.PoolState = Object.freeze({\n    paused: 'paused',\n    ready: 'ready',\n    closed: 'closed'\n});\n/**\n * A pool of connections which dynamically resizes, and emit events related to pool activity\n * @internal\n */\nclass ConnectionPool extends mongo_types_1.TypedEventEmitter {\n    constructor(server, options) {\n        super();\n        this.options = Object.freeze({\n            ...options,\n            connectionType: connection_1.Connection,\n            maxPoolSize: options.maxPoolSize ?? 100,\n            minPoolSize: options.minPoolSize ?? 0,\n            maxConnecting: options.maxConnecting ?? 2,\n            maxIdleTimeMS: options.maxIdleTimeMS ?? 0,\n            waitQueueTimeoutMS: options.waitQueueTimeoutMS ?? 0,\n            minPoolSizeCheckFrequencyMS: options.minPoolSizeCheckFrequencyMS ?? 100,\n            autoEncrypter: options.autoEncrypter,\n            metadata: options.metadata\n        });\n        if (this.options.minPoolSize > this.options.maxPoolSize) {\n            throw new error_1.MongoInvalidArgumentError('Connection pool minimum size must not be greater than maximum pool size');\n        }\n        this[kPoolState] = exports.PoolState.paused;\n        this[kServer] = server;\n        this[kConnections] = new utils_1.List();\n        this[kPending] = 0;\n        this[kCheckedOut] = new Set();\n        this[kMinPoolSizeTimer] = undefined;\n        this[kGeneration] = 0;\n        this[kServiceGenerations] = new Map();\n        this[kConnectionCounter] = (0, utils_1.makeCounter)(1);\n        this[kCancellationToken] = new mongo_types_1.CancellationToken();\n        this[kCancellationToken].setMaxListeners(Infinity);\n        this[kWaitQueue] = new utils_1.List();\n        this[kMetrics] = new metrics_1.ConnectionPoolMetrics();\n        this[kProcessingWaitQueue] = false;\n        this.mongoLogger = this[kServer].topology.client.mongoLogger;\n        this.component = 'connection';\n        process.nextTick(() => {\n            this.emitAndLog(ConnectionPool.CONNECTION_POOL_CREATED, new connection_pool_events_1.ConnectionPoolCreatedEvent(this));\n        });\n    }\n    /** The address of the endpoint the pool is connected to */\n    get address() {\n        return this.options.hostAddress.toString();\n    }\n    /**\n     * Check if the pool has been closed\n     *\n     * TODO(NODE-3263): We can remove this property once shell no longer needs it\n     */\n    get closed() {\n        return this[kPoolState] === exports.PoolState.closed;\n    }\n    /** An integer representing the SDAM generation of the pool */\n    get generation() {\n        return this[kGeneration];\n    }\n    /** An integer expressing how many total connections (available + pending + in use) the pool currently has */\n    get totalConnectionCount() {\n        return (this.availableConnectionCount + this.pendingConnectionCount + this.currentCheckedOutCount);\n    }\n    /** An integer expressing how many connections are currently available in the pool. */\n    get availableConnectionCount() {\n        return this[kConnections].length;\n    }\n    get pendingConnectionCount() {\n        return this[kPending];\n    }\n    get currentCheckedOutCount() {\n        return this[kCheckedOut].size;\n    }\n    get waitQueueSize() {\n        return this[kWaitQueue].length;\n    }\n    get loadBalanced() {\n        return this.options.loadBalanced;\n    }\n    get serviceGenerations() {\n        return this[kServiceGenerations];\n    }\n    get serverError() {\n        return this[kServer].description.error;\n    }\n    /**\n     * This is exposed ONLY for use in mongosh, to enable\n     * killing all connections if a user quits the shell with\n     * operations in progress.\n     *\n     * This property may be removed as a part of NODE-3263.\n     */\n    get checkedOutConnections() {\n        return this[kCheckedOut];\n    }\n    /**\n     * Get the metrics information for the pool when a wait queue timeout occurs.\n     */\n    waitQueueErrorMetrics() {\n        return this[kMetrics].info(this.options.maxPoolSize);\n    }\n    /**\n     * Set the pool state to \"ready\"\n     */\n    ready() {\n        if (this[kPoolState] !== exports.PoolState.paused) {\n            return;\n        }\n        this[kPoolState] = exports.PoolState.ready;\n        this.emitAndLog(ConnectionPool.CONNECTION_POOL_READY, new connection_pool_events_1.ConnectionPoolReadyEvent(this));\n        (0, timers_1.clearTimeout)(this[kMinPoolSizeTimer]);\n        this.ensureMinPoolSize();\n    }\n    /**\n     * Check a connection out of this pool. The connection will continue to be tracked, but no reference to it\n     * will be held by the pool. This means that if a connection is checked out it MUST be checked back in or\n     * explicitly destroyed by the new owner.\n     */\n    checkOut(callback) {\n        this.emitAndLog(ConnectionPool.CONNECTION_CHECK_OUT_STARTED, new connection_pool_events_1.ConnectionCheckOutStartedEvent(this));\n        const waitQueueMember = { callback };\n        const waitQueueTimeoutMS = this.options.waitQueueTimeoutMS;\n        if (waitQueueTimeoutMS) {\n            waitQueueMember.timer = (0, timers_1.setTimeout)(() => {\n                waitQueueMember[kCancelled] = true;\n                waitQueueMember.timer = undefined;\n                this.emitAndLog(ConnectionPool.CONNECTION_CHECK_OUT_FAILED, new connection_pool_events_1.ConnectionCheckOutFailedEvent(this, 'timeout'));\n                waitQueueMember.callback(new errors_1.WaitQueueTimeoutError(this.loadBalanced\n                    ? this.waitQueueErrorMetrics()\n                    : 'Timed out while checking out a connection from connection pool', this.address));\n            }, waitQueueTimeoutMS);\n        }\n        this[kWaitQueue].push(waitQueueMember);\n        process.nextTick(() => this.processWaitQueue());\n    }\n    /**\n     * Check a connection into the pool.\n     *\n     * @param connection - The connection to check in\n     */\n    checkIn(connection) {\n        if (!this[kCheckedOut].has(connection)) {\n            return;\n        }\n        const poolClosed = this.closed;\n        const stale = this.connectionIsStale(connection);\n        const willDestroy = !!(poolClosed || stale || connection.closed);\n        if (!willDestroy) {\n            connection.markAvailable();\n            this[kConnections].unshift(connection);\n        }\n        this[kCheckedOut].delete(connection);\n        this.emitAndLog(ConnectionPool.CONNECTION_CHECKED_IN, new connection_pool_events_1.ConnectionCheckedInEvent(this, connection));\n        if (willDestroy) {\n            const reason = connection.closed ? 'error' : poolClosed ? 'poolClosed' : 'stale';\n            this.destroyConnection(connection, reason);\n        }\n        process.nextTick(() => this.processWaitQueue());\n    }\n    /**\n     * Clear the pool\n     *\n     * Pool reset is handled by incrementing the pool's generation count. Any existing connection of a\n     * previous generation will eventually be pruned during subsequent checkouts.\n     */\n    clear(options = {}) {\n        if (this.closed) {\n            return;\n        }\n        // handle load balanced case\n        if (this.loadBalanced) {\n            const { serviceId } = options;\n            if (!serviceId) {\n                throw new error_1.MongoRuntimeError('ConnectionPool.clear() called in load balanced mode with no serviceId.');\n            }\n            const sid = serviceId.toHexString();\n            const generation = this.serviceGenerations.get(sid);\n            // Only need to worry if the generation exists, since it should\n            // always be there but typescript needs the check.\n            if (generation == null) {\n                throw new error_1.MongoRuntimeError('Service generations are required in load balancer mode.');\n            }\n            else {\n                // Increment the generation for the service id.\n                this.serviceGenerations.set(sid, generation + 1);\n            }\n            this.emitAndLog(ConnectionPool.CONNECTION_POOL_CLEARED, new connection_pool_events_1.ConnectionPoolClearedEvent(this, { serviceId }));\n            return;\n        }\n        // handle non load-balanced case\n        const interruptInUseConnections = options.interruptInUseConnections ?? false;\n        const oldGeneration = this[kGeneration];\n        this[kGeneration] += 1;\n        const alreadyPaused = this[kPoolState] === exports.PoolState.paused;\n        this[kPoolState] = exports.PoolState.paused;\n        this.clearMinPoolSizeTimer();\n        if (!alreadyPaused) {\n            this.emitAndLog(ConnectionPool.CONNECTION_POOL_CLEARED, new connection_pool_events_1.ConnectionPoolClearedEvent(this, {\n                interruptInUseConnections\n            }));\n        }\n        if (interruptInUseConnections) {\n            process.nextTick(() => this.interruptInUseConnections(oldGeneration));\n        }\n        this.processWaitQueue();\n    }\n    /**\n     * Closes all stale in-use connections in the pool with a resumable PoolClearedOnNetworkError.\n     *\n     * Only connections where `connection.generation <= minGeneration` are killed.\n     */\n    interruptInUseConnections(minGeneration) {\n        for (const connection of this[kCheckedOut]) {\n            if (connection.generation <= minGeneration) {\n                this.checkIn(connection);\n                connection.onError(new errors_1.PoolClearedOnNetworkError(this));\n            }\n        }\n    }\n    close(_options, _cb) {\n        let options = _options;\n        const callback = (_cb ?? _options);\n        if (typeof options === 'function') {\n            options = {};\n        }\n        options = Object.assign({ force: false }, options);\n        if (this.closed) {\n            return callback();\n        }\n        // immediately cancel any in-flight connections\n        this[kCancellationToken].emit('cancel');\n        // end the connection counter\n        if (typeof this[kConnectionCounter].return === 'function') {\n            this[kConnectionCounter].return(undefined);\n        }\n        this[kPoolState] = exports.PoolState.closed;\n        this.clearMinPoolSizeTimer();\n        this.processWaitQueue();\n        (0, utils_1.eachAsync)(this[kConnections].toArray(), (conn, cb) => {\n            this.emitAndLog(ConnectionPool.CONNECTION_CLOSED, new connection_pool_events_1.ConnectionClosedEvent(this, conn, 'poolClosed'));\n            conn.destroy({ force: !!options.force }, cb);\n        }, err => {\n            this[kConnections].clear();\n            this.emitAndLog(ConnectionPool.CONNECTION_POOL_CLOSED, new connection_pool_events_1.ConnectionPoolClosedEvent(this));\n            callback(err);\n        });\n    }\n    /**\n     * Runs a lambda with an implicitly checked out connection, checking that connection back in when the lambda\n     * has completed by calling back.\n     *\n     * NOTE: please note the required signature of `fn`\n     *\n     * @remarks When in load balancer mode, connections can be pinned to cursors or transactions.\n     *   In these cases we pass the connection in to this method to ensure it is used and a new\n     *   connection is not checked out.\n     *\n     * @param conn - A pinned connection for use in load balancing mode.\n     * @param fn - A function which operates on a managed connection\n     * @param callback - The original callback\n     */\n    withConnection(conn, fn, callback) {\n        if (conn) {\n            // use the provided connection, and do _not_ check it in after execution\n            fn(undefined, conn, (fnErr, result) => {\n                if (fnErr) {\n                    return this.withReauthentication(fnErr, conn, fn, callback);\n                }\n                callback(undefined, result);\n            });\n            return;\n        }\n        this.checkOut((err, conn) => {\n            // don't callback with `err` here, we might want to act upon it inside `fn`\n            fn(err, conn, (fnErr, result) => {\n                if (fnErr) {\n                    if (conn) {\n                        this.withReauthentication(fnErr, conn, fn, callback);\n                    }\n                    else {\n                        callback(fnErr);\n                    }\n                }\n                else {\n                    callback(undefined, result);\n                }\n                if (conn) {\n                    this.checkIn(conn);\n                }\n            });\n        });\n    }\n    withReauthentication(fnErr, conn, fn, callback) {\n        if (fnErr instanceof error_1.MongoError && fnErr.code === error_1.MONGODB_ERROR_CODES.Reauthenticate) {\n            this.reauthenticate(conn, fn, (error, res) => {\n                if (error) {\n                    return callback(error);\n                }\n                callback(undefined, res);\n            });\n        }\n        else {\n            callback(fnErr);\n        }\n    }\n    /**\n     * Reauthenticate on the same connection and then retry the operation.\n     */\n    reauthenticate(connection, fn, callback) {\n        const authContext = connection.authContext;\n        if (!authContext) {\n            return callback(new error_1.MongoRuntimeError('No auth context found on connection.'));\n        }\n        const credentials = authContext.credentials;\n        if (!credentials) {\n            return callback(new error_1.MongoMissingCredentialsError('Connection is missing credentials when asked to reauthenticate'));\n        }\n        const resolvedCredentials = credentials.resolveAuthMechanism(connection.hello || undefined);\n        const provider = connect_1.AUTH_PROVIDERS.get(resolvedCredentials.mechanism);\n        if (!provider) {\n            return callback(new error_1.MongoMissingCredentialsError(`Reauthenticate failed due to no auth provider for ${credentials.mechanism}`));\n        }\n        provider.reauth(authContext).then(() => {\n            fn(undefined, connection, (fnErr, fnResult) => {\n                if (fnErr) {\n                    return callback(fnErr);\n                }\n                callback(undefined, fnResult);\n            });\n        }, error => callback(error));\n    }\n    /** Clear the min pool size timer */\n    clearMinPoolSizeTimer() {\n        const minPoolSizeTimer = this[kMinPoolSizeTimer];\n        if (minPoolSizeTimer) {\n            (0, timers_1.clearTimeout)(minPoolSizeTimer);\n        }\n    }\n    destroyConnection(connection, reason) {\n        this.emitAndLog(ConnectionPool.CONNECTION_CLOSED, new connection_pool_events_1.ConnectionClosedEvent(this, connection, reason));\n        // destroy the connection\n        process.nextTick(() => connection.destroy({ force: false }));\n    }\n    connectionIsStale(connection) {\n        const serviceId = connection.serviceId;\n        if (this.loadBalanced && serviceId) {\n            const sid = serviceId.toHexString();\n            const generation = this.serviceGenerations.get(sid);\n            return connection.generation !== generation;\n        }\n        return connection.generation !== this[kGeneration];\n    }\n    connectionIsIdle(connection) {\n        return !!(this.options.maxIdleTimeMS && connection.idleTime > this.options.maxIdleTimeMS);\n    }\n    /**\n     * Destroys a connection if the connection is perished.\n     *\n     * @returns `true` if the connection was destroyed, `false` otherwise.\n     */\n    destroyConnectionIfPerished(connection) {\n        const isStale = this.connectionIsStale(connection);\n        const isIdle = this.connectionIsIdle(connection);\n        if (!isStale && !isIdle && !connection.closed) {\n            return false;\n        }\n        const reason = connection.closed ? 'error' : isStale ? 'stale' : 'idle';\n        this.destroyConnection(connection, reason);\n        return true;\n    }\n    createConnection(callback) {\n        const connectOptions = {\n            ...this.options,\n            id: this[kConnectionCounter].next().value,\n            generation: this[kGeneration],\n            cancellationToken: this[kCancellationToken]\n        };\n        this[kPending]++;\n        // This is our version of a \"virtual\" no-I/O connection as the spec requires\n        this.emitAndLog(ConnectionPool.CONNECTION_CREATED, new connection_pool_events_1.ConnectionCreatedEvent(this, { id: connectOptions.id }));\n        (0, connect_1.connect)(connectOptions, (err, connection) => {\n            if (err || !connection) {\n                this[kPending]--;\n                this.emitAndLog(ConnectionPool.CONNECTION_CLOSED, new connection_pool_events_1.ConnectionClosedEvent(this, { id: connectOptions.id, serviceId: undefined }, 'error', \n                // TODO(NODE-5192): Remove this cast\n                err));\n                if (err instanceof error_1.MongoNetworkError || err instanceof error_1.MongoServerError) {\n                    err.connectionGeneration = connectOptions.generation;\n                }\n                callback(err ?? new error_1.MongoRuntimeError('Connection creation failed without error'));\n                return;\n            }\n            // The pool might have closed since we started trying to create a connection\n            if (this[kPoolState] !== exports.PoolState.ready) {\n                this[kPending]--;\n                connection.destroy({ force: true });\n                callback(this.closed ? new errors_1.PoolClosedError(this) : new errors_1.PoolClearedError(this));\n                return;\n            }\n            // forward all events from the connection to the pool\n            for (const event of [...constants_1.APM_EVENTS, connection_1.Connection.CLUSTER_TIME_RECEIVED]) {\n                connection.on(event, (e) => this.emit(event, e));\n            }\n            if (this.loadBalanced) {\n                connection.on(connection_1.Connection.PINNED, pinType => this[kMetrics].markPinned(pinType));\n                connection.on(connection_1.Connection.UNPINNED, pinType => this[kMetrics].markUnpinned(pinType));\n                const serviceId = connection.serviceId;\n                if (serviceId) {\n                    let generation;\n                    const sid = serviceId.toHexString();\n                    if ((generation = this.serviceGenerations.get(sid))) {\n                        connection.generation = generation;\n                    }\n                    else {\n                        this.serviceGenerations.set(sid, 0);\n                        connection.generation = 0;\n                    }\n                }\n            }\n            connection.markAvailable();\n            this.emitAndLog(ConnectionPool.CONNECTION_READY, new connection_pool_events_1.ConnectionReadyEvent(this, connection));\n            this[kPending]--;\n            callback(undefined, connection);\n            return;\n        });\n    }\n    ensureMinPoolSize() {\n        const minPoolSize = this.options.minPoolSize;\n        if (this[kPoolState] !== exports.PoolState.ready || minPoolSize === 0) {\n            return;\n        }\n        this[kConnections].prune(connection => this.destroyConnectionIfPerished(connection));\n        if (this.totalConnectionCount < minPoolSize &&\n            this.pendingConnectionCount < this.options.maxConnecting) {\n            // NOTE: ensureMinPoolSize should not try to get all the pending\n            // connection permits because that potentially delays the availability of\n            // the connection to a checkout request\n            this.createConnection((err, connection) => {\n                if (err) {\n                    this[kServer].handleError(err);\n                }\n                if (!err && connection) {\n                    this[kConnections].push(connection);\n                    process.nextTick(() => this.processWaitQueue());\n                }\n                if (this[kPoolState] === exports.PoolState.ready) {\n                    (0, timers_1.clearTimeout)(this[kMinPoolSizeTimer]);\n                    this[kMinPoolSizeTimer] = (0, timers_1.setTimeout)(() => this.ensureMinPoolSize(), this.options.minPoolSizeCheckFrequencyMS);\n                }\n            });\n        }\n        else {\n            (0, timers_1.clearTimeout)(this[kMinPoolSizeTimer]);\n            this[kMinPoolSizeTimer] = (0, timers_1.setTimeout)(() => this.ensureMinPoolSize(), this.options.minPoolSizeCheckFrequencyMS);\n        }\n    }\n    processWaitQueue() {\n        if (this[kProcessingWaitQueue]) {\n            return;\n        }\n        this[kProcessingWaitQueue] = true;\n        while (this.waitQueueSize) {\n            const waitQueueMember = this[kWaitQueue].first();\n            if (!waitQueueMember) {\n                this[kWaitQueue].shift();\n                continue;\n            }\n            if (waitQueueMember[kCancelled]) {\n                this[kWaitQueue].shift();\n                continue;\n            }\n            if (this[kPoolState] !== exports.PoolState.ready) {\n                const reason = this.closed ? 'poolClosed' : 'connectionError';\n                const error = this.closed ? new errors_1.PoolClosedError(this) : new errors_1.PoolClearedError(this);\n                this.emitAndLog(ConnectionPool.CONNECTION_CHECK_OUT_FAILED, new connection_pool_events_1.ConnectionCheckOutFailedEvent(this, reason, error));\n                if (waitQueueMember.timer) {\n                    (0, timers_1.clearTimeout)(waitQueueMember.timer);\n                }\n                this[kWaitQueue].shift();\n                waitQueueMember.callback(error);\n                continue;\n            }\n            if (!this.availableConnectionCount) {\n                break;\n            }\n            const connection = this[kConnections].shift();\n            if (!connection) {\n                break;\n            }\n            if (!this.destroyConnectionIfPerished(connection)) {\n                this[kCheckedOut].add(connection);\n                this.emitAndLog(ConnectionPool.CONNECTION_CHECKED_OUT, new connection_pool_events_1.ConnectionCheckedOutEvent(this, connection));\n                if (waitQueueMember.timer) {\n                    (0, timers_1.clearTimeout)(waitQueueMember.timer);\n                }\n                this[kWaitQueue].shift();\n                waitQueueMember.callback(undefined, connection);\n            }\n        }\n        const { maxPoolSize, maxConnecting } = this.options;\n        while (this.waitQueueSize > 0 &&\n            this.pendingConnectionCount < maxConnecting &&\n            (maxPoolSize === 0 || this.totalConnectionCount < maxPoolSize)) {\n            const waitQueueMember = this[kWaitQueue].shift();\n            if (!waitQueueMember || waitQueueMember[kCancelled]) {\n                continue;\n            }\n            this.createConnection((err, connection) => {\n                if (waitQueueMember[kCancelled]) {\n                    if (!err && connection) {\n                        this[kConnections].push(connection);\n                    }\n                }\n                else {\n                    if (err) {\n                        this.emitAndLog(ConnectionPool.CONNECTION_CHECK_OUT_FAILED, \n                        // TODO(NODE-5192): Remove this cast\n                        new connection_pool_events_1.ConnectionCheckOutFailedEvent(this, 'connectionError', err));\n                    }\n                    else if (connection) {\n                        this[kCheckedOut].add(connection);\n                        this.emitAndLog(ConnectionPool.CONNECTION_CHECKED_OUT, new connection_pool_events_1.ConnectionCheckedOutEvent(this, connection));\n                    }\n                    if (waitQueueMember.timer) {\n                        (0, timers_1.clearTimeout)(waitQueueMember.timer);\n                    }\n                    waitQueueMember.callback(err, connection);\n                }\n                process.nextTick(() => this.processWaitQueue());\n            });\n        }\n        this[kProcessingWaitQueue] = false;\n    }\n}\n/**\n * Emitted when the connection pool is created.\n * @event\n */\nConnectionPool.CONNECTION_POOL_CREATED = constants_1.CONNECTION_POOL_CREATED;\n/**\n * Emitted once when the connection pool is closed\n * @event\n */\nConnectionPool.CONNECTION_POOL_CLOSED = constants_1.CONNECTION_POOL_CLOSED;\n/**\n * Emitted each time the connection pool is cleared and it's generation incremented\n * @event\n */\nConnectionPool.CONNECTION_POOL_CLEARED = constants_1.CONNECTION_POOL_CLEARED;\n/**\n * Emitted each time the connection pool is marked ready\n * @event\n */\nConnectionPool.CONNECTION_POOL_READY = constants_1.CONNECTION_POOL_READY;\n/**\n * Emitted when a connection is created.\n * @event\n */\nConnectionPool.CONNECTION_CREATED = constants_1.CONNECTION_CREATED;\n/**\n * Emitted when a connection becomes established, and is ready to use\n * @event\n */\nConnectionPool.CONNECTION_READY = constants_1.CONNECTION_READY;\n/**\n * Emitted when a connection is closed\n * @event\n */\nConnectionPool.CONNECTION_CLOSED = constants_1.CONNECTION_CLOSED;\n/**\n * Emitted when an attempt to check out a connection begins\n * @event\n */\nConnectionPool.CONNECTION_CHECK_OUT_STARTED = constants_1.CONNECTION_CHECK_OUT_STARTED;\n/**\n * Emitted when an attempt to check out a connection fails\n * @event\n */\nConnectionPool.CONNECTION_CHECK_OUT_FAILED = constants_1.CONNECTION_CHECK_OUT_FAILED;\n/**\n * Emitted each time a connection is successfully checked out of the connection pool\n * @event\n */\nConnectionPool.CONNECTION_CHECKED_OUT = constants_1.CONNECTION_CHECKED_OUT;\n/**\n * Emitted each time a connection is successfully checked into the connection pool\n * @event\n */\nConnectionPool.CONNECTION_CHECKED_IN = constants_1.CONNECTION_CHECKED_IN;\nexports.ConnectionPool = ConnectionPool;\n//# sourceMappingURL=connection_pool.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jbWFwL2Nvbm5lY3Rpb25fcG9vbC5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxzQkFBc0IsR0FBRyxpQkFBaUI7QUFDMUMsaUJBQWlCLG1CQUFPLENBQUMsc0JBQVE7QUFDakMsb0JBQW9CLG1CQUFPLENBQUMsMkVBQWM7QUFDMUMsZ0JBQWdCLG1CQUFPLENBQUMsbUVBQVU7QUFDbEMsc0JBQXNCLG1CQUFPLENBQUMsK0VBQWdCO0FBQzlDLGdCQUFnQixtQkFBTyxDQUFDLG1FQUFVO0FBQ2xDLGtCQUFrQixtQkFBTyxDQUFDLDJFQUFXO0FBQ3JDLHFCQUFxQixtQkFBTyxDQUFDLGlGQUFjO0FBQzNDLGlDQUFpQyxtQkFBTyxDQUFDLHlHQUEwQjtBQUNuRSxpQkFBaUIsbUJBQU8sQ0FBQyx5RUFBVTtBQUNuQyxrQkFBa0IsbUJBQU8sQ0FBQywyRUFBVztBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQztBQUNsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0I7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixZQUFZO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvSUFBb0ksV0FBVztBQUMvSTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0MsY0FBYztBQUNoRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLHdCQUF3QjtBQUNuRCxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBIQUEwSCxzQkFBc0I7QUFDaEo7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvREFBb0QsY0FBYztBQUNsRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVIQUF1SCx1QkFBdUI7QUFDOUk7QUFDQTtBQUNBO0FBQ0EsNkhBQTZILDZDQUE2QztBQUMxSztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUNBQXFDLGFBQWE7QUFDbEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLDZCQUE2QjtBQUM3QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0I7QUFDdEIiLCJzb3VyY2VzIjpbIkQ6XFxzYWxvbmlcXGFwcHJhaXNhbC1zeXN0ZW1cXHNlcnZlclxcbm9kZV9tb2R1bGVzXFxtb25nb2RiXFxsaWJcXGNtYXBcXGNvbm5lY3Rpb25fcG9vbC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuQ29ubmVjdGlvblBvb2wgPSBleHBvcnRzLlBvb2xTdGF0ZSA9IHZvaWQgMDtcbmNvbnN0IHRpbWVyc18xID0gcmVxdWlyZShcInRpbWVyc1wiKTtcbmNvbnN0IGNvbnN0YW50c18xID0gcmVxdWlyZShcIi4uL2NvbnN0YW50c1wiKTtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi4vZXJyb3JcIik7XG5jb25zdCBtb25nb190eXBlc18xID0gcmVxdWlyZShcIi4uL21vbmdvX3R5cGVzXCIpO1xuY29uc3QgdXRpbHNfMSA9IHJlcXVpcmUoXCIuLi91dGlsc1wiKTtcbmNvbnN0IGNvbm5lY3RfMSA9IHJlcXVpcmUoXCIuL2Nvbm5lY3RcIik7XG5jb25zdCBjb25uZWN0aW9uXzEgPSByZXF1aXJlKFwiLi9jb25uZWN0aW9uXCIpO1xuY29uc3QgY29ubmVjdGlvbl9wb29sX2V2ZW50c18xID0gcmVxdWlyZShcIi4vY29ubmVjdGlvbl9wb29sX2V2ZW50c1wiKTtcbmNvbnN0IGVycm9yc18xID0gcmVxdWlyZShcIi4vZXJyb3JzXCIpO1xuY29uc3QgbWV0cmljc18xID0gcmVxdWlyZShcIi4vbWV0cmljc1wiKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNvbnN0IGtTZXJ2ZXIgPSBTeW1ib2woJ3NlcnZlcicpO1xuLyoqIEBpbnRlcm5hbCAqL1xuY29uc3Qga0Nvbm5lY3Rpb25zID0gU3ltYm9sKCdjb25uZWN0aW9ucycpO1xuLyoqIEBpbnRlcm5hbCAqL1xuY29uc3Qga1BlbmRpbmcgPSBTeW1ib2woJ3BlbmRpbmcnKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNvbnN0IGtDaGVja2VkT3V0ID0gU3ltYm9sKCdjaGVja2VkT3V0Jyk7XG4vKiogQGludGVybmFsICovXG5jb25zdCBrTWluUG9vbFNpemVUaW1lciA9IFN5bWJvbCgnbWluUG9vbFNpemVUaW1lcicpO1xuLyoqIEBpbnRlcm5hbCAqL1xuY29uc3Qga0dlbmVyYXRpb24gPSBTeW1ib2woJ2dlbmVyYXRpb24nKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNvbnN0IGtTZXJ2aWNlR2VuZXJhdGlvbnMgPSBTeW1ib2woJ3NlcnZpY2VHZW5lcmF0aW9ucycpO1xuLyoqIEBpbnRlcm5hbCAqL1xuY29uc3Qga0Nvbm5lY3Rpb25Db3VudGVyID0gU3ltYm9sKCdjb25uZWN0aW9uQ291bnRlcicpO1xuLyoqIEBpbnRlcm5hbCAqL1xuY29uc3Qga0NhbmNlbGxhdGlvblRva2VuID0gU3ltYm9sKCdjYW5jZWxsYXRpb25Ub2tlbicpO1xuLyoqIEBpbnRlcm5hbCAqL1xuY29uc3Qga1dhaXRRdWV1ZSA9IFN5bWJvbCgnd2FpdFF1ZXVlJyk7XG4vKiogQGludGVybmFsICovXG5jb25zdCBrQ2FuY2VsbGVkID0gU3ltYm9sKCdjYW5jZWxsZWQnKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNvbnN0IGtNZXRyaWNzID0gU3ltYm9sKCdtZXRyaWNzJyk7XG4vKiogQGludGVybmFsICovXG5jb25zdCBrUHJvY2Vzc2luZ1dhaXRRdWV1ZSA9IFN5bWJvbCgncHJvY2Vzc2luZ1dhaXRRdWV1ZScpO1xuLyoqIEBpbnRlcm5hbCAqL1xuY29uc3Qga1Bvb2xTdGF0ZSA9IFN5bWJvbCgncG9vbFN0YXRlJyk7XG4vKiogQGludGVybmFsICovXG5leHBvcnRzLlBvb2xTdGF0ZSA9IE9iamVjdC5mcmVlemUoe1xuICAgIHBhdXNlZDogJ3BhdXNlZCcsXG4gICAgcmVhZHk6ICdyZWFkeScsXG4gICAgY2xvc2VkOiAnY2xvc2VkJ1xufSk7XG4vKipcbiAqIEEgcG9vbCBvZiBjb25uZWN0aW9ucyB3aGljaCBkeW5hbWljYWxseSByZXNpemVzLCBhbmQgZW1pdCBldmVudHMgcmVsYXRlZCB0byBwb29sIGFjdGl2aXR5XG4gKiBAaW50ZXJuYWxcbiAqL1xuY2xhc3MgQ29ubmVjdGlvblBvb2wgZXh0ZW5kcyBtb25nb190eXBlc18xLlR5cGVkRXZlbnRFbWl0dGVyIHtcbiAgICBjb25zdHJ1Y3RvcihzZXJ2ZXIsIG9wdGlvbnMpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gT2JqZWN0LmZyZWV6ZSh7XG4gICAgICAgICAgICAuLi5vcHRpb25zLFxuICAgICAgICAgICAgY29ubmVjdGlvblR5cGU6IGNvbm5lY3Rpb25fMS5Db25uZWN0aW9uLFxuICAgICAgICAgICAgbWF4UG9vbFNpemU6IG9wdGlvbnMubWF4UG9vbFNpemUgPz8gMTAwLFxuICAgICAgICAgICAgbWluUG9vbFNpemU6IG9wdGlvbnMubWluUG9vbFNpemUgPz8gMCxcbiAgICAgICAgICAgIG1heENvbm5lY3Rpbmc6IG9wdGlvbnMubWF4Q29ubmVjdGluZyA/PyAyLFxuICAgICAgICAgICAgbWF4SWRsZVRpbWVNUzogb3B0aW9ucy5tYXhJZGxlVGltZU1TID8/IDAsXG4gICAgICAgICAgICB3YWl0UXVldWVUaW1lb3V0TVM6IG9wdGlvbnMud2FpdFF1ZXVlVGltZW91dE1TID8/IDAsXG4gICAgICAgICAgICBtaW5Qb29sU2l6ZUNoZWNrRnJlcXVlbmN5TVM6IG9wdGlvbnMubWluUG9vbFNpemVDaGVja0ZyZXF1ZW5jeU1TID8/IDEwMCxcbiAgICAgICAgICAgIGF1dG9FbmNyeXB0ZXI6IG9wdGlvbnMuYXV0b0VuY3J5cHRlcixcbiAgICAgICAgICAgIG1ldGFkYXRhOiBvcHRpb25zLm1ldGFkYXRhXG4gICAgICAgIH0pO1xuICAgICAgICBpZiAodGhpcy5vcHRpb25zLm1pblBvb2xTaXplID4gdGhpcy5vcHRpb25zLm1heFBvb2xTaXplKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdDb25uZWN0aW9uIHBvb2wgbWluaW11bSBzaXplIG11c3Qgbm90IGJlIGdyZWF0ZXIgdGhhbiBtYXhpbXVtIHBvb2wgc2l6ZScpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXNba1Bvb2xTdGF0ZV0gPSBleHBvcnRzLlBvb2xTdGF0ZS5wYXVzZWQ7XG4gICAgICAgIHRoaXNba1NlcnZlcl0gPSBzZXJ2ZXI7XG4gICAgICAgIHRoaXNba0Nvbm5lY3Rpb25zXSA9IG5ldyB1dGlsc18xLkxpc3QoKTtcbiAgICAgICAgdGhpc1trUGVuZGluZ10gPSAwO1xuICAgICAgICB0aGlzW2tDaGVja2VkT3V0XSA9IG5ldyBTZXQoKTtcbiAgICAgICAgdGhpc1trTWluUG9vbFNpemVUaW1lcl0gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXNba0dlbmVyYXRpb25dID0gMDtcbiAgICAgICAgdGhpc1trU2VydmljZUdlbmVyYXRpb25zXSA9IG5ldyBNYXAoKTtcbiAgICAgICAgdGhpc1trQ29ubmVjdGlvbkNvdW50ZXJdID0gKDAsIHV0aWxzXzEubWFrZUNvdW50ZXIpKDEpO1xuICAgICAgICB0aGlzW2tDYW5jZWxsYXRpb25Ub2tlbl0gPSBuZXcgbW9uZ29fdHlwZXNfMS5DYW5jZWxsYXRpb25Ub2tlbigpO1xuICAgICAgICB0aGlzW2tDYW5jZWxsYXRpb25Ub2tlbl0uc2V0TWF4TGlzdGVuZXJzKEluZmluaXR5KTtcbiAgICAgICAgdGhpc1trV2FpdFF1ZXVlXSA9IG5ldyB1dGlsc18xLkxpc3QoKTtcbiAgICAgICAgdGhpc1trTWV0cmljc10gPSBuZXcgbWV0cmljc18xLkNvbm5lY3Rpb25Qb29sTWV0cmljcygpO1xuICAgICAgICB0aGlzW2tQcm9jZXNzaW5nV2FpdFF1ZXVlXSA9IGZhbHNlO1xuICAgICAgICB0aGlzLm1vbmdvTG9nZ2VyID0gdGhpc1trU2VydmVyXS50b3BvbG9neS5jbGllbnQubW9uZ29Mb2dnZXI7XG4gICAgICAgIHRoaXMuY29tcG9uZW50ID0gJ2Nvbm5lY3Rpb24nO1xuICAgICAgICBwcm9jZXNzLm5leHRUaWNrKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZW1pdEFuZExvZyhDb25uZWN0aW9uUG9vbC5DT05ORUNUSU9OX1BPT0xfQ1JFQVRFRCwgbmV3IGNvbm5lY3Rpb25fcG9vbF9ldmVudHNfMS5Db25uZWN0aW9uUG9vbENyZWF0ZWRFdmVudCh0aGlzKSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKiogVGhlIGFkZHJlc3Mgb2YgdGhlIGVuZHBvaW50IHRoZSBwb29sIGlzIGNvbm5lY3RlZCB0byAqL1xuICAgIGdldCBhZGRyZXNzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLmhvc3RBZGRyZXNzLnRvU3RyaW5nKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENoZWNrIGlmIHRoZSBwb29sIGhhcyBiZWVuIGNsb3NlZFxuICAgICAqXG4gICAgICogVE9ETyhOT0RFLTMyNjMpOiBXZSBjYW4gcmVtb3ZlIHRoaXMgcHJvcGVydHkgb25jZSBzaGVsbCBubyBsb25nZXIgbmVlZHMgaXRcbiAgICAgKi9cbiAgICBnZXQgY2xvc2VkKCkge1xuICAgICAgICByZXR1cm4gdGhpc1trUG9vbFN0YXRlXSA9PT0gZXhwb3J0cy5Qb29sU3RhdGUuY2xvc2VkO1xuICAgIH1cbiAgICAvKiogQW4gaW50ZWdlciByZXByZXNlbnRpbmcgdGhlIFNEQU0gZ2VuZXJhdGlvbiBvZiB0aGUgcG9vbCAqL1xuICAgIGdldCBnZW5lcmF0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpc1trR2VuZXJhdGlvbl07XG4gICAgfVxuICAgIC8qKiBBbiBpbnRlZ2VyIGV4cHJlc3NpbmcgaG93IG1hbnkgdG90YWwgY29ubmVjdGlvbnMgKGF2YWlsYWJsZSArIHBlbmRpbmcgKyBpbiB1c2UpIHRoZSBwb29sIGN1cnJlbnRseSBoYXMgKi9cbiAgICBnZXQgdG90YWxDb25uZWN0aW9uQ291bnQoKSB7XG4gICAgICAgIHJldHVybiAodGhpcy5hdmFpbGFibGVDb25uZWN0aW9uQ291bnQgKyB0aGlzLnBlbmRpbmdDb25uZWN0aW9uQ291bnQgKyB0aGlzLmN1cnJlbnRDaGVja2VkT3V0Q291bnQpO1xuICAgIH1cbiAgICAvKiogQW4gaW50ZWdlciBleHByZXNzaW5nIGhvdyBtYW55IGNvbm5lY3Rpb25zIGFyZSBjdXJyZW50bHkgYXZhaWxhYmxlIGluIHRoZSBwb29sLiAqL1xuICAgIGdldCBhdmFpbGFibGVDb25uZWN0aW9uQ291bnQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzW2tDb25uZWN0aW9uc10ubGVuZ3RoO1xuICAgIH1cbiAgICBnZXQgcGVuZGluZ0Nvbm5lY3Rpb25Db3VudCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXNba1BlbmRpbmddO1xuICAgIH1cbiAgICBnZXQgY3VycmVudENoZWNrZWRPdXRDb3VudCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXNba0NoZWNrZWRPdXRdLnNpemU7XG4gICAgfVxuICAgIGdldCB3YWl0UXVldWVTaXplKCkge1xuICAgICAgICByZXR1cm4gdGhpc1trV2FpdFF1ZXVlXS5sZW5ndGg7XG4gICAgfVxuICAgIGdldCBsb2FkQmFsYW5jZWQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm9wdGlvbnMubG9hZEJhbGFuY2VkO1xuICAgIH1cbiAgICBnZXQgc2VydmljZUdlbmVyYXRpb25zKCkge1xuICAgICAgICByZXR1cm4gdGhpc1trU2VydmljZUdlbmVyYXRpb25zXTtcbiAgICB9XG4gICAgZ2V0IHNlcnZlckVycm9yKCkge1xuICAgICAgICByZXR1cm4gdGhpc1trU2VydmVyXS5kZXNjcmlwdGlvbi5lcnJvcjtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVGhpcyBpcyBleHBvc2VkIE9OTFkgZm9yIHVzZSBpbiBtb25nb3NoLCB0byBlbmFibGVcbiAgICAgKiBraWxsaW5nIGFsbCBjb25uZWN0aW9ucyBpZiBhIHVzZXIgcXVpdHMgdGhlIHNoZWxsIHdpdGhcbiAgICAgKiBvcGVyYXRpb25zIGluIHByb2dyZXNzLlxuICAgICAqXG4gICAgICogVGhpcyBwcm9wZXJ0eSBtYXkgYmUgcmVtb3ZlZCBhcyBhIHBhcnQgb2YgTk9ERS0zMjYzLlxuICAgICAqL1xuICAgIGdldCBjaGVja2VkT3V0Q29ubmVjdGlvbnMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzW2tDaGVja2VkT3V0XTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogR2V0IHRoZSBtZXRyaWNzIGluZm9ybWF0aW9uIGZvciB0aGUgcG9vbCB3aGVuIGEgd2FpdCBxdWV1ZSB0aW1lb3V0IG9jY3Vycy5cbiAgICAgKi9cbiAgICB3YWl0UXVldWVFcnJvck1ldHJpY3MoKSB7XG4gICAgICAgIHJldHVybiB0aGlzW2tNZXRyaWNzXS5pbmZvKHRoaXMub3B0aW9ucy5tYXhQb29sU2l6ZSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNldCB0aGUgcG9vbCBzdGF0ZSB0byBcInJlYWR5XCJcbiAgICAgKi9cbiAgICByZWFkeSgpIHtcbiAgICAgICAgaWYgKHRoaXNba1Bvb2xTdGF0ZV0gIT09IGV4cG9ydHMuUG9vbFN0YXRlLnBhdXNlZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXNba1Bvb2xTdGF0ZV0gPSBleHBvcnRzLlBvb2xTdGF0ZS5yZWFkeTtcbiAgICAgICAgdGhpcy5lbWl0QW5kTG9nKENvbm5lY3Rpb25Qb29sLkNPTk5FQ1RJT05fUE9PTF9SRUFEWSwgbmV3IGNvbm5lY3Rpb25fcG9vbF9ldmVudHNfMS5Db25uZWN0aW9uUG9vbFJlYWR5RXZlbnQodGhpcykpO1xuICAgICAgICAoMCwgdGltZXJzXzEuY2xlYXJUaW1lb3V0KSh0aGlzW2tNaW5Qb29sU2l6ZVRpbWVyXSk7XG4gICAgICAgIHRoaXMuZW5zdXJlTWluUG9vbFNpemUoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2hlY2sgYSBjb25uZWN0aW9uIG91dCBvZiB0aGlzIHBvb2wuIFRoZSBjb25uZWN0aW9uIHdpbGwgY29udGludWUgdG8gYmUgdHJhY2tlZCwgYnV0IG5vIHJlZmVyZW5jZSB0byBpdFxuICAgICAqIHdpbGwgYmUgaGVsZCBieSB0aGUgcG9vbC4gVGhpcyBtZWFucyB0aGF0IGlmIGEgY29ubmVjdGlvbiBpcyBjaGVja2VkIG91dCBpdCBNVVNUIGJlIGNoZWNrZWQgYmFjayBpbiBvclxuICAgICAqIGV4cGxpY2l0bHkgZGVzdHJveWVkIGJ5IHRoZSBuZXcgb3duZXIuXG4gICAgICovXG4gICAgY2hlY2tPdXQoY2FsbGJhY2spIHtcbiAgICAgICAgdGhpcy5lbWl0QW5kTG9nKENvbm5lY3Rpb25Qb29sLkNPTk5FQ1RJT05fQ0hFQ0tfT1VUX1NUQVJURUQsIG5ldyBjb25uZWN0aW9uX3Bvb2xfZXZlbnRzXzEuQ29ubmVjdGlvbkNoZWNrT3V0U3RhcnRlZEV2ZW50KHRoaXMpKTtcbiAgICAgICAgY29uc3Qgd2FpdFF1ZXVlTWVtYmVyID0geyBjYWxsYmFjayB9O1xuICAgICAgICBjb25zdCB3YWl0UXVldWVUaW1lb3V0TVMgPSB0aGlzLm9wdGlvbnMud2FpdFF1ZXVlVGltZW91dE1TO1xuICAgICAgICBpZiAod2FpdFF1ZXVlVGltZW91dE1TKSB7XG4gICAgICAgICAgICB3YWl0UXVldWVNZW1iZXIudGltZXIgPSAoMCwgdGltZXJzXzEuc2V0VGltZW91dCkoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHdhaXRRdWV1ZU1lbWJlcltrQ2FuY2VsbGVkXSA9IHRydWU7XG4gICAgICAgICAgICAgICAgd2FpdFF1ZXVlTWVtYmVyLnRpbWVyID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgIHRoaXMuZW1pdEFuZExvZyhDb25uZWN0aW9uUG9vbC5DT05ORUNUSU9OX0NIRUNLX09VVF9GQUlMRUQsIG5ldyBjb25uZWN0aW9uX3Bvb2xfZXZlbnRzXzEuQ29ubmVjdGlvbkNoZWNrT3V0RmFpbGVkRXZlbnQodGhpcywgJ3RpbWVvdXQnKSk7XG4gICAgICAgICAgICAgICAgd2FpdFF1ZXVlTWVtYmVyLmNhbGxiYWNrKG5ldyBlcnJvcnNfMS5XYWl0UXVldWVUaW1lb3V0RXJyb3IodGhpcy5sb2FkQmFsYW5jZWRcbiAgICAgICAgICAgICAgICAgICAgPyB0aGlzLndhaXRRdWV1ZUVycm9yTWV0cmljcygpXG4gICAgICAgICAgICAgICAgICAgIDogJ1RpbWVkIG91dCB3aGlsZSBjaGVja2luZyBvdXQgYSBjb25uZWN0aW9uIGZyb20gY29ubmVjdGlvbiBwb29sJywgdGhpcy5hZGRyZXNzKSk7XG4gICAgICAgICAgICB9LCB3YWl0UXVldWVUaW1lb3V0TVMpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXNba1dhaXRRdWV1ZV0ucHVzaCh3YWl0UXVldWVNZW1iZXIpO1xuICAgICAgICBwcm9jZXNzLm5leHRUaWNrKCgpID0+IHRoaXMucHJvY2Vzc1dhaXRRdWV1ZSgpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2hlY2sgYSBjb25uZWN0aW9uIGludG8gdGhlIHBvb2wuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gY29ubmVjdGlvbiAtIFRoZSBjb25uZWN0aW9uIHRvIGNoZWNrIGluXG4gICAgICovXG4gICAgY2hlY2tJbihjb25uZWN0aW9uKSB7XG4gICAgICAgIGlmICghdGhpc1trQ2hlY2tlZE91dF0uaGFzKGNvbm5lY3Rpb24pKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcG9vbENsb3NlZCA9IHRoaXMuY2xvc2VkO1xuICAgICAgICBjb25zdCBzdGFsZSA9IHRoaXMuY29ubmVjdGlvbklzU3RhbGUoY29ubmVjdGlvbik7XG4gICAgICAgIGNvbnN0IHdpbGxEZXN0cm95ID0gISEocG9vbENsb3NlZCB8fCBzdGFsZSB8fCBjb25uZWN0aW9uLmNsb3NlZCk7XG4gICAgICAgIGlmICghd2lsbERlc3Ryb3kpIHtcbiAgICAgICAgICAgIGNvbm5lY3Rpb24ubWFya0F2YWlsYWJsZSgpO1xuICAgICAgICAgICAgdGhpc1trQ29ubmVjdGlvbnNdLnVuc2hpZnQoY29ubmVjdGlvbik7XG4gICAgICAgIH1cbiAgICAgICAgdGhpc1trQ2hlY2tlZE91dF0uZGVsZXRlKGNvbm5lY3Rpb24pO1xuICAgICAgICB0aGlzLmVtaXRBbmRMb2coQ29ubmVjdGlvblBvb2wuQ09OTkVDVElPTl9DSEVDS0VEX0lOLCBuZXcgY29ubmVjdGlvbl9wb29sX2V2ZW50c18xLkNvbm5lY3Rpb25DaGVja2VkSW5FdmVudCh0aGlzLCBjb25uZWN0aW9uKSk7XG4gICAgICAgIGlmICh3aWxsRGVzdHJveSkge1xuICAgICAgICAgICAgY29uc3QgcmVhc29uID0gY29ubmVjdGlvbi5jbG9zZWQgPyAnZXJyb3InIDogcG9vbENsb3NlZCA/ICdwb29sQ2xvc2VkJyA6ICdzdGFsZSc7XG4gICAgICAgICAgICB0aGlzLmRlc3Ryb3lDb25uZWN0aW9uKGNvbm5lY3Rpb24sIHJlYXNvbik7XG4gICAgICAgIH1cbiAgICAgICAgcHJvY2Vzcy5uZXh0VGljaygoKSA9PiB0aGlzLnByb2Nlc3NXYWl0UXVldWUoKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENsZWFyIHRoZSBwb29sXG4gICAgICpcbiAgICAgKiBQb29sIHJlc2V0IGlzIGhhbmRsZWQgYnkgaW5jcmVtZW50aW5nIHRoZSBwb29sJ3MgZ2VuZXJhdGlvbiBjb3VudC4gQW55IGV4aXN0aW5nIGNvbm5lY3Rpb24gb2YgYVxuICAgICAqIHByZXZpb3VzIGdlbmVyYXRpb24gd2lsbCBldmVudHVhbGx5IGJlIHBydW5lZCBkdXJpbmcgc3Vic2VxdWVudCBjaGVja291dHMuXG4gICAgICovXG4gICAgY2xlYXIob3B0aW9ucyA9IHt9KSB7XG4gICAgICAgIGlmICh0aGlzLmNsb3NlZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIGhhbmRsZSBsb2FkIGJhbGFuY2VkIGNhc2VcbiAgICAgICAgaWYgKHRoaXMubG9hZEJhbGFuY2VkKSB7XG4gICAgICAgICAgICBjb25zdCB7IHNlcnZpY2VJZCB9ID0gb3B0aW9ucztcbiAgICAgICAgICAgIGlmICghc2VydmljZUlkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29SdW50aW1lRXJyb3IoJ0Nvbm5lY3Rpb25Qb29sLmNsZWFyKCkgY2FsbGVkIGluIGxvYWQgYmFsYW5jZWQgbW9kZSB3aXRoIG5vIHNlcnZpY2VJZC4nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHNpZCA9IHNlcnZpY2VJZC50b0hleFN0cmluZygpO1xuICAgICAgICAgICAgY29uc3QgZ2VuZXJhdGlvbiA9IHRoaXMuc2VydmljZUdlbmVyYXRpb25zLmdldChzaWQpO1xuICAgICAgICAgICAgLy8gT25seSBuZWVkIHRvIHdvcnJ5IGlmIHRoZSBnZW5lcmF0aW9uIGV4aXN0cywgc2luY2UgaXQgc2hvdWxkXG4gICAgICAgICAgICAvLyBhbHdheXMgYmUgdGhlcmUgYnV0IHR5cGVzY3JpcHQgbmVlZHMgdGhlIGNoZWNrLlxuICAgICAgICAgICAgaWYgKGdlbmVyYXRpb24gPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUnVudGltZUVycm9yKCdTZXJ2aWNlIGdlbmVyYXRpb25zIGFyZSByZXF1aXJlZCBpbiBsb2FkIGJhbGFuY2VyIG1vZGUuJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBJbmNyZW1lbnQgdGhlIGdlbmVyYXRpb24gZm9yIHRoZSBzZXJ2aWNlIGlkLlxuICAgICAgICAgICAgICAgIHRoaXMuc2VydmljZUdlbmVyYXRpb25zLnNldChzaWQsIGdlbmVyYXRpb24gKyAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuZW1pdEFuZExvZyhDb25uZWN0aW9uUG9vbC5DT05ORUNUSU9OX1BPT0xfQ0xFQVJFRCwgbmV3IGNvbm5lY3Rpb25fcG9vbF9ldmVudHNfMS5Db25uZWN0aW9uUG9vbENsZWFyZWRFdmVudCh0aGlzLCB7IHNlcnZpY2VJZCB9KSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy8gaGFuZGxlIG5vbiBsb2FkLWJhbGFuY2VkIGNhc2VcbiAgICAgICAgY29uc3QgaW50ZXJydXB0SW5Vc2VDb25uZWN0aW9ucyA9IG9wdGlvbnMuaW50ZXJydXB0SW5Vc2VDb25uZWN0aW9ucyA/PyBmYWxzZTtcbiAgICAgICAgY29uc3Qgb2xkR2VuZXJhdGlvbiA9IHRoaXNba0dlbmVyYXRpb25dO1xuICAgICAgICB0aGlzW2tHZW5lcmF0aW9uXSArPSAxO1xuICAgICAgICBjb25zdCBhbHJlYWR5UGF1c2VkID0gdGhpc1trUG9vbFN0YXRlXSA9PT0gZXhwb3J0cy5Qb29sU3RhdGUucGF1c2VkO1xuICAgICAgICB0aGlzW2tQb29sU3RhdGVdID0gZXhwb3J0cy5Qb29sU3RhdGUucGF1c2VkO1xuICAgICAgICB0aGlzLmNsZWFyTWluUG9vbFNpemVUaW1lcigpO1xuICAgICAgICBpZiAoIWFscmVhZHlQYXVzZWQpIHtcbiAgICAgICAgICAgIHRoaXMuZW1pdEFuZExvZyhDb25uZWN0aW9uUG9vbC5DT05ORUNUSU9OX1BPT0xfQ0xFQVJFRCwgbmV3IGNvbm5lY3Rpb25fcG9vbF9ldmVudHNfMS5Db25uZWN0aW9uUG9vbENsZWFyZWRFdmVudCh0aGlzLCB7XG4gICAgICAgICAgICAgICAgaW50ZXJydXB0SW5Vc2VDb25uZWN0aW9uc1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpbnRlcnJ1cHRJblVzZUNvbm5lY3Rpb25zKSB7XG4gICAgICAgICAgICBwcm9jZXNzLm5leHRUaWNrKCgpID0+IHRoaXMuaW50ZXJydXB0SW5Vc2VDb25uZWN0aW9ucyhvbGRHZW5lcmF0aW9uKSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5wcm9jZXNzV2FpdFF1ZXVlKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENsb3NlcyBhbGwgc3RhbGUgaW4tdXNlIGNvbm5lY3Rpb25zIGluIHRoZSBwb29sIHdpdGggYSByZXN1bWFibGUgUG9vbENsZWFyZWRPbk5ldHdvcmtFcnJvci5cbiAgICAgKlxuICAgICAqIE9ubHkgY29ubmVjdGlvbnMgd2hlcmUgYGNvbm5lY3Rpb24uZ2VuZXJhdGlvbiA8PSBtaW5HZW5lcmF0aW9uYCBhcmUga2lsbGVkLlxuICAgICAqL1xuICAgIGludGVycnVwdEluVXNlQ29ubmVjdGlvbnMobWluR2VuZXJhdGlvbikge1xuICAgICAgICBmb3IgKGNvbnN0IGNvbm5lY3Rpb24gb2YgdGhpc1trQ2hlY2tlZE91dF0pIHtcbiAgICAgICAgICAgIGlmIChjb25uZWN0aW9uLmdlbmVyYXRpb24gPD0gbWluR2VuZXJhdGlvbikge1xuICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tJbihjb25uZWN0aW9uKTtcbiAgICAgICAgICAgICAgICBjb25uZWN0aW9uLm9uRXJyb3IobmV3IGVycm9yc18xLlBvb2xDbGVhcmVkT25OZXR3b3JrRXJyb3IodGhpcykpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGNsb3NlKF9vcHRpb25zLCBfY2IpIHtcbiAgICAgICAgbGV0IG9wdGlvbnMgPSBfb3B0aW9ucztcbiAgICAgICAgY29uc3QgY2FsbGJhY2sgPSAoX2NiID8/IF9vcHRpb25zKTtcbiAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICBvcHRpb25zID0ge307XG4gICAgICAgIH1cbiAgICAgICAgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBmb3JjZTogZmFsc2UgfSwgb3B0aW9ucyk7XG4gICAgICAgIGlmICh0aGlzLmNsb3NlZCkge1xuICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gaW1tZWRpYXRlbHkgY2FuY2VsIGFueSBpbi1mbGlnaHQgY29ubmVjdGlvbnNcbiAgICAgICAgdGhpc1trQ2FuY2VsbGF0aW9uVG9rZW5dLmVtaXQoJ2NhbmNlbCcpO1xuICAgICAgICAvLyBlbmQgdGhlIGNvbm5lY3Rpb24gY291bnRlclxuICAgICAgICBpZiAodHlwZW9mIHRoaXNba0Nvbm5lY3Rpb25Db3VudGVyXS5yZXR1cm4gPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIHRoaXNba0Nvbm5lY3Rpb25Db3VudGVyXS5yZXR1cm4odW5kZWZpbmVkKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzW2tQb29sU3RhdGVdID0gZXhwb3J0cy5Qb29sU3RhdGUuY2xvc2VkO1xuICAgICAgICB0aGlzLmNsZWFyTWluUG9vbFNpemVUaW1lcigpO1xuICAgICAgICB0aGlzLnByb2Nlc3NXYWl0UXVldWUoKTtcbiAgICAgICAgKDAsIHV0aWxzXzEuZWFjaEFzeW5jKSh0aGlzW2tDb25uZWN0aW9uc10udG9BcnJheSgpLCAoY29ubiwgY2IpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZW1pdEFuZExvZyhDb25uZWN0aW9uUG9vbC5DT05ORUNUSU9OX0NMT1NFRCwgbmV3IGNvbm5lY3Rpb25fcG9vbF9ldmVudHNfMS5Db25uZWN0aW9uQ2xvc2VkRXZlbnQodGhpcywgY29ubiwgJ3Bvb2xDbG9zZWQnKSk7XG4gICAgICAgICAgICBjb25uLmRlc3Ryb3koeyBmb3JjZTogISFvcHRpb25zLmZvcmNlIH0sIGNiKTtcbiAgICAgICAgfSwgZXJyID0+IHtcbiAgICAgICAgICAgIHRoaXNba0Nvbm5lY3Rpb25zXS5jbGVhcigpO1xuICAgICAgICAgICAgdGhpcy5lbWl0QW5kTG9nKENvbm5lY3Rpb25Qb29sLkNPTk5FQ1RJT05fUE9PTF9DTE9TRUQsIG5ldyBjb25uZWN0aW9uX3Bvb2xfZXZlbnRzXzEuQ29ubmVjdGlvblBvb2xDbG9zZWRFdmVudCh0aGlzKSk7XG4gICAgICAgICAgICBjYWxsYmFjayhlcnIpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUnVucyBhIGxhbWJkYSB3aXRoIGFuIGltcGxpY2l0bHkgY2hlY2tlZCBvdXQgY29ubmVjdGlvbiwgY2hlY2tpbmcgdGhhdCBjb25uZWN0aW9uIGJhY2sgaW4gd2hlbiB0aGUgbGFtYmRhXG4gICAgICogaGFzIGNvbXBsZXRlZCBieSBjYWxsaW5nIGJhY2suXG4gICAgICpcbiAgICAgKiBOT1RFOiBwbGVhc2Ugbm90ZSB0aGUgcmVxdWlyZWQgc2lnbmF0dXJlIG9mIGBmbmBcbiAgICAgKlxuICAgICAqIEByZW1hcmtzIFdoZW4gaW4gbG9hZCBiYWxhbmNlciBtb2RlLCBjb25uZWN0aW9ucyBjYW4gYmUgcGlubmVkIHRvIGN1cnNvcnMgb3IgdHJhbnNhY3Rpb25zLlxuICAgICAqICAgSW4gdGhlc2UgY2FzZXMgd2UgcGFzcyB0aGUgY29ubmVjdGlvbiBpbiB0byB0aGlzIG1ldGhvZCB0byBlbnN1cmUgaXQgaXMgdXNlZCBhbmQgYSBuZXdcbiAgICAgKiAgIGNvbm5lY3Rpb24gaXMgbm90IGNoZWNrZWQgb3V0LlxuICAgICAqXG4gICAgICogQHBhcmFtIGNvbm4gLSBBIHBpbm5lZCBjb25uZWN0aW9uIGZvciB1c2UgaW4gbG9hZCBiYWxhbmNpbmcgbW9kZS5cbiAgICAgKiBAcGFyYW0gZm4gLSBBIGZ1bmN0aW9uIHdoaWNoIG9wZXJhdGVzIG9uIGEgbWFuYWdlZCBjb25uZWN0aW9uXG4gICAgICogQHBhcmFtIGNhbGxiYWNrIC0gVGhlIG9yaWdpbmFsIGNhbGxiYWNrXG4gICAgICovXG4gICAgd2l0aENvbm5lY3Rpb24oY29ubiwgZm4sIGNhbGxiYWNrKSB7XG4gICAgICAgIGlmIChjb25uKSB7XG4gICAgICAgICAgICAvLyB1c2UgdGhlIHByb3ZpZGVkIGNvbm5lY3Rpb24sIGFuZCBkbyBfbm90XyBjaGVjayBpdCBpbiBhZnRlciBleGVjdXRpb25cbiAgICAgICAgICAgIGZuKHVuZGVmaW5lZCwgY29ubiwgKGZuRXJyLCByZXN1bHQpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZm5FcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMud2l0aFJlYXV0aGVudGljYXRpb24oZm5FcnIsIGNvbm4sIGZuLCBjYWxsYmFjayk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwgcmVzdWx0KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY2hlY2tPdXQoKGVyciwgY29ubikgPT4ge1xuICAgICAgICAgICAgLy8gZG9uJ3QgY2FsbGJhY2sgd2l0aCBgZXJyYCBoZXJlLCB3ZSBtaWdodCB3YW50IHRvIGFjdCB1cG9uIGl0IGluc2lkZSBgZm5gXG4gICAgICAgICAgICBmbihlcnIsIGNvbm4sIChmbkVyciwgcmVzdWx0KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGZuRXJyKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjb25uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLndpdGhSZWF1dGhlbnRpY2F0aW9uKGZuRXJyLCBjb25uLCBmbiwgY2FsbGJhY2spO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZm5FcnIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayh1bmRlZmluZWQsIHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChjb25uKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tJbihjb25uKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHdpdGhSZWF1dGhlbnRpY2F0aW9uKGZuRXJyLCBjb25uLCBmbiwgY2FsbGJhY2spIHtcbiAgICAgICAgaWYgKGZuRXJyIGluc3RhbmNlb2YgZXJyb3JfMS5Nb25nb0Vycm9yICYmIGZuRXJyLmNvZGUgPT09IGVycm9yXzEuTU9OR09EQl9FUlJPUl9DT0RFUy5SZWF1dGhlbnRpY2F0ZSkge1xuICAgICAgICAgICAgdGhpcy5yZWF1dGhlbnRpY2F0ZShjb25uLCBmbiwgKGVycm9yLCByZXMpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycm9yKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2FsbGJhY2sodW5kZWZpbmVkLCByZXMpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjYWxsYmFjayhmbkVycik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVhdXRoZW50aWNhdGUgb24gdGhlIHNhbWUgY29ubmVjdGlvbiBhbmQgdGhlbiByZXRyeSB0aGUgb3BlcmF0aW9uLlxuICAgICAqL1xuICAgIHJlYXV0aGVudGljYXRlKGNvbm5lY3Rpb24sIGZuLCBjYWxsYmFjaykge1xuICAgICAgICBjb25zdCBhdXRoQ29udGV4dCA9IGNvbm5lY3Rpb24uYXV0aENvbnRleHQ7XG4gICAgICAgIGlmICghYXV0aENvbnRleHQpIHtcbiAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhuZXcgZXJyb3JfMS5Nb25nb1J1bnRpbWVFcnJvcignTm8gYXV0aCBjb250ZXh0IGZvdW5kIG9uIGNvbm5lY3Rpb24uJykpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNyZWRlbnRpYWxzID0gYXV0aENvbnRleHQuY3JlZGVudGlhbHM7XG4gICAgICAgIGlmICghY3JlZGVudGlhbHMpIHtcbiAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhuZXcgZXJyb3JfMS5Nb25nb01pc3NpbmdDcmVkZW50aWFsc0Vycm9yKCdDb25uZWN0aW9uIGlzIG1pc3NpbmcgY3JlZGVudGlhbHMgd2hlbiBhc2tlZCB0byByZWF1dGhlbnRpY2F0ZScpKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCByZXNvbHZlZENyZWRlbnRpYWxzID0gY3JlZGVudGlhbHMucmVzb2x2ZUF1dGhNZWNoYW5pc20oY29ubmVjdGlvbi5oZWxsbyB8fCB1bmRlZmluZWQpO1xuICAgICAgICBjb25zdCBwcm92aWRlciA9IGNvbm5lY3RfMS5BVVRIX1BST1ZJREVSUy5nZXQocmVzb2x2ZWRDcmVkZW50aWFscy5tZWNoYW5pc20pO1xuICAgICAgICBpZiAoIXByb3ZpZGVyKSB7XG4gICAgICAgICAgICByZXR1cm4gY2FsbGJhY2sobmV3IGVycm9yXzEuTW9uZ29NaXNzaW5nQ3JlZGVudGlhbHNFcnJvcihgUmVhdXRoZW50aWNhdGUgZmFpbGVkIGR1ZSB0byBubyBhdXRoIHByb3ZpZGVyIGZvciAke2NyZWRlbnRpYWxzLm1lY2hhbmlzbX1gKSk7XG4gICAgICAgIH1cbiAgICAgICAgcHJvdmlkZXIucmVhdXRoKGF1dGhDb250ZXh0KS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgIGZuKHVuZGVmaW5lZCwgY29ubmVjdGlvbiwgKGZuRXJyLCBmblJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChmbkVycikge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2soZm5FcnIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYWxsYmFjayh1bmRlZmluZWQsIGZuUmVzdWx0KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LCBlcnJvciA9PiBjYWxsYmFjayhlcnJvcikpO1xuICAgIH1cbiAgICAvKiogQ2xlYXIgdGhlIG1pbiBwb29sIHNpemUgdGltZXIgKi9cbiAgICBjbGVhck1pblBvb2xTaXplVGltZXIoKSB7XG4gICAgICAgIGNvbnN0IG1pblBvb2xTaXplVGltZXIgPSB0aGlzW2tNaW5Qb29sU2l6ZVRpbWVyXTtcbiAgICAgICAgaWYgKG1pblBvb2xTaXplVGltZXIpIHtcbiAgICAgICAgICAgICgwLCB0aW1lcnNfMS5jbGVhclRpbWVvdXQpKG1pblBvb2xTaXplVGltZXIpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGRlc3Ryb3lDb25uZWN0aW9uKGNvbm5lY3Rpb24sIHJlYXNvbikge1xuICAgICAgICB0aGlzLmVtaXRBbmRMb2coQ29ubmVjdGlvblBvb2wuQ09OTkVDVElPTl9DTE9TRUQsIG5ldyBjb25uZWN0aW9uX3Bvb2xfZXZlbnRzXzEuQ29ubmVjdGlvbkNsb3NlZEV2ZW50KHRoaXMsIGNvbm5lY3Rpb24sIHJlYXNvbikpO1xuICAgICAgICAvLyBkZXN0cm95IHRoZSBjb25uZWN0aW9uXG4gICAgICAgIHByb2Nlc3MubmV4dFRpY2soKCkgPT4gY29ubmVjdGlvbi5kZXN0cm95KHsgZm9yY2U6IGZhbHNlIH0pKTtcbiAgICB9XG4gICAgY29ubmVjdGlvbklzU3RhbGUoY29ubmVjdGlvbikge1xuICAgICAgICBjb25zdCBzZXJ2aWNlSWQgPSBjb25uZWN0aW9uLnNlcnZpY2VJZDtcbiAgICAgICAgaWYgKHRoaXMubG9hZEJhbGFuY2VkICYmIHNlcnZpY2VJZCkge1xuICAgICAgICAgICAgY29uc3Qgc2lkID0gc2VydmljZUlkLnRvSGV4U3RyaW5nKCk7XG4gICAgICAgICAgICBjb25zdCBnZW5lcmF0aW9uID0gdGhpcy5zZXJ2aWNlR2VuZXJhdGlvbnMuZ2V0KHNpZCk7XG4gICAgICAgICAgICByZXR1cm4gY29ubmVjdGlvbi5nZW5lcmF0aW9uICE9PSBnZW5lcmF0aW9uO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjb25uZWN0aW9uLmdlbmVyYXRpb24gIT09IHRoaXNba0dlbmVyYXRpb25dO1xuICAgIH1cbiAgICBjb25uZWN0aW9uSXNJZGxlKGNvbm5lY3Rpb24pIHtcbiAgICAgICAgcmV0dXJuICEhKHRoaXMub3B0aW9ucy5tYXhJZGxlVGltZU1TICYmIGNvbm5lY3Rpb24uaWRsZVRpbWUgPiB0aGlzLm9wdGlvbnMubWF4SWRsZVRpbWVNUyk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIERlc3Ryb3lzIGEgY29ubmVjdGlvbiBpZiB0aGUgY29ubmVjdGlvbiBpcyBwZXJpc2hlZC5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIGB0cnVlYCBpZiB0aGUgY29ubmVjdGlvbiB3YXMgZGVzdHJveWVkLCBgZmFsc2VgIG90aGVyd2lzZS5cbiAgICAgKi9cbiAgICBkZXN0cm95Q29ubmVjdGlvbklmUGVyaXNoZWQoY29ubmVjdGlvbikge1xuICAgICAgICBjb25zdCBpc1N0YWxlID0gdGhpcy5jb25uZWN0aW9uSXNTdGFsZShjb25uZWN0aW9uKTtcbiAgICAgICAgY29uc3QgaXNJZGxlID0gdGhpcy5jb25uZWN0aW9uSXNJZGxlKGNvbm5lY3Rpb24pO1xuICAgICAgICBpZiAoIWlzU3RhbGUgJiYgIWlzSWRsZSAmJiAhY29ubmVjdGlvbi5jbG9zZWQpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCByZWFzb24gPSBjb25uZWN0aW9uLmNsb3NlZCA/ICdlcnJvcicgOiBpc1N0YWxlID8gJ3N0YWxlJyA6ICdpZGxlJztcbiAgICAgICAgdGhpcy5kZXN0cm95Q29ubmVjdGlvbihjb25uZWN0aW9uLCByZWFzb24pO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgY3JlYXRlQ29ubmVjdGlvbihjYWxsYmFjaykge1xuICAgICAgICBjb25zdCBjb25uZWN0T3B0aW9ucyA9IHtcbiAgICAgICAgICAgIC4uLnRoaXMub3B0aW9ucyxcbiAgICAgICAgICAgIGlkOiB0aGlzW2tDb25uZWN0aW9uQ291bnRlcl0ubmV4dCgpLnZhbHVlLFxuICAgICAgICAgICAgZ2VuZXJhdGlvbjogdGhpc1trR2VuZXJhdGlvbl0sXG4gICAgICAgICAgICBjYW5jZWxsYXRpb25Ub2tlbjogdGhpc1trQ2FuY2VsbGF0aW9uVG9rZW5dXG4gICAgICAgIH07XG4gICAgICAgIHRoaXNba1BlbmRpbmddKys7XG4gICAgICAgIC8vIFRoaXMgaXMgb3VyIHZlcnNpb24gb2YgYSBcInZpcnR1YWxcIiBuby1JL08gY29ubmVjdGlvbiBhcyB0aGUgc3BlYyByZXF1aXJlc1xuICAgICAgICB0aGlzLmVtaXRBbmRMb2coQ29ubmVjdGlvblBvb2wuQ09OTkVDVElPTl9DUkVBVEVELCBuZXcgY29ubmVjdGlvbl9wb29sX2V2ZW50c18xLkNvbm5lY3Rpb25DcmVhdGVkRXZlbnQodGhpcywgeyBpZDogY29ubmVjdE9wdGlvbnMuaWQgfSkpO1xuICAgICAgICAoMCwgY29ubmVjdF8xLmNvbm5lY3QpKGNvbm5lY3RPcHRpb25zLCAoZXJyLCBjb25uZWN0aW9uKSA9PiB7XG4gICAgICAgICAgICBpZiAoZXJyIHx8ICFjb25uZWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgdGhpc1trUGVuZGluZ10tLTtcbiAgICAgICAgICAgICAgICB0aGlzLmVtaXRBbmRMb2coQ29ubmVjdGlvblBvb2wuQ09OTkVDVElPTl9DTE9TRUQsIG5ldyBjb25uZWN0aW9uX3Bvb2xfZXZlbnRzXzEuQ29ubmVjdGlvbkNsb3NlZEV2ZW50KHRoaXMsIHsgaWQ6IGNvbm5lY3RPcHRpb25zLmlkLCBzZXJ2aWNlSWQ6IHVuZGVmaW5lZCB9LCAnZXJyb3InLCBcbiAgICAgICAgICAgICAgICAvLyBUT0RPKE5PREUtNTE5Mik6IFJlbW92ZSB0aGlzIGNhc3RcbiAgICAgICAgICAgICAgICBlcnIpKTtcbiAgICAgICAgICAgICAgICBpZiAoZXJyIGluc3RhbmNlb2YgZXJyb3JfMS5Nb25nb05ldHdvcmtFcnJvciB8fCBlcnIgaW5zdGFuY2VvZiBlcnJvcl8xLk1vbmdvU2VydmVyRXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZXJyLmNvbm5lY3Rpb25HZW5lcmF0aW9uID0gY29ubmVjdE9wdGlvbnMuZ2VuZXJhdGlvbjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyID8/IG5ldyBlcnJvcl8xLk1vbmdvUnVudGltZUVycm9yKCdDb25uZWN0aW9uIGNyZWF0aW9uIGZhaWxlZCB3aXRob3V0IGVycm9yJykpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIFRoZSBwb29sIG1pZ2h0IGhhdmUgY2xvc2VkIHNpbmNlIHdlIHN0YXJ0ZWQgdHJ5aW5nIHRvIGNyZWF0ZSBhIGNvbm5lY3Rpb25cbiAgICAgICAgICAgIGlmICh0aGlzW2tQb29sU3RhdGVdICE9PSBleHBvcnRzLlBvb2xTdGF0ZS5yZWFkeSkge1xuICAgICAgICAgICAgICAgIHRoaXNba1BlbmRpbmddLS07XG4gICAgICAgICAgICAgICAgY29ubmVjdGlvbi5kZXN0cm95KHsgZm9yY2U6IHRydWUgfSk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2sodGhpcy5jbG9zZWQgPyBuZXcgZXJyb3JzXzEuUG9vbENsb3NlZEVycm9yKHRoaXMpIDogbmV3IGVycm9yc18xLlBvb2xDbGVhcmVkRXJyb3IodGhpcykpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGZvcndhcmQgYWxsIGV2ZW50cyBmcm9tIHRoZSBjb25uZWN0aW9uIHRvIHRoZSBwb29sXG4gICAgICAgICAgICBmb3IgKGNvbnN0IGV2ZW50IG9mIFsuLi5jb25zdGFudHNfMS5BUE1fRVZFTlRTLCBjb25uZWN0aW9uXzEuQ29ubmVjdGlvbi5DTFVTVEVSX1RJTUVfUkVDRUlWRURdKSB7XG4gICAgICAgICAgICAgICAgY29ubmVjdGlvbi5vbihldmVudCwgKGUpID0+IHRoaXMuZW1pdChldmVudCwgZSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMubG9hZEJhbGFuY2VkKSB7XG4gICAgICAgICAgICAgICAgY29ubmVjdGlvbi5vbihjb25uZWN0aW9uXzEuQ29ubmVjdGlvbi5QSU5ORUQsIHBpblR5cGUgPT4gdGhpc1trTWV0cmljc10ubWFya1Bpbm5lZChwaW5UeXBlKSk7XG4gICAgICAgICAgICAgICAgY29ubmVjdGlvbi5vbihjb25uZWN0aW9uXzEuQ29ubmVjdGlvbi5VTlBJTk5FRCwgcGluVHlwZSA9PiB0aGlzW2tNZXRyaWNzXS5tYXJrVW5waW5uZWQocGluVHlwZSkpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHNlcnZpY2VJZCA9IGNvbm5lY3Rpb24uc2VydmljZUlkO1xuICAgICAgICAgICAgICAgIGlmIChzZXJ2aWNlSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGdlbmVyYXRpb247XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNpZCA9IHNlcnZpY2VJZC50b0hleFN0cmluZygpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoKGdlbmVyYXRpb24gPSB0aGlzLnNlcnZpY2VHZW5lcmF0aW9ucy5nZXQoc2lkKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbm5lY3Rpb24uZ2VuZXJhdGlvbiA9IGdlbmVyYXRpb247XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlcnZpY2VHZW5lcmF0aW9ucy5zZXQoc2lkLCAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbm5lY3Rpb24uZ2VuZXJhdGlvbiA9IDA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25uZWN0aW9uLm1hcmtBdmFpbGFibGUoKTtcbiAgICAgICAgICAgIHRoaXMuZW1pdEFuZExvZyhDb25uZWN0aW9uUG9vbC5DT05ORUNUSU9OX1JFQURZLCBuZXcgY29ubmVjdGlvbl9wb29sX2V2ZW50c18xLkNvbm5lY3Rpb25SZWFkeUV2ZW50KHRoaXMsIGNvbm5lY3Rpb24pKTtcbiAgICAgICAgICAgIHRoaXNba1BlbmRpbmddLS07XG4gICAgICAgICAgICBjYWxsYmFjayh1bmRlZmluZWQsIGNvbm5lY3Rpb24pO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZW5zdXJlTWluUG9vbFNpemUoKSB7XG4gICAgICAgIGNvbnN0IG1pblBvb2xTaXplID0gdGhpcy5vcHRpb25zLm1pblBvb2xTaXplO1xuICAgICAgICBpZiAodGhpc1trUG9vbFN0YXRlXSAhPT0gZXhwb3J0cy5Qb29sU3RhdGUucmVhZHkgfHwgbWluUG9vbFNpemUgPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzW2tDb25uZWN0aW9uc10ucHJ1bmUoY29ubmVjdGlvbiA9PiB0aGlzLmRlc3Ryb3lDb25uZWN0aW9uSWZQZXJpc2hlZChjb25uZWN0aW9uKSk7XG4gICAgICAgIGlmICh0aGlzLnRvdGFsQ29ubmVjdGlvbkNvdW50IDwgbWluUG9vbFNpemUgJiZcbiAgICAgICAgICAgIHRoaXMucGVuZGluZ0Nvbm5lY3Rpb25Db3VudCA8IHRoaXMub3B0aW9ucy5tYXhDb25uZWN0aW5nKSB7XG4gICAgICAgICAgICAvLyBOT1RFOiBlbnN1cmVNaW5Qb29sU2l6ZSBzaG91bGQgbm90IHRyeSB0byBnZXQgYWxsIHRoZSBwZW5kaW5nXG4gICAgICAgICAgICAvLyBjb25uZWN0aW9uIHBlcm1pdHMgYmVjYXVzZSB0aGF0IHBvdGVudGlhbGx5IGRlbGF5cyB0aGUgYXZhaWxhYmlsaXR5IG9mXG4gICAgICAgICAgICAvLyB0aGUgY29ubmVjdGlvbiB0byBhIGNoZWNrb3V0IHJlcXVlc3RcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlQ29ubmVjdGlvbigoZXJyLCBjb25uZWN0aW9uKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzW2tTZXJ2ZXJdLmhhbmRsZUVycm9yKGVycik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICghZXJyICYmIGNvbm5lY3Rpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpc1trQ29ubmVjdGlvbnNdLnB1c2goY29ubmVjdGlvbik7XG4gICAgICAgICAgICAgICAgICAgIHByb2Nlc3MubmV4dFRpY2soKCkgPT4gdGhpcy5wcm9jZXNzV2FpdFF1ZXVlKCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAodGhpc1trUG9vbFN0YXRlXSA9PT0gZXhwb3J0cy5Qb29sU3RhdGUucmVhZHkpIHtcbiAgICAgICAgICAgICAgICAgICAgKDAsIHRpbWVyc18xLmNsZWFyVGltZW91dCkodGhpc1trTWluUG9vbFNpemVUaW1lcl0pO1xuICAgICAgICAgICAgICAgICAgICB0aGlzW2tNaW5Qb29sU2l6ZVRpbWVyXSA9ICgwLCB0aW1lcnNfMS5zZXRUaW1lb3V0KSgoKSA9PiB0aGlzLmVuc3VyZU1pblBvb2xTaXplKCksIHRoaXMub3B0aW9ucy5taW5Qb29sU2l6ZUNoZWNrRnJlcXVlbmN5TVMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgKDAsIHRpbWVyc18xLmNsZWFyVGltZW91dCkodGhpc1trTWluUG9vbFNpemVUaW1lcl0pO1xuICAgICAgICAgICAgdGhpc1trTWluUG9vbFNpemVUaW1lcl0gPSAoMCwgdGltZXJzXzEuc2V0VGltZW91dCkoKCkgPT4gdGhpcy5lbnN1cmVNaW5Qb29sU2l6ZSgpLCB0aGlzLm9wdGlvbnMubWluUG9vbFNpemVDaGVja0ZyZXF1ZW5jeU1TKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBwcm9jZXNzV2FpdFF1ZXVlKCkge1xuICAgICAgICBpZiAodGhpc1trUHJvY2Vzc2luZ1dhaXRRdWV1ZV0pIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzW2tQcm9jZXNzaW5nV2FpdFF1ZXVlXSA9IHRydWU7XG4gICAgICAgIHdoaWxlICh0aGlzLndhaXRRdWV1ZVNpemUpIHtcbiAgICAgICAgICAgIGNvbnN0IHdhaXRRdWV1ZU1lbWJlciA9IHRoaXNba1dhaXRRdWV1ZV0uZmlyc3QoKTtcbiAgICAgICAgICAgIGlmICghd2FpdFF1ZXVlTWVtYmVyKSB7XG4gICAgICAgICAgICAgICAgdGhpc1trV2FpdFF1ZXVlXS5zaGlmdCgpO1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHdhaXRRdWV1ZU1lbWJlcltrQ2FuY2VsbGVkXSkge1xuICAgICAgICAgICAgICAgIHRoaXNba1dhaXRRdWV1ZV0uc2hpZnQoKTtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzW2tQb29sU3RhdGVdICE9PSBleHBvcnRzLlBvb2xTdGF0ZS5yZWFkeSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlYXNvbiA9IHRoaXMuY2xvc2VkID8gJ3Bvb2xDbG9zZWQnIDogJ2Nvbm5lY3Rpb25FcnJvcic7XG4gICAgICAgICAgICAgICAgY29uc3QgZXJyb3IgPSB0aGlzLmNsb3NlZCA/IG5ldyBlcnJvcnNfMS5Qb29sQ2xvc2VkRXJyb3IodGhpcykgOiBuZXcgZXJyb3JzXzEuUG9vbENsZWFyZWRFcnJvcih0aGlzKTtcbiAgICAgICAgICAgICAgICB0aGlzLmVtaXRBbmRMb2coQ29ubmVjdGlvblBvb2wuQ09OTkVDVElPTl9DSEVDS19PVVRfRkFJTEVELCBuZXcgY29ubmVjdGlvbl9wb29sX2V2ZW50c18xLkNvbm5lY3Rpb25DaGVja091dEZhaWxlZEV2ZW50KHRoaXMsIHJlYXNvbiwgZXJyb3IpKTtcbiAgICAgICAgICAgICAgICBpZiAod2FpdFF1ZXVlTWVtYmVyLnRpbWVyKSB7XG4gICAgICAgICAgICAgICAgICAgICgwLCB0aW1lcnNfMS5jbGVhclRpbWVvdXQpKHdhaXRRdWV1ZU1lbWJlci50aW1lcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXNba1dhaXRRdWV1ZV0uc2hpZnQoKTtcbiAgICAgICAgICAgICAgICB3YWl0UXVldWVNZW1iZXIuY2FsbGJhY2soZXJyb3IpO1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCF0aGlzLmF2YWlsYWJsZUNvbm5lY3Rpb25Db3VudCkge1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgY29ubmVjdGlvbiA9IHRoaXNba0Nvbm5lY3Rpb25zXS5zaGlmdCgpO1xuICAgICAgICAgICAgaWYgKCFjb25uZWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIXRoaXMuZGVzdHJveUNvbm5lY3Rpb25JZlBlcmlzaGVkKGNvbm5lY3Rpb24pKSB7XG4gICAgICAgICAgICAgICAgdGhpc1trQ2hlY2tlZE91dF0uYWRkKGNvbm5lY3Rpb24pO1xuICAgICAgICAgICAgICAgIHRoaXMuZW1pdEFuZExvZyhDb25uZWN0aW9uUG9vbC5DT05ORUNUSU9OX0NIRUNLRURfT1VULCBuZXcgY29ubmVjdGlvbl9wb29sX2V2ZW50c18xLkNvbm5lY3Rpb25DaGVja2VkT3V0RXZlbnQodGhpcywgY29ubmVjdGlvbikpO1xuICAgICAgICAgICAgICAgIGlmICh3YWl0UXVldWVNZW1iZXIudGltZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgKDAsIHRpbWVyc18xLmNsZWFyVGltZW91dCkod2FpdFF1ZXVlTWVtYmVyLnRpbWVyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpc1trV2FpdFF1ZXVlXS5zaGlmdCgpO1xuICAgICAgICAgICAgICAgIHdhaXRRdWV1ZU1lbWJlci5jYWxsYmFjayh1bmRlZmluZWQsIGNvbm5lY3Rpb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHsgbWF4UG9vbFNpemUsIG1heENvbm5lY3RpbmcgfSA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgd2hpbGUgKHRoaXMud2FpdFF1ZXVlU2l6ZSA+IDAgJiZcbiAgICAgICAgICAgIHRoaXMucGVuZGluZ0Nvbm5lY3Rpb25Db3VudCA8IG1heENvbm5lY3RpbmcgJiZcbiAgICAgICAgICAgIChtYXhQb29sU2l6ZSA9PT0gMCB8fCB0aGlzLnRvdGFsQ29ubmVjdGlvbkNvdW50IDwgbWF4UG9vbFNpemUpKSB7XG4gICAgICAgICAgICBjb25zdCB3YWl0UXVldWVNZW1iZXIgPSB0aGlzW2tXYWl0UXVldWVdLnNoaWZ0KCk7XG4gICAgICAgICAgICBpZiAoIXdhaXRRdWV1ZU1lbWJlciB8fCB3YWl0UXVldWVNZW1iZXJba0NhbmNlbGxlZF0pIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuY3JlYXRlQ29ubmVjdGlvbigoZXJyLCBjb25uZWN0aW9uKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHdhaXRRdWV1ZU1lbWJlcltrQ2FuY2VsbGVkXSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWVyciAmJiBjb25uZWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzW2tDb25uZWN0aW9uc10ucHVzaChjb25uZWN0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0QW5kTG9nKENvbm5lY3Rpb25Qb29sLkNPTk5FQ1RJT05fQ0hFQ0tfT1VUX0ZBSUxFRCwgXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBUT0RPKE5PREUtNTE5Mik6IFJlbW92ZSB0aGlzIGNhc3RcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBjb25uZWN0aW9uX3Bvb2xfZXZlbnRzXzEuQ29ubmVjdGlvbkNoZWNrT3V0RmFpbGVkRXZlbnQodGhpcywgJ2Nvbm5lY3Rpb25FcnJvcicsIGVycikpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGNvbm5lY3Rpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXNba0NoZWNrZWRPdXRdLmFkZChjb25uZWN0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZW1pdEFuZExvZyhDb25uZWN0aW9uUG9vbC5DT05ORUNUSU9OX0NIRUNLRURfT1VULCBuZXcgY29ubmVjdGlvbl9wb29sX2V2ZW50c18xLkNvbm5lY3Rpb25DaGVja2VkT3V0RXZlbnQodGhpcywgY29ubmVjdGlvbikpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmICh3YWl0UXVldWVNZW1iZXIudGltZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICgwLCB0aW1lcnNfMS5jbGVhclRpbWVvdXQpKHdhaXRRdWV1ZU1lbWJlci50aW1lcik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgd2FpdFF1ZXVlTWVtYmVyLmNhbGxiYWNrKGVyciwgY29ubmVjdGlvbik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHByb2Nlc3MubmV4dFRpY2soKCkgPT4gdGhpcy5wcm9jZXNzV2FpdFF1ZXVlKCkpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpc1trUHJvY2Vzc2luZ1dhaXRRdWV1ZV0gPSBmYWxzZTtcbiAgICB9XG59XG4vKipcbiAqIEVtaXR0ZWQgd2hlbiB0aGUgY29ubmVjdGlvbiBwb29sIGlzIGNyZWF0ZWQuXG4gKiBAZXZlbnRcbiAqL1xuQ29ubmVjdGlvblBvb2wuQ09OTkVDVElPTl9QT09MX0NSRUFURUQgPSBjb25zdGFudHNfMS5DT05ORUNUSU9OX1BPT0xfQ1JFQVRFRDtcbi8qKlxuICogRW1pdHRlZCBvbmNlIHdoZW4gdGhlIGNvbm5lY3Rpb24gcG9vbCBpcyBjbG9zZWRcbiAqIEBldmVudFxuICovXG5Db25uZWN0aW9uUG9vbC5DT05ORUNUSU9OX1BPT0xfQ0xPU0VEID0gY29uc3RhbnRzXzEuQ09OTkVDVElPTl9QT09MX0NMT1NFRDtcbi8qKlxuICogRW1pdHRlZCBlYWNoIHRpbWUgdGhlIGNvbm5lY3Rpb24gcG9vbCBpcyBjbGVhcmVkIGFuZCBpdCdzIGdlbmVyYXRpb24gaW5jcmVtZW50ZWRcbiAqIEBldmVudFxuICovXG5Db25uZWN0aW9uUG9vbC5DT05ORUNUSU9OX1BPT0xfQ0xFQVJFRCA9IGNvbnN0YW50c18xLkNPTk5FQ1RJT05fUE9PTF9DTEVBUkVEO1xuLyoqXG4gKiBFbWl0dGVkIGVhY2ggdGltZSB0aGUgY29ubmVjdGlvbiBwb29sIGlzIG1hcmtlZCByZWFkeVxuICogQGV2ZW50XG4gKi9cbkNvbm5lY3Rpb25Qb29sLkNPTk5FQ1RJT05fUE9PTF9SRUFEWSA9IGNvbnN0YW50c18xLkNPTk5FQ1RJT05fUE9PTF9SRUFEWTtcbi8qKlxuICogRW1pdHRlZCB3aGVuIGEgY29ubmVjdGlvbiBpcyBjcmVhdGVkLlxuICogQGV2ZW50XG4gKi9cbkNvbm5lY3Rpb25Qb29sLkNPTk5FQ1RJT05fQ1JFQVRFRCA9IGNvbnN0YW50c18xLkNPTk5FQ1RJT05fQ1JFQVRFRDtcbi8qKlxuICogRW1pdHRlZCB3aGVuIGEgY29ubmVjdGlvbiBiZWNvbWVzIGVzdGFibGlzaGVkLCBhbmQgaXMgcmVhZHkgdG8gdXNlXG4gKiBAZXZlbnRcbiAqL1xuQ29ubmVjdGlvblBvb2wuQ09OTkVDVElPTl9SRUFEWSA9IGNvbnN0YW50c18xLkNPTk5FQ1RJT05fUkVBRFk7XG4vKipcbiAqIEVtaXR0ZWQgd2hlbiBhIGNvbm5lY3Rpb24gaXMgY2xvc2VkXG4gKiBAZXZlbnRcbiAqL1xuQ29ubmVjdGlvblBvb2wuQ09OTkVDVElPTl9DTE9TRUQgPSBjb25zdGFudHNfMS5DT05ORUNUSU9OX0NMT1NFRDtcbi8qKlxuICogRW1pdHRlZCB3aGVuIGFuIGF0dGVtcHQgdG8gY2hlY2sgb3V0IGEgY29ubmVjdGlvbiBiZWdpbnNcbiAqIEBldmVudFxuICovXG5Db25uZWN0aW9uUG9vbC5DT05ORUNUSU9OX0NIRUNLX09VVF9TVEFSVEVEID0gY29uc3RhbnRzXzEuQ09OTkVDVElPTl9DSEVDS19PVVRfU1RBUlRFRDtcbi8qKlxuICogRW1pdHRlZCB3aGVuIGFuIGF0dGVtcHQgdG8gY2hlY2sgb3V0IGEgY29ubmVjdGlvbiBmYWlsc1xuICogQGV2ZW50XG4gKi9cbkNvbm5lY3Rpb25Qb29sLkNPTk5FQ1RJT05fQ0hFQ0tfT1VUX0ZBSUxFRCA9IGNvbnN0YW50c18xLkNPTk5FQ1RJT05fQ0hFQ0tfT1VUX0ZBSUxFRDtcbi8qKlxuICogRW1pdHRlZCBlYWNoIHRpbWUgYSBjb25uZWN0aW9uIGlzIHN1Y2Nlc3NmdWxseSBjaGVja2VkIG91dCBvZiB0aGUgY29ubmVjdGlvbiBwb29sXG4gKiBAZXZlbnRcbiAqL1xuQ29ubmVjdGlvblBvb2wuQ09OTkVDVElPTl9DSEVDS0VEX09VVCA9IGNvbnN0YW50c18xLkNPTk5FQ1RJT05fQ0hFQ0tFRF9PVVQ7XG4vKipcbiAqIEVtaXR0ZWQgZWFjaCB0aW1lIGEgY29ubmVjdGlvbiBpcyBzdWNjZXNzZnVsbHkgY2hlY2tlZCBpbnRvIHRoZSBjb25uZWN0aW9uIHBvb2xcbiAqIEBldmVudFxuICovXG5Db25uZWN0aW9uUG9vbC5DT05ORUNUSU9OX0NIRUNLRURfSU4gPSBjb25zdGFudHNfMS5DT05ORUNUSU9OX0NIRUNLRURfSU47XG5leHBvcnRzLkNvbm5lY3Rpb25Qb29sID0gQ29ubmVjdGlvblBvb2w7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1jb25uZWN0aW9uX3Bvb2wuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/cmap/connection_pool.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/cmap/connection_pool_events.js":
/*!*************************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/cmap/connection_pool_events.js ***!
  \*************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.ConnectionPoolClearedEvent = exports.ConnectionCheckedInEvent = exports.ConnectionCheckedOutEvent = exports.ConnectionCheckOutFailedEvent = exports.ConnectionCheckOutStartedEvent = exports.ConnectionClosedEvent = exports.ConnectionReadyEvent = exports.ConnectionCreatedEvent = exports.ConnectionPoolClosedEvent = exports.ConnectionPoolReadyEvent = exports.ConnectionPoolCreatedEvent = exports.ConnectionPoolMonitoringEvent = void 0;\nconst constants_1 = __webpack_require__(/*! ../constants */ \"(api)/../server/node_modules/mongodb/lib/constants.js\");\n/**\n * The base export class for all monitoring events published from the connection pool\n * @public\n * @category Event\n */\nclass ConnectionPoolMonitoringEvent {\n    /** @internal */\n    constructor(pool) {\n        this.time = new Date();\n        this.address = pool.address;\n    }\n}\nexports.ConnectionPoolMonitoringEvent = ConnectionPoolMonitoringEvent;\n/**\n * An event published when a connection pool is created\n * @public\n * @category Event\n */\nclass ConnectionPoolCreatedEvent extends ConnectionPoolMonitoringEvent {\n    /** @internal */\n    constructor(pool) {\n        super(pool);\n        /** @internal */\n        this.name = constants_1.CONNECTION_POOL_CREATED;\n        if (pool.options.credentials != null) {\n            // Intentionally remove credentials: NODE-5460\n            this.options = { ...pool.options, credentials: {} };\n        }\n        else {\n            this.options = pool.options;\n        }\n    }\n}\nexports.ConnectionPoolCreatedEvent = ConnectionPoolCreatedEvent;\n/**\n * An event published when a connection pool is ready\n * @public\n * @category Event\n */\nclass ConnectionPoolReadyEvent extends ConnectionPoolMonitoringEvent {\n    /** @internal */\n    constructor(pool) {\n        super(pool);\n        /** @internal */\n        this.name = constants_1.CONNECTION_POOL_READY;\n    }\n}\nexports.ConnectionPoolReadyEvent = ConnectionPoolReadyEvent;\n/**\n * An event published when a connection pool is closed\n * @public\n * @category Event\n */\nclass ConnectionPoolClosedEvent extends ConnectionPoolMonitoringEvent {\n    /** @internal */\n    constructor(pool) {\n        super(pool);\n        /** @internal */\n        this.name = constants_1.CONNECTION_POOL_CLOSED;\n    }\n}\nexports.ConnectionPoolClosedEvent = ConnectionPoolClosedEvent;\n/**\n * An event published when a connection pool creates a new connection\n * @public\n * @category Event\n */\nclass ConnectionCreatedEvent extends ConnectionPoolMonitoringEvent {\n    /** @internal */\n    constructor(pool, connection) {\n        super(pool);\n        /** @internal */\n        this.name = constants_1.CONNECTION_CREATED;\n        this.connectionId = connection.id;\n    }\n}\nexports.ConnectionCreatedEvent = ConnectionCreatedEvent;\n/**\n * An event published when a connection is ready for use\n * @public\n * @category Event\n */\nclass ConnectionReadyEvent extends ConnectionPoolMonitoringEvent {\n    /** @internal */\n    constructor(pool, connection) {\n        super(pool);\n        /** @internal */\n        this.name = constants_1.CONNECTION_READY;\n        this.connectionId = connection.id;\n    }\n}\nexports.ConnectionReadyEvent = ConnectionReadyEvent;\n/**\n * An event published when a connection is closed\n * @public\n * @category Event\n */\nclass ConnectionClosedEvent extends ConnectionPoolMonitoringEvent {\n    /** @internal */\n    constructor(pool, connection, reason, error) {\n        super(pool);\n        /** @internal */\n        this.name = constants_1.CONNECTION_CLOSED;\n        this.connectionId = connection.id;\n        this.reason = reason;\n        this.serviceId = connection.serviceId;\n        this.error = error ?? null;\n    }\n}\nexports.ConnectionClosedEvent = ConnectionClosedEvent;\n/**\n * An event published when a request to check a connection out begins\n * @public\n * @category Event\n */\nclass ConnectionCheckOutStartedEvent extends ConnectionPoolMonitoringEvent {\n    /** @internal */\n    constructor(pool) {\n        super(pool);\n        /** @internal */\n        this.name = constants_1.CONNECTION_CHECK_OUT_STARTED;\n    }\n}\nexports.ConnectionCheckOutStartedEvent = ConnectionCheckOutStartedEvent;\n/**\n * An event published when a request to check a connection out fails\n * @public\n * @category Event\n */\nclass ConnectionCheckOutFailedEvent extends ConnectionPoolMonitoringEvent {\n    /** @internal */\n    constructor(pool, reason, error) {\n        super(pool);\n        /** @internal */\n        this.name = constants_1.CONNECTION_CHECK_OUT_FAILED;\n        this.reason = reason;\n        this.error = error;\n    }\n}\nexports.ConnectionCheckOutFailedEvent = ConnectionCheckOutFailedEvent;\n/**\n * An event published when a connection is checked out of the connection pool\n * @public\n * @category Event\n */\nclass ConnectionCheckedOutEvent extends ConnectionPoolMonitoringEvent {\n    /** @internal */\n    constructor(pool, connection) {\n        super(pool);\n        /** @internal */\n        this.name = constants_1.CONNECTION_CHECKED_OUT;\n        this.connectionId = connection.id;\n    }\n}\nexports.ConnectionCheckedOutEvent = ConnectionCheckedOutEvent;\n/**\n * An event published when a connection is checked into the connection pool\n * @public\n * @category Event\n */\nclass ConnectionCheckedInEvent extends ConnectionPoolMonitoringEvent {\n    /** @internal */\n    constructor(pool, connection) {\n        super(pool);\n        /** @internal */\n        this.name = constants_1.CONNECTION_CHECKED_IN;\n        this.connectionId = connection.id;\n    }\n}\nexports.ConnectionCheckedInEvent = ConnectionCheckedInEvent;\n/**\n * An event published when a connection pool is cleared\n * @public\n * @category Event\n */\nclass ConnectionPoolClearedEvent extends ConnectionPoolMonitoringEvent {\n    /** @internal */\n    constructor(pool, options = {}) {\n        super(pool);\n        /** @internal */\n        this.name = constants_1.CONNECTION_POOL_CLEARED;\n        this.serviceId = options.serviceId;\n        this.interruptInUseConnections = options.interruptInUseConnections;\n    }\n}\nexports.ConnectionPoolClearedEvent = ConnectionPoolClearedEvent;\n//# sourceMappingURL=connection_pool_events.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jbWFwL2Nvbm5lY3Rpb25fcG9vbF9ldmVudHMuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0Qsa0NBQWtDLEdBQUcsZ0NBQWdDLEdBQUcsaUNBQWlDLEdBQUcscUNBQXFDLEdBQUcsc0NBQXNDLEdBQUcsNkJBQTZCLEdBQUcsNEJBQTRCLEdBQUcsOEJBQThCLEdBQUcsaUNBQWlDLEdBQUcsZ0NBQWdDLEdBQUcsa0NBQWtDLEdBQUcscUNBQXFDO0FBQzlhLG9CQUFvQixtQkFBTyxDQUFDLDJFQUFjO0FBQzFDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFDQUFxQztBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QjtBQUM3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0M7QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0M7QUFDaEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQ0FBaUM7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhCQUE4QjtBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0M7QUFDdEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUNBQXFDO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQ0FBaUM7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQztBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQztBQUNsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQztBQUNsQyIsInNvdXJjZXMiOlsiRDpcXHNhbG9uaVxcYXBwcmFpc2FsLXN5c3RlbVxcc2VydmVyXFxub2RlX21vZHVsZXNcXG1vbmdvZGJcXGxpYlxcY21hcFxcY29ubmVjdGlvbl9wb29sX2V2ZW50cy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuQ29ubmVjdGlvblBvb2xDbGVhcmVkRXZlbnQgPSBleHBvcnRzLkNvbm5lY3Rpb25DaGVja2VkSW5FdmVudCA9IGV4cG9ydHMuQ29ubmVjdGlvbkNoZWNrZWRPdXRFdmVudCA9IGV4cG9ydHMuQ29ubmVjdGlvbkNoZWNrT3V0RmFpbGVkRXZlbnQgPSBleHBvcnRzLkNvbm5lY3Rpb25DaGVja091dFN0YXJ0ZWRFdmVudCA9IGV4cG9ydHMuQ29ubmVjdGlvbkNsb3NlZEV2ZW50ID0gZXhwb3J0cy5Db25uZWN0aW9uUmVhZHlFdmVudCA9IGV4cG9ydHMuQ29ubmVjdGlvbkNyZWF0ZWRFdmVudCA9IGV4cG9ydHMuQ29ubmVjdGlvblBvb2xDbG9zZWRFdmVudCA9IGV4cG9ydHMuQ29ubmVjdGlvblBvb2xSZWFkeUV2ZW50ID0gZXhwb3J0cy5Db25uZWN0aW9uUG9vbENyZWF0ZWRFdmVudCA9IGV4cG9ydHMuQ29ubmVjdGlvblBvb2xNb25pdG9yaW5nRXZlbnQgPSB2b2lkIDA7XG5jb25zdCBjb25zdGFudHNfMSA9IHJlcXVpcmUoXCIuLi9jb25zdGFudHNcIik7XG4vKipcbiAqIFRoZSBiYXNlIGV4cG9ydCBjbGFzcyBmb3IgYWxsIG1vbml0b3JpbmcgZXZlbnRzIHB1Ymxpc2hlZCBmcm9tIHRoZSBjb25uZWN0aW9uIHBvb2xcbiAqIEBwdWJsaWNcbiAqIEBjYXRlZ29yeSBFdmVudFxuICovXG5jbGFzcyBDb25uZWN0aW9uUG9vbE1vbml0b3JpbmdFdmVudCB7XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGNvbnN0cnVjdG9yKHBvb2wpIHtcbiAgICAgICAgdGhpcy50aW1lID0gbmV3IERhdGUoKTtcbiAgICAgICAgdGhpcy5hZGRyZXNzID0gcG9vbC5hZGRyZXNzO1xuICAgIH1cbn1cbmV4cG9ydHMuQ29ubmVjdGlvblBvb2xNb25pdG9yaW5nRXZlbnQgPSBDb25uZWN0aW9uUG9vbE1vbml0b3JpbmdFdmVudDtcbi8qKlxuICogQW4gZXZlbnQgcHVibGlzaGVkIHdoZW4gYSBjb25uZWN0aW9uIHBvb2wgaXMgY3JlYXRlZFxuICogQHB1YmxpY1xuICogQGNhdGVnb3J5IEV2ZW50XG4gKi9cbmNsYXNzIENvbm5lY3Rpb25Qb29sQ3JlYXRlZEV2ZW50IGV4dGVuZHMgQ29ubmVjdGlvblBvb2xNb25pdG9yaW5nRXZlbnQge1xuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBjb25zdHJ1Y3Rvcihwb29sKSB7XG4gICAgICAgIHN1cGVyKHBvb2wpO1xuICAgICAgICAvKiogQGludGVybmFsICovXG4gICAgICAgIHRoaXMubmFtZSA9IGNvbnN0YW50c18xLkNPTk5FQ1RJT05fUE9PTF9DUkVBVEVEO1xuICAgICAgICBpZiAocG9vbC5vcHRpb25zLmNyZWRlbnRpYWxzICE9IG51bGwpIHtcbiAgICAgICAgICAgIC8vIEludGVudGlvbmFsbHkgcmVtb3ZlIGNyZWRlbnRpYWxzOiBOT0RFLTU0NjBcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucyA9IHsgLi4ucG9vbC5vcHRpb25zLCBjcmVkZW50aWFsczoge30gfTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucyA9IHBvb2wub3B0aW9ucztcbiAgICAgICAgfVxuICAgIH1cbn1cbmV4cG9ydHMuQ29ubmVjdGlvblBvb2xDcmVhdGVkRXZlbnQgPSBDb25uZWN0aW9uUG9vbENyZWF0ZWRFdmVudDtcbi8qKlxuICogQW4gZXZlbnQgcHVibGlzaGVkIHdoZW4gYSBjb25uZWN0aW9uIHBvb2wgaXMgcmVhZHlcbiAqIEBwdWJsaWNcbiAqIEBjYXRlZ29yeSBFdmVudFxuICovXG5jbGFzcyBDb25uZWN0aW9uUG9vbFJlYWR5RXZlbnQgZXh0ZW5kcyBDb25uZWN0aW9uUG9vbE1vbml0b3JpbmdFdmVudCB7XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGNvbnN0cnVjdG9yKHBvb2wpIHtcbiAgICAgICAgc3VwZXIocG9vbCk7XG4gICAgICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICAgICAgdGhpcy5uYW1lID0gY29uc3RhbnRzXzEuQ09OTkVDVElPTl9QT09MX1JFQURZO1xuICAgIH1cbn1cbmV4cG9ydHMuQ29ubmVjdGlvblBvb2xSZWFkeUV2ZW50ID0gQ29ubmVjdGlvblBvb2xSZWFkeUV2ZW50O1xuLyoqXG4gKiBBbiBldmVudCBwdWJsaXNoZWQgd2hlbiBhIGNvbm5lY3Rpb24gcG9vbCBpcyBjbG9zZWRcbiAqIEBwdWJsaWNcbiAqIEBjYXRlZ29yeSBFdmVudFxuICovXG5jbGFzcyBDb25uZWN0aW9uUG9vbENsb3NlZEV2ZW50IGV4dGVuZHMgQ29ubmVjdGlvblBvb2xNb25pdG9yaW5nRXZlbnQge1xuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBjb25zdHJ1Y3Rvcihwb29sKSB7XG4gICAgICAgIHN1cGVyKHBvb2wpO1xuICAgICAgICAvKiogQGludGVybmFsICovXG4gICAgICAgIHRoaXMubmFtZSA9IGNvbnN0YW50c18xLkNPTk5FQ1RJT05fUE9PTF9DTE9TRUQ7XG4gICAgfVxufVxuZXhwb3J0cy5Db25uZWN0aW9uUG9vbENsb3NlZEV2ZW50ID0gQ29ubmVjdGlvblBvb2xDbG9zZWRFdmVudDtcbi8qKlxuICogQW4gZXZlbnQgcHVibGlzaGVkIHdoZW4gYSBjb25uZWN0aW9uIHBvb2wgY3JlYXRlcyBhIG5ldyBjb25uZWN0aW9uXG4gKiBAcHVibGljXG4gKiBAY2F0ZWdvcnkgRXZlbnRcbiAqL1xuY2xhc3MgQ29ubmVjdGlvbkNyZWF0ZWRFdmVudCBleHRlbmRzIENvbm5lY3Rpb25Qb29sTW9uaXRvcmluZ0V2ZW50IHtcbiAgICAvKiogQGludGVybmFsICovXG4gICAgY29uc3RydWN0b3IocG9vbCwgY29ubmVjdGlvbikge1xuICAgICAgICBzdXBlcihwb29sKTtcbiAgICAgICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgICAgICB0aGlzLm5hbWUgPSBjb25zdGFudHNfMS5DT05ORUNUSU9OX0NSRUFURUQ7XG4gICAgICAgIHRoaXMuY29ubmVjdGlvbklkID0gY29ubmVjdGlvbi5pZDtcbiAgICB9XG59XG5leHBvcnRzLkNvbm5lY3Rpb25DcmVhdGVkRXZlbnQgPSBDb25uZWN0aW9uQ3JlYXRlZEV2ZW50O1xuLyoqXG4gKiBBbiBldmVudCBwdWJsaXNoZWQgd2hlbiBhIGNvbm5lY3Rpb24gaXMgcmVhZHkgZm9yIHVzZVxuICogQHB1YmxpY1xuICogQGNhdGVnb3J5IEV2ZW50XG4gKi9cbmNsYXNzIENvbm5lY3Rpb25SZWFkeUV2ZW50IGV4dGVuZHMgQ29ubmVjdGlvblBvb2xNb25pdG9yaW5nRXZlbnQge1xuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBjb25zdHJ1Y3Rvcihwb29sLCBjb25uZWN0aW9uKSB7XG4gICAgICAgIHN1cGVyKHBvb2wpO1xuICAgICAgICAvKiogQGludGVybmFsICovXG4gICAgICAgIHRoaXMubmFtZSA9IGNvbnN0YW50c18xLkNPTk5FQ1RJT05fUkVBRFk7XG4gICAgICAgIHRoaXMuY29ubmVjdGlvbklkID0gY29ubmVjdGlvbi5pZDtcbiAgICB9XG59XG5leHBvcnRzLkNvbm5lY3Rpb25SZWFkeUV2ZW50ID0gQ29ubmVjdGlvblJlYWR5RXZlbnQ7XG4vKipcbiAqIEFuIGV2ZW50IHB1Ymxpc2hlZCB3aGVuIGEgY29ubmVjdGlvbiBpcyBjbG9zZWRcbiAqIEBwdWJsaWNcbiAqIEBjYXRlZ29yeSBFdmVudFxuICovXG5jbGFzcyBDb25uZWN0aW9uQ2xvc2VkRXZlbnQgZXh0ZW5kcyBDb25uZWN0aW9uUG9vbE1vbml0b3JpbmdFdmVudCB7XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGNvbnN0cnVjdG9yKHBvb2wsIGNvbm5lY3Rpb24sIHJlYXNvbiwgZXJyb3IpIHtcbiAgICAgICAgc3VwZXIocG9vbCk7XG4gICAgICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICAgICAgdGhpcy5uYW1lID0gY29uc3RhbnRzXzEuQ09OTkVDVElPTl9DTE9TRUQ7XG4gICAgICAgIHRoaXMuY29ubmVjdGlvbklkID0gY29ubmVjdGlvbi5pZDtcbiAgICAgICAgdGhpcy5yZWFzb24gPSByZWFzb247XG4gICAgICAgIHRoaXMuc2VydmljZUlkID0gY29ubmVjdGlvbi5zZXJ2aWNlSWQ7XG4gICAgICAgIHRoaXMuZXJyb3IgPSBlcnJvciA/PyBudWxsO1xuICAgIH1cbn1cbmV4cG9ydHMuQ29ubmVjdGlvbkNsb3NlZEV2ZW50ID0gQ29ubmVjdGlvbkNsb3NlZEV2ZW50O1xuLyoqXG4gKiBBbiBldmVudCBwdWJsaXNoZWQgd2hlbiBhIHJlcXVlc3QgdG8gY2hlY2sgYSBjb25uZWN0aW9uIG91dCBiZWdpbnNcbiAqIEBwdWJsaWNcbiAqIEBjYXRlZ29yeSBFdmVudFxuICovXG5jbGFzcyBDb25uZWN0aW9uQ2hlY2tPdXRTdGFydGVkRXZlbnQgZXh0ZW5kcyBDb25uZWN0aW9uUG9vbE1vbml0b3JpbmdFdmVudCB7XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGNvbnN0cnVjdG9yKHBvb2wpIHtcbiAgICAgICAgc3VwZXIocG9vbCk7XG4gICAgICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICAgICAgdGhpcy5uYW1lID0gY29uc3RhbnRzXzEuQ09OTkVDVElPTl9DSEVDS19PVVRfU1RBUlRFRDtcbiAgICB9XG59XG5leHBvcnRzLkNvbm5lY3Rpb25DaGVja091dFN0YXJ0ZWRFdmVudCA9IENvbm5lY3Rpb25DaGVja091dFN0YXJ0ZWRFdmVudDtcbi8qKlxuICogQW4gZXZlbnQgcHVibGlzaGVkIHdoZW4gYSByZXF1ZXN0IHRvIGNoZWNrIGEgY29ubmVjdGlvbiBvdXQgZmFpbHNcbiAqIEBwdWJsaWNcbiAqIEBjYXRlZ29yeSBFdmVudFxuICovXG5jbGFzcyBDb25uZWN0aW9uQ2hlY2tPdXRGYWlsZWRFdmVudCBleHRlbmRzIENvbm5lY3Rpb25Qb29sTW9uaXRvcmluZ0V2ZW50IHtcbiAgICAvKiogQGludGVybmFsICovXG4gICAgY29uc3RydWN0b3IocG9vbCwgcmVhc29uLCBlcnJvcikge1xuICAgICAgICBzdXBlcihwb29sKTtcbiAgICAgICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgICAgICB0aGlzLm5hbWUgPSBjb25zdGFudHNfMS5DT05ORUNUSU9OX0NIRUNLX09VVF9GQUlMRUQ7XG4gICAgICAgIHRoaXMucmVhc29uID0gcmVhc29uO1xuICAgICAgICB0aGlzLmVycm9yID0gZXJyb3I7XG4gICAgfVxufVxuZXhwb3J0cy5Db25uZWN0aW9uQ2hlY2tPdXRGYWlsZWRFdmVudCA9IENvbm5lY3Rpb25DaGVja091dEZhaWxlZEV2ZW50O1xuLyoqXG4gKiBBbiBldmVudCBwdWJsaXNoZWQgd2hlbiBhIGNvbm5lY3Rpb24gaXMgY2hlY2tlZCBvdXQgb2YgdGhlIGNvbm5lY3Rpb24gcG9vbFxuICogQHB1YmxpY1xuICogQGNhdGVnb3J5IEV2ZW50XG4gKi9cbmNsYXNzIENvbm5lY3Rpb25DaGVja2VkT3V0RXZlbnQgZXh0ZW5kcyBDb25uZWN0aW9uUG9vbE1vbml0b3JpbmdFdmVudCB7XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGNvbnN0cnVjdG9yKHBvb2wsIGNvbm5lY3Rpb24pIHtcbiAgICAgICAgc3VwZXIocG9vbCk7XG4gICAgICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICAgICAgdGhpcy5uYW1lID0gY29uc3RhbnRzXzEuQ09OTkVDVElPTl9DSEVDS0VEX09VVDtcbiAgICAgICAgdGhpcy5jb25uZWN0aW9uSWQgPSBjb25uZWN0aW9uLmlkO1xuICAgIH1cbn1cbmV4cG9ydHMuQ29ubmVjdGlvbkNoZWNrZWRPdXRFdmVudCA9IENvbm5lY3Rpb25DaGVja2VkT3V0RXZlbnQ7XG4vKipcbiAqIEFuIGV2ZW50IHB1Ymxpc2hlZCB3aGVuIGEgY29ubmVjdGlvbiBpcyBjaGVja2VkIGludG8gdGhlIGNvbm5lY3Rpb24gcG9vbFxuICogQHB1YmxpY1xuICogQGNhdGVnb3J5IEV2ZW50XG4gKi9cbmNsYXNzIENvbm5lY3Rpb25DaGVja2VkSW5FdmVudCBleHRlbmRzIENvbm5lY3Rpb25Qb29sTW9uaXRvcmluZ0V2ZW50IHtcbiAgICAvKiogQGludGVybmFsICovXG4gICAgY29uc3RydWN0b3IocG9vbCwgY29ubmVjdGlvbikge1xuICAgICAgICBzdXBlcihwb29sKTtcbiAgICAgICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgICAgICB0aGlzLm5hbWUgPSBjb25zdGFudHNfMS5DT05ORUNUSU9OX0NIRUNLRURfSU47XG4gICAgICAgIHRoaXMuY29ubmVjdGlvbklkID0gY29ubmVjdGlvbi5pZDtcbiAgICB9XG59XG5leHBvcnRzLkNvbm5lY3Rpb25DaGVja2VkSW5FdmVudCA9IENvbm5lY3Rpb25DaGVja2VkSW5FdmVudDtcbi8qKlxuICogQW4gZXZlbnQgcHVibGlzaGVkIHdoZW4gYSBjb25uZWN0aW9uIHBvb2wgaXMgY2xlYXJlZFxuICogQHB1YmxpY1xuICogQGNhdGVnb3J5IEV2ZW50XG4gKi9cbmNsYXNzIENvbm5lY3Rpb25Qb29sQ2xlYXJlZEV2ZW50IGV4dGVuZHMgQ29ubmVjdGlvblBvb2xNb25pdG9yaW5nRXZlbnQge1xuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBjb25zdHJ1Y3Rvcihwb29sLCBvcHRpb25zID0ge30pIHtcbiAgICAgICAgc3VwZXIocG9vbCk7XG4gICAgICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICAgICAgdGhpcy5uYW1lID0gY29uc3RhbnRzXzEuQ09OTkVDVElPTl9QT09MX0NMRUFSRUQ7XG4gICAgICAgIHRoaXMuc2VydmljZUlkID0gb3B0aW9ucy5zZXJ2aWNlSWQ7XG4gICAgICAgIHRoaXMuaW50ZXJydXB0SW5Vc2VDb25uZWN0aW9ucyA9IG9wdGlvbnMuaW50ZXJydXB0SW5Vc2VDb25uZWN0aW9ucztcbiAgICB9XG59XG5leHBvcnRzLkNvbm5lY3Rpb25Qb29sQ2xlYXJlZEV2ZW50ID0gQ29ubmVjdGlvblBvb2xDbGVhcmVkRXZlbnQ7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1jb25uZWN0aW9uX3Bvb2xfZXZlbnRzLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/cmap/connection_pool_events.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/cmap/errors.js":
/*!*********************************************************!*\
  !*** ../server/node_modules/mongodb/lib/cmap/errors.js ***!
  \*********************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.WaitQueueTimeoutError = exports.PoolClearedOnNetworkError = exports.PoolClearedError = exports.PoolClosedError = void 0;\nconst error_1 = __webpack_require__(/*! ../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\n/**\n * An error indicating a connection pool is closed\n * @category Error\n */\nclass PoolClosedError extends error_1.MongoDriverError {\n    constructor(pool) {\n        super('Attempted to check out a connection from closed connection pool');\n        this.address = pool.address;\n    }\n    get name() {\n        return 'MongoPoolClosedError';\n    }\n}\nexports.PoolClosedError = PoolClosedError;\n/**\n * An error indicating a connection pool is currently paused\n * @category Error\n */\nclass PoolClearedError extends error_1.MongoNetworkError {\n    constructor(pool, message) {\n        const errorMessage = message\n            ? message\n            : `Connection pool for ${pool.address} was cleared because another operation failed with: \"${pool.serverError?.message}\"`;\n        super(errorMessage);\n        this.address = pool.address;\n        this.addErrorLabel(error_1.MongoErrorLabel.RetryableWriteError);\n    }\n    get name() {\n        return 'MongoPoolClearedError';\n    }\n}\nexports.PoolClearedError = PoolClearedError;\n/**\n * An error indicating that a connection pool has been cleared after the monitor for that server timed out.\n * @category Error\n */\nclass PoolClearedOnNetworkError extends PoolClearedError {\n    constructor(pool) {\n        super(pool, `Connection to ${pool.address} interrupted due to server monitor timeout`);\n    }\n    get name() {\n        return 'PoolClearedOnNetworkError';\n    }\n}\nexports.PoolClearedOnNetworkError = PoolClearedOnNetworkError;\n/**\n * An error thrown when a request to check out a connection times out\n * @category Error\n */\nclass WaitQueueTimeoutError extends error_1.MongoDriverError {\n    constructor(message, address) {\n        super(message);\n        this.address = address;\n    }\n    get name() {\n        return 'MongoWaitQueueTimeoutError';\n    }\n}\nexports.WaitQueueTimeoutError = WaitQueueTimeoutError;\n//# sourceMappingURL=errors.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jbWFwL2Vycm9ycy5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCw2QkFBNkIsR0FBRyxpQ0FBaUMsR0FBRyx3QkFBd0IsR0FBRyx1QkFBdUI7QUFDdEgsZ0JBQWdCLG1CQUFPLENBQUMsbUVBQVU7QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUI7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFDQUFxQyxjQUFjLHNEQUFzRCwwQkFBMEI7QUFDbkk7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QjtBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQ0FBcUMsY0FBYztBQUNuRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCO0FBQzdCIiwic291cmNlcyI6WyJEOlxcc2Fsb25pXFxhcHByYWlzYWwtc3lzdGVtXFxzZXJ2ZXJcXG5vZGVfbW9kdWxlc1xcbW9uZ29kYlxcbGliXFxjbWFwXFxlcnJvcnMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLldhaXRRdWV1ZVRpbWVvdXRFcnJvciA9IGV4cG9ydHMuUG9vbENsZWFyZWRPbk5ldHdvcmtFcnJvciA9IGV4cG9ydHMuUG9vbENsZWFyZWRFcnJvciA9IGV4cG9ydHMuUG9vbENsb3NlZEVycm9yID0gdm9pZCAwO1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuLi9lcnJvclwiKTtcbi8qKlxuICogQW4gZXJyb3IgaW5kaWNhdGluZyBhIGNvbm5lY3Rpb24gcG9vbCBpcyBjbG9zZWRcbiAqIEBjYXRlZ29yeSBFcnJvclxuICovXG5jbGFzcyBQb29sQ2xvc2VkRXJyb3IgZXh0ZW5kcyBlcnJvcl8xLk1vbmdvRHJpdmVyRXJyb3Ige1xuICAgIGNvbnN0cnVjdG9yKHBvb2wpIHtcbiAgICAgICAgc3VwZXIoJ0F0dGVtcHRlZCB0byBjaGVjayBvdXQgYSBjb25uZWN0aW9uIGZyb20gY2xvc2VkIGNvbm5lY3Rpb24gcG9vbCcpO1xuICAgICAgICB0aGlzLmFkZHJlc3MgPSBwb29sLmFkZHJlc3M7XG4gICAgfVxuICAgIGdldCBuYW1lKCkge1xuICAgICAgICByZXR1cm4gJ01vbmdvUG9vbENsb3NlZEVycm9yJztcbiAgICB9XG59XG5leHBvcnRzLlBvb2xDbG9zZWRFcnJvciA9IFBvb2xDbG9zZWRFcnJvcjtcbi8qKlxuICogQW4gZXJyb3IgaW5kaWNhdGluZyBhIGNvbm5lY3Rpb24gcG9vbCBpcyBjdXJyZW50bHkgcGF1c2VkXG4gKiBAY2F0ZWdvcnkgRXJyb3JcbiAqL1xuY2xhc3MgUG9vbENsZWFyZWRFcnJvciBleHRlbmRzIGVycm9yXzEuTW9uZ29OZXR3b3JrRXJyb3Ige1xuICAgIGNvbnN0cnVjdG9yKHBvb2wsIG1lc3NhZ2UpIHtcbiAgICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID0gbWVzc2FnZVxuICAgICAgICAgICAgPyBtZXNzYWdlXG4gICAgICAgICAgICA6IGBDb25uZWN0aW9uIHBvb2wgZm9yICR7cG9vbC5hZGRyZXNzfSB3YXMgY2xlYXJlZCBiZWNhdXNlIGFub3RoZXIgb3BlcmF0aW9uIGZhaWxlZCB3aXRoOiBcIiR7cG9vbC5zZXJ2ZXJFcnJvcj8ubWVzc2FnZX1cImA7XG4gICAgICAgIHN1cGVyKGVycm9yTWVzc2FnZSk7XG4gICAgICAgIHRoaXMuYWRkcmVzcyA9IHBvb2wuYWRkcmVzcztcbiAgICAgICAgdGhpcy5hZGRFcnJvckxhYmVsKGVycm9yXzEuTW9uZ29FcnJvckxhYmVsLlJldHJ5YWJsZVdyaXRlRXJyb3IpO1xuICAgIH1cbiAgICBnZXQgbmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdNb25nb1Bvb2xDbGVhcmVkRXJyb3InO1xuICAgIH1cbn1cbmV4cG9ydHMuUG9vbENsZWFyZWRFcnJvciA9IFBvb2xDbGVhcmVkRXJyb3I7XG4vKipcbiAqIEFuIGVycm9yIGluZGljYXRpbmcgdGhhdCBhIGNvbm5lY3Rpb24gcG9vbCBoYXMgYmVlbiBjbGVhcmVkIGFmdGVyIHRoZSBtb25pdG9yIGZvciB0aGF0IHNlcnZlciB0aW1lZCBvdXQuXG4gKiBAY2F0ZWdvcnkgRXJyb3JcbiAqL1xuY2xhc3MgUG9vbENsZWFyZWRPbk5ldHdvcmtFcnJvciBleHRlbmRzIFBvb2xDbGVhcmVkRXJyb3Ige1xuICAgIGNvbnN0cnVjdG9yKHBvb2wpIHtcbiAgICAgICAgc3VwZXIocG9vbCwgYENvbm5lY3Rpb24gdG8gJHtwb29sLmFkZHJlc3N9IGludGVycnVwdGVkIGR1ZSB0byBzZXJ2ZXIgbW9uaXRvciB0aW1lb3V0YCk7XG4gICAgfVxuICAgIGdldCBuYW1lKCkge1xuICAgICAgICByZXR1cm4gJ1Bvb2xDbGVhcmVkT25OZXR3b3JrRXJyb3InO1xuICAgIH1cbn1cbmV4cG9ydHMuUG9vbENsZWFyZWRPbk5ldHdvcmtFcnJvciA9IFBvb2xDbGVhcmVkT25OZXR3b3JrRXJyb3I7XG4vKipcbiAqIEFuIGVycm9yIHRocm93biB3aGVuIGEgcmVxdWVzdCB0byBjaGVjayBvdXQgYSBjb25uZWN0aW9uIHRpbWVzIG91dFxuICogQGNhdGVnb3J5IEVycm9yXG4gKi9cbmNsYXNzIFdhaXRRdWV1ZVRpbWVvdXRFcnJvciBleHRlbmRzIGVycm9yXzEuTW9uZ29Ecml2ZXJFcnJvciB7XG4gICAgY29uc3RydWN0b3IobWVzc2FnZSwgYWRkcmVzcykge1xuICAgICAgICBzdXBlcihtZXNzYWdlKTtcbiAgICAgICAgdGhpcy5hZGRyZXNzID0gYWRkcmVzcztcbiAgICB9XG4gICAgZ2V0IG5hbWUoKSB7XG4gICAgICAgIHJldHVybiAnTW9uZ29XYWl0UXVldWVUaW1lb3V0RXJyb3InO1xuICAgIH1cbn1cbmV4cG9ydHMuV2FpdFF1ZXVlVGltZW91dEVycm9yID0gV2FpdFF1ZXVlVGltZW91dEVycm9yO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZXJyb3JzLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/cmap/errors.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/cmap/handshake/client_metadata.js":
/*!****************************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/cmap/handshake/client_metadata.js ***!
  \****************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.getFAASEnv = exports.makeClientMetadata = exports.LimitedSizeDocument = void 0;\nconst os = __webpack_require__(/*! os */ \"os\");\nconst process = __webpack_require__(/*! process */ \"process\");\nconst bson_1 = __webpack_require__(/*! ../../bson */ \"(api)/../server/node_modules/mongodb/lib/bson.js\");\nconst error_1 = __webpack_require__(/*! ../../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\n// eslint-disable-next-line @typescript-eslint/no-var-requires\nconst NODE_DRIVER_VERSION = (__webpack_require__(/*! ../../../package.json */ \"(api)/../server/node_modules/mongodb/package.json\").version);\n/** @internal */\nclass LimitedSizeDocument {\n    constructor(maxSize) {\n        this.maxSize = maxSize;\n        this.document = new Map();\n        /** BSON overhead: Int32 + Null byte */\n        this.documentSize = 5;\n    }\n    /** Only adds key/value if the bsonByteLength is less than MAX_SIZE */\n    ifItFitsItSits(key, value) {\n        // The BSON byteLength of the new element is the same as serializing it to its own document\n        // subtracting the document size int32 and the null terminator.\n        const newElementSize = bson_1.BSON.serialize(new Map().set(key, value)).byteLength - 5;\n        if (newElementSize + this.documentSize > this.maxSize) {\n            return false;\n        }\n        this.documentSize += newElementSize;\n        this.document.set(key, value);\n        return true;\n    }\n    toObject() {\n        return bson_1.BSON.deserialize(bson_1.BSON.serialize(this.document), {\n            promoteLongs: false,\n            promoteBuffers: false,\n            promoteValues: false,\n            useBigInt64: false\n        });\n    }\n}\nexports.LimitedSizeDocument = LimitedSizeDocument;\n/**\n * From the specs:\n * Implementors SHOULD cumulatively update fields in the following order until the document is under the size limit:\n * 1. Omit fields from `env` except `env.name`.\n * 2. Omit fields from `os` except `os.type`.\n * 3. Omit the `env` document entirely.\n * 4. Truncate `platform`. -- special we do not truncate this field\n */\nfunction makeClientMetadata(options) {\n    const metadataDocument = new LimitedSizeDocument(512);\n    const { appName = '' } = options;\n    // Add app name first, it must be sent\n    if (appName.length > 0) {\n        const name = Buffer.byteLength(appName, 'utf8') <= 128\n            ? options.appName\n            : Buffer.from(appName, 'utf8').subarray(0, 128).toString('utf8');\n        metadataDocument.ifItFitsItSits('application', { name });\n    }\n    const { name = '', version = '', platform = '' } = options.driverInfo;\n    const driverInfo = {\n        name: name.length > 0 ? `nodejs|${name}` : 'nodejs',\n        version: version.length > 0 ? `${NODE_DRIVER_VERSION}|${version}` : NODE_DRIVER_VERSION\n    };\n    if (!metadataDocument.ifItFitsItSits('driver', driverInfo)) {\n        throw new error_1.MongoInvalidArgumentError('Unable to include driverInfo name and version, metadata cannot exceed 512 bytes');\n    }\n    let runtimeInfo = getRuntimeInfo();\n    if (platform.length > 0) {\n        runtimeInfo = `${runtimeInfo}|${platform}`;\n    }\n    if (!metadataDocument.ifItFitsItSits('platform', runtimeInfo)) {\n        throw new error_1.MongoInvalidArgumentError('Unable to include driverInfo platform, metadata cannot exceed 512 bytes');\n    }\n    // Note: order matters, os.type is last so it will be removed last if we're at maxSize\n    const osInfo = new Map()\n        .set('name', process.platform)\n        .set('architecture', process.arch)\n        .set('version', os.release())\n        .set('type', os.type());\n    if (!metadataDocument.ifItFitsItSits('os', osInfo)) {\n        for (const key of osInfo.keys()) {\n            osInfo.delete(key);\n            if (osInfo.size === 0)\n                break;\n            if (metadataDocument.ifItFitsItSits('os', osInfo))\n                break;\n        }\n    }\n    const faasEnv = getFAASEnv();\n    if (faasEnv != null) {\n        if (!metadataDocument.ifItFitsItSits('env', faasEnv)) {\n            for (const key of faasEnv.keys()) {\n                faasEnv.delete(key);\n                if (faasEnv.size === 0)\n                    break;\n                if (metadataDocument.ifItFitsItSits('env', faasEnv))\n                    break;\n            }\n        }\n    }\n    return metadataDocument.toObject();\n}\nexports.makeClientMetadata = makeClientMetadata;\n/**\n * Collects FaaS metadata.\n * - `name` MUST be the last key in the Map returned.\n */\nfunction getFAASEnv() {\n    const { AWS_EXECUTION_ENV = '', AWS_LAMBDA_RUNTIME_API = '', FUNCTIONS_WORKER_RUNTIME = '', K_SERVICE = '', FUNCTION_NAME = '', VERCEL = '', AWS_LAMBDA_FUNCTION_MEMORY_SIZE = '', AWS_REGION = '', FUNCTION_MEMORY_MB = '', FUNCTION_REGION = '', FUNCTION_TIMEOUT_SEC = '', VERCEL_REGION = '' } = process.env;\n    const isAWSFaaS = AWS_EXECUTION_ENV.startsWith('AWS_Lambda_') || AWS_LAMBDA_RUNTIME_API.length > 0;\n    const isAzureFaaS = FUNCTIONS_WORKER_RUNTIME.length > 0;\n    const isGCPFaaS = K_SERVICE.length > 0 || FUNCTION_NAME.length > 0;\n    const isVercelFaaS = VERCEL.length > 0;\n    // Note: order matters, name must always be the last key\n    const faasEnv = new Map();\n    // When isVercelFaaS is true so is isAWSFaaS; Vercel inherits the AWS env\n    if (isVercelFaaS && !(isAzureFaaS || isGCPFaaS)) {\n        if (VERCEL_REGION.length > 0) {\n            faasEnv.set('region', VERCEL_REGION);\n        }\n        faasEnv.set('name', 'vercel');\n        return faasEnv;\n    }\n    if (isAWSFaaS && !(isAzureFaaS || isGCPFaaS || isVercelFaaS)) {\n        if (AWS_REGION.length > 0) {\n            faasEnv.set('region', AWS_REGION);\n        }\n        if (AWS_LAMBDA_FUNCTION_MEMORY_SIZE.length > 0 &&\n            Number.isInteger(+AWS_LAMBDA_FUNCTION_MEMORY_SIZE)) {\n            faasEnv.set('memory_mb', new bson_1.Int32(AWS_LAMBDA_FUNCTION_MEMORY_SIZE));\n        }\n        faasEnv.set('name', 'aws.lambda');\n        return faasEnv;\n    }\n    if (isAzureFaaS && !(isGCPFaaS || isAWSFaaS || isVercelFaaS)) {\n        faasEnv.set('name', 'azure.func');\n        return faasEnv;\n    }\n    if (isGCPFaaS && !(isAzureFaaS || isAWSFaaS || isVercelFaaS)) {\n        if (FUNCTION_REGION.length > 0) {\n            faasEnv.set('region', FUNCTION_REGION);\n        }\n        if (FUNCTION_MEMORY_MB.length > 0 && Number.isInteger(+FUNCTION_MEMORY_MB)) {\n            faasEnv.set('memory_mb', new bson_1.Int32(FUNCTION_MEMORY_MB));\n        }\n        if (FUNCTION_TIMEOUT_SEC.length > 0 && Number.isInteger(+FUNCTION_TIMEOUT_SEC)) {\n            faasEnv.set('timeout_sec', new bson_1.Int32(FUNCTION_TIMEOUT_SEC));\n        }\n        faasEnv.set('name', 'gcp.func');\n        return faasEnv;\n    }\n    return null;\n}\nexports.getFAASEnv = getFAASEnv;\n/**\n * @internal\n * Get current JavaScript runtime platform\n *\n * NOTE: The version information fetching is intentionally written defensively\n * to avoid having a released driver version that becomes incompatible\n * with a future change to these global objects.\n */\nfunction getRuntimeInfo() {\n    if ('Deno' in globalThis) {\n        const version = typeof Deno?.version?.deno === 'string' ? Deno?.version?.deno : '0.0.0-unknown';\n        return `Deno v${version}, ${os.endianness()}`;\n    }\n    if ('Bun' in globalThis) {\n        const version = typeof Bun?.version === 'string' ? Bun?.version : '0.0.0-unknown';\n        return `Bun v${version}, ${os.endianness()}`;\n    }\n    return `Node.js ${process.version}, ${os.endianness()}`;\n}\n//# sourceMappingURL=client_metadata.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jbWFwL2hhbmRzaGFrZS9jbGllbnRfbWV0YWRhdGEuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0Qsa0JBQWtCLEdBQUcsMEJBQTBCLEdBQUcsMkJBQTJCO0FBQzdFLFdBQVcsbUJBQU8sQ0FBQyxjQUFJO0FBQ3ZCLGdCQUFnQixtQkFBTyxDQUFDLHdCQUFTO0FBQ2pDLGVBQWUsbUJBQU8sQ0FBQyxvRUFBWTtBQUNuQyxnQkFBZ0IsbUJBQU8sQ0FBQyxzRUFBYTtBQUNyQztBQUNBLDRCQUE0QiwrR0FBd0M7QUFDcEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsMkJBQTJCO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxlQUFlO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5REFBeUQsTUFBTTtBQUMvRDtBQUNBLFlBQVkseUNBQXlDO0FBQ3JEO0FBQ0EsMENBQTBDLEtBQUs7QUFDL0MseUNBQXlDLG9CQUFvQixHQUFHLFFBQVE7QUFDeEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCLFlBQVksR0FBRyxTQUFTO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQjtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSwyUkFBMlI7QUFDdlM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0RBQWtEO0FBQ2xEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsUUFBUSxJQUFJLGdCQUFnQjtBQUNwRDtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsUUFBUSxJQUFJLGdCQUFnQjtBQUNuRDtBQUNBLHNCQUFzQixnQkFBZ0IsSUFBSSxnQkFBZ0I7QUFDMUQ7QUFDQSIsInNvdXJjZXMiOlsiRDpcXHNhbG9uaVxcYXBwcmFpc2FsLXN5c3RlbVxcc2VydmVyXFxub2RlX21vZHVsZXNcXG1vbmdvZGJcXGxpYlxcY21hcFxcaGFuZHNoYWtlXFxjbGllbnRfbWV0YWRhdGEuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmdldEZBQVNFbnYgPSBleHBvcnRzLm1ha2VDbGllbnRNZXRhZGF0YSA9IGV4cG9ydHMuTGltaXRlZFNpemVEb2N1bWVudCA9IHZvaWQgMDtcbmNvbnN0IG9zID0gcmVxdWlyZShcIm9zXCIpO1xuY29uc3QgcHJvY2VzcyA9IHJlcXVpcmUoXCJwcm9jZXNzXCIpO1xuY29uc3QgYnNvbl8xID0gcmVxdWlyZShcIi4uLy4uL2Jzb25cIik7XG5jb25zdCBlcnJvcl8xID0gcmVxdWlyZShcIi4uLy4uL2Vycm9yXCIpO1xuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby12YXItcmVxdWlyZXNcbmNvbnN0IE5PREVfRFJJVkVSX1ZFUlNJT04gPSByZXF1aXJlKCcuLi8uLi8uLi9wYWNrYWdlLmpzb24nKS52ZXJzaW9uO1xuLyoqIEBpbnRlcm5hbCAqL1xuY2xhc3MgTGltaXRlZFNpemVEb2N1bWVudCB7XG4gICAgY29uc3RydWN0b3IobWF4U2l6ZSkge1xuICAgICAgICB0aGlzLm1heFNpemUgPSBtYXhTaXplO1xuICAgICAgICB0aGlzLmRvY3VtZW50ID0gbmV3IE1hcCgpO1xuICAgICAgICAvKiogQlNPTiBvdmVyaGVhZDogSW50MzIgKyBOdWxsIGJ5dGUgKi9cbiAgICAgICAgdGhpcy5kb2N1bWVudFNpemUgPSA1O1xuICAgIH1cbiAgICAvKiogT25seSBhZGRzIGtleS92YWx1ZSBpZiB0aGUgYnNvbkJ5dGVMZW5ndGggaXMgbGVzcyB0aGFuIE1BWF9TSVpFICovXG4gICAgaWZJdEZpdHNJdFNpdHMoa2V5LCB2YWx1ZSkge1xuICAgICAgICAvLyBUaGUgQlNPTiBieXRlTGVuZ3RoIG9mIHRoZSBuZXcgZWxlbWVudCBpcyB0aGUgc2FtZSBhcyBzZXJpYWxpemluZyBpdCB0byBpdHMgb3duIGRvY3VtZW50XG4gICAgICAgIC8vIHN1YnRyYWN0aW5nIHRoZSBkb2N1bWVudCBzaXplIGludDMyIGFuZCB0aGUgbnVsbCB0ZXJtaW5hdG9yLlxuICAgICAgICBjb25zdCBuZXdFbGVtZW50U2l6ZSA9IGJzb25fMS5CU09OLnNlcmlhbGl6ZShuZXcgTWFwKCkuc2V0KGtleSwgdmFsdWUpKS5ieXRlTGVuZ3RoIC0gNTtcbiAgICAgICAgaWYgKG5ld0VsZW1lbnRTaXplICsgdGhpcy5kb2N1bWVudFNpemUgPiB0aGlzLm1heFNpemUpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmRvY3VtZW50U2l6ZSArPSBuZXdFbGVtZW50U2l6ZTtcbiAgICAgICAgdGhpcy5kb2N1bWVudC5zZXQoa2V5LCB2YWx1ZSk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICB0b09iamVjdCgpIHtcbiAgICAgICAgcmV0dXJuIGJzb25fMS5CU09OLmRlc2VyaWFsaXplKGJzb25fMS5CU09OLnNlcmlhbGl6ZSh0aGlzLmRvY3VtZW50KSwge1xuICAgICAgICAgICAgcHJvbW90ZUxvbmdzOiBmYWxzZSxcbiAgICAgICAgICAgIHByb21vdGVCdWZmZXJzOiBmYWxzZSxcbiAgICAgICAgICAgIHByb21vdGVWYWx1ZXM6IGZhbHNlLFxuICAgICAgICAgICAgdXNlQmlnSW50NjQ6IGZhbHNlXG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmV4cG9ydHMuTGltaXRlZFNpemVEb2N1bWVudCA9IExpbWl0ZWRTaXplRG9jdW1lbnQ7XG4vKipcbiAqIEZyb20gdGhlIHNwZWNzOlxuICogSW1wbGVtZW50b3JzIFNIT1VMRCBjdW11bGF0aXZlbHkgdXBkYXRlIGZpZWxkcyBpbiB0aGUgZm9sbG93aW5nIG9yZGVyIHVudGlsIHRoZSBkb2N1bWVudCBpcyB1bmRlciB0aGUgc2l6ZSBsaW1pdDpcbiAqIDEuIE9taXQgZmllbGRzIGZyb20gYGVudmAgZXhjZXB0IGBlbnYubmFtZWAuXG4gKiAyLiBPbWl0IGZpZWxkcyBmcm9tIGBvc2AgZXhjZXB0IGBvcy50eXBlYC5cbiAqIDMuIE9taXQgdGhlIGBlbnZgIGRvY3VtZW50IGVudGlyZWx5LlxuICogNC4gVHJ1bmNhdGUgYHBsYXRmb3JtYC4gLS0gc3BlY2lhbCB3ZSBkbyBub3QgdHJ1bmNhdGUgdGhpcyBmaWVsZFxuICovXG5mdW5jdGlvbiBtYWtlQ2xpZW50TWV0YWRhdGEob3B0aW9ucykge1xuICAgIGNvbnN0IG1ldGFkYXRhRG9jdW1lbnQgPSBuZXcgTGltaXRlZFNpemVEb2N1bWVudCg1MTIpO1xuICAgIGNvbnN0IHsgYXBwTmFtZSA9ICcnIH0gPSBvcHRpb25zO1xuICAgIC8vIEFkZCBhcHAgbmFtZSBmaXJzdCwgaXQgbXVzdCBiZSBzZW50XG4gICAgaWYgKGFwcE5hbWUubGVuZ3RoID4gMCkge1xuICAgICAgICBjb25zdCBuYW1lID0gQnVmZmVyLmJ5dGVMZW5ndGgoYXBwTmFtZSwgJ3V0ZjgnKSA8PSAxMjhcbiAgICAgICAgICAgID8gb3B0aW9ucy5hcHBOYW1lXG4gICAgICAgICAgICA6IEJ1ZmZlci5mcm9tKGFwcE5hbWUsICd1dGY4Jykuc3ViYXJyYXkoMCwgMTI4KS50b1N0cmluZygndXRmOCcpO1xuICAgICAgICBtZXRhZGF0YURvY3VtZW50LmlmSXRGaXRzSXRTaXRzKCdhcHBsaWNhdGlvbicsIHsgbmFtZSB9KTtcbiAgICB9XG4gICAgY29uc3QgeyBuYW1lID0gJycsIHZlcnNpb24gPSAnJywgcGxhdGZvcm0gPSAnJyB9ID0gb3B0aW9ucy5kcml2ZXJJbmZvO1xuICAgIGNvbnN0IGRyaXZlckluZm8gPSB7XG4gICAgICAgIG5hbWU6IG5hbWUubGVuZ3RoID4gMCA/IGBub2RlanN8JHtuYW1lfWAgOiAnbm9kZWpzJyxcbiAgICAgICAgdmVyc2lvbjogdmVyc2lvbi5sZW5ndGggPiAwID8gYCR7Tk9ERV9EUklWRVJfVkVSU0lPTn18JHt2ZXJzaW9ufWAgOiBOT0RFX0RSSVZFUl9WRVJTSU9OXG4gICAgfTtcbiAgICBpZiAoIW1ldGFkYXRhRG9jdW1lbnQuaWZJdEZpdHNJdFNpdHMoJ2RyaXZlcicsIGRyaXZlckluZm8pKSB7XG4gICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoJ1VuYWJsZSB0byBpbmNsdWRlIGRyaXZlckluZm8gbmFtZSBhbmQgdmVyc2lvbiwgbWV0YWRhdGEgY2Fubm90IGV4Y2VlZCA1MTIgYnl0ZXMnKTtcbiAgICB9XG4gICAgbGV0IHJ1bnRpbWVJbmZvID0gZ2V0UnVudGltZUluZm8oKTtcbiAgICBpZiAocGxhdGZvcm0ubGVuZ3RoID4gMCkge1xuICAgICAgICBydW50aW1lSW5mbyA9IGAke3J1bnRpbWVJbmZvfXwke3BsYXRmb3JtfWA7XG4gICAgfVxuICAgIGlmICghbWV0YWRhdGFEb2N1bWVudC5pZkl0Rml0c0l0U2l0cygncGxhdGZvcm0nLCBydW50aW1lSW5mbykpIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignVW5hYmxlIHRvIGluY2x1ZGUgZHJpdmVySW5mbyBwbGF0Zm9ybSwgbWV0YWRhdGEgY2Fubm90IGV4Y2VlZCA1MTIgYnl0ZXMnKTtcbiAgICB9XG4gICAgLy8gTm90ZTogb3JkZXIgbWF0dGVycywgb3MudHlwZSBpcyBsYXN0IHNvIGl0IHdpbGwgYmUgcmVtb3ZlZCBsYXN0IGlmIHdlJ3JlIGF0IG1heFNpemVcbiAgICBjb25zdCBvc0luZm8gPSBuZXcgTWFwKClcbiAgICAgICAgLnNldCgnbmFtZScsIHByb2Nlc3MucGxhdGZvcm0pXG4gICAgICAgIC5zZXQoJ2FyY2hpdGVjdHVyZScsIHByb2Nlc3MuYXJjaClcbiAgICAgICAgLnNldCgndmVyc2lvbicsIG9zLnJlbGVhc2UoKSlcbiAgICAgICAgLnNldCgndHlwZScsIG9zLnR5cGUoKSk7XG4gICAgaWYgKCFtZXRhZGF0YURvY3VtZW50LmlmSXRGaXRzSXRTaXRzKCdvcycsIG9zSW5mbykpIHtcbiAgICAgICAgZm9yIChjb25zdCBrZXkgb2Ygb3NJbmZvLmtleXMoKSkge1xuICAgICAgICAgICAgb3NJbmZvLmRlbGV0ZShrZXkpO1xuICAgICAgICAgICAgaWYgKG9zSW5mby5zaXplID09PSAwKVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgaWYgKG1ldGFkYXRhRG9jdW1lbnQuaWZJdEZpdHNJdFNpdHMoJ29zJywgb3NJbmZvKSlcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH1cbiAgICBjb25zdCBmYWFzRW52ID0gZ2V0RkFBU0VudigpO1xuICAgIGlmIChmYWFzRW52ICE9IG51bGwpIHtcbiAgICAgICAgaWYgKCFtZXRhZGF0YURvY3VtZW50LmlmSXRGaXRzSXRTaXRzKCdlbnYnLCBmYWFzRW52KSkge1xuICAgICAgICAgICAgZm9yIChjb25zdCBrZXkgb2YgZmFhc0Vudi5rZXlzKCkpIHtcbiAgICAgICAgICAgICAgICBmYWFzRW52LmRlbGV0ZShrZXkpO1xuICAgICAgICAgICAgICAgIGlmIChmYWFzRW52LnNpemUgPT09IDApXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGlmIChtZXRhZGF0YURvY3VtZW50LmlmSXRGaXRzSXRTaXRzKCdlbnYnLCBmYWFzRW52KSlcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG1ldGFkYXRhRG9jdW1lbnQudG9PYmplY3QoKTtcbn1cbmV4cG9ydHMubWFrZUNsaWVudE1ldGFkYXRhID0gbWFrZUNsaWVudE1ldGFkYXRhO1xuLyoqXG4gKiBDb2xsZWN0cyBGYWFTIG1ldGFkYXRhLlxuICogLSBgbmFtZWAgTVVTVCBiZSB0aGUgbGFzdCBrZXkgaW4gdGhlIE1hcCByZXR1cm5lZC5cbiAqL1xuZnVuY3Rpb24gZ2V0RkFBU0VudigpIHtcbiAgICBjb25zdCB7IEFXU19FWEVDVVRJT05fRU5WID0gJycsIEFXU19MQU1CREFfUlVOVElNRV9BUEkgPSAnJywgRlVOQ1RJT05TX1dPUktFUl9SVU5USU1FID0gJycsIEtfU0VSVklDRSA9ICcnLCBGVU5DVElPTl9OQU1FID0gJycsIFZFUkNFTCA9ICcnLCBBV1NfTEFNQkRBX0ZVTkNUSU9OX01FTU9SWV9TSVpFID0gJycsIEFXU19SRUdJT04gPSAnJywgRlVOQ1RJT05fTUVNT1JZX01CID0gJycsIEZVTkNUSU9OX1JFR0lPTiA9ICcnLCBGVU5DVElPTl9USU1FT1VUX1NFQyA9ICcnLCBWRVJDRUxfUkVHSU9OID0gJycgfSA9IHByb2Nlc3MuZW52O1xuICAgIGNvbnN0IGlzQVdTRmFhUyA9IEFXU19FWEVDVVRJT05fRU5WLnN0YXJ0c1dpdGgoJ0FXU19MYW1iZGFfJykgfHwgQVdTX0xBTUJEQV9SVU5USU1FX0FQSS5sZW5ndGggPiAwO1xuICAgIGNvbnN0IGlzQXp1cmVGYWFTID0gRlVOQ1RJT05TX1dPUktFUl9SVU5USU1FLmxlbmd0aCA+IDA7XG4gICAgY29uc3QgaXNHQ1BGYWFTID0gS19TRVJWSUNFLmxlbmd0aCA+IDAgfHwgRlVOQ1RJT05fTkFNRS5sZW5ndGggPiAwO1xuICAgIGNvbnN0IGlzVmVyY2VsRmFhUyA9IFZFUkNFTC5sZW5ndGggPiAwO1xuICAgIC8vIE5vdGU6IG9yZGVyIG1hdHRlcnMsIG5hbWUgbXVzdCBhbHdheXMgYmUgdGhlIGxhc3Qga2V5XG4gICAgY29uc3QgZmFhc0VudiA9IG5ldyBNYXAoKTtcbiAgICAvLyBXaGVuIGlzVmVyY2VsRmFhUyBpcyB0cnVlIHNvIGlzIGlzQVdTRmFhUzsgVmVyY2VsIGluaGVyaXRzIHRoZSBBV1MgZW52XG4gICAgaWYgKGlzVmVyY2VsRmFhUyAmJiAhKGlzQXp1cmVGYWFTIHx8IGlzR0NQRmFhUykpIHtcbiAgICAgICAgaWYgKFZFUkNFTF9SRUdJT04ubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgZmFhc0Vudi5zZXQoJ3JlZ2lvbicsIFZFUkNFTF9SRUdJT04pO1xuICAgICAgICB9XG4gICAgICAgIGZhYXNFbnYuc2V0KCduYW1lJywgJ3ZlcmNlbCcpO1xuICAgICAgICByZXR1cm4gZmFhc0VudjtcbiAgICB9XG4gICAgaWYgKGlzQVdTRmFhUyAmJiAhKGlzQXp1cmVGYWFTIHx8IGlzR0NQRmFhUyB8fCBpc1ZlcmNlbEZhYVMpKSB7XG4gICAgICAgIGlmIChBV1NfUkVHSU9OLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGZhYXNFbnYuc2V0KCdyZWdpb24nLCBBV1NfUkVHSU9OKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoQVdTX0xBTUJEQV9GVU5DVElPTl9NRU1PUllfU0laRS5sZW5ndGggPiAwICYmXG4gICAgICAgICAgICBOdW1iZXIuaXNJbnRlZ2VyKCtBV1NfTEFNQkRBX0ZVTkNUSU9OX01FTU9SWV9TSVpFKSkge1xuICAgICAgICAgICAgZmFhc0Vudi5zZXQoJ21lbW9yeV9tYicsIG5ldyBic29uXzEuSW50MzIoQVdTX0xBTUJEQV9GVU5DVElPTl9NRU1PUllfU0laRSkpO1xuICAgICAgICB9XG4gICAgICAgIGZhYXNFbnYuc2V0KCduYW1lJywgJ2F3cy5sYW1iZGEnKTtcbiAgICAgICAgcmV0dXJuIGZhYXNFbnY7XG4gICAgfVxuICAgIGlmIChpc0F6dXJlRmFhUyAmJiAhKGlzR0NQRmFhUyB8fCBpc0FXU0ZhYVMgfHwgaXNWZXJjZWxGYWFTKSkge1xuICAgICAgICBmYWFzRW52LnNldCgnbmFtZScsICdhenVyZS5mdW5jJyk7XG4gICAgICAgIHJldHVybiBmYWFzRW52O1xuICAgIH1cbiAgICBpZiAoaXNHQ1BGYWFTICYmICEoaXNBenVyZUZhYVMgfHwgaXNBV1NGYWFTIHx8IGlzVmVyY2VsRmFhUykpIHtcbiAgICAgICAgaWYgKEZVTkNUSU9OX1JFR0lPTi5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBmYWFzRW52LnNldCgncmVnaW9uJywgRlVOQ1RJT05fUkVHSU9OKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoRlVOQ1RJT05fTUVNT1JZX01CLmxlbmd0aCA+IDAgJiYgTnVtYmVyLmlzSW50ZWdlcigrRlVOQ1RJT05fTUVNT1JZX01CKSkge1xuICAgICAgICAgICAgZmFhc0Vudi5zZXQoJ21lbW9yeV9tYicsIG5ldyBic29uXzEuSW50MzIoRlVOQ1RJT05fTUVNT1JZX01CKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKEZVTkNUSU9OX1RJTUVPVVRfU0VDLmxlbmd0aCA+IDAgJiYgTnVtYmVyLmlzSW50ZWdlcigrRlVOQ1RJT05fVElNRU9VVF9TRUMpKSB7XG4gICAgICAgICAgICBmYWFzRW52LnNldCgndGltZW91dF9zZWMnLCBuZXcgYnNvbl8xLkludDMyKEZVTkNUSU9OX1RJTUVPVVRfU0VDKSk7XG4gICAgICAgIH1cbiAgICAgICAgZmFhc0Vudi5zZXQoJ25hbWUnLCAnZ2NwLmZ1bmMnKTtcbiAgICAgICAgcmV0dXJuIGZhYXNFbnY7XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xufVxuZXhwb3J0cy5nZXRGQUFTRW52ID0gZ2V0RkFBU0Vudjtcbi8qKlxuICogQGludGVybmFsXG4gKiBHZXQgY3VycmVudCBKYXZhU2NyaXB0IHJ1bnRpbWUgcGxhdGZvcm1cbiAqXG4gKiBOT1RFOiBUaGUgdmVyc2lvbiBpbmZvcm1hdGlvbiBmZXRjaGluZyBpcyBpbnRlbnRpb25hbGx5IHdyaXR0ZW4gZGVmZW5zaXZlbHlcbiAqIHRvIGF2b2lkIGhhdmluZyBhIHJlbGVhc2VkIGRyaXZlciB2ZXJzaW9uIHRoYXQgYmVjb21lcyBpbmNvbXBhdGlibGVcbiAqIHdpdGggYSBmdXR1cmUgY2hhbmdlIHRvIHRoZXNlIGdsb2JhbCBvYmplY3RzLlxuICovXG5mdW5jdGlvbiBnZXRSdW50aW1lSW5mbygpIHtcbiAgICBpZiAoJ0Rlbm8nIGluIGdsb2JhbFRoaXMpIHtcbiAgICAgICAgY29uc3QgdmVyc2lvbiA9IHR5cGVvZiBEZW5vPy52ZXJzaW9uPy5kZW5vID09PSAnc3RyaW5nJyA/IERlbm8/LnZlcnNpb24/LmRlbm8gOiAnMC4wLjAtdW5rbm93bic7XG4gICAgICAgIHJldHVybiBgRGVubyB2JHt2ZXJzaW9ufSwgJHtvcy5lbmRpYW5uZXNzKCl9YDtcbiAgICB9XG4gICAgaWYgKCdCdW4nIGluIGdsb2JhbFRoaXMpIHtcbiAgICAgICAgY29uc3QgdmVyc2lvbiA9IHR5cGVvZiBCdW4/LnZlcnNpb24gPT09ICdzdHJpbmcnID8gQnVuPy52ZXJzaW9uIDogJzAuMC4wLXVua25vd24nO1xuICAgICAgICByZXR1cm4gYEJ1biB2JHt2ZXJzaW9ufSwgJHtvcy5lbmRpYW5uZXNzKCl9YDtcbiAgICB9XG4gICAgcmV0dXJuIGBOb2RlLmpzICR7cHJvY2Vzcy52ZXJzaW9ufSwgJHtvcy5lbmRpYW5uZXNzKCl9YDtcbn1cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWNsaWVudF9tZXRhZGF0YS5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/cmap/handshake/client_metadata.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/cmap/message_stream.js":
/*!*****************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/cmap/message_stream.js ***!
  \*****************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.MessageStream = void 0;\nconst stream_1 = __webpack_require__(/*! stream */ \"stream\");\nconst error_1 = __webpack_require__(/*! ../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\nconst commands_1 = __webpack_require__(/*! ./commands */ \"(api)/../server/node_modules/mongodb/lib/cmap/commands.js\");\nconst compression_1 = __webpack_require__(/*! ./wire_protocol/compression */ \"(api)/../server/node_modules/mongodb/lib/cmap/wire_protocol/compression.js\");\nconst constants_1 = __webpack_require__(/*! ./wire_protocol/constants */ \"(api)/../server/node_modules/mongodb/lib/cmap/wire_protocol/constants.js\");\nconst MESSAGE_HEADER_SIZE = 16;\nconst COMPRESSION_DETAILS_SIZE = 9; // originalOpcode + uncompressedSize, compressorID\nconst kDefaultMaxBsonMessageSize = 1024 * 1024 * 16 * 4;\n/** @internal */\nconst kBuffer = Symbol('buffer');\n/**\n * A duplex stream that is capable of reading and writing raw wire protocol messages, with\n * support for optional compression\n * @internal\n */\nclass MessageStream extends stream_1.Duplex {\n    constructor(options = {}) {\n        super(options);\n        /** @internal */\n        this.isMonitoringConnection = false;\n        this.maxBsonMessageSize = options.maxBsonMessageSize || kDefaultMaxBsonMessageSize;\n        this[kBuffer] = new utils_1.BufferPool();\n    }\n    get buffer() {\n        return this[kBuffer];\n    }\n    _write(chunk, _, callback) {\n        this[kBuffer].append(chunk);\n        processIncomingData(this, callback);\n    }\n    _read( /* size */) {\n        // NOTE: This implementation is empty because we explicitly push data to be read\n        //       when `writeMessage` is called.\n        return;\n    }\n    writeCommand(command, operationDescription) {\n        const agreedCompressor = operationDescription.agreedCompressor ?? 'none';\n        if (agreedCompressor === 'none' || !canCompress(command)) {\n            const data = command.toBin();\n            this.push(Array.isArray(data) ? Buffer.concat(data) : data);\n            return;\n        }\n        // otherwise, compress the message\n        const concatenatedOriginalCommandBuffer = Buffer.concat(command.toBin());\n        const messageToBeCompressed = concatenatedOriginalCommandBuffer.slice(MESSAGE_HEADER_SIZE);\n        // Extract information needed for OP_COMPRESSED from the uncompressed message\n        const originalCommandOpCode = concatenatedOriginalCommandBuffer.readInt32LE(12);\n        const options = {\n            agreedCompressor,\n            zlibCompressionLevel: operationDescription.zlibCompressionLevel ?? 0\n        };\n        // Compress the message body\n        (0, compression_1.compress)(options, messageToBeCompressed).then(compressedMessage => {\n            // Create the msgHeader of OP_COMPRESSED\n            const msgHeader = Buffer.alloc(MESSAGE_HEADER_SIZE);\n            msgHeader.writeInt32LE(MESSAGE_HEADER_SIZE + COMPRESSION_DETAILS_SIZE + compressedMessage.length, 0); // messageLength\n            msgHeader.writeInt32LE(command.requestId, 4); // requestID\n            msgHeader.writeInt32LE(0, 8); // responseTo (zero)\n            msgHeader.writeInt32LE(constants_1.OP_COMPRESSED, 12); // opCode\n            // Create the compression details of OP_COMPRESSED\n            const compressionDetails = Buffer.alloc(COMPRESSION_DETAILS_SIZE);\n            compressionDetails.writeInt32LE(originalCommandOpCode, 0); // originalOpcode\n            compressionDetails.writeInt32LE(messageToBeCompressed.length, 4); // Size of the uncompressed compressedMessage, excluding the MsgHeader\n            compressionDetails.writeUInt8(compression_1.Compressor[agreedCompressor], 8); // compressorID\n            this.push(Buffer.concat([msgHeader, compressionDetails, compressedMessage]));\n        }, error => {\n            operationDescription.cb(error);\n        });\n    }\n}\nexports.MessageStream = MessageStream;\n// Return whether a command contains an uncompressible command term\n// Will return true if command contains no uncompressible command terms\nfunction canCompress(command) {\n    const commandDoc = command instanceof commands_1.Msg ? command.command : command.query;\n    const commandName = Object.keys(commandDoc)[0];\n    return !compression_1.uncompressibleCommands.has(commandName);\n}\nfunction processIncomingData(stream, callback) {\n    const buffer = stream[kBuffer];\n    const sizeOfMessage = buffer.getInt32();\n    if (sizeOfMessage == null) {\n        return callback();\n    }\n    if (sizeOfMessage < 0) {\n        return callback(new error_1.MongoParseError(`Invalid message size: ${sizeOfMessage}`));\n    }\n    if (sizeOfMessage > stream.maxBsonMessageSize) {\n        return callback(new error_1.MongoParseError(`Invalid message size: ${sizeOfMessage}, max allowed: ${stream.maxBsonMessageSize}`));\n    }\n    if (sizeOfMessage > buffer.length) {\n        return callback();\n    }\n    const message = buffer.read(sizeOfMessage);\n    const messageHeader = {\n        length: message.readInt32LE(0),\n        requestId: message.readInt32LE(4),\n        responseTo: message.readInt32LE(8),\n        opCode: message.readInt32LE(12)\n    };\n    const monitorHasAnotherHello = () => {\n        if (stream.isMonitoringConnection) {\n            // Can we read the next message size?\n            const sizeOfMessage = buffer.getInt32();\n            if (sizeOfMessage != null && sizeOfMessage <= buffer.length) {\n                return true;\n            }\n        }\n        return false;\n    };\n    let ResponseType = messageHeader.opCode === constants_1.OP_MSG ? commands_1.BinMsg : commands_1.Response;\n    if (messageHeader.opCode !== constants_1.OP_COMPRESSED) {\n        const messageBody = message.subarray(MESSAGE_HEADER_SIZE);\n        // If we are a monitoring connection message stream and\n        // there is more in the buffer that can be read, skip processing since we\n        // want the last hello command response that is in the buffer.\n        if (monitorHasAnotherHello()) {\n            return processIncomingData(stream, callback);\n        }\n        stream.emit('message', new ResponseType(message, messageHeader, messageBody));\n        if (buffer.length >= 4) {\n            return processIncomingData(stream, callback);\n        }\n        return callback();\n    }\n    messageHeader.fromCompressed = true;\n    messageHeader.opCode = message.readInt32LE(MESSAGE_HEADER_SIZE);\n    messageHeader.length = message.readInt32LE(MESSAGE_HEADER_SIZE + 4);\n    const compressorID = message[MESSAGE_HEADER_SIZE + 8];\n    const compressedBuffer = message.slice(MESSAGE_HEADER_SIZE + 9);\n    // recalculate based on wrapped opcode\n    ResponseType = messageHeader.opCode === constants_1.OP_MSG ? commands_1.BinMsg : commands_1.Response;\n    (0, compression_1.decompress)(compressorID, compressedBuffer).then(messageBody => {\n        if (messageBody.length !== messageHeader.length) {\n            return callback(new error_1.MongoDecompressionError('Message body and message header must be the same length'));\n        }\n        // If we are a monitoring connection message stream and\n        // there is more in the buffer that can be read, skip processing since we\n        // want the last hello command response that is in the buffer.\n        if (monitorHasAnotherHello()) {\n            return processIncomingData(stream, callback);\n        }\n        stream.emit('message', new ResponseType(message, messageHeader, messageBody));\n        if (buffer.length >= 4) {\n            return processIncomingData(stream, callback);\n        }\n        return callback();\n    }, error => {\n        return callback(error);\n    });\n}\n//# sourceMappingURL=message_stream.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jbWFwL21lc3NhZ2Vfc3RyZWFtLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELHFCQUFxQjtBQUNyQixpQkFBaUIsbUJBQU8sQ0FBQyxzQkFBUTtBQUNqQyxnQkFBZ0IsbUJBQU8sQ0FBQyxtRUFBVTtBQUNsQyxnQkFBZ0IsbUJBQU8sQ0FBQyxtRUFBVTtBQUNsQyxtQkFBbUIsbUJBQU8sQ0FBQyw2RUFBWTtBQUN2QyxzQkFBc0IsbUJBQU8sQ0FBQywrR0FBNkI7QUFDM0Qsb0JBQW9CLG1CQUFPLENBQUMsMkdBQTJCO0FBQ3ZEO0FBQ0Esb0NBQW9DO0FBQ3BDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QjtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0hBQWtIO0FBQ2xILDBEQUEwRDtBQUMxRCwwQ0FBMEM7QUFDMUMsbUVBQW1FO0FBQ25FO0FBQ0E7QUFDQSx1RUFBdUU7QUFDdkUsOEVBQThFO0FBQzlFLDBGQUEwRjtBQUMxRjtBQUNBLFNBQVM7QUFDVDtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2RUFBNkUsY0FBYztBQUMzRjtBQUNBO0FBQ0EsNkVBQTZFLGNBQWMsaUJBQWlCLDBCQUEwQjtBQUN0STtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLEtBQUs7QUFDTDtBQUNBIiwic291cmNlcyI6WyJEOlxcc2Fsb25pXFxhcHByYWlzYWwtc3lzdGVtXFxzZXJ2ZXJcXG5vZGVfbW9kdWxlc1xcbW9uZ29kYlxcbGliXFxjbWFwXFxtZXNzYWdlX3N0cmVhbS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuTWVzc2FnZVN0cmVhbSA9IHZvaWQgMDtcbmNvbnN0IHN0cmVhbV8xID0gcmVxdWlyZShcInN0cmVhbVwiKTtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi4vZXJyb3JcIik7XG5jb25zdCB1dGlsc18xID0gcmVxdWlyZShcIi4uL3V0aWxzXCIpO1xuY29uc3QgY29tbWFuZHNfMSA9IHJlcXVpcmUoXCIuL2NvbW1hbmRzXCIpO1xuY29uc3QgY29tcHJlc3Npb25fMSA9IHJlcXVpcmUoXCIuL3dpcmVfcHJvdG9jb2wvY29tcHJlc3Npb25cIik7XG5jb25zdCBjb25zdGFudHNfMSA9IHJlcXVpcmUoXCIuL3dpcmVfcHJvdG9jb2wvY29uc3RhbnRzXCIpO1xuY29uc3QgTUVTU0FHRV9IRUFERVJfU0laRSA9IDE2O1xuY29uc3QgQ09NUFJFU1NJT05fREVUQUlMU19TSVpFID0gOTsgLy8gb3JpZ2luYWxPcGNvZGUgKyB1bmNvbXByZXNzZWRTaXplLCBjb21wcmVzc29ySURcbmNvbnN0IGtEZWZhdWx0TWF4QnNvbk1lc3NhZ2VTaXplID0gMTAyNCAqIDEwMjQgKiAxNiAqIDQ7XG4vKiogQGludGVybmFsICovXG5jb25zdCBrQnVmZmVyID0gU3ltYm9sKCdidWZmZXInKTtcbi8qKlxuICogQSBkdXBsZXggc3RyZWFtIHRoYXQgaXMgY2FwYWJsZSBvZiByZWFkaW5nIGFuZCB3cml0aW5nIHJhdyB3aXJlIHByb3RvY29sIG1lc3NhZ2VzLCB3aXRoXG4gKiBzdXBwb3J0IGZvciBvcHRpb25hbCBjb21wcmVzc2lvblxuICogQGludGVybmFsXG4gKi9cbmNsYXNzIE1lc3NhZ2VTdHJlYW0gZXh0ZW5kcyBzdHJlYW1fMS5EdXBsZXgge1xuICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMgPSB7fSkge1xuICAgICAgICBzdXBlcihvcHRpb25zKTtcbiAgICAgICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgICAgICB0aGlzLmlzTW9uaXRvcmluZ0Nvbm5lY3Rpb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5tYXhCc29uTWVzc2FnZVNpemUgPSBvcHRpb25zLm1heEJzb25NZXNzYWdlU2l6ZSB8fCBrRGVmYXVsdE1heEJzb25NZXNzYWdlU2l6ZTtcbiAgICAgICAgdGhpc1trQnVmZmVyXSA9IG5ldyB1dGlsc18xLkJ1ZmZlclBvb2woKTtcbiAgICB9XG4gICAgZ2V0IGJ1ZmZlcigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXNba0J1ZmZlcl07XG4gICAgfVxuICAgIF93cml0ZShjaHVuaywgXywgY2FsbGJhY2spIHtcbiAgICAgICAgdGhpc1trQnVmZmVyXS5hcHBlbmQoY2h1bmspO1xuICAgICAgICBwcm9jZXNzSW5jb21pbmdEYXRhKHRoaXMsIGNhbGxiYWNrKTtcbiAgICB9XG4gICAgX3JlYWQoIC8qIHNpemUgKi8pIHtcbiAgICAgICAgLy8gTk9URTogVGhpcyBpbXBsZW1lbnRhdGlvbiBpcyBlbXB0eSBiZWNhdXNlIHdlIGV4cGxpY2l0bHkgcHVzaCBkYXRhIHRvIGJlIHJlYWRcbiAgICAgICAgLy8gICAgICAgd2hlbiBgd3JpdGVNZXNzYWdlYCBpcyBjYWxsZWQuXG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgd3JpdGVDb21tYW5kKGNvbW1hbmQsIG9wZXJhdGlvbkRlc2NyaXB0aW9uKSB7XG4gICAgICAgIGNvbnN0IGFncmVlZENvbXByZXNzb3IgPSBvcGVyYXRpb25EZXNjcmlwdGlvbi5hZ3JlZWRDb21wcmVzc29yID8/ICdub25lJztcbiAgICAgICAgaWYgKGFncmVlZENvbXByZXNzb3IgPT09ICdub25lJyB8fCAhY2FuQ29tcHJlc3MoY29tbWFuZCkpIHtcbiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBjb21tYW5kLnRvQmluKCk7XG4gICAgICAgICAgICB0aGlzLnB1c2goQXJyYXkuaXNBcnJheShkYXRhKSA/IEJ1ZmZlci5jb25jYXQoZGF0YSkgOiBkYXRhKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyBvdGhlcndpc2UsIGNvbXByZXNzIHRoZSBtZXNzYWdlXG4gICAgICAgIGNvbnN0IGNvbmNhdGVuYXRlZE9yaWdpbmFsQ29tbWFuZEJ1ZmZlciA9IEJ1ZmZlci5jb25jYXQoY29tbWFuZC50b0JpbigpKTtcbiAgICAgICAgY29uc3QgbWVzc2FnZVRvQmVDb21wcmVzc2VkID0gY29uY2F0ZW5hdGVkT3JpZ2luYWxDb21tYW5kQnVmZmVyLnNsaWNlKE1FU1NBR0VfSEVBREVSX1NJWkUpO1xuICAgICAgICAvLyBFeHRyYWN0IGluZm9ybWF0aW9uIG5lZWRlZCBmb3IgT1BfQ09NUFJFU1NFRCBmcm9tIHRoZSB1bmNvbXByZXNzZWQgbWVzc2FnZVxuICAgICAgICBjb25zdCBvcmlnaW5hbENvbW1hbmRPcENvZGUgPSBjb25jYXRlbmF0ZWRPcmlnaW5hbENvbW1hbmRCdWZmZXIucmVhZEludDMyTEUoMTIpO1xuICAgICAgICBjb25zdCBvcHRpb25zID0ge1xuICAgICAgICAgICAgYWdyZWVkQ29tcHJlc3NvcixcbiAgICAgICAgICAgIHpsaWJDb21wcmVzc2lvbkxldmVsOiBvcGVyYXRpb25EZXNjcmlwdGlvbi56bGliQ29tcHJlc3Npb25MZXZlbCA/PyAwXG4gICAgICAgIH07XG4gICAgICAgIC8vIENvbXByZXNzIHRoZSBtZXNzYWdlIGJvZHlcbiAgICAgICAgKDAsIGNvbXByZXNzaW9uXzEuY29tcHJlc3MpKG9wdGlvbnMsIG1lc3NhZ2VUb0JlQ29tcHJlc3NlZCkudGhlbihjb21wcmVzc2VkTWVzc2FnZSA9PiB7XG4gICAgICAgICAgICAvLyBDcmVhdGUgdGhlIG1zZ0hlYWRlciBvZiBPUF9DT01QUkVTU0VEXG4gICAgICAgICAgICBjb25zdCBtc2dIZWFkZXIgPSBCdWZmZXIuYWxsb2MoTUVTU0FHRV9IRUFERVJfU0laRSk7XG4gICAgICAgICAgICBtc2dIZWFkZXIud3JpdGVJbnQzMkxFKE1FU1NBR0VfSEVBREVSX1NJWkUgKyBDT01QUkVTU0lPTl9ERVRBSUxTX1NJWkUgKyBjb21wcmVzc2VkTWVzc2FnZS5sZW5ndGgsIDApOyAvLyBtZXNzYWdlTGVuZ3RoXG4gICAgICAgICAgICBtc2dIZWFkZXIud3JpdGVJbnQzMkxFKGNvbW1hbmQucmVxdWVzdElkLCA0KTsgLy8gcmVxdWVzdElEXG4gICAgICAgICAgICBtc2dIZWFkZXIud3JpdGVJbnQzMkxFKDAsIDgpOyAvLyByZXNwb25zZVRvICh6ZXJvKVxuICAgICAgICAgICAgbXNnSGVhZGVyLndyaXRlSW50MzJMRShjb25zdGFudHNfMS5PUF9DT01QUkVTU0VELCAxMik7IC8vIG9wQ29kZVxuICAgICAgICAgICAgLy8gQ3JlYXRlIHRoZSBjb21wcmVzc2lvbiBkZXRhaWxzIG9mIE9QX0NPTVBSRVNTRURcbiAgICAgICAgICAgIGNvbnN0IGNvbXByZXNzaW9uRGV0YWlscyA9IEJ1ZmZlci5hbGxvYyhDT01QUkVTU0lPTl9ERVRBSUxTX1NJWkUpO1xuICAgICAgICAgICAgY29tcHJlc3Npb25EZXRhaWxzLndyaXRlSW50MzJMRShvcmlnaW5hbENvbW1hbmRPcENvZGUsIDApOyAvLyBvcmlnaW5hbE9wY29kZVxuICAgICAgICAgICAgY29tcHJlc3Npb25EZXRhaWxzLndyaXRlSW50MzJMRShtZXNzYWdlVG9CZUNvbXByZXNzZWQubGVuZ3RoLCA0KTsgLy8gU2l6ZSBvZiB0aGUgdW5jb21wcmVzc2VkIGNvbXByZXNzZWRNZXNzYWdlLCBleGNsdWRpbmcgdGhlIE1zZ0hlYWRlclxuICAgICAgICAgICAgY29tcHJlc3Npb25EZXRhaWxzLndyaXRlVUludDgoY29tcHJlc3Npb25fMS5Db21wcmVzc29yW2FncmVlZENvbXByZXNzb3JdLCA4KTsgLy8gY29tcHJlc3NvcklEXG4gICAgICAgICAgICB0aGlzLnB1c2goQnVmZmVyLmNvbmNhdChbbXNnSGVhZGVyLCBjb21wcmVzc2lvbkRldGFpbHMsIGNvbXByZXNzZWRNZXNzYWdlXSkpO1xuICAgICAgICB9LCBlcnJvciA9PiB7XG4gICAgICAgICAgICBvcGVyYXRpb25EZXNjcmlwdGlvbi5jYihlcnJvcik7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmV4cG9ydHMuTWVzc2FnZVN0cmVhbSA9IE1lc3NhZ2VTdHJlYW07XG4vLyBSZXR1cm4gd2hldGhlciBhIGNvbW1hbmQgY29udGFpbnMgYW4gdW5jb21wcmVzc2libGUgY29tbWFuZCB0ZXJtXG4vLyBXaWxsIHJldHVybiB0cnVlIGlmIGNvbW1hbmQgY29udGFpbnMgbm8gdW5jb21wcmVzc2libGUgY29tbWFuZCB0ZXJtc1xuZnVuY3Rpb24gY2FuQ29tcHJlc3MoY29tbWFuZCkge1xuICAgIGNvbnN0IGNvbW1hbmREb2MgPSBjb21tYW5kIGluc3RhbmNlb2YgY29tbWFuZHNfMS5Nc2cgPyBjb21tYW5kLmNvbW1hbmQgOiBjb21tYW5kLnF1ZXJ5O1xuICAgIGNvbnN0IGNvbW1hbmROYW1lID0gT2JqZWN0LmtleXMoY29tbWFuZERvYylbMF07XG4gICAgcmV0dXJuICFjb21wcmVzc2lvbl8xLnVuY29tcHJlc3NpYmxlQ29tbWFuZHMuaGFzKGNvbW1hbmROYW1lKTtcbn1cbmZ1bmN0aW9uIHByb2Nlc3NJbmNvbWluZ0RhdGEoc3RyZWFtLCBjYWxsYmFjaykge1xuICAgIGNvbnN0IGJ1ZmZlciA9IHN0cmVhbVtrQnVmZmVyXTtcbiAgICBjb25zdCBzaXplT2ZNZXNzYWdlID0gYnVmZmVyLmdldEludDMyKCk7XG4gICAgaWYgKHNpemVPZk1lc3NhZ2UgPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gY2FsbGJhY2soKTtcbiAgICB9XG4gICAgaWYgKHNpemVPZk1lc3NhZ2UgPCAwKSB7XG4gICAgICAgIHJldHVybiBjYWxsYmFjayhuZXcgZXJyb3JfMS5Nb25nb1BhcnNlRXJyb3IoYEludmFsaWQgbWVzc2FnZSBzaXplOiAke3NpemVPZk1lc3NhZ2V9YCkpO1xuICAgIH1cbiAgICBpZiAoc2l6ZU9mTWVzc2FnZSA+IHN0cmVhbS5tYXhCc29uTWVzc2FnZVNpemUpIHtcbiAgICAgICAgcmV0dXJuIGNhbGxiYWNrKG5ldyBlcnJvcl8xLk1vbmdvUGFyc2VFcnJvcihgSW52YWxpZCBtZXNzYWdlIHNpemU6ICR7c2l6ZU9mTWVzc2FnZX0sIG1heCBhbGxvd2VkOiAke3N0cmVhbS5tYXhCc29uTWVzc2FnZVNpemV9YCkpO1xuICAgIH1cbiAgICBpZiAoc2l6ZU9mTWVzc2FnZSA+IGJ1ZmZlci5sZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIGNhbGxiYWNrKCk7XG4gICAgfVxuICAgIGNvbnN0IG1lc3NhZ2UgPSBidWZmZXIucmVhZChzaXplT2ZNZXNzYWdlKTtcbiAgICBjb25zdCBtZXNzYWdlSGVhZGVyID0ge1xuICAgICAgICBsZW5ndGg6IG1lc3NhZ2UucmVhZEludDMyTEUoMCksXG4gICAgICAgIHJlcXVlc3RJZDogbWVzc2FnZS5yZWFkSW50MzJMRSg0KSxcbiAgICAgICAgcmVzcG9uc2VUbzogbWVzc2FnZS5yZWFkSW50MzJMRSg4KSxcbiAgICAgICAgb3BDb2RlOiBtZXNzYWdlLnJlYWRJbnQzMkxFKDEyKVxuICAgIH07XG4gICAgY29uc3QgbW9uaXRvckhhc0Fub3RoZXJIZWxsbyA9ICgpID0+IHtcbiAgICAgICAgaWYgKHN0cmVhbS5pc01vbml0b3JpbmdDb25uZWN0aW9uKSB7XG4gICAgICAgICAgICAvLyBDYW4gd2UgcmVhZCB0aGUgbmV4dCBtZXNzYWdlIHNpemU/XG4gICAgICAgICAgICBjb25zdCBzaXplT2ZNZXNzYWdlID0gYnVmZmVyLmdldEludDMyKCk7XG4gICAgICAgICAgICBpZiAoc2l6ZU9mTWVzc2FnZSAhPSBudWxsICYmIHNpemVPZk1lc3NhZ2UgPD0gYnVmZmVyLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9O1xuICAgIGxldCBSZXNwb25zZVR5cGUgPSBtZXNzYWdlSGVhZGVyLm9wQ29kZSA9PT0gY29uc3RhbnRzXzEuT1BfTVNHID8gY29tbWFuZHNfMS5CaW5Nc2cgOiBjb21tYW5kc18xLlJlc3BvbnNlO1xuICAgIGlmIChtZXNzYWdlSGVhZGVyLm9wQ29kZSAhPT0gY29uc3RhbnRzXzEuT1BfQ09NUFJFU1NFRCkge1xuICAgICAgICBjb25zdCBtZXNzYWdlQm9keSA9IG1lc3NhZ2Uuc3ViYXJyYXkoTUVTU0FHRV9IRUFERVJfU0laRSk7XG4gICAgICAgIC8vIElmIHdlIGFyZSBhIG1vbml0b3JpbmcgY29ubmVjdGlvbiBtZXNzYWdlIHN0cmVhbSBhbmRcbiAgICAgICAgLy8gdGhlcmUgaXMgbW9yZSBpbiB0aGUgYnVmZmVyIHRoYXQgY2FuIGJlIHJlYWQsIHNraXAgcHJvY2Vzc2luZyBzaW5jZSB3ZVxuICAgICAgICAvLyB3YW50IHRoZSBsYXN0IGhlbGxvIGNvbW1hbmQgcmVzcG9uc2UgdGhhdCBpcyBpbiB0aGUgYnVmZmVyLlxuICAgICAgICBpZiAobW9uaXRvckhhc0Fub3RoZXJIZWxsbygpKSB7XG4gICAgICAgICAgICByZXR1cm4gcHJvY2Vzc0luY29taW5nRGF0YShzdHJlYW0sIGNhbGxiYWNrKTtcbiAgICAgICAgfVxuICAgICAgICBzdHJlYW0uZW1pdCgnbWVzc2FnZScsIG5ldyBSZXNwb25zZVR5cGUobWVzc2FnZSwgbWVzc2FnZUhlYWRlciwgbWVzc2FnZUJvZHkpKTtcbiAgICAgICAgaWYgKGJ1ZmZlci5sZW5ndGggPj0gNCkge1xuICAgICAgICAgICAgcmV0dXJuIHByb2Nlc3NJbmNvbWluZ0RhdGEoc3RyZWFtLCBjYWxsYmFjayk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNhbGxiYWNrKCk7XG4gICAgfVxuICAgIG1lc3NhZ2VIZWFkZXIuZnJvbUNvbXByZXNzZWQgPSB0cnVlO1xuICAgIG1lc3NhZ2VIZWFkZXIub3BDb2RlID0gbWVzc2FnZS5yZWFkSW50MzJMRShNRVNTQUdFX0hFQURFUl9TSVpFKTtcbiAgICBtZXNzYWdlSGVhZGVyLmxlbmd0aCA9IG1lc3NhZ2UucmVhZEludDMyTEUoTUVTU0FHRV9IRUFERVJfU0laRSArIDQpO1xuICAgIGNvbnN0IGNvbXByZXNzb3JJRCA9IG1lc3NhZ2VbTUVTU0FHRV9IRUFERVJfU0laRSArIDhdO1xuICAgIGNvbnN0IGNvbXByZXNzZWRCdWZmZXIgPSBtZXNzYWdlLnNsaWNlKE1FU1NBR0VfSEVBREVSX1NJWkUgKyA5KTtcbiAgICAvLyByZWNhbGN1bGF0ZSBiYXNlZCBvbiB3cmFwcGVkIG9wY29kZVxuICAgIFJlc3BvbnNlVHlwZSA9IG1lc3NhZ2VIZWFkZXIub3BDb2RlID09PSBjb25zdGFudHNfMS5PUF9NU0cgPyBjb21tYW5kc18xLkJpbk1zZyA6IGNvbW1hbmRzXzEuUmVzcG9uc2U7XG4gICAgKDAsIGNvbXByZXNzaW9uXzEuZGVjb21wcmVzcykoY29tcHJlc3NvcklELCBjb21wcmVzc2VkQnVmZmVyKS50aGVuKG1lc3NhZ2VCb2R5ID0+IHtcbiAgICAgICAgaWYgKG1lc3NhZ2VCb2R5Lmxlbmd0aCAhPT0gbWVzc2FnZUhlYWRlci5sZW5ndGgpIHtcbiAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhuZXcgZXJyb3JfMS5Nb25nb0RlY29tcHJlc3Npb25FcnJvcignTWVzc2FnZSBib2R5IGFuZCBtZXNzYWdlIGhlYWRlciBtdXN0IGJlIHRoZSBzYW1lIGxlbmd0aCcpKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBJZiB3ZSBhcmUgYSBtb25pdG9yaW5nIGNvbm5lY3Rpb24gbWVzc2FnZSBzdHJlYW0gYW5kXG4gICAgICAgIC8vIHRoZXJlIGlzIG1vcmUgaW4gdGhlIGJ1ZmZlciB0aGF0IGNhbiBiZSByZWFkLCBza2lwIHByb2Nlc3Npbmcgc2luY2Ugd2VcbiAgICAgICAgLy8gd2FudCB0aGUgbGFzdCBoZWxsbyBjb21tYW5kIHJlc3BvbnNlIHRoYXQgaXMgaW4gdGhlIGJ1ZmZlci5cbiAgICAgICAgaWYgKG1vbml0b3JIYXNBbm90aGVySGVsbG8oKSkge1xuICAgICAgICAgICAgcmV0dXJuIHByb2Nlc3NJbmNvbWluZ0RhdGEoc3RyZWFtLCBjYWxsYmFjayk7XG4gICAgICAgIH1cbiAgICAgICAgc3RyZWFtLmVtaXQoJ21lc3NhZ2UnLCBuZXcgUmVzcG9uc2VUeXBlKG1lc3NhZ2UsIG1lc3NhZ2VIZWFkZXIsIG1lc3NhZ2VCb2R5KSk7XG4gICAgICAgIGlmIChidWZmZXIubGVuZ3RoID49IDQpIHtcbiAgICAgICAgICAgIHJldHVybiBwcm9jZXNzSW5jb21pbmdEYXRhKHN0cmVhbSwgY2FsbGJhY2spO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjYWxsYmFjaygpO1xuICAgIH0sIGVycm9yID0+IHtcbiAgICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycm9yKTtcbiAgICB9KTtcbn1cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPW1lc3NhZ2Vfc3RyZWFtLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/cmap/message_stream.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/cmap/metrics.js":
/*!**********************************************************!*\
  !*** ../server/node_modules/mongodb/lib/cmap/metrics.js ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, exports) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.ConnectionPoolMetrics = void 0;\n/** @internal */\nclass ConnectionPoolMetrics {\n    constructor() {\n        this.txnConnections = 0;\n        this.cursorConnections = 0;\n        this.otherConnections = 0;\n    }\n    /**\n     * Mark a connection as pinned for a specific operation.\n     */\n    markPinned(pinType) {\n        if (pinType === ConnectionPoolMetrics.TXN) {\n            this.txnConnections += 1;\n        }\n        else if (pinType === ConnectionPoolMetrics.CURSOR) {\n            this.cursorConnections += 1;\n        }\n        else {\n            this.otherConnections += 1;\n        }\n    }\n    /**\n     * Unmark a connection as pinned for an operation.\n     */\n    markUnpinned(pinType) {\n        if (pinType === ConnectionPoolMetrics.TXN) {\n            this.txnConnections -= 1;\n        }\n        else if (pinType === ConnectionPoolMetrics.CURSOR) {\n            this.cursorConnections -= 1;\n        }\n        else {\n            this.otherConnections -= 1;\n        }\n    }\n    /**\n     * Return information about the cmap metrics as a string.\n     */\n    info(maxPoolSize) {\n        return ('Timed out while checking out a connection from connection pool: ' +\n            `maxPoolSize: ${maxPoolSize}, ` +\n            `connections in use by cursors: ${this.cursorConnections}, ` +\n            `connections in use by transactions: ${this.txnConnections}, ` +\n            `connections in use by other operations: ${this.otherConnections}`);\n    }\n    /**\n     * Reset the metrics to the initial values.\n     */\n    reset() {\n        this.txnConnections = 0;\n        this.cursorConnections = 0;\n        this.otherConnections = 0;\n    }\n}\nConnectionPoolMetrics.TXN = 'txn';\nConnectionPoolMetrics.CURSOR = 'cursor';\nConnectionPoolMetrics.OTHER = 'other';\nexports.ConnectionPoolMetrics = ConnectionPoolMetrics;\n//# sourceMappingURL=metrics.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jbWFwL21ldHJpY3MuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsNkJBQTZCO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLFlBQVk7QUFDeEMsOENBQThDLHVCQUF1QjtBQUNyRSxtREFBbUQsb0JBQW9CO0FBQ3ZFLHVEQUF1RCxzQkFBc0I7QUFDN0U7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0IiLCJzb3VyY2VzIjpbIkQ6XFxzYWxvbmlcXGFwcHJhaXNhbC1zeXN0ZW1cXHNlcnZlclxcbm9kZV9tb2R1bGVzXFxtb25nb2RiXFxsaWJcXGNtYXBcXG1ldHJpY3MuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkNvbm5lY3Rpb25Qb29sTWV0cmljcyA9IHZvaWQgMDtcbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIENvbm5lY3Rpb25Qb29sTWV0cmljcyB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMudHhuQ29ubmVjdGlvbnMgPSAwO1xuICAgICAgICB0aGlzLmN1cnNvckNvbm5lY3Rpb25zID0gMDtcbiAgICAgICAgdGhpcy5vdGhlckNvbm5lY3Rpb25zID0gMDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogTWFyayBhIGNvbm5lY3Rpb24gYXMgcGlubmVkIGZvciBhIHNwZWNpZmljIG9wZXJhdGlvbi5cbiAgICAgKi9cbiAgICBtYXJrUGlubmVkKHBpblR5cGUpIHtcbiAgICAgICAgaWYgKHBpblR5cGUgPT09IENvbm5lY3Rpb25Qb29sTWV0cmljcy5UWE4pIHtcbiAgICAgICAgICAgIHRoaXMudHhuQ29ubmVjdGlvbnMgKz0gMTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChwaW5UeXBlID09PSBDb25uZWN0aW9uUG9vbE1ldHJpY3MuQ1VSU09SKSB7XG4gICAgICAgICAgICB0aGlzLmN1cnNvckNvbm5lY3Rpb25zICs9IDE7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLm90aGVyQ29ubmVjdGlvbnMgKz0gMTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBVbm1hcmsgYSBjb25uZWN0aW9uIGFzIHBpbm5lZCBmb3IgYW4gb3BlcmF0aW9uLlxuICAgICAqL1xuICAgIG1hcmtVbnBpbm5lZChwaW5UeXBlKSB7XG4gICAgICAgIGlmIChwaW5UeXBlID09PSBDb25uZWN0aW9uUG9vbE1ldHJpY3MuVFhOKSB7XG4gICAgICAgICAgICB0aGlzLnR4bkNvbm5lY3Rpb25zIC09IDE7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAocGluVHlwZSA9PT0gQ29ubmVjdGlvblBvb2xNZXRyaWNzLkNVUlNPUikge1xuICAgICAgICAgICAgdGhpcy5jdXJzb3JDb25uZWN0aW9ucyAtPSAxO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5vdGhlckNvbm5lY3Rpb25zIC09IDE7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJuIGluZm9ybWF0aW9uIGFib3V0IHRoZSBjbWFwIG1ldHJpY3MgYXMgYSBzdHJpbmcuXG4gICAgICovXG4gICAgaW5mbyhtYXhQb29sU2l6ZSkge1xuICAgICAgICByZXR1cm4gKCdUaW1lZCBvdXQgd2hpbGUgY2hlY2tpbmcgb3V0IGEgY29ubmVjdGlvbiBmcm9tIGNvbm5lY3Rpb24gcG9vbDogJyArXG4gICAgICAgICAgICBgbWF4UG9vbFNpemU6ICR7bWF4UG9vbFNpemV9LCBgICtcbiAgICAgICAgICAgIGBjb25uZWN0aW9ucyBpbiB1c2UgYnkgY3Vyc29yczogJHt0aGlzLmN1cnNvckNvbm5lY3Rpb25zfSwgYCArXG4gICAgICAgICAgICBgY29ubmVjdGlvbnMgaW4gdXNlIGJ5IHRyYW5zYWN0aW9uczogJHt0aGlzLnR4bkNvbm5lY3Rpb25zfSwgYCArXG4gICAgICAgICAgICBgY29ubmVjdGlvbnMgaW4gdXNlIGJ5IG90aGVyIG9wZXJhdGlvbnM6ICR7dGhpcy5vdGhlckNvbm5lY3Rpb25zfWApO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXNldCB0aGUgbWV0cmljcyB0byB0aGUgaW5pdGlhbCB2YWx1ZXMuXG4gICAgICovXG4gICAgcmVzZXQoKSB7XG4gICAgICAgIHRoaXMudHhuQ29ubmVjdGlvbnMgPSAwO1xuICAgICAgICB0aGlzLmN1cnNvckNvbm5lY3Rpb25zID0gMDtcbiAgICAgICAgdGhpcy5vdGhlckNvbm5lY3Rpb25zID0gMDtcbiAgICB9XG59XG5Db25uZWN0aW9uUG9vbE1ldHJpY3MuVFhOID0gJ3R4bic7XG5Db25uZWN0aW9uUG9vbE1ldHJpY3MuQ1VSU09SID0gJ2N1cnNvcic7XG5Db25uZWN0aW9uUG9vbE1ldHJpY3MuT1RIRVIgPSAnb3RoZXInO1xuZXhwb3J0cy5Db25uZWN0aW9uUG9vbE1ldHJpY3MgPSBDb25uZWN0aW9uUG9vbE1ldHJpY3M7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1tZXRyaWNzLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/cmap/metrics.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/cmap/stream_description.js":
/*!*********************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/cmap/stream_description.js ***!
  \*********************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.StreamDescription = void 0;\nconst common_1 = __webpack_require__(/*! ../sdam/common */ \"(api)/../server/node_modules/mongodb/lib/sdam/common.js\");\nconst server_description_1 = __webpack_require__(/*! ../sdam/server_description */ \"(api)/../server/node_modules/mongodb/lib/sdam/server_description.js\");\nconst RESPONSE_FIELDS = [\n    'minWireVersion',\n    'maxWireVersion',\n    'maxBsonObjectSize',\n    'maxMessageSizeBytes',\n    'maxWriteBatchSize',\n    'logicalSessionTimeoutMinutes'\n];\n/** @public */\nclass StreamDescription {\n    constructor(address, options) {\n        this.address = address;\n        this.type = common_1.ServerType.Unknown;\n        this.minWireVersion = undefined;\n        this.maxWireVersion = undefined;\n        this.maxBsonObjectSize = 16777216;\n        this.maxMessageSizeBytes = 48000000;\n        this.maxWriteBatchSize = 100000;\n        this.logicalSessionTimeoutMinutes = options?.logicalSessionTimeoutMinutes;\n        this.loadBalanced = !!options?.loadBalanced;\n        this.compressors =\n            options && options.compressors && Array.isArray(options.compressors)\n                ? options.compressors\n                : [];\n    }\n    receiveResponse(response) {\n        if (response == null) {\n            return;\n        }\n        this.type = (0, server_description_1.parseServerType)(response);\n        for (const field of RESPONSE_FIELDS) {\n            if (response[field] != null) {\n                this[field] = response[field];\n            }\n            // testing case\n            if ('__nodejs_mock_server__' in response) {\n                this.__nodejs_mock_server__ = response['__nodejs_mock_server__'];\n            }\n        }\n        if (response.compression) {\n            this.compressor = this.compressors.filter(c => response.compression?.includes(c))[0];\n        }\n    }\n}\nexports.StreamDescription = StreamDescription;\n//# sourceMappingURL=stream_description.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jbWFwL3N0cmVhbV9kZXNjcmlwdGlvbi5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCx5QkFBeUI7QUFDekIsaUJBQWlCLG1CQUFPLENBQUMsK0VBQWdCO0FBQ3pDLDZCQUE2QixtQkFBTyxDQUFDLHVHQUE0QjtBQUNqRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCIiwic291cmNlcyI6WyJEOlxcc2Fsb25pXFxhcHByYWlzYWwtc3lzdGVtXFxzZXJ2ZXJcXG5vZGVfbW9kdWxlc1xcbW9uZ29kYlxcbGliXFxjbWFwXFxzdHJlYW1fZGVzY3JpcHRpb24uanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLlN0cmVhbURlc2NyaXB0aW9uID0gdm9pZCAwO1xuY29uc3QgY29tbW9uXzEgPSByZXF1aXJlKFwiLi4vc2RhbS9jb21tb25cIik7XG5jb25zdCBzZXJ2ZXJfZGVzY3JpcHRpb25fMSA9IHJlcXVpcmUoXCIuLi9zZGFtL3NlcnZlcl9kZXNjcmlwdGlvblwiKTtcbmNvbnN0IFJFU1BPTlNFX0ZJRUxEUyA9IFtcbiAgICAnbWluV2lyZVZlcnNpb24nLFxuICAgICdtYXhXaXJlVmVyc2lvbicsXG4gICAgJ21heEJzb25PYmplY3RTaXplJyxcbiAgICAnbWF4TWVzc2FnZVNpemVCeXRlcycsXG4gICAgJ21heFdyaXRlQmF0Y2hTaXplJyxcbiAgICAnbG9naWNhbFNlc3Npb25UaW1lb3V0TWludXRlcydcbl07XG4vKiogQHB1YmxpYyAqL1xuY2xhc3MgU3RyZWFtRGVzY3JpcHRpb24ge1xuICAgIGNvbnN0cnVjdG9yKGFkZHJlc3MsIG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5hZGRyZXNzID0gYWRkcmVzcztcbiAgICAgICAgdGhpcy50eXBlID0gY29tbW9uXzEuU2VydmVyVHlwZS5Vbmtub3duO1xuICAgICAgICB0aGlzLm1pbldpcmVWZXJzaW9uID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLm1heFdpcmVWZXJzaW9uID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLm1heEJzb25PYmplY3RTaXplID0gMTY3NzcyMTY7XG4gICAgICAgIHRoaXMubWF4TWVzc2FnZVNpemVCeXRlcyA9IDQ4MDAwMDAwO1xuICAgICAgICB0aGlzLm1heFdyaXRlQmF0Y2hTaXplID0gMTAwMDAwO1xuICAgICAgICB0aGlzLmxvZ2ljYWxTZXNzaW9uVGltZW91dE1pbnV0ZXMgPSBvcHRpb25zPy5sb2dpY2FsU2Vzc2lvblRpbWVvdXRNaW51dGVzO1xuICAgICAgICB0aGlzLmxvYWRCYWxhbmNlZCA9ICEhb3B0aW9ucz8ubG9hZEJhbGFuY2VkO1xuICAgICAgICB0aGlzLmNvbXByZXNzb3JzID1cbiAgICAgICAgICAgIG9wdGlvbnMgJiYgb3B0aW9ucy5jb21wcmVzc29ycyAmJiBBcnJheS5pc0FycmF5KG9wdGlvbnMuY29tcHJlc3NvcnMpXG4gICAgICAgICAgICAgICAgPyBvcHRpb25zLmNvbXByZXNzb3JzXG4gICAgICAgICAgICAgICAgOiBbXTtcbiAgICB9XG4gICAgcmVjZWl2ZVJlc3BvbnNlKHJlc3BvbnNlKSB7XG4gICAgICAgIGlmIChyZXNwb25zZSA9PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy50eXBlID0gKDAsIHNlcnZlcl9kZXNjcmlwdGlvbl8xLnBhcnNlU2VydmVyVHlwZSkocmVzcG9uc2UpO1xuICAgICAgICBmb3IgKGNvbnN0IGZpZWxkIG9mIFJFU1BPTlNFX0ZJRUxEUykge1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlW2ZpZWxkXSAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpc1tmaWVsZF0gPSByZXNwb25zZVtmaWVsZF07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyB0ZXN0aW5nIGNhc2VcbiAgICAgICAgICAgIGlmICgnX19ub2RlanNfbW9ja19zZXJ2ZXJfXycgaW4gcmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9fbm9kZWpzX21vY2tfc2VydmVyX18gPSByZXNwb25zZVsnX19ub2RlanNfbW9ja19zZXJ2ZXJfXyddO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChyZXNwb25zZS5jb21wcmVzc2lvbikge1xuICAgICAgICAgICAgdGhpcy5jb21wcmVzc29yID0gdGhpcy5jb21wcmVzc29ycy5maWx0ZXIoYyA9PiByZXNwb25zZS5jb21wcmVzc2lvbj8uaW5jbHVkZXMoYykpWzBdO1xuICAgICAgICB9XG4gICAgfVxufVxuZXhwb3J0cy5TdHJlYW1EZXNjcmlwdGlvbiA9IFN0cmVhbURlc2NyaXB0aW9uO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9c3RyZWFtX2Rlc2NyaXB0aW9uLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/cmap/stream_description.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/cmap/wire_protocol/compression.js":
/*!****************************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/cmap/wire_protocol/compression.js ***!
  \****************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.decompress = exports.compress = exports.uncompressibleCommands = exports.Compressor = void 0;\nconst util_1 = __webpack_require__(/*! util */ \"util\");\nconst zlib = __webpack_require__(/*! zlib */ \"zlib\");\nconst constants_1 = __webpack_require__(/*! ../../constants */ \"(api)/../server/node_modules/mongodb/lib/constants.js\");\nconst deps_1 = __webpack_require__(/*! ../../deps */ \"(api)/../server/node_modules/mongodb/lib/deps.js\");\nconst error_1 = __webpack_require__(/*! ../../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\n/** @public */\nexports.Compressor = Object.freeze({\n    none: 0,\n    snappy: 1,\n    zlib: 2,\n    zstd: 3\n});\nexports.uncompressibleCommands = new Set([\n    constants_1.LEGACY_HELLO_COMMAND,\n    'saslStart',\n    'saslContinue',\n    'getnonce',\n    'authenticate',\n    'createUser',\n    'updateUser',\n    'copydbSaslStart',\n    'copydbgetnonce',\n    'copydb'\n]);\nconst ZSTD_COMPRESSION_LEVEL = 3;\nconst zlibInflate = (0, util_1.promisify)(zlib.inflate.bind(zlib));\nconst zlibDeflate = (0, util_1.promisify)(zlib.deflate.bind(zlib));\nlet zstd;\nlet Snappy = null;\nfunction loadSnappy() {\n    if (Snappy == null) {\n        const snappyImport = (0, deps_1.getSnappy)();\n        if ('kModuleError' in snappyImport) {\n            throw snappyImport.kModuleError;\n        }\n        Snappy = snappyImport;\n    }\n    return Snappy;\n}\n// Facilitate compressing a message using an agreed compressor\nasync function compress(options, dataToBeCompressed) {\n    const zlibOptions = {};\n    switch (options.agreedCompressor) {\n        case 'snappy': {\n            Snappy ?? (Snappy = loadSnappy());\n            return Snappy.compress(dataToBeCompressed);\n        }\n        case 'zstd': {\n            loadZstd();\n            if ('kModuleError' in zstd) {\n                throw zstd['kModuleError'];\n            }\n            return zstd.compress(dataToBeCompressed, ZSTD_COMPRESSION_LEVEL);\n        }\n        case 'zlib': {\n            if (options.zlibCompressionLevel) {\n                zlibOptions.level = options.zlibCompressionLevel;\n            }\n            return zlibDeflate(dataToBeCompressed, zlibOptions);\n        }\n        default: {\n            throw new error_1.MongoInvalidArgumentError(`Unknown compressor ${options.agreedCompressor} failed to compress`);\n        }\n    }\n}\nexports.compress = compress;\n// Decompress a message using the given compressor\nasync function decompress(compressorID, compressedData) {\n    if (compressorID !== exports.Compressor.snappy &&\n        compressorID !== exports.Compressor.zstd &&\n        compressorID !== exports.Compressor.zlib &&\n        compressorID !== exports.Compressor.none) {\n        throw new error_1.MongoDecompressionError(`Server sent message compressed using an unsupported compressor. (Received compressor ID ${compressorID})`);\n    }\n    switch (compressorID) {\n        case exports.Compressor.snappy: {\n            Snappy ?? (Snappy = loadSnappy());\n            return Snappy.uncompress(compressedData, { asBuffer: true });\n        }\n        case exports.Compressor.zstd: {\n            loadZstd();\n            if ('kModuleError' in zstd) {\n                throw zstd['kModuleError'];\n            }\n            return zstd.decompress(compressedData);\n        }\n        case exports.Compressor.zlib: {\n            return zlibInflate(compressedData);\n        }\n        default: {\n            return compressedData;\n        }\n    }\n}\nexports.decompress = decompress;\n/**\n * Load ZStandard if it is not already set.\n */\nfunction loadZstd() {\n    if (!zstd) {\n        zstd = (0, deps_1.getZstdLibrary)();\n    }\n}\n//# sourceMappingURL=compression.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jbWFwL3dpcmVfcHJvdG9jb2wvY29tcHJlc3Npb24uanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0Qsa0JBQWtCLEdBQUcsZ0JBQWdCLEdBQUcsOEJBQThCLEdBQUcsa0JBQWtCO0FBQzNGLGVBQWUsbUJBQU8sQ0FBQyxrQkFBTTtBQUM3QixhQUFhLG1CQUFPLENBQUMsa0JBQU07QUFDM0Isb0JBQW9CLG1CQUFPLENBQUMsOEVBQWlCO0FBQzdDLGVBQWUsbUJBQU8sQ0FBQyxvRUFBWTtBQUNuQyxnQkFBZ0IsbUJBQU8sQ0FBQyxzRUFBYTtBQUNyQztBQUNBLGtCQUFrQjtBQUNsQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRCw4QkFBOEI7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEVBQThFLDBCQUEwQjtBQUN4RztBQUNBO0FBQ0E7QUFDQSxnQkFBZ0I7QUFDaEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNklBQTZJLGFBQWE7QUFDMUo7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1REFBdUQsZ0JBQWdCO0FBQ3ZFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsiRDpcXHNhbG9uaVxcYXBwcmFpc2FsLXN5c3RlbVxcc2VydmVyXFxub2RlX21vZHVsZXNcXG1vbmdvZGJcXGxpYlxcY21hcFxcd2lyZV9wcm90b2NvbFxcY29tcHJlc3Npb24uanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmRlY29tcHJlc3MgPSBleHBvcnRzLmNvbXByZXNzID0gZXhwb3J0cy51bmNvbXByZXNzaWJsZUNvbW1hbmRzID0gZXhwb3J0cy5Db21wcmVzc29yID0gdm9pZCAwO1xuY29uc3QgdXRpbF8xID0gcmVxdWlyZShcInV0aWxcIik7XG5jb25zdCB6bGliID0gcmVxdWlyZShcInpsaWJcIik7XG5jb25zdCBjb25zdGFudHNfMSA9IHJlcXVpcmUoXCIuLi8uLi9jb25zdGFudHNcIik7XG5jb25zdCBkZXBzXzEgPSByZXF1aXJlKFwiLi4vLi4vZGVwc1wiKTtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi4vLi4vZXJyb3JcIik7XG4vKiogQHB1YmxpYyAqL1xuZXhwb3J0cy5Db21wcmVzc29yID0gT2JqZWN0LmZyZWV6ZSh7XG4gICAgbm9uZTogMCxcbiAgICBzbmFwcHk6IDEsXG4gICAgemxpYjogMixcbiAgICB6c3RkOiAzXG59KTtcbmV4cG9ydHMudW5jb21wcmVzc2libGVDb21tYW5kcyA9IG5ldyBTZXQoW1xuICAgIGNvbnN0YW50c18xLkxFR0FDWV9IRUxMT19DT01NQU5ELFxuICAgICdzYXNsU3RhcnQnLFxuICAgICdzYXNsQ29udGludWUnLFxuICAgICdnZXRub25jZScsXG4gICAgJ2F1dGhlbnRpY2F0ZScsXG4gICAgJ2NyZWF0ZVVzZXInLFxuICAgICd1cGRhdGVVc2VyJyxcbiAgICAnY29weWRiU2FzbFN0YXJ0JyxcbiAgICAnY29weWRiZ2V0bm9uY2UnLFxuICAgICdjb3B5ZGInXG5dKTtcbmNvbnN0IFpTVERfQ09NUFJFU1NJT05fTEVWRUwgPSAzO1xuY29uc3QgemxpYkluZmxhdGUgPSAoMCwgdXRpbF8xLnByb21pc2lmeSkoemxpYi5pbmZsYXRlLmJpbmQoemxpYikpO1xuY29uc3QgemxpYkRlZmxhdGUgPSAoMCwgdXRpbF8xLnByb21pc2lmeSkoemxpYi5kZWZsYXRlLmJpbmQoemxpYikpO1xubGV0IHpzdGQ7XG5sZXQgU25hcHB5ID0gbnVsbDtcbmZ1bmN0aW9uIGxvYWRTbmFwcHkoKSB7XG4gICAgaWYgKFNuYXBweSA9PSBudWxsKSB7XG4gICAgICAgIGNvbnN0IHNuYXBweUltcG9ydCA9ICgwLCBkZXBzXzEuZ2V0U25hcHB5KSgpO1xuICAgICAgICBpZiAoJ2tNb2R1bGVFcnJvcicgaW4gc25hcHB5SW1wb3J0KSB7XG4gICAgICAgICAgICB0aHJvdyBzbmFwcHlJbXBvcnQua01vZHVsZUVycm9yO1xuICAgICAgICB9XG4gICAgICAgIFNuYXBweSA9IHNuYXBweUltcG9ydDtcbiAgICB9XG4gICAgcmV0dXJuIFNuYXBweTtcbn1cbi8vIEZhY2lsaXRhdGUgY29tcHJlc3NpbmcgYSBtZXNzYWdlIHVzaW5nIGFuIGFncmVlZCBjb21wcmVzc29yXG5hc3luYyBmdW5jdGlvbiBjb21wcmVzcyhvcHRpb25zLCBkYXRhVG9CZUNvbXByZXNzZWQpIHtcbiAgICBjb25zdCB6bGliT3B0aW9ucyA9IHt9O1xuICAgIHN3aXRjaCAob3B0aW9ucy5hZ3JlZWRDb21wcmVzc29yKSB7XG4gICAgICAgIGNhc2UgJ3NuYXBweSc6IHtcbiAgICAgICAgICAgIFNuYXBweSA/PyAoU25hcHB5ID0gbG9hZFNuYXBweSgpKTtcbiAgICAgICAgICAgIHJldHVybiBTbmFwcHkuY29tcHJlc3MoZGF0YVRvQmVDb21wcmVzc2VkKTtcbiAgICAgICAgfVxuICAgICAgICBjYXNlICd6c3RkJzoge1xuICAgICAgICAgICAgbG9hZFpzdGQoKTtcbiAgICAgICAgICAgIGlmICgna01vZHVsZUVycm9yJyBpbiB6c3RkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgenN0ZFsna01vZHVsZUVycm9yJ107XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4genN0ZC5jb21wcmVzcyhkYXRhVG9CZUNvbXByZXNzZWQsIFpTVERfQ09NUFJFU1NJT05fTEVWRUwpO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgJ3psaWInOiB7XG4gICAgICAgICAgICBpZiAob3B0aW9ucy56bGliQ29tcHJlc3Npb25MZXZlbCkge1xuICAgICAgICAgICAgICAgIHpsaWJPcHRpb25zLmxldmVsID0gb3B0aW9ucy56bGliQ29tcHJlc3Npb25MZXZlbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB6bGliRGVmbGF0ZShkYXRhVG9CZUNvbXByZXNzZWQsIHpsaWJPcHRpb25zKTtcbiAgICAgICAgfVxuICAgICAgICBkZWZhdWx0OiB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKGBVbmtub3duIGNvbXByZXNzb3IgJHtvcHRpb25zLmFncmVlZENvbXByZXNzb3J9IGZhaWxlZCB0byBjb21wcmVzc2ApO1xuICAgICAgICB9XG4gICAgfVxufVxuZXhwb3J0cy5jb21wcmVzcyA9IGNvbXByZXNzO1xuLy8gRGVjb21wcmVzcyBhIG1lc3NhZ2UgdXNpbmcgdGhlIGdpdmVuIGNvbXByZXNzb3JcbmFzeW5jIGZ1bmN0aW9uIGRlY29tcHJlc3MoY29tcHJlc3NvcklELCBjb21wcmVzc2VkRGF0YSkge1xuICAgIGlmIChjb21wcmVzc29ySUQgIT09IGV4cG9ydHMuQ29tcHJlc3Nvci5zbmFwcHkgJiZcbiAgICAgICAgY29tcHJlc3NvcklEICE9PSBleHBvcnRzLkNvbXByZXNzb3IuenN0ZCAmJlxuICAgICAgICBjb21wcmVzc29ySUQgIT09IGV4cG9ydHMuQ29tcHJlc3Nvci56bGliICYmXG4gICAgICAgIGNvbXByZXNzb3JJRCAhPT0gZXhwb3J0cy5Db21wcmVzc29yLm5vbmUpIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29EZWNvbXByZXNzaW9uRXJyb3IoYFNlcnZlciBzZW50IG1lc3NhZ2UgY29tcHJlc3NlZCB1c2luZyBhbiB1bnN1cHBvcnRlZCBjb21wcmVzc29yLiAoUmVjZWl2ZWQgY29tcHJlc3NvciBJRCAke2NvbXByZXNzb3JJRH0pYCk7XG4gICAgfVxuICAgIHN3aXRjaCAoY29tcHJlc3NvcklEKSB7XG4gICAgICAgIGNhc2UgZXhwb3J0cy5Db21wcmVzc29yLnNuYXBweToge1xuICAgICAgICAgICAgU25hcHB5ID8/IChTbmFwcHkgPSBsb2FkU25hcHB5KCkpO1xuICAgICAgICAgICAgcmV0dXJuIFNuYXBweS51bmNvbXByZXNzKGNvbXByZXNzZWREYXRhLCB7IGFzQnVmZmVyOiB0cnVlIH0pO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgZXhwb3J0cy5Db21wcmVzc29yLnpzdGQ6IHtcbiAgICAgICAgICAgIGxvYWRac3RkKCk7XG4gICAgICAgICAgICBpZiAoJ2tNb2R1bGVFcnJvcicgaW4genN0ZCkge1xuICAgICAgICAgICAgICAgIHRocm93IHpzdGRbJ2tNb2R1bGVFcnJvciddO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHpzdGQuZGVjb21wcmVzcyhjb21wcmVzc2VkRGF0YSk7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBleHBvcnRzLkNvbXByZXNzb3IuemxpYjoge1xuICAgICAgICAgICAgcmV0dXJuIHpsaWJJbmZsYXRlKGNvbXByZXNzZWREYXRhKTtcbiAgICAgICAgfVxuICAgICAgICBkZWZhdWx0OiB7XG4gICAgICAgICAgICByZXR1cm4gY29tcHJlc3NlZERhdGE7XG4gICAgICAgIH1cbiAgICB9XG59XG5leHBvcnRzLmRlY29tcHJlc3MgPSBkZWNvbXByZXNzO1xuLyoqXG4gKiBMb2FkIFpTdGFuZGFyZCBpZiBpdCBpcyBub3QgYWxyZWFkeSBzZXQuXG4gKi9cbmZ1bmN0aW9uIGxvYWRac3RkKCkge1xuICAgIGlmICghenN0ZCkge1xuICAgICAgICB6c3RkID0gKDAsIGRlcHNfMS5nZXRac3RkTGlicmFyeSkoKTtcbiAgICB9XG59XG4vLyMgc291cmNlTWFwcGluZ1VSTD1jb21wcmVzc2lvbi5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/cmap/wire_protocol/compression.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/cmap/wire_protocol/constants.js":
/*!**************************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/cmap/wire_protocol/constants.js ***!
  \**************************************************************************/
/***/ ((__unused_webpack_module, exports) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.OP_MSG = exports.OP_COMPRESSED = exports.OP_DELETE = exports.OP_QUERY = exports.OP_INSERT = exports.OP_UPDATE = exports.OP_REPLY = exports.MIN_SUPPORTED_QE_SERVER_VERSION = exports.MIN_SUPPORTED_QE_WIRE_VERSION = exports.MAX_SUPPORTED_WIRE_VERSION = exports.MIN_SUPPORTED_WIRE_VERSION = exports.MAX_SUPPORTED_SERVER_VERSION = exports.MIN_SUPPORTED_SERVER_VERSION = void 0;\nexports.MIN_SUPPORTED_SERVER_VERSION = '3.6';\nexports.MAX_SUPPORTED_SERVER_VERSION = '7.0';\nexports.MIN_SUPPORTED_WIRE_VERSION = 6;\nexports.MAX_SUPPORTED_WIRE_VERSION = 21;\nexports.MIN_SUPPORTED_QE_WIRE_VERSION = 21;\nexports.MIN_SUPPORTED_QE_SERVER_VERSION = '7.0';\nexports.OP_REPLY = 1;\nexports.OP_UPDATE = 2001;\nexports.OP_INSERT = 2002;\nexports.OP_QUERY = 2004;\nexports.OP_DELETE = 2006;\nexports.OP_COMPRESSED = 2012;\nexports.OP_MSG = 2013;\n//# sourceMappingURL=constants.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jbWFwL3dpcmVfcHJvdG9jb2wvY29uc3RhbnRzLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELGNBQWMsR0FBRyxxQkFBcUIsR0FBRyxpQkFBaUIsR0FBRyxnQkFBZ0IsR0FBRyxpQkFBaUIsR0FBRyxpQkFBaUIsR0FBRyxnQkFBZ0IsR0FBRyx1Q0FBdUMsR0FBRyxxQ0FBcUMsR0FBRyxrQ0FBa0MsR0FBRyxrQ0FBa0MsR0FBRyxvQ0FBb0MsR0FBRyxvQ0FBb0M7QUFDbFgsb0NBQW9DO0FBQ3BDLG9DQUFvQztBQUNwQyxrQ0FBa0M7QUFDbEMsa0NBQWtDO0FBQ2xDLHFDQUFxQztBQUNyQyx1Q0FBdUM7QUFDdkMsZ0JBQWdCO0FBQ2hCLGlCQUFpQjtBQUNqQixpQkFBaUI7QUFDakIsZ0JBQWdCO0FBQ2hCLGlCQUFpQjtBQUNqQixxQkFBcUI7QUFDckIsY0FBYztBQUNkIiwic291cmNlcyI6WyJEOlxcc2Fsb25pXFxhcHByYWlzYWwtc3lzdGVtXFxzZXJ2ZXJcXG5vZGVfbW9kdWxlc1xcbW9uZ29kYlxcbGliXFxjbWFwXFx3aXJlX3Byb3RvY29sXFxjb25zdGFudHMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk9QX01TRyA9IGV4cG9ydHMuT1BfQ09NUFJFU1NFRCA9IGV4cG9ydHMuT1BfREVMRVRFID0gZXhwb3J0cy5PUF9RVUVSWSA9IGV4cG9ydHMuT1BfSU5TRVJUID0gZXhwb3J0cy5PUF9VUERBVEUgPSBleHBvcnRzLk9QX1JFUExZID0gZXhwb3J0cy5NSU5fU1VQUE9SVEVEX1FFX1NFUlZFUl9WRVJTSU9OID0gZXhwb3J0cy5NSU5fU1VQUE9SVEVEX1FFX1dJUkVfVkVSU0lPTiA9IGV4cG9ydHMuTUFYX1NVUFBPUlRFRF9XSVJFX1ZFUlNJT04gPSBleHBvcnRzLk1JTl9TVVBQT1JURURfV0lSRV9WRVJTSU9OID0gZXhwb3J0cy5NQVhfU1VQUE9SVEVEX1NFUlZFUl9WRVJTSU9OID0gZXhwb3J0cy5NSU5fU1VQUE9SVEVEX1NFUlZFUl9WRVJTSU9OID0gdm9pZCAwO1xuZXhwb3J0cy5NSU5fU1VQUE9SVEVEX1NFUlZFUl9WRVJTSU9OID0gJzMuNic7XG5leHBvcnRzLk1BWF9TVVBQT1JURURfU0VSVkVSX1ZFUlNJT04gPSAnNy4wJztcbmV4cG9ydHMuTUlOX1NVUFBPUlRFRF9XSVJFX1ZFUlNJT04gPSA2O1xuZXhwb3J0cy5NQVhfU1VQUE9SVEVEX1dJUkVfVkVSU0lPTiA9IDIxO1xuZXhwb3J0cy5NSU5fU1VQUE9SVEVEX1FFX1dJUkVfVkVSU0lPTiA9IDIxO1xuZXhwb3J0cy5NSU5fU1VQUE9SVEVEX1FFX1NFUlZFUl9WRVJTSU9OID0gJzcuMCc7XG5leHBvcnRzLk9QX1JFUExZID0gMTtcbmV4cG9ydHMuT1BfVVBEQVRFID0gMjAwMTtcbmV4cG9ydHMuT1BfSU5TRVJUID0gMjAwMjtcbmV4cG9ydHMuT1BfUVVFUlkgPSAyMDA0O1xuZXhwb3J0cy5PUF9ERUxFVEUgPSAyMDA2O1xuZXhwb3J0cy5PUF9DT01QUkVTU0VEID0gMjAxMjtcbmV4cG9ydHMuT1BfTVNHID0gMjAxMztcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWNvbnN0YW50cy5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/cmap/wire_protocol/constants.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/cmap/wire_protocol/shared.js":
/*!***********************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/cmap/wire_protocol/shared.js ***!
  \***********************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.isSharded = exports.getReadPreference = void 0;\nconst error_1 = __webpack_require__(/*! ../../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst read_preference_1 = __webpack_require__(/*! ../../read_preference */ \"(api)/../server/node_modules/mongodb/lib/read_preference.js\");\nconst common_1 = __webpack_require__(/*! ../../sdam/common */ \"(api)/../server/node_modules/mongodb/lib/sdam/common.js\");\nconst topology_description_1 = __webpack_require__(/*! ../../sdam/topology_description */ \"(api)/../server/node_modules/mongodb/lib/sdam/topology_description.js\");\nfunction getReadPreference(options) {\n    // Default to command version of the readPreference\n    let readPreference = options?.readPreference ?? read_preference_1.ReadPreference.primary;\n    // If we have an option readPreference override the command one\n    if (options?.readPreference) {\n        readPreference = options.readPreference;\n    }\n    if (typeof readPreference === 'string') {\n        readPreference = read_preference_1.ReadPreference.fromString(readPreference);\n    }\n    if (!(readPreference instanceof read_preference_1.ReadPreference)) {\n        throw new error_1.MongoInvalidArgumentError('Option \"readPreference\" must be a ReadPreference instance');\n    }\n    return readPreference;\n}\nexports.getReadPreference = getReadPreference;\nfunction isSharded(topologyOrServer) {\n    if (topologyOrServer == null) {\n        return false;\n    }\n    if (topologyOrServer.description && topologyOrServer.description.type === common_1.ServerType.Mongos) {\n        return true;\n    }\n    // NOTE: This is incredibly inefficient, and should be removed once command construction\n    //       happens based on `Server` not `Topology`.\n    if (topologyOrServer.description && topologyOrServer.description instanceof topology_description_1.TopologyDescription) {\n        const servers = Array.from(topologyOrServer.description.servers.values());\n        return servers.some((server) => server.type === common_1.ServerType.Mongos);\n    }\n    return false;\n}\nexports.isSharded = isSharded;\n//# sourceMappingURL=shared.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jbWFwL3dpcmVfcHJvdG9jb2wvc2hhcmVkLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELGlCQUFpQixHQUFHLHlCQUF5QjtBQUM3QyxnQkFBZ0IsbUJBQU8sQ0FBQyxzRUFBYTtBQUNyQywwQkFBMEIsbUJBQU8sQ0FBQywwRkFBdUI7QUFDekQsaUJBQWlCLG1CQUFPLENBQUMsa0ZBQW1CO0FBQzVDLCtCQUErQixtQkFBTyxDQUFDLDhHQUFpQztBQUN4RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCIiwic291cmNlcyI6WyJEOlxcc2Fsb25pXFxhcHByYWlzYWwtc3lzdGVtXFxzZXJ2ZXJcXG5vZGVfbW9kdWxlc1xcbW9uZ29kYlxcbGliXFxjbWFwXFx3aXJlX3Byb3RvY29sXFxzaGFyZWQuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmlzU2hhcmRlZCA9IGV4cG9ydHMuZ2V0UmVhZFByZWZlcmVuY2UgPSB2b2lkIDA7XG5jb25zdCBlcnJvcl8xID0gcmVxdWlyZShcIi4uLy4uL2Vycm9yXCIpO1xuY29uc3QgcmVhZF9wcmVmZXJlbmNlXzEgPSByZXF1aXJlKFwiLi4vLi4vcmVhZF9wcmVmZXJlbmNlXCIpO1xuY29uc3QgY29tbW9uXzEgPSByZXF1aXJlKFwiLi4vLi4vc2RhbS9jb21tb25cIik7XG5jb25zdCB0b3BvbG9neV9kZXNjcmlwdGlvbl8xID0gcmVxdWlyZShcIi4uLy4uL3NkYW0vdG9wb2xvZ3lfZGVzY3JpcHRpb25cIik7XG5mdW5jdGlvbiBnZXRSZWFkUHJlZmVyZW5jZShvcHRpb25zKSB7XG4gICAgLy8gRGVmYXVsdCB0byBjb21tYW5kIHZlcnNpb24gb2YgdGhlIHJlYWRQcmVmZXJlbmNlXG4gICAgbGV0IHJlYWRQcmVmZXJlbmNlID0gb3B0aW9ucz8ucmVhZFByZWZlcmVuY2UgPz8gcmVhZF9wcmVmZXJlbmNlXzEuUmVhZFByZWZlcmVuY2UucHJpbWFyeTtcbiAgICAvLyBJZiB3ZSBoYXZlIGFuIG9wdGlvbiByZWFkUHJlZmVyZW5jZSBvdmVycmlkZSB0aGUgY29tbWFuZCBvbmVcbiAgICBpZiAob3B0aW9ucz8ucmVhZFByZWZlcmVuY2UpIHtcbiAgICAgICAgcmVhZFByZWZlcmVuY2UgPSBvcHRpb25zLnJlYWRQcmVmZXJlbmNlO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIHJlYWRQcmVmZXJlbmNlID09PSAnc3RyaW5nJykge1xuICAgICAgICByZWFkUHJlZmVyZW5jZSA9IHJlYWRfcHJlZmVyZW5jZV8xLlJlYWRQcmVmZXJlbmNlLmZyb21TdHJpbmcocmVhZFByZWZlcmVuY2UpO1xuICAgIH1cbiAgICBpZiAoIShyZWFkUHJlZmVyZW5jZSBpbnN0YW5jZW9mIHJlYWRfcHJlZmVyZW5jZV8xLlJlYWRQcmVmZXJlbmNlKSkge1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdPcHRpb24gXCJyZWFkUHJlZmVyZW5jZVwiIG11c3QgYmUgYSBSZWFkUHJlZmVyZW5jZSBpbnN0YW5jZScpO1xuICAgIH1cbiAgICByZXR1cm4gcmVhZFByZWZlcmVuY2U7XG59XG5leHBvcnRzLmdldFJlYWRQcmVmZXJlbmNlID0gZ2V0UmVhZFByZWZlcmVuY2U7XG5mdW5jdGlvbiBpc1NoYXJkZWQodG9wb2xvZ3lPclNlcnZlcikge1xuICAgIGlmICh0b3BvbG9neU9yU2VydmVyID09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpZiAodG9wb2xvZ3lPclNlcnZlci5kZXNjcmlwdGlvbiAmJiB0b3BvbG9neU9yU2VydmVyLmRlc2NyaXB0aW9uLnR5cGUgPT09IGNvbW1vbl8xLlNlcnZlclR5cGUuTW9uZ29zKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICAvLyBOT1RFOiBUaGlzIGlzIGluY3JlZGlibHkgaW5lZmZpY2llbnQsIGFuZCBzaG91bGQgYmUgcmVtb3ZlZCBvbmNlIGNvbW1hbmQgY29uc3RydWN0aW9uXG4gICAgLy8gICAgICAgaGFwcGVucyBiYXNlZCBvbiBgU2VydmVyYCBub3QgYFRvcG9sb2d5YC5cbiAgICBpZiAodG9wb2xvZ3lPclNlcnZlci5kZXNjcmlwdGlvbiAmJiB0b3BvbG9neU9yU2VydmVyLmRlc2NyaXB0aW9uIGluc3RhbmNlb2YgdG9wb2xvZ3lfZGVzY3JpcHRpb25fMS5Ub3BvbG9neURlc2NyaXB0aW9uKSB7XG4gICAgICAgIGNvbnN0IHNlcnZlcnMgPSBBcnJheS5mcm9tKHRvcG9sb2d5T3JTZXJ2ZXIuZGVzY3JpcHRpb24uc2VydmVycy52YWx1ZXMoKSk7XG4gICAgICAgIHJldHVybiBzZXJ2ZXJzLnNvbWUoKHNlcnZlcikgPT4gc2VydmVyLnR5cGUgPT09IGNvbW1vbl8xLlNlcnZlclR5cGUuTW9uZ29zKTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xufVxuZXhwb3J0cy5pc1NoYXJkZWQgPSBpc1NoYXJkZWQ7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1zaGFyZWQuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/cmap/wire_protocol/shared.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/collection.js":
/*!********************************************************!*\
  !*** ../server/node_modules/mongodb/lib/collection.js ***!
  \********************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.Collection = void 0;\nconst bson_1 = __webpack_require__(/*! ./bson */ \"(api)/../server/node_modules/mongodb/lib/bson.js\");\nconst ordered_1 = __webpack_require__(/*! ./bulk/ordered */ \"(api)/../server/node_modules/mongodb/lib/bulk/ordered.js\");\nconst unordered_1 = __webpack_require__(/*! ./bulk/unordered */ \"(api)/../server/node_modules/mongodb/lib/bulk/unordered.js\");\nconst change_stream_1 = __webpack_require__(/*! ./change_stream */ \"(api)/../server/node_modules/mongodb/lib/change_stream.js\");\nconst aggregation_cursor_1 = __webpack_require__(/*! ./cursor/aggregation_cursor */ \"(api)/../server/node_modules/mongodb/lib/cursor/aggregation_cursor.js\");\nconst find_cursor_1 = __webpack_require__(/*! ./cursor/find_cursor */ \"(api)/../server/node_modules/mongodb/lib/cursor/find_cursor.js\");\nconst list_indexes_cursor_1 = __webpack_require__(/*! ./cursor/list_indexes_cursor */ \"(api)/../server/node_modules/mongodb/lib/cursor/list_indexes_cursor.js\");\nconst list_search_indexes_cursor_1 = __webpack_require__(/*! ./cursor/list_search_indexes_cursor */ \"(api)/../server/node_modules/mongodb/lib/cursor/list_search_indexes_cursor.js\");\nconst error_1 = __webpack_require__(/*! ./error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst bulk_write_1 = __webpack_require__(/*! ./operations/bulk_write */ \"(api)/../server/node_modules/mongodb/lib/operations/bulk_write.js\");\nconst count_1 = __webpack_require__(/*! ./operations/count */ \"(api)/../server/node_modules/mongodb/lib/operations/count.js\");\nconst count_documents_1 = __webpack_require__(/*! ./operations/count_documents */ \"(api)/../server/node_modules/mongodb/lib/operations/count_documents.js\");\nconst delete_1 = __webpack_require__(/*! ./operations/delete */ \"(api)/../server/node_modules/mongodb/lib/operations/delete.js\");\nconst distinct_1 = __webpack_require__(/*! ./operations/distinct */ \"(api)/../server/node_modules/mongodb/lib/operations/distinct.js\");\nconst drop_1 = __webpack_require__(/*! ./operations/drop */ \"(api)/../server/node_modules/mongodb/lib/operations/drop.js\");\nconst estimated_document_count_1 = __webpack_require__(/*! ./operations/estimated_document_count */ \"(api)/../server/node_modules/mongodb/lib/operations/estimated_document_count.js\");\nconst execute_operation_1 = __webpack_require__(/*! ./operations/execute_operation */ \"(api)/../server/node_modules/mongodb/lib/operations/execute_operation.js\");\nconst find_and_modify_1 = __webpack_require__(/*! ./operations/find_and_modify */ \"(api)/../server/node_modules/mongodb/lib/operations/find_and_modify.js\");\nconst indexes_1 = __webpack_require__(/*! ./operations/indexes */ \"(api)/../server/node_modules/mongodb/lib/operations/indexes.js\");\nconst insert_1 = __webpack_require__(/*! ./operations/insert */ \"(api)/../server/node_modules/mongodb/lib/operations/insert.js\");\nconst is_capped_1 = __webpack_require__(/*! ./operations/is_capped */ \"(api)/../server/node_modules/mongodb/lib/operations/is_capped.js\");\nconst options_operation_1 = __webpack_require__(/*! ./operations/options_operation */ \"(api)/../server/node_modules/mongodb/lib/operations/options_operation.js\");\nconst rename_1 = __webpack_require__(/*! ./operations/rename */ \"(api)/../server/node_modules/mongodb/lib/operations/rename.js\");\nconst create_1 = __webpack_require__(/*! ./operations/search_indexes/create */ \"(api)/../server/node_modules/mongodb/lib/operations/search_indexes/create.js\");\nconst drop_2 = __webpack_require__(/*! ./operations/search_indexes/drop */ \"(api)/../server/node_modules/mongodb/lib/operations/search_indexes/drop.js\");\nconst update_1 = __webpack_require__(/*! ./operations/search_indexes/update */ \"(api)/../server/node_modules/mongodb/lib/operations/search_indexes/update.js\");\nconst stats_1 = __webpack_require__(/*! ./operations/stats */ \"(api)/../server/node_modules/mongodb/lib/operations/stats.js\");\nconst update_2 = __webpack_require__(/*! ./operations/update */ \"(api)/../server/node_modules/mongodb/lib/operations/update.js\");\nconst read_concern_1 = __webpack_require__(/*! ./read_concern */ \"(api)/../server/node_modules/mongodb/lib/read_concern.js\");\nconst read_preference_1 = __webpack_require__(/*! ./read_preference */ \"(api)/../server/node_modules/mongodb/lib/read_preference.js\");\nconst utils_1 = __webpack_require__(/*! ./utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\nconst write_concern_1 = __webpack_require__(/*! ./write_concern */ \"(api)/../server/node_modules/mongodb/lib/write_concern.js\");\n/**\n * The **Collection** class is an internal class that embodies a MongoDB collection\n * allowing for insert/find/update/delete and other command operation on that MongoDB collection.\n *\n * **COLLECTION Cannot directly be instantiated**\n * @public\n *\n * @example\n * ```ts\n * import { MongoClient } from 'mongodb';\n *\n * interface Pet {\n *   name: string;\n *   kind: 'dog' | 'cat' | 'fish';\n * }\n *\n * const client = new MongoClient('mongodb://localhost:27017');\n * const pets = client.db().collection<Pet>('pets');\n *\n * const petCursor = pets.find();\n *\n * for await (const pet of petCursor) {\n *   console.log(`${pet.name} is a ${pet.kind}!`);\n * }\n * ```\n */\nclass Collection {\n    /**\n     * Create a new Collection instance\n     * @internal\n     */\n    constructor(db, name, options) {\n        (0, utils_1.checkCollectionName)(name);\n        // Internal state\n        this.s = {\n            db,\n            options,\n            namespace: new utils_1.MongoDBCollectionNamespace(db.databaseName, name),\n            pkFactory: db.options?.pkFactory ?? utils_1.DEFAULT_PK_FACTORY,\n            readPreference: read_preference_1.ReadPreference.fromOptions(options),\n            bsonOptions: (0, bson_1.resolveBSONOptions)(options, db),\n            readConcern: read_concern_1.ReadConcern.fromOptions(options),\n            writeConcern: write_concern_1.WriteConcern.fromOptions(options)\n        };\n        this.client = db.client;\n    }\n    /**\n     * The name of the database this collection belongs to\n     */\n    get dbName() {\n        return this.s.namespace.db;\n    }\n    /**\n     * The name of this collection\n     */\n    get collectionName() {\n        return this.s.namespace.collection;\n    }\n    /**\n     * The namespace of this collection, in the format `${this.dbName}.${this.collectionName}`\n     */\n    get namespace() {\n        return this.fullNamespace.toString();\n    }\n    /**\n     *  @internal\n     *\n     * The `MongoDBNamespace` for the collection.\n     */\n    get fullNamespace() {\n        return this.s.namespace;\n    }\n    /**\n     * The current readConcern of the collection. If not explicitly defined for\n     * this collection, will be inherited from the parent DB\n     */\n    get readConcern() {\n        if (this.s.readConcern == null) {\n            return this.s.db.readConcern;\n        }\n        return this.s.readConcern;\n    }\n    /**\n     * The current readPreference of the collection. If not explicitly defined for\n     * this collection, will be inherited from the parent DB\n     */\n    get readPreference() {\n        if (this.s.readPreference == null) {\n            return this.s.db.readPreference;\n        }\n        return this.s.readPreference;\n    }\n    get bsonOptions() {\n        return this.s.bsonOptions;\n    }\n    /**\n     * The current writeConcern of the collection. If not explicitly defined for\n     * this collection, will be inherited from the parent DB\n     */\n    get writeConcern() {\n        if (this.s.writeConcern == null) {\n            return this.s.db.writeConcern;\n        }\n        return this.s.writeConcern;\n    }\n    /** The current index hint for the collection */\n    get hint() {\n        return this.s.collectionHint;\n    }\n    set hint(v) {\n        this.s.collectionHint = (0, utils_1.normalizeHintField)(v);\n    }\n    /**\n     * Inserts a single document into MongoDB. If documents passed in do not contain the **_id** field,\n     * one will be added to each of the documents missing it by the driver, mutating the document. This behavior\n     * can be overridden by setting the **forceServerObjectId** flag.\n     *\n     * @param doc - The document to insert\n     * @param options - Optional settings for the command\n     */\n    async insertOne(doc, options) {\n        return (0, execute_operation_1.executeOperation)(this.client, new insert_1.InsertOneOperation(this, doc, (0, utils_1.resolveOptions)(this, options)));\n    }\n    /**\n     * Inserts an array of documents into MongoDB. If documents passed in do not contain the **_id** field,\n     * one will be added to each of the documents missing it by the driver, mutating the document. This behavior\n     * can be overridden by setting the **forceServerObjectId** flag.\n     *\n     * @param docs - The documents to insert\n     * @param options - Optional settings for the command\n     */\n    async insertMany(docs, options) {\n        return (0, execute_operation_1.executeOperation)(this.client, new insert_1.InsertManyOperation(this, docs, (0, utils_1.resolveOptions)(this, options ?? { ordered: true })));\n    }\n    /**\n     * Perform a bulkWrite operation without a fluent API\n     *\n     * Legal operation types are\n     * - `insertOne`\n     * - `replaceOne`\n     * - `updateOne`\n     * - `updateMany`\n     * - `deleteOne`\n     * - `deleteMany`\n     *\n     * If documents passed in do not contain the **_id** field,\n     * one will be added to each of the documents missing it by the driver, mutating the document. This behavior\n     * can be overridden by setting the **forceServerObjectId** flag.\n     *\n     * @param operations - Bulk operations to perform\n     * @param options - Optional settings for the command\n     * @throws MongoDriverError if operations is not an array\n     */\n    async bulkWrite(operations, options) {\n        if (!Array.isArray(operations)) {\n            throw new error_1.MongoInvalidArgumentError('Argument \"operations\" must be an array of documents');\n        }\n        return (0, execute_operation_1.executeOperation)(this.client, new bulk_write_1.BulkWriteOperation(this, operations, (0, utils_1.resolveOptions)(this, options ?? { ordered: true })));\n    }\n    /**\n     * Update a single document in a collection\n     *\n     * @param filter - The filter used to select the document to update\n     * @param update - The update operations to be applied to the document\n     * @param options - Optional settings for the command\n     */\n    async updateOne(filter, update, options) {\n        return (0, execute_operation_1.executeOperation)(this.client, new update_2.UpdateOneOperation(this, filter, update, (0, utils_1.resolveOptions)(this, options)));\n    }\n    /**\n     * Replace a document in a collection with another document\n     *\n     * @param filter - The filter used to select the document to replace\n     * @param replacement - The Document that replaces the matching document\n     * @param options - Optional settings for the command\n     */\n    async replaceOne(filter, replacement, options) {\n        return (0, execute_operation_1.executeOperation)(this.client, new update_2.ReplaceOneOperation(this, filter, replacement, (0, utils_1.resolveOptions)(this, options)));\n    }\n    /**\n     * Update multiple documents in a collection\n     *\n     * @param filter - The filter used to select the documents to update\n     * @param update - The update operations to be applied to the documents\n     * @param options - Optional settings for the command\n     */\n    async updateMany(filter, update, options) {\n        return (0, execute_operation_1.executeOperation)(this.client, new update_2.UpdateManyOperation(this, filter, update, (0, utils_1.resolveOptions)(this, options)));\n    }\n    /**\n     * Delete a document from a collection\n     *\n     * @param filter - The filter used to select the document to remove\n     * @param options - Optional settings for the command\n     */\n    async deleteOne(filter = {}, options = {}) {\n        return (0, execute_operation_1.executeOperation)(this.client, new delete_1.DeleteOneOperation(this, filter, (0, utils_1.resolveOptions)(this, options)));\n    }\n    /**\n     * Delete multiple documents from a collection\n     *\n     * @param filter - The filter used to select the documents to remove\n     * @param options - Optional settings for the command\n     */\n    async deleteMany(filter = {}, options = {}) {\n        return (0, execute_operation_1.executeOperation)(this.client, new delete_1.DeleteManyOperation(this, filter, (0, utils_1.resolveOptions)(this, options)));\n    }\n    /**\n     * Rename the collection.\n     *\n     * @remarks\n     * This operation does not inherit options from the Db or MongoClient.\n     *\n     * @param newName - New name of of the collection.\n     * @param options - Optional settings for the command\n     */\n    async rename(newName, options) {\n        // Intentionally, we do not inherit options from parent for this operation.\n        return (0, execute_operation_1.executeOperation)(this.client, new rename_1.RenameOperation(this, newName, {\n            ...options,\n            readPreference: read_preference_1.ReadPreference.PRIMARY\n        }));\n    }\n    /**\n     * Drop the collection from the database, removing it permanently. New accesses will create a new collection.\n     *\n     * @param options - Optional settings for the command\n     */\n    async drop(options) {\n        return (0, execute_operation_1.executeOperation)(this.client, new drop_1.DropCollectionOperation(this.s.db, this.collectionName, options));\n    }\n    async findOne(filter = {}, options = {}) {\n        const cursor = this.find(filter, options).limit(-1).batchSize(1);\n        const res = await cursor.next();\n        await cursor.close();\n        return res;\n    }\n    find(filter = {}, options = {}) {\n        return new find_cursor_1.FindCursor(this.client, this.s.namespace, filter, (0, utils_1.resolveOptions)(this, options));\n    }\n    /**\n     * Returns the options of the collection.\n     *\n     * @param options - Optional settings for the command\n     */\n    async options(options) {\n        return (0, execute_operation_1.executeOperation)(this.client, new options_operation_1.OptionsOperation(this, (0, utils_1.resolveOptions)(this, options)));\n    }\n    /**\n     * Returns if the collection is a capped collection\n     *\n     * @param options - Optional settings for the command\n     */\n    async isCapped(options) {\n        return (0, execute_operation_1.executeOperation)(this.client, new is_capped_1.IsCappedOperation(this, (0, utils_1.resolveOptions)(this, options)));\n    }\n    /**\n     * Creates an index on the db and collection collection.\n     *\n     * @param indexSpec - The field name or index specification to create an index for\n     * @param options - Optional settings for the command\n     *\n     * @example\n     * ```ts\n     * const collection = client.db('foo').collection('bar');\n     *\n     * await collection.createIndex({ a: 1, b: -1 });\n     *\n     * // Alternate syntax for { c: 1, d: -1 } that ensures order of indexes\n     * await collection.createIndex([ [c, 1], [d, -1] ]);\n     *\n     * // Equivalent to { e: 1 }\n     * await collection.createIndex('e');\n     *\n     * // Equivalent to { f: 1, g: 1 }\n     * await collection.createIndex(['f', 'g'])\n     *\n     * // Equivalent to { h: 1, i: -1 }\n     * await collection.createIndex([ { h: 1 }, { i: -1 } ]);\n     *\n     * // Equivalent to { j: 1, k: -1, l: 2d }\n     * await collection.createIndex(['j', ['k', -1], { l: '2d' }])\n     * ```\n     */\n    async createIndex(indexSpec, options) {\n        return (0, execute_operation_1.executeOperation)(this.client, new indexes_1.CreateIndexOperation(this, this.collectionName, indexSpec, (0, utils_1.resolveOptions)(this, options)));\n    }\n    /**\n     * Creates multiple indexes in the collection, this method is only supported for\n     * MongoDB 2.6 or higher. Earlier version of MongoDB will throw a command not supported\n     * error.\n     *\n     * **Note**: Unlike {@link Collection#createIndex| createIndex}, this function takes in raw index specifications.\n     * Index specifications are defined {@link https://www.mongodb.com/docs/manual/reference/command/createIndexes/| here}.\n     *\n     * @param indexSpecs - An array of index specifications to be created\n     * @param options - Optional settings for the command\n     *\n     * @example\n     * ```ts\n     * const collection = client.db('foo').collection('bar');\n     * await collection.createIndexes([\n     *   // Simple index on field fizz\n     *   {\n     *     key: { fizz: 1 },\n     *   }\n     *   // wildcard index\n     *   {\n     *     key: { '$**': 1 }\n     *   },\n     *   // named index on darmok and jalad\n     *   {\n     *     key: { darmok: 1, jalad: -1 }\n     *     name: 'tanagra'\n     *   }\n     * ]);\n     * ```\n     */\n    async createIndexes(indexSpecs, options) {\n        return (0, execute_operation_1.executeOperation)(this.client, new indexes_1.CreateIndexesOperation(this, this.collectionName, indexSpecs, (0, utils_1.resolveOptions)(this, { ...options, maxTimeMS: undefined })));\n    }\n    /**\n     * Drops an index from this collection.\n     *\n     * @param indexName - Name of the index to drop.\n     * @param options - Optional settings for the command\n     */\n    async dropIndex(indexName, options) {\n        return (0, execute_operation_1.executeOperation)(this.client, new indexes_1.DropIndexOperation(this, indexName, {\n            ...(0, utils_1.resolveOptions)(this, options),\n            readPreference: read_preference_1.ReadPreference.primary\n        }));\n    }\n    /**\n     * Drops all indexes from this collection.\n     *\n     * @param options - Optional settings for the command\n     */\n    async dropIndexes(options) {\n        return (0, execute_operation_1.executeOperation)(this.client, new indexes_1.DropIndexesOperation(this, (0, utils_1.resolveOptions)(this, options)));\n    }\n    /**\n     * Get the list of all indexes information for the collection.\n     *\n     * @param options - Optional settings for the command\n     */\n    listIndexes(options) {\n        return new list_indexes_cursor_1.ListIndexesCursor(this, (0, utils_1.resolveOptions)(this, options));\n    }\n    /**\n     * Checks if one or more indexes exist on the collection, fails on first non-existing index\n     *\n     * @param indexes - One or more index names to check.\n     * @param options - Optional settings for the command\n     */\n    async indexExists(indexes, options) {\n        return (0, execute_operation_1.executeOperation)(this.client, new indexes_1.IndexExistsOperation(this, indexes, (0, utils_1.resolveOptions)(this, options)));\n    }\n    /**\n     * Retrieves this collections index info.\n     *\n     * @param options - Optional settings for the command\n     */\n    async indexInformation(options) {\n        return (0, execute_operation_1.executeOperation)(this.client, new indexes_1.IndexInformationOperation(this.s.db, this.collectionName, (0, utils_1.resolveOptions)(this, options)));\n    }\n    /**\n     * Gets an estimate of the count of documents in a collection using collection metadata.\n     * This will always run a count command on all server versions.\n     *\n     * due to an oversight in versions 5.0.0-5.0.8 of MongoDB, the count command,\n     * which estimatedDocumentCount uses in its implementation, was not included in v1 of\n     * the Stable API, and so users of the Stable API with estimatedDocumentCount are\n     * recommended to upgrade their server version to 5.0.9+ or set apiStrict: false to avoid\n     * encountering errors.\n     *\n     * @see {@link https://www.mongodb.com/docs/manual/reference/command/count/#behavior|Count: Behavior}\n     * @param options - Optional settings for the command\n     */\n    async estimatedDocumentCount(options) {\n        return (0, execute_operation_1.executeOperation)(this.client, new estimated_document_count_1.EstimatedDocumentCountOperation(this, (0, utils_1.resolveOptions)(this, options)));\n    }\n    /**\n     * Gets the number of documents matching the filter.\n     * For a fast count of the total documents in a collection see {@link Collection#estimatedDocumentCount| estimatedDocumentCount}.\n     * **Note**: When migrating from {@link Collection#count| count} to {@link Collection#countDocuments| countDocuments}\n     * the following query operators must be replaced:\n     *\n     * | Operator | Replacement |\n     * | -------- | ----------- |\n     * | `$where`   | [`$expr`][1] |\n     * | `$near`    | [`$geoWithin`][2] with [`$center`][3] |\n     * | `$nearSphere` | [`$geoWithin`][2] with [`$centerSphere`][4] |\n     *\n     * [1]: https://www.mongodb.com/docs/manual/reference/operator/query/expr/\n     * [2]: https://www.mongodb.com/docs/manual/reference/operator/query/geoWithin/\n     * [3]: https://www.mongodb.com/docs/manual/reference/operator/query/center/#op._S_center\n     * [4]: https://www.mongodb.com/docs/manual/reference/operator/query/centerSphere/#op._S_centerSphere\n     *\n     * @param filter - The filter for the count\n     * @param options - Optional settings for the command\n     *\n     * @see https://www.mongodb.com/docs/manual/reference/operator/query/expr/\n     * @see https://www.mongodb.com/docs/manual/reference/operator/query/geoWithin/\n     * @see https://www.mongodb.com/docs/manual/reference/operator/query/center/#op._S_center\n     * @see https://www.mongodb.com/docs/manual/reference/operator/query/centerSphere/#op._S_centerSphere\n     */\n    async countDocuments(filter = {}, options = {}) {\n        return (0, execute_operation_1.executeOperation)(this.client, new count_documents_1.CountDocumentsOperation(this, filter, (0, utils_1.resolveOptions)(this, options)));\n    }\n    async distinct(key, filter = {}, options = {}) {\n        return (0, execute_operation_1.executeOperation)(this.client, new distinct_1.DistinctOperation(this, key, filter, (0, utils_1.resolveOptions)(this, options)));\n    }\n    /**\n     * Retrieve all the indexes on the collection.\n     *\n     * @param options - Optional settings for the command\n     */\n    async indexes(options) {\n        return (0, execute_operation_1.executeOperation)(this.client, new indexes_1.IndexesOperation(this, (0, utils_1.resolveOptions)(this, options)));\n    }\n    /**\n     * Get all the collection statistics.\n     *\n     * @deprecated the `collStats` operation will be removed in the next major release.  Please\n     * use an aggregation pipeline with the [`$collStats`](https://www.mongodb.com/docs/manual/reference/operator/aggregation/collStats/) stage instead\n     *\n     * @param options - Optional settings for the command\n     */\n    async stats(options) {\n        return (0, execute_operation_1.executeOperation)(this.client, new stats_1.CollStatsOperation(this, options));\n    }\n    async findOneAndDelete(filter, options) {\n        return (0, execute_operation_1.executeOperation)(this.client, new find_and_modify_1.FindOneAndDeleteOperation(this, filter, (0, utils_1.resolveOptions)(this, options)));\n    }\n    async findOneAndReplace(filter, replacement, options) {\n        return (0, execute_operation_1.executeOperation)(this.client, new find_and_modify_1.FindOneAndReplaceOperation(this, filter, replacement, (0, utils_1.resolveOptions)(this, options)));\n    }\n    async findOneAndUpdate(filter, update, options) {\n        return (0, execute_operation_1.executeOperation)(this.client, new find_and_modify_1.FindOneAndUpdateOperation(this, filter, update, (0, utils_1.resolveOptions)(this, options)));\n    }\n    /**\n     * Execute an aggregation framework pipeline against the collection, needs MongoDB \\>= 2.2\n     *\n     * @param pipeline - An array of aggregation pipelines to execute\n     * @param options - Optional settings for the command\n     */\n    aggregate(pipeline = [], options) {\n        if (!Array.isArray(pipeline)) {\n            throw new error_1.MongoInvalidArgumentError('Argument \"pipeline\" must be an array of aggregation stages');\n        }\n        return new aggregation_cursor_1.AggregationCursor(this.client, this.s.namespace, pipeline, (0, utils_1.resolveOptions)(this, options));\n    }\n    /**\n     * Create a new Change Stream, watching for new changes (insertions, updates, replacements, deletions, and invalidations) in this collection.\n     *\n     * @remarks\n     * watch() accepts two generic arguments for distinct use cases:\n     * - The first is to override the schema that may be defined for this specific collection\n     * - The second is to override the shape of the change stream document entirely, if it is not provided the type will default to ChangeStreamDocument of the first argument\n     * @example\n     * By just providing the first argument I can type the change to be `ChangeStreamDocument<{ _id: number }>`\n     * ```ts\n     * collection.watch<{ _id: number }>()\n     *   .on('change', change => console.log(change._id.toFixed(4)));\n     * ```\n     *\n     * @example\n     * Passing a second argument provides a way to reflect the type changes caused by an advanced pipeline.\n     * Here, we are using a pipeline to have MongoDB filter for insert changes only and add a comment.\n     * No need start from scratch on the ChangeStreamInsertDocument type!\n     * By using an intersection we can save time and ensure defaults remain the same type!\n     * ```ts\n     * collection\n     *   .watch<Schema, ChangeStreamInsertDocument<Schema> & { comment: string }>([\n     *     { $addFields: { comment: 'big changes' } },\n     *     { $match: { operationType: 'insert' } }\n     *   ])\n     *   .on('change', change => {\n     *     change.comment.startsWith('big');\n     *     change.operationType === 'insert';\n     *     // No need to narrow in code because the generics did that for us!\n     *     expectType<Schema>(change.fullDocument);\n     *   });\n     * ```\n     *\n     * @param pipeline - An array of {@link https://www.mongodb.com/docs/manual/reference/operator/aggregation-pipeline/|aggregation pipeline stages} through which to pass change stream documents. This allows for filtering (using $match) and manipulating the change stream documents.\n     * @param options - Optional settings for the command\n     * @typeParam TLocal - Type of the data being detected by the change stream\n     * @typeParam TChange - Type of the whole change stream document emitted\n     */\n    watch(pipeline = [], options = {}) {\n        // Allow optionally not specifying a pipeline\n        if (!Array.isArray(pipeline)) {\n            options = pipeline;\n            pipeline = [];\n        }\n        return new change_stream_1.ChangeStream(this, pipeline, (0, utils_1.resolveOptions)(this, options));\n    }\n    /**\n     * Initiate an Out of order batch write operation. All operations will be buffered into insert/update/remove commands executed out of order.\n     *\n     * @throws MongoNotConnectedError\n     * @remarks\n     * **NOTE:** MongoClient must be connected prior to calling this method due to a known limitation in this legacy implementation.\n     * However, `collection.bulkWrite()` provides an equivalent API that does not require prior connecting.\n     */\n    initializeUnorderedBulkOp(options) {\n        return new unordered_1.UnorderedBulkOperation(this, (0, utils_1.resolveOptions)(this, options));\n    }\n    /**\n     * Initiate an In order bulk write operation. Operations will be serially executed in the order they are added, creating a new operation for each switch in types.\n     *\n     * @throws MongoNotConnectedError\n     * @remarks\n     * **NOTE:** MongoClient must be connected prior to calling this method due to a known limitation in this legacy implementation.\n     * However, `collection.bulkWrite()` provides an equivalent API that does not require prior connecting.\n     */\n    initializeOrderedBulkOp(options) {\n        return new ordered_1.OrderedBulkOperation(this, (0, utils_1.resolveOptions)(this, options));\n    }\n    /**\n     * An estimated count of matching documents in the db to a filter.\n     *\n     * **NOTE:** This method has been deprecated, since it does not provide an accurate count of the documents\n     * in a collection. To obtain an accurate count of documents in the collection, use {@link Collection#countDocuments| countDocuments}.\n     * To obtain an estimated count of all documents in the collection, use {@link Collection#estimatedDocumentCount| estimatedDocumentCount}.\n     *\n     * @deprecated use {@link Collection#countDocuments| countDocuments} or {@link Collection#estimatedDocumentCount| estimatedDocumentCount} instead\n     *\n     * @param filter - The filter for the count.\n     * @param options - Optional settings for the command\n     */\n    async count(filter = {}, options = {}) {\n        return (0, execute_operation_1.executeOperation)(this.client, new count_1.CountOperation(this.fullNamespace, filter, (0, utils_1.resolveOptions)(this, options)));\n    }\n    listSearchIndexes(indexNameOrOptions, options) {\n        options =\n            typeof indexNameOrOptions === 'object' ? indexNameOrOptions : options == null ? {} : options;\n        const indexName = indexNameOrOptions == null\n            ? null\n            : typeof indexNameOrOptions === 'object'\n                ? null\n                : indexNameOrOptions;\n        return new list_search_indexes_cursor_1.ListSearchIndexesCursor(this, indexName, options);\n    }\n    /**\n     * Creates a single search index for the collection.\n     *\n     * @param description - The index description for the new search index.\n     * @returns A promise that resolves to the name of the new search index.\n     *\n     * @remarks Only available when used against a 7.0+ Atlas cluster.\n     */\n    async createSearchIndex(description) {\n        const [index] = await this.createSearchIndexes([description]);\n        return index;\n    }\n    /**\n     * Creates multiple search indexes for the current collection.\n     *\n     * @param descriptions - An array of `SearchIndexDescription`s for the new search indexes.\n     * @returns A promise that resolves to an array of the newly created search index names.\n     *\n     * @remarks Only available when used against a 7.0+ Atlas cluster.\n     * @returns\n     */\n    async createSearchIndexes(descriptions) {\n        return (0, execute_operation_1.executeOperation)(this.client, new create_1.CreateSearchIndexesOperation(this, descriptions));\n    }\n    /**\n     * Deletes a search index by index name.\n     *\n     * @param name - The name of the search index to be deleted.\n     *\n     * @remarks Only available when used against a 7.0+ Atlas cluster.\n     */\n    async dropSearchIndex(name) {\n        return (0, execute_operation_1.executeOperation)(this.client, new drop_2.DropSearchIndexOperation(this, name));\n    }\n    /**\n     * Updates a search index by replacing the existing index definition with the provided definition.\n     *\n     * @param name - The name of the search index to update.\n     * @param definition - The new search index definition.\n     *\n     * @remarks Only available when used against a 7.0+ Atlas cluster.\n     */\n    async updateSearchIndex(name, definition) {\n        return (0, execute_operation_1.executeOperation)(this.client, new update_1.UpdateSearchIndexOperation(this, name, definition));\n    }\n}\nexports.Collection = Collection;\n//# sourceMappingURL=collection.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jb2xsZWN0aW9uLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELGtCQUFrQjtBQUNsQixlQUFlLG1CQUFPLENBQUMsZ0VBQVE7QUFDL0Isa0JBQWtCLG1CQUFPLENBQUMsZ0ZBQWdCO0FBQzFDLG9CQUFvQixtQkFBTyxDQUFDLG9GQUFrQjtBQUM5Qyx3QkFBd0IsbUJBQU8sQ0FBQyxrRkFBaUI7QUFDakQsNkJBQTZCLG1CQUFPLENBQUMsMEdBQTZCO0FBQ2xFLHNCQUFzQixtQkFBTyxDQUFDLDRGQUFzQjtBQUNwRCw4QkFBOEIsbUJBQU8sQ0FBQyw0R0FBOEI7QUFDcEUscUNBQXFDLG1CQUFPLENBQUMsMEhBQXFDO0FBQ2xGLGdCQUFnQixtQkFBTyxDQUFDLGtFQUFTO0FBQ2pDLHFCQUFxQixtQkFBTyxDQUFDLGtHQUF5QjtBQUN0RCxnQkFBZ0IsbUJBQU8sQ0FBQyx3RkFBb0I7QUFDNUMsMEJBQTBCLG1CQUFPLENBQUMsNEdBQThCO0FBQ2hFLGlCQUFpQixtQkFBTyxDQUFDLDBGQUFxQjtBQUM5QyxtQkFBbUIsbUJBQU8sQ0FBQyw4RkFBdUI7QUFDbEQsZUFBZSxtQkFBTyxDQUFDLHNGQUFtQjtBQUMxQyxtQ0FBbUMsbUJBQU8sQ0FBQyw4SEFBdUM7QUFDbEYsNEJBQTRCLG1CQUFPLENBQUMsZ0hBQWdDO0FBQ3BFLDBCQUEwQixtQkFBTyxDQUFDLDRHQUE4QjtBQUNoRSxrQkFBa0IsbUJBQU8sQ0FBQyw0RkFBc0I7QUFDaEQsaUJBQWlCLG1CQUFPLENBQUMsMEZBQXFCO0FBQzlDLG9CQUFvQixtQkFBTyxDQUFDLGdHQUF3QjtBQUNwRCw0QkFBNEIsbUJBQU8sQ0FBQyxnSEFBZ0M7QUFDcEUsaUJBQWlCLG1CQUFPLENBQUMsMEZBQXFCO0FBQzlDLGlCQUFpQixtQkFBTyxDQUFDLHdIQUFvQztBQUM3RCxlQUFlLG1CQUFPLENBQUMsb0hBQWtDO0FBQ3pELGlCQUFpQixtQkFBTyxDQUFDLHdIQUFvQztBQUM3RCxnQkFBZ0IsbUJBQU8sQ0FBQyx3RkFBb0I7QUFDNUMsaUJBQWlCLG1CQUFPLENBQUMsMEZBQXFCO0FBQzlDLHVCQUF1QixtQkFBTyxDQUFDLGdGQUFnQjtBQUMvQywwQkFBMEIsbUJBQU8sQ0FBQyxzRkFBbUI7QUFDckQsZ0JBQWdCLG1CQUFPLENBQUMsa0VBQVM7QUFDakMsd0JBQXdCLG1CQUFPLENBQUMsa0ZBQWlCO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksY0FBYztBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsVUFBVSxPQUFPLFNBQVM7QUFDOUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMERBQTBELFlBQVksR0FBRyxvQkFBb0I7QUFDN0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0tBQWtLLGVBQWU7QUFDakw7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMktBQTJLLGVBQWU7QUFDMUw7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsY0FBYztBQUM3QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDLGNBQWM7QUFDOUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCLGNBQWM7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixjQUFjO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0NBQXNDLGFBQWE7QUFDbkQ7QUFDQSxpQ0FBaUMsY0FBYztBQUMvQztBQUNBO0FBQ0EsMEJBQTBCO0FBQzFCO0FBQ0E7QUFDQSwwQkFBMEI7QUFDMUI7QUFDQTtBQUNBLDBCQUEwQjtBQUMxQix3Q0FBd0MsTUFBTSxJQUFJLFFBQVE7QUFDMUQ7QUFDQSwwQkFBMEI7QUFDMUIsdURBQXVELFNBQVM7QUFDaEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUIsMENBQTBDO0FBQ25FLHlDQUF5QyxpRkFBaUY7QUFDMUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0IsU0FBUztBQUMzQjtBQUNBO0FBQ0E7QUFDQSxrQkFBa0I7QUFDbEIsVUFBVTtBQUNWO0FBQ0E7QUFDQSxrQkFBa0I7QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0xBQXNMLGtDQUFrQztBQUN4TjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvRUFBb0UsZ0VBQWdFO0FBQ3BJLHNDQUFzQywrQkFBK0IsSUFBSTtBQUN6RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQ0FBb0MsY0FBYztBQUNsRDtBQUNBO0FBQ0EsbUNBQW1DLGNBQWM7QUFDakQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdHQUFnRyxhQUFhO0FBQzdHO0FBQ0EsMEJBQTBCLGFBQWE7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrREFBK0QsaUJBQWlCO0FBQ2hGLGFBQWEsY0FBYywwQkFBMEI7QUFDckQsYUFBYSxVQUFVO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0Esc0NBQXNDLGdIQUFnSDtBQUN0SjtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFDQUFxQztBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5RkFBeUYsZ0RBQWdEO0FBQ3pJLDZFQUE2RSxnRUFBZ0U7QUFDN0k7QUFDQSx3QkFBd0IsaURBQWlELElBQUksaUVBQWlFO0FBQzlJO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLGNBQWM7QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrRkFBK0Y7QUFDL0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQjtBQUNsQiIsInNvdXJjZXMiOlsiRDpcXHNhbG9uaVxcYXBwcmFpc2FsLXN5c3RlbVxcc2VydmVyXFxub2RlX21vZHVsZXNcXG1vbmdvZGJcXGxpYlxcY29sbGVjdGlvbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuQ29sbGVjdGlvbiA9IHZvaWQgMDtcbmNvbnN0IGJzb25fMSA9IHJlcXVpcmUoXCIuL2Jzb25cIik7XG5jb25zdCBvcmRlcmVkXzEgPSByZXF1aXJlKFwiLi9idWxrL29yZGVyZWRcIik7XG5jb25zdCB1bm9yZGVyZWRfMSA9IHJlcXVpcmUoXCIuL2J1bGsvdW5vcmRlcmVkXCIpO1xuY29uc3QgY2hhbmdlX3N0cmVhbV8xID0gcmVxdWlyZShcIi4vY2hhbmdlX3N0cmVhbVwiKTtcbmNvbnN0IGFnZ3JlZ2F0aW9uX2N1cnNvcl8xID0gcmVxdWlyZShcIi4vY3Vyc29yL2FnZ3JlZ2F0aW9uX2N1cnNvclwiKTtcbmNvbnN0IGZpbmRfY3Vyc29yXzEgPSByZXF1aXJlKFwiLi9jdXJzb3IvZmluZF9jdXJzb3JcIik7XG5jb25zdCBsaXN0X2luZGV4ZXNfY3Vyc29yXzEgPSByZXF1aXJlKFwiLi9jdXJzb3IvbGlzdF9pbmRleGVzX2N1cnNvclwiKTtcbmNvbnN0IGxpc3Rfc2VhcmNoX2luZGV4ZXNfY3Vyc29yXzEgPSByZXF1aXJlKFwiLi9jdXJzb3IvbGlzdF9zZWFyY2hfaW5kZXhlc19jdXJzb3JcIik7XG5jb25zdCBlcnJvcl8xID0gcmVxdWlyZShcIi4vZXJyb3JcIik7XG5jb25zdCBidWxrX3dyaXRlXzEgPSByZXF1aXJlKFwiLi9vcGVyYXRpb25zL2J1bGtfd3JpdGVcIik7XG5jb25zdCBjb3VudF8xID0gcmVxdWlyZShcIi4vb3BlcmF0aW9ucy9jb3VudFwiKTtcbmNvbnN0IGNvdW50X2RvY3VtZW50c18xID0gcmVxdWlyZShcIi4vb3BlcmF0aW9ucy9jb3VudF9kb2N1bWVudHNcIik7XG5jb25zdCBkZWxldGVfMSA9IHJlcXVpcmUoXCIuL29wZXJhdGlvbnMvZGVsZXRlXCIpO1xuY29uc3QgZGlzdGluY3RfMSA9IHJlcXVpcmUoXCIuL29wZXJhdGlvbnMvZGlzdGluY3RcIik7XG5jb25zdCBkcm9wXzEgPSByZXF1aXJlKFwiLi9vcGVyYXRpb25zL2Ryb3BcIik7XG5jb25zdCBlc3RpbWF0ZWRfZG9jdW1lbnRfY291bnRfMSA9IHJlcXVpcmUoXCIuL29wZXJhdGlvbnMvZXN0aW1hdGVkX2RvY3VtZW50X2NvdW50XCIpO1xuY29uc3QgZXhlY3V0ZV9vcGVyYXRpb25fMSA9IHJlcXVpcmUoXCIuL29wZXJhdGlvbnMvZXhlY3V0ZV9vcGVyYXRpb25cIik7XG5jb25zdCBmaW5kX2FuZF9tb2RpZnlfMSA9IHJlcXVpcmUoXCIuL29wZXJhdGlvbnMvZmluZF9hbmRfbW9kaWZ5XCIpO1xuY29uc3QgaW5kZXhlc18xID0gcmVxdWlyZShcIi4vb3BlcmF0aW9ucy9pbmRleGVzXCIpO1xuY29uc3QgaW5zZXJ0XzEgPSByZXF1aXJlKFwiLi9vcGVyYXRpb25zL2luc2VydFwiKTtcbmNvbnN0IGlzX2NhcHBlZF8xID0gcmVxdWlyZShcIi4vb3BlcmF0aW9ucy9pc19jYXBwZWRcIik7XG5jb25zdCBvcHRpb25zX29wZXJhdGlvbl8xID0gcmVxdWlyZShcIi4vb3BlcmF0aW9ucy9vcHRpb25zX29wZXJhdGlvblwiKTtcbmNvbnN0IHJlbmFtZV8xID0gcmVxdWlyZShcIi4vb3BlcmF0aW9ucy9yZW5hbWVcIik7XG5jb25zdCBjcmVhdGVfMSA9IHJlcXVpcmUoXCIuL29wZXJhdGlvbnMvc2VhcmNoX2luZGV4ZXMvY3JlYXRlXCIpO1xuY29uc3QgZHJvcF8yID0gcmVxdWlyZShcIi4vb3BlcmF0aW9ucy9zZWFyY2hfaW5kZXhlcy9kcm9wXCIpO1xuY29uc3QgdXBkYXRlXzEgPSByZXF1aXJlKFwiLi9vcGVyYXRpb25zL3NlYXJjaF9pbmRleGVzL3VwZGF0ZVwiKTtcbmNvbnN0IHN0YXRzXzEgPSByZXF1aXJlKFwiLi9vcGVyYXRpb25zL3N0YXRzXCIpO1xuY29uc3QgdXBkYXRlXzIgPSByZXF1aXJlKFwiLi9vcGVyYXRpb25zL3VwZGF0ZVwiKTtcbmNvbnN0IHJlYWRfY29uY2Vybl8xID0gcmVxdWlyZShcIi4vcmVhZF9jb25jZXJuXCIpO1xuY29uc3QgcmVhZF9wcmVmZXJlbmNlXzEgPSByZXF1aXJlKFwiLi9yZWFkX3ByZWZlcmVuY2VcIik7XG5jb25zdCB1dGlsc18xID0gcmVxdWlyZShcIi4vdXRpbHNcIik7XG5jb25zdCB3cml0ZV9jb25jZXJuXzEgPSByZXF1aXJlKFwiLi93cml0ZV9jb25jZXJuXCIpO1xuLyoqXG4gKiBUaGUgKipDb2xsZWN0aW9uKiogY2xhc3MgaXMgYW4gaW50ZXJuYWwgY2xhc3MgdGhhdCBlbWJvZGllcyBhIE1vbmdvREIgY29sbGVjdGlvblxuICogYWxsb3dpbmcgZm9yIGluc2VydC9maW5kL3VwZGF0ZS9kZWxldGUgYW5kIG90aGVyIGNvbW1hbmQgb3BlcmF0aW9uIG9uIHRoYXQgTW9uZ29EQiBjb2xsZWN0aW9uLlxuICpcbiAqICoqQ09MTEVDVElPTiBDYW5ub3QgZGlyZWN0bHkgYmUgaW5zdGFudGlhdGVkKipcbiAqIEBwdWJsaWNcbiAqXG4gKiBAZXhhbXBsZVxuICogYGBgdHNcbiAqIGltcG9ydCB7IE1vbmdvQ2xpZW50IH0gZnJvbSAnbW9uZ29kYic7XG4gKlxuICogaW50ZXJmYWNlIFBldCB7XG4gKiAgIG5hbWU6IHN0cmluZztcbiAqICAga2luZDogJ2RvZycgfCAnY2F0JyB8ICdmaXNoJztcbiAqIH1cbiAqXG4gKiBjb25zdCBjbGllbnQgPSBuZXcgTW9uZ29DbGllbnQoJ21vbmdvZGI6Ly9sb2NhbGhvc3Q6MjcwMTcnKTtcbiAqIGNvbnN0IHBldHMgPSBjbGllbnQuZGIoKS5jb2xsZWN0aW9uPFBldD4oJ3BldHMnKTtcbiAqXG4gKiBjb25zdCBwZXRDdXJzb3IgPSBwZXRzLmZpbmQoKTtcbiAqXG4gKiBmb3IgYXdhaXQgKGNvbnN0IHBldCBvZiBwZXRDdXJzb3IpIHtcbiAqICAgY29uc29sZS5sb2coYCR7cGV0Lm5hbWV9IGlzIGEgJHtwZXQua2luZH0hYCk7XG4gKiB9XG4gKiBgYGBcbiAqL1xuY2xhc3MgQ29sbGVjdGlvbiB7XG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgbmV3IENvbGxlY3Rpb24gaW5zdGFuY2VcbiAgICAgKiBAaW50ZXJuYWxcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihkYiwgbmFtZSwgb3B0aW9ucykge1xuICAgICAgICAoMCwgdXRpbHNfMS5jaGVja0NvbGxlY3Rpb25OYW1lKShuYW1lKTtcbiAgICAgICAgLy8gSW50ZXJuYWwgc3RhdGVcbiAgICAgICAgdGhpcy5zID0ge1xuICAgICAgICAgICAgZGIsXG4gICAgICAgICAgICBvcHRpb25zLFxuICAgICAgICAgICAgbmFtZXNwYWNlOiBuZXcgdXRpbHNfMS5Nb25nb0RCQ29sbGVjdGlvbk5hbWVzcGFjZShkYi5kYXRhYmFzZU5hbWUsIG5hbWUpLFxuICAgICAgICAgICAgcGtGYWN0b3J5OiBkYi5vcHRpb25zPy5wa0ZhY3RvcnkgPz8gdXRpbHNfMS5ERUZBVUxUX1BLX0ZBQ1RPUlksXG4gICAgICAgICAgICByZWFkUHJlZmVyZW5jZTogcmVhZF9wcmVmZXJlbmNlXzEuUmVhZFByZWZlcmVuY2UuZnJvbU9wdGlvbnMob3B0aW9ucyksXG4gICAgICAgICAgICBic29uT3B0aW9uczogKDAsIGJzb25fMS5yZXNvbHZlQlNPTk9wdGlvbnMpKG9wdGlvbnMsIGRiKSxcbiAgICAgICAgICAgIHJlYWRDb25jZXJuOiByZWFkX2NvbmNlcm5fMS5SZWFkQ29uY2Vybi5mcm9tT3B0aW9ucyhvcHRpb25zKSxcbiAgICAgICAgICAgIHdyaXRlQ29uY2Vybjogd3JpdGVfY29uY2Vybl8xLldyaXRlQ29uY2Vybi5mcm9tT3B0aW9ucyhvcHRpb25zKVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmNsaWVudCA9IGRiLmNsaWVudDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVGhlIG5hbWUgb2YgdGhlIGRhdGFiYXNlIHRoaXMgY29sbGVjdGlvbiBiZWxvbmdzIHRvXG4gICAgICovXG4gICAgZ2V0IGRiTmFtZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucy5uYW1lc3BhY2UuZGI7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRoZSBuYW1lIG9mIHRoaXMgY29sbGVjdGlvblxuICAgICAqL1xuICAgIGdldCBjb2xsZWN0aW9uTmFtZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucy5uYW1lc3BhY2UuY29sbGVjdGlvbjtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVGhlIG5hbWVzcGFjZSBvZiB0aGlzIGNvbGxlY3Rpb24sIGluIHRoZSBmb3JtYXQgYCR7dGhpcy5kYk5hbWV9LiR7dGhpcy5jb2xsZWN0aW9uTmFtZX1gXG4gICAgICovXG4gICAgZ2V0IG5hbWVzcGFjZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZnVsbE5hbWVzcGFjZS50b1N0cmluZygpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiAgQGludGVybmFsXG4gICAgICpcbiAgICAgKiBUaGUgYE1vbmdvREJOYW1lc3BhY2VgIGZvciB0aGUgY29sbGVjdGlvbi5cbiAgICAgKi9cbiAgICBnZXQgZnVsbE5hbWVzcGFjZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucy5uYW1lc3BhY2U7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRoZSBjdXJyZW50IHJlYWRDb25jZXJuIG9mIHRoZSBjb2xsZWN0aW9uLiBJZiBub3QgZXhwbGljaXRseSBkZWZpbmVkIGZvclxuICAgICAqIHRoaXMgY29sbGVjdGlvbiwgd2lsbCBiZSBpbmhlcml0ZWQgZnJvbSB0aGUgcGFyZW50IERCXG4gICAgICovXG4gICAgZ2V0IHJlYWRDb25jZXJuKCkge1xuICAgICAgICBpZiAodGhpcy5zLnJlYWRDb25jZXJuID09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnMuZGIucmVhZENvbmNlcm47XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMucy5yZWFkQ29uY2VybjtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVGhlIGN1cnJlbnQgcmVhZFByZWZlcmVuY2Ugb2YgdGhlIGNvbGxlY3Rpb24uIElmIG5vdCBleHBsaWNpdGx5IGRlZmluZWQgZm9yXG4gICAgICogdGhpcyBjb2xsZWN0aW9uLCB3aWxsIGJlIGluaGVyaXRlZCBmcm9tIHRoZSBwYXJlbnQgREJcbiAgICAgKi9cbiAgICBnZXQgcmVhZFByZWZlcmVuY2UoKSB7XG4gICAgICAgIGlmICh0aGlzLnMucmVhZFByZWZlcmVuY2UgPT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMucy5kYi5yZWFkUHJlZmVyZW5jZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5zLnJlYWRQcmVmZXJlbmNlO1xuICAgIH1cbiAgICBnZXQgYnNvbk9wdGlvbnMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnMuYnNvbk9wdGlvbnM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRoZSBjdXJyZW50IHdyaXRlQ29uY2VybiBvZiB0aGUgY29sbGVjdGlvbi4gSWYgbm90IGV4cGxpY2l0bHkgZGVmaW5lZCBmb3JcbiAgICAgKiB0aGlzIGNvbGxlY3Rpb24sIHdpbGwgYmUgaW5oZXJpdGVkIGZyb20gdGhlIHBhcmVudCBEQlxuICAgICAqL1xuICAgIGdldCB3cml0ZUNvbmNlcm4oKSB7XG4gICAgICAgIGlmICh0aGlzLnMud3JpdGVDb25jZXJuID09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnMuZGIud3JpdGVDb25jZXJuO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLnMud3JpdGVDb25jZXJuO1xuICAgIH1cbiAgICAvKiogVGhlIGN1cnJlbnQgaW5kZXggaGludCBmb3IgdGhlIGNvbGxlY3Rpb24gKi9cbiAgICBnZXQgaGludCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucy5jb2xsZWN0aW9uSGludDtcbiAgICB9XG4gICAgc2V0IGhpbnQodikge1xuICAgICAgICB0aGlzLnMuY29sbGVjdGlvbkhpbnQgPSAoMCwgdXRpbHNfMS5ub3JtYWxpemVIaW50RmllbGQpKHYpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBJbnNlcnRzIGEgc2luZ2xlIGRvY3VtZW50IGludG8gTW9uZ29EQi4gSWYgZG9jdW1lbnRzIHBhc3NlZCBpbiBkbyBub3QgY29udGFpbiB0aGUgKipfaWQqKiBmaWVsZCxcbiAgICAgKiBvbmUgd2lsbCBiZSBhZGRlZCB0byBlYWNoIG9mIHRoZSBkb2N1bWVudHMgbWlzc2luZyBpdCBieSB0aGUgZHJpdmVyLCBtdXRhdGluZyB0aGUgZG9jdW1lbnQuIFRoaXMgYmVoYXZpb3JcbiAgICAgKiBjYW4gYmUgb3ZlcnJpZGRlbiBieSBzZXR0aW5nIHRoZSAqKmZvcmNlU2VydmVyT2JqZWN0SWQqKiBmbGFnLlxuICAgICAqXG4gICAgICogQHBhcmFtIGRvYyAtIFRoZSBkb2N1bWVudCB0byBpbnNlcnRcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzIGZvciB0aGUgY29tbWFuZFxuICAgICAqL1xuICAgIGFzeW5jIGluc2VydE9uZShkb2MsIG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuICgwLCBleGVjdXRlX29wZXJhdGlvbl8xLmV4ZWN1dGVPcGVyYXRpb24pKHRoaXMuY2xpZW50LCBuZXcgaW5zZXJ0XzEuSW5zZXJ0T25lT3BlcmF0aW9uKHRoaXMsIGRvYywgKDAsIHV0aWxzXzEucmVzb2x2ZU9wdGlvbnMpKHRoaXMsIG9wdGlvbnMpKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEluc2VydHMgYW4gYXJyYXkgb2YgZG9jdW1lbnRzIGludG8gTW9uZ29EQi4gSWYgZG9jdW1lbnRzIHBhc3NlZCBpbiBkbyBub3QgY29udGFpbiB0aGUgKipfaWQqKiBmaWVsZCxcbiAgICAgKiBvbmUgd2lsbCBiZSBhZGRlZCB0byBlYWNoIG9mIHRoZSBkb2N1bWVudHMgbWlzc2luZyBpdCBieSB0aGUgZHJpdmVyLCBtdXRhdGluZyB0aGUgZG9jdW1lbnQuIFRoaXMgYmVoYXZpb3JcbiAgICAgKiBjYW4gYmUgb3ZlcnJpZGRlbiBieSBzZXR0aW5nIHRoZSAqKmZvcmNlU2VydmVyT2JqZWN0SWQqKiBmbGFnLlxuICAgICAqXG4gICAgICogQHBhcmFtIGRvY3MgLSBUaGUgZG9jdW1lbnRzIHRvIGluc2VydFxuICAgICAqIEBwYXJhbSBvcHRpb25zIC0gT3B0aW9uYWwgc2V0dGluZ3MgZm9yIHRoZSBjb21tYW5kXG4gICAgICovXG4gICAgYXN5bmMgaW5zZXJ0TWFueShkb2NzLCBvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiAoMCwgZXhlY3V0ZV9vcGVyYXRpb25fMS5leGVjdXRlT3BlcmF0aW9uKSh0aGlzLmNsaWVudCwgbmV3IGluc2VydF8xLkluc2VydE1hbnlPcGVyYXRpb24odGhpcywgZG9jcywgKDAsIHV0aWxzXzEucmVzb2x2ZU9wdGlvbnMpKHRoaXMsIG9wdGlvbnMgPz8geyBvcmRlcmVkOiB0cnVlIH0pKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFBlcmZvcm0gYSBidWxrV3JpdGUgb3BlcmF0aW9uIHdpdGhvdXQgYSBmbHVlbnQgQVBJXG4gICAgICpcbiAgICAgKiBMZWdhbCBvcGVyYXRpb24gdHlwZXMgYXJlXG4gICAgICogLSBgaW5zZXJ0T25lYFxuICAgICAqIC0gYHJlcGxhY2VPbmVgXG4gICAgICogLSBgdXBkYXRlT25lYFxuICAgICAqIC0gYHVwZGF0ZU1hbnlgXG4gICAgICogLSBgZGVsZXRlT25lYFxuICAgICAqIC0gYGRlbGV0ZU1hbnlgXG4gICAgICpcbiAgICAgKiBJZiBkb2N1bWVudHMgcGFzc2VkIGluIGRvIG5vdCBjb250YWluIHRoZSAqKl9pZCoqIGZpZWxkLFxuICAgICAqIG9uZSB3aWxsIGJlIGFkZGVkIHRvIGVhY2ggb2YgdGhlIGRvY3VtZW50cyBtaXNzaW5nIGl0IGJ5IHRoZSBkcml2ZXIsIG11dGF0aW5nIHRoZSBkb2N1bWVudC4gVGhpcyBiZWhhdmlvclxuICAgICAqIGNhbiBiZSBvdmVycmlkZGVuIGJ5IHNldHRpbmcgdGhlICoqZm9yY2VTZXJ2ZXJPYmplY3RJZCoqIGZsYWcuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gb3BlcmF0aW9ucyAtIEJ1bGsgb3BlcmF0aW9ucyB0byBwZXJmb3JtXG4gICAgICogQHBhcmFtIG9wdGlvbnMgLSBPcHRpb25hbCBzZXR0aW5ncyBmb3IgdGhlIGNvbW1hbmRcbiAgICAgKiBAdGhyb3dzIE1vbmdvRHJpdmVyRXJyb3IgaWYgb3BlcmF0aW9ucyBpcyBub3QgYW4gYXJyYXlcbiAgICAgKi9cbiAgICBhc3luYyBidWxrV3JpdGUob3BlcmF0aW9ucywgb3B0aW9ucykge1xuICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkob3BlcmF0aW9ucykpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoJ0FyZ3VtZW50IFwib3BlcmF0aW9uc1wiIG11c3QgYmUgYW4gYXJyYXkgb2YgZG9jdW1lbnRzJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICgwLCBleGVjdXRlX29wZXJhdGlvbl8xLmV4ZWN1dGVPcGVyYXRpb24pKHRoaXMuY2xpZW50LCBuZXcgYnVsa193cml0ZV8xLkJ1bGtXcml0ZU9wZXJhdGlvbih0aGlzLCBvcGVyYXRpb25zLCAoMCwgdXRpbHNfMS5yZXNvbHZlT3B0aW9ucykodGhpcywgb3B0aW9ucyA/PyB7IG9yZGVyZWQ6IHRydWUgfSkpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVXBkYXRlIGEgc2luZ2xlIGRvY3VtZW50IGluIGEgY29sbGVjdGlvblxuICAgICAqXG4gICAgICogQHBhcmFtIGZpbHRlciAtIFRoZSBmaWx0ZXIgdXNlZCB0byBzZWxlY3QgdGhlIGRvY3VtZW50IHRvIHVwZGF0ZVxuICAgICAqIEBwYXJhbSB1cGRhdGUgLSBUaGUgdXBkYXRlIG9wZXJhdGlvbnMgdG8gYmUgYXBwbGllZCB0byB0aGUgZG9jdW1lbnRcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzIGZvciB0aGUgY29tbWFuZFxuICAgICAqL1xuICAgIGFzeW5jIHVwZGF0ZU9uZShmaWx0ZXIsIHVwZGF0ZSwgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4gKDAsIGV4ZWN1dGVfb3BlcmF0aW9uXzEuZXhlY3V0ZU9wZXJhdGlvbikodGhpcy5jbGllbnQsIG5ldyB1cGRhdGVfMi5VcGRhdGVPbmVPcGVyYXRpb24odGhpcywgZmlsdGVyLCB1cGRhdGUsICgwLCB1dGlsc18xLnJlc29sdmVPcHRpb25zKSh0aGlzLCBvcHRpb25zKSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXBsYWNlIGEgZG9jdW1lbnQgaW4gYSBjb2xsZWN0aW9uIHdpdGggYW5vdGhlciBkb2N1bWVudFxuICAgICAqXG4gICAgICogQHBhcmFtIGZpbHRlciAtIFRoZSBmaWx0ZXIgdXNlZCB0byBzZWxlY3QgdGhlIGRvY3VtZW50IHRvIHJlcGxhY2VcbiAgICAgKiBAcGFyYW0gcmVwbGFjZW1lbnQgLSBUaGUgRG9jdW1lbnQgdGhhdCByZXBsYWNlcyB0aGUgbWF0Y2hpbmcgZG9jdW1lbnRcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzIGZvciB0aGUgY29tbWFuZFxuICAgICAqL1xuICAgIGFzeW5jIHJlcGxhY2VPbmUoZmlsdGVyLCByZXBsYWNlbWVudCwgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4gKDAsIGV4ZWN1dGVfb3BlcmF0aW9uXzEuZXhlY3V0ZU9wZXJhdGlvbikodGhpcy5jbGllbnQsIG5ldyB1cGRhdGVfMi5SZXBsYWNlT25lT3BlcmF0aW9uKHRoaXMsIGZpbHRlciwgcmVwbGFjZW1lbnQsICgwLCB1dGlsc18xLnJlc29sdmVPcHRpb25zKSh0aGlzLCBvcHRpb25zKSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBVcGRhdGUgbXVsdGlwbGUgZG9jdW1lbnRzIGluIGEgY29sbGVjdGlvblxuICAgICAqXG4gICAgICogQHBhcmFtIGZpbHRlciAtIFRoZSBmaWx0ZXIgdXNlZCB0byBzZWxlY3QgdGhlIGRvY3VtZW50cyB0byB1cGRhdGVcbiAgICAgKiBAcGFyYW0gdXBkYXRlIC0gVGhlIHVwZGF0ZSBvcGVyYXRpb25zIHRvIGJlIGFwcGxpZWQgdG8gdGhlIGRvY3VtZW50c1xuICAgICAqIEBwYXJhbSBvcHRpb25zIC0gT3B0aW9uYWwgc2V0dGluZ3MgZm9yIHRoZSBjb21tYW5kXG4gICAgICovXG4gICAgYXN5bmMgdXBkYXRlTWFueShmaWx0ZXIsIHVwZGF0ZSwgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4gKDAsIGV4ZWN1dGVfb3BlcmF0aW9uXzEuZXhlY3V0ZU9wZXJhdGlvbikodGhpcy5jbGllbnQsIG5ldyB1cGRhdGVfMi5VcGRhdGVNYW55T3BlcmF0aW9uKHRoaXMsIGZpbHRlciwgdXBkYXRlLCAoMCwgdXRpbHNfMS5yZXNvbHZlT3B0aW9ucykodGhpcywgb3B0aW9ucykpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRGVsZXRlIGEgZG9jdW1lbnQgZnJvbSBhIGNvbGxlY3Rpb25cbiAgICAgKlxuICAgICAqIEBwYXJhbSBmaWx0ZXIgLSBUaGUgZmlsdGVyIHVzZWQgdG8gc2VsZWN0IHRoZSBkb2N1bWVudCB0byByZW1vdmVcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzIGZvciB0aGUgY29tbWFuZFxuICAgICAqL1xuICAgIGFzeW5jIGRlbGV0ZU9uZShmaWx0ZXIgPSB7fSwgb3B0aW9ucyA9IHt9KSB7XG4gICAgICAgIHJldHVybiAoMCwgZXhlY3V0ZV9vcGVyYXRpb25fMS5leGVjdXRlT3BlcmF0aW9uKSh0aGlzLmNsaWVudCwgbmV3IGRlbGV0ZV8xLkRlbGV0ZU9uZU9wZXJhdGlvbih0aGlzLCBmaWx0ZXIsICgwLCB1dGlsc18xLnJlc29sdmVPcHRpb25zKSh0aGlzLCBvcHRpb25zKSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBEZWxldGUgbXVsdGlwbGUgZG9jdW1lbnRzIGZyb20gYSBjb2xsZWN0aW9uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZmlsdGVyIC0gVGhlIGZpbHRlciB1c2VkIHRvIHNlbGVjdCB0aGUgZG9jdW1lbnRzIHRvIHJlbW92ZVxuICAgICAqIEBwYXJhbSBvcHRpb25zIC0gT3B0aW9uYWwgc2V0dGluZ3MgZm9yIHRoZSBjb21tYW5kXG4gICAgICovXG4gICAgYXN5bmMgZGVsZXRlTWFueShmaWx0ZXIgPSB7fSwgb3B0aW9ucyA9IHt9KSB7XG4gICAgICAgIHJldHVybiAoMCwgZXhlY3V0ZV9vcGVyYXRpb25fMS5leGVjdXRlT3BlcmF0aW9uKSh0aGlzLmNsaWVudCwgbmV3IGRlbGV0ZV8xLkRlbGV0ZU1hbnlPcGVyYXRpb24odGhpcywgZmlsdGVyLCAoMCwgdXRpbHNfMS5yZXNvbHZlT3B0aW9ucykodGhpcywgb3B0aW9ucykpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVuYW1lIHRoZSBjb2xsZWN0aW9uLlxuICAgICAqXG4gICAgICogQHJlbWFya3NcbiAgICAgKiBUaGlzIG9wZXJhdGlvbiBkb2VzIG5vdCBpbmhlcml0IG9wdGlvbnMgZnJvbSB0aGUgRGIgb3IgTW9uZ29DbGllbnQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gbmV3TmFtZSAtIE5ldyBuYW1lIG9mIG9mIHRoZSBjb2xsZWN0aW9uLlxuICAgICAqIEBwYXJhbSBvcHRpb25zIC0gT3B0aW9uYWwgc2V0dGluZ3MgZm9yIHRoZSBjb21tYW5kXG4gICAgICovXG4gICAgYXN5bmMgcmVuYW1lKG5ld05hbWUsIG9wdGlvbnMpIHtcbiAgICAgICAgLy8gSW50ZW50aW9uYWxseSwgd2UgZG8gbm90IGluaGVyaXQgb3B0aW9ucyBmcm9tIHBhcmVudCBmb3IgdGhpcyBvcGVyYXRpb24uXG4gICAgICAgIHJldHVybiAoMCwgZXhlY3V0ZV9vcGVyYXRpb25fMS5leGVjdXRlT3BlcmF0aW9uKSh0aGlzLmNsaWVudCwgbmV3IHJlbmFtZV8xLlJlbmFtZU9wZXJhdGlvbih0aGlzLCBuZXdOYW1lLCB7XG4gICAgICAgICAgICAuLi5vcHRpb25zLFxuICAgICAgICAgICAgcmVhZFByZWZlcmVuY2U6IHJlYWRfcHJlZmVyZW5jZV8xLlJlYWRQcmVmZXJlbmNlLlBSSU1BUllcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBEcm9wIHRoZSBjb2xsZWN0aW9uIGZyb20gdGhlIGRhdGFiYXNlLCByZW1vdmluZyBpdCBwZXJtYW5lbnRseS4gTmV3IGFjY2Vzc2VzIHdpbGwgY3JlYXRlIGEgbmV3IGNvbGxlY3Rpb24uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzIGZvciB0aGUgY29tbWFuZFxuICAgICAqL1xuICAgIGFzeW5jIGRyb3Aob3B0aW9ucykge1xuICAgICAgICByZXR1cm4gKDAsIGV4ZWN1dGVfb3BlcmF0aW9uXzEuZXhlY3V0ZU9wZXJhdGlvbikodGhpcy5jbGllbnQsIG5ldyBkcm9wXzEuRHJvcENvbGxlY3Rpb25PcGVyYXRpb24odGhpcy5zLmRiLCB0aGlzLmNvbGxlY3Rpb25OYW1lLCBvcHRpb25zKSk7XG4gICAgfVxuICAgIGFzeW5jIGZpbmRPbmUoZmlsdGVyID0ge30sIG9wdGlvbnMgPSB7fSkge1xuICAgICAgICBjb25zdCBjdXJzb3IgPSB0aGlzLmZpbmQoZmlsdGVyLCBvcHRpb25zKS5saW1pdCgtMSkuYmF0Y2hTaXplKDEpO1xuICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBjdXJzb3IubmV4dCgpO1xuICAgICAgICBhd2FpdCBjdXJzb3IuY2xvc2UoKTtcbiAgICAgICAgcmV0dXJuIHJlcztcbiAgICB9XG4gICAgZmluZChmaWx0ZXIgPSB7fSwgb3B0aW9ucyA9IHt9KSB7XG4gICAgICAgIHJldHVybiBuZXcgZmluZF9jdXJzb3JfMS5GaW5kQ3Vyc29yKHRoaXMuY2xpZW50LCB0aGlzLnMubmFtZXNwYWNlLCBmaWx0ZXIsICgwLCB1dGlsc18xLnJlc29sdmVPcHRpb25zKSh0aGlzLCBvcHRpb25zKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdGhlIG9wdGlvbnMgb2YgdGhlIGNvbGxlY3Rpb24uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzIGZvciB0aGUgY29tbWFuZFxuICAgICAqL1xuICAgIGFzeW5jIG9wdGlvbnMob3B0aW9ucykge1xuICAgICAgICByZXR1cm4gKDAsIGV4ZWN1dGVfb3BlcmF0aW9uXzEuZXhlY3V0ZU9wZXJhdGlvbikodGhpcy5jbGllbnQsIG5ldyBvcHRpb25zX29wZXJhdGlvbl8xLk9wdGlvbnNPcGVyYXRpb24odGhpcywgKDAsIHV0aWxzXzEucmVzb2x2ZU9wdGlvbnMpKHRoaXMsIG9wdGlvbnMpKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgaWYgdGhlIGNvbGxlY3Rpb24gaXMgYSBjYXBwZWQgY29sbGVjdGlvblxuICAgICAqXG4gICAgICogQHBhcmFtIG9wdGlvbnMgLSBPcHRpb25hbCBzZXR0aW5ncyBmb3IgdGhlIGNvbW1hbmRcbiAgICAgKi9cbiAgICBhc3luYyBpc0NhcHBlZChvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiAoMCwgZXhlY3V0ZV9vcGVyYXRpb25fMS5leGVjdXRlT3BlcmF0aW9uKSh0aGlzLmNsaWVudCwgbmV3IGlzX2NhcHBlZF8xLklzQ2FwcGVkT3BlcmF0aW9uKHRoaXMsICgwLCB1dGlsc18xLnJlc29sdmVPcHRpb25zKSh0aGlzLCBvcHRpb25zKSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGFuIGluZGV4IG9uIHRoZSBkYiBhbmQgY29sbGVjdGlvbiBjb2xsZWN0aW9uLlxuICAgICAqXG4gICAgICogQHBhcmFtIGluZGV4U3BlYyAtIFRoZSBmaWVsZCBuYW1lIG9yIGluZGV4IHNwZWNpZmljYXRpb24gdG8gY3JlYXRlIGFuIGluZGV4IGZvclxuICAgICAqIEBwYXJhbSBvcHRpb25zIC0gT3B0aW9uYWwgc2V0dGluZ3MgZm9yIHRoZSBjb21tYW5kXG4gICAgICpcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIGBgYHRzXG4gICAgICogY29uc3QgY29sbGVjdGlvbiA9IGNsaWVudC5kYignZm9vJykuY29sbGVjdGlvbignYmFyJyk7XG4gICAgICpcbiAgICAgKiBhd2FpdCBjb2xsZWN0aW9uLmNyZWF0ZUluZGV4KHsgYTogMSwgYjogLTEgfSk7XG4gICAgICpcbiAgICAgKiAvLyBBbHRlcm5hdGUgc3ludGF4IGZvciB7IGM6IDEsIGQ6IC0xIH0gdGhhdCBlbnN1cmVzIG9yZGVyIG9mIGluZGV4ZXNcbiAgICAgKiBhd2FpdCBjb2xsZWN0aW9uLmNyZWF0ZUluZGV4KFsgW2MsIDFdLCBbZCwgLTFdIF0pO1xuICAgICAqXG4gICAgICogLy8gRXF1aXZhbGVudCB0byB7IGU6IDEgfVxuICAgICAqIGF3YWl0IGNvbGxlY3Rpb24uY3JlYXRlSW5kZXgoJ2UnKTtcbiAgICAgKlxuICAgICAqIC8vIEVxdWl2YWxlbnQgdG8geyBmOiAxLCBnOiAxIH1cbiAgICAgKiBhd2FpdCBjb2xsZWN0aW9uLmNyZWF0ZUluZGV4KFsnZicsICdnJ10pXG4gICAgICpcbiAgICAgKiAvLyBFcXVpdmFsZW50IHRvIHsgaDogMSwgaTogLTEgfVxuICAgICAqIGF3YWl0IGNvbGxlY3Rpb24uY3JlYXRlSW5kZXgoWyB7IGg6IDEgfSwgeyBpOiAtMSB9IF0pO1xuICAgICAqXG4gICAgICogLy8gRXF1aXZhbGVudCB0byB7IGo6IDEsIGs6IC0xLCBsOiAyZCB9XG4gICAgICogYXdhaXQgY29sbGVjdGlvbi5jcmVhdGVJbmRleChbJ2onLCBbJ2snLCAtMV0sIHsgbDogJzJkJyB9XSlcbiAgICAgKiBgYGBcbiAgICAgKi9cbiAgICBhc3luYyBjcmVhdGVJbmRleChpbmRleFNwZWMsIG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuICgwLCBleGVjdXRlX29wZXJhdGlvbl8xLmV4ZWN1dGVPcGVyYXRpb24pKHRoaXMuY2xpZW50LCBuZXcgaW5kZXhlc18xLkNyZWF0ZUluZGV4T3BlcmF0aW9uKHRoaXMsIHRoaXMuY29sbGVjdGlvbk5hbWUsIGluZGV4U3BlYywgKDAsIHV0aWxzXzEucmVzb2x2ZU9wdGlvbnMpKHRoaXMsIG9wdGlvbnMpKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgbXVsdGlwbGUgaW5kZXhlcyBpbiB0aGUgY29sbGVjdGlvbiwgdGhpcyBtZXRob2QgaXMgb25seSBzdXBwb3J0ZWQgZm9yXG4gICAgICogTW9uZ29EQiAyLjYgb3IgaGlnaGVyLiBFYXJsaWVyIHZlcnNpb24gb2YgTW9uZ29EQiB3aWxsIHRocm93IGEgY29tbWFuZCBub3Qgc3VwcG9ydGVkXG4gICAgICogZXJyb3IuXG4gICAgICpcbiAgICAgKiAqKk5vdGUqKjogVW5saWtlIHtAbGluayBDb2xsZWN0aW9uI2NyZWF0ZUluZGV4fCBjcmVhdGVJbmRleH0sIHRoaXMgZnVuY3Rpb24gdGFrZXMgaW4gcmF3IGluZGV4IHNwZWNpZmljYXRpb25zLlxuICAgICAqIEluZGV4IHNwZWNpZmljYXRpb25zIGFyZSBkZWZpbmVkIHtAbGluayBodHRwczovL3d3dy5tb25nb2RiLmNvbS9kb2NzL21hbnVhbC9yZWZlcmVuY2UvY29tbWFuZC9jcmVhdGVJbmRleGVzL3wgaGVyZX0uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gaW5kZXhTcGVjcyAtIEFuIGFycmF5IG9mIGluZGV4IHNwZWNpZmljYXRpb25zIHRvIGJlIGNyZWF0ZWRcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzIGZvciB0aGUgY29tbWFuZFxuICAgICAqXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiBgYGB0c1xuICAgICAqIGNvbnN0IGNvbGxlY3Rpb24gPSBjbGllbnQuZGIoJ2ZvbycpLmNvbGxlY3Rpb24oJ2JhcicpO1xuICAgICAqIGF3YWl0IGNvbGxlY3Rpb24uY3JlYXRlSW5kZXhlcyhbXG4gICAgICogICAvLyBTaW1wbGUgaW5kZXggb24gZmllbGQgZml6elxuICAgICAqICAge1xuICAgICAqICAgICBrZXk6IHsgZml6ejogMSB9LFxuICAgICAqICAgfVxuICAgICAqICAgLy8gd2lsZGNhcmQgaW5kZXhcbiAgICAgKiAgIHtcbiAgICAgKiAgICAga2V5OiB7ICckKionOiAxIH1cbiAgICAgKiAgIH0sXG4gICAgICogICAvLyBuYW1lZCBpbmRleCBvbiBkYXJtb2sgYW5kIGphbGFkXG4gICAgICogICB7XG4gICAgICogICAgIGtleTogeyBkYXJtb2s6IDEsIGphbGFkOiAtMSB9XG4gICAgICogICAgIG5hbWU6ICd0YW5hZ3JhJ1xuICAgICAqICAgfVxuICAgICAqIF0pO1xuICAgICAqIGBgYFxuICAgICAqL1xuICAgIGFzeW5jIGNyZWF0ZUluZGV4ZXMoaW5kZXhTcGVjcywgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4gKDAsIGV4ZWN1dGVfb3BlcmF0aW9uXzEuZXhlY3V0ZU9wZXJhdGlvbikodGhpcy5jbGllbnQsIG5ldyBpbmRleGVzXzEuQ3JlYXRlSW5kZXhlc09wZXJhdGlvbih0aGlzLCB0aGlzLmNvbGxlY3Rpb25OYW1lLCBpbmRleFNwZWNzLCAoMCwgdXRpbHNfMS5yZXNvbHZlT3B0aW9ucykodGhpcywgeyAuLi5vcHRpb25zLCBtYXhUaW1lTVM6IHVuZGVmaW5lZCB9KSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBEcm9wcyBhbiBpbmRleCBmcm9tIHRoaXMgY29sbGVjdGlvbi5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBpbmRleE5hbWUgLSBOYW1lIG9mIHRoZSBpbmRleCB0byBkcm9wLlxuICAgICAqIEBwYXJhbSBvcHRpb25zIC0gT3B0aW9uYWwgc2V0dGluZ3MgZm9yIHRoZSBjb21tYW5kXG4gICAgICovXG4gICAgYXN5bmMgZHJvcEluZGV4KGluZGV4TmFtZSwgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4gKDAsIGV4ZWN1dGVfb3BlcmF0aW9uXzEuZXhlY3V0ZU9wZXJhdGlvbikodGhpcy5jbGllbnQsIG5ldyBpbmRleGVzXzEuRHJvcEluZGV4T3BlcmF0aW9uKHRoaXMsIGluZGV4TmFtZSwge1xuICAgICAgICAgICAgLi4uKDAsIHV0aWxzXzEucmVzb2x2ZU9wdGlvbnMpKHRoaXMsIG9wdGlvbnMpLFxuICAgICAgICAgICAgcmVhZFByZWZlcmVuY2U6IHJlYWRfcHJlZmVyZW5jZV8xLlJlYWRQcmVmZXJlbmNlLnByaW1hcnlcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBEcm9wcyBhbGwgaW5kZXhlcyBmcm9tIHRoaXMgY29sbGVjdGlvbi5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBvcHRpb25zIC0gT3B0aW9uYWwgc2V0dGluZ3MgZm9yIHRoZSBjb21tYW5kXG4gICAgICovXG4gICAgYXN5bmMgZHJvcEluZGV4ZXMob3B0aW9ucykge1xuICAgICAgICByZXR1cm4gKDAsIGV4ZWN1dGVfb3BlcmF0aW9uXzEuZXhlY3V0ZU9wZXJhdGlvbikodGhpcy5jbGllbnQsIG5ldyBpbmRleGVzXzEuRHJvcEluZGV4ZXNPcGVyYXRpb24odGhpcywgKDAsIHV0aWxzXzEucmVzb2x2ZU9wdGlvbnMpKHRoaXMsIG9wdGlvbnMpKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEdldCB0aGUgbGlzdCBvZiBhbGwgaW5kZXhlcyBpbmZvcm1hdGlvbiBmb3IgdGhlIGNvbGxlY3Rpb24uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzIGZvciB0aGUgY29tbWFuZFxuICAgICAqL1xuICAgIGxpc3RJbmRleGVzKG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBsaXN0X2luZGV4ZXNfY3Vyc29yXzEuTGlzdEluZGV4ZXNDdXJzb3IodGhpcywgKDAsIHV0aWxzXzEucmVzb2x2ZU9wdGlvbnMpKHRoaXMsIG9wdGlvbnMpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2hlY2tzIGlmIG9uZSBvciBtb3JlIGluZGV4ZXMgZXhpc3Qgb24gdGhlIGNvbGxlY3Rpb24sIGZhaWxzIG9uIGZpcnN0IG5vbi1leGlzdGluZyBpbmRleFxuICAgICAqXG4gICAgICogQHBhcmFtIGluZGV4ZXMgLSBPbmUgb3IgbW9yZSBpbmRleCBuYW1lcyB0byBjaGVjay5cbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzIGZvciB0aGUgY29tbWFuZFxuICAgICAqL1xuICAgIGFzeW5jIGluZGV4RXhpc3RzKGluZGV4ZXMsIG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuICgwLCBleGVjdXRlX29wZXJhdGlvbl8xLmV4ZWN1dGVPcGVyYXRpb24pKHRoaXMuY2xpZW50LCBuZXcgaW5kZXhlc18xLkluZGV4RXhpc3RzT3BlcmF0aW9uKHRoaXMsIGluZGV4ZXMsICgwLCB1dGlsc18xLnJlc29sdmVPcHRpb25zKSh0aGlzLCBvcHRpb25zKSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXRyaWV2ZXMgdGhpcyBjb2xsZWN0aW9ucyBpbmRleCBpbmZvLlxuICAgICAqXG4gICAgICogQHBhcmFtIG9wdGlvbnMgLSBPcHRpb25hbCBzZXR0aW5ncyBmb3IgdGhlIGNvbW1hbmRcbiAgICAgKi9cbiAgICBhc3luYyBpbmRleEluZm9ybWF0aW9uKG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuICgwLCBleGVjdXRlX29wZXJhdGlvbl8xLmV4ZWN1dGVPcGVyYXRpb24pKHRoaXMuY2xpZW50LCBuZXcgaW5kZXhlc18xLkluZGV4SW5mb3JtYXRpb25PcGVyYXRpb24odGhpcy5zLmRiLCB0aGlzLmNvbGxlY3Rpb25OYW1lLCAoMCwgdXRpbHNfMS5yZXNvbHZlT3B0aW9ucykodGhpcywgb3B0aW9ucykpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogR2V0cyBhbiBlc3RpbWF0ZSBvZiB0aGUgY291bnQgb2YgZG9jdW1lbnRzIGluIGEgY29sbGVjdGlvbiB1c2luZyBjb2xsZWN0aW9uIG1ldGFkYXRhLlxuICAgICAqIFRoaXMgd2lsbCBhbHdheXMgcnVuIGEgY291bnQgY29tbWFuZCBvbiBhbGwgc2VydmVyIHZlcnNpb25zLlxuICAgICAqXG4gICAgICogZHVlIHRvIGFuIG92ZXJzaWdodCBpbiB2ZXJzaW9ucyA1LjAuMC01LjAuOCBvZiBNb25nb0RCLCB0aGUgY291bnQgY29tbWFuZCxcbiAgICAgKiB3aGljaCBlc3RpbWF0ZWREb2N1bWVudENvdW50IHVzZXMgaW4gaXRzIGltcGxlbWVudGF0aW9uLCB3YXMgbm90IGluY2x1ZGVkIGluIHYxIG9mXG4gICAgICogdGhlIFN0YWJsZSBBUEksIGFuZCBzbyB1c2VycyBvZiB0aGUgU3RhYmxlIEFQSSB3aXRoIGVzdGltYXRlZERvY3VtZW50Q291bnQgYXJlXG4gICAgICogcmVjb21tZW5kZWQgdG8gdXBncmFkZSB0aGVpciBzZXJ2ZXIgdmVyc2lvbiB0byA1LjAuOSsgb3Igc2V0IGFwaVN0cmljdDogZmFsc2UgdG8gYXZvaWRcbiAgICAgKiBlbmNvdW50ZXJpbmcgZXJyb3JzLlxuICAgICAqXG4gICAgICogQHNlZSB7QGxpbmsgaHR0cHM6Ly93d3cubW9uZ29kYi5jb20vZG9jcy9tYW51YWwvcmVmZXJlbmNlL2NvbW1hbmQvY291bnQvI2JlaGF2aW9yfENvdW50OiBCZWhhdmlvcn1cbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzIGZvciB0aGUgY29tbWFuZFxuICAgICAqL1xuICAgIGFzeW5jIGVzdGltYXRlZERvY3VtZW50Q291bnQob3B0aW9ucykge1xuICAgICAgICByZXR1cm4gKDAsIGV4ZWN1dGVfb3BlcmF0aW9uXzEuZXhlY3V0ZU9wZXJhdGlvbikodGhpcy5jbGllbnQsIG5ldyBlc3RpbWF0ZWRfZG9jdW1lbnRfY291bnRfMS5Fc3RpbWF0ZWREb2N1bWVudENvdW50T3BlcmF0aW9uKHRoaXMsICgwLCB1dGlsc18xLnJlc29sdmVPcHRpb25zKSh0aGlzLCBvcHRpb25zKSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSBudW1iZXIgb2YgZG9jdW1lbnRzIG1hdGNoaW5nIHRoZSBmaWx0ZXIuXG4gICAgICogRm9yIGEgZmFzdCBjb3VudCBvZiB0aGUgdG90YWwgZG9jdW1lbnRzIGluIGEgY29sbGVjdGlvbiBzZWUge0BsaW5rIENvbGxlY3Rpb24jZXN0aW1hdGVkRG9jdW1lbnRDb3VudHwgZXN0aW1hdGVkRG9jdW1lbnRDb3VudH0uXG4gICAgICogKipOb3RlKio6IFdoZW4gbWlncmF0aW5nIGZyb20ge0BsaW5rIENvbGxlY3Rpb24jY291bnR8IGNvdW50fSB0byB7QGxpbmsgQ29sbGVjdGlvbiNjb3VudERvY3VtZW50c3wgY291bnREb2N1bWVudHN9XG4gICAgICogdGhlIGZvbGxvd2luZyBxdWVyeSBvcGVyYXRvcnMgbXVzdCBiZSByZXBsYWNlZDpcbiAgICAgKlxuICAgICAqIHwgT3BlcmF0b3IgfCBSZXBsYWNlbWVudCB8XG4gICAgICogfCAtLS0tLS0tLSB8IC0tLS0tLS0tLS0tIHxcbiAgICAgKiB8IGAkd2hlcmVgICAgfCBbYCRleHByYF1bMV0gfFxuICAgICAqIHwgYCRuZWFyYCAgICB8IFtgJGdlb1dpdGhpbmBdWzJdIHdpdGggW2AkY2VudGVyYF1bM10gfFxuICAgICAqIHwgYCRuZWFyU3BoZXJlYCB8IFtgJGdlb1dpdGhpbmBdWzJdIHdpdGggW2AkY2VudGVyU3BoZXJlYF1bNF0gfFxuICAgICAqXG4gICAgICogWzFdOiBodHRwczovL3d3dy5tb25nb2RiLmNvbS9kb2NzL21hbnVhbC9yZWZlcmVuY2Uvb3BlcmF0b3IvcXVlcnkvZXhwci9cbiAgICAgKiBbMl06IGh0dHBzOi8vd3d3Lm1vbmdvZGIuY29tL2RvY3MvbWFudWFsL3JlZmVyZW5jZS9vcGVyYXRvci9xdWVyeS9nZW9XaXRoaW4vXG4gICAgICogWzNdOiBodHRwczovL3d3dy5tb25nb2RiLmNvbS9kb2NzL21hbnVhbC9yZWZlcmVuY2Uvb3BlcmF0b3IvcXVlcnkvY2VudGVyLyNvcC5fU19jZW50ZXJcbiAgICAgKiBbNF06IGh0dHBzOi8vd3d3Lm1vbmdvZGIuY29tL2RvY3MvbWFudWFsL3JlZmVyZW5jZS9vcGVyYXRvci9xdWVyeS9jZW50ZXJTcGhlcmUvI29wLl9TX2NlbnRlclNwaGVyZVxuICAgICAqXG4gICAgICogQHBhcmFtIGZpbHRlciAtIFRoZSBmaWx0ZXIgZm9yIHRoZSBjb3VudFxuICAgICAqIEBwYXJhbSBvcHRpb25zIC0gT3B0aW9uYWwgc2V0dGluZ3MgZm9yIHRoZSBjb21tYW5kXG4gICAgICpcbiAgICAgKiBAc2VlIGh0dHBzOi8vd3d3Lm1vbmdvZGIuY29tL2RvY3MvbWFudWFsL3JlZmVyZW5jZS9vcGVyYXRvci9xdWVyeS9leHByL1xuICAgICAqIEBzZWUgaHR0cHM6Ly93d3cubW9uZ29kYi5jb20vZG9jcy9tYW51YWwvcmVmZXJlbmNlL29wZXJhdG9yL3F1ZXJ5L2dlb1dpdGhpbi9cbiAgICAgKiBAc2VlIGh0dHBzOi8vd3d3Lm1vbmdvZGIuY29tL2RvY3MvbWFudWFsL3JlZmVyZW5jZS9vcGVyYXRvci9xdWVyeS9jZW50ZXIvI29wLl9TX2NlbnRlclxuICAgICAqIEBzZWUgaHR0cHM6Ly93d3cubW9uZ29kYi5jb20vZG9jcy9tYW51YWwvcmVmZXJlbmNlL29wZXJhdG9yL3F1ZXJ5L2NlbnRlclNwaGVyZS8jb3AuX1NfY2VudGVyU3BoZXJlXG4gICAgICovXG4gICAgYXN5bmMgY291bnREb2N1bWVudHMoZmlsdGVyID0ge30sIG9wdGlvbnMgPSB7fSkge1xuICAgICAgICByZXR1cm4gKDAsIGV4ZWN1dGVfb3BlcmF0aW9uXzEuZXhlY3V0ZU9wZXJhdGlvbikodGhpcy5jbGllbnQsIG5ldyBjb3VudF9kb2N1bWVudHNfMS5Db3VudERvY3VtZW50c09wZXJhdGlvbih0aGlzLCBmaWx0ZXIsICgwLCB1dGlsc18xLnJlc29sdmVPcHRpb25zKSh0aGlzLCBvcHRpb25zKSkpO1xuICAgIH1cbiAgICBhc3luYyBkaXN0aW5jdChrZXksIGZpbHRlciA9IHt9LCBvcHRpb25zID0ge30pIHtcbiAgICAgICAgcmV0dXJuICgwLCBleGVjdXRlX29wZXJhdGlvbl8xLmV4ZWN1dGVPcGVyYXRpb24pKHRoaXMuY2xpZW50LCBuZXcgZGlzdGluY3RfMS5EaXN0aW5jdE9wZXJhdGlvbih0aGlzLCBrZXksIGZpbHRlciwgKDAsIHV0aWxzXzEucmVzb2x2ZU9wdGlvbnMpKHRoaXMsIG9wdGlvbnMpKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHJpZXZlIGFsbCB0aGUgaW5kZXhlcyBvbiB0aGUgY29sbGVjdGlvbi5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBvcHRpb25zIC0gT3B0aW9uYWwgc2V0dGluZ3MgZm9yIHRoZSBjb21tYW5kXG4gICAgICovXG4gICAgYXN5bmMgaW5kZXhlcyhvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiAoMCwgZXhlY3V0ZV9vcGVyYXRpb25fMS5leGVjdXRlT3BlcmF0aW9uKSh0aGlzLmNsaWVudCwgbmV3IGluZGV4ZXNfMS5JbmRleGVzT3BlcmF0aW9uKHRoaXMsICgwLCB1dGlsc18xLnJlc29sdmVPcHRpb25zKSh0aGlzLCBvcHRpb25zKSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBHZXQgYWxsIHRoZSBjb2xsZWN0aW9uIHN0YXRpc3RpY3MuXG4gICAgICpcbiAgICAgKiBAZGVwcmVjYXRlZCB0aGUgYGNvbGxTdGF0c2Agb3BlcmF0aW9uIHdpbGwgYmUgcmVtb3ZlZCBpbiB0aGUgbmV4dCBtYWpvciByZWxlYXNlLiAgUGxlYXNlXG4gICAgICogdXNlIGFuIGFnZ3JlZ2F0aW9uIHBpcGVsaW5lIHdpdGggdGhlIFtgJGNvbGxTdGF0c2BdKGh0dHBzOi8vd3d3Lm1vbmdvZGIuY29tL2RvY3MvbWFudWFsL3JlZmVyZW5jZS9vcGVyYXRvci9hZ2dyZWdhdGlvbi9jb2xsU3RhdHMvKSBzdGFnZSBpbnN0ZWFkXG4gICAgICpcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzIGZvciB0aGUgY29tbWFuZFxuICAgICAqL1xuICAgIGFzeW5jIHN0YXRzKG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuICgwLCBleGVjdXRlX29wZXJhdGlvbl8xLmV4ZWN1dGVPcGVyYXRpb24pKHRoaXMuY2xpZW50LCBuZXcgc3RhdHNfMS5Db2xsU3RhdHNPcGVyYXRpb24odGhpcywgb3B0aW9ucykpO1xuICAgIH1cbiAgICBhc3luYyBmaW5kT25lQW5kRGVsZXRlKGZpbHRlciwgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4gKDAsIGV4ZWN1dGVfb3BlcmF0aW9uXzEuZXhlY3V0ZU9wZXJhdGlvbikodGhpcy5jbGllbnQsIG5ldyBmaW5kX2FuZF9tb2RpZnlfMS5GaW5kT25lQW5kRGVsZXRlT3BlcmF0aW9uKHRoaXMsIGZpbHRlciwgKDAsIHV0aWxzXzEucmVzb2x2ZU9wdGlvbnMpKHRoaXMsIG9wdGlvbnMpKSk7XG4gICAgfVxuICAgIGFzeW5jIGZpbmRPbmVBbmRSZXBsYWNlKGZpbHRlciwgcmVwbGFjZW1lbnQsIG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuICgwLCBleGVjdXRlX29wZXJhdGlvbl8xLmV4ZWN1dGVPcGVyYXRpb24pKHRoaXMuY2xpZW50LCBuZXcgZmluZF9hbmRfbW9kaWZ5XzEuRmluZE9uZUFuZFJlcGxhY2VPcGVyYXRpb24odGhpcywgZmlsdGVyLCByZXBsYWNlbWVudCwgKDAsIHV0aWxzXzEucmVzb2x2ZU9wdGlvbnMpKHRoaXMsIG9wdGlvbnMpKSk7XG4gICAgfVxuICAgIGFzeW5jIGZpbmRPbmVBbmRVcGRhdGUoZmlsdGVyLCB1cGRhdGUsIG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuICgwLCBleGVjdXRlX29wZXJhdGlvbl8xLmV4ZWN1dGVPcGVyYXRpb24pKHRoaXMuY2xpZW50LCBuZXcgZmluZF9hbmRfbW9kaWZ5XzEuRmluZE9uZUFuZFVwZGF0ZU9wZXJhdGlvbih0aGlzLCBmaWx0ZXIsIHVwZGF0ZSwgKDAsIHV0aWxzXzEucmVzb2x2ZU9wdGlvbnMpKHRoaXMsIG9wdGlvbnMpKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEV4ZWN1dGUgYW4gYWdncmVnYXRpb24gZnJhbWV3b3JrIHBpcGVsaW5lIGFnYWluc3QgdGhlIGNvbGxlY3Rpb24sIG5lZWRzIE1vbmdvREIgXFw+PSAyLjJcbiAgICAgKlxuICAgICAqIEBwYXJhbSBwaXBlbGluZSAtIEFuIGFycmF5IG9mIGFnZ3JlZ2F0aW9uIHBpcGVsaW5lcyB0byBleGVjdXRlXG4gICAgICogQHBhcmFtIG9wdGlvbnMgLSBPcHRpb25hbCBzZXR0aW5ncyBmb3IgdGhlIGNvbW1hbmRcbiAgICAgKi9cbiAgICBhZ2dyZWdhdGUocGlwZWxpbmUgPSBbXSwgb3B0aW9ucykge1xuICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkocGlwZWxpbmUpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdBcmd1bWVudCBcInBpcGVsaW5lXCIgbXVzdCBiZSBhbiBhcnJheSBvZiBhZ2dyZWdhdGlvbiBzdGFnZXMnKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3IGFnZ3JlZ2F0aW9uX2N1cnNvcl8xLkFnZ3JlZ2F0aW9uQ3Vyc29yKHRoaXMuY2xpZW50LCB0aGlzLnMubmFtZXNwYWNlLCBwaXBlbGluZSwgKDAsIHV0aWxzXzEucmVzb2x2ZU9wdGlvbnMpKHRoaXMsIG9wdGlvbnMpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgbmV3IENoYW5nZSBTdHJlYW0sIHdhdGNoaW5nIGZvciBuZXcgY2hhbmdlcyAoaW5zZXJ0aW9ucywgdXBkYXRlcywgcmVwbGFjZW1lbnRzLCBkZWxldGlvbnMsIGFuZCBpbnZhbGlkYXRpb25zKSBpbiB0aGlzIGNvbGxlY3Rpb24uXG4gICAgICpcbiAgICAgKiBAcmVtYXJrc1xuICAgICAqIHdhdGNoKCkgYWNjZXB0cyB0d28gZ2VuZXJpYyBhcmd1bWVudHMgZm9yIGRpc3RpbmN0IHVzZSBjYXNlczpcbiAgICAgKiAtIFRoZSBmaXJzdCBpcyB0byBvdmVycmlkZSB0aGUgc2NoZW1hIHRoYXQgbWF5IGJlIGRlZmluZWQgZm9yIHRoaXMgc3BlY2lmaWMgY29sbGVjdGlvblxuICAgICAqIC0gVGhlIHNlY29uZCBpcyB0byBvdmVycmlkZSB0aGUgc2hhcGUgb2YgdGhlIGNoYW5nZSBzdHJlYW0gZG9jdW1lbnQgZW50aXJlbHksIGlmIGl0IGlzIG5vdCBwcm92aWRlZCB0aGUgdHlwZSB3aWxsIGRlZmF1bHQgdG8gQ2hhbmdlU3RyZWFtRG9jdW1lbnQgb2YgdGhlIGZpcnN0IGFyZ3VtZW50XG4gICAgICogQGV4YW1wbGVcbiAgICAgKiBCeSBqdXN0IHByb3ZpZGluZyB0aGUgZmlyc3QgYXJndW1lbnQgSSBjYW4gdHlwZSB0aGUgY2hhbmdlIHRvIGJlIGBDaGFuZ2VTdHJlYW1Eb2N1bWVudDx7IF9pZDogbnVtYmVyIH0+YFxuICAgICAqIGBgYHRzXG4gICAgICogY29sbGVjdGlvbi53YXRjaDx7IF9pZDogbnVtYmVyIH0+KClcbiAgICAgKiAgIC5vbignY2hhbmdlJywgY2hhbmdlID0+IGNvbnNvbGUubG9nKGNoYW5nZS5faWQudG9GaXhlZCg0KSkpO1xuICAgICAqIGBgYFxuICAgICAqXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiBQYXNzaW5nIGEgc2Vjb25kIGFyZ3VtZW50IHByb3ZpZGVzIGEgd2F5IHRvIHJlZmxlY3QgdGhlIHR5cGUgY2hhbmdlcyBjYXVzZWQgYnkgYW4gYWR2YW5jZWQgcGlwZWxpbmUuXG4gICAgICogSGVyZSwgd2UgYXJlIHVzaW5nIGEgcGlwZWxpbmUgdG8gaGF2ZSBNb25nb0RCIGZpbHRlciBmb3IgaW5zZXJ0IGNoYW5nZXMgb25seSBhbmQgYWRkIGEgY29tbWVudC5cbiAgICAgKiBObyBuZWVkIHN0YXJ0IGZyb20gc2NyYXRjaCBvbiB0aGUgQ2hhbmdlU3RyZWFtSW5zZXJ0RG9jdW1lbnQgdHlwZSFcbiAgICAgKiBCeSB1c2luZyBhbiBpbnRlcnNlY3Rpb24gd2UgY2FuIHNhdmUgdGltZSBhbmQgZW5zdXJlIGRlZmF1bHRzIHJlbWFpbiB0aGUgc2FtZSB0eXBlIVxuICAgICAqIGBgYHRzXG4gICAgICogY29sbGVjdGlvblxuICAgICAqICAgLndhdGNoPFNjaGVtYSwgQ2hhbmdlU3RyZWFtSW5zZXJ0RG9jdW1lbnQ8U2NoZW1hPiAmIHsgY29tbWVudDogc3RyaW5nIH0+KFtcbiAgICAgKiAgICAgeyAkYWRkRmllbGRzOiB7IGNvbW1lbnQ6ICdiaWcgY2hhbmdlcycgfSB9LFxuICAgICAqICAgICB7ICRtYXRjaDogeyBvcGVyYXRpb25UeXBlOiAnaW5zZXJ0JyB9IH1cbiAgICAgKiAgIF0pXG4gICAgICogICAub24oJ2NoYW5nZScsIGNoYW5nZSA9PiB7XG4gICAgICogICAgIGNoYW5nZS5jb21tZW50LnN0YXJ0c1dpdGgoJ2JpZycpO1xuICAgICAqICAgICBjaGFuZ2Uub3BlcmF0aW9uVHlwZSA9PT0gJ2luc2VydCc7XG4gICAgICogICAgIC8vIE5vIG5lZWQgdG8gbmFycm93IGluIGNvZGUgYmVjYXVzZSB0aGUgZ2VuZXJpY3MgZGlkIHRoYXQgZm9yIHVzIVxuICAgICAqICAgICBleHBlY3RUeXBlPFNjaGVtYT4oY2hhbmdlLmZ1bGxEb2N1bWVudCk7XG4gICAgICogICB9KTtcbiAgICAgKiBgYGBcbiAgICAgKlxuICAgICAqIEBwYXJhbSBwaXBlbGluZSAtIEFuIGFycmF5IG9mIHtAbGluayBodHRwczovL3d3dy5tb25nb2RiLmNvbS9kb2NzL21hbnVhbC9yZWZlcmVuY2Uvb3BlcmF0b3IvYWdncmVnYXRpb24tcGlwZWxpbmUvfGFnZ3JlZ2F0aW9uIHBpcGVsaW5lIHN0YWdlc30gdGhyb3VnaCB3aGljaCB0byBwYXNzIGNoYW5nZSBzdHJlYW0gZG9jdW1lbnRzLiBUaGlzIGFsbG93cyBmb3IgZmlsdGVyaW5nICh1c2luZyAkbWF0Y2gpIGFuZCBtYW5pcHVsYXRpbmcgdGhlIGNoYW5nZSBzdHJlYW0gZG9jdW1lbnRzLlxuICAgICAqIEBwYXJhbSBvcHRpb25zIC0gT3B0aW9uYWwgc2V0dGluZ3MgZm9yIHRoZSBjb21tYW5kXG4gICAgICogQHR5cGVQYXJhbSBUTG9jYWwgLSBUeXBlIG9mIHRoZSBkYXRhIGJlaW5nIGRldGVjdGVkIGJ5IHRoZSBjaGFuZ2Ugc3RyZWFtXG4gICAgICogQHR5cGVQYXJhbSBUQ2hhbmdlIC0gVHlwZSBvZiB0aGUgd2hvbGUgY2hhbmdlIHN0cmVhbSBkb2N1bWVudCBlbWl0dGVkXG4gICAgICovXG4gICAgd2F0Y2gocGlwZWxpbmUgPSBbXSwgb3B0aW9ucyA9IHt9KSB7XG4gICAgICAgIC8vIEFsbG93IG9wdGlvbmFsbHkgbm90IHNwZWNpZnlpbmcgYSBwaXBlbGluZVxuICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkocGlwZWxpbmUpKSB7XG4gICAgICAgICAgICBvcHRpb25zID0gcGlwZWxpbmU7XG4gICAgICAgICAgICBwaXBlbGluZSA9IFtdO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgY2hhbmdlX3N0cmVhbV8xLkNoYW5nZVN0cmVhbSh0aGlzLCBwaXBlbGluZSwgKDAsIHV0aWxzXzEucmVzb2x2ZU9wdGlvbnMpKHRoaXMsIG9wdGlvbnMpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogSW5pdGlhdGUgYW4gT3V0IG9mIG9yZGVyIGJhdGNoIHdyaXRlIG9wZXJhdGlvbi4gQWxsIG9wZXJhdGlvbnMgd2lsbCBiZSBidWZmZXJlZCBpbnRvIGluc2VydC91cGRhdGUvcmVtb3ZlIGNvbW1hbmRzIGV4ZWN1dGVkIG91dCBvZiBvcmRlci5cbiAgICAgKlxuICAgICAqIEB0aHJvd3MgTW9uZ29Ob3RDb25uZWN0ZWRFcnJvclxuICAgICAqIEByZW1hcmtzXG4gICAgICogKipOT1RFOioqIE1vbmdvQ2xpZW50IG11c3QgYmUgY29ubmVjdGVkIHByaW9yIHRvIGNhbGxpbmcgdGhpcyBtZXRob2QgZHVlIHRvIGEga25vd24gbGltaXRhdGlvbiBpbiB0aGlzIGxlZ2FjeSBpbXBsZW1lbnRhdGlvbi5cbiAgICAgKiBIb3dldmVyLCBgY29sbGVjdGlvbi5idWxrV3JpdGUoKWAgcHJvdmlkZXMgYW4gZXF1aXZhbGVudCBBUEkgdGhhdCBkb2VzIG5vdCByZXF1aXJlIHByaW9yIGNvbm5lY3RpbmcuXG4gICAgICovXG4gICAgaW5pdGlhbGl6ZVVub3JkZXJlZEJ1bGtPcChvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiBuZXcgdW5vcmRlcmVkXzEuVW5vcmRlcmVkQnVsa09wZXJhdGlvbih0aGlzLCAoMCwgdXRpbHNfMS5yZXNvbHZlT3B0aW9ucykodGhpcywgb3B0aW9ucykpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBJbml0aWF0ZSBhbiBJbiBvcmRlciBidWxrIHdyaXRlIG9wZXJhdGlvbi4gT3BlcmF0aW9ucyB3aWxsIGJlIHNlcmlhbGx5IGV4ZWN1dGVkIGluIHRoZSBvcmRlciB0aGV5IGFyZSBhZGRlZCwgY3JlYXRpbmcgYSBuZXcgb3BlcmF0aW9uIGZvciBlYWNoIHN3aXRjaCBpbiB0eXBlcy5cbiAgICAgKlxuICAgICAqIEB0aHJvd3MgTW9uZ29Ob3RDb25uZWN0ZWRFcnJvclxuICAgICAqIEByZW1hcmtzXG4gICAgICogKipOT1RFOioqIE1vbmdvQ2xpZW50IG11c3QgYmUgY29ubmVjdGVkIHByaW9yIHRvIGNhbGxpbmcgdGhpcyBtZXRob2QgZHVlIHRvIGEga25vd24gbGltaXRhdGlvbiBpbiB0aGlzIGxlZ2FjeSBpbXBsZW1lbnRhdGlvbi5cbiAgICAgKiBIb3dldmVyLCBgY29sbGVjdGlvbi5idWxrV3JpdGUoKWAgcHJvdmlkZXMgYW4gZXF1aXZhbGVudCBBUEkgdGhhdCBkb2VzIG5vdCByZXF1aXJlIHByaW9yIGNvbm5lY3RpbmcuXG4gICAgICovXG4gICAgaW5pdGlhbGl6ZU9yZGVyZWRCdWxrT3Aob3B0aW9ucykge1xuICAgICAgICByZXR1cm4gbmV3IG9yZGVyZWRfMS5PcmRlcmVkQnVsa09wZXJhdGlvbih0aGlzLCAoMCwgdXRpbHNfMS5yZXNvbHZlT3B0aW9ucykodGhpcywgb3B0aW9ucykpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBbiBlc3RpbWF0ZWQgY291bnQgb2YgbWF0Y2hpbmcgZG9jdW1lbnRzIGluIHRoZSBkYiB0byBhIGZpbHRlci5cbiAgICAgKlxuICAgICAqICoqTk9URToqKiBUaGlzIG1ldGhvZCBoYXMgYmVlbiBkZXByZWNhdGVkLCBzaW5jZSBpdCBkb2VzIG5vdCBwcm92aWRlIGFuIGFjY3VyYXRlIGNvdW50IG9mIHRoZSBkb2N1bWVudHNcbiAgICAgKiBpbiBhIGNvbGxlY3Rpb24uIFRvIG9idGFpbiBhbiBhY2N1cmF0ZSBjb3VudCBvZiBkb2N1bWVudHMgaW4gdGhlIGNvbGxlY3Rpb24sIHVzZSB7QGxpbmsgQ29sbGVjdGlvbiNjb3VudERvY3VtZW50c3wgY291bnREb2N1bWVudHN9LlxuICAgICAqIFRvIG9idGFpbiBhbiBlc3RpbWF0ZWQgY291bnQgb2YgYWxsIGRvY3VtZW50cyBpbiB0aGUgY29sbGVjdGlvbiwgdXNlIHtAbGluayBDb2xsZWN0aW9uI2VzdGltYXRlZERvY3VtZW50Q291bnR8IGVzdGltYXRlZERvY3VtZW50Q291bnR9LlxuICAgICAqXG4gICAgICogQGRlcHJlY2F0ZWQgdXNlIHtAbGluayBDb2xsZWN0aW9uI2NvdW50RG9jdW1lbnRzfCBjb3VudERvY3VtZW50c30gb3Ige0BsaW5rIENvbGxlY3Rpb24jZXN0aW1hdGVkRG9jdW1lbnRDb3VudHwgZXN0aW1hdGVkRG9jdW1lbnRDb3VudH0gaW5zdGVhZFxuICAgICAqXG4gICAgICogQHBhcmFtIGZpbHRlciAtIFRoZSBmaWx0ZXIgZm9yIHRoZSBjb3VudC5cbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzIGZvciB0aGUgY29tbWFuZFxuICAgICAqL1xuICAgIGFzeW5jIGNvdW50KGZpbHRlciA9IHt9LCBvcHRpb25zID0ge30pIHtcbiAgICAgICAgcmV0dXJuICgwLCBleGVjdXRlX29wZXJhdGlvbl8xLmV4ZWN1dGVPcGVyYXRpb24pKHRoaXMuY2xpZW50LCBuZXcgY291bnRfMS5Db3VudE9wZXJhdGlvbih0aGlzLmZ1bGxOYW1lc3BhY2UsIGZpbHRlciwgKDAsIHV0aWxzXzEucmVzb2x2ZU9wdGlvbnMpKHRoaXMsIG9wdGlvbnMpKSk7XG4gICAgfVxuICAgIGxpc3RTZWFyY2hJbmRleGVzKGluZGV4TmFtZU9yT3B0aW9ucywgb3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID1cbiAgICAgICAgICAgIHR5cGVvZiBpbmRleE5hbWVPck9wdGlvbnMgPT09ICdvYmplY3QnID8gaW5kZXhOYW1lT3JPcHRpb25zIDogb3B0aW9ucyA9PSBudWxsID8ge30gOiBvcHRpb25zO1xuICAgICAgICBjb25zdCBpbmRleE5hbWUgPSBpbmRleE5hbWVPck9wdGlvbnMgPT0gbnVsbFxuICAgICAgICAgICAgPyBudWxsXG4gICAgICAgICAgICA6IHR5cGVvZiBpbmRleE5hbWVPck9wdGlvbnMgPT09ICdvYmplY3QnXG4gICAgICAgICAgICAgICAgPyBudWxsXG4gICAgICAgICAgICAgICAgOiBpbmRleE5hbWVPck9wdGlvbnM7XG4gICAgICAgIHJldHVybiBuZXcgbGlzdF9zZWFyY2hfaW5kZXhlc19jdXJzb3JfMS5MaXN0U2VhcmNoSW5kZXhlc0N1cnNvcih0aGlzLCBpbmRleE5hbWUsIG9wdGlvbnMpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgc2luZ2xlIHNlYXJjaCBpbmRleCBmb3IgdGhlIGNvbGxlY3Rpb24uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZGVzY3JpcHRpb24gLSBUaGUgaW5kZXggZGVzY3JpcHRpb24gZm9yIHRoZSBuZXcgc2VhcmNoIGluZGV4LlxuICAgICAqIEByZXR1cm5zIEEgcHJvbWlzZSB0aGF0IHJlc29sdmVzIHRvIHRoZSBuYW1lIG9mIHRoZSBuZXcgc2VhcmNoIGluZGV4LlxuICAgICAqXG4gICAgICogQHJlbWFya3MgT25seSBhdmFpbGFibGUgd2hlbiB1c2VkIGFnYWluc3QgYSA3LjArIEF0bGFzIGNsdXN0ZXIuXG4gICAgICovXG4gICAgYXN5bmMgY3JlYXRlU2VhcmNoSW5kZXgoZGVzY3JpcHRpb24pIHtcbiAgICAgICAgY29uc3QgW2luZGV4XSA9IGF3YWl0IHRoaXMuY3JlYXRlU2VhcmNoSW5kZXhlcyhbZGVzY3JpcHRpb25dKTtcbiAgICAgICAgcmV0dXJuIGluZGV4O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIG11bHRpcGxlIHNlYXJjaCBpbmRleGVzIGZvciB0aGUgY3VycmVudCBjb2xsZWN0aW9uLlxuICAgICAqXG4gICAgICogQHBhcmFtIGRlc2NyaXB0aW9ucyAtIEFuIGFycmF5IG9mIGBTZWFyY2hJbmRleERlc2NyaXB0aW9uYHMgZm9yIHRoZSBuZXcgc2VhcmNoIGluZGV4ZXMuXG4gICAgICogQHJldHVybnMgQSBwcm9taXNlIHRoYXQgcmVzb2x2ZXMgdG8gYW4gYXJyYXkgb2YgdGhlIG5ld2x5IGNyZWF0ZWQgc2VhcmNoIGluZGV4IG5hbWVzLlxuICAgICAqXG4gICAgICogQHJlbWFya3MgT25seSBhdmFpbGFibGUgd2hlbiB1c2VkIGFnYWluc3QgYSA3LjArIEF0bGFzIGNsdXN0ZXIuXG4gICAgICogQHJldHVybnNcbiAgICAgKi9cbiAgICBhc3luYyBjcmVhdGVTZWFyY2hJbmRleGVzKGRlc2NyaXB0aW9ucykge1xuICAgICAgICByZXR1cm4gKDAsIGV4ZWN1dGVfb3BlcmF0aW9uXzEuZXhlY3V0ZU9wZXJhdGlvbikodGhpcy5jbGllbnQsIG5ldyBjcmVhdGVfMS5DcmVhdGVTZWFyY2hJbmRleGVzT3BlcmF0aW9uKHRoaXMsIGRlc2NyaXB0aW9ucykpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBEZWxldGVzIGEgc2VhcmNoIGluZGV4IGJ5IGluZGV4IG5hbWUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gbmFtZSAtIFRoZSBuYW1lIG9mIHRoZSBzZWFyY2ggaW5kZXggdG8gYmUgZGVsZXRlZC5cbiAgICAgKlxuICAgICAqIEByZW1hcmtzIE9ubHkgYXZhaWxhYmxlIHdoZW4gdXNlZCBhZ2FpbnN0IGEgNy4wKyBBdGxhcyBjbHVzdGVyLlxuICAgICAqL1xuICAgIGFzeW5jIGRyb3BTZWFyY2hJbmRleChuYW1lKSB7XG4gICAgICAgIHJldHVybiAoMCwgZXhlY3V0ZV9vcGVyYXRpb25fMS5leGVjdXRlT3BlcmF0aW9uKSh0aGlzLmNsaWVudCwgbmV3IGRyb3BfMi5Ecm9wU2VhcmNoSW5kZXhPcGVyYXRpb24odGhpcywgbmFtZSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBVcGRhdGVzIGEgc2VhcmNoIGluZGV4IGJ5IHJlcGxhY2luZyB0aGUgZXhpc3RpbmcgaW5kZXggZGVmaW5pdGlvbiB3aXRoIHRoZSBwcm92aWRlZCBkZWZpbml0aW9uLlxuICAgICAqXG4gICAgICogQHBhcmFtIG5hbWUgLSBUaGUgbmFtZSBvZiB0aGUgc2VhcmNoIGluZGV4IHRvIHVwZGF0ZS5cbiAgICAgKiBAcGFyYW0gZGVmaW5pdGlvbiAtIFRoZSBuZXcgc2VhcmNoIGluZGV4IGRlZmluaXRpb24uXG4gICAgICpcbiAgICAgKiBAcmVtYXJrcyBPbmx5IGF2YWlsYWJsZSB3aGVuIHVzZWQgYWdhaW5zdCBhIDcuMCsgQXRsYXMgY2x1c3Rlci5cbiAgICAgKi9cbiAgICBhc3luYyB1cGRhdGVTZWFyY2hJbmRleChuYW1lLCBkZWZpbml0aW9uKSB7XG4gICAgICAgIHJldHVybiAoMCwgZXhlY3V0ZV9vcGVyYXRpb25fMS5leGVjdXRlT3BlcmF0aW9uKSh0aGlzLmNsaWVudCwgbmV3IHVwZGF0ZV8xLlVwZGF0ZVNlYXJjaEluZGV4T3BlcmF0aW9uKHRoaXMsIG5hbWUsIGRlZmluaXRpb24pKTtcbiAgICB9XG59XG5leHBvcnRzLkNvbGxlY3Rpb24gPSBDb2xsZWN0aW9uO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y29sbGVjdGlvbi5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/collection.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/connection_string.js":
/*!***************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/connection_string.js ***!
  \***************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.FEATURE_FLAGS = exports.DEFAULT_OPTIONS = exports.OPTIONS = exports.parseOptions = exports.resolveSRVRecord = void 0;\nconst dns = __webpack_require__(/*! dns */ \"dns\");\nconst fs = __webpack_require__(/*! fs */ \"fs\");\nconst mongodb_connection_string_url_1 = __webpack_require__(/*! mongodb-connection-string-url */ \"(api)/../server/node_modules/mongodb-connection-string-url/lib/index.js\");\nconst url_1 = __webpack_require__(/*! url */ \"url\");\nconst mongo_credentials_1 = __webpack_require__(/*! ./cmap/auth/mongo_credentials */ \"(api)/../server/node_modules/mongodb/lib/cmap/auth/mongo_credentials.js\");\nconst providers_1 = __webpack_require__(/*! ./cmap/auth/providers */ \"(api)/../server/node_modules/mongodb/lib/cmap/auth/providers.js\");\nconst client_metadata_1 = __webpack_require__(/*! ./cmap/handshake/client_metadata */ \"(api)/../server/node_modules/mongodb/lib/cmap/handshake/client_metadata.js\");\nconst compression_1 = __webpack_require__(/*! ./cmap/wire_protocol/compression */ \"(api)/../server/node_modules/mongodb/lib/cmap/wire_protocol/compression.js\");\nconst encrypter_1 = __webpack_require__(/*! ./encrypter */ \"(api)/../server/node_modules/mongodb/lib/encrypter.js\");\nconst error_1 = __webpack_require__(/*! ./error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst mongo_client_1 = __webpack_require__(/*! ./mongo_client */ \"(api)/../server/node_modules/mongodb/lib/mongo_client.js\");\nconst mongo_logger_1 = __webpack_require__(/*! ./mongo_logger */ \"(api)/../server/node_modules/mongodb/lib/mongo_logger.js\");\nconst read_concern_1 = __webpack_require__(/*! ./read_concern */ \"(api)/../server/node_modules/mongodb/lib/read_concern.js\");\nconst read_preference_1 = __webpack_require__(/*! ./read_preference */ \"(api)/../server/node_modules/mongodb/lib/read_preference.js\");\nconst utils_1 = __webpack_require__(/*! ./utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\nconst write_concern_1 = __webpack_require__(/*! ./write_concern */ \"(api)/../server/node_modules/mongodb/lib/write_concern.js\");\nconst VALID_TXT_RECORDS = ['authSource', 'replicaSet', 'loadBalanced'];\nconst LB_SINGLE_HOST_ERROR = 'loadBalanced option only supported with a single host in the URI';\nconst LB_REPLICA_SET_ERROR = 'loadBalanced option not supported with a replicaSet option';\nconst LB_DIRECT_CONNECTION_ERROR = 'loadBalanced option not supported when directConnection is provided';\n/**\n * Lookup a `mongodb+srv` connection string, combine the parts and reparse it as a normal\n * connection string.\n *\n * @param uri - The connection string to parse\n * @param options - Optional user provided connection string options\n */\nasync function resolveSRVRecord(options) {\n    if (typeof options.srvHost !== 'string') {\n        throw new error_1.MongoAPIError('Option \"srvHost\" must not be empty');\n    }\n    if (options.srvHost.split('.').length < 3) {\n        // TODO(NODE-3484): Replace with MongoConnectionStringError\n        throw new error_1.MongoAPIError('URI must include hostname, domain name, and tld');\n    }\n    // Resolve the SRV record and use the result as the list of hosts to connect to.\n    const lookupAddress = options.srvHost;\n    const addresses = await dns.promises.resolveSrv(`_${options.srvServiceName}._tcp.${lookupAddress}`);\n    if (addresses.length === 0) {\n        throw new error_1.MongoAPIError('No addresses found at host');\n    }\n    for (const { name } of addresses) {\n        if (!(0, utils_1.matchesParentDomain)(name, lookupAddress)) {\n            throw new error_1.MongoAPIError('Server record does not share hostname with parent URI');\n        }\n    }\n    const hostAddresses = addresses.map(r => utils_1.HostAddress.fromString(`${r.name}:${r.port ?? 27017}`));\n    validateLoadBalancedOptions(hostAddresses, options, true);\n    // Resolve TXT record and add options from there if they exist.\n    let record;\n    try {\n        record = await dns.promises.resolveTxt(lookupAddress);\n    }\n    catch (error) {\n        if (error.code !== 'ENODATA' && error.code !== 'ENOTFOUND') {\n            throw error;\n        }\n        return hostAddresses;\n    }\n    if (record.length > 1) {\n        throw new error_1.MongoParseError('Multiple text records not allowed');\n    }\n    const txtRecordOptions = new url_1.URLSearchParams(record[0].join(''));\n    const txtRecordOptionKeys = [...txtRecordOptions.keys()];\n    if (txtRecordOptionKeys.some(key => !VALID_TXT_RECORDS.includes(key))) {\n        throw new error_1.MongoParseError(`Text record may only set any of: ${VALID_TXT_RECORDS.join(', ')}`);\n    }\n    if (VALID_TXT_RECORDS.some(option => txtRecordOptions.get(option) === '')) {\n        throw new error_1.MongoParseError('Cannot have empty URI params in DNS TXT Record');\n    }\n    const source = txtRecordOptions.get('authSource') ?? undefined;\n    const replicaSet = txtRecordOptions.get('replicaSet') ?? undefined;\n    const loadBalanced = txtRecordOptions.get('loadBalanced') ?? undefined;\n    if (!options.userSpecifiedAuthSource &&\n        source &&\n        options.credentials &&\n        !providers_1.AUTH_MECHS_AUTH_SRC_EXTERNAL.has(options.credentials.mechanism)) {\n        options.credentials = mongo_credentials_1.MongoCredentials.merge(options.credentials, { source });\n    }\n    if (!options.userSpecifiedReplicaSet && replicaSet) {\n        options.replicaSet = replicaSet;\n    }\n    if (loadBalanced === 'true') {\n        options.loadBalanced = true;\n    }\n    if (options.replicaSet && options.srvMaxHosts > 0) {\n        throw new error_1.MongoParseError('Cannot combine replicaSet option with srvMaxHosts');\n    }\n    validateLoadBalancedOptions(hostAddresses, options, true);\n    return hostAddresses;\n}\nexports.resolveSRVRecord = resolveSRVRecord;\n/**\n * Checks if TLS options are valid\n *\n * @param allOptions - All options provided by user or included in default options map\n * @throws MongoAPIError if TLS options are invalid\n */\nfunction checkTLSOptions(allOptions) {\n    if (!allOptions)\n        return;\n    const check = (a, b) => {\n        if (allOptions.has(a) && allOptions.has(b)) {\n            throw new error_1.MongoAPIError(`The '${a}' option cannot be used with the '${b}' option`);\n        }\n    };\n    check('tlsInsecure', 'tlsAllowInvalidCertificates');\n    check('tlsInsecure', 'tlsAllowInvalidHostnames');\n    check('tlsInsecure', 'tlsDisableCertificateRevocationCheck');\n    check('tlsInsecure', 'tlsDisableOCSPEndpointCheck');\n    check('tlsAllowInvalidCertificates', 'tlsDisableCertificateRevocationCheck');\n    check('tlsAllowInvalidCertificates', 'tlsDisableOCSPEndpointCheck');\n    check('tlsDisableCertificateRevocationCheck', 'tlsDisableOCSPEndpointCheck');\n}\nconst TRUTHS = new Set(['true', 't', '1', 'y', 'yes']);\nconst FALSEHOODS = new Set(['false', 'f', '0', 'n', 'no', '-1']);\nfunction getBoolean(name, value) {\n    if (typeof value === 'boolean')\n        return value;\n    const valueString = String(value).toLowerCase();\n    if (TRUTHS.has(valueString)) {\n        if (valueString !== 'true') {\n            (0, utils_1.emitWarningOnce)(`deprecated value for ${name} : ${valueString} - please update to ${name} : true instead`);\n        }\n        return true;\n    }\n    if (FALSEHOODS.has(valueString)) {\n        if (valueString !== 'false') {\n            (0, utils_1.emitWarningOnce)(`deprecated value for ${name} : ${valueString} - please update to ${name} : false instead`);\n        }\n        return false;\n    }\n    throw new error_1.MongoParseError(`Expected ${name} to be stringified boolean value, got: ${value}`);\n}\nfunction getIntFromOptions(name, value) {\n    const parsedInt = (0, utils_1.parseInteger)(value);\n    if (parsedInt != null) {\n        return parsedInt;\n    }\n    throw new error_1.MongoParseError(`Expected ${name} to be stringified int value, got: ${value}`);\n}\nfunction getUIntFromOptions(name, value) {\n    const parsedValue = getIntFromOptions(name, value);\n    if (parsedValue < 0) {\n        throw new error_1.MongoParseError(`${name} can only be a positive int value, got: ${value}`);\n    }\n    return parsedValue;\n}\nfunction* entriesFromString(value) {\n    const keyValuePairs = value.split(',');\n    for (const keyValue of keyValuePairs) {\n        const [key, value] = keyValue.split(/:(.*)/);\n        if (value == null) {\n            throw new error_1.MongoParseError('Cannot have undefined values in key value pairs');\n        }\n        yield [key, value];\n    }\n}\nclass CaseInsensitiveMap extends Map {\n    constructor(entries = []) {\n        super(entries.map(([k, v]) => [k.toLowerCase(), v]));\n    }\n    has(k) {\n        return super.has(k.toLowerCase());\n    }\n    get(k) {\n        return super.get(k.toLowerCase());\n    }\n    set(k, v) {\n        return super.set(k.toLowerCase(), v);\n    }\n    delete(k) {\n        return super.delete(k.toLowerCase());\n    }\n}\nfunction parseOptions(uri, mongoClient = undefined, options = {}) {\n    if (mongoClient != null && !(mongoClient instanceof mongo_client_1.MongoClient)) {\n        options = mongoClient;\n        mongoClient = undefined;\n    }\n    // validate BSONOptions\n    if (options.useBigInt64 && typeof options.promoteLongs === 'boolean' && !options.promoteLongs) {\n        throw new error_1.MongoAPIError('Must request either bigint or Long for int64 deserialization');\n    }\n    if (options.useBigInt64 && typeof options.promoteValues === 'boolean' && !options.promoteValues) {\n        throw new error_1.MongoAPIError('Must request either bigint or Long for int64 deserialization');\n    }\n    const url = new mongodb_connection_string_url_1.default(uri);\n    const { hosts, isSRV } = url;\n    const mongoOptions = Object.create(null);\n    // Feature flags\n    for (const flag of Object.getOwnPropertySymbols(options)) {\n        if (exports.FEATURE_FLAGS.has(flag)) {\n            mongoOptions[flag] = options[flag];\n        }\n    }\n    mongoOptions.hosts = isSRV ? [] : hosts.map(utils_1.HostAddress.fromString);\n    const urlOptions = new CaseInsensitiveMap();\n    if (url.pathname !== '/' && url.pathname !== '') {\n        const dbName = decodeURIComponent(url.pathname[0] === '/' ? url.pathname.slice(1) : url.pathname);\n        if (dbName) {\n            urlOptions.set('dbName', [dbName]);\n        }\n    }\n    if (url.username !== '') {\n        const auth = {\n            username: decodeURIComponent(url.username)\n        };\n        if (typeof url.password === 'string') {\n            auth.password = decodeURIComponent(url.password);\n        }\n        urlOptions.set('auth', [auth]);\n    }\n    for (const key of url.searchParams.keys()) {\n        const values = [...url.searchParams.getAll(key)];\n        if (values.includes('')) {\n            throw new error_1.MongoAPIError('URI cannot contain options with no value');\n        }\n        if (!urlOptions.has(key)) {\n            urlOptions.set(key, values);\n        }\n    }\n    const objectOptions = new CaseInsensitiveMap(Object.entries(options).filter(([, v]) => v != null));\n    // Validate options that can only be provided by one of uri or object\n    if (urlOptions.has('serverApi')) {\n        throw new error_1.MongoParseError('URI cannot contain `serverApi`, it can only be passed to the client');\n    }\n    const uriMechanismProperties = urlOptions.get('authMechanismProperties');\n    if (uriMechanismProperties) {\n        for (const property of uriMechanismProperties) {\n            if (/(^|,)ALLOWED_HOSTS:/.test(property)) {\n                throw new error_1.MongoParseError('Auth mechanism property ALLOWED_HOSTS is not allowed in the connection string.');\n            }\n        }\n    }\n    if (objectOptions.has('loadBalanced')) {\n        throw new error_1.MongoParseError('loadBalanced is only a valid option in the URI');\n    }\n    // All option collection\n    const allProvidedOptions = new CaseInsensitiveMap();\n    const allProvidedKeys = new Set([...urlOptions.keys(), ...objectOptions.keys()]);\n    for (const key of allProvidedKeys) {\n        const values = [];\n        const objectOptionValue = objectOptions.get(key);\n        if (objectOptionValue != null) {\n            values.push(objectOptionValue);\n        }\n        const urlValues = urlOptions.get(key) ?? [];\n        values.push(...urlValues);\n        allProvidedOptions.set(key, values);\n    }\n    const didMapTLSCertificateFile = allProvidedOptions.has('tlsCertificateKeyFile') &&\n        !allProvidedOptions.has('tlsCertificateFile');\n    if (didMapTLSCertificateFile) {\n        allProvidedOptions.set('tlsCertificateFile', allProvidedOptions.get('tlsCertificateKeyFile'));\n    }\n    if (allProvidedOptions.has('tls') || allProvidedOptions.has('ssl')) {\n        const tlsAndSslOpts = (allProvidedOptions.get('tls') || [])\n            .concat(allProvidedOptions.get('ssl') || [])\n            .map(getBoolean.bind(null, 'tls/ssl'));\n        if (new Set(tlsAndSslOpts).size !== 1) {\n            throw new error_1.MongoParseError('All values of tls/ssl must be the same.');\n        }\n    }\n    checkTLSOptions(allProvidedOptions);\n    const unsupportedOptions = (0, utils_1.setDifference)(allProvidedKeys, Array.from(Object.keys(exports.OPTIONS)).map(s => s.toLowerCase()));\n    if (unsupportedOptions.size !== 0) {\n        const optionWord = unsupportedOptions.size > 1 ? 'options' : 'option';\n        const isOrAre = unsupportedOptions.size > 1 ? 'are' : 'is';\n        throw new error_1.MongoParseError(`${optionWord} ${Array.from(unsupportedOptions).join(', ')} ${isOrAre} not supported`);\n    }\n    // Option parsing and setting\n    for (const [key, descriptor] of Object.entries(exports.OPTIONS)) {\n        const values = allProvidedOptions.get(key);\n        if (!values || values.length === 0) {\n            if (exports.DEFAULT_OPTIONS.has(key)) {\n                setOption(mongoOptions, key, descriptor, [exports.DEFAULT_OPTIONS.get(key)]);\n            }\n        }\n        else {\n            const { deprecated } = descriptor;\n            const shouldEmitTLSCertificateFileDeprecation = didMapTLSCertificateFile && key === 'tlsCertificateFile';\n            if (deprecated && !shouldEmitTLSCertificateFileDeprecation) {\n                const deprecatedMsg = typeof deprecated === 'string' ? `: ${deprecated}` : '';\n                (0, utils_1.emitWarning)(`${key} is a deprecated option${deprecatedMsg}`);\n            }\n            setOption(mongoOptions, key, descriptor, values);\n        }\n    }\n    if (mongoOptions.credentials) {\n        const isGssapi = mongoOptions.credentials.mechanism === providers_1.AuthMechanism.MONGODB_GSSAPI;\n        const isX509 = mongoOptions.credentials.mechanism === providers_1.AuthMechanism.MONGODB_X509;\n        const isAws = mongoOptions.credentials.mechanism === providers_1.AuthMechanism.MONGODB_AWS;\n        const isOidc = mongoOptions.credentials.mechanism === providers_1.AuthMechanism.MONGODB_OIDC;\n        if ((isGssapi || isX509) &&\n            allProvidedOptions.has('authSource') &&\n            mongoOptions.credentials.source !== '$external') {\n            // If authSource was explicitly given and its incorrect, we error\n            throw new error_1.MongoParseError(`authMechanism ${mongoOptions.credentials.mechanism} requires an authSource of '$external'`);\n        }\n        if (!(isGssapi || isX509 || isAws || isOidc) &&\n            mongoOptions.dbName &&\n            !allProvidedOptions.has('authSource')) {\n            // inherit the dbName unless GSSAPI or X509, then silently ignore dbName\n            // and there was no specific authSource given\n            mongoOptions.credentials = mongo_credentials_1.MongoCredentials.merge(mongoOptions.credentials, {\n                source: mongoOptions.dbName\n            });\n        }\n        if (isAws && mongoOptions.credentials.username && !mongoOptions.credentials.password) {\n            throw new error_1.MongoMissingCredentialsError(`When using ${mongoOptions.credentials.mechanism} password must be set when a username is specified`);\n        }\n        mongoOptions.credentials.validate();\n        // Check if the only auth related option provided was authSource, if so we can remove credentials\n        if (mongoOptions.credentials.password === '' &&\n            mongoOptions.credentials.username === '' &&\n            mongoOptions.credentials.mechanism === providers_1.AuthMechanism.MONGODB_DEFAULT &&\n            Object.keys(mongoOptions.credentials.mechanismProperties).length === 0) {\n            delete mongoOptions.credentials;\n        }\n    }\n    if (!mongoOptions.dbName) {\n        // dbName default is applied here because of the credential validation above\n        mongoOptions.dbName = 'test';\n    }\n    validateLoadBalancedOptions(hosts, mongoOptions, isSRV);\n    if (mongoClient && mongoOptions.autoEncryption) {\n        encrypter_1.Encrypter.checkForMongoCrypt();\n        mongoOptions.encrypter = new encrypter_1.Encrypter(mongoClient, uri, options);\n        mongoOptions.autoEncrypter = mongoOptions.encrypter.autoEncrypter;\n    }\n    // Potential SRV Overrides and SRV connection string validations\n    mongoOptions.userSpecifiedAuthSource =\n        objectOptions.has('authSource') || urlOptions.has('authSource');\n    mongoOptions.userSpecifiedReplicaSet =\n        objectOptions.has('replicaSet') || urlOptions.has('replicaSet');\n    if (isSRV) {\n        // SRV Record is resolved upon connecting\n        mongoOptions.srvHost = hosts[0];\n        if (mongoOptions.directConnection) {\n            throw new error_1.MongoAPIError('SRV URI does not support directConnection');\n        }\n        if (mongoOptions.srvMaxHosts > 0 && typeof mongoOptions.replicaSet === 'string') {\n            throw new error_1.MongoParseError('Cannot use srvMaxHosts option with replicaSet');\n        }\n        // SRV turns on TLS by default, but users can override and turn it off\n        const noUserSpecifiedTLS = !objectOptions.has('tls') && !urlOptions.has('tls');\n        const noUserSpecifiedSSL = !objectOptions.has('ssl') && !urlOptions.has('ssl');\n        if (noUserSpecifiedTLS && noUserSpecifiedSSL) {\n            mongoOptions.tls = true;\n        }\n    }\n    else {\n        const userSpecifiedSrvOptions = urlOptions.has('srvMaxHosts') ||\n            objectOptions.has('srvMaxHosts') ||\n            urlOptions.has('srvServiceName') ||\n            objectOptions.has('srvServiceName');\n        if (userSpecifiedSrvOptions) {\n            throw new error_1.MongoParseError('Cannot use srvMaxHosts or srvServiceName with a non-srv connection string');\n        }\n    }\n    if (mongoOptions.directConnection && mongoOptions.hosts.length !== 1) {\n        throw new error_1.MongoParseError('directConnection option requires exactly one host');\n    }\n    if (!mongoOptions.proxyHost &&\n        (mongoOptions.proxyPort || mongoOptions.proxyUsername || mongoOptions.proxyPassword)) {\n        throw new error_1.MongoParseError('Must specify proxyHost if other proxy options are passed');\n    }\n    if ((mongoOptions.proxyUsername && !mongoOptions.proxyPassword) ||\n        (!mongoOptions.proxyUsername && mongoOptions.proxyPassword)) {\n        throw new error_1.MongoParseError('Can only specify both of proxy username/password or neither');\n    }\n    const proxyOptions = ['proxyHost', 'proxyPort', 'proxyUsername', 'proxyPassword'].map(key => urlOptions.get(key) ?? []);\n    if (proxyOptions.some(options => options.length > 1)) {\n        throw new error_1.MongoParseError('Proxy options cannot be specified multiple times in the connection string');\n    }\n    const loggerFeatureFlag = Symbol.for('@@mdb.enableMongoLogger');\n    mongoOptions[loggerFeatureFlag] = mongoOptions[loggerFeatureFlag] ?? false;\n    let loggerEnvOptions = {};\n    let loggerClientOptions = {};\n    if (mongoOptions[loggerFeatureFlag]) {\n        loggerEnvOptions = {\n            MONGODB_LOG_COMMAND: process.env.MONGODB_LOG_COMMAND,\n            MONGODB_LOG_TOPOLOGY: process.env.MONGODB_LOG_TOPOLOGY,\n            MONGODB_LOG_SERVER_SELECTION: process.env.MONGODB_LOG_SERVER_SELECTION,\n            MONGODB_LOG_CONNECTION: process.env.MONGODB_LOG_CONNECTION,\n            MONGODB_LOG_ALL: process.env.MONGODB_LOG_ALL,\n            MONGODB_LOG_MAX_DOCUMENT_LENGTH: process.env.MONGODB_LOG_MAX_DOCUMENT_LENGTH,\n            MONGODB_LOG_PATH: process.env.MONGODB_LOG_PATH,\n            ...mongoOptions[Symbol.for('@@mdb.internalLoggerConfig')]\n        };\n        loggerClientOptions = {\n            mongodbLogPath: mongoOptions.mongodbLogPath\n        };\n    }\n    mongoOptions.mongoLoggerOptions = mongo_logger_1.MongoLogger.resolveOptions(loggerEnvOptions, loggerClientOptions);\n    mongoOptions.metadata = (0, client_metadata_1.makeClientMetadata)(mongoOptions);\n    return mongoOptions;\n}\nexports.parseOptions = parseOptions;\n/**\n * #### Throws if LB mode is true:\n * - hosts contains more than one host\n * - there is a replicaSet name set\n * - directConnection is set\n * - if srvMaxHosts is used when an srv connection string is passed in\n *\n * @throws MongoParseError\n */\nfunction validateLoadBalancedOptions(hosts, mongoOptions, isSrv) {\n    if (mongoOptions.loadBalanced) {\n        if (hosts.length > 1) {\n            throw new error_1.MongoParseError(LB_SINGLE_HOST_ERROR);\n        }\n        if (mongoOptions.replicaSet) {\n            throw new error_1.MongoParseError(LB_REPLICA_SET_ERROR);\n        }\n        if (mongoOptions.directConnection) {\n            throw new error_1.MongoParseError(LB_DIRECT_CONNECTION_ERROR);\n        }\n        if (isSrv && mongoOptions.srvMaxHosts > 0) {\n            throw new error_1.MongoParseError('Cannot limit srv hosts with loadBalanced enabled');\n        }\n    }\n    return;\n}\nfunction setOption(mongoOptions, key, descriptor, values) {\n    const { target, type, transform } = descriptor;\n    const name = target ?? key;\n    switch (type) {\n        case 'boolean':\n            mongoOptions[name] = getBoolean(name, values[0]);\n            break;\n        case 'int':\n            mongoOptions[name] = getIntFromOptions(name, values[0]);\n            break;\n        case 'uint':\n            mongoOptions[name] = getUIntFromOptions(name, values[0]);\n            break;\n        case 'string':\n            if (values[0] == null) {\n                break;\n            }\n            mongoOptions[name] = String(values[0]);\n            break;\n        case 'record':\n            if (!(0, utils_1.isRecord)(values[0])) {\n                throw new error_1.MongoParseError(`${name} must be an object`);\n            }\n            mongoOptions[name] = values[0];\n            break;\n        case 'any':\n            mongoOptions[name] = values[0];\n            break;\n        default: {\n            if (!transform) {\n                throw new error_1.MongoParseError('Descriptors missing a type must define a transform');\n            }\n            const transformValue = transform({ name, options: mongoOptions, values });\n            mongoOptions[name] = transformValue;\n            break;\n        }\n    }\n}\nexports.OPTIONS = {\n    appName: {\n        type: 'string'\n    },\n    auth: {\n        target: 'credentials',\n        transform({ name, options, values: [value] }) {\n            if (!(0, utils_1.isRecord)(value, ['username', 'password'])) {\n                throw new error_1.MongoParseError(`${name} must be an object with 'username' and 'password' properties`);\n            }\n            return mongo_credentials_1.MongoCredentials.merge(options.credentials, {\n                username: value.username,\n                password: value.password\n            });\n        }\n    },\n    authMechanism: {\n        target: 'credentials',\n        transform({ options, values: [value] }) {\n            const mechanisms = Object.values(providers_1.AuthMechanism);\n            const [mechanism] = mechanisms.filter(m => m.match(RegExp(String.raw `\\b${value}\\b`, 'i')));\n            if (!mechanism) {\n                throw new error_1.MongoParseError(`authMechanism one of ${mechanisms}, got ${value}`);\n            }\n            let source = options.credentials?.source;\n            if (mechanism === providers_1.AuthMechanism.MONGODB_PLAIN ||\n                providers_1.AUTH_MECHS_AUTH_SRC_EXTERNAL.has(mechanism)) {\n                // some mechanisms have '$external' as the Auth Source\n                source = '$external';\n            }\n            let password = options.credentials?.password;\n            if (mechanism === providers_1.AuthMechanism.MONGODB_X509 && password === '') {\n                password = undefined;\n            }\n            return mongo_credentials_1.MongoCredentials.merge(options.credentials, {\n                mechanism,\n                source,\n                password\n            });\n        }\n    },\n    authMechanismProperties: {\n        target: 'credentials',\n        transform({ options, values }) {\n            // We can have a combination of options passed in the URI and options passed\n            // as an object to the MongoClient. So we must transform the string options\n            // as well as merge them together with a potentially provided object.\n            let mechanismProperties = Object.create(null);\n            for (const optionValue of values) {\n                if (typeof optionValue === 'string') {\n                    for (const [key, value] of entriesFromString(optionValue)) {\n                        try {\n                            mechanismProperties[key] = getBoolean(key, value);\n                        }\n                        catch {\n                            mechanismProperties[key] = value;\n                        }\n                    }\n                }\n                else {\n                    if (!(0, utils_1.isRecord)(optionValue)) {\n                        throw new error_1.MongoParseError('AuthMechanismProperties must be an object');\n                    }\n                    mechanismProperties = { ...optionValue };\n                }\n            }\n            return mongo_credentials_1.MongoCredentials.merge(options.credentials, {\n                mechanismProperties\n            });\n        }\n    },\n    authSource: {\n        target: 'credentials',\n        transform({ options, values: [value] }) {\n            const source = String(value);\n            return mongo_credentials_1.MongoCredentials.merge(options.credentials, { source });\n        }\n    },\n    autoEncryption: {\n        type: 'record'\n    },\n    bsonRegExp: {\n        type: 'boolean'\n    },\n    serverApi: {\n        target: 'serverApi',\n        transform({ values: [version] }) {\n            const serverApiToValidate = typeof version === 'string' ? { version } : version;\n            const versionToValidate = serverApiToValidate && serverApiToValidate.version;\n            if (!versionToValidate) {\n                throw new error_1.MongoParseError(`Invalid \\`serverApi\\` property; must specify a version from the following enum: [\"${Object.values(mongo_client_1.ServerApiVersion).join('\", \"')}\"]`);\n            }\n            if (!Object.values(mongo_client_1.ServerApiVersion).some(v => v === versionToValidate)) {\n                throw new error_1.MongoParseError(`Invalid server API version=${versionToValidate}; must be in the following enum: [\"${Object.values(mongo_client_1.ServerApiVersion).join('\", \"')}\"]`);\n            }\n            return serverApiToValidate;\n        }\n    },\n    checkKeys: {\n        type: 'boolean'\n    },\n    compressors: {\n        default: 'none',\n        target: 'compressors',\n        transform({ values }) {\n            const compressionList = new Set();\n            for (const compVal of values) {\n                const compValArray = typeof compVal === 'string' ? compVal.split(',') : compVal;\n                if (!Array.isArray(compValArray)) {\n                    throw new error_1.MongoInvalidArgumentError('compressors must be an array or a comma-delimited list of strings');\n                }\n                for (const c of compValArray) {\n                    if (Object.keys(compression_1.Compressor).includes(String(c))) {\n                        compressionList.add(String(c));\n                    }\n                    else {\n                        throw new error_1.MongoInvalidArgumentError(`${c} is not a valid compression mechanism. Must be one of: ${Object.keys(compression_1.Compressor)}.`);\n                    }\n                }\n            }\n            return [...compressionList];\n        }\n    },\n    connectTimeoutMS: {\n        default: 30000,\n        type: 'uint'\n    },\n    dbName: {\n        type: 'string'\n    },\n    directConnection: {\n        default: false,\n        type: 'boolean'\n    },\n    driverInfo: {\n        default: {},\n        type: 'record'\n    },\n    enableUtf8Validation: { type: 'boolean', default: true },\n    family: {\n        transform({ name, values: [value] }) {\n            const transformValue = getIntFromOptions(name, value);\n            if (transformValue === 4 || transformValue === 6) {\n                return transformValue;\n            }\n            throw new error_1.MongoParseError(`Option 'family' must be 4 or 6 got ${transformValue}.`);\n        }\n    },\n    fieldsAsRaw: {\n        type: 'record'\n    },\n    forceServerObjectId: {\n        default: false,\n        type: 'boolean'\n    },\n    fsync: {\n        deprecated: 'Please use journal instead',\n        target: 'writeConcern',\n        transform({ name, options, values: [value] }) {\n            const wc = write_concern_1.WriteConcern.fromOptions({\n                writeConcern: {\n                    ...options.writeConcern,\n                    fsync: getBoolean(name, value)\n                }\n            });\n            if (!wc)\n                throw new error_1.MongoParseError(`Unable to make a writeConcern from fsync=${value}`);\n            return wc;\n        }\n    },\n    heartbeatFrequencyMS: {\n        default: 10000,\n        type: 'uint'\n    },\n    ignoreUndefined: {\n        type: 'boolean'\n    },\n    j: {\n        deprecated: 'Please use journal instead',\n        target: 'writeConcern',\n        transform({ name, options, values: [value] }) {\n            const wc = write_concern_1.WriteConcern.fromOptions({\n                writeConcern: {\n                    ...options.writeConcern,\n                    journal: getBoolean(name, value)\n                }\n            });\n            if (!wc)\n                throw new error_1.MongoParseError(`Unable to make a writeConcern from journal=${value}`);\n            return wc;\n        }\n    },\n    journal: {\n        target: 'writeConcern',\n        transform({ name, options, values: [value] }) {\n            const wc = write_concern_1.WriteConcern.fromOptions({\n                writeConcern: {\n                    ...options.writeConcern,\n                    journal: getBoolean(name, value)\n                }\n            });\n            if (!wc)\n                throw new error_1.MongoParseError(`Unable to make a writeConcern from journal=${value}`);\n            return wc;\n        }\n    },\n    keepAlive: {\n        default: true,\n        type: 'boolean',\n        deprecated: 'Will not be able to turn off in the future.'\n    },\n    keepAliveInitialDelay: {\n        default: 120000,\n        type: 'uint',\n        deprecated: 'Will not be configurable in the future.'\n    },\n    loadBalanced: {\n        default: false,\n        type: 'boolean'\n    },\n    localThresholdMS: {\n        default: 15,\n        type: 'uint'\n    },\n    maxConnecting: {\n        default: 2,\n        transform({ name, values: [value] }) {\n            const maxConnecting = getUIntFromOptions(name, value);\n            if (maxConnecting === 0) {\n                throw new error_1.MongoInvalidArgumentError('maxConnecting must be > 0 if specified');\n            }\n            return maxConnecting;\n        }\n    },\n    maxIdleTimeMS: {\n        default: 0,\n        type: 'uint'\n    },\n    maxPoolSize: {\n        default: 100,\n        type: 'uint'\n    },\n    maxStalenessSeconds: {\n        target: 'readPreference',\n        transform({ name, options, values: [value] }) {\n            const maxStalenessSeconds = getUIntFromOptions(name, value);\n            if (options.readPreference) {\n                return read_preference_1.ReadPreference.fromOptions({\n                    readPreference: { ...options.readPreference, maxStalenessSeconds }\n                });\n            }\n            else {\n                return new read_preference_1.ReadPreference('secondary', undefined, { maxStalenessSeconds });\n            }\n        }\n    },\n    minInternalBufferSize: {\n        type: 'uint'\n    },\n    minPoolSize: {\n        default: 0,\n        type: 'uint'\n    },\n    minHeartbeatFrequencyMS: {\n        default: 500,\n        type: 'uint'\n    },\n    monitorCommands: {\n        default: false,\n        type: 'boolean'\n    },\n    name: {\n        target: 'driverInfo',\n        transform({ values: [value], options }) {\n            return { ...options.driverInfo, name: String(value) };\n        }\n    },\n    noDelay: {\n        default: true,\n        type: 'boolean'\n    },\n    pkFactory: {\n        default: utils_1.DEFAULT_PK_FACTORY,\n        transform({ values: [value] }) {\n            if ((0, utils_1.isRecord)(value, ['createPk']) && typeof value.createPk === 'function') {\n                return value;\n            }\n            throw new error_1.MongoParseError(`Option pkFactory must be an object with a createPk function, got ${value}`);\n        }\n    },\n    promoteBuffers: {\n        type: 'boolean'\n    },\n    promoteLongs: {\n        type: 'boolean'\n    },\n    promoteValues: {\n        type: 'boolean'\n    },\n    useBigInt64: {\n        type: 'boolean'\n    },\n    proxyHost: {\n        type: 'string'\n    },\n    proxyPassword: {\n        type: 'string'\n    },\n    proxyPort: {\n        type: 'uint'\n    },\n    proxyUsername: {\n        type: 'string'\n    },\n    raw: {\n        default: false,\n        type: 'boolean'\n    },\n    readConcern: {\n        transform({ values: [value], options }) {\n            if (value instanceof read_concern_1.ReadConcern || (0, utils_1.isRecord)(value, ['level'])) {\n                return read_concern_1.ReadConcern.fromOptions({ ...options.readConcern, ...value });\n            }\n            throw new error_1.MongoParseError(`ReadConcern must be an object, got ${JSON.stringify(value)}`);\n        }\n    },\n    readConcernLevel: {\n        target: 'readConcern',\n        transform({ values: [level], options }) {\n            return read_concern_1.ReadConcern.fromOptions({\n                ...options.readConcern,\n                level: level\n            });\n        }\n    },\n    readPreference: {\n        default: read_preference_1.ReadPreference.primary,\n        transform({ values: [value], options }) {\n            if (value instanceof read_preference_1.ReadPreference) {\n                return read_preference_1.ReadPreference.fromOptions({\n                    readPreference: { ...options.readPreference, ...value },\n                    ...value\n                });\n            }\n            if ((0, utils_1.isRecord)(value, ['mode'])) {\n                const rp = read_preference_1.ReadPreference.fromOptions({\n                    readPreference: { ...options.readPreference, ...value },\n                    ...value\n                });\n                if (rp)\n                    return rp;\n                else\n                    throw new error_1.MongoParseError(`Cannot make read preference from ${JSON.stringify(value)}`);\n            }\n            if (typeof value === 'string') {\n                const rpOpts = {\n                    hedge: options.readPreference?.hedge,\n                    maxStalenessSeconds: options.readPreference?.maxStalenessSeconds\n                };\n                return new read_preference_1.ReadPreference(value, options.readPreference?.tags, rpOpts);\n            }\n            throw new error_1.MongoParseError(`Unknown ReadPreference value: ${value}`);\n        }\n    },\n    readPreferenceTags: {\n        target: 'readPreference',\n        transform({ values, options }) {\n            const tags = Array.isArray(values[0])\n                ? values[0]\n                : values;\n            const readPreferenceTags = [];\n            for (const tag of tags) {\n                const readPreferenceTag = Object.create(null);\n                if (typeof tag === 'string') {\n                    for (const [k, v] of entriesFromString(tag)) {\n                        readPreferenceTag[k] = v;\n                    }\n                }\n                if ((0, utils_1.isRecord)(tag)) {\n                    for (const [k, v] of Object.entries(tag)) {\n                        readPreferenceTag[k] = v;\n                    }\n                }\n                readPreferenceTags.push(readPreferenceTag);\n            }\n            return read_preference_1.ReadPreference.fromOptions({\n                readPreference: options.readPreference,\n                readPreferenceTags\n            });\n        }\n    },\n    replicaSet: {\n        type: 'string'\n    },\n    retryReads: {\n        default: true,\n        type: 'boolean'\n    },\n    retryWrites: {\n        default: true,\n        type: 'boolean'\n    },\n    serializeFunctions: {\n        type: 'boolean'\n    },\n    serverSelectionTimeoutMS: {\n        default: 30000,\n        type: 'uint'\n    },\n    servername: {\n        type: 'string'\n    },\n    socketTimeoutMS: {\n        default: 0,\n        type: 'uint'\n    },\n    srvMaxHosts: {\n        type: 'uint',\n        default: 0\n    },\n    srvServiceName: {\n        type: 'string',\n        default: 'mongodb'\n    },\n    ssl: {\n        target: 'tls',\n        type: 'boolean'\n    },\n    sslCA: {\n        deprecated: 'sslCA is deprecated and will be removed in the next major version. Please use tlsCAFile instead.',\n        target: 'ca',\n        transform({ values: [value] }) {\n            return fs.readFileSync(String(value), { encoding: 'ascii' });\n        }\n    },\n    sslCRL: {\n        deprecated: 'sslCRL is deprecated and will be removed in the next major version and be replaced by tlsCRLFile in that release.',\n        target: 'crl',\n        transform({ values: [value] }) {\n            return fs.readFileSync(String(value), { encoding: 'ascii' });\n        }\n    },\n    sslCert: {\n        deprecated: 'sslCert is deprecated and will be removed in the next major version. Please use tlsCertificateKeyFile instead.',\n        target: 'cert',\n        transform({ values: [value] }) {\n            return fs.readFileSync(String(value), { encoding: 'ascii' });\n        }\n    },\n    sslKey: {\n        deprecated: 'sslKey is deprecated and will be removed in the next major version. Please use tlsCertificateKeyFile instead.',\n        target: 'key',\n        transform({ values: [value] }) {\n            return fs.readFileSync(String(value), { encoding: 'ascii' });\n        }\n    },\n    sslPass: {\n        deprecated: 'sslPass is deprecated and will be removed in the next major version. Please use tlsCertificateKeyFilePassword instead.',\n        target: 'passphrase',\n        type: 'string'\n    },\n    sslValidate: {\n        deprecated: 'sslValidate is deprecated and will be removed in the next major version. Please use tlsAllowInvalidCertificates instead.',\n        target: 'rejectUnauthorized',\n        type: 'boolean'\n    },\n    tls: {\n        type: 'boolean'\n    },\n    tlsAllowInvalidCertificates: {\n        target: 'rejectUnauthorized',\n        transform({ name, values: [value] }) {\n            // allowInvalidCertificates is the inverse of rejectUnauthorized\n            return !getBoolean(name, value);\n        }\n    },\n    tlsAllowInvalidHostnames: {\n        target: 'checkServerIdentity',\n        transform({ name, values: [value] }) {\n            // tlsAllowInvalidHostnames means setting the checkServerIdentity function to a noop\n            return getBoolean(name, value) ? () => undefined : undefined;\n        }\n    },\n    tlsCAFile: {\n        target: 'ca',\n        transform({ values: [value] }) {\n            return fs.readFileSync(String(value), { encoding: 'ascii' });\n        }\n    },\n    tlsCertificateFile: {\n        deprecated: 'tlsCertificateFile is deprecated and will be removed in the next major version. Please use tlsCertificateKeyFile instead.',\n        target: 'cert',\n        transform({ values: [value] }) {\n            return fs.readFileSync(String(value), { encoding: 'ascii' });\n        }\n    },\n    tlsCertificateKeyFile: {\n        target: 'key',\n        transform({ values: [value] }) {\n            return fs.readFileSync(String(value), { encoding: 'ascii' });\n        }\n    },\n    tlsCertificateKeyFilePassword: {\n        target: 'passphrase',\n        type: 'any'\n    },\n    tlsInsecure: {\n        transform({ name, options, values: [value] }) {\n            const tlsInsecure = getBoolean(name, value);\n            if (tlsInsecure) {\n                options.checkServerIdentity = () => undefined;\n                options.rejectUnauthorized = false;\n            }\n            else {\n                options.checkServerIdentity = options.tlsAllowInvalidHostnames\n                    ? () => undefined\n                    : undefined;\n                options.rejectUnauthorized = options.tlsAllowInvalidCertificates ? false : true;\n            }\n            return tlsInsecure;\n        }\n    },\n    w: {\n        target: 'writeConcern',\n        transform({ values: [value], options }) {\n            return write_concern_1.WriteConcern.fromOptions({ writeConcern: { ...options.writeConcern, w: value } });\n        }\n    },\n    waitQueueTimeoutMS: {\n        default: 0,\n        type: 'uint'\n    },\n    writeConcern: {\n        target: 'writeConcern',\n        transform({ values: [value], options }) {\n            if ((0, utils_1.isRecord)(value) || value instanceof write_concern_1.WriteConcern) {\n                return write_concern_1.WriteConcern.fromOptions({\n                    writeConcern: {\n                        ...options.writeConcern,\n                        ...value\n                    }\n                });\n            }\n            else if (value === 'majority' || typeof value === 'number') {\n                return write_concern_1.WriteConcern.fromOptions({\n                    writeConcern: {\n                        ...options.writeConcern,\n                        w: value\n                    }\n                });\n            }\n            throw new error_1.MongoParseError(`Invalid WriteConcern cannot parse: ${JSON.stringify(value)}`);\n        }\n    },\n    wtimeout: {\n        deprecated: 'Please use wtimeoutMS instead',\n        target: 'writeConcern',\n        transform({ values: [value], options }) {\n            const wc = write_concern_1.WriteConcern.fromOptions({\n                writeConcern: {\n                    ...options.writeConcern,\n                    wtimeout: getUIntFromOptions('wtimeout', value)\n                }\n            });\n            if (wc)\n                return wc;\n            throw new error_1.MongoParseError(`Cannot make WriteConcern from wtimeout`);\n        }\n    },\n    wtimeoutMS: {\n        target: 'writeConcern',\n        transform({ values: [value], options }) {\n            const wc = write_concern_1.WriteConcern.fromOptions({\n                writeConcern: {\n                    ...options.writeConcern,\n                    wtimeoutMS: getUIntFromOptions('wtimeoutMS', value)\n                }\n            });\n            if (wc)\n                return wc;\n            throw new error_1.MongoParseError(`Cannot make WriteConcern from wtimeout`);\n        }\n    },\n    zlibCompressionLevel: {\n        default: 0,\n        type: 'int'\n    },\n    // Custom types for modifying core behavior\n    connectionType: { type: 'any' },\n    srvPoller: { type: 'any' },\n    // Accepted NodeJS Options\n    minDHSize: { type: 'any' },\n    pskCallback: { type: 'any' },\n    secureContext: { type: 'any' },\n    enableTrace: { type: 'any' },\n    requestCert: { type: 'any' },\n    rejectUnauthorized: { type: 'any' },\n    checkServerIdentity: { type: 'any' },\n    ALPNProtocols: { type: 'any' },\n    SNICallback: { type: 'any' },\n    session: { type: 'any' },\n    requestOCSP: { type: 'any' },\n    localAddress: { type: 'any' },\n    localPort: { type: 'any' },\n    hints: { type: 'any' },\n    lookup: { type: 'any' },\n    ca: { type: 'any' },\n    cert: { type: 'any' },\n    ciphers: { type: 'any' },\n    crl: { type: 'any' },\n    ecdhCurve: { type: 'any' },\n    key: { type: 'any' },\n    passphrase: { type: 'any' },\n    pfx: { type: 'any' },\n    secureProtocol: { type: 'any' },\n    index: { type: 'any' },\n    // Legacy Options, these are unused but left here to avoid errors with CSFLE lib\n    useNewUrlParser: { type: 'boolean' },\n    useUnifiedTopology: { type: 'boolean' },\n    // MongoLogger\n    // TODO(NODE-4849): Tighten the type of mongodbLogPath\n    mongodbLogPath: { type: 'any' }\n};\nexports.DEFAULT_OPTIONS = new CaseInsensitiveMap(Object.entries(exports.OPTIONS)\n    .filter(([, descriptor]) => descriptor.default != null)\n    .map(([k, d]) => [k, d.default]));\n/**\n * Set of permitted feature flags\n * @internal\n */\nexports.FEATURE_FLAGS = new Set([\n    Symbol.for('@@mdb.skipPingOnConnect'),\n    Symbol.for('@@mdb.enableMongoLogger'),\n    Symbol.for('@@mdb.internalLoggerConfig')\n]);\n//# sourceMappingURL=connection_string.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jb25uZWN0aW9uX3N0cmluZy5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxxQkFBcUIsR0FBRyx1QkFBdUIsR0FBRyxlQUFlLEdBQUcsb0JBQW9CLEdBQUcsd0JBQXdCO0FBQ25ILFlBQVksbUJBQU8sQ0FBQyxnQkFBSztBQUN6QixXQUFXLG1CQUFPLENBQUMsY0FBSTtBQUN2Qix3Q0FBd0MsbUJBQU8sQ0FBQyw4R0FBK0I7QUFDL0UsY0FBYyxtQkFBTyxDQUFDLGdCQUFLO0FBQzNCLDRCQUE0QixtQkFBTyxDQUFDLDhHQUErQjtBQUNuRSxvQkFBb0IsbUJBQU8sQ0FBQyw4RkFBdUI7QUFDbkQsMEJBQTBCLG1CQUFPLENBQUMsb0hBQWtDO0FBQ3BFLHNCQUFzQixtQkFBTyxDQUFDLG9IQUFrQztBQUNoRSxvQkFBb0IsbUJBQU8sQ0FBQywwRUFBYTtBQUN6QyxnQkFBZ0IsbUJBQU8sQ0FBQyxrRUFBUztBQUNqQyx1QkFBdUIsbUJBQU8sQ0FBQyxnRkFBZ0I7QUFDL0MsdUJBQXVCLG1CQUFPLENBQUMsZ0ZBQWdCO0FBQy9DLHVCQUF1QixtQkFBTyxDQUFDLGdGQUFnQjtBQUMvQywwQkFBMEIsbUJBQU8sQ0FBQyxzRkFBbUI7QUFDckQsZ0JBQWdCLG1CQUFPLENBQUMsa0VBQVM7QUFDakMsd0JBQXdCLG1CQUFPLENBQUMsa0ZBQWlCO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdEQUF3RCx1QkFBdUIsUUFBUSxjQUFjO0FBQ3JHO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQixPQUFPO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0VBQStFLE9BQU8sR0FBRyxnQkFBZ0I7QUFDekc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEVBQThFLDZCQUE2QjtBQUMzRztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0dBQWdHLFFBQVE7QUFDeEc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0I7QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9EQUFvRCxFQUFFLG9DQUFvQyxFQUFFO0FBQzVGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlFQUFpRSxNQUFNLElBQUksYUFBYSxxQkFBcUIsTUFBTTtBQUNuSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUVBQWlFLE1BQU0sSUFBSSxhQUFhLHFCQUFxQixNQUFNO0FBQ25IO0FBQ0E7QUFDQTtBQUNBLGtEQUFrRCxNQUFNLHdDQUF3QyxNQUFNO0FBQ3RHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtEQUFrRCxNQUFNLG9DQUFvQyxNQUFNO0FBQ2xHO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkNBQTZDLE1BQU0seUNBQXlDLE1BQU07QUFDbEc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0VBQWdFO0FBQ2hFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksZUFBZTtBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkNBQTZDLFlBQVksRUFBRSwyQ0FBMkMsRUFBRSxTQUFTO0FBQ2pIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLGFBQWE7QUFDakM7QUFDQTtBQUNBLDRFQUE0RSxXQUFXO0FBQ3ZGLDRDQUE0QyxLQUFLLHdCQUF3QixjQUFjO0FBQ3ZGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0RBQStELG9DQUFvQztBQUNuRztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSx5RUFBeUUsb0NBQW9DO0FBQzdHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CO0FBQ3BCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksMEJBQTBCO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscURBQXFELE1BQU07QUFDM0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQ0FBK0MscUNBQXFDO0FBQ3BGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlO0FBQ2Y7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0Esb0JBQW9CLGdDQUFnQztBQUNwRDtBQUNBLHFEQUFxRCxNQUFNO0FBQzNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxvQkFBb0IsMEJBQTBCO0FBQzlDO0FBQ0Esc0ZBQXNGLE1BQU07QUFDNUY7QUFDQSwwRUFBMEUsV0FBVyxRQUFRLE1BQU07QUFDbkc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxvQkFBb0IsaUJBQWlCO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNENBQTRDO0FBQzVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxvQkFBb0IsMEJBQTBCO0FBQzlDO0FBQ0EscUZBQXFGLFFBQVE7QUFDN0Y7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxvQkFBb0IsbUJBQW1CO0FBQ3ZDLHdFQUF3RSxVQUFVO0FBQ2xGO0FBQ0E7QUFDQSxtRkFBbUYsb0RBQW9ELDREQUE0RDtBQUNuTTtBQUNBO0FBQ0EsZ0ZBQWdGLG9CQUFvQixtQ0FBbUMsNERBQTREO0FBQ25NO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixRQUFRO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1RUFBdUUsR0FBRyx3REFBd0Qsc0NBQXNDO0FBQ3hLO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsbUJBQW1CO0FBQ25CO0FBQ0EsS0FBSztBQUNMLDRCQUE0QixnQ0FBZ0M7QUFDNUQ7QUFDQSxvQkFBb0IsdUJBQXVCO0FBQzNDO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0ZBQW9GLGVBQWU7QUFDbkc7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLGdDQUFnQztBQUNwRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsOEZBQThGLE1BQU07QUFDcEc7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsZ0NBQWdDO0FBQ3BEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxnR0FBZ0csTUFBTTtBQUN0RztBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxvQkFBb0IsZ0NBQWdDO0FBQ3BEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxnR0FBZ0csTUFBTTtBQUN0RztBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLG9CQUFvQix1QkFBdUI7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLG9CQUFvQixnQ0FBZ0M7QUFDcEQ7QUFDQTtBQUNBO0FBQ0Esc0NBQXNDO0FBQ3RDLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0Esc0ZBQXNGLHFCQUFxQjtBQUMzRztBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLG9CQUFvQiwwQkFBMEI7QUFDOUMscUJBQXFCO0FBQ3JCO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0Esb0JBQW9CLGlCQUFpQjtBQUNyQztBQUNBO0FBQ0E7QUFDQSxrSEFBa0gsTUFBTTtBQUN4SDtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0Esb0JBQW9CLDBCQUEwQjtBQUM5QztBQUNBLGdFQUFnRSxrQ0FBa0M7QUFDbEc7QUFDQSxvRkFBb0Ysc0JBQXNCO0FBQzFHO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxvQkFBb0IsMEJBQTBCO0FBQzlDO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0Esb0JBQW9CLDBCQUEwQjtBQUM5QztBQUNBO0FBQ0Esc0NBQXNDLHFDQUFxQztBQUMzRTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0MscUNBQXFDO0FBQzNFO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBLDBGQUEwRixzQkFBc0I7QUFDaEg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtFQUErRSxNQUFNO0FBQ3JGO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxvQkFBb0IsaUJBQWlCO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLGlCQUFpQjtBQUNyQyxvREFBb0QsbUJBQW1CO0FBQ3ZFO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixpQkFBaUI7QUFDckMsb0RBQW9ELG1CQUFtQjtBQUN2RTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsaUJBQWlCO0FBQ3JDLG9EQUFvRCxtQkFBbUI7QUFDdkU7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLGlCQUFpQjtBQUNyQyxvREFBb0QsbUJBQW1CO0FBQ3ZFO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLG9CQUFvQix1QkFBdUI7QUFDM0M7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxvQkFBb0IsdUJBQXVCO0FBQzNDO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0Esb0JBQW9CLGlCQUFpQjtBQUNyQyxvREFBb0QsbUJBQW1CO0FBQ3ZFO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixpQkFBaUI7QUFDckMsb0RBQW9ELG1CQUFtQjtBQUN2RTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0Esb0JBQW9CLGlCQUFpQjtBQUNyQyxvREFBb0QsbUJBQW1CO0FBQ3ZFO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLG9CQUFvQixnQ0FBZ0M7QUFDcEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLG9CQUFvQiwwQkFBMEI7QUFDOUMsOERBQThELGdCQUFnQixxQ0FBcUM7QUFDbkg7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxvQkFBb0IsMEJBQTBCO0FBQzlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBLG9GQUFvRixzQkFBc0I7QUFDMUc7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLDBCQUEwQjtBQUM5QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxvQkFBb0IsMEJBQTBCO0FBQzlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0Esc0JBQXNCLGFBQWE7QUFDbkMsaUJBQWlCLGFBQWE7QUFDOUI7QUFDQSxpQkFBaUIsYUFBYTtBQUM5QixtQkFBbUIsYUFBYTtBQUNoQyxxQkFBcUIsYUFBYTtBQUNsQyxtQkFBbUIsYUFBYTtBQUNoQyxtQkFBbUIsYUFBYTtBQUNoQywwQkFBMEIsYUFBYTtBQUN2QywyQkFBMkIsYUFBYTtBQUN4QyxxQkFBcUIsYUFBYTtBQUNsQyxtQkFBbUIsYUFBYTtBQUNoQyxlQUFlLGFBQWE7QUFDNUIsbUJBQW1CLGFBQWE7QUFDaEMsb0JBQW9CLGFBQWE7QUFDakMsaUJBQWlCLGFBQWE7QUFDOUIsYUFBYSxhQUFhO0FBQzFCLGNBQWMsYUFBYTtBQUMzQixVQUFVLGFBQWE7QUFDdkIsWUFBWSxhQUFhO0FBQ3pCLGVBQWUsYUFBYTtBQUM1QixXQUFXLGFBQWE7QUFDeEIsaUJBQWlCLGFBQWE7QUFDOUIsV0FBVyxhQUFhO0FBQ3hCLGtCQUFrQixhQUFhO0FBQy9CLFdBQVcsYUFBYTtBQUN4QixzQkFBc0IsYUFBYTtBQUNuQyxhQUFhLGFBQWE7QUFDMUI7QUFDQSx1QkFBdUIsaUJBQWlCO0FBQ3hDLDBCQUEwQixpQkFBaUI7QUFDM0M7QUFDQTtBQUNBLHNCQUFzQjtBQUN0QjtBQUNBLHVCQUF1QjtBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsiRDpcXHNhbG9uaVxcYXBwcmFpc2FsLXN5c3RlbVxcc2VydmVyXFxub2RlX21vZHVsZXNcXG1vbmdvZGJcXGxpYlxcY29ubmVjdGlvbl9zdHJpbmcuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkZFQVRVUkVfRkxBR1MgPSBleHBvcnRzLkRFRkFVTFRfT1BUSU9OUyA9IGV4cG9ydHMuT1BUSU9OUyA9IGV4cG9ydHMucGFyc2VPcHRpb25zID0gZXhwb3J0cy5yZXNvbHZlU1JWUmVjb3JkID0gdm9pZCAwO1xuY29uc3QgZG5zID0gcmVxdWlyZShcImRuc1wiKTtcbmNvbnN0IGZzID0gcmVxdWlyZShcImZzXCIpO1xuY29uc3QgbW9uZ29kYl9jb25uZWN0aW9uX3N0cmluZ191cmxfMSA9IHJlcXVpcmUoXCJtb25nb2RiLWNvbm5lY3Rpb24tc3RyaW5nLXVybFwiKTtcbmNvbnN0IHVybF8xID0gcmVxdWlyZShcInVybFwiKTtcbmNvbnN0IG1vbmdvX2NyZWRlbnRpYWxzXzEgPSByZXF1aXJlKFwiLi9jbWFwL2F1dGgvbW9uZ29fY3JlZGVudGlhbHNcIik7XG5jb25zdCBwcm92aWRlcnNfMSA9IHJlcXVpcmUoXCIuL2NtYXAvYXV0aC9wcm92aWRlcnNcIik7XG5jb25zdCBjbGllbnRfbWV0YWRhdGFfMSA9IHJlcXVpcmUoXCIuL2NtYXAvaGFuZHNoYWtlL2NsaWVudF9tZXRhZGF0YVwiKTtcbmNvbnN0IGNvbXByZXNzaW9uXzEgPSByZXF1aXJlKFwiLi9jbWFwL3dpcmVfcHJvdG9jb2wvY29tcHJlc3Npb25cIik7XG5jb25zdCBlbmNyeXB0ZXJfMSA9IHJlcXVpcmUoXCIuL2VuY3J5cHRlclwiKTtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi9lcnJvclwiKTtcbmNvbnN0IG1vbmdvX2NsaWVudF8xID0gcmVxdWlyZShcIi4vbW9uZ29fY2xpZW50XCIpO1xuY29uc3QgbW9uZ29fbG9nZ2VyXzEgPSByZXF1aXJlKFwiLi9tb25nb19sb2dnZXJcIik7XG5jb25zdCByZWFkX2NvbmNlcm5fMSA9IHJlcXVpcmUoXCIuL3JlYWRfY29uY2VyblwiKTtcbmNvbnN0IHJlYWRfcHJlZmVyZW5jZV8xID0gcmVxdWlyZShcIi4vcmVhZF9wcmVmZXJlbmNlXCIpO1xuY29uc3QgdXRpbHNfMSA9IHJlcXVpcmUoXCIuL3V0aWxzXCIpO1xuY29uc3Qgd3JpdGVfY29uY2Vybl8xID0gcmVxdWlyZShcIi4vd3JpdGVfY29uY2VyblwiKTtcbmNvbnN0IFZBTElEX1RYVF9SRUNPUkRTID0gWydhdXRoU291cmNlJywgJ3JlcGxpY2FTZXQnLCAnbG9hZEJhbGFuY2VkJ107XG5jb25zdCBMQl9TSU5HTEVfSE9TVF9FUlJPUiA9ICdsb2FkQmFsYW5jZWQgb3B0aW9uIG9ubHkgc3VwcG9ydGVkIHdpdGggYSBzaW5nbGUgaG9zdCBpbiB0aGUgVVJJJztcbmNvbnN0IExCX1JFUExJQ0FfU0VUX0VSUk9SID0gJ2xvYWRCYWxhbmNlZCBvcHRpb24gbm90IHN1cHBvcnRlZCB3aXRoIGEgcmVwbGljYVNldCBvcHRpb24nO1xuY29uc3QgTEJfRElSRUNUX0NPTk5FQ1RJT05fRVJST1IgPSAnbG9hZEJhbGFuY2VkIG9wdGlvbiBub3Qgc3VwcG9ydGVkIHdoZW4gZGlyZWN0Q29ubmVjdGlvbiBpcyBwcm92aWRlZCc7XG4vKipcbiAqIExvb2t1cCBhIGBtb25nb2RiK3NydmAgY29ubmVjdGlvbiBzdHJpbmcsIGNvbWJpbmUgdGhlIHBhcnRzIGFuZCByZXBhcnNlIGl0IGFzIGEgbm9ybWFsXG4gKiBjb25uZWN0aW9uIHN0cmluZy5cbiAqXG4gKiBAcGFyYW0gdXJpIC0gVGhlIGNvbm5lY3Rpb24gc3RyaW5nIHRvIHBhcnNlXG4gKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHVzZXIgcHJvdmlkZWQgY29ubmVjdGlvbiBzdHJpbmcgb3B0aW9uc1xuICovXG5hc3luYyBmdW5jdGlvbiByZXNvbHZlU1JWUmVjb3JkKG9wdGlvbnMpIHtcbiAgICBpZiAodHlwZW9mIG9wdGlvbnMuc3J2SG9zdCAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29BUElFcnJvcignT3B0aW9uIFwic3J2SG9zdFwiIG11c3Qgbm90IGJlIGVtcHR5Jyk7XG4gICAgfVxuICAgIGlmIChvcHRpb25zLnNydkhvc3Quc3BsaXQoJy4nKS5sZW5ndGggPCAzKSB7XG4gICAgICAgIC8vIFRPRE8oTk9ERS0zNDg0KTogUmVwbGFjZSB3aXRoIE1vbmdvQ29ubmVjdGlvblN0cmluZ0Vycm9yXG4gICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvQVBJRXJyb3IoJ1VSSSBtdXN0IGluY2x1ZGUgaG9zdG5hbWUsIGRvbWFpbiBuYW1lLCBhbmQgdGxkJyk7XG4gICAgfVxuICAgIC8vIFJlc29sdmUgdGhlIFNSViByZWNvcmQgYW5kIHVzZSB0aGUgcmVzdWx0IGFzIHRoZSBsaXN0IG9mIGhvc3RzIHRvIGNvbm5lY3QgdG8uXG4gICAgY29uc3QgbG9va3VwQWRkcmVzcyA9IG9wdGlvbnMuc3J2SG9zdDtcbiAgICBjb25zdCBhZGRyZXNzZXMgPSBhd2FpdCBkbnMucHJvbWlzZXMucmVzb2x2ZVNydihgXyR7b3B0aW9ucy5zcnZTZXJ2aWNlTmFtZX0uX3RjcC4ke2xvb2t1cEFkZHJlc3N9YCk7XG4gICAgaWYgKGFkZHJlc3Nlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29BUElFcnJvcignTm8gYWRkcmVzc2VzIGZvdW5kIGF0IGhvc3QnKTtcbiAgICB9XG4gICAgZm9yIChjb25zdCB7IG5hbWUgfSBvZiBhZGRyZXNzZXMpIHtcbiAgICAgICAgaWYgKCEoMCwgdXRpbHNfMS5tYXRjaGVzUGFyZW50RG9tYWluKShuYW1lLCBsb29rdXBBZGRyZXNzKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29BUElFcnJvcignU2VydmVyIHJlY29yZCBkb2VzIG5vdCBzaGFyZSBob3N0bmFtZSB3aXRoIHBhcmVudCBVUkknKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjb25zdCBob3N0QWRkcmVzc2VzID0gYWRkcmVzc2VzLm1hcChyID0+IHV0aWxzXzEuSG9zdEFkZHJlc3MuZnJvbVN0cmluZyhgJHtyLm5hbWV9OiR7ci5wb3J0ID8/IDI3MDE3fWApKTtcbiAgICB2YWxpZGF0ZUxvYWRCYWxhbmNlZE9wdGlvbnMoaG9zdEFkZHJlc3Nlcywgb3B0aW9ucywgdHJ1ZSk7XG4gICAgLy8gUmVzb2x2ZSBUWFQgcmVjb3JkIGFuZCBhZGQgb3B0aW9ucyBmcm9tIHRoZXJlIGlmIHRoZXkgZXhpc3QuXG4gICAgbGV0IHJlY29yZDtcbiAgICB0cnkge1xuICAgICAgICByZWNvcmQgPSBhd2FpdCBkbnMucHJvbWlzZXMucmVzb2x2ZVR4dChsb29rdXBBZGRyZXNzKTtcbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGlmIChlcnJvci5jb2RlICE9PSAnRU5PREFUQScgJiYgZXJyb3IuY29kZSAhPT0gJ0VOT1RGT1VORCcpIHtcbiAgICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBob3N0QWRkcmVzc2VzO1xuICAgIH1cbiAgICBpZiAocmVjb3JkLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29QYXJzZUVycm9yKCdNdWx0aXBsZSB0ZXh0IHJlY29yZHMgbm90IGFsbG93ZWQnKTtcbiAgICB9XG4gICAgY29uc3QgdHh0UmVjb3JkT3B0aW9ucyA9IG5ldyB1cmxfMS5VUkxTZWFyY2hQYXJhbXMocmVjb3JkWzBdLmpvaW4oJycpKTtcbiAgICBjb25zdCB0eHRSZWNvcmRPcHRpb25LZXlzID0gWy4uLnR4dFJlY29yZE9wdGlvbnMua2V5cygpXTtcbiAgICBpZiAodHh0UmVjb3JkT3B0aW9uS2V5cy5zb21lKGtleSA9PiAhVkFMSURfVFhUX1JFQ09SRFMuaW5jbHVkZXMoa2V5KSkpIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29QYXJzZUVycm9yKGBUZXh0IHJlY29yZCBtYXkgb25seSBzZXQgYW55IG9mOiAke1ZBTElEX1RYVF9SRUNPUkRTLmpvaW4oJywgJyl9YCk7XG4gICAgfVxuICAgIGlmIChWQUxJRF9UWFRfUkVDT1JEUy5zb21lKG9wdGlvbiA9PiB0eHRSZWNvcmRPcHRpb25zLmdldChvcHRpb24pID09PSAnJykpIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29QYXJzZUVycm9yKCdDYW5ub3QgaGF2ZSBlbXB0eSBVUkkgcGFyYW1zIGluIEROUyBUWFQgUmVjb3JkJyk7XG4gICAgfVxuICAgIGNvbnN0IHNvdXJjZSA9IHR4dFJlY29yZE9wdGlvbnMuZ2V0KCdhdXRoU291cmNlJykgPz8gdW5kZWZpbmVkO1xuICAgIGNvbnN0IHJlcGxpY2FTZXQgPSB0eHRSZWNvcmRPcHRpb25zLmdldCgncmVwbGljYVNldCcpID8/IHVuZGVmaW5lZDtcbiAgICBjb25zdCBsb2FkQmFsYW5jZWQgPSB0eHRSZWNvcmRPcHRpb25zLmdldCgnbG9hZEJhbGFuY2VkJykgPz8gdW5kZWZpbmVkO1xuICAgIGlmICghb3B0aW9ucy51c2VyU3BlY2lmaWVkQXV0aFNvdXJjZSAmJlxuICAgICAgICBzb3VyY2UgJiZcbiAgICAgICAgb3B0aW9ucy5jcmVkZW50aWFscyAmJlxuICAgICAgICAhcHJvdmlkZXJzXzEuQVVUSF9NRUNIU19BVVRIX1NSQ19FWFRFUk5BTC5oYXMob3B0aW9ucy5jcmVkZW50aWFscy5tZWNoYW5pc20pKSB7XG4gICAgICAgIG9wdGlvbnMuY3JlZGVudGlhbHMgPSBtb25nb19jcmVkZW50aWFsc18xLk1vbmdvQ3JlZGVudGlhbHMubWVyZ2Uob3B0aW9ucy5jcmVkZW50aWFscywgeyBzb3VyY2UgfSk7XG4gICAgfVxuICAgIGlmICghb3B0aW9ucy51c2VyU3BlY2lmaWVkUmVwbGljYVNldCAmJiByZXBsaWNhU2V0KSB7XG4gICAgICAgIG9wdGlvbnMucmVwbGljYVNldCA9IHJlcGxpY2FTZXQ7XG4gICAgfVxuICAgIGlmIChsb2FkQmFsYW5jZWQgPT09ICd0cnVlJykge1xuICAgICAgICBvcHRpb25zLmxvYWRCYWxhbmNlZCA9IHRydWU7XG4gICAgfVxuICAgIGlmIChvcHRpb25zLnJlcGxpY2FTZXQgJiYgb3B0aW9ucy5zcnZNYXhIb3N0cyA+IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29QYXJzZUVycm9yKCdDYW5ub3QgY29tYmluZSByZXBsaWNhU2V0IG9wdGlvbiB3aXRoIHNydk1heEhvc3RzJyk7XG4gICAgfVxuICAgIHZhbGlkYXRlTG9hZEJhbGFuY2VkT3B0aW9ucyhob3N0QWRkcmVzc2VzLCBvcHRpb25zLCB0cnVlKTtcbiAgICByZXR1cm4gaG9zdEFkZHJlc3Nlcztcbn1cbmV4cG9ydHMucmVzb2x2ZVNSVlJlY29yZCA9IHJlc29sdmVTUlZSZWNvcmQ7XG4vKipcbiAqIENoZWNrcyBpZiBUTFMgb3B0aW9ucyBhcmUgdmFsaWRcbiAqXG4gKiBAcGFyYW0gYWxsT3B0aW9ucyAtIEFsbCBvcHRpb25zIHByb3ZpZGVkIGJ5IHVzZXIgb3IgaW5jbHVkZWQgaW4gZGVmYXVsdCBvcHRpb25zIG1hcFxuICogQHRocm93cyBNb25nb0FQSUVycm9yIGlmIFRMUyBvcHRpb25zIGFyZSBpbnZhbGlkXG4gKi9cbmZ1bmN0aW9uIGNoZWNrVExTT3B0aW9ucyhhbGxPcHRpb25zKSB7XG4gICAgaWYgKCFhbGxPcHRpb25zKVxuICAgICAgICByZXR1cm47XG4gICAgY29uc3QgY2hlY2sgPSAoYSwgYikgPT4ge1xuICAgICAgICBpZiAoYWxsT3B0aW9ucy5oYXMoYSkgJiYgYWxsT3B0aW9ucy5oYXMoYikpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvQVBJRXJyb3IoYFRoZSAnJHthfScgb3B0aW9uIGNhbm5vdCBiZSB1c2VkIHdpdGggdGhlICcke2J9JyBvcHRpb25gKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgY2hlY2soJ3Rsc0luc2VjdXJlJywgJ3Rsc0FsbG93SW52YWxpZENlcnRpZmljYXRlcycpO1xuICAgIGNoZWNrKCd0bHNJbnNlY3VyZScsICd0bHNBbGxvd0ludmFsaWRIb3N0bmFtZXMnKTtcbiAgICBjaGVjaygndGxzSW5zZWN1cmUnLCAndGxzRGlzYWJsZUNlcnRpZmljYXRlUmV2b2NhdGlvbkNoZWNrJyk7XG4gICAgY2hlY2soJ3Rsc0luc2VjdXJlJywgJ3Rsc0Rpc2FibGVPQ1NQRW5kcG9pbnRDaGVjaycpO1xuICAgIGNoZWNrKCd0bHNBbGxvd0ludmFsaWRDZXJ0aWZpY2F0ZXMnLCAndGxzRGlzYWJsZUNlcnRpZmljYXRlUmV2b2NhdGlvbkNoZWNrJyk7XG4gICAgY2hlY2soJ3Rsc0FsbG93SW52YWxpZENlcnRpZmljYXRlcycsICd0bHNEaXNhYmxlT0NTUEVuZHBvaW50Q2hlY2snKTtcbiAgICBjaGVjaygndGxzRGlzYWJsZUNlcnRpZmljYXRlUmV2b2NhdGlvbkNoZWNrJywgJ3Rsc0Rpc2FibGVPQ1NQRW5kcG9pbnRDaGVjaycpO1xufVxuY29uc3QgVFJVVEhTID0gbmV3IFNldChbJ3RydWUnLCAndCcsICcxJywgJ3knLCAneWVzJ10pO1xuY29uc3QgRkFMU0VIT09EUyA9IG5ldyBTZXQoWydmYWxzZScsICdmJywgJzAnLCAnbicsICdubycsICctMSddKTtcbmZ1bmN0aW9uIGdldEJvb2xlYW4obmFtZSwgdmFsdWUpIHtcbiAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpXG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICBjb25zdCB2YWx1ZVN0cmluZyA9IFN0cmluZyh2YWx1ZSkudG9Mb3dlckNhc2UoKTtcbiAgICBpZiAoVFJVVEhTLmhhcyh2YWx1ZVN0cmluZykpIHtcbiAgICAgICAgaWYgKHZhbHVlU3RyaW5nICE9PSAndHJ1ZScpIHtcbiAgICAgICAgICAgICgwLCB1dGlsc18xLmVtaXRXYXJuaW5nT25jZSkoYGRlcHJlY2F0ZWQgdmFsdWUgZm9yICR7bmFtZX0gOiAke3ZhbHVlU3RyaW5nfSAtIHBsZWFzZSB1cGRhdGUgdG8gJHtuYW1lfSA6IHRydWUgaW5zdGVhZGApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBpZiAoRkFMU0VIT09EUy5oYXModmFsdWVTdHJpbmcpKSB7XG4gICAgICAgIGlmICh2YWx1ZVN0cmluZyAhPT0gJ2ZhbHNlJykge1xuICAgICAgICAgICAgKDAsIHV0aWxzXzEuZW1pdFdhcm5pbmdPbmNlKShgZGVwcmVjYXRlZCB2YWx1ZSBmb3IgJHtuYW1lfSA6ICR7dmFsdWVTdHJpbmd9IC0gcGxlYXNlIHVwZGF0ZSB0byAke25hbWV9IDogZmFsc2UgaW5zdGVhZGApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29QYXJzZUVycm9yKGBFeHBlY3RlZCAke25hbWV9IHRvIGJlIHN0cmluZ2lmaWVkIGJvb2xlYW4gdmFsdWUsIGdvdDogJHt2YWx1ZX1gKTtcbn1cbmZ1bmN0aW9uIGdldEludEZyb21PcHRpb25zKG5hbWUsIHZhbHVlKSB7XG4gICAgY29uc3QgcGFyc2VkSW50ID0gKDAsIHV0aWxzXzEucGFyc2VJbnRlZ2VyKSh2YWx1ZSk7XG4gICAgaWYgKHBhcnNlZEludCAhPSBudWxsKSB7XG4gICAgICAgIHJldHVybiBwYXJzZWRJbnQ7XG4gICAgfVxuICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUGFyc2VFcnJvcihgRXhwZWN0ZWQgJHtuYW1lfSB0byBiZSBzdHJpbmdpZmllZCBpbnQgdmFsdWUsIGdvdDogJHt2YWx1ZX1gKTtcbn1cbmZ1bmN0aW9uIGdldFVJbnRGcm9tT3B0aW9ucyhuYW1lLCB2YWx1ZSkge1xuICAgIGNvbnN0IHBhcnNlZFZhbHVlID0gZ2V0SW50RnJvbU9wdGlvbnMobmFtZSwgdmFsdWUpO1xuICAgIGlmIChwYXJzZWRWYWx1ZSA8IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29QYXJzZUVycm9yKGAke25hbWV9IGNhbiBvbmx5IGJlIGEgcG9zaXRpdmUgaW50IHZhbHVlLCBnb3Q6ICR7dmFsdWV9YCk7XG4gICAgfVxuICAgIHJldHVybiBwYXJzZWRWYWx1ZTtcbn1cbmZ1bmN0aW9uKiBlbnRyaWVzRnJvbVN0cmluZyh2YWx1ZSkge1xuICAgIGNvbnN0IGtleVZhbHVlUGFpcnMgPSB2YWx1ZS5zcGxpdCgnLCcpO1xuICAgIGZvciAoY29uc3Qga2V5VmFsdWUgb2Yga2V5VmFsdWVQYWlycykge1xuICAgICAgICBjb25zdCBba2V5LCB2YWx1ZV0gPSBrZXlWYWx1ZS5zcGxpdCgvOiguKikvKTtcbiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUGFyc2VFcnJvcignQ2Fubm90IGhhdmUgdW5kZWZpbmVkIHZhbHVlcyBpbiBrZXkgdmFsdWUgcGFpcnMnKTtcbiAgICAgICAgfVxuICAgICAgICB5aWVsZCBba2V5LCB2YWx1ZV07XG4gICAgfVxufVxuY2xhc3MgQ2FzZUluc2Vuc2l0aXZlTWFwIGV4dGVuZHMgTWFwIHtcbiAgICBjb25zdHJ1Y3RvcihlbnRyaWVzID0gW10pIHtcbiAgICAgICAgc3VwZXIoZW50cmllcy5tYXAoKFtrLCB2XSkgPT4gW2sudG9Mb3dlckNhc2UoKSwgdl0pKTtcbiAgICB9XG4gICAgaGFzKGspIHtcbiAgICAgICAgcmV0dXJuIHN1cGVyLmhhcyhrLnRvTG93ZXJDYXNlKCkpO1xuICAgIH1cbiAgICBnZXQoaykge1xuICAgICAgICByZXR1cm4gc3VwZXIuZ2V0KGsudG9Mb3dlckNhc2UoKSk7XG4gICAgfVxuICAgIHNldChrLCB2KSB7XG4gICAgICAgIHJldHVybiBzdXBlci5zZXQoay50b0xvd2VyQ2FzZSgpLCB2KTtcbiAgICB9XG4gICAgZGVsZXRlKGspIHtcbiAgICAgICAgcmV0dXJuIHN1cGVyLmRlbGV0ZShrLnRvTG93ZXJDYXNlKCkpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIHBhcnNlT3B0aW9ucyh1cmksIG1vbmdvQ2xpZW50ID0gdW5kZWZpbmVkLCBvcHRpb25zID0ge30pIHtcbiAgICBpZiAobW9uZ29DbGllbnQgIT0gbnVsbCAmJiAhKG1vbmdvQ2xpZW50IGluc3RhbmNlb2YgbW9uZ29fY2xpZW50XzEuTW9uZ29DbGllbnQpKSB7XG4gICAgICAgIG9wdGlvbnMgPSBtb25nb0NsaWVudDtcbiAgICAgICAgbW9uZ29DbGllbnQgPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIC8vIHZhbGlkYXRlIEJTT05PcHRpb25zXG4gICAgaWYgKG9wdGlvbnMudXNlQmlnSW50NjQgJiYgdHlwZW9mIG9wdGlvbnMucHJvbW90ZUxvbmdzID09PSAnYm9vbGVhbicgJiYgIW9wdGlvbnMucHJvbW90ZUxvbmdzKSB7XG4gICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvQVBJRXJyb3IoJ011c3QgcmVxdWVzdCBlaXRoZXIgYmlnaW50IG9yIExvbmcgZm9yIGludDY0IGRlc2VyaWFsaXphdGlvbicpO1xuICAgIH1cbiAgICBpZiAob3B0aW9ucy51c2VCaWdJbnQ2NCAmJiB0eXBlb2Ygb3B0aW9ucy5wcm9tb3RlVmFsdWVzID09PSAnYm9vbGVhbicgJiYgIW9wdGlvbnMucHJvbW90ZVZhbHVlcykge1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0FQSUVycm9yKCdNdXN0IHJlcXVlc3QgZWl0aGVyIGJpZ2ludCBvciBMb25nIGZvciBpbnQ2NCBkZXNlcmlhbGl6YXRpb24nKTtcbiAgICB9XG4gICAgY29uc3QgdXJsID0gbmV3IG1vbmdvZGJfY29ubmVjdGlvbl9zdHJpbmdfdXJsXzEuZGVmYXVsdCh1cmkpO1xuICAgIGNvbnN0IHsgaG9zdHMsIGlzU1JWIH0gPSB1cmw7XG4gICAgY29uc3QgbW9uZ29PcHRpb25zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgICAvLyBGZWF0dXJlIGZsYWdzXG4gICAgZm9yIChjb25zdCBmbGFnIG9mIE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMob3B0aW9ucykpIHtcbiAgICAgICAgaWYgKGV4cG9ydHMuRkVBVFVSRV9GTEFHUy5oYXMoZmxhZykpIHtcbiAgICAgICAgICAgIG1vbmdvT3B0aW9uc1tmbGFnXSA9IG9wdGlvbnNbZmxhZ107XG4gICAgICAgIH1cbiAgICB9XG4gICAgbW9uZ29PcHRpb25zLmhvc3RzID0gaXNTUlYgPyBbXSA6IGhvc3RzLm1hcCh1dGlsc18xLkhvc3RBZGRyZXNzLmZyb21TdHJpbmcpO1xuICAgIGNvbnN0IHVybE9wdGlvbnMgPSBuZXcgQ2FzZUluc2Vuc2l0aXZlTWFwKCk7XG4gICAgaWYgKHVybC5wYXRobmFtZSAhPT0gJy8nICYmIHVybC5wYXRobmFtZSAhPT0gJycpIHtcbiAgICAgICAgY29uc3QgZGJOYW1lID0gZGVjb2RlVVJJQ29tcG9uZW50KHVybC5wYXRobmFtZVswXSA9PT0gJy8nID8gdXJsLnBhdGhuYW1lLnNsaWNlKDEpIDogdXJsLnBhdGhuYW1lKTtcbiAgICAgICAgaWYgKGRiTmFtZSkge1xuICAgICAgICAgICAgdXJsT3B0aW9ucy5zZXQoJ2RiTmFtZScsIFtkYk5hbWVdKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAodXJsLnVzZXJuYW1lICE9PSAnJykge1xuICAgICAgICBjb25zdCBhdXRoID0ge1xuICAgICAgICAgICAgdXNlcm5hbWU6IGRlY29kZVVSSUNvbXBvbmVudCh1cmwudXNlcm5hbWUpXG4gICAgICAgIH07XG4gICAgICAgIGlmICh0eXBlb2YgdXJsLnBhc3N3b3JkID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgYXV0aC5wYXNzd29yZCA9IGRlY29kZVVSSUNvbXBvbmVudCh1cmwucGFzc3dvcmQpO1xuICAgICAgICB9XG4gICAgICAgIHVybE9wdGlvbnMuc2V0KCdhdXRoJywgW2F1dGhdKTtcbiAgICB9XG4gICAgZm9yIChjb25zdCBrZXkgb2YgdXJsLnNlYXJjaFBhcmFtcy5rZXlzKCkpIHtcbiAgICAgICAgY29uc3QgdmFsdWVzID0gWy4uLnVybC5zZWFyY2hQYXJhbXMuZ2V0QWxsKGtleSldO1xuICAgICAgICBpZiAodmFsdWVzLmluY2x1ZGVzKCcnKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29BUElFcnJvcignVVJJIGNhbm5vdCBjb250YWluIG9wdGlvbnMgd2l0aCBubyB2YWx1ZScpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghdXJsT3B0aW9ucy5oYXMoa2V5KSkge1xuICAgICAgICAgICAgdXJsT3B0aW9ucy5zZXQoa2V5LCB2YWx1ZXMpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbnN0IG9iamVjdE9wdGlvbnMgPSBuZXcgQ2FzZUluc2Vuc2l0aXZlTWFwKE9iamVjdC5lbnRyaWVzKG9wdGlvbnMpLmZpbHRlcigoWywgdl0pID0+IHYgIT0gbnVsbCkpO1xuICAgIC8vIFZhbGlkYXRlIG9wdGlvbnMgdGhhdCBjYW4gb25seSBiZSBwcm92aWRlZCBieSBvbmUgb2YgdXJpIG9yIG9iamVjdFxuICAgIGlmICh1cmxPcHRpb25zLmhhcygnc2VydmVyQXBpJykpIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29QYXJzZUVycm9yKCdVUkkgY2Fubm90IGNvbnRhaW4gYHNlcnZlckFwaWAsIGl0IGNhbiBvbmx5IGJlIHBhc3NlZCB0byB0aGUgY2xpZW50Jyk7XG4gICAgfVxuICAgIGNvbnN0IHVyaU1lY2hhbmlzbVByb3BlcnRpZXMgPSB1cmxPcHRpb25zLmdldCgnYXV0aE1lY2hhbmlzbVByb3BlcnRpZXMnKTtcbiAgICBpZiAodXJpTWVjaGFuaXNtUHJvcGVydGllcykge1xuICAgICAgICBmb3IgKGNvbnN0IHByb3BlcnR5IG9mIHVyaU1lY2hhbmlzbVByb3BlcnRpZXMpIHtcbiAgICAgICAgICAgIGlmICgvKF58LClBTExPV0VEX0hPU1RTOi8udGVzdChwcm9wZXJ0eSkpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1BhcnNlRXJyb3IoJ0F1dGggbWVjaGFuaXNtIHByb3BlcnR5IEFMTE9XRURfSE9TVFMgaXMgbm90IGFsbG93ZWQgaW4gdGhlIGNvbm5lY3Rpb24gc3RyaW5nLicpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGlmIChvYmplY3RPcHRpb25zLmhhcygnbG9hZEJhbGFuY2VkJykpIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29QYXJzZUVycm9yKCdsb2FkQmFsYW5jZWQgaXMgb25seSBhIHZhbGlkIG9wdGlvbiBpbiB0aGUgVVJJJyk7XG4gICAgfVxuICAgIC8vIEFsbCBvcHRpb24gY29sbGVjdGlvblxuICAgIGNvbnN0IGFsbFByb3ZpZGVkT3B0aW9ucyA9IG5ldyBDYXNlSW5zZW5zaXRpdmVNYXAoKTtcbiAgICBjb25zdCBhbGxQcm92aWRlZEtleXMgPSBuZXcgU2V0KFsuLi51cmxPcHRpb25zLmtleXMoKSwgLi4ub2JqZWN0T3B0aW9ucy5rZXlzKCldKTtcbiAgICBmb3IgKGNvbnN0IGtleSBvZiBhbGxQcm92aWRlZEtleXMpIHtcbiAgICAgICAgY29uc3QgdmFsdWVzID0gW107XG4gICAgICAgIGNvbnN0IG9iamVjdE9wdGlvblZhbHVlID0gb2JqZWN0T3B0aW9ucy5nZXQoa2V5KTtcbiAgICAgICAgaWYgKG9iamVjdE9wdGlvblZhbHVlICE9IG51bGwpIHtcbiAgICAgICAgICAgIHZhbHVlcy5wdXNoKG9iamVjdE9wdGlvblZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB1cmxWYWx1ZXMgPSB1cmxPcHRpb25zLmdldChrZXkpID8/IFtdO1xuICAgICAgICB2YWx1ZXMucHVzaCguLi51cmxWYWx1ZXMpO1xuICAgICAgICBhbGxQcm92aWRlZE9wdGlvbnMuc2V0KGtleSwgdmFsdWVzKTtcbiAgICB9XG4gICAgY29uc3QgZGlkTWFwVExTQ2VydGlmaWNhdGVGaWxlID0gYWxsUHJvdmlkZWRPcHRpb25zLmhhcygndGxzQ2VydGlmaWNhdGVLZXlGaWxlJykgJiZcbiAgICAgICAgIWFsbFByb3ZpZGVkT3B0aW9ucy5oYXMoJ3Rsc0NlcnRpZmljYXRlRmlsZScpO1xuICAgIGlmIChkaWRNYXBUTFNDZXJ0aWZpY2F0ZUZpbGUpIHtcbiAgICAgICAgYWxsUHJvdmlkZWRPcHRpb25zLnNldCgndGxzQ2VydGlmaWNhdGVGaWxlJywgYWxsUHJvdmlkZWRPcHRpb25zLmdldCgndGxzQ2VydGlmaWNhdGVLZXlGaWxlJykpO1xuICAgIH1cbiAgICBpZiAoYWxsUHJvdmlkZWRPcHRpb25zLmhhcygndGxzJykgfHwgYWxsUHJvdmlkZWRPcHRpb25zLmhhcygnc3NsJykpIHtcbiAgICAgICAgY29uc3QgdGxzQW5kU3NsT3B0cyA9IChhbGxQcm92aWRlZE9wdGlvbnMuZ2V0KCd0bHMnKSB8fCBbXSlcbiAgICAgICAgICAgIC5jb25jYXQoYWxsUHJvdmlkZWRPcHRpb25zLmdldCgnc3NsJykgfHwgW10pXG4gICAgICAgICAgICAubWFwKGdldEJvb2xlYW4uYmluZChudWxsLCAndGxzL3NzbCcpKTtcbiAgICAgICAgaWYgKG5ldyBTZXQodGxzQW5kU3NsT3B0cykuc2l6ZSAhPT0gMSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29QYXJzZUVycm9yKCdBbGwgdmFsdWVzIG9mIHRscy9zc2wgbXVzdCBiZSB0aGUgc2FtZS4nKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjaGVja1RMU09wdGlvbnMoYWxsUHJvdmlkZWRPcHRpb25zKTtcbiAgICBjb25zdCB1bnN1cHBvcnRlZE9wdGlvbnMgPSAoMCwgdXRpbHNfMS5zZXREaWZmZXJlbmNlKShhbGxQcm92aWRlZEtleXMsIEFycmF5LmZyb20oT2JqZWN0LmtleXMoZXhwb3J0cy5PUFRJT05TKSkubWFwKHMgPT4gcy50b0xvd2VyQ2FzZSgpKSk7XG4gICAgaWYgKHVuc3VwcG9ydGVkT3B0aW9ucy5zaXplICE9PSAwKSB7XG4gICAgICAgIGNvbnN0IG9wdGlvbldvcmQgPSB1bnN1cHBvcnRlZE9wdGlvbnMuc2l6ZSA+IDEgPyAnb3B0aW9ucycgOiAnb3B0aW9uJztcbiAgICAgICAgY29uc3QgaXNPckFyZSA9IHVuc3VwcG9ydGVkT3B0aW9ucy5zaXplID4gMSA/ICdhcmUnIDogJ2lzJztcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29QYXJzZUVycm9yKGAke29wdGlvbldvcmR9ICR7QXJyYXkuZnJvbSh1bnN1cHBvcnRlZE9wdGlvbnMpLmpvaW4oJywgJyl9ICR7aXNPckFyZX0gbm90IHN1cHBvcnRlZGApO1xuICAgIH1cbiAgICAvLyBPcHRpb24gcGFyc2luZyBhbmQgc2V0dGluZ1xuICAgIGZvciAoY29uc3QgW2tleSwgZGVzY3JpcHRvcl0gb2YgT2JqZWN0LmVudHJpZXMoZXhwb3J0cy5PUFRJT05TKSkge1xuICAgICAgICBjb25zdCB2YWx1ZXMgPSBhbGxQcm92aWRlZE9wdGlvbnMuZ2V0KGtleSk7XG4gICAgICAgIGlmICghdmFsdWVzIHx8IHZhbHVlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIGlmIChleHBvcnRzLkRFRkFVTFRfT1BUSU9OUy5oYXMoa2V5KSkge1xuICAgICAgICAgICAgICAgIHNldE9wdGlvbihtb25nb09wdGlvbnMsIGtleSwgZGVzY3JpcHRvciwgW2V4cG9ydHMuREVGQVVMVF9PUFRJT05TLmdldChrZXkpXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCB7IGRlcHJlY2F0ZWQgfSA9IGRlc2NyaXB0b3I7XG4gICAgICAgICAgICBjb25zdCBzaG91bGRFbWl0VExTQ2VydGlmaWNhdGVGaWxlRGVwcmVjYXRpb24gPSBkaWRNYXBUTFNDZXJ0aWZpY2F0ZUZpbGUgJiYga2V5ID09PSAndGxzQ2VydGlmaWNhdGVGaWxlJztcbiAgICAgICAgICAgIGlmIChkZXByZWNhdGVkICYmICFzaG91bGRFbWl0VExTQ2VydGlmaWNhdGVGaWxlRGVwcmVjYXRpb24pIHtcbiAgICAgICAgICAgICAgICBjb25zdCBkZXByZWNhdGVkTXNnID0gdHlwZW9mIGRlcHJlY2F0ZWQgPT09ICdzdHJpbmcnID8gYDogJHtkZXByZWNhdGVkfWAgOiAnJztcbiAgICAgICAgICAgICAgICAoMCwgdXRpbHNfMS5lbWl0V2FybmluZykoYCR7a2V5fSBpcyBhIGRlcHJlY2F0ZWQgb3B0aW9uJHtkZXByZWNhdGVkTXNnfWApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc2V0T3B0aW9uKG1vbmdvT3B0aW9ucywga2V5LCBkZXNjcmlwdG9yLCB2YWx1ZXMpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmIChtb25nb09wdGlvbnMuY3JlZGVudGlhbHMpIHtcbiAgICAgICAgY29uc3QgaXNHc3NhcGkgPSBtb25nb09wdGlvbnMuY3JlZGVudGlhbHMubWVjaGFuaXNtID09PSBwcm92aWRlcnNfMS5BdXRoTWVjaGFuaXNtLk1PTkdPREJfR1NTQVBJO1xuICAgICAgICBjb25zdCBpc1g1MDkgPSBtb25nb09wdGlvbnMuY3JlZGVudGlhbHMubWVjaGFuaXNtID09PSBwcm92aWRlcnNfMS5BdXRoTWVjaGFuaXNtLk1PTkdPREJfWDUwOTtcbiAgICAgICAgY29uc3QgaXNBd3MgPSBtb25nb09wdGlvbnMuY3JlZGVudGlhbHMubWVjaGFuaXNtID09PSBwcm92aWRlcnNfMS5BdXRoTWVjaGFuaXNtLk1PTkdPREJfQVdTO1xuICAgICAgICBjb25zdCBpc09pZGMgPSBtb25nb09wdGlvbnMuY3JlZGVudGlhbHMubWVjaGFuaXNtID09PSBwcm92aWRlcnNfMS5BdXRoTWVjaGFuaXNtLk1PTkdPREJfT0lEQztcbiAgICAgICAgaWYgKChpc0dzc2FwaSB8fCBpc1g1MDkpICYmXG4gICAgICAgICAgICBhbGxQcm92aWRlZE9wdGlvbnMuaGFzKCdhdXRoU291cmNlJykgJiZcbiAgICAgICAgICAgIG1vbmdvT3B0aW9ucy5jcmVkZW50aWFscy5zb3VyY2UgIT09ICckZXh0ZXJuYWwnKSB7XG4gICAgICAgICAgICAvLyBJZiBhdXRoU291cmNlIHdhcyBleHBsaWNpdGx5IGdpdmVuIGFuZCBpdHMgaW5jb3JyZWN0LCB3ZSBlcnJvclxuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29QYXJzZUVycm9yKGBhdXRoTWVjaGFuaXNtICR7bW9uZ29PcHRpb25zLmNyZWRlbnRpYWxzLm1lY2hhbmlzbX0gcmVxdWlyZXMgYW4gYXV0aFNvdXJjZSBvZiAnJGV4dGVybmFsJ2ApO1xuICAgICAgICB9XG4gICAgICAgIGlmICghKGlzR3NzYXBpIHx8IGlzWDUwOSB8fCBpc0F3cyB8fCBpc09pZGMpICYmXG4gICAgICAgICAgICBtb25nb09wdGlvbnMuZGJOYW1lICYmXG4gICAgICAgICAgICAhYWxsUHJvdmlkZWRPcHRpb25zLmhhcygnYXV0aFNvdXJjZScpKSB7XG4gICAgICAgICAgICAvLyBpbmhlcml0IHRoZSBkYk5hbWUgdW5sZXNzIEdTU0FQSSBvciBYNTA5LCB0aGVuIHNpbGVudGx5IGlnbm9yZSBkYk5hbWVcbiAgICAgICAgICAgIC8vIGFuZCB0aGVyZSB3YXMgbm8gc3BlY2lmaWMgYXV0aFNvdXJjZSBnaXZlblxuICAgICAgICAgICAgbW9uZ29PcHRpb25zLmNyZWRlbnRpYWxzID0gbW9uZ29fY3JlZGVudGlhbHNfMS5Nb25nb0NyZWRlbnRpYWxzLm1lcmdlKG1vbmdvT3B0aW9ucy5jcmVkZW50aWFscywge1xuICAgICAgICAgICAgICAgIHNvdXJjZTogbW9uZ29PcHRpb25zLmRiTmFtZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGlzQXdzICYmIG1vbmdvT3B0aW9ucy5jcmVkZW50aWFscy51c2VybmFtZSAmJiAhbW9uZ29PcHRpb25zLmNyZWRlbnRpYWxzLnBhc3N3b3JkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb01pc3NpbmdDcmVkZW50aWFsc0Vycm9yKGBXaGVuIHVzaW5nICR7bW9uZ29PcHRpb25zLmNyZWRlbnRpYWxzLm1lY2hhbmlzbX0gcGFzc3dvcmQgbXVzdCBiZSBzZXQgd2hlbiBhIHVzZXJuYW1lIGlzIHNwZWNpZmllZGApO1xuICAgICAgICB9XG4gICAgICAgIG1vbmdvT3B0aW9ucy5jcmVkZW50aWFscy52YWxpZGF0ZSgpO1xuICAgICAgICAvLyBDaGVjayBpZiB0aGUgb25seSBhdXRoIHJlbGF0ZWQgb3B0aW9uIHByb3ZpZGVkIHdhcyBhdXRoU291cmNlLCBpZiBzbyB3ZSBjYW4gcmVtb3ZlIGNyZWRlbnRpYWxzXG4gICAgICAgIGlmIChtb25nb09wdGlvbnMuY3JlZGVudGlhbHMucGFzc3dvcmQgPT09ICcnICYmXG4gICAgICAgICAgICBtb25nb09wdGlvbnMuY3JlZGVudGlhbHMudXNlcm5hbWUgPT09ICcnICYmXG4gICAgICAgICAgICBtb25nb09wdGlvbnMuY3JlZGVudGlhbHMubWVjaGFuaXNtID09PSBwcm92aWRlcnNfMS5BdXRoTWVjaGFuaXNtLk1PTkdPREJfREVGQVVMVCAmJlxuICAgICAgICAgICAgT2JqZWN0LmtleXMobW9uZ29PcHRpb25zLmNyZWRlbnRpYWxzLm1lY2hhbmlzbVByb3BlcnRpZXMpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgZGVsZXRlIG1vbmdvT3B0aW9ucy5jcmVkZW50aWFscztcbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAoIW1vbmdvT3B0aW9ucy5kYk5hbWUpIHtcbiAgICAgICAgLy8gZGJOYW1lIGRlZmF1bHQgaXMgYXBwbGllZCBoZXJlIGJlY2F1c2Ugb2YgdGhlIGNyZWRlbnRpYWwgdmFsaWRhdGlvbiBhYm92ZVxuICAgICAgICBtb25nb09wdGlvbnMuZGJOYW1lID0gJ3Rlc3QnO1xuICAgIH1cbiAgICB2YWxpZGF0ZUxvYWRCYWxhbmNlZE9wdGlvbnMoaG9zdHMsIG1vbmdvT3B0aW9ucywgaXNTUlYpO1xuICAgIGlmIChtb25nb0NsaWVudCAmJiBtb25nb09wdGlvbnMuYXV0b0VuY3J5cHRpb24pIHtcbiAgICAgICAgZW5jcnlwdGVyXzEuRW5jcnlwdGVyLmNoZWNrRm9yTW9uZ29DcnlwdCgpO1xuICAgICAgICBtb25nb09wdGlvbnMuZW5jcnlwdGVyID0gbmV3IGVuY3J5cHRlcl8xLkVuY3J5cHRlcihtb25nb0NsaWVudCwgdXJpLCBvcHRpb25zKTtcbiAgICAgICAgbW9uZ29PcHRpb25zLmF1dG9FbmNyeXB0ZXIgPSBtb25nb09wdGlvbnMuZW5jcnlwdGVyLmF1dG9FbmNyeXB0ZXI7XG4gICAgfVxuICAgIC8vIFBvdGVudGlhbCBTUlYgT3ZlcnJpZGVzIGFuZCBTUlYgY29ubmVjdGlvbiBzdHJpbmcgdmFsaWRhdGlvbnNcbiAgICBtb25nb09wdGlvbnMudXNlclNwZWNpZmllZEF1dGhTb3VyY2UgPVxuICAgICAgICBvYmplY3RPcHRpb25zLmhhcygnYXV0aFNvdXJjZScpIHx8IHVybE9wdGlvbnMuaGFzKCdhdXRoU291cmNlJyk7XG4gICAgbW9uZ29PcHRpb25zLnVzZXJTcGVjaWZpZWRSZXBsaWNhU2V0ID1cbiAgICAgICAgb2JqZWN0T3B0aW9ucy5oYXMoJ3JlcGxpY2FTZXQnKSB8fCB1cmxPcHRpb25zLmhhcygncmVwbGljYVNldCcpO1xuICAgIGlmIChpc1NSVikge1xuICAgICAgICAvLyBTUlYgUmVjb3JkIGlzIHJlc29sdmVkIHVwb24gY29ubmVjdGluZ1xuICAgICAgICBtb25nb09wdGlvbnMuc3J2SG9zdCA9IGhvc3RzWzBdO1xuICAgICAgICBpZiAobW9uZ29PcHRpb25zLmRpcmVjdENvbm5lY3Rpb24pIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvQVBJRXJyb3IoJ1NSViBVUkkgZG9lcyBub3Qgc3VwcG9ydCBkaXJlY3RDb25uZWN0aW9uJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG1vbmdvT3B0aW9ucy5zcnZNYXhIb3N0cyA+IDAgJiYgdHlwZW9mIG1vbmdvT3B0aW9ucy5yZXBsaWNhU2V0ID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29QYXJzZUVycm9yKCdDYW5ub3QgdXNlIHNydk1heEhvc3RzIG9wdGlvbiB3aXRoIHJlcGxpY2FTZXQnKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBTUlYgdHVybnMgb24gVExTIGJ5IGRlZmF1bHQsIGJ1dCB1c2VycyBjYW4gb3ZlcnJpZGUgYW5kIHR1cm4gaXQgb2ZmXG4gICAgICAgIGNvbnN0IG5vVXNlclNwZWNpZmllZFRMUyA9ICFvYmplY3RPcHRpb25zLmhhcygndGxzJykgJiYgIXVybE9wdGlvbnMuaGFzKCd0bHMnKTtcbiAgICAgICAgY29uc3Qgbm9Vc2VyU3BlY2lmaWVkU1NMID0gIW9iamVjdE9wdGlvbnMuaGFzKCdzc2wnKSAmJiAhdXJsT3B0aW9ucy5oYXMoJ3NzbCcpO1xuICAgICAgICBpZiAobm9Vc2VyU3BlY2lmaWVkVExTICYmIG5vVXNlclNwZWNpZmllZFNTTCkge1xuICAgICAgICAgICAgbW9uZ29PcHRpb25zLnRscyA9IHRydWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGNvbnN0IHVzZXJTcGVjaWZpZWRTcnZPcHRpb25zID0gdXJsT3B0aW9ucy5oYXMoJ3Nydk1heEhvc3RzJykgfHxcbiAgICAgICAgICAgIG9iamVjdE9wdGlvbnMuaGFzKCdzcnZNYXhIb3N0cycpIHx8XG4gICAgICAgICAgICB1cmxPcHRpb25zLmhhcygnc3J2U2VydmljZU5hbWUnKSB8fFxuICAgICAgICAgICAgb2JqZWN0T3B0aW9ucy5oYXMoJ3NydlNlcnZpY2VOYW1lJyk7XG4gICAgICAgIGlmICh1c2VyU3BlY2lmaWVkU3J2T3B0aW9ucykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29QYXJzZUVycm9yKCdDYW5ub3QgdXNlIHNydk1heEhvc3RzIG9yIHNydlNlcnZpY2VOYW1lIHdpdGggYSBub24tc3J2IGNvbm5lY3Rpb24gc3RyaW5nJyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKG1vbmdvT3B0aW9ucy5kaXJlY3RDb25uZWN0aW9uICYmIG1vbmdvT3B0aW9ucy5ob3N0cy5sZW5ndGggIT09IDEpIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29QYXJzZUVycm9yKCdkaXJlY3RDb25uZWN0aW9uIG9wdGlvbiByZXF1aXJlcyBleGFjdGx5IG9uZSBob3N0Jyk7XG4gICAgfVxuICAgIGlmICghbW9uZ29PcHRpb25zLnByb3h5SG9zdCAmJlxuICAgICAgICAobW9uZ29PcHRpb25zLnByb3h5UG9ydCB8fCBtb25nb09wdGlvbnMucHJveHlVc2VybmFtZSB8fCBtb25nb09wdGlvbnMucHJveHlQYXNzd29yZCkpIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29QYXJzZUVycm9yKCdNdXN0IHNwZWNpZnkgcHJveHlIb3N0IGlmIG90aGVyIHByb3h5IG9wdGlvbnMgYXJlIHBhc3NlZCcpO1xuICAgIH1cbiAgICBpZiAoKG1vbmdvT3B0aW9ucy5wcm94eVVzZXJuYW1lICYmICFtb25nb09wdGlvbnMucHJveHlQYXNzd29yZCkgfHxcbiAgICAgICAgKCFtb25nb09wdGlvbnMucHJveHlVc2VybmFtZSAmJiBtb25nb09wdGlvbnMucHJveHlQYXNzd29yZCkpIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29QYXJzZUVycm9yKCdDYW4gb25seSBzcGVjaWZ5IGJvdGggb2YgcHJveHkgdXNlcm5hbWUvcGFzc3dvcmQgb3IgbmVpdGhlcicpO1xuICAgIH1cbiAgICBjb25zdCBwcm94eU9wdGlvbnMgPSBbJ3Byb3h5SG9zdCcsICdwcm94eVBvcnQnLCAncHJveHlVc2VybmFtZScsICdwcm94eVBhc3N3b3JkJ10ubWFwKGtleSA9PiB1cmxPcHRpb25zLmdldChrZXkpID8/IFtdKTtcbiAgICBpZiAocHJveHlPcHRpb25zLnNvbWUob3B0aW9ucyA9PiBvcHRpb25zLmxlbmd0aCA+IDEpKSB7XG4gICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUGFyc2VFcnJvcignUHJveHkgb3B0aW9ucyBjYW5ub3QgYmUgc3BlY2lmaWVkIG11bHRpcGxlIHRpbWVzIGluIHRoZSBjb25uZWN0aW9uIHN0cmluZycpO1xuICAgIH1cbiAgICBjb25zdCBsb2dnZXJGZWF0dXJlRmxhZyA9IFN5bWJvbC5mb3IoJ0BAbWRiLmVuYWJsZU1vbmdvTG9nZ2VyJyk7XG4gICAgbW9uZ29PcHRpb25zW2xvZ2dlckZlYXR1cmVGbGFnXSA9IG1vbmdvT3B0aW9uc1tsb2dnZXJGZWF0dXJlRmxhZ10gPz8gZmFsc2U7XG4gICAgbGV0IGxvZ2dlckVudk9wdGlvbnMgPSB7fTtcbiAgICBsZXQgbG9nZ2VyQ2xpZW50T3B0aW9ucyA9IHt9O1xuICAgIGlmIChtb25nb09wdGlvbnNbbG9nZ2VyRmVhdHVyZUZsYWddKSB7XG4gICAgICAgIGxvZ2dlckVudk9wdGlvbnMgPSB7XG4gICAgICAgICAgICBNT05HT0RCX0xPR19DT01NQU5EOiBwcm9jZXNzLmVudi5NT05HT0RCX0xPR19DT01NQU5ELFxuICAgICAgICAgICAgTU9OR09EQl9MT0dfVE9QT0xPR1k6IHByb2Nlc3MuZW52Lk1PTkdPREJfTE9HX1RPUE9MT0dZLFxuICAgICAgICAgICAgTU9OR09EQl9MT0dfU0VSVkVSX1NFTEVDVElPTjogcHJvY2Vzcy5lbnYuTU9OR09EQl9MT0dfU0VSVkVSX1NFTEVDVElPTixcbiAgICAgICAgICAgIE1PTkdPREJfTE9HX0NPTk5FQ1RJT046IHByb2Nlc3MuZW52Lk1PTkdPREJfTE9HX0NPTk5FQ1RJT04sXG4gICAgICAgICAgICBNT05HT0RCX0xPR19BTEw6IHByb2Nlc3MuZW52Lk1PTkdPREJfTE9HX0FMTCxcbiAgICAgICAgICAgIE1PTkdPREJfTE9HX01BWF9ET0NVTUVOVF9MRU5HVEg6IHByb2Nlc3MuZW52Lk1PTkdPREJfTE9HX01BWF9ET0NVTUVOVF9MRU5HVEgsXG4gICAgICAgICAgICBNT05HT0RCX0xPR19QQVRIOiBwcm9jZXNzLmVudi5NT05HT0RCX0xPR19QQVRILFxuICAgICAgICAgICAgLi4ubW9uZ29PcHRpb25zW1N5bWJvbC5mb3IoJ0BAbWRiLmludGVybmFsTG9nZ2VyQ29uZmlnJyldXG4gICAgICAgIH07XG4gICAgICAgIGxvZ2dlckNsaWVudE9wdGlvbnMgPSB7XG4gICAgICAgICAgICBtb25nb2RiTG9nUGF0aDogbW9uZ29PcHRpb25zLm1vbmdvZGJMb2dQYXRoXG4gICAgICAgIH07XG4gICAgfVxuICAgIG1vbmdvT3B0aW9ucy5tb25nb0xvZ2dlck9wdGlvbnMgPSBtb25nb19sb2dnZXJfMS5Nb25nb0xvZ2dlci5yZXNvbHZlT3B0aW9ucyhsb2dnZXJFbnZPcHRpb25zLCBsb2dnZXJDbGllbnRPcHRpb25zKTtcbiAgICBtb25nb09wdGlvbnMubWV0YWRhdGEgPSAoMCwgY2xpZW50X21ldGFkYXRhXzEubWFrZUNsaWVudE1ldGFkYXRhKShtb25nb09wdGlvbnMpO1xuICAgIHJldHVybiBtb25nb09wdGlvbnM7XG59XG5leHBvcnRzLnBhcnNlT3B0aW9ucyA9IHBhcnNlT3B0aW9ucztcbi8qKlxuICogIyMjIyBUaHJvd3MgaWYgTEIgbW9kZSBpcyB0cnVlOlxuICogLSBob3N0cyBjb250YWlucyBtb3JlIHRoYW4gb25lIGhvc3RcbiAqIC0gdGhlcmUgaXMgYSByZXBsaWNhU2V0IG5hbWUgc2V0XG4gKiAtIGRpcmVjdENvbm5lY3Rpb24gaXMgc2V0XG4gKiAtIGlmIHNydk1heEhvc3RzIGlzIHVzZWQgd2hlbiBhbiBzcnYgY29ubmVjdGlvbiBzdHJpbmcgaXMgcGFzc2VkIGluXG4gKlxuICogQHRocm93cyBNb25nb1BhcnNlRXJyb3JcbiAqL1xuZnVuY3Rpb24gdmFsaWRhdGVMb2FkQmFsYW5jZWRPcHRpb25zKGhvc3RzLCBtb25nb09wdGlvbnMsIGlzU3J2KSB7XG4gICAgaWYgKG1vbmdvT3B0aW9ucy5sb2FkQmFsYW5jZWQpIHtcbiAgICAgICAgaWYgKGhvc3RzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUGFyc2VFcnJvcihMQl9TSU5HTEVfSE9TVF9FUlJPUik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG1vbmdvT3B0aW9ucy5yZXBsaWNhU2V0KSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1BhcnNlRXJyb3IoTEJfUkVQTElDQV9TRVRfRVJST1IpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChtb25nb09wdGlvbnMuZGlyZWN0Q29ubmVjdGlvbikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29QYXJzZUVycm9yKExCX0RJUkVDVF9DT05ORUNUSU9OX0VSUk9SKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNTcnYgJiYgbW9uZ29PcHRpb25zLnNydk1heEhvc3RzID4gMCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29QYXJzZUVycm9yKCdDYW5ub3QgbGltaXQgc3J2IGhvc3RzIHdpdGggbG9hZEJhbGFuY2VkIGVuYWJsZWQnKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm47XG59XG5mdW5jdGlvbiBzZXRPcHRpb24obW9uZ29PcHRpb25zLCBrZXksIGRlc2NyaXB0b3IsIHZhbHVlcykge1xuICAgIGNvbnN0IHsgdGFyZ2V0LCB0eXBlLCB0cmFuc2Zvcm0gfSA9IGRlc2NyaXB0b3I7XG4gICAgY29uc3QgbmFtZSA9IHRhcmdldCA/PyBrZXk7XG4gICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgbW9uZ29PcHRpb25zW25hbWVdID0gZ2V0Qm9vbGVhbihuYW1lLCB2YWx1ZXNbMF0pO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ2ludCc6XG4gICAgICAgICAgICBtb25nb09wdGlvbnNbbmFtZV0gPSBnZXRJbnRGcm9tT3B0aW9ucyhuYW1lLCB2YWx1ZXNbMF0pO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ3VpbnQnOlxuICAgICAgICAgICAgbW9uZ29PcHRpb25zW25hbWVdID0gZ2V0VUludEZyb21PcHRpb25zKG5hbWUsIHZhbHVlc1swXSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgIGlmICh2YWx1ZXNbMF0gPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbW9uZ29PcHRpb25zW25hbWVdID0gU3RyaW5nKHZhbHVlc1swXSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAncmVjb3JkJzpcbiAgICAgICAgICAgIGlmICghKDAsIHV0aWxzXzEuaXNSZWNvcmQpKHZhbHVlc1swXSkpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1BhcnNlRXJyb3IoYCR7bmFtZX0gbXVzdCBiZSBhbiBvYmplY3RgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG1vbmdvT3B0aW9uc1tuYW1lXSA9IHZhbHVlc1swXTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdhbnknOlxuICAgICAgICAgICAgbW9uZ29PcHRpb25zW25hbWVdID0gdmFsdWVzWzBdO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgICAgIGlmICghdHJhbnNmb3JtKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29QYXJzZUVycm9yKCdEZXNjcmlwdG9ycyBtaXNzaW5nIGEgdHlwZSBtdXN0IGRlZmluZSBhIHRyYW5zZm9ybScpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgdHJhbnNmb3JtVmFsdWUgPSB0cmFuc2Zvcm0oeyBuYW1lLCBvcHRpb25zOiBtb25nb09wdGlvbnMsIHZhbHVlcyB9KTtcbiAgICAgICAgICAgIG1vbmdvT3B0aW9uc1tuYW1lXSA9IHRyYW5zZm9ybVZhbHVlO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG59XG5leHBvcnRzLk9QVElPTlMgPSB7XG4gICAgYXBwTmFtZToge1xuICAgICAgICB0eXBlOiAnc3RyaW5nJ1xuICAgIH0sXG4gICAgYXV0aDoge1xuICAgICAgICB0YXJnZXQ6ICdjcmVkZW50aWFscycsXG4gICAgICAgIHRyYW5zZm9ybSh7IG5hbWUsIG9wdGlvbnMsIHZhbHVlczogW3ZhbHVlXSB9KSB7XG4gICAgICAgICAgICBpZiAoISgwLCB1dGlsc18xLmlzUmVjb3JkKSh2YWx1ZSwgWyd1c2VybmFtZScsICdwYXNzd29yZCddKSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUGFyc2VFcnJvcihgJHtuYW1lfSBtdXN0IGJlIGFuIG9iamVjdCB3aXRoICd1c2VybmFtZScgYW5kICdwYXNzd29yZCcgcHJvcGVydGllc2ApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG1vbmdvX2NyZWRlbnRpYWxzXzEuTW9uZ29DcmVkZW50aWFscy5tZXJnZShvcHRpb25zLmNyZWRlbnRpYWxzLCB7XG4gICAgICAgICAgICAgICAgdXNlcm5hbWU6IHZhbHVlLnVzZXJuYW1lLFxuICAgICAgICAgICAgICAgIHBhc3N3b3JkOiB2YWx1ZS5wYXNzd29yZFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIGF1dGhNZWNoYW5pc206IHtcbiAgICAgICAgdGFyZ2V0OiAnY3JlZGVudGlhbHMnLFxuICAgICAgICB0cmFuc2Zvcm0oeyBvcHRpb25zLCB2YWx1ZXM6IFt2YWx1ZV0gfSkge1xuICAgICAgICAgICAgY29uc3QgbWVjaGFuaXNtcyA9IE9iamVjdC52YWx1ZXMocHJvdmlkZXJzXzEuQXV0aE1lY2hhbmlzbSk7XG4gICAgICAgICAgICBjb25zdCBbbWVjaGFuaXNtXSA9IG1lY2hhbmlzbXMuZmlsdGVyKG0gPT4gbS5tYXRjaChSZWdFeHAoU3RyaW5nLnJhdyBgXFxiJHt2YWx1ZX1cXGJgLCAnaScpKSk7XG4gICAgICAgICAgICBpZiAoIW1lY2hhbmlzbSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUGFyc2VFcnJvcihgYXV0aE1lY2hhbmlzbSBvbmUgb2YgJHttZWNoYW5pc21zfSwgZ290ICR7dmFsdWV9YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgc291cmNlID0gb3B0aW9ucy5jcmVkZW50aWFscz8uc291cmNlO1xuICAgICAgICAgICAgaWYgKG1lY2hhbmlzbSA9PT0gcHJvdmlkZXJzXzEuQXV0aE1lY2hhbmlzbS5NT05HT0RCX1BMQUlOIHx8XG4gICAgICAgICAgICAgICAgcHJvdmlkZXJzXzEuQVVUSF9NRUNIU19BVVRIX1NSQ19FWFRFUk5BTC5oYXMobWVjaGFuaXNtKSkge1xuICAgICAgICAgICAgICAgIC8vIHNvbWUgbWVjaGFuaXNtcyBoYXZlICckZXh0ZXJuYWwnIGFzIHRoZSBBdXRoIFNvdXJjZVxuICAgICAgICAgICAgICAgIHNvdXJjZSA9ICckZXh0ZXJuYWwnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IHBhc3N3b3JkID0gb3B0aW9ucy5jcmVkZW50aWFscz8ucGFzc3dvcmQ7XG4gICAgICAgICAgICBpZiAobWVjaGFuaXNtID09PSBwcm92aWRlcnNfMS5BdXRoTWVjaGFuaXNtLk1PTkdPREJfWDUwOSAmJiBwYXNzd29yZCA9PT0gJycpIHtcbiAgICAgICAgICAgICAgICBwYXNzd29yZCA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBtb25nb19jcmVkZW50aWFsc18xLk1vbmdvQ3JlZGVudGlhbHMubWVyZ2Uob3B0aW9ucy5jcmVkZW50aWFscywge1xuICAgICAgICAgICAgICAgIG1lY2hhbmlzbSxcbiAgICAgICAgICAgICAgICBzb3VyY2UsXG4gICAgICAgICAgICAgICAgcGFzc3dvcmRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBhdXRoTWVjaGFuaXNtUHJvcGVydGllczoge1xuICAgICAgICB0YXJnZXQ6ICdjcmVkZW50aWFscycsXG4gICAgICAgIHRyYW5zZm9ybSh7IG9wdGlvbnMsIHZhbHVlcyB9KSB7XG4gICAgICAgICAgICAvLyBXZSBjYW4gaGF2ZSBhIGNvbWJpbmF0aW9uIG9mIG9wdGlvbnMgcGFzc2VkIGluIHRoZSBVUkkgYW5kIG9wdGlvbnMgcGFzc2VkXG4gICAgICAgICAgICAvLyBhcyBhbiBvYmplY3QgdG8gdGhlIE1vbmdvQ2xpZW50LiBTbyB3ZSBtdXN0IHRyYW5zZm9ybSB0aGUgc3RyaW5nIG9wdGlvbnNcbiAgICAgICAgICAgIC8vIGFzIHdlbGwgYXMgbWVyZ2UgdGhlbSB0b2dldGhlciB3aXRoIGEgcG90ZW50aWFsbHkgcHJvdmlkZWQgb2JqZWN0LlxuICAgICAgICAgICAgbGV0IG1lY2hhbmlzbVByb3BlcnRpZXMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuICAgICAgICAgICAgZm9yIChjb25zdCBvcHRpb25WYWx1ZSBvZiB2YWx1ZXMpIHtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG9wdGlvblZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBlbnRyaWVzRnJvbVN0cmluZyhvcHRpb25WYWx1ZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVjaGFuaXNtUHJvcGVydGllc1trZXldID0gZ2V0Qm9vbGVhbihrZXksIHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZWNoYW5pc21Qcm9wZXJ0aWVzW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEoMCwgdXRpbHNfMS5pc1JlY29yZCkob3B0aW9uVmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1BhcnNlRXJyb3IoJ0F1dGhNZWNoYW5pc21Qcm9wZXJ0aWVzIG11c3QgYmUgYW4gb2JqZWN0Jyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgbWVjaGFuaXNtUHJvcGVydGllcyA9IHsgLi4ub3B0aW9uVmFsdWUgfTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbW9uZ29fY3JlZGVudGlhbHNfMS5Nb25nb0NyZWRlbnRpYWxzLm1lcmdlKG9wdGlvbnMuY3JlZGVudGlhbHMsIHtcbiAgICAgICAgICAgICAgICBtZWNoYW5pc21Qcm9wZXJ0aWVzXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgYXV0aFNvdXJjZToge1xuICAgICAgICB0YXJnZXQ6ICdjcmVkZW50aWFscycsXG4gICAgICAgIHRyYW5zZm9ybSh7IG9wdGlvbnMsIHZhbHVlczogW3ZhbHVlXSB9KSB7XG4gICAgICAgICAgICBjb25zdCBzb3VyY2UgPSBTdHJpbmcodmFsdWUpO1xuICAgICAgICAgICAgcmV0dXJuIG1vbmdvX2NyZWRlbnRpYWxzXzEuTW9uZ29DcmVkZW50aWFscy5tZXJnZShvcHRpb25zLmNyZWRlbnRpYWxzLCB7IHNvdXJjZSB9KTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgYXV0b0VuY3J5cHRpb246IHtcbiAgICAgICAgdHlwZTogJ3JlY29yZCdcbiAgICB9LFxuICAgIGJzb25SZWdFeHA6IHtcbiAgICAgICAgdHlwZTogJ2Jvb2xlYW4nXG4gICAgfSxcbiAgICBzZXJ2ZXJBcGk6IHtcbiAgICAgICAgdGFyZ2V0OiAnc2VydmVyQXBpJyxcbiAgICAgICAgdHJhbnNmb3JtKHsgdmFsdWVzOiBbdmVyc2lvbl0gfSkge1xuICAgICAgICAgICAgY29uc3Qgc2VydmVyQXBpVG9WYWxpZGF0ZSA9IHR5cGVvZiB2ZXJzaW9uID09PSAnc3RyaW5nJyA/IHsgdmVyc2lvbiB9IDogdmVyc2lvbjtcbiAgICAgICAgICAgIGNvbnN0IHZlcnNpb25Ub1ZhbGlkYXRlID0gc2VydmVyQXBpVG9WYWxpZGF0ZSAmJiBzZXJ2ZXJBcGlUb1ZhbGlkYXRlLnZlcnNpb247XG4gICAgICAgICAgICBpZiAoIXZlcnNpb25Ub1ZhbGlkYXRlKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29QYXJzZUVycm9yKGBJbnZhbGlkIFxcYHNlcnZlckFwaVxcYCBwcm9wZXJ0eTsgbXVzdCBzcGVjaWZ5IGEgdmVyc2lvbiBmcm9tIHRoZSBmb2xsb3dpbmcgZW51bTogW1wiJHtPYmplY3QudmFsdWVzKG1vbmdvX2NsaWVudF8xLlNlcnZlckFwaVZlcnNpb24pLmpvaW4oJ1wiLCBcIicpfVwiXWApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFPYmplY3QudmFsdWVzKG1vbmdvX2NsaWVudF8xLlNlcnZlckFwaVZlcnNpb24pLnNvbWUodiA9PiB2ID09PSB2ZXJzaW9uVG9WYWxpZGF0ZSkpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1BhcnNlRXJyb3IoYEludmFsaWQgc2VydmVyIEFQSSB2ZXJzaW9uPSR7dmVyc2lvblRvVmFsaWRhdGV9OyBtdXN0IGJlIGluIHRoZSBmb2xsb3dpbmcgZW51bTogW1wiJHtPYmplY3QudmFsdWVzKG1vbmdvX2NsaWVudF8xLlNlcnZlckFwaVZlcnNpb24pLmpvaW4oJ1wiLCBcIicpfVwiXWApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHNlcnZlckFwaVRvVmFsaWRhdGU7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIGNoZWNrS2V5czoge1xuICAgICAgICB0eXBlOiAnYm9vbGVhbidcbiAgICB9LFxuICAgIGNvbXByZXNzb3JzOiB7XG4gICAgICAgIGRlZmF1bHQ6ICdub25lJyxcbiAgICAgICAgdGFyZ2V0OiAnY29tcHJlc3NvcnMnLFxuICAgICAgICB0cmFuc2Zvcm0oeyB2YWx1ZXMgfSkge1xuICAgICAgICAgICAgY29uc3QgY29tcHJlc3Npb25MaXN0ID0gbmV3IFNldCgpO1xuICAgICAgICAgICAgZm9yIChjb25zdCBjb21wVmFsIG9mIHZhbHVlcykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNvbXBWYWxBcnJheSA9IHR5cGVvZiBjb21wVmFsID09PSAnc3RyaW5nJyA/IGNvbXBWYWwuc3BsaXQoJywnKSA6IGNvbXBWYWw7XG4gICAgICAgICAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGNvbXBWYWxBcnJheSkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignY29tcHJlc3NvcnMgbXVzdCBiZSBhbiBhcnJheSBvciBhIGNvbW1hLWRlbGltaXRlZCBsaXN0IG9mIHN0cmluZ3MnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBjIG9mIGNvbXBWYWxBcnJheSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmtleXMoY29tcHJlc3Npb25fMS5Db21wcmVzc29yKS5pbmNsdWRlcyhTdHJpbmcoYykpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wcmVzc2lvbkxpc3QuYWRkKFN0cmluZyhjKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKGAke2N9IGlzIG5vdCBhIHZhbGlkIGNvbXByZXNzaW9uIG1lY2hhbmlzbS4gTXVzdCBiZSBvbmUgb2Y6ICR7T2JqZWN0LmtleXMoY29tcHJlc3Npb25fMS5Db21wcmVzc29yKX0uYCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gWy4uLmNvbXByZXNzaW9uTGlzdF07XG4gICAgICAgIH1cbiAgICB9LFxuICAgIGNvbm5lY3RUaW1lb3V0TVM6IHtcbiAgICAgICAgZGVmYXVsdDogMzAwMDAsXG4gICAgICAgIHR5cGU6ICd1aW50J1xuICAgIH0sXG4gICAgZGJOYW1lOiB7XG4gICAgICAgIHR5cGU6ICdzdHJpbmcnXG4gICAgfSxcbiAgICBkaXJlY3RDb25uZWN0aW9uOiB7XG4gICAgICAgIGRlZmF1bHQ6IGZhbHNlLFxuICAgICAgICB0eXBlOiAnYm9vbGVhbidcbiAgICB9LFxuICAgIGRyaXZlckluZm86IHtcbiAgICAgICAgZGVmYXVsdDoge30sXG4gICAgICAgIHR5cGU6ICdyZWNvcmQnXG4gICAgfSxcbiAgICBlbmFibGVVdGY4VmFsaWRhdGlvbjogeyB0eXBlOiAnYm9vbGVhbicsIGRlZmF1bHQ6IHRydWUgfSxcbiAgICBmYW1pbHk6IHtcbiAgICAgICAgdHJhbnNmb3JtKHsgbmFtZSwgdmFsdWVzOiBbdmFsdWVdIH0pIHtcbiAgICAgICAgICAgIGNvbnN0IHRyYW5zZm9ybVZhbHVlID0gZ2V0SW50RnJvbU9wdGlvbnMobmFtZSwgdmFsdWUpO1xuICAgICAgICAgICAgaWYgKHRyYW5zZm9ybVZhbHVlID09PSA0IHx8IHRyYW5zZm9ybVZhbHVlID09PSA2KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRyYW5zZm9ybVZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29QYXJzZUVycm9yKGBPcHRpb24gJ2ZhbWlseScgbXVzdCBiZSA0IG9yIDYgZ290ICR7dHJhbnNmb3JtVmFsdWV9LmApO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBmaWVsZHNBc1Jhdzoge1xuICAgICAgICB0eXBlOiAncmVjb3JkJ1xuICAgIH0sXG4gICAgZm9yY2VTZXJ2ZXJPYmplY3RJZDoge1xuICAgICAgICBkZWZhdWx0OiBmYWxzZSxcbiAgICAgICAgdHlwZTogJ2Jvb2xlYW4nXG4gICAgfSxcbiAgICBmc3luYzoge1xuICAgICAgICBkZXByZWNhdGVkOiAnUGxlYXNlIHVzZSBqb3VybmFsIGluc3RlYWQnLFxuICAgICAgICB0YXJnZXQ6ICd3cml0ZUNvbmNlcm4nLFxuICAgICAgICB0cmFuc2Zvcm0oeyBuYW1lLCBvcHRpb25zLCB2YWx1ZXM6IFt2YWx1ZV0gfSkge1xuICAgICAgICAgICAgY29uc3Qgd2MgPSB3cml0ZV9jb25jZXJuXzEuV3JpdGVDb25jZXJuLmZyb21PcHRpb25zKHtcbiAgICAgICAgICAgICAgICB3cml0ZUNvbmNlcm46IHtcbiAgICAgICAgICAgICAgICAgICAgLi4ub3B0aW9ucy53cml0ZUNvbmNlcm4sXG4gICAgICAgICAgICAgICAgICAgIGZzeW5jOiBnZXRCb29sZWFuKG5hbWUsIHZhbHVlKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKCF3YylcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1BhcnNlRXJyb3IoYFVuYWJsZSB0byBtYWtlIGEgd3JpdGVDb25jZXJuIGZyb20gZnN5bmM9JHt2YWx1ZX1gKTtcbiAgICAgICAgICAgIHJldHVybiB3YztcbiAgICAgICAgfVxuICAgIH0sXG4gICAgaGVhcnRiZWF0RnJlcXVlbmN5TVM6IHtcbiAgICAgICAgZGVmYXVsdDogMTAwMDAsXG4gICAgICAgIHR5cGU6ICd1aW50J1xuICAgIH0sXG4gICAgaWdub3JlVW5kZWZpbmVkOiB7XG4gICAgICAgIHR5cGU6ICdib29sZWFuJ1xuICAgIH0sXG4gICAgajoge1xuICAgICAgICBkZXByZWNhdGVkOiAnUGxlYXNlIHVzZSBqb3VybmFsIGluc3RlYWQnLFxuICAgICAgICB0YXJnZXQ6ICd3cml0ZUNvbmNlcm4nLFxuICAgICAgICB0cmFuc2Zvcm0oeyBuYW1lLCBvcHRpb25zLCB2YWx1ZXM6IFt2YWx1ZV0gfSkge1xuICAgICAgICAgICAgY29uc3Qgd2MgPSB3cml0ZV9jb25jZXJuXzEuV3JpdGVDb25jZXJuLmZyb21PcHRpb25zKHtcbiAgICAgICAgICAgICAgICB3cml0ZUNvbmNlcm46IHtcbiAgICAgICAgICAgICAgICAgICAgLi4ub3B0aW9ucy53cml0ZUNvbmNlcm4sXG4gICAgICAgICAgICAgICAgICAgIGpvdXJuYWw6IGdldEJvb2xlYW4obmFtZSwgdmFsdWUpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAoIXdjKVxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUGFyc2VFcnJvcihgVW5hYmxlIHRvIG1ha2UgYSB3cml0ZUNvbmNlcm4gZnJvbSBqb3VybmFsPSR7dmFsdWV9YCk7XG4gICAgICAgICAgICByZXR1cm4gd2M7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIGpvdXJuYWw6IHtcbiAgICAgICAgdGFyZ2V0OiAnd3JpdGVDb25jZXJuJyxcbiAgICAgICAgdHJhbnNmb3JtKHsgbmFtZSwgb3B0aW9ucywgdmFsdWVzOiBbdmFsdWVdIH0pIHtcbiAgICAgICAgICAgIGNvbnN0IHdjID0gd3JpdGVfY29uY2Vybl8xLldyaXRlQ29uY2Vybi5mcm9tT3B0aW9ucyh7XG4gICAgICAgICAgICAgICAgd3JpdGVDb25jZXJuOiB7XG4gICAgICAgICAgICAgICAgICAgIC4uLm9wdGlvbnMud3JpdGVDb25jZXJuLFxuICAgICAgICAgICAgICAgICAgICBqb3VybmFsOiBnZXRCb29sZWFuKG5hbWUsIHZhbHVlKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKCF3YylcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1BhcnNlRXJyb3IoYFVuYWJsZSB0byBtYWtlIGEgd3JpdGVDb25jZXJuIGZyb20gam91cm5hbD0ke3ZhbHVlfWApO1xuICAgICAgICAgICAgcmV0dXJuIHdjO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBrZWVwQWxpdmU6IHtcbiAgICAgICAgZGVmYXVsdDogdHJ1ZSxcbiAgICAgICAgdHlwZTogJ2Jvb2xlYW4nLFxuICAgICAgICBkZXByZWNhdGVkOiAnV2lsbCBub3QgYmUgYWJsZSB0byB0dXJuIG9mZiBpbiB0aGUgZnV0dXJlLidcbiAgICB9LFxuICAgIGtlZXBBbGl2ZUluaXRpYWxEZWxheToge1xuICAgICAgICBkZWZhdWx0OiAxMjAwMDAsXG4gICAgICAgIHR5cGU6ICd1aW50JyxcbiAgICAgICAgZGVwcmVjYXRlZDogJ1dpbGwgbm90IGJlIGNvbmZpZ3VyYWJsZSBpbiB0aGUgZnV0dXJlLidcbiAgICB9LFxuICAgIGxvYWRCYWxhbmNlZDoge1xuICAgICAgICBkZWZhdWx0OiBmYWxzZSxcbiAgICAgICAgdHlwZTogJ2Jvb2xlYW4nXG4gICAgfSxcbiAgICBsb2NhbFRocmVzaG9sZE1TOiB7XG4gICAgICAgIGRlZmF1bHQ6IDE1LFxuICAgICAgICB0eXBlOiAndWludCdcbiAgICB9LFxuICAgIG1heENvbm5lY3Rpbmc6IHtcbiAgICAgICAgZGVmYXVsdDogMixcbiAgICAgICAgdHJhbnNmb3JtKHsgbmFtZSwgdmFsdWVzOiBbdmFsdWVdIH0pIHtcbiAgICAgICAgICAgIGNvbnN0IG1heENvbm5lY3RpbmcgPSBnZXRVSW50RnJvbU9wdGlvbnMobmFtZSwgdmFsdWUpO1xuICAgICAgICAgICAgaWYgKG1heENvbm5lY3RpbmcgPT09IDApIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdtYXhDb25uZWN0aW5nIG11c3QgYmUgPiAwIGlmIHNwZWNpZmllZCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG1heENvbm5lY3Rpbmc7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIG1heElkbGVUaW1lTVM6IHtcbiAgICAgICAgZGVmYXVsdDogMCxcbiAgICAgICAgdHlwZTogJ3VpbnQnXG4gICAgfSxcbiAgICBtYXhQb29sU2l6ZToge1xuICAgICAgICBkZWZhdWx0OiAxMDAsXG4gICAgICAgIHR5cGU6ICd1aW50J1xuICAgIH0sXG4gICAgbWF4U3RhbGVuZXNzU2Vjb25kczoge1xuICAgICAgICB0YXJnZXQ6ICdyZWFkUHJlZmVyZW5jZScsXG4gICAgICAgIHRyYW5zZm9ybSh7IG5hbWUsIG9wdGlvbnMsIHZhbHVlczogW3ZhbHVlXSB9KSB7XG4gICAgICAgICAgICBjb25zdCBtYXhTdGFsZW5lc3NTZWNvbmRzID0gZ2V0VUludEZyb21PcHRpb25zKG5hbWUsIHZhbHVlKTtcbiAgICAgICAgICAgIGlmIChvcHRpb25zLnJlYWRQcmVmZXJlbmNlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlYWRfcHJlZmVyZW5jZV8xLlJlYWRQcmVmZXJlbmNlLmZyb21PcHRpb25zKHtcbiAgICAgICAgICAgICAgICAgICAgcmVhZFByZWZlcmVuY2U6IHsgLi4ub3B0aW9ucy5yZWFkUHJlZmVyZW5jZSwgbWF4U3RhbGVuZXNzU2Vjb25kcyB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IHJlYWRfcHJlZmVyZW5jZV8xLlJlYWRQcmVmZXJlbmNlKCdzZWNvbmRhcnknLCB1bmRlZmluZWQsIHsgbWF4U3RhbGVuZXNzU2Vjb25kcyB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG4gICAgbWluSW50ZXJuYWxCdWZmZXJTaXplOiB7XG4gICAgICAgIHR5cGU6ICd1aW50J1xuICAgIH0sXG4gICAgbWluUG9vbFNpemU6IHtcbiAgICAgICAgZGVmYXVsdDogMCxcbiAgICAgICAgdHlwZTogJ3VpbnQnXG4gICAgfSxcbiAgICBtaW5IZWFydGJlYXRGcmVxdWVuY3lNUzoge1xuICAgICAgICBkZWZhdWx0OiA1MDAsXG4gICAgICAgIHR5cGU6ICd1aW50J1xuICAgIH0sXG4gICAgbW9uaXRvckNvbW1hbmRzOiB7XG4gICAgICAgIGRlZmF1bHQ6IGZhbHNlLFxuICAgICAgICB0eXBlOiAnYm9vbGVhbidcbiAgICB9LFxuICAgIG5hbWU6IHtcbiAgICAgICAgdGFyZ2V0OiAnZHJpdmVySW5mbycsXG4gICAgICAgIHRyYW5zZm9ybSh7IHZhbHVlczogW3ZhbHVlXSwgb3B0aW9ucyB9KSB7XG4gICAgICAgICAgICByZXR1cm4geyAuLi5vcHRpb25zLmRyaXZlckluZm8sIG5hbWU6IFN0cmluZyh2YWx1ZSkgfTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgbm9EZWxheToge1xuICAgICAgICBkZWZhdWx0OiB0cnVlLFxuICAgICAgICB0eXBlOiAnYm9vbGVhbidcbiAgICB9LFxuICAgIHBrRmFjdG9yeToge1xuICAgICAgICBkZWZhdWx0OiB1dGlsc18xLkRFRkFVTFRfUEtfRkFDVE9SWSxcbiAgICAgICAgdHJhbnNmb3JtKHsgdmFsdWVzOiBbdmFsdWVdIH0pIHtcbiAgICAgICAgICAgIGlmICgoMCwgdXRpbHNfMS5pc1JlY29yZCkodmFsdWUsIFsnY3JlYXRlUGsnXSkgJiYgdHlwZW9mIHZhbHVlLmNyZWF0ZVBrID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29QYXJzZUVycm9yKGBPcHRpb24gcGtGYWN0b3J5IG11c3QgYmUgYW4gb2JqZWN0IHdpdGggYSBjcmVhdGVQayBmdW5jdGlvbiwgZ290ICR7dmFsdWV9YCk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIHByb21vdGVCdWZmZXJzOiB7XG4gICAgICAgIHR5cGU6ICdib29sZWFuJ1xuICAgIH0sXG4gICAgcHJvbW90ZUxvbmdzOiB7XG4gICAgICAgIHR5cGU6ICdib29sZWFuJ1xuICAgIH0sXG4gICAgcHJvbW90ZVZhbHVlczoge1xuICAgICAgICB0eXBlOiAnYm9vbGVhbidcbiAgICB9LFxuICAgIHVzZUJpZ0ludDY0OiB7XG4gICAgICAgIHR5cGU6ICdib29sZWFuJ1xuICAgIH0sXG4gICAgcHJveHlIb3N0OiB7XG4gICAgICAgIHR5cGU6ICdzdHJpbmcnXG4gICAgfSxcbiAgICBwcm94eVBhc3N3b3JkOiB7XG4gICAgICAgIHR5cGU6ICdzdHJpbmcnXG4gICAgfSxcbiAgICBwcm94eVBvcnQ6IHtcbiAgICAgICAgdHlwZTogJ3VpbnQnXG4gICAgfSxcbiAgICBwcm94eVVzZXJuYW1lOiB7XG4gICAgICAgIHR5cGU6ICdzdHJpbmcnXG4gICAgfSxcbiAgICByYXc6IHtcbiAgICAgICAgZGVmYXVsdDogZmFsc2UsXG4gICAgICAgIHR5cGU6ICdib29sZWFuJ1xuICAgIH0sXG4gICAgcmVhZENvbmNlcm46IHtcbiAgICAgICAgdHJhbnNmb3JtKHsgdmFsdWVzOiBbdmFsdWVdLCBvcHRpb25zIH0pIHtcbiAgICAgICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIHJlYWRfY29uY2Vybl8xLlJlYWRDb25jZXJuIHx8ICgwLCB1dGlsc18xLmlzUmVjb3JkKSh2YWx1ZSwgWydsZXZlbCddKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZWFkX2NvbmNlcm5fMS5SZWFkQ29uY2Vybi5mcm9tT3B0aW9ucyh7IC4uLm9wdGlvbnMucmVhZENvbmNlcm4sIC4uLnZhbHVlIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29QYXJzZUVycm9yKGBSZWFkQ29uY2VybiBtdXN0IGJlIGFuIG9iamVjdCwgZ290ICR7SlNPTi5zdHJpbmdpZnkodmFsdWUpfWApO1xuICAgICAgICB9XG4gICAgfSxcbiAgICByZWFkQ29uY2VybkxldmVsOiB7XG4gICAgICAgIHRhcmdldDogJ3JlYWRDb25jZXJuJyxcbiAgICAgICAgdHJhbnNmb3JtKHsgdmFsdWVzOiBbbGV2ZWxdLCBvcHRpb25zIH0pIHtcbiAgICAgICAgICAgIHJldHVybiByZWFkX2NvbmNlcm5fMS5SZWFkQ29uY2Vybi5mcm9tT3B0aW9ucyh7XG4gICAgICAgICAgICAgICAgLi4ub3B0aW9ucy5yZWFkQ29uY2VybixcbiAgICAgICAgICAgICAgICBsZXZlbDogbGV2ZWxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSxcbiAgICByZWFkUHJlZmVyZW5jZToge1xuICAgICAgICBkZWZhdWx0OiByZWFkX3ByZWZlcmVuY2VfMS5SZWFkUHJlZmVyZW5jZS5wcmltYXJ5LFxuICAgICAgICB0cmFuc2Zvcm0oeyB2YWx1ZXM6IFt2YWx1ZV0sIG9wdGlvbnMgfSkge1xuICAgICAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgcmVhZF9wcmVmZXJlbmNlXzEuUmVhZFByZWZlcmVuY2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVhZF9wcmVmZXJlbmNlXzEuUmVhZFByZWZlcmVuY2UuZnJvbU9wdGlvbnMoe1xuICAgICAgICAgICAgICAgICAgICByZWFkUHJlZmVyZW5jZTogeyAuLi5vcHRpb25zLnJlYWRQcmVmZXJlbmNlLCAuLi52YWx1ZSB9LFxuICAgICAgICAgICAgICAgICAgICAuLi52YWx1ZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCgwLCB1dGlsc18xLmlzUmVjb3JkKSh2YWx1ZSwgWydtb2RlJ10pKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcnAgPSByZWFkX3ByZWZlcmVuY2VfMS5SZWFkUHJlZmVyZW5jZS5mcm9tT3B0aW9ucyh7XG4gICAgICAgICAgICAgICAgICAgIHJlYWRQcmVmZXJlbmNlOiB7IC4uLm9wdGlvbnMucmVhZFByZWZlcmVuY2UsIC4uLnZhbHVlIH0sXG4gICAgICAgICAgICAgICAgICAgIC4uLnZhbHVlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgaWYgKHJwKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcnA7XG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1BhcnNlRXJyb3IoYENhbm5vdCBtYWtlIHJlYWQgcHJlZmVyZW5jZSBmcm9tICR7SlNPTi5zdHJpbmdpZnkodmFsdWUpfWApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBycE9wdHMgPSB7XG4gICAgICAgICAgICAgICAgICAgIGhlZGdlOiBvcHRpb25zLnJlYWRQcmVmZXJlbmNlPy5oZWRnZSxcbiAgICAgICAgICAgICAgICAgICAgbWF4U3RhbGVuZXNzU2Vjb25kczogb3B0aW9ucy5yZWFkUHJlZmVyZW5jZT8ubWF4U3RhbGVuZXNzU2Vjb25kc1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyByZWFkX3ByZWZlcmVuY2VfMS5SZWFkUHJlZmVyZW5jZSh2YWx1ZSwgb3B0aW9ucy5yZWFkUHJlZmVyZW5jZT8udGFncywgcnBPcHRzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUGFyc2VFcnJvcihgVW5rbm93biBSZWFkUHJlZmVyZW5jZSB2YWx1ZTogJHt2YWx1ZX1gKTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgcmVhZFByZWZlcmVuY2VUYWdzOiB7XG4gICAgICAgIHRhcmdldDogJ3JlYWRQcmVmZXJlbmNlJyxcbiAgICAgICAgdHJhbnNmb3JtKHsgdmFsdWVzLCBvcHRpb25zIH0pIHtcbiAgICAgICAgICAgIGNvbnN0IHRhZ3MgPSBBcnJheS5pc0FycmF5KHZhbHVlc1swXSlcbiAgICAgICAgICAgICAgICA/IHZhbHVlc1swXVxuICAgICAgICAgICAgICAgIDogdmFsdWVzO1xuICAgICAgICAgICAgY29uc3QgcmVhZFByZWZlcmVuY2VUYWdzID0gW107XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHRhZyBvZiB0YWdzKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVhZFByZWZlcmVuY2VUYWcgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdGFnID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IFtrLCB2XSBvZiBlbnRyaWVzRnJvbVN0cmluZyh0YWcpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZWFkUHJlZmVyZW5jZVRhZ1trXSA9IHY7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCgwLCB1dGlsc18xLmlzUmVjb3JkKSh0YWcpKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgW2ssIHZdIG9mIE9iamVjdC5lbnRyaWVzKHRhZykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRQcmVmZXJlbmNlVGFnW2tdID0gdjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZWFkUHJlZmVyZW5jZVRhZ3MucHVzaChyZWFkUHJlZmVyZW5jZVRhZyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcmVhZF9wcmVmZXJlbmNlXzEuUmVhZFByZWZlcmVuY2UuZnJvbU9wdGlvbnMoe1xuICAgICAgICAgICAgICAgIHJlYWRQcmVmZXJlbmNlOiBvcHRpb25zLnJlYWRQcmVmZXJlbmNlLFxuICAgICAgICAgICAgICAgIHJlYWRQcmVmZXJlbmNlVGFnc1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIHJlcGxpY2FTZXQ6IHtcbiAgICAgICAgdHlwZTogJ3N0cmluZydcbiAgICB9LFxuICAgIHJldHJ5UmVhZHM6IHtcbiAgICAgICAgZGVmYXVsdDogdHJ1ZSxcbiAgICAgICAgdHlwZTogJ2Jvb2xlYW4nXG4gICAgfSxcbiAgICByZXRyeVdyaXRlczoge1xuICAgICAgICBkZWZhdWx0OiB0cnVlLFxuICAgICAgICB0eXBlOiAnYm9vbGVhbidcbiAgICB9LFxuICAgIHNlcmlhbGl6ZUZ1bmN0aW9uczoge1xuICAgICAgICB0eXBlOiAnYm9vbGVhbidcbiAgICB9LFxuICAgIHNlcnZlclNlbGVjdGlvblRpbWVvdXRNUzoge1xuICAgICAgICBkZWZhdWx0OiAzMDAwMCxcbiAgICAgICAgdHlwZTogJ3VpbnQnXG4gICAgfSxcbiAgICBzZXJ2ZXJuYW1lOiB7XG4gICAgICAgIHR5cGU6ICdzdHJpbmcnXG4gICAgfSxcbiAgICBzb2NrZXRUaW1lb3V0TVM6IHtcbiAgICAgICAgZGVmYXVsdDogMCxcbiAgICAgICAgdHlwZTogJ3VpbnQnXG4gICAgfSxcbiAgICBzcnZNYXhIb3N0czoge1xuICAgICAgICB0eXBlOiAndWludCcsXG4gICAgICAgIGRlZmF1bHQ6IDBcbiAgICB9LFxuICAgIHNydlNlcnZpY2VOYW1lOiB7XG4gICAgICAgIHR5cGU6ICdzdHJpbmcnLFxuICAgICAgICBkZWZhdWx0OiAnbW9uZ29kYidcbiAgICB9LFxuICAgIHNzbDoge1xuICAgICAgICB0YXJnZXQ6ICd0bHMnLFxuICAgICAgICB0eXBlOiAnYm9vbGVhbidcbiAgICB9LFxuICAgIHNzbENBOiB7XG4gICAgICAgIGRlcHJlY2F0ZWQ6ICdzc2xDQSBpcyBkZXByZWNhdGVkIGFuZCB3aWxsIGJlIHJlbW92ZWQgaW4gdGhlIG5leHQgbWFqb3IgdmVyc2lvbi4gUGxlYXNlIHVzZSB0bHNDQUZpbGUgaW5zdGVhZC4nLFxuICAgICAgICB0YXJnZXQ6ICdjYScsXG4gICAgICAgIHRyYW5zZm9ybSh7IHZhbHVlczogW3ZhbHVlXSB9KSB7XG4gICAgICAgICAgICByZXR1cm4gZnMucmVhZEZpbGVTeW5jKFN0cmluZyh2YWx1ZSksIHsgZW5jb2Rpbmc6ICdhc2NpaScgfSk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIHNzbENSTDoge1xuICAgICAgICBkZXByZWNhdGVkOiAnc3NsQ1JMIGlzIGRlcHJlY2F0ZWQgYW5kIHdpbGwgYmUgcmVtb3ZlZCBpbiB0aGUgbmV4dCBtYWpvciB2ZXJzaW9uIGFuZCBiZSByZXBsYWNlZCBieSB0bHNDUkxGaWxlIGluIHRoYXQgcmVsZWFzZS4nLFxuICAgICAgICB0YXJnZXQ6ICdjcmwnLFxuICAgICAgICB0cmFuc2Zvcm0oeyB2YWx1ZXM6IFt2YWx1ZV0gfSkge1xuICAgICAgICAgICAgcmV0dXJuIGZzLnJlYWRGaWxlU3luYyhTdHJpbmcodmFsdWUpLCB7IGVuY29kaW5nOiAnYXNjaWknIH0pO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBzc2xDZXJ0OiB7XG4gICAgICAgIGRlcHJlY2F0ZWQ6ICdzc2xDZXJ0IGlzIGRlcHJlY2F0ZWQgYW5kIHdpbGwgYmUgcmVtb3ZlZCBpbiB0aGUgbmV4dCBtYWpvciB2ZXJzaW9uLiBQbGVhc2UgdXNlIHRsc0NlcnRpZmljYXRlS2V5RmlsZSBpbnN0ZWFkLicsXG4gICAgICAgIHRhcmdldDogJ2NlcnQnLFxuICAgICAgICB0cmFuc2Zvcm0oeyB2YWx1ZXM6IFt2YWx1ZV0gfSkge1xuICAgICAgICAgICAgcmV0dXJuIGZzLnJlYWRGaWxlU3luYyhTdHJpbmcodmFsdWUpLCB7IGVuY29kaW5nOiAnYXNjaWknIH0pO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBzc2xLZXk6IHtcbiAgICAgICAgZGVwcmVjYXRlZDogJ3NzbEtleSBpcyBkZXByZWNhdGVkIGFuZCB3aWxsIGJlIHJlbW92ZWQgaW4gdGhlIG5leHQgbWFqb3IgdmVyc2lvbi4gUGxlYXNlIHVzZSB0bHNDZXJ0aWZpY2F0ZUtleUZpbGUgaW5zdGVhZC4nLFxuICAgICAgICB0YXJnZXQ6ICdrZXknLFxuICAgICAgICB0cmFuc2Zvcm0oeyB2YWx1ZXM6IFt2YWx1ZV0gfSkge1xuICAgICAgICAgICAgcmV0dXJuIGZzLnJlYWRGaWxlU3luYyhTdHJpbmcodmFsdWUpLCB7IGVuY29kaW5nOiAnYXNjaWknIH0pO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBzc2xQYXNzOiB7XG4gICAgICAgIGRlcHJlY2F0ZWQ6ICdzc2xQYXNzIGlzIGRlcHJlY2F0ZWQgYW5kIHdpbGwgYmUgcmVtb3ZlZCBpbiB0aGUgbmV4dCBtYWpvciB2ZXJzaW9uLiBQbGVhc2UgdXNlIHRsc0NlcnRpZmljYXRlS2V5RmlsZVBhc3N3b3JkIGluc3RlYWQuJyxcbiAgICAgICAgdGFyZ2V0OiAncGFzc3BocmFzZScsXG4gICAgICAgIHR5cGU6ICdzdHJpbmcnXG4gICAgfSxcbiAgICBzc2xWYWxpZGF0ZToge1xuICAgICAgICBkZXByZWNhdGVkOiAnc3NsVmFsaWRhdGUgaXMgZGVwcmVjYXRlZCBhbmQgd2lsbCBiZSByZW1vdmVkIGluIHRoZSBuZXh0IG1ham9yIHZlcnNpb24uIFBsZWFzZSB1c2UgdGxzQWxsb3dJbnZhbGlkQ2VydGlmaWNhdGVzIGluc3RlYWQuJyxcbiAgICAgICAgdGFyZ2V0OiAncmVqZWN0VW5hdXRob3JpemVkJyxcbiAgICAgICAgdHlwZTogJ2Jvb2xlYW4nXG4gICAgfSxcbiAgICB0bHM6IHtcbiAgICAgICAgdHlwZTogJ2Jvb2xlYW4nXG4gICAgfSxcbiAgICB0bHNBbGxvd0ludmFsaWRDZXJ0aWZpY2F0ZXM6IHtcbiAgICAgICAgdGFyZ2V0OiAncmVqZWN0VW5hdXRob3JpemVkJyxcbiAgICAgICAgdHJhbnNmb3JtKHsgbmFtZSwgdmFsdWVzOiBbdmFsdWVdIH0pIHtcbiAgICAgICAgICAgIC8vIGFsbG93SW52YWxpZENlcnRpZmljYXRlcyBpcyB0aGUgaW52ZXJzZSBvZiByZWplY3RVbmF1dGhvcml6ZWRcbiAgICAgICAgICAgIHJldHVybiAhZ2V0Qm9vbGVhbihuYW1lLCB2YWx1ZSk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIHRsc0FsbG93SW52YWxpZEhvc3RuYW1lczoge1xuICAgICAgICB0YXJnZXQ6ICdjaGVja1NlcnZlcklkZW50aXR5JyxcbiAgICAgICAgdHJhbnNmb3JtKHsgbmFtZSwgdmFsdWVzOiBbdmFsdWVdIH0pIHtcbiAgICAgICAgICAgIC8vIHRsc0FsbG93SW52YWxpZEhvc3RuYW1lcyBtZWFucyBzZXR0aW5nIHRoZSBjaGVja1NlcnZlcklkZW50aXR5IGZ1bmN0aW9uIHRvIGEgbm9vcFxuICAgICAgICAgICAgcmV0dXJuIGdldEJvb2xlYW4obmFtZSwgdmFsdWUpID8gKCkgPT4gdW5kZWZpbmVkIDogdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgfSxcbiAgICB0bHNDQUZpbGU6IHtcbiAgICAgICAgdGFyZ2V0OiAnY2EnLFxuICAgICAgICB0cmFuc2Zvcm0oeyB2YWx1ZXM6IFt2YWx1ZV0gfSkge1xuICAgICAgICAgICAgcmV0dXJuIGZzLnJlYWRGaWxlU3luYyhTdHJpbmcodmFsdWUpLCB7IGVuY29kaW5nOiAnYXNjaWknIH0pO1xuICAgICAgICB9XG4gICAgfSxcbiAgICB0bHNDZXJ0aWZpY2F0ZUZpbGU6IHtcbiAgICAgICAgZGVwcmVjYXRlZDogJ3Rsc0NlcnRpZmljYXRlRmlsZSBpcyBkZXByZWNhdGVkIGFuZCB3aWxsIGJlIHJlbW92ZWQgaW4gdGhlIG5leHQgbWFqb3IgdmVyc2lvbi4gUGxlYXNlIHVzZSB0bHNDZXJ0aWZpY2F0ZUtleUZpbGUgaW5zdGVhZC4nLFxuICAgICAgICB0YXJnZXQ6ICdjZXJ0JyxcbiAgICAgICAgdHJhbnNmb3JtKHsgdmFsdWVzOiBbdmFsdWVdIH0pIHtcbiAgICAgICAgICAgIHJldHVybiBmcy5yZWFkRmlsZVN5bmMoU3RyaW5nKHZhbHVlKSwgeyBlbmNvZGluZzogJ2FzY2lpJyB9KTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgdGxzQ2VydGlmaWNhdGVLZXlGaWxlOiB7XG4gICAgICAgIHRhcmdldDogJ2tleScsXG4gICAgICAgIHRyYW5zZm9ybSh7IHZhbHVlczogW3ZhbHVlXSB9KSB7XG4gICAgICAgICAgICByZXR1cm4gZnMucmVhZEZpbGVTeW5jKFN0cmluZyh2YWx1ZSksIHsgZW5jb2Rpbmc6ICdhc2NpaScgfSk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIHRsc0NlcnRpZmljYXRlS2V5RmlsZVBhc3N3b3JkOiB7XG4gICAgICAgIHRhcmdldDogJ3Bhc3NwaHJhc2UnLFxuICAgICAgICB0eXBlOiAnYW55J1xuICAgIH0sXG4gICAgdGxzSW5zZWN1cmU6IHtcbiAgICAgICAgdHJhbnNmb3JtKHsgbmFtZSwgb3B0aW9ucywgdmFsdWVzOiBbdmFsdWVdIH0pIHtcbiAgICAgICAgICAgIGNvbnN0IHRsc0luc2VjdXJlID0gZ2V0Qm9vbGVhbihuYW1lLCB2YWx1ZSk7XG4gICAgICAgICAgICBpZiAodGxzSW5zZWN1cmUpIHtcbiAgICAgICAgICAgICAgICBvcHRpb25zLmNoZWNrU2VydmVySWRlbnRpdHkgPSAoKSA9PiB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgb3B0aW9ucy5yZWplY3RVbmF1dGhvcml6ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIG9wdGlvbnMuY2hlY2tTZXJ2ZXJJZGVudGl0eSA9IG9wdGlvbnMudGxzQWxsb3dJbnZhbGlkSG9zdG5hbWVzXG4gICAgICAgICAgICAgICAgICAgID8gKCkgPT4gdW5kZWZpbmVkXG4gICAgICAgICAgICAgICAgICAgIDogdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgIG9wdGlvbnMucmVqZWN0VW5hdXRob3JpemVkID0gb3B0aW9ucy50bHNBbGxvd0ludmFsaWRDZXJ0aWZpY2F0ZXMgPyBmYWxzZSA6IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdGxzSW5zZWN1cmU7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIHc6IHtcbiAgICAgICAgdGFyZ2V0OiAnd3JpdGVDb25jZXJuJyxcbiAgICAgICAgdHJhbnNmb3JtKHsgdmFsdWVzOiBbdmFsdWVdLCBvcHRpb25zIH0pIHtcbiAgICAgICAgICAgIHJldHVybiB3cml0ZV9jb25jZXJuXzEuV3JpdGVDb25jZXJuLmZyb21PcHRpb25zKHsgd3JpdGVDb25jZXJuOiB7IC4uLm9wdGlvbnMud3JpdGVDb25jZXJuLCB3OiB2YWx1ZSB9IH0pO1xuICAgICAgICB9XG4gICAgfSxcbiAgICB3YWl0UXVldWVUaW1lb3V0TVM6IHtcbiAgICAgICAgZGVmYXVsdDogMCxcbiAgICAgICAgdHlwZTogJ3VpbnQnXG4gICAgfSxcbiAgICB3cml0ZUNvbmNlcm46IHtcbiAgICAgICAgdGFyZ2V0OiAnd3JpdGVDb25jZXJuJyxcbiAgICAgICAgdHJhbnNmb3JtKHsgdmFsdWVzOiBbdmFsdWVdLCBvcHRpb25zIH0pIHtcbiAgICAgICAgICAgIGlmICgoMCwgdXRpbHNfMS5pc1JlY29yZCkodmFsdWUpIHx8IHZhbHVlIGluc3RhbmNlb2Ygd3JpdGVfY29uY2Vybl8xLldyaXRlQ29uY2Vybikge1xuICAgICAgICAgICAgICAgIHJldHVybiB3cml0ZV9jb25jZXJuXzEuV3JpdGVDb25jZXJuLmZyb21PcHRpb25zKHtcbiAgICAgICAgICAgICAgICAgICAgd3JpdGVDb25jZXJuOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAuLi5vcHRpb25zLndyaXRlQ29uY2VybixcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLnZhbHVlXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHZhbHVlID09PSAnbWFqb3JpdHknIHx8IHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gd3JpdGVfY29uY2Vybl8xLldyaXRlQ29uY2Vybi5mcm9tT3B0aW9ucyh7XG4gICAgICAgICAgICAgICAgICAgIHdyaXRlQ29uY2Vybjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgLi4ub3B0aW9ucy53cml0ZUNvbmNlcm4sXG4gICAgICAgICAgICAgICAgICAgICAgICB3OiB2YWx1ZVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1BhcnNlRXJyb3IoYEludmFsaWQgV3JpdGVDb25jZXJuIGNhbm5vdCBwYXJzZTogJHtKU09OLnN0cmluZ2lmeSh2YWx1ZSl9YCk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIHd0aW1lb3V0OiB7XG4gICAgICAgIGRlcHJlY2F0ZWQ6ICdQbGVhc2UgdXNlIHd0aW1lb3V0TVMgaW5zdGVhZCcsXG4gICAgICAgIHRhcmdldDogJ3dyaXRlQ29uY2VybicsXG4gICAgICAgIHRyYW5zZm9ybSh7IHZhbHVlczogW3ZhbHVlXSwgb3B0aW9ucyB9KSB7XG4gICAgICAgICAgICBjb25zdCB3YyA9IHdyaXRlX2NvbmNlcm5fMS5Xcml0ZUNvbmNlcm4uZnJvbU9wdGlvbnMoe1xuICAgICAgICAgICAgICAgIHdyaXRlQ29uY2Vybjoge1xuICAgICAgICAgICAgICAgICAgICAuLi5vcHRpb25zLndyaXRlQ29uY2VybixcbiAgICAgICAgICAgICAgICAgICAgd3RpbWVvdXQ6IGdldFVJbnRGcm9tT3B0aW9ucygnd3RpbWVvdXQnLCB2YWx1ZSlcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmICh3YylcbiAgICAgICAgICAgICAgICByZXR1cm4gd2M7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1BhcnNlRXJyb3IoYENhbm5vdCBtYWtlIFdyaXRlQ29uY2VybiBmcm9tIHd0aW1lb3V0YCk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIHd0aW1lb3V0TVM6IHtcbiAgICAgICAgdGFyZ2V0OiAnd3JpdGVDb25jZXJuJyxcbiAgICAgICAgdHJhbnNmb3JtKHsgdmFsdWVzOiBbdmFsdWVdLCBvcHRpb25zIH0pIHtcbiAgICAgICAgICAgIGNvbnN0IHdjID0gd3JpdGVfY29uY2Vybl8xLldyaXRlQ29uY2Vybi5mcm9tT3B0aW9ucyh7XG4gICAgICAgICAgICAgICAgd3JpdGVDb25jZXJuOiB7XG4gICAgICAgICAgICAgICAgICAgIC4uLm9wdGlvbnMud3JpdGVDb25jZXJuLFxuICAgICAgICAgICAgICAgICAgICB3dGltZW91dE1TOiBnZXRVSW50RnJvbU9wdGlvbnMoJ3d0aW1lb3V0TVMnLCB2YWx1ZSlcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmICh3YylcbiAgICAgICAgICAgICAgICByZXR1cm4gd2M7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1BhcnNlRXJyb3IoYENhbm5vdCBtYWtlIFdyaXRlQ29uY2VybiBmcm9tIHd0aW1lb3V0YCk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIHpsaWJDb21wcmVzc2lvbkxldmVsOiB7XG4gICAgICAgIGRlZmF1bHQ6IDAsXG4gICAgICAgIHR5cGU6ICdpbnQnXG4gICAgfSxcbiAgICAvLyBDdXN0b20gdHlwZXMgZm9yIG1vZGlmeWluZyBjb3JlIGJlaGF2aW9yXG4gICAgY29ubmVjdGlvblR5cGU6IHsgdHlwZTogJ2FueScgfSxcbiAgICBzcnZQb2xsZXI6IHsgdHlwZTogJ2FueScgfSxcbiAgICAvLyBBY2NlcHRlZCBOb2RlSlMgT3B0aW9uc1xuICAgIG1pbkRIU2l6ZTogeyB0eXBlOiAnYW55JyB9LFxuICAgIHBza0NhbGxiYWNrOiB7IHR5cGU6ICdhbnknIH0sXG4gICAgc2VjdXJlQ29udGV4dDogeyB0eXBlOiAnYW55JyB9LFxuICAgIGVuYWJsZVRyYWNlOiB7IHR5cGU6ICdhbnknIH0sXG4gICAgcmVxdWVzdENlcnQ6IHsgdHlwZTogJ2FueScgfSxcbiAgICByZWplY3RVbmF1dGhvcml6ZWQ6IHsgdHlwZTogJ2FueScgfSxcbiAgICBjaGVja1NlcnZlcklkZW50aXR5OiB7IHR5cGU6ICdhbnknIH0sXG4gICAgQUxQTlByb3RvY29sczogeyB0eXBlOiAnYW55JyB9LFxuICAgIFNOSUNhbGxiYWNrOiB7IHR5cGU6ICdhbnknIH0sXG4gICAgc2Vzc2lvbjogeyB0eXBlOiAnYW55JyB9LFxuICAgIHJlcXVlc3RPQ1NQOiB7IHR5cGU6ICdhbnknIH0sXG4gICAgbG9jYWxBZGRyZXNzOiB7IHR5cGU6ICdhbnknIH0sXG4gICAgbG9jYWxQb3J0OiB7IHR5cGU6ICdhbnknIH0sXG4gICAgaGludHM6IHsgdHlwZTogJ2FueScgfSxcbiAgICBsb29rdXA6IHsgdHlwZTogJ2FueScgfSxcbiAgICBjYTogeyB0eXBlOiAnYW55JyB9LFxuICAgIGNlcnQ6IHsgdHlwZTogJ2FueScgfSxcbiAgICBjaXBoZXJzOiB7IHR5cGU6ICdhbnknIH0sXG4gICAgY3JsOiB7IHR5cGU6ICdhbnknIH0sXG4gICAgZWNkaEN1cnZlOiB7IHR5cGU6ICdhbnknIH0sXG4gICAga2V5OiB7IHR5cGU6ICdhbnknIH0sXG4gICAgcGFzc3BocmFzZTogeyB0eXBlOiAnYW55JyB9LFxuICAgIHBmeDogeyB0eXBlOiAnYW55JyB9LFxuICAgIHNlY3VyZVByb3RvY29sOiB7IHR5cGU6ICdhbnknIH0sXG4gICAgaW5kZXg6IHsgdHlwZTogJ2FueScgfSxcbiAgICAvLyBMZWdhY3kgT3B0aW9ucywgdGhlc2UgYXJlIHVudXNlZCBidXQgbGVmdCBoZXJlIHRvIGF2b2lkIGVycm9ycyB3aXRoIENTRkxFIGxpYlxuICAgIHVzZU5ld1VybFBhcnNlcjogeyB0eXBlOiAnYm9vbGVhbicgfSxcbiAgICB1c2VVbmlmaWVkVG9wb2xvZ3k6IHsgdHlwZTogJ2Jvb2xlYW4nIH0sXG4gICAgLy8gTW9uZ29Mb2dnZXJcbiAgICAvLyBUT0RPKE5PREUtNDg0OSk6IFRpZ2h0ZW4gdGhlIHR5cGUgb2YgbW9uZ29kYkxvZ1BhdGhcbiAgICBtb25nb2RiTG9nUGF0aDogeyB0eXBlOiAnYW55JyB9XG59O1xuZXhwb3J0cy5ERUZBVUxUX09QVElPTlMgPSBuZXcgQ2FzZUluc2Vuc2l0aXZlTWFwKE9iamVjdC5lbnRyaWVzKGV4cG9ydHMuT1BUSU9OUylcbiAgICAuZmlsdGVyKChbLCBkZXNjcmlwdG9yXSkgPT4gZGVzY3JpcHRvci5kZWZhdWx0ICE9IG51bGwpXG4gICAgLm1hcCgoW2ssIGRdKSA9PiBbaywgZC5kZWZhdWx0XSkpO1xuLyoqXG4gKiBTZXQgb2YgcGVybWl0dGVkIGZlYXR1cmUgZmxhZ3NcbiAqIEBpbnRlcm5hbFxuICovXG5leHBvcnRzLkZFQVRVUkVfRkxBR1MgPSBuZXcgU2V0KFtcbiAgICBTeW1ib2wuZm9yKCdAQG1kYi5za2lwUGluZ09uQ29ubmVjdCcpLFxuICAgIFN5bWJvbC5mb3IoJ0BAbWRiLmVuYWJsZU1vbmdvTG9nZ2VyJyksXG4gICAgU3ltYm9sLmZvcignQEBtZGIuaW50ZXJuYWxMb2dnZXJDb25maWcnKVxuXSk7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1jb25uZWN0aW9uX3N0cmluZy5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/connection_string.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/constants.js":
/*!*******************************************************!*\
  !*** ../server/node_modules/mongodb/lib/constants.js ***!
  \*******************************************************/
/***/ ((__unused_webpack_module, exports) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.TOPOLOGY_EVENTS = exports.CMAP_EVENTS = exports.HEARTBEAT_EVENTS = exports.RESUME_TOKEN_CHANGED = exports.END = exports.CHANGE = exports.INIT = exports.MORE = exports.RESPONSE = exports.SERVER_HEARTBEAT_FAILED = exports.SERVER_HEARTBEAT_SUCCEEDED = exports.SERVER_HEARTBEAT_STARTED = exports.COMMAND_FAILED = exports.COMMAND_SUCCEEDED = exports.COMMAND_STARTED = exports.CLUSTER_TIME_RECEIVED = exports.CONNECTION_CHECKED_IN = exports.CONNECTION_CHECKED_OUT = exports.CONNECTION_CHECK_OUT_FAILED = exports.CONNECTION_CHECK_OUT_STARTED = exports.CONNECTION_CLOSED = exports.CONNECTION_READY = exports.CONNECTION_CREATED = exports.CONNECTION_POOL_READY = exports.CONNECTION_POOL_CLEARED = exports.CONNECTION_POOL_CLOSED = exports.CONNECTION_POOL_CREATED = exports.TOPOLOGY_DESCRIPTION_CHANGED = exports.TOPOLOGY_CLOSED = exports.TOPOLOGY_OPENING = exports.SERVER_DESCRIPTION_CHANGED = exports.SERVER_CLOSED = exports.SERVER_OPENING = exports.DESCRIPTION_RECEIVED = exports.UNPINNED = exports.PINNED = exports.MESSAGE = exports.ENDED = exports.CLOSED = exports.CONNECT = exports.OPEN = exports.CLOSE = exports.TIMEOUT = exports.ERROR = exports.SYSTEM_JS_COLLECTION = exports.SYSTEM_COMMAND_COLLECTION = exports.SYSTEM_USER_COLLECTION = exports.SYSTEM_PROFILE_COLLECTION = exports.SYSTEM_INDEX_COLLECTION = exports.SYSTEM_NAMESPACE_COLLECTION = void 0;\nexports.LEGACY_HELLO_COMMAND_CAMEL_CASE = exports.LEGACY_HELLO_COMMAND = exports.MONGO_CLIENT_EVENTS = exports.LOCAL_SERVER_EVENTS = exports.SERVER_RELAY_EVENTS = exports.APM_EVENTS = void 0;\nexports.SYSTEM_NAMESPACE_COLLECTION = 'system.namespaces';\nexports.SYSTEM_INDEX_COLLECTION = 'system.indexes';\nexports.SYSTEM_PROFILE_COLLECTION = 'system.profile';\nexports.SYSTEM_USER_COLLECTION = 'system.users';\nexports.SYSTEM_COMMAND_COLLECTION = '$cmd';\nexports.SYSTEM_JS_COLLECTION = 'system.js';\n// events\nexports.ERROR = 'error';\nexports.TIMEOUT = 'timeout';\nexports.CLOSE = 'close';\nexports.OPEN = 'open';\nexports.CONNECT = 'connect';\nexports.CLOSED = 'closed';\nexports.ENDED = 'ended';\nexports.MESSAGE = 'message';\nexports.PINNED = 'pinned';\nexports.UNPINNED = 'unpinned';\nexports.DESCRIPTION_RECEIVED = 'descriptionReceived';\nexports.SERVER_OPENING = 'serverOpening';\nexports.SERVER_CLOSED = 'serverClosed';\nexports.SERVER_DESCRIPTION_CHANGED = 'serverDescriptionChanged';\nexports.TOPOLOGY_OPENING = 'topologyOpening';\nexports.TOPOLOGY_CLOSED = 'topologyClosed';\nexports.TOPOLOGY_DESCRIPTION_CHANGED = 'topologyDescriptionChanged';\n/** @internal */\nexports.CONNECTION_POOL_CREATED = 'connectionPoolCreated';\n/** @internal */\nexports.CONNECTION_POOL_CLOSED = 'connectionPoolClosed';\n/** @internal */\nexports.CONNECTION_POOL_CLEARED = 'connectionPoolCleared';\n/** @internal */\nexports.CONNECTION_POOL_READY = 'connectionPoolReady';\n/** @internal */\nexports.CONNECTION_CREATED = 'connectionCreated';\n/** @internal */\nexports.CONNECTION_READY = 'connectionReady';\n/** @internal */\nexports.CONNECTION_CLOSED = 'connectionClosed';\n/** @internal */\nexports.CONNECTION_CHECK_OUT_STARTED = 'connectionCheckOutStarted';\n/** @internal */\nexports.CONNECTION_CHECK_OUT_FAILED = 'connectionCheckOutFailed';\n/** @internal */\nexports.CONNECTION_CHECKED_OUT = 'connectionCheckedOut';\n/** @internal */\nexports.CONNECTION_CHECKED_IN = 'connectionCheckedIn';\nexports.CLUSTER_TIME_RECEIVED = 'clusterTimeReceived';\nexports.COMMAND_STARTED = 'commandStarted';\nexports.COMMAND_SUCCEEDED = 'commandSucceeded';\nexports.COMMAND_FAILED = 'commandFailed';\nexports.SERVER_HEARTBEAT_STARTED = 'serverHeartbeatStarted';\nexports.SERVER_HEARTBEAT_SUCCEEDED = 'serverHeartbeatSucceeded';\nexports.SERVER_HEARTBEAT_FAILED = 'serverHeartbeatFailed';\nexports.RESPONSE = 'response';\nexports.MORE = 'more';\nexports.INIT = 'init';\nexports.CHANGE = 'change';\nexports.END = 'end';\nexports.RESUME_TOKEN_CHANGED = 'resumeTokenChanged';\n/** @public */\nexports.HEARTBEAT_EVENTS = Object.freeze([\n    exports.SERVER_HEARTBEAT_STARTED,\n    exports.SERVER_HEARTBEAT_SUCCEEDED,\n    exports.SERVER_HEARTBEAT_FAILED\n]);\n/** @public */\nexports.CMAP_EVENTS = Object.freeze([\n    exports.CONNECTION_POOL_CREATED,\n    exports.CONNECTION_POOL_READY,\n    exports.CONNECTION_POOL_CLEARED,\n    exports.CONNECTION_POOL_CLOSED,\n    exports.CONNECTION_CREATED,\n    exports.CONNECTION_READY,\n    exports.CONNECTION_CLOSED,\n    exports.CONNECTION_CHECK_OUT_STARTED,\n    exports.CONNECTION_CHECK_OUT_FAILED,\n    exports.CONNECTION_CHECKED_OUT,\n    exports.CONNECTION_CHECKED_IN\n]);\n/** @public */\nexports.TOPOLOGY_EVENTS = Object.freeze([\n    exports.SERVER_OPENING,\n    exports.SERVER_CLOSED,\n    exports.SERVER_DESCRIPTION_CHANGED,\n    exports.TOPOLOGY_OPENING,\n    exports.TOPOLOGY_CLOSED,\n    exports.TOPOLOGY_DESCRIPTION_CHANGED,\n    exports.ERROR,\n    exports.TIMEOUT,\n    exports.CLOSE\n]);\n/** @public */\nexports.APM_EVENTS = Object.freeze([\n    exports.COMMAND_STARTED,\n    exports.COMMAND_SUCCEEDED,\n    exports.COMMAND_FAILED\n]);\n/**\n * All events that we relay to the `Topology`\n * @internal\n */\nexports.SERVER_RELAY_EVENTS = Object.freeze([\n    exports.SERVER_HEARTBEAT_STARTED,\n    exports.SERVER_HEARTBEAT_SUCCEEDED,\n    exports.SERVER_HEARTBEAT_FAILED,\n    exports.COMMAND_STARTED,\n    exports.COMMAND_SUCCEEDED,\n    exports.COMMAND_FAILED,\n    ...exports.CMAP_EVENTS\n]);\n/**\n * All events we listen to from `Server` instances, but do not forward to the client\n * @internal\n */\nexports.LOCAL_SERVER_EVENTS = Object.freeze([\n    exports.CONNECT,\n    exports.DESCRIPTION_RECEIVED,\n    exports.CLOSED,\n    exports.ENDED\n]);\n/** @public */\nexports.MONGO_CLIENT_EVENTS = Object.freeze([\n    ...exports.CMAP_EVENTS,\n    ...exports.APM_EVENTS,\n    ...exports.TOPOLOGY_EVENTS,\n    ...exports.HEARTBEAT_EVENTS\n]);\n/**\n * @internal\n * The legacy hello command that was deprecated in MongoDB 5.0.\n */\nexports.LEGACY_HELLO_COMMAND = 'ismaster';\n/**\n * @internal\n * The legacy hello command that was deprecated in MongoDB 5.0.\n */\nexports.LEGACY_HELLO_COMMAND_CAMEL_CASE = 'isMaster';\n//# sourceMappingURL=constants.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jb25zdGFudHMuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsdUJBQXVCLEdBQUcsbUJBQW1CLEdBQUcsd0JBQXdCLEdBQUcsNEJBQTRCLEdBQUcsV0FBVyxHQUFHLGNBQWMsR0FBRyxZQUFZLEdBQUcsWUFBWSxHQUFHLGdCQUFnQixHQUFHLCtCQUErQixHQUFHLGtDQUFrQyxHQUFHLGdDQUFnQyxHQUFHLHNCQUFzQixHQUFHLHlCQUF5QixHQUFHLHVCQUF1QixHQUFHLDZCQUE2QixHQUFHLDZCQUE2QixHQUFHLDhCQUE4QixHQUFHLG1DQUFtQyxHQUFHLG9DQUFvQyxHQUFHLHlCQUF5QixHQUFHLHdCQUF3QixHQUFHLDBCQUEwQixHQUFHLDZCQUE2QixHQUFHLCtCQUErQixHQUFHLDhCQUE4QixHQUFHLCtCQUErQixHQUFHLG9DQUFvQyxHQUFHLHVCQUF1QixHQUFHLHdCQUF3QixHQUFHLGtDQUFrQyxHQUFHLHFCQUFxQixHQUFHLHNCQUFzQixHQUFHLDRCQUE0QixHQUFHLGdCQUFnQixHQUFHLGNBQWMsR0FBRyxlQUFlLEdBQUcsYUFBYSxHQUFHLGNBQWMsR0FBRyxlQUFlLEdBQUcsWUFBWSxHQUFHLGFBQWEsR0FBRyxlQUFlLEdBQUcsYUFBYSxHQUFHLDRCQUE0QixHQUFHLGlDQUFpQyxHQUFHLDhCQUE4QixHQUFHLGlDQUFpQyxHQUFHLCtCQUErQixHQUFHLG1DQUFtQztBQUNsMEMsdUNBQXVDLEdBQUcsNEJBQTRCLEdBQUcsMkJBQTJCLEdBQUcsMkJBQTJCLEdBQUcsMkJBQTJCLEdBQUcsa0JBQWtCO0FBQ3JMLG1DQUFtQztBQUNuQywrQkFBK0I7QUFDL0IsaUNBQWlDO0FBQ2pDLDhCQUE4QjtBQUM5QixpQ0FBaUM7QUFDakMsNEJBQTRCO0FBQzVCO0FBQ0EsYUFBYTtBQUNiLGVBQWU7QUFDZixhQUFhO0FBQ2IsWUFBWTtBQUNaLGVBQWU7QUFDZixjQUFjO0FBQ2QsYUFBYTtBQUNiLGVBQWU7QUFDZixjQUFjO0FBQ2QsZ0JBQWdCO0FBQ2hCLDRCQUE0QjtBQUM1QixzQkFBc0I7QUFDdEIscUJBQXFCO0FBQ3JCLGtDQUFrQztBQUNsQyx3QkFBd0I7QUFDeEIsdUJBQXVCO0FBQ3ZCLG9DQUFvQztBQUNwQztBQUNBLCtCQUErQjtBQUMvQjtBQUNBLDhCQUE4QjtBQUM5QjtBQUNBLCtCQUErQjtBQUMvQjtBQUNBLDZCQUE2QjtBQUM3QjtBQUNBLDBCQUEwQjtBQUMxQjtBQUNBLHdCQUF3QjtBQUN4QjtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBLG9DQUFvQztBQUNwQztBQUNBLG1DQUFtQztBQUNuQztBQUNBLDhCQUE4QjtBQUM5QjtBQUNBLDZCQUE2QjtBQUM3Qiw2QkFBNkI7QUFDN0IsdUJBQXVCO0FBQ3ZCLHlCQUF5QjtBQUN6QixzQkFBc0I7QUFDdEIsZ0NBQWdDO0FBQ2hDLGtDQUFrQztBQUNsQywrQkFBK0I7QUFDL0IsZ0JBQWdCO0FBQ2hCLFlBQVk7QUFDWixZQUFZO0FBQ1osY0FBYztBQUNkLFdBQVc7QUFDWCw0QkFBNEI7QUFDNUI7QUFDQSx3QkFBd0I7QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQjtBQUNuQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QjtBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkI7QUFDM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQjtBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEI7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1Q0FBdUM7QUFDdkMiLCJzb3VyY2VzIjpbIkQ6XFxzYWxvbmlcXGFwcHJhaXNhbC1zeXN0ZW1cXHNlcnZlclxcbm9kZV9tb2R1bGVzXFxtb25nb2RiXFxsaWJcXGNvbnN0YW50cy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuVE9QT0xPR1lfRVZFTlRTID0gZXhwb3J0cy5DTUFQX0VWRU5UUyA9IGV4cG9ydHMuSEVBUlRCRUFUX0VWRU5UUyA9IGV4cG9ydHMuUkVTVU1FX1RPS0VOX0NIQU5HRUQgPSBleHBvcnRzLkVORCA9IGV4cG9ydHMuQ0hBTkdFID0gZXhwb3J0cy5JTklUID0gZXhwb3J0cy5NT1JFID0gZXhwb3J0cy5SRVNQT05TRSA9IGV4cG9ydHMuU0VSVkVSX0hFQVJUQkVBVF9GQUlMRUQgPSBleHBvcnRzLlNFUlZFUl9IRUFSVEJFQVRfU1VDQ0VFREVEID0gZXhwb3J0cy5TRVJWRVJfSEVBUlRCRUFUX1NUQVJURUQgPSBleHBvcnRzLkNPTU1BTkRfRkFJTEVEID0gZXhwb3J0cy5DT01NQU5EX1NVQ0NFRURFRCA9IGV4cG9ydHMuQ09NTUFORF9TVEFSVEVEID0gZXhwb3J0cy5DTFVTVEVSX1RJTUVfUkVDRUlWRUQgPSBleHBvcnRzLkNPTk5FQ1RJT05fQ0hFQ0tFRF9JTiA9IGV4cG9ydHMuQ09OTkVDVElPTl9DSEVDS0VEX09VVCA9IGV4cG9ydHMuQ09OTkVDVElPTl9DSEVDS19PVVRfRkFJTEVEID0gZXhwb3J0cy5DT05ORUNUSU9OX0NIRUNLX09VVF9TVEFSVEVEID0gZXhwb3J0cy5DT05ORUNUSU9OX0NMT1NFRCA9IGV4cG9ydHMuQ09OTkVDVElPTl9SRUFEWSA9IGV4cG9ydHMuQ09OTkVDVElPTl9DUkVBVEVEID0gZXhwb3J0cy5DT05ORUNUSU9OX1BPT0xfUkVBRFkgPSBleHBvcnRzLkNPTk5FQ1RJT05fUE9PTF9DTEVBUkVEID0gZXhwb3J0cy5DT05ORUNUSU9OX1BPT0xfQ0xPU0VEID0gZXhwb3J0cy5DT05ORUNUSU9OX1BPT0xfQ1JFQVRFRCA9IGV4cG9ydHMuVE9QT0xPR1lfREVTQ1JJUFRJT05fQ0hBTkdFRCA9IGV4cG9ydHMuVE9QT0xPR1lfQ0xPU0VEID0gZXhwb3J0cy5UT1BPTE9HWV9PUEVOSU5HID0gZXhwb3J0cy5TRVJWRVJfREVTQ1JJUFRJT05fQ0hBTkdFRCA9IGV4cG9ydHMuU0VSVkVSX0NMT1NFRCA9IGV4cG9ydHMuU0VSVkVSX09QRU5JTkcgPSBleHBvcnRzLkRFU0NSSVBUSU9OX1JFQ0VJVkVEID0gZXhwb3J0cy5VTlBJTk5FRCA9IGV4cG9ydHMuUElOTkVEID0gZXhwb3J0cy5NRVNTQUdFID0gZXhwb3J0cy5FTkRFRCA9IGV4cG9ydHMuQ0xPU0VEID0gZXhwb3J0cy5DT05ORUNUID0gZXhwb3J0cy5PUEVOID0gZXhwb3J0cy5DTE9TRSA9IGV4cG9ydHMuVElNRU9VVCA9IGV4cG9ydHMuRVJST1IgPSBleHBvcnRzLlNZU1RFTV9KU19DT0xMRUNUSU9OID0gZXhwb3J0cy5TWVNURU1fQ09NTUFORF9DT0xMRUNUSU9OID0gZXhwb3J0cy5TWVNURU1fVVNFUl9DT0xMRUNUSU9OID0gZXhwb3J0cy5TWVNURU1fUFJPRklMRV9DT0xMRUNUSU9OID0gZXhwb3J0cy5TWVNURU1fSU5ERVhfQ09MTEVDVElPTiA9IGV4cG9ydHMuU1lTVEVNX05BTUVTUEFDRV9DT0xMRUNUSU9OID0gdm9pZCAwO1xuZXhwb3J0cy5MRUdBQ1lfSEVMTE9fQ09NTUFORF9DQU1FTF9DQVNFID0gZXhwb3J0cy5MRUdBQ1lfSEVMTE9fQ09NTUFORCA9IGV4cG9ydHMuTU9OR09fQ0xJRU5UX0VWRU5UUyA9IGV4cG9ydHMuTE9DQUxfU0VSVkVSX0VWRU5UUyA9IGV4cG9ydHMuU0VSVkVSX1JFTEFZX0VWRU5UUyA9IGV4cG9ydHMuQVBNX0VWRU5UUyA9IHZvaWQgMDtcbmV4cG9ydHMuU1lTVEVNX05BTUVTUEFDRV9DT0xMRUNUSU9OID0gJ3N5c3RlbS5uYW1lc3BhY2VzJztcbmV4cG9ydHMuU1lTVEVNX0lOREVYX0NPTExFQ1RJT04gPSAnc3lzdGVtLmluZGV4ZXMnO1xuZXhwb3J0cy5TWVNURU1fUFJPRklMRV9DT0xMRUNUSU9OID0gJ3N5c3RlbS5wcm9maWxlJztcbmV4cG9ydHMuU1lTVEVNX1VTRVJfQ09MTEVDVElPTiA9ICdzeXN0ZW0udXNlcnMnO1xuZXhwb3J0cy5TWVNURU1fQ09NTUFORF9DT0xMRUNUSU9OID0gJyRjbWQnO1xuZXhwb3J0cy5TWVNURU1fSlNfQ09MTEVDVElPTiA9ICdzeXN0ZW0uanMnO1xuLy8gZXZlbnRzXG5leHBvcnRzLkVSUk9SID0gJ2Vycm9yJztcbmV4cG9ydHMuVElNRU9VVCA9ICd0aW1lb3V0JztcbmV4cG9ydHMuQ0xPU0UgPSAnY2xvc2UnO1xuZXhwb3J0cy5PUEVOID0gJ29wZW4nO1xuZXhwb3J0cy5DT05ORUNUID0gJ2Nvbm5lY3QnO1xuZXhwb3J0cy5DTE9TRUQgPSAnY2xvc2VkJztcbmV4cG9ydHMuRU5ERUQgPSAnZW5kZWQnO1xuZXhwb3J0cy5NRVNTQUdFID0gJ21lc3NhZ2UnO1xuZXhwb3J0cy5QSU5ORUQgPSAncGlubmVkJztcbmV4cG9ydHMuVU5QSU5ORUQgPSAndW5waW5uZWQnO1xuZXhwb3J0cy5ERVNDUklQVElPTl9SRUNFSVZFRCA9ICdkZXNjcmlwdGlvblJlY2VpdmVkJztcbmV4cG9ydHMuU0VSVkVSX09QRU5JTkcgPSAnc2VydmVyT3BlbmluZyc7XG5leHBvcnRzLlNFUlZFUl9DTE9TRUQgPSAnc2VydmVyQ2xvc2VkJztcbmV4cG9ydHMuU0VSVkVSX0RFU0NSSVBUSU9OX0NIQU5HRUQgPSAnc2VydmVyRGVzY3JpcHRpb25DaGFuZ2VkJztcbmV4cG9ydHMuVE9QT0xPR1lfT1BFTklORyA9ICd0b3BvbG9neU9wZW5pbmcnO1xuZXhwb3J0cy5UT1BPTE9HWV9DTE9TRUQgPSAndG9wb2xvZ3lDbG9zZWQnO1xuZXhwb3J0cy5UT1BPTE9HWV9ERVNDUklQVElPTl9DSEFOR0VEID0gJ3RvcG9sb2d5RGVzY3JpcHRpb25DaGFuZ2VkJztcbi8qKiBAaW50ZXJuYWwgKi9cbmV4cG9ydHMuQ09OTkVDVElPTl9QT09MX0NSRUFURUQgPSAnY29ubmVjdGlvblBvb2xDcmVhdGVkJztcbi8qKiBAaW50ZXJuYWwgKi9cbmV4cG9ydHMuQ09OTkVDVElPTl9QT09MX0NMT1NFRCA9ICdjb25uZWN0aW9uUG9vbENsb3NlZCc7XG4vKiogQGludGVybmFsICovXG5leHBvcnRzLkNPTk5FQ1RJT05fUE9PTF9DTEVBUkVEID0gJ2Nvbm5lY3Rpb25Qb29sQ2xlYXJlZCc7XG4vKiogQGludGVybmFsICovXG5leHBvcnRzLkNPTk5FQ1RJT05fUE9PTF9SRUFEWSA9ICdjb25uZWN0aW9uUG9vbFJlYWR5Jztcbi8qKiBAaW50ZXJuYWwgKi9cbmV4cG9ydHMuQ09OTkVDVElPTl9DUkVBVEVEID0gJ2Nvbm5lY3Rpb25DcmVhdGVkJztcbi8qKiBAaW50ZXJuYWwgKi9cbmV4cG9ydHMuQ09OTkVDVElPTl9SRUFEWSA9ICdjb25uZWN0aW9uUmVhZHknO1xuLyoqIEBpbnRlcm5hbCAqL1xuZXhwb3J0cy5DT05ORUNUSU9OX0NMT1NFRCA9ICdjb25uZWN0aW9uQ2xvc2VkJztcbi8qKiBAaW50ZXJuYWwgKi9cbmV4cG9ydHMuQ09OTkVDVElPTl9DSEVDS19PVVRfU1RBUlRFRCA9ICdjb25uZWN0aW9uQ2hlY2tPdXRTdGFydGVkJztcbi8qKiBAaW50ZXJuYWwgKi9cbmV4cG9ydHMuQ09OTkVDVElPTl9DSEVDS19PVVRfRkFJTEVEID0gJ2Nvbm5lY3Rpb25DaGVja091dEZhaWxlZCc7XG4vKiogQGludGVybmFsICovXG5leHBvcnRzLkNPTk5FQ1RJT05fQ0hFQ0tFRF9PVVQgPSAnY29ubmVjdGlvbkNoZWNrZWRPdXQnO1xuLyoqIEBpbnRlcm5hbCAqL1xuZXhwb3J0cy5DT05ORUNUSU9OX0NIRUNLRURfSU4gPSAnY29ubmVjdGlvbkNoZWNrZWRJbic7XG5leHBvcnRzLkNMVVNURVJfVElNRV9SRUNFSVZFRCA9ICdjbHVzdGVyVGltZVJlY2VpdmVkJztcbmV4cG9ydHMuQ09NTUFORF9TVEFSVEVEID0gJ2NvbW1hbmRTdGFydGVkJztcbmV4cG9ydHMuQ09NTUFORF9TVUNDRUVERUQgPSAnY29tbWFuZFN1Y2NlZWRlZCc7XG5leHBvcnRzLkNPTU1BTkRfRkFJTEVEID0gJ2NvbW1hbmRGYWlsZWQnO1xuZXhwb3J0cy5TRVJWRVJfSEVBUlRCRUFUX1NUQVJURUQgPSAnc2VydmVySGVhcnRiZWF0U3RhcnRlZCc7XG5leHBvcnRzLlNFUlZFUl9IRUFSVEJFQVRfU1VDQ0VFREVEID0gJ3NlcnZlckhlYXJ0YmVhdFN1Y2NlZWRlZCc7XG5leHBvcnRzLlNFUlZFUl9IRUFSVEJFQVRfRkFJTEVEID0gJ3NlcnZlckhlYXJ0YmVhdEZhaWxlZCc7XG5leHBvcnRzLlJFU1BPTlNFID0gJ3Jlc3BvbnNlJztcbmV4cG9ydHMuTU9SRSA9ICdtb3JlJztcbmV4cG9ydHMuSU5JVCA9ICdpbml0JztcbmV4cG9ydHMuQ0hBTkdFID0gJ2NoYW5nZSc7XG5leHBvcnRzLkVORCA9ICdlbmQnO1xuZXhwb3J0cy5SRVNVTUVfVE9LRU5fQ0hBTkdFRCA9ICdyZXN1bWVUb2tlbkNoYW5nZWQnO1xuLyoqIEBwdWJsaWMgKi9cbmV4cG9ydHMuSEVBUlRCRUFUX0VWRU5UUyA9IE9iamVjdC5mcmVlemUoW1xuICAgIGV4cG9ydHMuU0VSVkVSX0hFQVJUQkVBVF9TVEFSVEVELFxuICAgIGV4cG9ydHMuU0VSVkVSX0hFQVJUQkVBVF9TVUNDRUVERUQsXG4gICAgZXhwb3J0cy5TRVJWRVJfSEVBUlRCRUFUX0ZBSUxFRFxuXSk7XG4vKiogQHB1YmxpYyAqL1xuZXhwb3J0cy5DTUFQX0VWRU5UUyA9IE9iamVjdC5mcmVlemUoW1xuICAgIGV4cG9ydHMuQ09OTkVDVElPTl9QT09MX0NSRUFURUQsXG4gICAgZXhwb3J0cy5DT05ORUNUSU9OX1BPT0xfUkVBRFksXG4gICAgZXhwb3J0cy5DT05ORUNUSU9OX1BPT0xfQ0xFQVJFRCxcbiAgICBleHBvcnRzLkNPTk5FQ1RJT05fUE9PTF9DTE9TRUQsXG4gICAgZXhwb3J0cy5DT05ORUNUSU9OX0NSRUFURUQsXG4gICAgZXhwb3J0cy5DT05ORUNUSU9OX1JFQURZLFxuICAgIGV4cG9ydHMuQ09OTkVDVElPTl9DTE9TRUQsXG4gICAgZXhwb3J0cy5DT05ORUNUSU9OX0NIRUNLX09VVF9TVEFSVEVELFxuICAgIGV4cG9ydHMuQ09OTkVDVElPTl9DSEVDS19PVVRfRkFJTEVELFxuICAgIGV4cG9ydHMuQ09OTkVDVElPTl9DSEVDS0VEX09VVCxcbiAgICBleHBvcnRzLkNPTk5FQ1RJT05fQ0hFQ0tFRF9JTlxuXSk7XG4vKiogQHB1YmxpYyAqL1xuZXhwb3J0cy5UT1BPTE9HWV9FVkVOVFMgPSBPYmplY3QuZnJlZXplKFtcbiAgICBleHBvcnRzLlNFUlZFUl9PUEVOSU5HLFxuICAgIGV4cG9ydHMuU0VSVkVSX0NMT1NFRCxcbiAgICBleHBvcnRzLlNFUlZFUl9ERVNDUklQVElPTl9DSEFOR0VELFxuICAgIGV4cG9ydHMuVE9QT0xPR1lfT1BFTklORyxcbiAgICBleHBvcnRzLlRPUE9MT0dZX0NMT1NFRCxcbiAgICBleHBvcnRzLlRPUE9MT0dZX0RFU0NSSVBUSU9OX0NIQU5HRUQsXG4gICAgZXhwb3J0cy5FUlJPUixcbiAgICBleHBvcnRzLlRJTUVPVVQsXG4gICAgZXhwb3J0cy5DTE9TRVxuXSk7XG4vKiogQHB1YmxpYyAqL1xuZXhwb3J0cy5BUE1fRVZFTlRTID0gT2JqZWN0LmZyZWV6ZShbXG4gICAgZXhwb3J0cy5DT01NQU5EX1NUQVJURUQsXG4gICAgZXhwb3J0cy5DT01NQU5EX1NVQ0NFRURFRCxcbiAgICBleHBvcnRzLkNPTU1BTkRfRkFJTEVEXG5dKTtcbi8qKlxuICogQWxsIGV2ZW50cyB0aGF0IHdlIHJlbGF5IHRvIHRoZSBgVG9wb2xvZ3lgXG4gKiBAaW50ZXJuYWxcbiAqL1xuZXhwb3J0cy5TRVJWRVJfUkVMQVlfRVZFTlRTID0gT2JqZWN0LmZyZWV6ZShbXG4gICAgZXhwb3J0cy5TRVJWRVJfSEVBUlRCRUFUX1NUQVJURUQsXG4gICAgZXhwb3J0cy5TRVJWRVJfSEVBUlRCRUFUX1NVQ0NFRURFRCxcbiAgICBleHBvcnRzLlNFUlZFUl9IRUFSVEJFQVRfRkFJTEVELFxuICAgIGV4cG9ydHMuQ09NTUFORF9TVEFSVEVELFxuICAgIGV4cG9ydHMuQ09NTUFORF9TVUNDRUVERUQsXG4gICAgZXhwb3J0cy5DT01NQU5EX0ZBSUxFRCxcbiAgICAuLi5leHBvcnRzLkNNQVBfRVZFTlRTXG5dKTtcbi8qKlxuICogQWxsIGV2ZW50cyB3ZSBsaXN0ZW4gdG8gZnJvbSBgU2VydmVyYCBpbnN0YW5jZXMsIGJ1dCBkbyBub3QgZm9yd2FyZCB0byB0aGUgY2xpZW50XG4gKiBAaW50ZXJuYWxcbiAqL1xuZXhwb3J0cy5MT0NBTF9TRVJWRVJfRVZFTlRTID0gT2JqZWN0LmZyZWV6ZShbXG4gICAgZXhwb3J0cy5DT05ORUNULFxuICAgIGV4cG9ydHMuREVTQ1JJUFRJT05fUkVDRUlWRUQsXG4gICAgZXhwb3J0cy5DTE9TRUQsXG4gICAgZXhwb3J0cy5FTkRFRFxuXSk7XG4vKiogQHB1YmxpYyAqL1xuZXhwb3J0cy5NT05HT19DTElFTlRfRVZFTlRTID0gT2JqZWN0LmZyZWV6ZShbXG4gICAgLi4uZXhwb3J0cy5DTUFQX0VWRU5UUyxcbiAgICAuLi5leHBvcnRzLkFQTV9FVkVOVFMsXG4gICAgLi4uZXhwb3J0cy5UT1BPTE9HWV9FVkVOVFMsXG4gICAgLi4uZXhwb3J0cy5IRUFSVEJFQVRfRVZFTlRTXG5dKTtcbi8qKlxuICogQGludGVybmFsXG4gKiBUaGUgbGVnYWN5IGhlbGxvIGNvbW1hbmQgdGhhdCB3YXMgZGVwcmVjYXRlZCBpbiBNb25nb0RCIDUuMC5cbiAqL1xuZXhwb3J0cy5MRUdBQ1lfSEVMTE9fQ09NTUFORCA9ICdpc21hc3Rlcic7XG4vKipcbiAqIEBpbnRlcm5hbFxuICogVGhlIGxlZ2FjeSBoZWxsbyBjb21tYW5kIHRoYXQgd2FzIGRlcHJlY2F0ZWQgaW4gTW9uZ29EQiA1LjAuXG4gKi9cbmV4cG9ydHMuTEVHQUNZX0hFTExPX0NPTU1BTkRfQ0FNRUxfQ0FTRSA9ICdpc01hc3Rlcic7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1jb25zdGFudHMuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/constants.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/cursor/abstract_cursor.js":
/*!********************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/cursor/abstract_cursor.js ***!
  \********************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.assertUninitialized = exports.AbstractCursor = exports.CURSOR_FLAGS = void 0;\nconst stream_1 = __webpack_require__(/*! stream */ \"stream\");\nconst util_1 = __webpack_require__(/*! util */ \"util\");\nconst bson_1 = __webpack_require__(/*! ../bson */ \"(api)/../server/node_modules/mongodb/lib/bson.js\");\nconst error_1 = __webpack_require__(/*! ../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst mongo_types_1 = __webpack_require__(/*! ../mongo_types */ \"(api)/../server/node_modules/mongodb/lib/mongo_types.js\");\nconst execute_operation_1 = __webpack_require__(/*! ../operations/execute_operation */ \"(api)/../server/node_modules/mongodb/lib/operations/execute_operation.js\");\nconst get_more_1 = __webpack_require__(/*! ../operations/get_more */ \"(api)/../server/node_modules/mongodb/lib/operations/get_more.js\");\nconst kill_cursors_1 = __webpack_require__(/*! ../operations/kill_cursors */ \"(api)/../server/node_modules/mongodb/lib/operations/kill_cursors.js\");\nconst read_concern_1 = __webpack_require__(/*! ../read_concern */ \"(api)/../server/node_modules/mongodb/lib/read_concern.js\");\nconst read_preference_1 = __webpack_require__(/*! ../read_preference */ \"(api)/../server/node_modules/mongodb/lib/read_preference.js\");\nconst sessions_1 = __webpack_require__(/*! ../sessions */ \"(api)/../server/node_modules/mongodb/lib/sessions.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\n/** @internal */\nconst kId = Symbol('id');\n/** @internal */\nconst kDocuments = Symbol('documents');\n/** @internal */\nconst kServer = Symbol('server');\n/** @internal */\nconst kNamespace = Symbol('namespace');\n/** @internal */\nconst kClient = Symbol('client');\n/** @internal */\nconst kSession = Symbol('session');\n/** @internal */\nconst kOptions = Symbol('options');\n/** @internal */\nconst kTransform = Symbol('transform');\n/** @internal */\nconst kInitialized = Symbol('initialized');\n/** @internal */\nconst kClosed = Symbol('closed');\n/** @internal */\nconst kKilled = Symbol('killed');\n/** @internal */\nconst kInit = Symbol('kInit');\n/** @public */\nexports.CURSOR_FLAGS = [\n    'tailable',\n    'oplogReplay',\n    'noCursorTimeout',\n    'awaitData',\n    'exhaust',\n    'partial'\n];\n/** @public */\nclass AbstractCursor extends mongo_types_1.TypedEventEmitter {\n    /** @internal */\n    constructor(client, namespace, options = {}) {\n        super();\n        if (!client.s.isMongoClient) {\n            throw new error_1.MongoRuntimeError('Cursor must be constructed with MongoClient');\n        }\n        this[kClient] = client;\n        this[kNamespace] = namespace;\n        this[kId] = null;\n        this[kDocuments] = new utils_1.List();\n        this[kInitialized] = false;\n        this[kClosed] = false;\n        this[kKilled] = false;\n        this[kOptions] = {\n            readPreference: options.readPreference && options.readPreference instanceof read_preference_1.ReadPreference\n                ? options.readPreference\n                : read_preference_1.ReadPreference.primary,\n            ...(0, bson_1.pluckBSONSerializeOptions)(options)\n        };\n        const readConcern = read_concern_1.ReadConcern.fromOptions(options);\n        if (readConcern) {\n            this[kOptions].readConcern = readConcern;\n        }\n        if (typeof options.batchSize === 'number') {\n            this[kOptions].batchSize = options.batchSize;\n        }\n        // we check for undefined specifically here to allow falsy values\n        // eslint-disable-next-line no-restricted-syntax\n        if (options.comment !== undefined) {\n            this[kOptions].comment = options.comment;\n        }\n        if (typeof options.maxTimeMS === 'number') {\n            this[kOptions].maxTimeMS = options.maxTimeMS;\n        }\n        if (typeof options.maxAwaitTimeMS === 'number') {\n            this[kOptions].maxAwaitTimeMS = options.maxAwaitTimeMS;\n        }\n        if (options.session instanceof sessions_1.ClientSession) {\n            this[kSession] = options.session;\n        }\n        else {\n            this[kSession] = this[kClient].startSession({ owner: this, explicit: false });\n        }\n    }\n    get id() {\n        return this[kId] ?? undefined;\n    }\n    /** @internal */\n    get isDead() {\n        return (this[kId]?.isZero() ?? false) || this[kClosed] || this[kKilled];\n    }\n    /** @internal */\n    get client() {\n        return this[kClient];\n    }\n    /** @internal */\n    get server() {\n        return this[kServer];\n    }\n    get namespace() {\n        return this[kNamespace];\n    }\n    get readPreference() {\n        return this[kOptions].readPreference;\n    }\n    get readConcern() {\n        return this[kOptions].readConcern;\n    }\n    /** @internal */\n    get session() {\n        return this[kSession];\n    }\n    set session(clientSession) {\n        this[kSession] = clientSession;\n    }\n    /** @internal */\n    get cursorOptions() {\n        return this[kOptions];\n    }\n    get closed() {\n        return this[kClosed];\n    }\n    get killed() {\n        return this[kKilled];\n    }\n    get loadBalanced() {\n        return !!this[kClient].topology?.loadBalanced;\n    }\n    /** Returns current buffered documents length */\n    bufferedCount() {\n        return this[kDocuments].length;\n    }\n    /** Returns current buffered documents */\n    readBufferedDocuments(number) {\n        const bufferedDocs = [];\n        const documentsToRead = Math.min(number ?? this[kDocuments].length, this[kDocuments].length);\n        for (let count = 0; count < documentsToRead; count++) {\n            const document = this[kDocuments].shift();\n            if (document != null) {\n                bufferedDocs.push(document);\n            }\n        }\n        return bufferedDocs;\n    }\n    async *[Symbol.asyncIterator]() {\n        if (this.closed) {\n            return;\n        }\n        try {\n            while (true) {\n                const document = await this.next();\n                // Intentional strict null check, because users can map cursors to falsey values.\n                // We allow mapping to all values except for null.\n                // eslint-disable-next-line no-restricted-syntax\n                if (document === null) {\n                    if (!this.closed) {\n                        const message = 'Cursor returned a `null` document, but the cursor is not exhausted.  Mapping documents to `null` is not supported in the cursor transform.';\n                        await cleanupCursorAsync(this, { needsToEmitClosed: true }).catch(() => null);\n                        throw new error_1.MongoAPIError(message);\n                    }\n                    break;\n                }\n                yield document;\n                if (this[kId] === bson_1.Long.ZERO) {\n                    // Cursor exhausted\n                    break;\n                }\n            }\n        }\n        finally {\n            // Only close the cursor if it has not already been closed. This finally clause handles\n            // the case when a user would break out of a for await of loop early.\n            if (!this.closed) {\n                await this.close().catch(() => null);\n            }\n        }\n    }\n    stream(options) {\n        if (options?.transform) {\n            const transform = options.transform;\n            const readable = new ReadableCursorStream(this);\n            return readable.pipe(new stream_1.Transform({\n                objectMode: true,\n                highWaterMark: 1,\n                transform(chunk, _, callback) {\n                    try {\n                        const transformed = transform(chunk);\n                        callback(undefined, transformed);\n                    }\n                    catch (err) {\n                        callback(err);\n                    }\n                }\n            }));\n        }\n        return new ReadableCursorStream(this);\n    }\n    async hasNext() {\n        if (this[kId] === bson_1.Long.ZERO) {\n            return false;\n        }\n        if (this[kDocuments].length !== 0) {\n            return true;\n        }\n        const doc = await next(this, { blocking: true, transform: false });\n        if (doc) {\n            this[kDocuments].unshift(doc);\n            return true;\n        }\n        return false;\n    }\n    /** Get the next available document from the cursor, returns null if no more documents are available. */\n    async next() {\n        if (this[kId] === bson_1.Long.ZERO) {\n            throw new error_1.MongoCursorExhaustedError();\n        }\n        return next(this, { blocking: true, transform: true });\n    }\n    /**\n     * Try to get the next available document from the cursor or `null` if an empty batch is returned\n     */\n    async tryNext() {\n        if (this[kId] === bson_1.Long.ZERO) {\n            throw new error_1.MongoCursorExhaustedError();\n        }\n        return next(this, { blocking: false, transform: true });\n    }\n    /**\n     * Iterates over all the documents for this cursor using the iterator, callback pattern.\n     *\n     * If the iterator returns `false`, iteration will stop.\n     *\n     * @param iterator - The iteration callback.\n     * @deprecated - Will be removed in a future release. Use for await...of instead.\n     */\n    async forEach(iterator) {\n        if (typeof iterator !== 'function') {\n            throw new error_1.MongoInvalidArgumentError('Argument \"iterator\" must be a function');\n        }\n        for await (const document of this) {\n            const result = iterator(document);\n            if (result === false) {\n                break;\n            }\n        }\n    }\n    async close() {\n        const needsToEmitClosed = !this[kClosed];\n        this[kClosed] = true;\n        await cleanupCursorAsync(this, { needsToEmitClosed });\n    }\n    /**\n     * Returns an array of documents. The caller is responsible for making sure that there\n     * is enough memory to store the results. Note that the array only contains partial\n     * results when this cursor had been previously accessed. In that case,\n     * cursor.rewind() can be used to reset the cursor.\n     */\n    async toArray() {\n        const array = [];\n        for await (const document of this) {\n            array.push(document);\n        }\n        return array;\n    }\n    /**\n     * Add a cursor flag to the cursor\n     *\n     * @param flag - The flag to set, must be one of following ['tailable', 'oplogReplay', 'noCursorTimeout', 'awaitData', 'partial' -.\n     * @param value - The flag boolean value.\n     */\n    addCursorFlag(flag, value) {\n        assertUninitialized(this);\n        if (!exports.CURSOR_FLAGS.includes(flag)) {\n            throw new error_1.MongoInvalidArgumentError(`Flag ${flag} is not one of ${exports.CURSOR_FLAGS}`);\n        }\n        if (typeof value !== 'boolean') {\n            throw new error_1.MongoInvalidArgumentError(`Flag ${flag} must be a boolean value`);\n        }\n        this[kOptions][flag] = value;\n        return this;\n    }\n    /**\n     * Map all documents using the provided function\n     * If there is a transform set on the cursor, that will be called first and the result passed to\n     * this function's transform.\n     *\n     * @remarks\n     *\n     * **Note** Cursors use `null` internally to indicate that there are no more documents in the cursor. Providing a mapping\n     * function that maps values to `null` will result in the cursor closing itself before it has finished iterating\n     * all documents.  This will **not** result in a memory leak, just surprising behavior.  For example:\n     *\n     * ```typescript\n     * const cursor = collection.find({});\n     * cursor.map(() => null);\n     *\n     * const documents = await cursor.toArray();\n     * // documents is always [], regardless of how many documents are in the collection.\n     * ```\n     *\n     * Other falsey values are allowed:\n     *\n     * ```typescript\n     * const cursor = collection.find({});\n     * cursor.map(() => '');\n     *\n     * const documents = await cursor.toArray();\n     * // documents is now an array of empty strings\n     * ```\n     *\n     * **Note for Typescript Users:** adding a transform changes the return type of the iteration of this cursor,\n     * it **does not** return a new instance of a cursor. This means when calling map,\n     * you should always assign the result to a new variable in order to get a correctly typed cursor variable.\n     * Take note of the following example:\n     *\n     * @example\n     * ```typescript\n     * const cursor: FindCursor<Document> = coll.find();\n     * const mappedCursor: FindCursor<number> = cursor.map(doc => Object.keys(doc).length);\n     * const keyCounts: number[] = await mappedCursor.toArray(); // cursor.toArray() still returns Document[]\n     * ```\n     * @param transform - The mapping transformation method.\n     */\n    map(transform) {\n        assertUninitialized(this);\n        const oldTransform = this[kTransform]; // TODO(NODE-3283): Improve transform typing\n        if (oldTransform) {\n            this[kTransform] = doc => {\n                return transform(oldTransform(doc));\n            };\n        }\n        else {\n            this[kTransform] = transform;\n        }\n        return this;\n    }\n    /**\n     * Set the ReadPreference for the cursor.\n     *\n     * @param readPreference - The new read preference for the cursor.\n     */\n    withReadPreference(readPreference) {\n        assertUninitialized(this);\n        if (readPreference instanceof read_preference_1.ReadPreference) {\n            this[kOptions].readPreference = readPreference;\n        }\n        else if (typeof readPreference === 'string') {\n            this[kOptions].readPreference = read_preference_1.ReadPreference.fromString(readPreference);\n        }\n        else {\n            throw new error_1.MongoInvalidArgumentError(`Invalid read preference: ${readPreference}`);\n        }\n        return this;\n    }\n    /**\n     * Set the ReadPreference for the cursor.\n     *\n     * @param readPreference - The new read preference for the cursor.\n     */\n    withReadConcern(readConcern) {\n        assertUninitialized(this);\n        const resolvedReadConcern = read_concern_1.ReadConcern.fromOptions({ readConcern });\n        if (resolvedReadConcern) {\n            this[kOptions].readConcern = resolvedReadConcern;\n        }\n        return this;\n    }\n    /**\n     * Set a maxTimeMS on the cursor query, allowing for hard timeout limits on queries (Only supported on MongoDB 2.6 or higher)\n     *\n     * @param value - Number of milliseconds to wait before aborting the query.\n     */\n    maxTimeMS(value) {\n        assertUninitialized(this);\n        if (typeof value !== 'number') {\n            throw new error_1.MongoInvalidArgumentError('Argument for maxTimeMS must be a number');\n        }\n        this[kOptions].maxTimeMS = value;\n        return this;\n    }\n    /**\n     * Set the batch size for the cursor.\n     *\n     * @param value - The number of documents to return per batch. See {@link https://www.mongodb.com/docs/manual/reference/command/find/|find command documentation}.\n     */\n    batchSize(value) {\n        assertUninitialized(this);\n        if (this[kOptions].tailable) {\n            throw new error_1.MongoTailableCursorError('Tailable cursor does not support batchSize');\n        }\n        if (typeof value !== 'number') {\n            throw new error_1.MongoInvalidArgumentError('Operation \"batchSize\" requires an integer');\n        }\n        this[kOptions].batchSize = value;\n        return this;\n    }\n    /**\n     * Rewind this cursor to its uninitialized state. Any options that are present on the cursor will\n     * remain in effect. Iterating this cursor will cause new queries to be sent to the server, even\n     * if the resultant data has already been retrieved by this cursor.\n     */\n    rewind() {\n        if (!this[kInitialized]) {\n            return;\n        }\n        this[kId] = null;\n        this[kDocuments].clear();\n        this[kClosed] = false;\n        this[kKilled] = false;\n        this[kInitialized] = false;\n        const session = this[kSession];\n        if (session) {\n            // We only want to end this session if we created it, and it hasn't ended yet\n            if (session.explicit === false) {\n                if (!session.hasEnded) {\n                    session.endSession().catch(() => null);\n                }\n                this[kSession] = this.client.startSession({ owner: this, explicit: false });\n            }\n        }\n    }\n    /** @internal */\n    _getMore(batchSize, callback) {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        const getMoreOperation = new get_more_1.GetMoreOperation(this[kNamespace], this[kId], this[kServer], {\n            ...this[kOptions],\n            session: this[kSession],\n            batchSize\n        });\n        (0, execute_operation_1.executeOperation)(this[kClient], getMoreOperation, callback);\n    }\n    /**\n     * @internal\n     *\n     * This function is exposed for the unified test runner's createChangeStream\n     * operation.  We cannot refactor to use the abstract _initialize method without\n     * a significant refactor.\n     */\n    [kInit](callback) {\n        this._initialize(this[kSession], (error, state) => {\n            if (state) {\n                const response = state.response;\n                this[kServer] = state.server;\n                if (response.cursor) {\n                    // TODO(NODE-2674): Preserve int64 sent from MongoDB\n                    this[kId] =\n                        typeof response.cursor.id === 'number'\n                            ? bson_1.Long.fromNumber(response.cursor.id)\n                            : typeof response.cursor.id === 'bigint'\n                                ? bson_1.Long.fromBigInt(response.cursor.id)\n                                : response.cursor.id;\n                    if (response.cursor.ns) {\n                        this[kNamespace] = (0, utils_1.ns)(response.cursor.ns);\n                    }\n                    this[kDocuments].pushMany(response.cursor.firstBatch);\n                }\n                // When server responses return without a cursor document, we close this cursor\n                // and return the raw server response. This is often the case for explain commands\n                // for example\n                if (this[kId] == null) {\n                    this[kId] = bson_1.Long.ZERO;\n                    // TODO(NODE-3286): ExecutionResult needs to accept a generic parameter\n                    this[kDocuments].push(state.response);\n                }\n            }\n            // the cursor is now initialized, even if an error occurred or it is dead\n            this[kInitialized] = true;\n            if (error) {\n                return cleanupCursor(this, { error }, () => callback(error, undefined));\n            }\n            if (this.isDead) {\n                return cleanupCursor(this, undefined, () => callback());\n            }\n            callback();\n        });\n    }\n}\n/** @event */\nAbstractCursor.CLOSE = 'close';\nexports.AbstractCursor = AbstractCursor;\n/**\n * @param cursor - the cursor on which to call `next`\n * @param blocking - a boolean indicating whether or not the cursor should `block` until data\n *     is available.  Generally, this flag is set to `false` because if the getMore returns no documents,\n *     the cursor has been exhausted.  In certain scenarios (ChangeStreams, tailable await cursors and\n *     `tryNext`, for example) blocking is necessary because a getMore returning no documents does\n *     not indicate the end of the cursor.\n * @param transform - if true, the cursor's transform function is applied to the result document (if the transform exists)\n * @returns the next document in the cursor, or `null`.  When `blocking` is `true`, a `null` document means\n * the cursor has been exhausted.  Otherwise, it means that there is no document available in the cursor's buffer.\n */\nasync function next(cursor, { blocking, transform }) {\n    if (cursor.closed) {\n        return null;\n    }\n    do {\n        if (cursor[kId] == null) {\n            // All cursors must operate within a session, one must be made implicitly if not explicitly provided\n            await (0, util_1.promisify)(cursor[kInit].bind(cursor))();\n        }\n        if (cursor[kDocuments].length !== 0) {\n            const doc = cursor[kDocuments].shift();\n            if (doc != null && transform && cursor[kTransform]) {\n                try {\n                    return cursor[kTransform](doc);\n                }\n                catch (error) {\n                    // `cleanupCursorAsync` should never throw, but if it does we want to throw the original\n                    // error instead.\n                    await cleanupCursorAsync(cursor, { error, needsToEmitClosed: true }).catch(() => null);\n                    throw error;\n                }\n            }\n            return doc;\n        }\n        if (cursor.isDead) {\n            // if the cursor is dead, we clean it up\n            // cleanupCursorAsync should never throw, but if it does it indicates a bug in the driver\n            // and we should surface the error\n            await cleanupCursorAsync(cursor, {});\n            return null;\n        }\n        // otherwise need to call getMore\n        const batchSize = cursor[kOptions].batchSize || 1000;\n        try {\n            const response = await (0, util_1.promisify)(cursor._getMore.bind(cursor))(batchSize);\n            if (response) {\n                const cursorId = typeof response.cursor.id === 'number'\n                    ? bson_1.Long.fromNumber(response.cursor.id)\n                    : typeof response.cursor.id === 'bigint'\n                        ? bson_1.Long.fromBigInt(response.cursor.id)\n                        : response.cursor.id;\n                cursor[kDocuments].pushMany(response.cursor.nextBatch);\n                cursor[kId] = cursorId;\n            }\n        }\n        catch (error) {\n            // `cleanupCursorAsync` should never throw, but if it does we want to throw the original\n            // error instead.\n            await cleanupCursorAsync(cursor, { error }).catch(() => null);\n            throw error;\n        }\n        if (cursor.isDead) {\n            // If we successfully received a response from a cursor BUT the cursor indicates that it is exhausted,\n            // we intentionally clean up the cursor to release its session back into the pool before the cursor\n            // is iterated.  This prevents a cursor that is exhausted on the server from holding\n            // onto a session indefinitely until the AbstractCursor is iterated.\n            //\n            // cleanupCursorAsync should never throw, but if it does it indicates a bug in the driver\n            // and we should surface the error\n            await cleanupCursorAsync(cursor, {});\n        }\n        if (cursor[kDocuments].length === 0 && blocking === false) {\n            return null;\n        }\n    } while (!cursor.isDead || cursor[kDocuments].length !== 0);\n    return null;\n}\nconst cleanupCursorAsync = (0, util_1.promisify)(cleanupCursor);\nfunction cleanupCursor(cursor, options, callback) {\n    const cursorId = cursor[kId];\n    const cursorNs = cursor[kNamespace];\n    const server = cursor[kServer];\n    const session = cursor[kSession];\n    const error = options?.error;\n    // Cursors only emit closed events once the client-side cursor has been exhausted fully or there\n    // was an error.  Notably, when the server returns a cursor id of 0 and a non-empty batch, we\n    // cleanup the cursor but don't emit a `close` event.\n    const needsToEmitClosed = options?.needsToEmitClosed ?? cursor[kDocuments].length === 0;\n    if (error) {\n        if (cursor.loadBalanced && error instanceof error_1.MongoNetworkError) {\n            return completeCleanup();\n        }\n    }\n    if (cursorId == null || server == null || cursorId.isZero() || cursorNs == null) {\n        if (needsToEmitClosed) {\n            cursor[kClosed] = true;\n            cursor[kId] = bson_1.Long.ZERO;\n            cursor.emit(AbstractCursor.CLOSE);\n        }\n        if (session) {\n            if (session.owner === cursor) {\n                session.endSession({ error }).finally(() => {\n                    callback();\n                });\n                return;\n            }\n            if (!session.inTransaction()) {\n                (0, sessions_1.maybeClearPinnedConnection)(session, { error });\n            }\n        }\n        return callback();\n    }\n    function completeCleanup() {\n        if (session) {\n            if (session.owner === cursor) {\n                session.endSession({ error }).finally(() => {\n                    cursor.emit(AbstractCursor.CLOSE);\n                    callback();\n                });\n                return;\n            }\n            if (!session.inTransaction()) {\n                (0, sessions_1.maybeClearPinnedConnection)(session, { error });\n            }\n        }\n        cursor.emit(AbstractCursor.CLOSE);\n        return callback();\n    }\n    cursor[kKilled] = true;\n    if (session.hasEnded) {\n        return completeCleanup();\n    }\n    (0, execute_operation_1.executeOperation)(cursor[kClient], new kill_cursors_1.KillCursorsOperation(cursorId, cursorNs, server, { session }))\n        .catch(() => null)\n        .finally(completeCleanup);\n}\n/** @internal */\nfunction assertUninitialized(cursor) {\n    if (cursor[kInitialized]) {\n        throw new error_1.MongoCursorInUseError();\n    }\n}\nexports.assertUninitialized = assertUninitialized;\nclass ReadableCursorStream extends stream_1.Readable {\n    constructor(cursor) {\n        super({\n            objectMode: true,\n            autoDestroy: false,\n            highWaterMark: 1\n        });\n        this._readInProgress = false;\n        this._cursor = cursor;\n    }\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    _read(size) {\n        if (!this._readInProgress) {\n            this._readInProgress = true;\n            this._readNext();\n        }\n    }\n    _destroy(error, callback) {\n        this._cursor.close().then(() => callback(error), closeError => callback(closeError));\n    }\n    _readNext() {\n        next(this._cursor, { blocking: true, transform: true }).then(result => {\n            if (result == null) {\n                this.push(null);\n            }\n            else if (this.destroyed) {\n                this._cursor.close().catch(() => null);\n            }\n            else {\n                if (this.push(result)) {\n                    return this._readNext();\n                }\n                this._readInProgress = false;\n            }\n        }, err => {\n            // NOTE: This is questionable, but we have a test backing the behavior. It seems the\n            //       desired behavior is that a stream ends cleanly when a user explicitly closes\n            //       a client during iteration. Alternatively, we could do the \"right\" thing and\n            //       propagate the error message by removing this special case.\n            if (err.message.match(/server is closed/)) {\n                this._cursor.close().catch(() => null);\n                return this.push(null);\n            }\n            // NOTE: This is also perhaps questionable. The rationale here is that these errors tend\n            //       to be \"operation was interrupted\", where a cursor has been closed but there is an\n            //       active getMore in-flight. This used to check if the cursor was killed but once\n            //       that changed to happen in cleanup legitimate errors would not destroy the\n            //       stream. There are change streams test specifically test these cases.\n            if (err.message.match(/operation was interrupted/)) {\n                return this.push(null);\n            }\n            // NOTE: The two above checks on the message of the error will cause a null to be pushed\n            //       to the stream, thus closing the stream before the destroy call happens. This means\n            //       that either of those error messages on a change stream will not get a proper\n            //       'error' event to be emitted (the error passed to destroy). Change stream resumability\n            //       relies on that error event to be emitted to create its new cursor and thus was not\n            //       working on 4.4 servers because the error emitted on failover was \"interrupted at\n            //       shutdown\" while on 5.0+ it is \"The server is in quiesce mode and will shut down\".\n            //       See NODE-4475.\n            return this.destroy(err);\n        });\n    }\n}\n//# sourceMappingURL=abstract_cursor.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jdXJzb3IvYWJzdHJhY3RfY3Vyc29yLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELDJCQUEyQixHQUFHLHNCQUFzQixHQUFHLG9CQUFvQjtBQUMzRSxpQkFBaUIsbUJBQU8sQ0FBQyxzQkFBUTtBQUNqQyxlQUFlLG1CQUFPLENBQUMsa0JBQU07QUFDN0IsZUFBZSxtQkFBTyxDQUFDLGlFQUFTO0FBQ2hDLGdCQUFnQixtQkFBTyxDQUFDLG1FQUFVO0FBQ2xDLHNCQUFzQixtQkFBTyxDQUFDLCtFQUFnQjtBQUM5Qyw0QkFBNEIsbUJBQU8sQ0FBQyxpSEFBaUM7QUFDckUsbUJBQW1CLG1CQUFPLENBQUMsK0ZBQXdCO0FBQ25ELHVCQUF1QixtQkFBTyxDQUFDLHVHQUE0QjtBQUMzRCx1QkFBdUIsbUJBQU8sQ0FBQyxpRkFBaUI7QUFDaEQsMEJBQTBCLG1CQUFPLENBQUMsdUZBQW9CO0FBQ3RELG1CQUFtQixtQkFBTyxDQUFDLHlFQUFhO0FBQ3hDLGdCQUFnQixtQkFBTyxDQUFDLG1FQUFVO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CO0FBQ3BCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0NBQStDO0FBQy9DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBEQUEwRCw4QkFBOEI7QUFDeEY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLHlCQUF5QjtBQUNyRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseURBQXlELHlCQUF5QjtBQUNsRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUNBQXVDLGtDQUFrQztBQUN6RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLGlDQUFpQztBQUM3RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLGtDQUFrQztBQUM5RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUNBQXlDLG1CQUFtQjtBQUM1RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0VBQWdFLE1BQU0sZ0JBQWdCLHFCQUFxQjtBQUMzRztBQUNBO0FBQ0EsZ0VBQWdFLE1BQU07QUFDdEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3Q0FBd0M7QUFDeEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0NBQXdDO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlFQUFpRTtBQUNqRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0NBQStDO0FBQy9DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9GQUFvRixlQUFlO0FBQ25HO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkVBQTZFLGFBQWE7QUFDMUY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0VBQXdFLDZGQUE2RjtBQUNySztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0REFBNEQsOEJBQThCO0FBQzFGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZDQUE2QyxPQUFPO0FBQ3BEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0I7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhCQUE4QixxQkFBcUI7QUFDbkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVEQUF1RCxnQ0FBZ0M7QUFDdkY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0NBQStDO0FBQy9DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0NBQStDLE9BQU87QUFDdEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQ0FBK0M7QUFDL0M7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFDQUFxQyxPQUFPO0FBQzVDO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBLHNFQUFzRSxPQUFPO0FBQzdFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUNBQXFDLE9BQU87QUFDNUM7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQSxzRUFBc0UsT0FBTztBQUM3RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxSUFBcUksU0FBUztBQUM5STtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkI7QUFDM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkIsaUNBQWlDO0FBQzlEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIkQ6XFxzYWxvbmlcXGFwcHJhaXNhbC1zeXN0ZW1cXHNlcnZlclxcbm9kZV9tb2R1bGVzXFxtb25nb2RiXFxsaWJcXGN1cnNvclxcYWJzdHJhY3RfY3Vyc29yLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5hc3NlcnRVbmluaXRpYWxpemVkID0gZXhwb3J0cy5BYnN0cmFjdEN1cnNvciA9IGV4cG9ydHMuQ1VSU09SX0ZMQUdTID0gdm9pZCAwO1xuY29uc3Qgc3RyZWFtXzEgPSByZXF1aXJlKFwic3RyZWFtXCIpO1xuY29uc3QgdXRpbF8xID0gcmVxdWlyZShcInV0aWxcIik7XG5jb25zdCBic29uXzEgPSByZXF1aXJlKFwiLi4vYnNvblwiKTtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi4vZXJyb3JcIik7XG5jb25zdCBtb25nb190eXBlc18xID0gcmVxdWlyZShcIi4uL21vbmdvX3R5cGVzXCIpO1xuY29uc3QgZXhlY3V0ZV9vcGVyYXRpb25fMSA9IHJlcXVpcmUoXCIuLi9vcGVyYXRpb25zL2V4ZWN1dGVfb3BlcmF0aW9uXCIpO1xuY29uc3QgZ2V0X21vcmVfMSA9IHJlcXVpcmUoXCIuLi9vcGVyYXRpb25zL2dldF9tb3JlXCIpO1xuY29uc3Qga2lsbF9jdXJzb3JzXzEgPSByZXF1aXJlKFwiLi4vb3BlcmF0aW9ucy9raWxsX2N1cnNvcnNcIik7XG5jb25zdCByZWFkX2NvbmNlcm5fMSA9IHJlcXVpcmUoXCIuLi9yZWFkX2NvbmNlcm5cIik7XG5jb25zdCByZWFkX3ByZWZlcmVuY2VfMSA9IHJlcXVpcmUoXCIuLi9yZWFkX3ByZWZlcmVuY2VcIik7XG5jb25zdCBzZXNzaW9uc18xID0gcmVxdWlyZShcIi4uL3Nlc3Npb25zXCIpO1xuY29uc3QgdXRpbHNfMSA9IHJlcXVpcmUoXCIuLi91dGlsc1wiKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNvbnN0IGtJZCA9IFN5bWJvbCgnaWQnKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNvbnN0IGtEb2N1bWVudHMgPSBTeW1ib2woJ2RvY3VtZW50cycpO1xuLyoqIEBpbnRlcm5hbCAqL1xuY29uc3Qga1NlcnZlciA9IFN5bWJvbCgnc2VydmVyJyk7XG4vKiogQGludGVybmFsICovXG5jb25zdCBrTmFtZXNwYWNlID0gU3ltYm9sKCduYW1lc3BhY2UnKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNvbnN0IGtDbGllbnQgPSBTeW1ib2woJ2NsaWVudCcpO1xuLyoqIEBpbnRlcm5hbCAqL1xuY29uc3Qga1Nlc3Npb24gPSBTeW1ib2woJ3Nlc3Npb24nKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNvbnN0IGtPcHRpb25zID0gU3ltYm9sKCdvcHRpb25zJyk7XG4vKiogQGludGVybmFsICovXG5jb25zdCBrVHJhbnNmb3JtID0gU3ltYm9sKCd0cmFuc2Zvcm0nKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNvbnN0IGtJbml0aWFsaXplZCA9IFN5bWJvbCgnaW5pdGlhbGl6ZWQnKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNvbnN0IGtDbG9zZWQgPSBTeW1ib2woJ2Nsb3NlZCcpO1xuLyoqIEBpbnRlcm5hbCAqL1xuY29uc3Qga0tpbGxlZCA9IFN5bWJvbCgna2lsbGVkJyk7XG4vKiogQGludGVybmFsICovXG5jb25zdCBrSW5pdCA9IFN5bWJvbCgna0luaXQnKTtcbi8qKiBAcHVibGljICovXG5leHBvcnRzLkNVUlNPUl9GTEFHUyA9IFtcbiAgICAndGFpbGFibGUnLFxuICAgICdvcGxvZ1JlcGxheScsXG4gICAgJ25vQ3Vyc29yVGltZW91dCcsXG4gICAgJ2F3YWl0RGF0YScsXG4gICAgJ2V4aGF1c3QnLFxuICAgICdwYXJ0aWFsJ1xuXTtcbi8qKiBAcHVibGljICovXG5jbGFzcyBBYnN0cmFjdEN1cnNvciBleHRlbmRzIG1vbmdvX3R5cGVzXzEuVHlwZWRFdmVudEVtaXR0ZXIge1xuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBjb25zdHJ1Y3RvcihjbGllbnQsIG5hbWVzcGFjZSwgb3B0aW9ucyA9IHt9KSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIGlmICghY2xpZW50LnMuaXNNb25nb0NsaWVudCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29SdW50aW1lRXJyb3IoJ0N1cnNvciBtdXN0IGJlIGNvbnN0cnVjdGVkIHdpdGggTW9uZ29DbGllbnQnKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzW2tDbGllbnRdID0gY2xpZW50O1xuICAgICAgICB0aGlzW2tOYW1lc3BhY2VdID0gbmFtZXNwYWNlO1xuICAgICAgICB0aGlzW2tJZF0gPSBudWxsO1xuICAgICAgICB0aGlzW2tEb2N1bWVudHNdID0gbmV3IHV0aWxzXzEuTGlzdCgpO1xuICAgICAgICB0aGlzW2tJbml0aWFsaXplZF0gPSBmYWxzZTtcbiAgICAgICAgdGhpc1trQ2xvc2VkXSA9IGZhbHNlO1xuICAgICAgICB0aGlzW2tLaWxsZWRdID0gZmFsc2U7XG4gICAgICAgIHRoaXNba09wdGlvbnNdID0ge1xuICAgICAgICAgICAgcmVhZFByZWZlcmVuY2U6IG9wdGlvbnMucmVhZFByZWZlcmVuY2UgJiYgb3B0aW9ucy5yZWFkUHJlZmVyZW5jZSBpbnN0YW5jZW9mIHJlYWRfcHJlZmVyZW5jZV8xLlJlYWRQcmVmZXJlbmNlXG4gICAgICAgICAgICAgICAgPyBvcHRpb25zLnJlYWRQcmVmZXJlbmNlXG4gICAgICAgICAgICAgICAgOiByZWFkX3ByZWZlcmVuY2VfMS5SZWFkUHJlZmVyZW5jZS5wcmltYXJ5LFxuICAgICAgICAgICAgLi4uKDAsIGJzb25fMS5wbHVja0JTT05TZXJpYWxpemVPcHRpb25zKShvcHRpb25zKVxuICAgICAgICB9O1xuICAgICAgICBjb25zdCByZWFkQ29uY2VybiA9IHJlYWRfY29uY2Vybl8xLlJlYWRDb25jZXJuLmZyb21PcHRpb25zKG9wdGlvbnMpO1xuICAgICAgICBpZiAocmVhZENvbmNlcm4pIHtcbiAgICAgICAgICAgIHRoaXNba09wdGlvbnNdLnJlYWRDb25jZXJuID0gcmVhZENvbmNlcm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLmJhdGNoU2l6ZSA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgIHRoaXNba09wdGlvbnNdLmJhdGNoU2l6ZSA9IG9wdGlvbnMuYmF0Y2hTaXplO1xuICAgICAgICB9XG4gICAgICAgIC8vIHdlIGNoZWNrIGZvciB1bmRlZmluZWQgc3BlY2lmaWNhbGx5IGhlcmUgdG8gYWxsb3cgZmFsc3kgdmFsdWVzXG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1yZXN0cmljdGVkLXN5bnRheFxuICAgICAgICBpZiAob3B0aW9ucy5jb21tZW50ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXNba09wdGlvbnNdLmNvbW1lbnQgPSBvcHRpb25zLmNvbW1lbnQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLm1heFRpbWVNUyA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgIHRoaXNba09wdGlvbnNdLm1heFRpbWVNUyA9IG9wdGlvbnMubWF4VGltZU1TO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5tYXhBd2FpdFRpbWVNUyA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgIHRoaXNba09wdGlvbnNdLm1heEF3YWl0VGltZU1TID0gb3B0aW9ucy5tYXhBd2FpdFRpbWVNUztcbiAgICAgICAgfVxuICAgICAgICBpZiAob3B0aW9ucy5zZXNzaW9uIGluc3RhbmNlb2Ygc2Vzc2lvbnNfMS5DbGllbnRTZXNzaW9uKSB7XG4gICAgICAgICAgICB0aGlzW2tTZXNzaW9uXSA9IG9wdGlvbnMuc2Vzc2lvbjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXNba1Nlc3Npb25dID0gdGhpc1trQ2xpZW50XS5zdGFydFNlc3Npb24oeyBvd25lcjogdGhpcywgZXhwbGljaXQ6IGZhbHNlIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldCBpZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXNba0lkXSA/PyB1bmRlZmluZWQ7XG4gICAgfVxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBnZXQgaXNEZWFkKCkge1xuICAgICAgICByZXR1cm4gKHRoaXNba0lkXT8uaXNaZXJvKCkgPz8gZmFsc2UpIHx8IHRoaXNba0Nsb3NlZF0gfHwgdGhpc1trS2lsbGVkXTtcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGdldCBjbGllbnQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzW2tDbGllbnRdO1xuICAgIH1cbiAgICAvKiogQGludGVybmFsICovXG4gICAgZ2V0IHNlcnZlcigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXNba1NlcnZlcl07XG4gICAgfVxuICAgIGdldCBuYW1lc3BhY2UoKSB7XG4gICAgICAgIHJldHVybiB0aGlzW2tOYW1lc3BhY2VdO1xuICAgIH1cbiAgICBnZXQgcmVhZFByZWZlcmVuY2UoKSB7XG4gICAgICAgIHJldHVybiB0aGlzW2tPcHRpb25zXS5yZWFkUHJlZmVyZW5jZTtcbiAgICB9XG4gICAgZ2V0IHJlYWRDb25jZXJuKCkge1xuICAgICAgICByZXR1cm4gdGhpc1trT3B0aW9uc10ucmVhZENvbmNlcm47XG4gICAgfVxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBnZXQgc2Vzc2lvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXNba1Nlc3Npb25dO1xuICAgIH1cbiAgICBzZXQgc2Vzc2lvbihjbGllbnRTZXNzaW9uKSB7XG4gICAgICAgIHRoaXNba1Nlc3Npb25dID0gY2xpZW50U2Vzc2lvbjtcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGdldCBjdXJzb3JPcHRpb25zKCkge1xuICAgICAgICByZXR1cm4gdGhpc1trT3B0aW9uc107XG4gICAgfVxuICAgIGdldCBjbG9zZWQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzW2tDbG9zZWRdO1xuICAgIH1cbiAgICBnZXQga2lsbGVkKCkge1xuICAgICAgICByZXR1cm4gdGhpc1trS2lsbGVkXTtcbiAgICB9XG4gICAgZ2V0IGxvYWRCYWxhbmNlZCgpIHtcbiAgICAgICAgcmV0dXJuICEhdGhpc1trQ2xpZW50XS50b3BvbG9neT8ubG9hZEJhbGFuY2VkO1xuICAgIH1cbiAgICAvKiogUmV0dXJucyBjdXJyZW50IGJ1ZmZlcmVkIGRvY3VtZW50cyBsZW5ndGggKi9cbiAgICBidWZmZXJlZENvdW50KCkge1xuICAgICAgICByZXR1cm4gdGhpc1trRG9jdW1lbnRzXS5sZW5ndGg7XG4gICAgfVxuICAgIC8qKiBSZXR1cm5zIGN1cnJlbnQgYnVmZmVyZWQgZG9jdW1lbnRzICovXG4gICAgcmVhZEJ1ZmZlcmVkRG9jdW1lbnRzKG51bWJlcikge1xuICAgICAgICBjb25zdCBidWZmZXJlZERvY3MgPSBbXTtcbiAgICAgICAgY29uc3QgZG9jdW1lbnRzVG9SZWFkID0gTWF0aC5taW4obnVtYmVyID8/IHRoaXNba0RvY3VtZW50c10ubGVuZ3RoLCB0aGlzW2tEb2N1bWVudHNdLmxlbmd0aCk7XG4gICAgICAgIGZvciAobGV0IGNvdW50ID0gMDsgY291bnQgPCBkb2N1bWVudHNUb1JlYWQ7IGNvdW50KyspIHtcbiAgICAgICAgICAgIGNvbnN0IGRvY3VtZW50ID0gdGhpc1trRG9jdW1lbnRzXS5zaGlmdCgpO1xuICAgICAgICAgICAgaWYgKGRvY3VtZW50ICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBidWZmZXJlZERvY3MucHVzaChkb2N1bWVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGJ1ZmZlcmVkRG9jcztcbiAgICB9XG4gICAgYXN5bmMgKltTeW1ib2wuYXN5bmNJdGVyYXRvcl0oKSB7XG4gICAgICAgIGlmICh0aGlzLmNsb3NlZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGRvY3VtZW50ID0gYXdhaXQgdGhpcy5uZXh0KCk7XG4gICAgICAgICAgICAgICAgLy8gSW50ZW50aW9uYWwgc3RyaWN0IG51bGwgY2hlY2ssIGJlY2F1c2UgdXNlcnMgY2FuIG1hcCBjdXJzb3JzIHRvIGZhbHNleSB2YWx1ZXMuXG4gICAgICAgICAgICAgICAgLy8gV2UgYWxsb3cgbWFwcGluZyB0byBhbGwgdmFsdWVzIGV4Y2VwdCBmb3IgbnVsbC5cbiAgICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcmVzdHJpY3RlZC1zeW50YXhcbiAgICAgICAgICAgICAgICBpZiAoZG9jdW1lbnQgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmNsb3NlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbWVzc2FnZSA9ICdDdXJzb3IgcmV0dXJuZWQgYSBgbnVsbGAgZG9jdW1lbnQsIGJ1dCB0aGUgY3Vyc29yIGlzIG5vdCBleGhhdXN0ZWQuICBNYXBwaW5nIGRvY3VtZW50cyB0byBgbnVsbGAgaXMgbm90IHN1cHBvcnRlZCBpbiB0aGUgY3Vyc29yIHRyYW5zZm9ybS4nO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgY2xlYW51cEN1cnNvckFzeW5jKHRoaXMsIHsgbmVlZHNUb0VtaXRDbG9zZWQ6IHRydWUgfSkuY2F0Y2goKCkgPT4gbnVsbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0FQSUVycm9yKG1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB5aWVsZCBkb2N1bWVudDtcbiAgICAgICAgICAgICAgICBpZiAodGhpc1trSWRdID09PSBic29uXzEuTG9uZy5aRVJPKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEN1cnNvciBleGhhdXN0ZWRcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGZpbmFsbHkge1xuICAgICAgICAgICAgLy8gT25seSBjbG9zZSB0aGUgY3Vyc29yIGlmIGl0IGhhcyBub3QgYWxyZWFkeSBiZWVuIGNsb3NlZC4gVGhpcyBmaW5hbGx5IGNsYXVzZSBoYW5kbGVzXG4gICAgICAgICAgICAvLyB0aGUgY2FzZSB3aGVuIGEgdXNlciB3b3VsZCBicmVhayBvdXQgb2YgYSBmb3IgYXdhaXQgb2YgbG9vcCBlYXJseS5cbiAgICAgICAgICAgIGlmICghdGhpcy5jbG9zZWQpIHtcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmNsb3NlKCkuY2F0Y2goKCkgPT4gbnVsbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgc3RyZWFtKG9wdGlvbnMpIHtcbiAgICAgICAgaWYgKG9wdGlvbnM/LnRyYW5zZm9ybSkge1xuICAgICAgICAgICAgY29uc3QgdHJhbnNmb3JtID0gb3B0aW9ucy50cmFuc2Zvcm07XG4gICAgICAgICAgICBjb25zdCByZWFkYWJsZSA9IG5ldyBSZWFkYWJsZUN1cnNvclN0cmVhbSh0aGlzKTtcbiAgICAgICAgICAgIHJldHVybiByZWFkYWJsZS5waXBlKG5ldyBzdHJlYW1fMS5UcmFuc2Zvcm0oe1xuICAgICAgICAgICAgICAgIG9iamVjdE1vZGU6IHRydWUsXG4gICAgICAgICAgICAgICAgaGlnaFdhdGVyTWFyazogMSxcbiAgICAgICAgICAgICAgICB0cmFuc2Zvcm0oY2h1bmssIF8sIGNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0cmFuc2Zvcm1lZCA9IHRyYW5zZm9ybShjaHVuayk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayh1bmRlZmluZWQsIHRyYW5zZm9ybWVkKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgUmVhZGFibGVDdXJzb3JTdHJlYW0odGhpcyk7XG4gICAgfVxuICAgIGFzeW5jIGhhc05leHQoKSB7XG4gICAgICAgIGlmICh0aGlzW2tJZF0gPT09IGJzb25fMS5Mb25nLlpFUk8pIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpc1trRG9jdW1lbnRzXS5sZW5ndGggIT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGRvYyA9IGF3YWl0IG5leHQodGhpcywgeyBibG9ja2luZzogdHJ1ZSwgdHJhbnNmb3JtOiBmYWxzZSB9KTtcbiAgICAgICAgaWYgKGRvYykge1xuICAgICAgICAgICAgdGhpc1trRG9jdW1lbnRzXS51bnNoaWZ0KGRvYyk7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIC8qKiBHZXQgdGhlIG5leHQgYXZhaWxhYmxlIGRvY3VtZW50IGZyb20gdGhlIGN1cnNvciwgcmV0dXJucyBudWxsIGlmIG5vIG1vcmUgZG9jdW1lbnRzIGFyZSBhdmFpbGFibGUuICovXG4gICAgYXN5bmMgbmV4dCgpIHtcbiAgICAgICAgaWYgKHRoaXNba0lkXSA9PT0gYnNvbl8xLkxvbmcuWkVSTykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29DdXJzb3JFeGhhdXN0ZWRFcnJvcigpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXh0KHRoaXMsIHsgYmxvY2tpbmc6IHRydWUsIHRyYW5zZm9ybTogdHJ1ZSB9KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVHJ5IHRvIGdldCB0aGUgbmV4dCBhdmFpbGFibGUgZG9jdW1lbnQgZnJvbSB0aGUgY3Vyc29yIG9yIGBudWxsYCBpZiBhbiBlbXB0eSBiYXRjaCBpcyByZXR1cm5lZFxuICAgICAqL1xuICAgIGFzeW5jIHRyeU5leHQoKSB7XG4gICAgICAgIGlmICh0aGlzW2tJZF0gPT09IGJzb25fMS5Mb25nLlpFUk8pIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvQ3Vyc29yRXhoYXVzdGVkRXJyb3IoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV4dCh0aGlzLCB7IGJsb2NraW5nOiBmYWxzZSwgdHJhbnNmb3JtOiB0cnVlIH0pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBJdGVyYXRlcyBvdmVyIGFsbCB0aGUgZG9jdW1lbnRzIGZvciB0aGlzIGN1cnNvciB1c2luZyB0aGUgaXRlcmF0b3IsIGNhbGxiYWNrIHBhdHRlcm4uXG4gICAgICpcbiAgICAgKiBJZiB0aGUgaXRlcmF0b3IgcmV0dXJucyBgZmFsc2VgLCBpdGVyYXRpb24gd2lsbCBzdG9wLlxuICAgICAqXG4gICAgICogQHBhcmFtIGl0ZXJhdG9yIC0gVGhlIGl0ZXJhdGlvbiBjYWxsYmFjay5cbiAgICAgKiBAZGVwcmVjYXRlZCAtIFdpbGwgYmUgcmVtb3ZlZCBpbiBhIGZ1dHVyZSByZWxlYXNlLiBVc2UgZm9yIGF3YWl0Li4ub2YgaW5zdGVhZC5cbiAgICAgKi9cbiAgICBhc3luYyBmb3JFYWNoKGl0ZXJhdG9yKSB7XG4gICAgICAgIGlmICh0eXBlb2YgaXRlcmF0b3IgIT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoJ0FyZ3VtZW50IFwiaXRlcmF0b3JcIiBtdXN0IGJlIGEgZnVuY3Rpb24nKTtcbiAgICAgICAgfVxuICAgICAgICBmb3IgYXdhaXQgKGNvbnN0IGRvY3VtZW50IG9mIHRoaXMpIHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGl0ZXJhdG9yKGRvY3VtZW50KTtcbiAgICAgICAgICAgIGlmIChyZXN1bHQgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgYXN5bmMgY2xvc2UoKSB7XG4gICAgICAgIGNvbnN0IG5lZWRzVG9FbWl0Q2xvc2VkID0gIXRoaXNba0Nsb3NlZF07XG4gICAgICAgIHRoaXNba0Nsb3NlZF0gPSB0cnVlO1xuICAgICAgICBhd2FpdCBjbGVhbnVwQ3Vyc29yQXN5bmModGhpcywgeyBuZWVkc1RvRW1pdENsb3NlZCB9KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhbiBhcnJheSBvZiBkb2N1bWVudHMuIFRoZSBjYWxsZXIgaXMgcmVzcG9uc2libGUgZm9yIG1ha2luZyBzdXJlIHRoYXQgdGhlcmVcbiAgICAgKiBpcyBlbm91Z2ggbWVtb3J5IHRvIHN0b3JlIHRoZSByZXN1bHRzLiBOb3RlIHRoYXQgdGhlIGFycmF5IG9ubHkgY29udGFpbnMgcGFydGlhbFxuICAgICAqIHJlc3VsdHMgd2hlbiB0aGlzIGN1cnNvciBoYWQgYmVlbiBwcmV2aW91c2x5IGFjY2Vzc2VkLiBJbiB0aGF0IGNhc2UsXG4gICAgICogY3Vyc29yLnJld2luZCgpIGNhbiBiZSB1c2VkIHRvIHJlc2V0IHRoZSBjdXJzb3IuXG4gICAgICovXG4gICAgYXN5bmMgdG9BcnJheSgpIHtcbiAgICAgICAgY29uc3QgYXJyYXkgPSBbXTtcbiAgICAgICAgZm9yIGF3YWl0IChjb25zdCBkb2N1bWVudCBvZiB0aGlzKSB7XG4gICAgICAgICAgICBhcnJheS5wdXNoKGRvY3VtZW50KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYXJyYXk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEFkZCBhIGN1cnNvciBmbGFnIHRvIHRoZSBjdXJzb3JcbiAgICAgKlxuICAgICAqIEBwYXJhbSBmbGFnIC0gVGhlIGZsYWcgdG8gc2V0LCBtdXN0IGJlIG9uZSBvZiBmb2xsb3dpbmcgWyd0YWlsYWJsZScsICdvcGxvZ1JlcGxheScsICdub0N1cnNvclRpbWVvdXQnLCAnYXdhaXREYXRhJywgJ3BhcnRpYWwnIC0uXG4gICAgICogQHBhcmFtIHZhbHVlIC0gVGhlIGZsYWcgYm9vbGVhbiB2YWx1ZS5cbiAgICAgKi9cbiAgICBhZGRDdXJzb3JGbGFnKGZsYWcsIHZhbHVlKSB7XG4gICAgICAgIGFzc2VydFVuaW5pdGlhbGl6ZWQodGhpcyk7XG4gICAgICAgIGlmICghZXhwb3J0cy5DVVJTT1JfRkxBR1MuaW5jbHVkZXMoZmxhZykpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoYEZsYWcgJHtmbGFnfSBpcyBub3Qgb25lIG9mICR7ZXhwb3J0cy5DVVJTT1JfRkxBR1N9YCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKGBGbGFnICR7ZmxhZ30gbXVzdCBiZSBhIGJvb2xlYW4gdmFsdWVgKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzW2tPcHRpb25zXVtmbGFnXSA9IHZhbHVlO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgLyoqXG4gICAgICogTWFwIGFsbCBkb2N1bWVudHMgdXNpbmcgdGhlIHByb3ZpZGVkIGZ1bmN0aW9uXG4gICAgICogSWYgdGhlcmUgaXMgYSB0cmFuc2Zvcm0gc2V0IG9uIHRoZSBjdXJzb3IsIHRoYXQgd2lsbCBiZSBjYWxsZWQgZmlyc3QgYW5kIHRoZSByZXN1bHQgcGFzc2VkIHRvXG4gICAgICogdGhpcyBmdW5jdGlvbidzIHRyYW5zZm9ybS5cbiAgICAgKlxuICAgICAqIEByZW1hcmtzXG4gICAgICpcbiAgICAgKiAqKk5vdGUqKiBDdXJzb3JzIHVzZSBgbnVsbGAgaW50ZXJuYWxseSB0byBpbmRpY2F0ZSB0aGF0IHRoZXJlIGFyZSBubyBtb3JlIGRvY3VtZW50cyBpbiB0aGUgY3Vyc29yLiBQcm92aWRpbmcgYSBtYXBwaW5nXG4gICAgICogZnVuY3Rpb24gdGhhdCBtYXBzIHZhbHVlcyB0byBgbnVsbGAgd2lsbCByZXN1bHQgaW4gdGhlIGN1cnNvciBjbG9zaW5nIGl0c2VsZiBiZWZvcmUgaXQgaGFzIGZpbmlzaGVkIGl0ZXJhdGluZ1xuICAgICAqIGFsbCBkb2N1bWVudHMuICBUaGlzIHdpbGwgKipub3QqKiByZXN1bHQgaW4gYSBtZW1vcnkgbGVhaywganVzdCBzdXJwcmlzaW5nIGJlaGF2aW9yLiAgRm9yIGV4YW1wbGU6XG4gICAgICpcbiAgICAgKiBgYGB0eXBlc2NyaXB0XG4gICAgICogY29uc3QgY3Vyc29yID0gY29sbGVjdGlvbi5maW5kKHt9KTtcbiAgICAgKiBjdXJzb3IubWFwKCgpID0+IG51bGwpO1xuICAgICAqXG4gICAgICogY29uc3QgZG9jdW1lbnRzID0gYXdhaXQgY3Vyc29yLnRvQXJyYXkoKTtcbiAgICAgKiAvLyBkb2N1bWVudHMgaXMgYWx3YXlzIFtdLCByZWdhcmRsZXNzIG9mIGhvdyBtYW55IGRvY3VtZW50cyBhcmUgaW4gdGhlIGNvbGxlY3Rpb24uXG4gICAgICogYGBgXG4gICAgICpcbiAgICAgKiBPdGhlciBmYWxzZXkgdmFsdWVzIGFyZSBhbGxvd2VkOlxuICAgICAqXG4gICAgICogYGBgdHlwZXNjcmlwdFxuICAgICAqIGNvbnN0IGN1cnNvciA9IGNvbGxlY3Rpb24uZmluZCh7fSk7XG4gICAgICogY3Vyc29yLm1hcCgoKSA9PiAnJyk7XG4gICAgICpcbiAgICAgKiBjb25zdCBkb2N1bWVudHMgPSBhd2FpdCBjdXJzb3IudG9BcnJheSgpO1xuICAgICAqIC8vIGRvY3VtZW50cyBpcyBub3cgYW4gYXJyYXkgb2YgZW1wdHkgc3RyaW5nc1xuICAgICAqIGBgYFxuICAgICAqXG4gICAgICogKipOb3RlIGZvciBUeXBlc2NyaXB0IFVzZXJzOioqIGFkZGluZyBhIHRyYW5zZm9ybSBjaGFuZ2VzIHRoZSByZXR1cm4gdHlwZSBvZiB0aGUgaXRlcmF0aW9uIG9mIHRoaXMgY3Vyc29yLFxuICAgICAqIGl0ICoqZG9lcyBub3QqKiByZXR1cm4gYSBuZXcgaW5zdGFuY2Ugb2YgYSBjdXJzb3IuIFRoaXMgbWVhbnMgd2hlbiBjYWxsaW5nIG1hcCxcbiAgICAgKiB5b3Ugc2hvdWxkIGFsd2F5cyBhc3NpZ24gdGhlIHJlc3VsdCB0byBhIG5ldyB2YXJpYWJsZSBpbiBvcmRlciB0byBnZXQgYSBjb3JyZWN0bHkgdHlwZWQgY3Vyc29yIHZhcmlhYmxlLlxuICAgICAqIFRha2Ugbm90ZSBvZiB0aGUgZm9sbG93aW5nIGV4YW1wbGU6XG4gICAgICpcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIGBgYHR5cGVzY3JpcHRcbiAgICAgKiBjb25zdCBjdXJzb3I6IEZpbmRDdXJzb3I8RG9jdW1lbnQ+ID0gY29sbC5maW5kKCk7XG4gICAgICogY29uc3QgbWFwcGVkQ3Vyc29yOiBGaW5kQ3Vyc29yPG51bWJlcj4gPSBjdXJzb3IubWFwKGRvYyA9PiBPYmplY3Qua2V5cyhkb2MpLmxlbmd0aCk7XG4gICAgICogY29uc3Qga2V5Q291bnRzOiBudW1iZXJbXSA9IGF3YWl0IG1hcHBlZEN1cnNvci50b0FycmF5KCk7IC8vIGN1cnNvci50b0FycmF5KCkgc3RpbGwgcmV0dXJucyBEb2N1bWVudFtdXG4gICAgICogYGBgXG4gICAgICogQHBhcmFtIHRyYW5zZm9ybSAtIFRoZSBtYXBwaW5nIHRyYW5zZm9ybWF0aW9uIG1ldGhvZC5cbiAgICAgKi9cbiAgICBtYXAodHJhbnNmb3JtKSB7XG4gICAgICAgIGFzc2VydFVuaW5pdGlhbGl6ZWQodGhpcyk7XG4gICAgICAgIGNvbnN0IG9sZFRyYW5zZm9ybSA9IHRoaXNba1RyYW5zZm9ybV07IC8vIFRPRE8oTk9ERS0zMjgzKTogSW1wcm92ZSB0cmFuc2Zvcm0gdHlwaW5nXG4gICAgICAgIGlmIChvbGRUcmFuc2Zvcm0pIHtcbiAgICAgICAgICAgIHRoaXNba1RyYW5zZm9ybV0gPSBkb2MgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cmFuc2Zvcm0ob2xkVHJhbnNmb3JtKGRvYykpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXNba1RyYW5zZm9ybV0gPSB0cmFuc2Zvcm07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNldCB0aGUgUmVhZFByZWZlcmVuY2UgZm9yIHRoZSBjdXJzb3IuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gcmVhZFByZWZlcmVuY2UgLSBUaGUgbmV3IHJlYWQgcHJlZmVyZW5jZSBmb3IgdGhlIGN1cnNvci5cbiAgICAgKi9cbiAgICB3aXRoUmVhZFByZWZlcmVuY2UocmVhZFByZWZlcmVuY2UpIHtcbiAgICAgICAgYXNzZXJ0VW5pbml0aWFsaXplZCh0aGlzKTtcbiAgICAgICAgaWYgKHJlYWRQcmVmZXJlbmNlIGluc3RhbmNlb2YgcmVhZF9wcmVmZXJlbmNlXzEuUmVhZFByZWZlcmVuY2UpIHtcbiAgICAgICAgICAgIHRoaXNba09wdGlvbnNdLnJlYWRQcmVmZXJlbmNlID0gcmVhZFByZWZlcmVuY2U7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodHlwZW9mIHJlYWRQcmVmZXJlbmNlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgdGhpc1trT3B0aW9uc10ucmVhZFByZWZlcmVuY2UgPSByZWFkX3ByZWZlcmVuY2VfMS5SZWFkUHJlZmVyZW5jZS5mcm9tU3RyaW5nKHJlYWRQcmVmZXJlbmNlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoYEludmFsaWQgcmVhZCBwcmVmZXJlbmNlOiAke3JlYWRQcmVmZXJlbmNlfWApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTZXQgdGhlIFJlYWRQcmVmZXJlbmNlIGZvciB0aGUgY3Vyc29yLlxuICAgICAqXG4gICAgICogQHBhcmFtIHJlYWRQcmVmZXJlbmNlIC0gVGhlIG5ldyByZWFkIHByZWZlcmVuY2UgZm9yIHRoZSBjdXJzb3IuXG4gICAgICovXG4gICAgd2l0aFJlYWRDb25jZXJuKHJlYWRDb25jZXJuKSB7XG4gICAgICAgIGFzc2VydFVuaW5pdGlhbGl6ZWQodGhpcyk7XG4gICAgICAgIGNvbnN0IHJlc29sdmVkUmVhZENvbmNlcm4gPSByZWFkX2NvbmNlcm5fMS5SZWFkQ29uY2Vybi5mcm9tT3B0aW9ucyh7IHJlYWRDb25jZXJuIH0pO1xuICAgICAgICBpZiAocmVzb2x2ZWRSZWFkQ29uY2Vybikge1xuICAgICAgICAgICAgdGhpc1trT3B0aW9uc10ucmVhZENvbmNlcm4gPSByZXNvbHZlZFJlYWRDb25jZXJuO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTZXQgYSBtYXhUaW1lTVMgb24gdGhlIGN1cnNvciBxdWVyeSwgYWxsb3dpbmcgZm9yIGhhcmQgdGltZW91dCBsaW1pdHMgb24gcXVlcmllcyAoT25seSBzdXBwb3J0ZWQgb24gTW9uZ29EQiAyLjYgb3IgaGlnaGVyKVxuICAgICAqXG4gICAgICogQHBhcmFtIHZhbHVlIC0gTnVtYmVyIG9mIG1pbGxpc2Vjb25kcyB0byB3YWl0IGJlZm9yZSBhYm9ydGluZyB0aGUgcXVlcnkuXG4gICAgICovXG4gICAgbWF4VGltZU1TKHZhbHVlKSB7XG4gICAgICAgIGFzc2VydFVuaW5pdGlhbGl6ZWQodGhpcyk7XG4gICAgICAgIGlmICh0eXBlb2YgdmFsdWUgIT09ICdudW1iZXInKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdBcmd1bWVudCBmb3IgbWF4VGltZU1TIG11c3QgYmUgYSBudW1iZXInKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzW2tPcHRpb25zXS5tYXhUaW1lTVMgPSB2YWx1ZTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNldCB0aGUgYmF0Y2ggc2l6ZSBmb3IgdGhlIGN1cnNvci5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB2YWx1ZSAtIFRoZSBudW1iZXIgb2YgZG9jdW1lbnRzIHRvIHJldHVybiBwZXIgYmF0Y2guIFNlZSB7QGxpbmsgaHR0cHM6Ly93d3cubW9uZ29kYi5jb20vZG9jcy9tYW51YWwvcmVmZXJlbmNlL2NvbW1hbmQvZmluZC98ZmluZCBjb21tYW5kIGRvY3VtZW50YXRpb259LlxuICAgICAqL1xuICAgIGJhdGNoU2l6ZSh2YWx1ZSkge1xuICAgICAgICBhc3NlcnRVbmluaXRpYWxpemVkKHRoaXMpO1xuICAgICAgICBpZiAodGhpc1trT3B0aW9uc10udGFpbGFibGUpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvVGFpbGFibGVDdXJzb3JFcnJvcignVGFpbGFibGUgY3Vyc29yIGRvZXMgbm90IHN1cHBvcnQgYmF0Y2hTaXplJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoJ09wZXJhdGlvbiBcImJhdGNoU2l6ZVwiIHJlcXVpcmVzIGFuIGludGVnZXInKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzW2tPcHRpb25zXS5iYXRjaFNpemUgPSB2YWx1ZTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJld2luZCB0aGlzIGN1cnNvciB0byBpdHMgdW5pbml0aWFsaXplZCBzdGF0ZS4gQW55IG9wdGlvbnMgdGhhdCBhcmUgcHJlc2VudCBvbiB0aGUgY3Vyc29yIHdpbGxcbiAgICAgKiByZW1haW4gaW4gZWZmZWN0LiBJdGVyYXRpbmcgdGhpcyBjdXJzb3Igd2lsbCBjYXVzZSBuZXcgcXVlcmllcyB0byBiZSBzZW50IHRvIHRoZSBzZXJ2ZXIsIGV2ZW5cbiAgICAgKiBpZiB0aGUgcmVzdWx0YW50IGRhdGEgaGFzIGFscmVhZHkgYmVlbiByZXRyaWV2ZWQgYnkgdGhpcyBjdXJzb3IuXG4gICAgICovXG4gICAgcmV3aW5kKCkge1xuICAgICAgICBpZiAoIXRoaXNba0luaXRpYWxpemVkXSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXNba0lkXSA9IG51bGw7XG4gICAgICAgIHRoaXNba0RvY3VtZW50c10uY2xlYXIoKTtcbiAgICAgICAgdGhpc1trQ2xvc2VkXSA9IGZhbHNlO1xuICAgICAgICB0aGlzW2tLaWxsZWRdID0gZmFsc2U7XG4gICAgICAgIHRoaXNba0luaXRpYWxpemVkXSA9IGZhbHNlO1xuICAgICAgICBjb25zdCBzZXNzaW9uID0gdGhpc1trU2Vzc2lvbl07XG4gICAgICAgIGlmIChzZXNzaW9uKSB7XG4gICAgICAgICAgICAvLyBXZSBvbmx5IHdhbnQgdG8gZW5kIHRoaXMgc2Vzc2lvbiBpZiB3ZSBjcmVhdGVkIGl0LCBhbmQgaXQgaGFzbid0IGVuZGVkIHlldFxuICAgICAgICAgICAgaWYgKHNlc3Npb24uZXhwbGljaXQgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFzZXNzaW9uLmhhc0VuZGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlc3Npb24uZW5kU2Vzc2lvbigpLmNhdGNoKCgpID0+IG51bGwpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzW2tTZXNzaW9uXSA9IHRoaXMuY2xpZW50LnN0YXJ0U2Vzc2lvbih7IG93bmVyOiB0aGlzLCBleHBsaWNpdDogZmFsc2UgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIF9nZXRNb3JlKGJhdGNoU2l6ZSwgY2FsbGJhY2spIHtcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1ub24tbnVsbC1hc3NlcnRpb25cbiAgICAgICAgY29uc3QgZ2V0TW9yZU9wZXJhdGlvbiA9IG5ldyBnZXRfbW9yZV8xLkdldE1vcmVPcGVyYXRpb24odGhpc1trTmFtZXNwYWNlXSwgdGhpc1trSWRdLCB0aGlzW2tTZXJ2ZXJdLCB7XG4gICAgICAgICAgICAuLi50aGlzW2tPcHRpb25zXSxcbiAgICAgICAgICAgIHNlc3Npb246IHRoaXNba1Nlc3Npb25dLFxuICAgICAgICAgICAgYmF0Y2hTaXplXG4gICAgICAgIH0pO1xuICAgICAgICAoMCwgZXhlY3V0ZV9vcGVyYXRpb25fMS5leGVjdXRlT3BlcmF0aW9uKSh0aGlzW2tDbGllbnRdLCBnZXRNb3JlT3BlcmF0aW9uLCBjYWxsYmFjayk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqXG4gICAgICogVGhpcyBmdW5jdGlvbiBpcyBleHBvc2VkIGZvciB0aGUgdW5pZmllZCB0ZXN0IHJ1bm5lcidzIGNyZWF0ZUNoYW5nZVN0cmVhbVxuICAgICAqIG9wZXJhdGlvbi4gIFdlIGNhbm5vdCByZWZhY3RvciB0byB1c2UgdGhlIGFic3RyYWN0IF9pbml0aWFsaXplIG1ldGhvZCB3aXRob3V0XG4gICAgICogYSBzaWduaWZpY2FudCByZWZhY3Rvci5cbiAgICAgKi9cbiAgICBba0luaXRdKGNhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMuX2luaXRpYWxpemUodGhpc1trU2Vzc2lvbl0sIChlcnJvciwgc3RhdGUpID0+IHtcbiAgICAgICAgICAgIGlmIChzdGF0ZSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gc3RhdGUucmVzcG9uc2U7XG4gICAgICAgICAgICAgICAgdGhpc1trU2VydmVyXSA9IHN0YXRlLnNlcnZlcjtcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuY3Vyc29yKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFRPRE8oTk9ERS0yNjc0KTogUHJlc2VydmUgaW50NjQgc2VudCBmcm9tIE1vbmdvREJcbiAgICAgICAgICAgICAgICAgICAgdGhpc1trSWRdID1cbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVvZiByZXNwb25zZS5jdXJzb3IuaWQgPT09ICdudW1iZXInXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPyBic29uXzEuTG9uZy5mcm9tTnVtYmVyKHJlc3BvbnNlLmN1cnNvci5pZClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IHR5cGVvZiByZXNwb25zZS5jdXJzb3IuaWQgPT09ICdiaWdpbnQnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gYnNvbl8xLkxvbmcuZnJvbUJpZ0ludChyZXNwb25zZS5jdXJzb3IuaWQpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogcmVzcG9uc2UuY3Vyc29yLmlkO1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuY3Vyc29yLm5zKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzW2tOYW1lc3BhY2VdID0gKDAsIHV0aWxzXzEubnMpKHJlc3BvbnNlLmN1cnNvci5ucyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhpc1trRG9jdW1lbnRzXS5wdXNoTWFueShyZXNwb25zZS5jdXJzb3IuZmlyc3RCYXRjaCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIFdoZW4gc2VydmVyIHJlc3BvbnNlcyByZXR1cm4gd2l0aG91dCBhIGN1cnNvciBkb2N1bWVudCwgd2UgY2xvc2UgdGhpcyBjdXJzb3JcbiAgICAgICAgICAgICAgICAvLyBhbmQgcmV0dXJuIHRoZSByYXcgc2VydmVyIHJlc3BvbnNlLiBUaGlzIGlzIG9mdGVuIHRoZSBjYXNlIGZvciBleHBsYWluIGNvbW1hbmRzXG4gICAgICAgICAgICAgICAgLy8gZm9yIGV4YW1wbGVcbiAgICAgICAgICAgICAgICBpZiAodGhpc1trSWRdID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpc1trSWRdID0gYnNvbl8xLkxvbmcuWkVSTztcbiAgICAgICAgICAgICAgICAgICAgLy8gVE9ETyhOT0RFLTMyODYpOiBFeGVjdXRpb25SZXN1bHQgbmVlZHMgdG8gYWNjZXB0IGEgZ2VuZXJpYyBwYXJhbWV0ZXJcbiAgICAgICAgICAgICAgICAgICAgdGhpc1trRG9jdW1lbnRzXS5wdXNoKHN0YXRlLnJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyB0aGUgY3Vyc29yIGlzIG5vdyBpbml0aWFsaXplZCwgZXZlbiBpZiBhbiBlcnJvciBvY2N1cnJlZCBvciBpdCBpcyBkZWFkXG4gICAgICAgICAgICB0aGlzW2tJbml0aWFsaXplZF0gPSB0cnVlO1xuICAgICAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNsZWFudXBDdXJzb3IodGhpcywgeyBlcnJvciB9LCAoKSA9PiBjYWxsYmFjayhlcnJvciwgdW5kZWZpbmVkKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5pc0RlYWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gY2xlYW51cEN1cnNvcih0aGlzLCB1bmRlZmluZWQsICgpID0+IGNhbGxiYWNrKCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuLyoqIEBldmVudCAqL1xuQWJzdHJhY3RDdXJzb3IuQ0xPU0UgPSAnY2xvc2UnO1xuZXhwb3J0cy5BYnN0cmFjdEN1cnNvciA9IEFic3RyYWN0Q3Vyc29yO1xuLyoqXG4gKiBAcGFyYW0gY3Vyc29yIC0gdGhlIGN1cnNvciBvbiB3aGljaCB0byBjYWxsIGBuZXh0YFxuICogQHBhcmFtIGJsb2NraW5nIC0gYSBib29sZWFuIGluZGljYXRpbmcgd2hldGhlciBvciBub3QgdGhlIGN1cnNvciBzaG91bGQgYGJsb2NrYCB1bnRpbCBkYXRhXG4gKiAgICAgaXMgYXZhaWxhYmxlLiAgR2VuZXJhbGx5LCB0aGlzIGZsYWcgaXMgc2V0IHRvIGBmYWxzZWAgYmVjYXVzZSBpZiB0aGUgZ2V0TW9yZSByZXR1cm5zIG5vIGRvY3VtZW50cyxcbiAqICAgICB0aGUgY3Vyc29yIGhhcyBiZWVuIGV4aGF1c3RlZC4gIEluIGNlcnRhaW4gc2NlbmFyaW9zIChDaGFuZ2VTdHJlYW1zLCB0YWlsYWJsZSBhd2FpdCBjdXJzb3JzIGFuZFxuICogICAgIGB0cnlOZXh0YCwgZm9yIGV4YW1wbGUpIGJsb2NraW5nIGlzIG5lY2Vzc2FyeSBiZWNhdXNlIGEgZ2V0TW9yZSByZXR1cm5pbmcgbm8gZG9jdW1lbnRzIGRvZXNcbiAqICAgICBub3QgaW5kaWNhdGUgdGhlIGVuZCBvZiB0aGUgY3Vyc29yLlxuICogQHBhcmFtIHRyYW5zZm9ybSAtIGlmIHRydWUsIHRoZSBjdXJzb3IncyB0cmFuc2Zvcm0gZnVuY3Rpb24gaXMgYXBwbGllZCB0byB0aGUgcmVzdWx0IGRvY3VtZW50IChpZiB0aGUgdHJhbnNmb3JtIGV4aXN0cylcbiAqIEByZXR1cm5zIHRoZSBuZXh0IGRvY3VtZW50IGluIHRoZSBjdXJzb3IsIG9yIGBudWxsYC4gIFdoZW4gYGJsb2NraW5nYCBpcyBgdHJ1ZWAsIGEgYG51bGxgIGRvY3VtZW50IG1lYW5zXG4gKiB0aGUgY3Vyc29yIGhhcyBiZWVuIGV4aGF1c3RlZC4gIE90aGVyd2lzZSwgaXQgbWVhbnMgdGhhdCB0aGVyZSBpcyBubyBkb2N1bWVudCBhdmFpbGFibGUgaW4gdGhlIGN1cnNvcidzIGJ1ZmZlci5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gbmV4dChjdXJzb3IsIHsgYmxvY2tpbmcsIHRyYW5zZm9ybSB9KSB7XG4gICAgaWYgKGN1cnNvci5jbG9zZWQpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGRvIHtcbiAgICAgICAgaWYgKGN1cnNvcltrSWRdID09IG51bGwpIHtcbiAgICAgICAgICAgIC8vIEFsbCBjdXJzb3JzIG11c3Qgb3BlcmF0ZSB3aXRoaW4gYSBzZXNzaW9uLCBvbmUgbXVzdCBiZSBtYWRlIGltcGxpY2l0bHkgaWYgbm90IGV4cGxpY2l0bHkgcHJvdmlkZWRcbiAgICAgICAgICAgIGF3YWl0ICgwLCB1dGlsXzEucHJvbWlzaWZ5KShjdXJzb3Jba0luaXRdLmJpbmQoY3Vyc29yKSkoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY3Vyc29yW2tEb2N1bWVudHNdLmxlbmd0aCAhPT0gMCkge1xuICAgICAgICAgICAgY29uc3QgZG9jID0gY3Vyc29yW2tEb2N1bWVudHNdLnNoaWZ0KCk7XG4gICAgICAgICAgICBpZiAoZG9jICE9IG51bGwgJiYgdHJhbnNmb3JtICYmIGN1cnNvcltrVHJhbnNmb3JtXSkge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjdXJzb3Jba1RyYW5zZm9ybV0oZG9jKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGBjbGVhbnVwQ3Vyc29yQXN5bmNgIHNob3VsZCBuZXZlciB0aHJvdywgYnV0IGlmIGl0IGRvZXMgd2Ugd2FudCB0byB0aHJvdyB0aGUgb3JpZ2luYWxcbiAgICAgICAgICAgICAgICAgICAgLy8gZXJyb3IgaW5zdGVhZC5cbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgY2xlYW51cEN1cnNvckFzeW5jKGN1cnNvciwgeyBlcnJvciwgbmVlZHNUb0VtaXRDbG9zZWQ6IHRydWUgfSkuY2F0Y2goKCkgPT4gbnVsbCk7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBkb2M7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGN1cnNvci5pc0RlYWQpIHtcbiAgICAgICAgICAgIC8vIGlmIHRoZSBjdXJzb3IgaXMgZGVhZCwgd2UgY2xlYW4gaXQgdXBcbiAgICAgICAgICAgIC8vIGNsZWFudXBDdXJzb3JBc3luYyBzaG91bGQgbmV2ZXIgdGhyb3csIGJ1dCBpZiBpdCBkb2VzIGl0IGluZGljYXRlcyBhIGJ1ZyBpbiB0aGUgZHJpdmVyXG4gICAgICAgICAgICAvLyBhbmQgd2Ugc2hvdWxkIHN1cmZhY2UgdGhlIGVycm9yXG4gICAgICAgICAgICBhd2FpdCBjbGVhbnVwQ3Vyc29yQXN5bmMoY3Vyc29yLCB7fSk7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICAvLyBvdGhlcndpc2UgbmVlZCB0byBjYWxsIGdldE1vcmVcbiAgICAgICAgY29uc3QgYmF0Y2hTaXplID0gY3Vyc29yW2tPcHRpb25zXS5iYXRjaFNpemUgfHwgMTAwMDtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgKDAsIHV0aWxfMS5wcm9taXNpZnkpKGN1cnNvci5fZ2V0TW9yZS5iaW5kKGN1cnNvcikpKGJhdGNoU2l6ZSk7XG4gICAgICAgICAgICBpZiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBjdXJzb3JJZCA9IHR5cGVvZiByZXNwb25zZS5jdXJzb3IuaWQgPT09ICdudW1iZXInXG4gICAgICAgICAgICAgICAgICAgID8gYnNvbl8xLkxvbmcuZnJvbU51bWJlcihyZXNwb25zZS5jdXJzb3IuaWQpXG4gICAgICAgICAgICAgICAgICAgIDogdHlwZW9mIHJlc3BvbnNlLmN1cnNvci5pZCA9PT0gJ2JpZ2ludCdcbiAgICAgICAgICAgICAgICAgICAgICAgID8gYnNvbl8xLkxvbmcuZnJvbUJpZ0ludChyZXNwb25zZS5jdXJzb3IuaWQpXG4gICAgICAgICAgICAgICAgICAgICAgICA6IHJlc3BvbnNlLmN1cnNvci5pZDtcbiAgICAgICAgICAgICAgICBjdXJzb3Jba0RvY3VtZW50c10ucHVzaE1hbnkocmVzcG9uc2UuY3Vyc29yLm5leHRCYXRjaCk7XG4gICAgICAgICAgICAgICAgY3Vyc29yW2tJZF0gPSBjdXJzb3JJZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIC8vIGBjbGVhbnVwQ3Vyc29yQXN5bmNgIHNob3VsZCBuZXZlciB0aHJvdywgYnV0IGlmIGl0IGRvZXMgd2Ugd2FudCB0byB0aHJvdyB0aGUgb3JpZ2luYWxcbiAgICAgICAgICAgIC8vIGVycm9yIGluc3RlYWQuXG4gICAgICAgICAgICBhd2FpdCBjbGVhbnVwQ3Vyc29yQXN5bmMoY3Vyc29yLCB7IGVycm9yIH0pLmNhdGNoKCgpID0+IG51bGwpO1xuICAgICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGN1cnNvci5pc0RlYWQpIHtcbiAgICAgICAgICAgIC8vIElmIHdlIHN1Y2Nlc3NmdWxseSByZWNlaXZlZCBhIHJlc3BvbnNlIGZyb20gYSBjdXJzb3IgQlVUIHRoZSBjdXJzb3IgaW5kaWNhdGVzIHRoYXQgaXQgaXMgZXhoYXVzdGVkLFxuICAgICAgICAgICAgLy8gd2UgaW50ZW50aW9uYWxseSBjbGVhbiB1cCB0aGUgY3Vyc29yIHRvIHJlbGVhc2UgaXRzIHNlc3Npb24gYmFjayBpbnRvIHRoZSBwb29sIGJlZm9yZSB0aGUgY3Vyc29yXG4gICAgICAgICAgICAvLyBpcyBpdGVyYXRlZC4gIFRoaXMgcHJldmVudHMgYSBjdXJzb3IgdGhhdCBpcyBleGhhdXN0ZWQgb24gdGhlIHNlcnZlciBmcm9tIGhvbGRpbmdcbiAgICAgICAgICAgIC8vIG9udG8gYSBzZXNzaW9uIGluZGVmaW5pdGVseSB1bnRpbCB0aGUgQWJzdHJhY3RDdXJzb3IgaXMgaXRlcmF0ZWQuXG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgLy8gY2xlYW51cEN1cnNvckFzeW5jIHNob3VsZCBuZXZlciB0aHJvdywgYnV0IGlmIGl0IGRvZXMgaXQgaW5kaWNhdGVzIGEgYnVnIGluIHRoZSBkcml2ZXJcbiAgICAgICAgICAgIC8vIGFuZCB3ZSBzaG91bGQgc3VyZmFjZSB0aGUgZXJyb3JcbiAgICAgICAgICAgIGF3YWl0IGNsZWFudXBDdXJzb3JBc3luYyhjdXJzb3IsIHt9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY3Vyc29yW2tEb2N1bWVudHNdLmxlbmd0aCA9PT0gMCAmJiBibG9ja2luZyA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgfSB3aGlsZSAoIWN1cnNvci5pc0RlYWQgfHwgY3Vyc29yW2tEb2N1bWVudHNdLmxlbmd0aCAhPT0gMCk7XG4gICAgcmV0dXJuIG51bGw7XG59XG5jb25zdCBjbGVhbnVwQ3Vyc29yQXN5bmMgPSAoMCwgdXRpbF8xLnByb21pc2lmeSkoY2xlYW51cEN1cnNvcik7XG5mdW5jdGlvbiBjbGVhbnVwQ3Vyc29yKGN1cnNvciwgb3B0aW9ucywgY2FsbGJhY2spIHtcbiAgICBjb25zdCBjdXJzb3JJZCA9IGN1cnNvcltrSWRdO1xuICAgIGNvbnN0IGN1cnNvck5zID0gY3Vyc29yW2tOYW1lc3BhY2VdO1xuICAgIGNvbnN0IHNlcnZlciA9IGN1cnNvcltrU2VydmVyXTtcbiAgICBjb25zdCBzZXNzaW9uID0gY3Vyc29yW2tTZXNzaW9uXTtcbiAgICBjb25zdCBlcnJvciA9IG9wdGlvbnM/LmVycm9yO1xuICAgIC8vIEN1cnNvcnMgb25seSBlbWl0IGNsb3NlZCBldmVudHMgb25jZSB0aGUgY2xpZW50LXNpZGUgY3Vyc29yIGhhcyBiZWVuIGV4aGF1c3RlZCBmdWxseSBvciB0aGVyZVxuICAgIC8vIHdhcyBhbiBlcnJvci4gIE5vdGFibHksIHdoZW4gdGhlIHNlcnZlciByZXR1cm5zIGEgY3Vyc29yIGlkIG9mIDAgYW5kIGEgbm9uLWVtcHR5IGJhdGNoLCB3ZVxuICAgIC8vIGNsZWFudXAgdGhlIGN1cnNvciBidXQgZG9uJ3QgZW1pdCBhIGBjbG9zZWAgZXZlbnQuXG4gICAgY29uc3QgbmVlZHNUb0VtaXRDbG9zZWQgPSBvcHRpb25zPy5uZWVkc1RvRW1pdENsb3NlZCA/PyBjdXJzb3Jba0RvY3VtZW50c10ubGVuZ3RoID09PSAwO1xuICAgIGlmIChlcnJvcikge1xuICAgICAgICBpZiAoY3Vyc29yLmxvYWRCYWxhbmNlZCAmJiBlcnJvciBpbnN0YW5jZW9mIGVycm9yXzEuTW9uZ29OZXR3b3JrRXJyb3IpIHtcbiAgICAgICAgICAgIHJldHVybiBjb21wbGV0ZUNsZWFudXAoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAoY3Vyc29ySWQgPT0gbnVsbCB8fCBzZXJ2ZXIgPT0gbnVsbCB8fCBjdXJzb3JJZC5pc1plcm8oKSB8fCBjdXJzb3JOcyA9PSBudWxsKSB7XG4gICAgICAgIGlmIChuZWVkc1RvRW1pdENsb3NlZCkge1xuICAgICAgICAgICAgY3Vyc29yW2tDbG9zZWRdID0gdHJ1ZTtcbiAgICAgICAgICAgIGN1cnNvcltrSWRdID0gYnNvbl8xLkxvbmcuWkVSTztcbiAgICAgICAgICAgIGN1cnNvci5lbWl0KEFic3RyYWN0Q3Vyc29yLkNMT1NFKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc2Vzc2lvbikge1xuICAgICAgICAgICAgaWYgKHNlc3Npb24ub3duZXIgPT09IGN1cnNvcikge1xuICAgICAgICAgICAgICAgIHNlc3Npb24uZW5kU2Vzc2lvbih7IGVycm9yIH0pLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghc2Vzc2lvbi5pblRyYW5zYWN0aW9uKCkpIHtcbiAgICAgICAgICAgICAgICAoMCwgc2Vzc2lvbnNfMS5tYXliZUNsZWFyUGlubmVkQ29ubmVjdGlvbikoc2Vzc2lvbiwgeyBlcnJvciB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY2FsbGJhY2soKTtcbiAgICB9XG4gICAgZnVuY3Rpb24gY29tcGxldGVDbGVhbnVwKCkge1xuICAgICAgICBpZiAoc2Vzc2lvbikge1xuICAgICAgICAgICAgaWYgKHNlc3Npb24ub3duZXIgPT09IGN1cnNvcikge1xuICAgICAgICAgICAgICAgIHNlc3Npb24uZW5kU2Vzc2lvbih7IGVycm9yIH0pLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjdXJzb3IuZW1pdChBYnN0cmFjdEN1cnNvci5DTE9TRSk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFzZXNzaW9uLmluVHJhbnNhY3Rpb24oKSkge1xuICAgICAgICAgICAgICAgICgwLCBzZXNzaW9uc18xLm1heWJlQ2xlYXJQaW5uZWRDb25uZWN0aW9uKShzZXNzaW9uLCB7IGVycm9yIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGN1cnNvci5lbWl0KEFic3RyYWN0Q3Vyc29yLkNMT1NFKTtcbiAgICAgICAgcmV0dXJuIGNhbGxiYWNrKCk7XG4gICAgfVxuICAgIGN1cnNvcltrS2lsbGVkXSA9IHRydWU7XG4gICAgaWYgKHNlc3Npb24uaGFzRW5kZWQpIHtcbiAgICAgICAgcmV0dXJuIGNvbXBsZXRlQ2xlYW51cCgpO1xuICAgIH1cbiAgICAoMCwgZXhlY3V0ZV9vcGVyYXRpb25fMS5leGVjdXRlT3BlcmF0aW9uKShjdXJzb3Jba0NsaWVudF0sIG5ldyBraWxsX2N1cnNvcnNfMS5LaWxsQ3Vyc29yc09wZXJhdGlvbihjdXJzb3JJZCwgY3Vyc29yTnMsIHNlcnZlciwgeyBzZXNzaW9uIH0pKVxuICAgICAgICAuY2F0Y2goKCkgPT4gbnVsbClcbiAgICAgICAgLmZpbmFsbHkoY29tcGxldGVDbGVhbnVwKTtcbn1cbi8qKiBAaW50ZXJuYWwgKi9cbmZ1bmN0aW9uIGFzc2VydFVuaW5pdGlhbGl6ZWQoY3Vyc29yKSB7XG4gICAgaWYgKGN1cnNvcltrSW5pdGlhbGl6ZWRdKSB7XG4gICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvQ3Vyc29ySW5Vc2VFcnJvcigpO1xuICAgIH1cbn1cbmV4cG9ydHMuYXNzZXJ0VW5pbml0aWFsaXplZCA9IGFzc2VydFVuaW5pdGlhbGl6ZWQ7XG5jbGFzcyBSZWFkYWJsZUN1cnNvclN0cmVhbSBleHRlbmRzIHN0cmVhbV8xLlJlYWRhYmxlIHtcbiAgICBjb25zdHJ1Y3RvcihjdXJzb3IpIHtcbiAgICAgICAgc3VwZXIoe1xuICAgICAgICAgICAgb2JqZWN0TW9kZTogdHJ1ZSxcbiAgICAgICAgICAgIGF1dG9EZXN0cm95OiBmYWxzZSxcbiAgICAgICAgICAgIGhpZ2hXYXRlck1hcms6IDFcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuX3JlYWRJblByb2dyZXNzID0gZmFsc2U7XG4gICAgICAgIHRoaXMuX2N1cnNvciA9IGN1cnNvcjtcbiAgICB9XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby11bnVzZWQtdmFyc1xuICAgIF9yZWFkKHNpemUpIHtcbiAgICAgICAgaWYgKCF0aGlzLl9yZWFkSW5Qcm9ncmVzcykge1xuICAgICAgICAgICAgdGhpcy5fcmVhZEluUHJvZ3Jlc3MgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5fcmVhZE5leHQoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBfZGVzdHJveShlcnJvciwgY2FsbGJhY2spIHtcbiAgICAgICAgdGhpcy5fY3Vyc29yLmNsb3NlKCkudGhlbigoKSA9PiBjYWxsYmFjayhlcnJvciksIGNsb3NlRXJyb3IgPT4gY2FsbGJhY2soY2xvc2VFcnJvcikpO1xuICAgIH1cbiAgICBfcmVhZE5leHQoKSB7XG4gICAgICAgIG5leHQodGhpcy5fY3Vyc29yLCB7IGJsb2NraW5nOiB0cnVlLCB0cmFuc2Zvcm06IHRydWUgfSkudGhlbihyZXN1bHQgPT4ge1xuICAgICAgICAgICAgaWYgKHJlc3VsdCA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5wdXNoKG51bGwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5kZXN0cm95ZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9jdXJzb3IuY2xvc2UoKS5jYXRjaCgoKSA9PiBudWxsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnB1c2gocmVzdWx0KSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcmVhZE5leHQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5fcmVhZEluUHJvZ3Jlc3MgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgZXJyID0+IHtcbiAgICAgICAgICAgIC8vIE5PVEU6IFRoaXMgaXMgcXVlc3Rpb25hYmxlLCBidXQgd2UgaGF2ZSBhIHRlc3QgYmFja2luZyB0aGUgYmVoYXZpb3IuIEl0IHNlZW1zIHRoZVxuICAgICAgICAgICAgLy8gICAgICAgZGVzaXJlZCBiZWhhdmlvciBpcyB0aGF0IGEgc3RyZWFtIGVuZHMgY2xlYW5seSB3aGVuIGEgdXNlciBleHBsaWNpdGx5IGNsb3Nlc1xuICAgICAgICAgICAgLy8gICAgICAgYSBjbGllbnQgZHVyaW5nIGl0ZXJhdGlvbi4gQWx0ZXJuYXRpdmVseSwgd2UgY291bGQgZG8gdGhlIFwicmlnaHRcIiB0aGluZyBhbmRcbiAgICAgICAgICAgIC8vICAgICAgIHByb3BhZ2F0ZSB0aGUgZXJyb3IgbWVzc2FnZSBieSByZW1vdmluZyB0aGlzIHNwZWNpYWwgY2FzZS5cbiAgICAgICAgICAgIGlmIChlcnIubWVzc2FnZS5tYXRjaCgvc2VydmVyIGlzIGNsb3NlZC8pKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fY3Vyc29yLmNsb3NlKCkuY2F0Y2goKCkgPT4gbnVsbCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucHVzaChudWxsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIE5PVEU6IFRoaXMgaXMgYWxzbyBwZXJoYXBzIHF1ZXN0aW9uYWJsZS4gVGhlIHJhdGlvbmFsZSBoZXJlIGlzIHRoYXQgdGhlc2UgZXJyb3JzIHRlbmRcbiAgICAgICAgICAgIC8vICAgICAgIHRvIGJlIFwib3BlcmF0aW9uIHdhcyBpbnRlcnJ1cHRlZFwiLCB3aGVyZSBhIGN1cnNvciBoYXMgYmVlbiBjbG9zZWQgYnV0IHRoZXJlIGlzIGFuXG4gICAgICAgICAgICAvLyAgICAgICBhY3RpdmUgZ2V0TW9yZSBpbi1mbGlnaHQuIFRoaXMgdXNlZCB0byBjaGVjayBpZiB0aGUgY3Vyc29yIHdhcyBraWxsZWQgYnV0IG9uY2VcbiAgICAgICAgICAgIC8vICAgICAgIHRoYXQgY2hhbmdlZCB0byBoYXBwZW4gaW4gY2xlYW51cCBsZWdpdGltYXRlIGVycm9ycyB3b3VsZCBub3QgZGVzdHJveSB0aGVcbiAgICAgICAgICAgIC8vICAgICAgIHN0cmVhbS4gVGhlcmUgYXJlIGNoYW5nZSBzdHJlYW1zIHRlc3Qgc3BlY2lmaWNhbGx5IHRlc3QgdGhlc2UgY2FzZXMuXG4gICAgICAgICAgICBpZiAoZXJyLm1lc3NhZ2UubWF0Y2goL29wZXJhdGlvbiB3YXMgaW50ZXJydXB0ZWQvKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnB1c2gobnVsbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBOT1RFOiBUaGUgdHdvIGFib3ZlIGNoZWNrcyBvbiB0aGUgbWVzc2FnZSBvZiB0aGUgZXJyb3Igd2lsbCBjYXVzZSBhIG51bGwgdG8gYmUgcHVzaGVkXG4gICAgICAgICAgICAvLyAgICAgICB0byB0aGUgc3RyZWFtLCB0aHVzIGNsb3NpbmcgdGhlIHN0cmVhbSBiZWZvcmUgdGhlIGRlc3Ryb3kgY2FsbCBoYXBwZW5zLiBUaGlzIG1lYW5zXG4gICAgICAgICAgICAvLyAgICAgICB0aGF0IGVpdGhlciBvZiB0aG9zZSBlcnJvciBtZXNzYWdlcyBvbiBhIGNoYW5nZSBzdHJlYW0gd2lsbCBub3QgZ2V0IGEgcHJvcGVyXG4gICAgICAgICAgICAvLyAgICAgICAnZXJyb3InIGV2ZW50IHRvIGJlIGVtaXR0ZWQgKHRoZSBlcnJvciBwYXNzZWQgdG8gZGVzdHJveSkuIENoYW5nZSBzdHJlYW0gcmVzdW1hYmlsaXR5XG4gICAgICAgICAgICAvLyAgICAgICByZWxpZXMgb24gdGhhdCBlcnJvciBldmVudCB0byBiZSBlbWl0dGVkIHRvIGNyZWF0ZSBpdHMgbmV3IGN1cnNvciBhbmQgdGh1cyB3YXMgbm90XG4gICAgICAgICAgICAvLyAgICAgICB3b3JraW5nIG9uIDQuNCBzZXJ2ZXJzIGJlY2F1c2UgdGhlIGVycm9yIGVtaXR0ZWQgb24gZmFpbG92ZXIgd2FzIFwiaW50ZXJydXB0ZWQgYXRcbiAgICAgICAgICAgIC8vICAgICAgIHNodXRkb3duXCIgd2hpbGUgb24gNS4wKyBpdCBpcyBcIlRoZSBzZXJ2ZXIgaXMgaW4gcXVpZXNjZSBtb2RlIGFuZCB3aWxsIHNodXQgZG93blwiLlxuICAgICAgICAgICAgLy8gICAgICAgU2VlIE5PREUtNDQ3NS5cbiAgICAgICAgICAgIHJldHVybiB0aGlzLmRlc3Ryb3koZXJyKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YWJzdHJhY3RfY3Vyc29yLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/cursor/abstract_cursor.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/cursor/aggregation_cursor.js":
/*!***********************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/cursor/aggregation_cursor.js ***!
  \***********************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.AggregationCursor = void 0;\nconst aggregate_1 = __webpack_require__(/*! ../operations/aggregate */ \"(api)/../server/node_modules/mongodb/lib/operations/aggregate.js\");\nconst execute_operation_1 = __webpack_require__(/*! ../operations/execute_operation */ \"(api)/../server/node_modules/mongodb/lib/operations/execute_operation.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\nconst abstract_cursor_1 = __webpack_require__(/*! ./abstract_cursor */ \"(api)/../server/node_modules/mongodb/lib/cursor/abstract_cursor.js\");\n/** @internal */\nconst kPipeline = Symbol('pipeline');\n/** @internal */\nconst kOptions = Symbol('options');\n/**\n * The **AggregationCursor** class is an internal class that embodies an aggregation cursor on MongoDB\n * allowing for iteration over the results returned from the underlying query. It supports\n * one by one document iteration, conversion to an array or can be iterated as a Node 4.X\n * or higher stream\n * @public\n */\nclass AggregationCursor extends abstract_cursor_1.AbstractCursor {\n    /** @internal */\n    constructor(client, namespace, pipeline = [], options = {}) {\n        super(client, namespace, options);\n        this[kPipeline] = pipeline;\n        this[kOptions] = options;\n    }\n    get pipeline() {\n        return this[kPipeline];\n    }\n    clone() {\n        const clonedOptions = (0, utils_1.mergeOptions)({}, this[kOptions]);\n        delete clonedOptions.session;\n        return new AggregationCursor(this.client, this.namespace, this[kPipeline], {\n            ...clonedOptions\n        });\n    }\n    map(transform) {\n        return super.map(transform);\n    }\n    /** @internal */\n    _initialize(session, callback) {\n        const aggregateOperation = new aggregate_1.AggregateOperation(this.namespace, this[kPipeline], {\n            ...this[kOptions],\n            ...this.cursorOptions,\n            session\n        });\n        (0, execute_operation_1.executeOperation)(this.client, aggregateOperation, (err, response) => {\n            if (err || response == null)\n                return callback(err);\n            // TODO: NODE-2882\n            callback(undefined, { server: aggregateOperation.server, session, response });\n        });\n    }\n    /** Execute the explain for the cursor */\n    async explain(verbosity) {\n        return (0, execute_operation_1.executeOperation)(this.client, new aggregate_1.AggregateOperation(this.namespace, this[kPipeline], {\n            ...this[kOptions],\n            ...this.cursorOptions,\n            explain: verbosity ?? true\n        }));\n    }\n    group($group) {\n        (0, abstract_cursor_1.assertUninitialized)(this);\n        this[kPipeline].push({ $group });\n        return this;\n    }\n    /** Add a limit stage to the aggregation pipeline */\n    limit($limit) {\n        (0, abstract_cursor_1.assertUninitialized)(this);\n        this[kPipeline].push({ $limit });\n        return this;\n    }\n    /** Add a match stage to the aggregation pipeline */\n    match($match) {\n        (0, abstract_cursor_1.assertUninitialized)(this);\n        this[kPipeline].push({ $match });\n        return this;\n    }\n    /** Add an out stage to the aggregation pipeline */\n    out($out) {\n        (0, abstract_cursor_1.assertUninitialized)(this);\n        this[kPipeline].push({ $out });\n        return this;\n    }\n    /**\n     * Add a project stage to the aggregation pipeline\n     *\n     * @remarks\n     * In order to strictly type this function you must provide an interface\n     * that represents the effect of your projection on the result documents.\n     *\n     * By default chaining a projection to your cursor changes the returned type to the generic {@link Document} type.\n     * You should specify a parameterized type to have assertions on your final results.\n     *\n     * @example\n     * ```typescript\n     * // Best way\n     * const docs: AggregationCursor<{ a: number }> = cursor.project<{ a: number }>({ _id: 0, a: true });\n     * // Flexible way\n     * const docs: AggregationCursor<Document> = cursor.project({ _id: 0, a: true });\n     * ```\n     *\n     * @remarks\n     * In order to strictly type this function you must provide an interface\n     * that represents the effect of your projection on the result documents.\n     *\n     * **Note for Typescript Users:** adding a transform changes the return type of the iteration of this cursor,\n     * it **does not** return a new instance of a cursor. This means when calling project,\n     * you should always assign the result to a new variable in order to get a correctly typed cursor variable.\n     * Take note of the following example:\n     *\n     * @example\n     * ```typescript\n     * const cursor: AggregationCursor<{ a: number; b: string }> = coll.aggregate([]);\n     * const projectCursor = cursor.project<{ a: number }>({ _id: 0, a: true });\n     * const aPropOnlyArray: {a: number}[] = await projectCursor.toArray();\n     *\n     * // or always use chaining and save the final cursor\n     *\n     * const cursor = coll.aggregate().project<{ a: string }>({\n     *   _id: 0,\n     *   a: { $convert: { input: '$a', to: 'string' }\n     * }});\n     * ```\n     */\n    project($project) {\n        (0, abstract_cursor_1.assertUninitialized)(this);\n        this[kPipeline].push({ $project });\n        return this;\n    }\n    /** Add a lookup stage to the aggregation pipeline */\n    lookup($lookup) {\n        (0, abstract_cursor_1.assertUninitialized)(this);\n        this[kPipeline].push({ $lookup });\n        return this;\n    }\n    /** Add a redact stage to the aggregation pipeline */\n    redact($redact) {\n        (0, abstract_cursor_1.assertUninitialized)(this);\n        this[kPipeline].push({ $redact });\n        return this;\n    }\n    /** Add a skip stage to the aggregation pipeline */\n    skip($skip) {\n        (0, abstract_cursor_1.assertUninitialized)(this);\n        this[kPipeline].push({ $skip });\n        return this;\n    }\n    /** Add a sort stage to the aggregation pipeline */\n    sort($sort) {\n        (0, abstract_cursor_1.assertUninitialized)(this);\n        this[kPipeline].push({ $sort });\n        return this;\n    }\n    /** Add a unwind stage to the aggregation pipeline */\n    unwind($unwind) {\n        (0, abstract_cursor_1.assertUninitialized)(this);\n        this[kPipeline].push({ $unwind });\n        return this;\n    }\n    /** Add a geoNear stage to the aggregation pipeline */\n    geoNear($geoNear) {\n        (0, abstract_cursor_1.assertUninitialized)(this);\n        this[kPipeline].push({ $geoNear });\n        return this;\n    }\n}\nexports.AggregationCursor = AggregationCursor;\n//# sourceMappingURL=aggregation_cursor.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jdXJzb3IvYWdncmVnYXRpb25fY3Vyc29yLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELHlCQUF5QjtBQUN6QixvQkFBb0IsbUJBQU8sQ0FBQyxpR0FBeUI7QUFDckQsNEJBQTRCLG1CQUFPLENBQUMsaUhBQWlDO0FBQ3JFLGdCQUFnQixtQkFBTyxDQUFDLG1FQUFVO0FBQ2xDLDBCQUEwQixtQkFBTyxDQUFDLDZGQUFtQjtBQUNyRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhEQUE4RDtBQUM5RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMERBQTBEO0FBQzFEO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQyxzREFBc0Q7QUFDeEYsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLCtCQUErQixRQUFRO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsUUFBUTtBQUN2QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLFFBQVE7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQixNQUFNO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlHQUFpRyxnQkFBZ0I7QUFDakg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVDQUF1QyxXQUFXLHFCQUFxQixXQUFXLElBQUksaUJBQWlCO0FBQ3ZHO0FBQ0Esa0VBQWtFLGlCQUFpQjtBQUNuRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlDQUF5QyxXQUFXLFdBQVc7QUFDL0QsOENBQThDLFdBQVcsSUFBSSxpQkFBaUI7QUFDOUUsOEJBQThCLFVBQVU7QUFDeEM7QUFDQTtBQUNBO0FBQ0EsaURBQWlELFdBQVc7QUFDNUQ7QUFDQSxjQUFjLFlBQVk7QUFDMUIsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLFVBQVU7QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQixTQUFTO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsU0FBUztBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLE9BQU87QUFDdEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQixPQUFPO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsU0FBUztBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLFVBQVU7QUFDekM7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCIiwic291cmNlcyI6WyJEOlxcc2Fsb25pXFxhcHByYWlzYWwtc3lzdGVtXFxzZXJ2ZXJcXG5vZGVfbW9kdWxlc1xcbW9uZ29kYlxcbGliXFxjdXJzb3JcXGFnZ3JlZ2F0aW9uX2N1cnNvci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuQWdncmVnYXRpb25DdXJzb3IgPSB2b2lkIDA7XG5jb25zdCBhZ2dyZWdhdGVfMSA9IHJlcXVpcmUoXCIuLi9vcGVyYXRpb25zL2FnZ3JlZ2F0ZVwiKTtcbmNvbnN0IGV4ZWN1dGVfb3BlcmF0aW9uXzEgPSByZXF1aXJlKFwiLi4vb3BlcmF0aW9ucy9leGVjdXRlX29wZXJhdGlvblwiKTtcbmNvbnN0IHV0aWxzXzEgPSByZXF1aXJlKFwiLi4vdXRpbHNcIik7XG5jb25zdCBhYnN0cmFjdF9jdXJzb3JfMSA9IHJlcXVpcmUoXCIuL2Fic3RyYWN0X2N1cnNvclwiKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNvbnN0IGtQaXBlbGluZSA9IFN5bWJvbCgncGlwZWxpbmUnKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNvbnN0IGtPcHRpb25zID0gU3ltYm9sKCdvcHRpb25zJyk7XG4vKipcbiAqIFRoZSAqKkFnZ3JlZ2F0aW9uQ3Vyc29yKiogY2xhc3MgaXMgYW4gaW50ZXJuYWwgY2xhc3MgdGhhdCBlbWJvZGllcyBhbiBhZ2dyZWdhdGlvbiBjdXJzb3Igb24gTW9uZ29EQlxuICogYWxsb3dpbmcgZm9yIGl0ZXJhdGlvbiBvdmVyIHRoZSByZXN1bHRzIHJldHVybmVkIGZyb20gdGhlIHVuZGVybHlpbmcgcXVlcnkuIEl0IHN1cHBvcnRzXG4gKiBvbmUgYnkgb25lIGRvY3VtZW50IGl0ZXJhdGlvbiwgY29udmVyc2lvbiB0byBhbiBhcnJheSBvciBjYW4gYmUgaXRlcmF0ZWQgYXMgYSBOb2RlIDQuWFxuICogb3IgaGlnaGVyIHN0cmVhbVxuICogQHB1YmxpY1xuICovXG5jbGFzcyBBZ2dyZWdhdGlvbkN1cnNvciBleHRlbmRzIGFic3RyYWN0X2N1cnNvcl8xLkFic3RyYWN0Q3Vyc29yIHtcbiAgICAvKiogQGludGVybmFsICovXG4gICAgY29uc3RydWN0b3IoY2xpZW50LCBuYW1lc3BhY2UsIHBpcGVsaW5lID0gW10sIG9wdGlvbnMgPSB7fSkge1xuICAgICAgICBzdXBlcihjbGllbnQsIG5hbWVzcGFjZSwgb3B0aW9ucyk7XG4gICAgICAgIHRoaXNba1BpcGVsaW5lXSA9IHBpcGVsaW5lO1xuICAgICAgICB0aGlzW2tPcHRpb25zXSA9IG9wdGlvbnM7XG4gICAgfVxuICAgIGdldCBwaXBlbGluZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXNba1BpcGVsaW5lXTtcbiAgICB9XG4gICAgY2xvbmUoKSB7XG4gICAgICAgIGNvbnN0IGNsb25lZE9wdGlvbnMgPSAoMCwgdXRpbHNfMS5tZXJnZU9wdGlvbnMpKHt9LCB0aGlzW2tPcHRpb25zXSk7XG4gICAgICAgIGRlbGV0ZSBjbG9uZWRPcHRpb25zLnNlc3Npb247XG4gICAgICAgIHJldHVybiBuZXcgQWdncmVnYXRpb25DdXJzb3IodGhpcy5jbGllbnQsIHRoaXMubmFtZXNwYWNlLCB0aGlzW2tQaXBlbGluZV0sIHtcbiAgICAgICAgICAgIC4uLmNsb25lZE9wdGlvbnNcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIG1hcCh0cmFuc2Zvcm0pIHtcbiAgICAgICAgcmV0dXJuIHN1cGVyLm1hcCh0cmFuc2Zvcm0pO1xuICAgIH1cbiAgICAvKiogQGludGVybmFsICovXG4gICAgX2luaXRpYWxpemUoc2Vzc2lvbiwgY2FsbGJhY2spIHtcbiAgICAgICAgY29uc3QgYWdncmVnYXRlT3BlcmF0aW9uID0gbmV3IGFnZ3JlZ2F0ZV8xLkFnZ3JlZ2F0ZU9wZXJhdGlvbih0aGlzLm5hbWVzcGFjZSwgdGhpc1trUGlwZWxpbmVdLCB7XG4gICAgICAgICAgICAuLi50aGlzW2tPcHRpb25zXSxcbiAgICAgICAgICAgIC4uLnRoaXMuY3Vyc29yT3B0aW9ucyxcbiAgICAgICAgICAgIHNlc3Npb25cbiAgICAgICAgfSk7XG4gICAgICAgICgwLCBleGVjdXRlX29wZXJhdGlvbl8xLmV4ZWN1dGVPcGVyYXRpb24pKHRoaXMuY2xpZW50LCBhZ2dyZWdhdGVPcGVyYXRpb24sIChlcnIsIHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICBpZiAoZXJyIHx8IHJlc3BvbnNlID09IG51bGwpXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgICAgICAgICAvLyBUT0RPOiBOT0RFLTI4ODJcbiAgICAgICAgICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwgeyBzZXJ2ZXI6IGFnZ3JlZ2F0ZU9wZXJhdGlvbi5zZXJ2ZXIsIHNlc3Npb24sIHJlc3BvbnNlIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqIEV4ZWN1dGUgdGhlIGV4cGxhaW4gZm9yIHRoZSBjdXJzb3IgKi9cbiAgICBhc3luYyBleHBsYWluKHZlcmJvc2l0eSkge1xuICAgICAgICByZXR1cm4gKDAsIGV4ZWN1dGVfb3BlcmF0aW9uXzEuZXhlY3V0ZU9wZXJhdGlvbikodGhpcy5jbGllbnQsIG5ldyBhZ2dyZWdhdGVfMS5BZ2dyZWdhdGVPcGVyYXRpb24odGhpcy5uYW1lc3BhY2UsIHRoaXNba1BpcGVsaW5lXSwge1xuICAgICAgICAgICAgLi4udGhpc1trT3B0aW9uc10sXG4gICAgICAgICAgICAuLi50aGlzLmN1cnNvck9wdGlvbnMsXG4gICAgICAgICAgICBleHBsYWluOiB2ZXJib3NpdHkgPz8gdHJ1ZVxuICAgICAgICB9KSk7XG4gICAgfVxuICAgIGdyb3VwKCRncm91cCkge1xuICAgICAgICAoMCwgYWJzdHJhY3RfY3Vyc29yXzEuYXNzZXJ0VW5pbml0aWFsaXplZCkodGhpcyk7XG4gICAgICAgIHRoaXNba1BpcGVsaW5lXS5wdXNoKHsgJGdyb3VwIH0pO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgLyoqIEFkZCBhIGxpbWl0IHN0YWdlIHRvIHRoZSBhZ2dyZWdhdGlvbiBwaXBlbGluZSAqL1xuICAgIGxpbWl0KCRsaW1pdCkge1xuICAgICAgICAoMCwgYWJzdHJhY3RfY3Vyc29yXzEuYXNzZXJ0VW5pbml0aWFsaXplZCkodGhpcyk7XG4gICAgICAgIHRoaXNba1BpcGVsaW5lXS5wdXNoKHsgJGxpbWl0IH0pO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgLyoqIEFkZCBhIG1hdGNoIHN0YWdlIHRvIHRoZSBhZ2dyZWdhdGlvbiBwaXBlbGluZSAqL1xuICAgIG1hdGNoKCRtYXRjaCkge1xuICAgICAgICAoMCwgYWJzdHJhY3RfY3Vyc29yXzEuYXNzZXJ0VW5pbml0aWFsaXplZCkodGhpcyk7XG4gICAgICAgIHRoaXNba1BpcGVsaW5lXS5wdXNoKHsgJG1hdGNoIH0pO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgLyoqIEFkZCBhbiBvdXQgc3RhZ2UgdG8gdGhlIGFnZ3JlZ2F0aW9uIHBpcGVsaW5lICovXG4gICAgb3V0KCRvdXQpIHtcbiAgICAgICAgKDAsIGFic3RyYWN0X2N1cnNvcl8xLmFzc2VydFVuaW5pdGlhbGl6ZWQpKHRoaXMpO1xuICAgICAgICB0aGlzW2tQaXBlbGluZV0ucHVzaCh7ICRvdXQgfSk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBZGQgYSBwcm9qZWN0IHN0YWdlIHRvIHRoZSBhZ2dyZWdhdGlvbiBwaXBlbGluZVxuICAgICAqXG4gICAgICogQHJlbWFya3NcbiAgICAgKiBJbiBvcmRlciB0byBzdHJpY3RseSB0eXBlIHRoaXMgZnVuY3Rpb24geW91IG11c3QgcHJvdmlkZSBhbiBpbnRlcmZhY2VcbiAgICAgKiB0aGF0IHJlcHJlc2VudHMgdGhlIGVmZmVjdCBvZiB5b3VyIHByb2plY3Rpb24gb24gdGhlIHJlc3VsdCBkb2N1bWVudHMuXG4gICAgICpcbiAgICAgKiBCeSBkZWZhdWx0IGNoYWluaW5nIGEgcHJvamVjdGlvbiB0byB5b3VyIGN1cnNvciBjaGFuZ2VzIHRoZSByZXR1cm5lZCB0eXBlIHRvIHRoZSBnZW5lcmljIHtAbGluayBEb2N1bWVudH0gdHlwZS5cbiAgICAgKiBZb3Ugc2hvdWxkIHNwZWNpZnkgYSBwYXJhbWV0ZXJpemVkIHR5cGUgdG8gaGF2ZSBhc3NlcnRpb25zIG9uIHlvdXIgZmluYWwgcmVzdWx0cy5cbiAgICAgKlxuICAgICAqIEBleGFtcGxlXG4gICAgICogYGBgdHlwZXNjcmlwdFxuICAgICAqIC8vIEJlc3Qgd2F5XG4gICAgICogY29uc3QgZG9jczogQWdncmVnYXRpb25DdXJzb3I8eyBhOiBudW1iZXIgfT4gPSBjdXJzb3IucHJvamVjdDx7IGE6IG51bWJlciB9Pih7IF9pZDogMCwgYTogdHJ1ZSB9KTtcbiAgICAgKiAvLyBGbGV4aWJsZSB3YXlcbiAgICAgKiBjb25zdCBkb2NzOiBBZ2dyZWdhdGlvbkN1cnNvcjxEb2N1bWVudD4gPSBjdXJzb3IucHJvamVjdCh7IF9pZDogMCwgYTogdHJ1ZSB9KTtcbiAgICAgKiBgYGBcbiAgICAgKlxuICAgICAqIEByZW1hcmtzXG4gICAgICogSW4gb3JkZXIgdG8gc3RyaWN0bHkgdHlwZSB0aGlzIGZ1bmN0aW9uIHlvdSBtdXN0IHByb3ZpZGUgYW4gaW50ZXJmYWNlXG4gICAgICogdGhhdCByZXByZXNlbnRzIHRoZSBlZmZlY3Qgb2YgeW91ciBwcm9qZWN0aW9uIG9uIHRoZSByZXN1bHQgZG9jdW1lbnRzLlxuICAgICAqXG4gICAgICogKipOb3RlIGZvciBUeXBlc2NyaXB0IFVzZXJzOioqIGFkZGluZyBhIHRyYW5zZm9ybSBjaGFuZ2VzIHRoZSByZXR1cm4gdHlwZSBvZiB0aGUgaXRlcmF0aW9uIG9mIHRoaXMgY3Vyc29yLFxuICAgICAqIGl0ICoqZG9lcyBub3QqKiByZXR1cm4gYSBuZXcgaW5zdGFuY2Ugb2YgYSBjdXJzb3IuIFRoaXMgbWVhbnMgd2hlbiBjYWxsaW5nIHByb2plY3QsXG4gICAgICogeW91IHNob3VsZCBhbHdheXMgYXNzaWduIHRoZSByZXN1bHQgdG8gYSBuZXcgdmFyaWFibGUgaW4gb3JkZXIgdG8gZ2V0IGEgY29ycmVjdGx5IHR5cGVkIGN1cnNvciB2YXJpYWJsZS5cbiAgICAgKiBUYWtlIG5vdGUgb2YgdGhlIGZvbGxvd2luZyBleGFtcGxlOlxuICAgICAqXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiBgYGB0eXBlc2NyaXB0XG4gICAgICogY29uc3QgY3Vyc29yOiBBZ2dyZWdhdGlvbkN1cnNvcjx7IGE6IG51bWJlcjsgYjogc3RyaW5nIH0+ID0gY29sbC5hZ2dyZWdhdGUoW10pO1xuICAgICAqIGNvbnN0IHByb2plY3RDdXJzb3IgPSBjdXJzb3IucHJvamVjdDx7IGE6IG51bWJlciB9Pih7IF9pZDogMCwgYTogdHJ1ZSB9KTtcbiAgICAgKiBjb25zdCBhUHJvcE9ubHlBcnJheToge2E6IG51bWJlcn1bXSA9IGF3YWl0IHByb2plY3RDdXJzb3IudG9BcnJheSgpO1xuICAgICAqXG4gICAgICogLy8gb3IgYWx3YXlzIHVzZSBjaGFpbmluZyBhbmQgc2F2ZSB0aGUgZmluYWwgY3Vyc29yXG4gICAgICpcbiAgICAgKiBjb25zdCBjdXJzb3IgPSBjb2xsLmFnZ3JlZ2F0ZSgpLnByb2plY3Q8eyBhOiBzdHJpbmcgfT4oe1xuICAgICAqICAgX2lkOiAwLFxuICAgICAqICAgYTogeyAkY29udmVydDogeyBpbnB1dDogJyRhJywgdG86ICdzdHJpbmcnIH1cbiAgICAgKiB9fSk7XG4gICAgICogYGBgXG4gICAgICovXG4gICAgcHJvamVjdCgkcHJvamVjdCkge1xuICAgICAgICAoMCwgYWJzdHJhY3RfY3Vyc29yXzEuYXNzZXJ0VW5pbml0aWFsaXplZCkodGhpcyk7XG4gICAgICAgIHRoaXNba1BpcGVsaW5lXS5wdXNoKHsgJHByb2plY3QgfSk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICAvKiogQWRkIGEgbG9va3VwIHN0YWdlIHRvIHRoZSBhZ2dyZWdhdGlvbiBwaXBlbGluZSAqL1xuICAgIGxvb2t1cCgkbG9va3VwKSB7XG4gICAgICAgICgwLCBhYnN0cmFjdF9jdXJzb3JfMS5hc3NlcnRVbmluaXRpYWxpemVkKSh0aGlzKTtcbiAgICAgICAgdGhpc1trUGlwZWxpbmVdLnB1c2goeyAkbG9va3VwIH0pO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgLyoqIEFkZCBhIHJlZGFjdCBzdGFnZSB0byB0aGUgYWdncmVnYXRpb24gcGlwZWxpbmUgKi9cbiAgICByZWRhY3QoJHJlZGFjdCkge1xuICAgICAgICAoMCwgYWJzdHJhY3RfY3Vyc29yXzEuYXNzZXJ0VW5pbml0aWFsaXplZCkodGhpcyk7XG4gICAgICAgIHRoaXNba1BpcGVsaW5lXS5wdXNoKHsgJHJlZGFjdCB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIC8qKiBBZGQgYSBza2lwIHN0YWdlIHRvIHRoZSBhZ2dyZWdhdGlvbiBwaXBlbGluZSAqL1xuICAgIHNraXAoJHNraXApIHtcbiAgICAgICAgKDAsIGFic3RyYWN0X2N1cnNvcl8xLmFzc2VydFVuaW5pdGlhbGl6ZWQpKHRoaXMpO1xuICAgICAgICB0aGlzW2tQaXBlbGluZV0ucHVzaCh7ICRza2lwIH0pO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgLyoqIEFkZCBhIHNvcnQgc3RhZ2UgdG8gdGhlIGFnZ3JlZ2F0aW9uIHBpcGVsaW5lICovXG4gICAgc29ydCgkc29ydCkge1xuICAgICAgICAoMCwgYWJzdHJhY3RfY3Vyc29yXzEuYXNzZXJ0VW5pbml0aWFsaXplZCkodGhpcyk7XG4gICAgICAgIHRoaXNba1BpcGVsaW5lXS5wdXNoKHsgJHNvcnQgfSk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICAvKiogQWRkIGEgdW53aW5kIHN0YWdlIHRvIHRoZSBhZ2dyZWdhdGlvbiBwaXBlbGluZSAqL1xuICAgIHVud2luZCgkdW53aW5kKSB7XG4gICAgICAgICgwLCBhYnN0cmFjdF9jdXJzb3JfMS5hc3NlcnRVbmluaXRpYWxpemVkKSh0aGlzKTtcbiAgICAgICAgdGhpc1trUGlwZWxpbmVdLnB1c2goeyAkdW53aW5kIH0pO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgLyoqIEFkZCBhIGdlb05lYXIgc3RhZ2UgdG8gdGhlIGFnZ3JlZ2F0aW9uIHBpcGVsaW5lICovXG4gICAgZ2VvTmVhcigkZ2VvTmVhcikge1xuICAgICAgICAoMCwgYWJzdHJhY3RfY3Vyc29yXzEuYXNzZXJ0VW5pbml0aWFsaXplZCkodGhpcyk7XG4gICAgICAgIHRoaXNba1BpcGVsaW5lXS5wdXNoKHsgJGdlb05lYXIgfSk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbn1cbmV4cG9ydHMuQWdncmVnYXRpb25DdXJzb3IgPSBBZ2dyZWdhdGlvbkN1cnNvcjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFnZ3JlZ2F0aW9uX2N1cnNvci5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/cursor/aggregation_cursor.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/cursor/change_stream_cursor.js":
/*!*************************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/cursor/change_stream_cursor.js ***!
  \*************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.ChangeStreamCursor = void 0;\nconst change_stream_1 = __webpack_require__(/*! ../change_stream */ \"(api)/../server/node_modules/mongodb/lib/change_stream.js\");\nconst constants_1 = __webpack_require__(/*! ../constants */ \"(api)/../server/node_modules/mongodb/lib/constants.js\");\nconst aggregate_1 = __webpack_require__(/*! ../operations/aggregate */ \"(api)/../server/node_modules/mongodb/lib/operations/aggregate.js\");\nconst execute_operation_1 = __webpack_require__(/*! ../operations/execute_operation */ \"(api)/../server/node_modules/mongodb/lib/operations/execute_operation.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\nconst abstract_cursor_1 = __webpack_require__(/*! ./abstract_cursor */ \"(api)/../server/node_modules/mongodb/lib/cursor/abstract_cursor.js\");\n/** @internal */\nclass ChangeStreamCursor extends abstract_cursor_1.AbstractCursor {\n    constructor(client, namespace, pipeline = [], options = {}) {\n        super(client, namespace, options);\n        this.pipeline = pipeline;\n        this.options = options;\n        this._resumeToken = null;\n        this.startAtOperationTime = options.startAtOperationTime;\n        if (options.startAfter) {\n            this.resumeToken = options.startAfter;\n        }\n        else if (options.resumeAfter) {\n            this.resumeToken = options.resumeAfter;\n        }\n    }\n    set resumeToken(token) {\n        this._resumeToken = token;\n        this.emit(change_stream_1.ChangeStream.RESUME_TOKEN_CHANGED, token);\n    }\n    get resumeToken() {\n        return this._resumeToken;\n    }\n    get resumeOptions() {\n        const options = {\n            ...this.options\n        };\n        for (const key of ['resumeAfter', 'startAfter', 'startAtOperationTime']) {\n            delete options[key];\n        }\n        if (this.resumeToken != null) {\n            if (this.options.startAfter && !this.hasReceived) {\n                options.startAfter = this.resumeToken;\n            }\n            else {\n                options.resumeAfter = this.resumeToken;\n            }\n        }\n        else if (this.startAtOperationTime != null && (0, utils_1.maxWireVersion)(this.server) >= 7) {\n            options.startAtOperationTime = this.startAtOperationTime;\n        }\n        return options;\n    }\n    cacheResumeToken(resumeToken) {\n        if (this.bufferedCount() === 0 && this.postBatchResumeToken) {\n            this.resumeToken = this.postBatchResumeToken;\n        }\n        else {\n            this.resumeToken = resumeToken;\n        }\n        this.hasReceived = true;\n    }\n    _processBatch(response) {\n        const cursor = response.cursor;\n        if (cursor.postBatchResumeToken) {\n            this.postBatchResumeToken = response.cursor.postBatchResumeToken;\n            const batch = 'firstBatch' in response.cursor ? response.cursor.firstBatch : response.cursor.nextBatch;\n            if (batch.length === 0) {\n                this.resumeToken = cursor.postBatchResumeToken;\n            }\n        }\n    }\n    clone() {\n        return new ChangeStreamCursor(this.client, this.namespace, this.pipeline, {\n            ...this.cursorOptions\n        });\n    }\n    _initialize(session, callback) {\n        const aggregateOperation = new aggregate_1.AggregateOperation(this.namespace, this.pipeline, {\n            ...this.cursorOptions,\n            ...this.options,\n            session\n        });\n        (0, execute_operation_1.executeOperation)(session.client, aggregateOperation, (err, response) => {\n            if (err || response == null) {\n                return callback(err);\n            }\n            const server = aggregateOperation.server;\n            this.maxWireVersion = (0, utils_1.maxWireVersion)(server);\n            if (this.startAtOperationTime == null &&\n                this.resumeAfter == null &&\n                this.startAfter == null &&\n                this.maxWireVersion >= 7) {\n                this.startAtOperationTime = response.operationTime;\n            }\n            this._processBatch(response);\n            this.emit(constants_1.INIT, response);\n            this.emit(constants_1.RESPONSE);\n            // TODO: NODE-2882\n            callback(undefined, { server, session, response });\n        });\n    }\n    _getMore(batchSize, callback) {\n        super._getMore(batchSize, (err, response) => {\n            if (err) {\n                return callback(err);\n            }\n            this.maxWireVersion = (0, utils_1.maxWireVersion)(this.server);\n            this._processBatch(response);\n            this.emit(change_stream_1.ChangeStream.MORE, response);\n            this.emit(change_stream_1.ChangeStream.RESPONSE);\n            callback(err, response);\n        });\n    }\n}\nexports.ChangeStreamCursor = ChangeStreamCursor;\n//# sourceMappingURL=change_stream_cursor.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jdXJzb3IvY2hhbmdlX3N0cmVhbV9jdXJzb3IuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsMEJBQTBCO0FBQzFCLHdCQUF3QixtQkFBTyxDQUFDLG1GQUFrQjtBQUNsRCxvQkFBb0IsbUJBQU8sQ0FBQywyRUFBYztBQUMxQyxvQkFBb0IsbUJBQU8sQ0FBQyxpR0FBeUI7QUFDckQsNEJBQTRCLG1CQUFPLENBQUMsaUhBQWlDO0FBQ3JFLGdCQUFnQixtQkFBTyxDQUFDLG1FQUFVO0FBQ2xDLDBCQUEwQixtQkFBTyxDQUFDLDZGQUFtQjtBQUNyRDtBQUNBO0FBQ0EsOERBQThEO0FBQzlEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQywyQkFBMkI7QUFDN0QsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLDBCQUEwQjtBQUMxQiIsInNvdXJjZXMiOlsiRDpcXHNhbG9uaVxcYXBwcmFpc2FsLXN5c3RlbVxcc2VydmVyXFxub2RlX21vZHVsZXNcXG1vbmdvZGJcXGxpYlxcY3Vyc29yXFxjaGFuZ2Vfc3RyZWFtX2N1cnNvci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuQ2hhbmdlU3RyZWFtQ3Vyc29yID0gdm9pZCAwO1xuY29uc3QgY2hhbmdlX3N0cmVhbV8xID0gcmVxdWlyZShcIi4uL2NoYW5nZV9zdHJlYW1cIik7XG5jb25zdCBjb25zdGFudHNfMSA9IHJlcXVpcmUoXCIuLi9jb25zdGFudHNcIik7XG5jb25zdCBhZ2dyZWdhdGVfMSA9IHJlcXVpcmUoXCIuLi9vcGVyYXRpb25zL2FnZ3JlZ2F0ZVwiKTtcbmNvbnN0IGV4ZWN1dGVfb3BlcmF0aW9uXzEgPSByZXF1aXJlKFwiLi4vb3BlcmF0aW9ucy9leGVjdXRlX29wZXJhdGlvblwiKTtcbmNvbnN0IHV0aWxzXzEgPSByZXF1aXJlKFwiLi4vdXRpbHNcIik7XG5jb25zdCBhYnN0cmFjdF9jdXJzb3JfMSA9IHJlcXVpcmUoXCIuL2Fic3RyYWN0X2N1cnNvclwiKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIENoYW5nZVN0cmVhbUN1cnNvciBleHRlbmRzIGFic3RyYWN0X2N1cnNvcl8xLkFic3RyYWN0Q3Vyc29yIHtcbiAgICBjb25zdHJ1Y3RvcihjbGllbnQsIG5hbWVzcGFjZSwgcGlwZWxpbmUgPSBbXSwgb3B0aW9ucyA9IHt9KSB7XG4gICAgICAgIHN1cGVyKGNsaWVudCwgbmFtZXNwYWNlLCBvcHRpb25zKTtcbiAgICAgICAgdGhpcy5waXBlbGluZSA9IHBpcGVsaW5lO1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuICAgICAgICB0aGlzLl9yZXN1bWVUb2tlbiA9IG51bGw7XG4gICAgICAgIHRoaXMuc3RhcnRBdE9wZXJhdGlvblRpbWUgPSBvcHRpb25zLnN0YXJ0QXRPcGVyYXRpb25UaW1lO1xuICAgICAgICBpZiAob3B0aW9ucy5zdGFydEFmdGVyKSB7XG4gICAgICAgICAgICB0aGlzLnJlc3VtZVRva2VuID0gb3B0aW9ucy5zdGFydEFmdGVyO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKG9wdGlvbnMucmVzdW1lQWZ0ZXIpIHtcbiAgICAgICAgICAgIHRoaXMucmVzdW1lVG9rZW4gPSBvcHRpb25zLnJlc3VtZUFmdGVyO1xuICAgICAgICB9XG4gICAgfVxuICAgIHNldCByZXN1bWVUb2tlbih0b2tlbikge1xuICAgICAgICB0aGlzLl9yZXN1bWVUb2tlbiA9IHRva2VuO1xuICAgICAgICB0aGlzLmVtaXQoY2hhbmdlX3N0cmVhbV8xLkNoYW5nZVN0cmVhbS5SRVNVTUVfVE9LRU5fQ0hBTkdFRCwgdG9rZW4pO1xuICAgIH1cbiAgICBnZXQgcmVzdW1lVG9rZW4oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9yZXN1bWVUb2tlbjtcbiAgICB9XG4gICAgZ2V0IHJlc3VtZU9wdGlvbnMoKSB7XG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICAgICAgICAuLi50aGlzLm9wdGlvbnNcbiAgICAgICAgfTtcbiAgICAgICAgZm9yIChjb25zdCBrZXkgb2YgWydyZXN1bWVBZnRlcicsICdzdGFydEFmdGVyJywgJ3N0YXJ0QXRPcGVyYXRpb25UaW1lJ10pIHtcbiAgICAgICAgICAgIGRlbGV0ZSBvcHRpb25zW2tleV07XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMucmVzdW1lVG9rZW4gIT0gbnVsbCkge1xuICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5zdGFydEFmdGVyICYmICF0aGlzLmhhc1JlY2VpdmVkKSB7XG4gICAgICAgICAgICAgICAgb3B0aW9ucy5zdGFydEFmdGVyID0gdGhpcy5yZXN1bWVUb2tlbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIG9wdGlvbnMucmVzdW1lQWZ0ZXIgPSB0aGlzLnJlc3VtZVRva2VuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHRoaXMuc3RhcnRBdE9wZXJhdGlvblRpbWUgIT0gbnVsbCAmJiAoMCwgdXRpbHNfMS5tYXhXaXJlVmVyc2lvbikodGhpcy5zZXJ2ZXIpID49IDcpIHtcbiAgICAgICAgICAgIG9wdGlvbnMuc3RhcnRBdE9wZXJhdGlvblRpbWUgPSB0aGlzLnN0YXJ0QXRPcGVyYXRpb25UaW1lO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBvcHRpb25zO1xuICAgIH1cbiAgICBjYWNoZVJlc3VtZVRva2VuKHJlc3VtZVRva2VuKSB7XG4gICAgICAgIGlmICh0aGlzLmJ1ZmZlcmVkQ291bnQoKSA9PT0gMCAmJiB0aGlzLnBvc3RCYXRjaFJlc3VtZVRva2VuKSB7XG4gICAgICAgICAgICB0aGlzLnJlc3VtZVRva2VuID0gdGhpcy5wb3N0QmF0Y2hSZXN1bWVUb2tlbjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMucmVzdW1lVG9rZW4gPSByZXN1bWVUb2tlbjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmhhc1JlY2VpdmVkID0gdHJ1ZTtcbiAgICB9XG4gICAgX3Byb2Nlc3NCYXRjaChyZXNwb25zZSkge1xuICAgICAgICBjb25zdCBjdXJzb3IgPSByZXNwb25zZS5jdXJzb3I7XG4gICAgICAgIGlmIChjdXJzb3IucG9zdEJhdGNoUmVzdW1lVG9rZW4pIHtcbiAgICAgICAgICAgIHRoaXMucG9zdEJhdGNoUmVzdW1lVG9rZW4gPSByZXNwb25zZS5jdXJzb3IucG9zdEJhdGNoUmVzdW1lVG9rZW47XG4gICAgICAgICAgICBjb25zdCBiYXRjaCA9ICdmaXJzdEJhdGNoJyBpbiByZXNwb25zZS5jdXJzb3IgPyByZXNwb25zZS5jdXJzb3IuZmlyc3RCYXRjaCA6IHJlc3BvbnNlLmN1cnNvci5uZXh0QmF0Y2g7XG4gICAgICAgICAgICBpZiAoYmF0Y2gubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZXN1bWVUb2tlbiA9IGN1cnNvci5wb3N0QmF0Y2hSZXN1bWVUb2tlbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBjbG9uZSgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBDaGFuZ2VTdHJlYW1DdXJzb3IodGhpcy5jbGllbnQsIHRoaXMubmFtZXNwYWNlLCB0aGlzLnBpcGVsaW5lLCB7XG4gICAgICAgICAgICAuLi50aGlzLmN1cnNvck9wdGlvbnNcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIF9pbml0aWFsaXplKHNlc3Npb24sIGNhbGxiYWNrKSB7XG4gICAgICAgIGNvbnN0IGFnZ3JlZ2F0ZU9wZXJhdGlvbiA9IG5ldyBhZ2dyZWdhdGVfMS5BZ2dyZWdhdGVPcGVyYXRpb24odGhpcy5uYW1lc3BhY2UsIHRoaXMucGlwZWxpbmUsIHtcbiAgICAgICAgICAgIC4uLnRoaXMuY3Vyc29yT3B0aW9ucyxcbiAgICAgICAgICAgIC4uLnRoaXMub3B0aW9ucyxcbiAgICAgICAgICAgIHNlc3Npb25cbiAgICAgICAgfSk7XG4gICAgICAgICgwLCBleGVjdXRlX29wZXJhdGlvbl8xLmV4ZWN1dGVPcGVyYXRpb24pKHNlc3Npb24uY2xpZW50LCBhZ2dyZWdhdGVPcGVyYXRpb24sIChlcnIsIHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICBpZiAoZXJyIHx8IHJlc3BvbnNlID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHNlcnZlciA9IGFnZ3JlZ2F0ZU9wZXJhdGlvbi5zZXJ2ZXI7XG4gICAgICAgICAgICB0aGlzLm1heFdpcmVWZXJzaW9uID0gKDAsIHV0aWxzXzEubWF4V2lyZVZlcnNpb24pKHNlcnZlcik7XG4gICAgICAgICAgICBpZiAodGhpcy5zdGFydEF0T3BlcmF0aW9uVGltZSA9PSBudWxsICYmXG4gICAgICAgICAgICAgICAgdGhpcy5yZXN1bWVBZnRlciA9PSBudWxsICYmXG4gICAgICAgICAgICAgICAgdGhpcy5zdGFydEFmdGVyID09IG51bGwgJiZcbiAgICAgICAgICAgICAgICB0aGlzLm1heFdpcmVWZXJzaW9uID49IDcpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXJ0QXRPcGVyYXRpb25UaW1lID0gcmVzcG9uc2Uub3BlcmF0aW9uVGltZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX3Byb2Nlc3NCYXRjaChyZXNwb25zZSk7XG4gICAgICAgICAgICB0aGlzLmVtaXQoY29uc3RhbnRzXzEuSU5JVCwgcmVzcG9uc2UpO1xuICAgICAgICAgICAgdGhpcy5lbWl0KGNvbnN0YW50c18xLlJFU1BPTlNFKTtcbiAgICAgICAgICAgIC8vIFRPRE86IE5PREUtMjg4MlxuICAgICAgICAgICAgY2FsbGJhY2sodW5kZWZpbmVkLCB7IHNlcnZlciwgc2Vzc2lvbiwgcmVzcG9uc2UgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBfZ2V0TW9yZShiYXRjaFNpemUsIGNhbGxiYWNrKSB7XG4gICAgICAgIHN1cGVyLl9nZXRNb3JlKGJhdGNoU2l6ZSwgKGVyciwgcmVzcG9uc2UpID0+IHtcbiAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMubWF4V2lyZVZlcnNpb24gPSAoMCwgdXRpbHNfMS5tYXhXaXJlVmVyc2lvbikodGhpcy5zZXJ2ZXIpO1xuICAgICAgICAgICAgdGhpcy5fcHJvY2Vzc0JhdGNoKHJlc3BvbnNlKTtcbiAgICAgICAgICAgIHRoaXMuZW1pdChjaGFuZ2Vfc3RyZWFtXzEuQ2hhbmdlU3RyZWFtLk1PUkUsIHJlc3BvbnNlKTtcbiAgICAgICAgICAgIHRoaXMuZW1pdChjaGFuZ2Vfc3RyZWFtXzEuQ2hhbmdlU3RyZWFtLlJFU1BPTlNFKTtcbiAgICAgICAgICAgIGNhbGxiYWNrKGVyciwgcmVzcG9uc2UpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5leHBvcnRzLkNoYW5nZVN0cmVhbUN1cnNvciA9IENoYW5nZVN0cmVhbUN1cnNvcjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWNoYW5nZV9zdHJlYW1fY3Vyc29yLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/cursor/change_stream_cursor.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/cursor/find_cursor.js":
/*!****************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/cursor/find_cursor.js ***!
  \****************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.FindCursor = exports.FLAGS = void 0;\nconst bson_1 = __webpack_require__(/*! ../bson */ \"(api)/../server/node_modules/mongodb/lib/bson.js\");\nconst error_1 = __webpack_require__(/*! ../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst count_1 = __webpack_require__(/*! ../operations/count */ \"(api)/../server/node_modules/mongodb/lib/operations/count.js\");\nconst execute_operation_1 = __webpack_require__(/*! ../operations/execute_operation */ \"(api)/../server/node_modules/mongodb/lib/operations/execute_operation.js\");\nconst find_1 = __webpack_require__(/*! ../operations/find */ \"(api)/../server/node_modules/mongodb/lib/operations/find.js\");\nconst sort_1 = __webpack_require__(/*! ../sort */ \"(api)/../server/node_modules/mongodb/lib/sort.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\nconst abstract_cursor_1 = __webpack_require__(/*! ./abstract_cursor */ \"(api)/../server/node_modules/mongodb/lib/cursor/abstract_cursor.js\");\n/** @internal */\nconst kFilter = Symbol('filter');\n/** @internal */\nconst kNumReturned = Symbol('numReturned');\n/** @internal */\nconst kBuiltOptions = Symbol('builtOptions');\n/** @public Flags allowed for cursor */\nexports.FLAGS = [\n    'tailable',\n    'oplogReplay',\n    'noCursorTimeout',\n    'awaitData',\n    'exhaust',\n    'partial'\n];\n/** @public */\nclass FindCursor extends abstract_cursor_1.AbstractCursor {\n    /** @internal */\n    constructor(client, namespace, filter = {}, options = {}) {\n        super(client, namespace, options);\n        this[kFilter] = filter;\n        this[kBuiltOptions] = options;\n        if (options.sort != null) {\n            this[kBuiltOptions].sort = (0, sort_1.formatSort)(options.sort);\n        }\n    }\n    clone() {\n        const clonedOptions = (0, utils_1.mergeOptions)({}, this[kBuiltOptions]);\n        delete clonedOptions.session;\n        return new FindCursor(this.client, this.namespace, this[kFilter], {\n            ...clonedOptions\n        });\n    }\n    map(transform) {\n        return super.map(transform);\n    }\n    /** @internal */\n    _initialize(session, callback) {\n        const findOperation = new find_1.FindOperation(undefined, this.namespace, this[kFilter], {\n            ...this[kBuiltOptions],\n            ...this.cursorOptions,\n            session\n        });\n        (0, execute_operation_1.executeOperation)(this.client, findOperation, (err, response) => {\n            if (err || response == null)\n                return callback(err);\n            // TODO: We only need this for legacy queries that do not support `limit`, maybe\n            //       the value should only be saved in those cases.\n            if (response.cursor) {\n                this[kNumReturned] = response.cursor.firstBatch.length;\n            }\n            else {\n                this[kNumReturned] = response.documents ? response.documents.length : 0;\n            }\n            // TODO: NODE-2882\n            callback(undefined, { server: findOperation.server, session, response });\n        });\n    }\n    /** @internal */\n    _getMore(batchSize, callback) {\n        // NOTE: this is to support client provided limits in pre-command servers\n        const numReturned = this[kNumReturned];\n        if (numReturned) {\n            const limit = this[kBuiltOptions].limit;\n            batchSize =\n                limit && limit > 0 && numReturned + batchSize > limit ? limit - numReturned : batchSize;\n            if (batchSize <= 0) {\n                this.close().finally(() => callback(undefined, { cursor: { id: bson_1.Long.ZERO, nextBatch: [] } }));\n                return;\n            }\n        }\n        super._getMore(batchSize, (err, response) => {\n            if (err)\n                return callback(err);\n            // TODO: wrap this in some logic to prevent it from happening if we don't need this support\n            if (response) {\n                this[kNumReturned] = this[kNumReturned] + response.cursor.nextBatch.length;\n            }\n            callback(undefined, response);\n        });\n    }\n    /**\n     * Get the count of documents for this cursor\n     * @deprecated Use `collection.estimatedDocumentCount` or `collection.countDocuments` instead\n     */\n    async count(options) {\n        (0, utils_1.emitWarningOnce)('cursor.count is deprecated and will be removed in the next major version, please use `collection.estimatedDocumentCount` or `collection.countDocuments` instead ');\n        if (typeof options === 'boolean') {\n            throw new error_1.MongoInvalidArgumentError('Invalid first parameter to count');\n        }\n        return (0, execute_operation_1.executeOperation)(this.client, new count_1.CountOperation(this.namespace, this[kFilter], {\n            ...this[kBuiltOptions],\n            ...this.cursorOptions,\n            ...options\n        }));\n    }\n    /** Execute the explain for the cursor */\n    async explain(verbosity) {\n        return (0, execute_operation_1.executeOperation)(this.client, new find_1.FindOperation(undefined, this.namespace, this[kFilter], {\n            ...this[kBuiltOptions],\n            ...this.cursorOptions,\n            explain: verbosity ?? true\n        }));\n    }\n    /** Set the cursor query */\n    filter(filter) {\n        (0, abstract_cursor_1.assertUninitialized)(this);\n        this[kFilter] = filter;\n        return this;\n    }\n    /**\n     * Set the cursor hint\n     *\n     * @param hint - If specified, then the query system will only consider plans using the hinted index.\n     */\n    hint(hint) {\n        (0, abstract_cursor_1.assertUninitialized)(this);\n        this[kBuiltOptions].hint = hint;\n        return this;\n    }\n    /**\n     * Set the cursor min\n     *\n     * @param min - Specify a $min value to specify the inclusive lower bound for a specific index in order to constrain the results of find(). The $min specifies the lower bound for all keys of a specific index in order.\n     */\n    min(min) {\n        (0, abstract_cursor_1.assertUninitialized)(this);\n        this[kBuiltOptions].min = min;\n        return this;\n    }\n    /**\n     * Set the cursor max\n     *\n     * @param max - Specify a $max value to specify the exclusive upper bound for a specific index in order to constrain the results of find(). The $max specifies the upper bound for all keys of a specific index in order.\n     */\n    max(max) {\n        (0, abstract_cursor_1.assertUninitialized)(this);\n        this[kBuiltOptions].max = max;\n        return this;\n    }\n    /**\n     * Set the cursor returnKey.\n     * If set to true, modifies the cursor to only return the index field or fields for the results of the query, rather than documents.\n     * If set to true and the query does not use an index to perform the read operation, the returned documents will not contain any fields.\n     *\n     * @param value - the returnKey value.\n     */\n    returnKey(value) {\n        (0, abstract_cursor_1.assertUninitialized)(this);\n        this[kBuiltOptions].returnKey = value;\n        return this;\n    }\n    /**\n     * Modifies the output of a query by adding a field $recordId to matching documents. $recordId is the internal key which uniquely identifies a document in a collection.\n     *\n     * @param value - The $showDiskLoc option has now been deprecated and replaced with the showRecordId field. $showDiskLoc will still be accepted for OP_QUERY stye find.\n     */\n    showRecordId(value) {\n        (0, abstract_cursor_1.assertUninitialized)(this);\n        this[kBuiltOptions].showRecordId = value;\n        return this;\n    }\n    /**\n     * Add a query modifier to the cursor query\n     *\n     * @param name - The query modifier (must start with $, such as $orderby etc)\n     * @param value - The modifier value.\n     */\n    addQueryModifier(name, value) {\n        (0, abstract_cursor_1.assertUninitialized)(this);\n        if (name[0] !== '$') {\n            throw new error_1.MongoInvalidArgumentError(`${name} is not a valid query modifier`);\n        }\n        // Strip of the $\n        const field = name.substr(1);\n        // NOTE: consider some TS magic for this\n        switch (field) {\n            case 'comment':\n                this[kBuiltOptions].comment = value;\n                break;\n            case 'explain':\n                this[kBuiltOptions].explain = value;\n                break;\n            case 'hint':\n                this[kBuiltOptions].hint = value;\n                break;\n            case 'max':\n                this[kBuiltOptions].max = value;\n                break;\n            case 'maxTimeMS':\n                this[kBuiltOptions].maxTimeMS = value;\n                break;\n            case 'min':\n                this[kBuiltOptions].min = value;\n                break;\n            case 'orderby':\n                this[kBuiltOptions].sort = (0, sort_1.formatSort)(value);\n                break;\n            case 'query':\n                this[kFilter] = value;\n                break;\n            case 'returnKey':\n                this[kBuiltOptions].returnKey = value;\n                break;\n            case 'showDiskLoc':\n                this[kBuiltOptions].showRecordId = value;\n                break;\n            default:\n                throw new error_1.MongoInvalidArgumentError(`Invalid query modifier: ${name}`);\n        }\n        return this;\n    }\n    /**\n     * Add a comment to the cursor query allowing for tracking the comment in the log.\n     *\n     * @param value - The comment attached to this query.\n     */\n    comment(value) {\n        (0, abstract_cursor_1.assertUninitialized)(this);\n        this[kBuiltOptions].comment = value;\n        return this;\n    }\n    /**\n     * Set a maxAwaitTimeMS on a tailing cursor query to allow to customize the timeout value for the option awaitData (Only supported on MongoDB 3.2 or higher, ignored otherwise)\n     *\n     * @param value - Number of milliseconds to wait before aborting the tailed query.\n     */\n    maxAwaitTimeMS(value) {\n        (0, abstract_cursor_1.assertUninitialized)(this);\n        if (typeof value !== 'number') {\n            throw new error_1.MongoInvalidArgumentError('Argument for maxAwaitTimeMS must be a number');\n        }\n        this[kBuiltOptions].maxAwaitTimeMS = value;\n        return this;\n    }\n    /**\n     * Set a maxTimeMS on the cursor query, allowing for hard timeout limits on queries (Only supported on MongoDB 2.6 or higher)\n     *\n     * @param value - Number of milliseconds to wait before aborting the query.\n     */\n    maxTimeMS(value) {\n        (0, abstract_cursor_1.assertUninitialized)(this);\n        if (typeof value !== 'number') {\n            throw new error_1.MongoInvalidArgumentError('Argument for maxTimeMS must be a number');\n        }\n        this[kBuiltOptions].maxTimeMS = value;\n        return this;\n    }\n    /**\n     * Add a project stage to the aggregation pipeline\n     *\n     * @remarks\n     * In order to strictly type this function you must provide an interface\n     * that represents the effect of your projection on the result documents.\n     *\n     * By default chaining a projection to your cursor changes the returned type to the generic\n     * {@link Document} type.\n     * You should specify a parameterized type to have assertions on your final results.\n     *\n     * @example\n     * ```typescript\n     * // Best way\n     * const docs: FindCursor<{ a: number }> = cursor.project<{ a: number }>({ _id: 0, a: true });\n     * // Flexible way\n     * const docs: FindCursor<Document> = cursor.project({ _id: 0, a: true });\n     * ```\n     *\n     * @remarks\n     *\n     * **Note for Typescript Users:** adding a transform changes the return type of the iteration of this cursor,\n     * it **does not** return a new instance of a cursor. This means when calling project,\n     * you should always assign the result to a new variable in order to get a correctly typed cursor variable.\n     * Take note of the following example:\n     *\n     * @example\n     * ```typescript\n     * const cursor: FindCursor<{ a: number; b: string }> = coll.find();\n     * const projectCursor = cursor.project<{ a: number }>({ _id: 0, a: true });\n     * const aPropOnlyArray: {a: number}[] = await projectCursor.toArray();\n     *\n     * // or always use chaining and save the final cursor\n     *\n     * const cursor = coll.find().project<{ a: string }>({\n     *   _id: 0,\n     *   a: { $convert: { input: '$a', to: 'string' }\n     * }});\n     * ```\n     */\n    project(value) {\n        (0, abstract_cursor_1.assertUninitialized)(this);\n        this[kBuiltOptions].projection = value;\n        return this;\n    }\n    /**\n     * Sets the sort order of the cursor query.\n     *\n     * @param sort - The key or keys set for the sort.\n     * @param direction - The direction of the sorting (1 or -1).\n     */\n    sort(sort, direction) {\n        (0, abstract_cursor_1.assertUninitialized)(this);\n        if (this[kBuiltOptions].tailable) {\n            throw new error_1.MongoTailableCursorError('Tailable cursor does not support sorting');\n        }\n        this[kBuiltOptions].sort = (0, sort_1.formatSort)(sort, direction);\n        return this;\n    }\n    /**\n     * Allows disk use for blocking sort operations exceeding 100MB memory. (MongoDB 3.2 or higher)\n     *\n     * @remarks\n     * {@link https://www.mongodb.com/docs/manual/reference/command/find/#find-cmd-allowdiskuse | find command allowDiskUse documentation}\n     */\n    allowDiskUse(allow = true) {\n        (0, abstract_cursor_1.assertUninitialized)(this);\n        if (!this[kBuiltOptions].sort) {\n            throw new error_1.MongoInvalidArgumentError('Option \"allowDiskUse\" requires a sort specification');\n        }\n        // As of 6.0 the default is true. This allows users to get back to the old behavior.\n        if (!allow) {\n            this[kBuiltOptions].allowDiskUse = false;\n            return this;\n        }\n        this[kBuiltOptions].allowDiskUse = true;\n        return this;\n    }\n    /**\n     * Set the collation options for the cursor.\n     *\n     * @param value - The cursor collation options (MongoDB 3.4 or higher) settings for update operation (see 3.4 documentation for available fields).\n     */\n    collation(value) {\n        (0, abstract_cursor_1.assertUninitialized)(this);\n        this[kBuiltOptions].collation = value;\n        return this;\n    }\n    /**\n     * Set the limit for the cursor.\n     *\n     * @param value - The limit for the cursor query.\n     */\n    limit(value) {\n        (0, abstract_cursor_1.assertUninitialized)(this);\n        if (this[kBuiltOptions].tailable) {\n            throw new error_1.MongoTailableCursorError('Tailable cursor does not support limit');\n        }\n        if (typeof value !== 'number') {\n            throw new error_1.MongoInvalidArgumentError('Operation \"limit\" requires an integer');\n        }\n        this[kBuiltOptions].limit = value;\n        return this;\n    }\n    /**\n     * Set the skip for the cursor.\n     *\n     * @param value - The skip for the cursor query.\n     */\n    skip(value) {\n        (0, abstract_cursor_1.assertUninitialized)(this);\n        if (this[kBuiltOptions].tailable) {\n            throw new error_1.MongoTailableCursorError('Tailable cursor does not support skip');\n        }\n        if (typeof value !== 'number') {\n            throw new error_1.MongoInvalidArgumentError('Operation \"skip\" requires an integer');\n        }\n        this[kBuiltOptions].skip = value;\n        return this;\n    }\n}\nexports.FindCursor = FindCursor;\n//# sourceMappingURL=find_cursor.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jdXJzb3IvZmluZF9jdXJzb3IuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0Qsa0JBQWtCLEdBQUcsYUFBYTtBQUNsQyxlQUFlLG1CQUFPLENBQUMsaUVBQVM7QUFDaEMsZ0JBQWdCLG1CQUFPLENBQUMsbUVBQVU7QUFDbEMsZ0JBQWdCLG1CQUFPLENBQUMseUZBQXFCO0FBQzdDLDRCQUE0QixtQkFBTyxDQUFDLGlIQUFpQztBQUNyRSxlQUFlLG1CQUFPLENBQUMsdUZBQW9CO0FBQzNDLGVBQWUsbUJBQU8sQ0FBQyxpRUFBUztBQUNoQyxnQkFBZ0IsbUJBQU8sQ0FBQyxtRUFBVTtBQUNsQywwQkFBMEIsbUJBQU8sQ0FBQyw2RkFBbUI7QUFDckQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4Q0FBOEMsY0FBYztBQUM1RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMERBQTBEO0FBQzFEO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0MsaURBQWlEO0FBQ25GLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlFQUFpRSxVQUFVLHVDQUF1QztBQUNsSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJEQUEyRCxNQUFNO0FBQ2pFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVGQUF1RixLQUFLO0FBQzVGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRLGdCQUFnQjtBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDLFdBQVcscUJBQXFCLFdBQVcsSUFBSSxpQkFBaUI7QUFDaEc7QUFDQSwyREFBMkQsaUJBQWlCO0FBQzVFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0MsV0FBVyxXQUFXO0FBQ3hELDhDQUE4QyxXQUFXLElBQUksaUJBQWlCO0FBQzlFLDhCQUE4QixVQUFVO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBLDRDQUE0QyxXQUFXO0FBQ3ZEO0FBQ0EsY0FBYyxZQUFZO0FBQzFCLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0I7QUFDbEIiLCJzb3VyY2VzIjpbIkQ6XFxzYWxvbmlcXGFwcHJhaXNhbC1zeXN0ZW1cXHNlcnZlclxcbm9kZV9tb2R1bGVzXFxtb25nb2RiXFxsaWJcXGN1cnNvclxcZmluZF9jdXJzb3IuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkZpbmRDdXJzb3IgPSBleHBvcnRzLkZMQUdTID0gdm9pZCAwO1xuY29uc3QgYnNvbl8xID0gcmVxdWlyZShcIi4uL2Jzb25cIik7XG5jb25zdCBlcnJvcl8xID0gcmVxdWlyZShcIi4uL2Vycm9yXCIpO1xuY29uc3QgY291bnRfMSA9IHJlcXVpcmUoXCIuLi9vcGVyYXRpb25zL2NvdW50XCIpO1xuY29uc3QgZXhlY3V0ZV9vcGVyYXRpb25fMSA9IHJlcXVpcmUoXCIuLi9vcGVyYXRpb25zL2V4ZWN1dGVfb3BlcmF0aW9uXCIpO1xuY29uc3QgZmluZF8xID0gcmVxdWlyZShcIi4uL29wZXJhdGlvbnMvZmluZFwiKTtcbmNvbnN0IHNvcnRfMSA9IHJlcXVpcmUoXCIuLi9zb3J0XCIpO1xuY29uc3QgdXRpbHNfMSA9IHJlcXVpcmUoXCIuLi91dGlsc1wiKTtcbmNvbnN0IGFic3RyYWN0X2N1cnNvcl8xID0gcmVxdWlyZShcIi4vYWJzdHJhY3RfY3Vyc29yXCIpO1xuLyoqIEBpbnRlcm5hbCAqL1xuY29uc3Qga0ZpbHRlciA9IFN5bWJvbCgnZmlsdGVyJyk7XG4vKiogQGludGVybmFsICovXG5jb25zdCBrTnVtUmV0dXJuZWQgPSBTeW1ib2woJ251bVJldHVybmVkJyk7XG4vKiogQGludGVybmFsICovXG5jb25zdCBrQnVpbHRPcHRpb25zID0gU3ltYm9sKCdidWlsdE9wdGlvbnMnKTtcbi8qKiBAcHVibGljIEZsYWdzIGFsbG93ZWQgZm9yIGN1cnNvciAqL1xuZXhwb3J0cy5GTEFHUyA9IFtcbiAgICAndGFpbGFibGUnLFxuICAgICdvcGxvZ1JlcGxheScsXG4gICAgJ25vQ3Vyc29yVGltZW91dCcsXG4gICAgJ2F3YWl0RGF0YScsXG4gICAgJ2V4aGF1c3QnLFxuICAgICdwYXJ0aWFsJ1xuXTtcbi8qKiBAcHVibGljICovXG5jbGFzcyBGaW5kQ3Vyc29yIGV4dGVuZHMgYWJzdHJhY3RfY3Vyc29yXzEuQWJzdHJhY3RDdXJzb3Ige1xuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBjb25zdHJ1Y3RvcihjbGllbnQsIG5hbWVzcGFjZSwgZmlsdGVyID0ge30sIG9wdGlvbnMgPSB7fSkge1xuICAgICAgICBzdXBlcihjbGllbnQsIG5hbWVzcGFjZSwgb3B0aW9ucyk7XG4gICAgICAgIHRoaXNba0ZpbHRlcl0gPSBmaWx0ZXI7XG4gICAgICAgIHRoaXNba0J1aWx0T3B0aW9uc10gPSBvcHRpb25zO1xuICAgICAgICBpZiAob3B0aW9ucy5zb3J0ICE9IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXNba0J1aWx0T3B0aW9uc10uc29ydCA9ICgwLCBzb3J0XzEuZm9ybWF0U29ydCkob3B0aW9ucy5zb3J0KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjbG9uZSgpIHtcbiAgICAgICAgY29uc3QgY2xvbmVkT3B0aW9ucyA9ICgwLCB1dGlsc18xLm1lcmdlT3B0aW9ucykoe30sIHRoaXNba0J1aWx0T3B0aW9uc10pO1xuICAgICAgICBkZWxldGUgY2xvbmVkT3B0aW9ucy5zZXNzaW9uO1xuICAgICAgICByZXR1cm4gbmV3IEZpbmRDdXJzb3IodGhpcy5jbGllbnQsIHRoaXMubmFtZXNwYWNlLCB0aGlzW2tGaWx0ZXJdLCB7XG4gICAgICAgICAgICAuLi5jbG9uZWRPcHRpb25zXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBtYXAodHJhbnNmb3JtKSB7XG4gICAgICAgIHJldHVybiBzdXBlci5tYXAodHJhbnNmb3JtKTtcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIF9pbml0aWFsaXplKHNlc3Npb24sIGNhbGxiYWNrKSB7XG4gICAgICAgIGNvbnN0IGZpbmRPcGVyYXRpb24gPSBuZXcgZmluZF8xLkZpbmRPcGVyYXRpb24odW5kZWZpbmVkLCB0aGlzLm5hbWVzcGFjZSwgdGhpc1trRmlsdGVyXSwge1xuICAgICAgICAgICAgLi4udGhpc1trQnVpbHRPcHRpb25zXSxcbiAgICAgICAgICAgIC4uLnRoaXMuY3Vyc29yT3B0aW9ucyxcbiAgICAgICAgICAgIHNlc3Npb25cbiAgICAgICAgfSk7XG4gICAgICAgICgwLCBleGVjdXRlX29wZXJhdGlvbl8xLmV4ZWN1dGVPcGVyYXRpb24pKHRoaXMuY2xpZW50LCBmaW5kT3BlcmF0aW9uLCAoZXJyLCByZXNwb25zZSkgPT4ge1xuICAgICAgICAgICAgaWYgKGVyciB8fCByZXNwb25zZSA9PSBudWxsKVxuICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgICAgICAgICAgLy8gVE9ETzogV2Ugb25seSBuZWVkIHRoaXMgZm9yIGxlZ2FjeSBxdWVyaWVzIHRoYXQgZG8gbm90IHN1cHBvcnQgYGxpbWl0YCwgbWF5YmVcbiAgICAgICAgICAgIC8vICAgICAgIHRoZSB2YWx1ZSBzaG91bGQgb25seSBiZSBzYXZlZCBpbiB0aG9zZSBjYXNlcy5cbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5jdXJzb3IpIHtcbiAgICAgICAgICAgICAgICB0aGlzW2tOdW1SZXR1cm5lZF0gPSByZXNwb25zZS5jdXJzb3IuZmlyc3RCYXRjaC5sZW5ndGg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzW2tOdW1SZXR1cm5lZF0gPSByZXNwb25zZS5kb2N1bWVudHMgPyByZXNwb25zZS5kb2N1bWVudHMubGVuZ3RoIDogMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIFRPRE86IE5PREUtMjg4MlxuICAgICAgICAgICAgY2FsbGJhY2sodW5kZWZpbmVkLCB7IHNlcnZlcjogZmluZE9wZXJhdGlvbi5zZXJ2ZXIsIHNlc3Npb24sIHJlc3BvbnNlIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIF9nZXRNb3JlKGJhdGNoU2l6ZSwgY2FsbGJhY2spIHtcbiAgICAgICAgLy8gTk9URTogdGhpcyBpcyB0byBzdXBwb3J0IGNsaWVudCBwcm92aWRlZCBsaW1pdHMgaW4gcHJlLWNvbW1hbmQgc2VydmVyc1xuICAgICAgICBjb25zdCBudW1SZXR1cm5lZCA9IHRoaXNba051bVJldHVybmVkXTtcbiAgICAgICAgaWYgKG51bVJldHVybmVkKSB7XG4gICAgICAgICAgICBjb25zdCBsaW1pdCA9IHRoaXNba0J1aWx0T3B0aW9uc10ubGltaXQ7XG4gICAgICAgICAgICBiYXRjaFNpemUgPVxuICAgICAgICAgICAgICAgIGxpbWl0ICYmIGxpbWl0ID4gMCAmJiBudW1SZXR1cm5lZCArIGJhdGNoU2l6ZSA+IGxpbWl0ID8gbGltaXQgLSBudW1SZXR1cm5lZCA6IGJhdGNoU2l6ZTtcbiAgICAgICAgICAgIGlmIChiYXRjaFNpemUgPD0gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoKS5maW5hbGx5KCgpID0+IGNhbGxiYWNrKHVuZGVmaW5lZCwgeyBjdXJzb3I6IHsgaWQ6IGJzb25fMS5Mb25nLlpFUk8sIG5leHRCYXRjaDogW10gfSB9KSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHN1cGVyLl9nZXRNb3JlKGJhdGNoU2l6ZSwgKGVyciwgcmVzcG9uc2UpID0+IHtcbiAgICAgICAgICAgIGlmIChlcnIpXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgICAgICAgICAvLyBUT0RPOiB3cmFwIHRoaXMgaW4gc29tZSBsb2dpYyB0byBwcmV2ZW50IGl0IGZyb20gaGFwcGVuaW5nIGlmIHdlIGRvbid0IG5lZWQgdGhpcyBzdXBwb3J0XG4gICAgICAgICAgICBpZiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICB0aGlzW2tOdW1SZXR1cm5lZF0gPSB0aGlzW2tOdW1SZXR1cm5lZF0gKyByZXNwb25zZS5jdXJzb3IubmV4dEJhdGNoLmxlbmd0aDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwgcmVzcG9uc2UpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogR2V0IHRoZSBjb3VudCBvZiBkb2N1bWVudHMgZm9yIHRoaXMgY3Vyc29yXG4gICAgICogQGRlcHJlY2F0ZWQgVXNlIGBjb2xsZWN0aW9uLmVzdGltYXRlZERvY3VtZW50Q291bnRgIG9yIGBjb2xsZWN0aW9uLmNvdW50RG9jdW1lbnRzYCBpbnN0ZWFkXG4gICAgICovXG4gICAgYXN5bmMgY291bnQob3B0aW9ucykge1xuICAgICAgICAoMCwgdXRpbHNfMS5lbWl0V2FybmluZ09uY2UpKCdjdXJzb3IuY291bnQgaXMgZGVwcmVjYXRlZCBhbmQgd2lsbCBiZSByZW1vdmVkIGluIHRoZSBuZXh0IG1ham9yIHZlcnNpb24sIHBsZWFzZSB1c2UgYGNvbGxlY3Rpb24uZXN0aW1hdGVkRG9jdW1lbnRDb3VudGAgb3IgYGNvbGxlY3Rpb24uY291bnREb2N1bWVudHNgIGluc3RlYWQgJyk7XG4gICAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucyA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdJbnZhbGlkIGZpcnN0IHBhcmFtZXRlciB0byBjb3VudCcpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAoMCwgZXhlY3V0ZV9vcGVyYXRpb25fMS5leGVjdXRlT3BlcmF0aW9uKSh0aGlzLmNsaWVudCwgbmV3IGNvdW50XzEuQ291bnRPcGVyYXRpb24odGhpcy5uYW1lc3BhY2UsIHRoaXNba0ZpbHRlcl0sIHtcbiAgICAgICAgICAgIC4uLnRoaXNba0J1aWx0T3B0aW9uc10sXG4gICAgICAgICAgICAuLi50aGlzLmN1cnNvck9wdGlvbnMsXG4gICAgICAgICAgICAuLi5vcHRpb25zXG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgLyoqIEV4ZWN1dGUgdGhlIGV4cGxhaW4gZm9yIHRoZSBjdXJzb3IgKi9cbiAgICBhc3luYyBleHBsYWluKHZlcmJvc2l0eSkge1xuICAgICAgICByZXR1cm4gKDAsIGV4ZWN1dGVfb3BlcmF0aW9uXzEuZXhlY3V0ZU9wZXJhdGlvbikodGhpcy5jbGllbnQsIG5ldyBmaW5kXzEuRmluZE9wZXJhdGlvbih1bmRlZmluZWQsIHRoaXMubmFtZXNwYWNlLCB0aGlzW2tGaWx0ZXJdLCB7XG4gICAgICAgICAgICAuLi50aGlzW2tCdWlsdE9wdGlvbnNdLFxuICAgICAgICAgICAgLi4udGhpcy5jdXJzb3JPcHRpb25zLFxuICAgICAgICAgICAgZXhwbGFpbjogdmVyYm9zaXR5ID8/IHRydWVcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICAvKiogU2V0IHRoZSBjdXJzb3IgcXVlcnkgKi9cbiAgICBmaWx0ZXIoZmlsdGVyKSB7XG4gICAgICAgICgwLCBhYnN0cmFjdF9jdXJzb3JfMS5hc3NlcnRVbmluaXRpYWxpemVkKSh0aGlzKTtcbiAgICAgICAgdGhpc1trRmlsdGVyXSA9IGZpbHRlcjtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNldCB0aGUgY3Vyc29yIGhpbnRcbiAgICAgKlxuICAgICAqIEBwYXJhbSBoaW50IC0gSWYgc3BlY2lmaWVkLCB0aGVuIHRoZSBxdWVyeSBzeXN0ZW0gd2lsbCBvbmx5IGNvbnNpZGVyIHBsYW5zIHVzaW5nIHRoZSBoaW50ZWQgaW5kZXguXG4gICAgICovXG4gICAgaGludChoaW50KSB7XG4gICAgICAgICgwLCBhYnN0cmFjdF9jdXJzb3JfMS5hc3NlcnRVbmluaXRpYWxpemVkKSh0aGlzKTtcbiAgICAgICAgdGhpc1trQnVpbHRPcHRpb25zXS5oaW50ID0gaGludDtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNldCB0aGUgY3Vyc29yIG1pblxuICAgICAqXG4gICAgICogQHBhcmFtIG1pbiAtIFNwZWNpZnkgYSAkbWluIHZhbHVlIHRvIHNwZWNpZnkgdGhlIGluY2x1c2l2ZSBsb3dlciBib3VuZCBmb3IgYSBzcGVjaWZpYyBpbmRleCBpbiBvcmRlciB0byBjb25zdHJhaW4gdGhlIHJlc3VsdHMgb2YgZmluZCgpLiBUaGUgJG1pbiBzcGVjaWZpZXMgdGhlIGxvd2VyIGJvdW5kIGZvciBhbGwga2V5cyBvZiBhIHNwZWNpZmljIGluZGV4IGluIG9yZGVyLlxuICAgICAqL1xuICAgIG1pbihtaW4pIHtcbiAgICAgICAgKDAsIGFic3RyYWN0X2N1cnNvcl8xLmFzc2VydFVuaW5pdGlhbGl6ZWQpKHRoaXMpO1xuICAgICAgICB0aGlzW2tCdWlsdE9wdGlvbnNdLm1pbiA9IG1pbjtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNldCB0aGUgY3Vyc29yIG1heFxuICAgICAqXG4gICAgICogQHBhcmFtIG1heCAtIFNwZWNpZnkgYSAkbWF4IHZhbHVlIHRvIHNwZWNpZnkgdGhlIGV4Y2x1c2l2ZSB1cHBlciBib3VuZCBmb3IgYSBzcGVjaWZpYyBpbmRleCBpbiBvcmRlciB0byBjb25zdHJhaW4gdGhlIHJlc3VsdHMgb2YgZmluZCgpLiBUaGUgJG1heCBzcGVjaWZpZXMgdGhlIHVwcGVyIGJvdW5kIGZvciBhbGwga2V5cyBvZiBhIHNwZWNpZmljIGluZGV4IGluIG9yZGVyLlxuICAgICAqL1xuICAgIG1heChtYXgpIHtcbiAgICAgICAgKDAsIGFic3RyYWN0X2N1cnNvcl8xLmFzc2VydFVuaW5pdGlhbGl6ZWQpKHRoaXMpO1xuICAgICAgICB0aGlzW2tCdWlsdE9wdGlvbnNdLm1heCA9IG1heDtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNldCB0aGUgY3Vyc29yIHJldHVybktleS5cbiAgICAgKiBJZiBzZXQgdG8gdHJ1ZSwgbW9kaWZpZXMgdGhlIGN1cnNvciB0byBvbmx5IHJldHVybiB0aGUgaW5kZXggZmllbGQgb3IgZmllbGRzIGZvciB0aGUgcmVzdWx0cyBvZiB0aGUgcXVlcnksIHJhdGhlciB0aGFuIGRvY3VtZW50cy5cbiAgICAgKiBJZiBzZXQgdG8gdHJ1ZSBhbmQgdGhlIHF1ZXJ5IGRvZXMgbm90IHVzZSBhbiBpbmRleCB0byBwZXJmb3JtIHRoZSByZWFkIG9wZXJhdGlvbiwgdGhlIHJldHVybmVkIGRvY3VtZW50cyB3aWxsIG5vdCBjb250YWluIGFueSBmaWVsZHMuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gdmFsdWUgLSB0aGUgcmV0dXJuS2V5IHZhbHVlLlxuICAgICAqL1xuICAgIHJldHVybktleSh2YWx1ZSkge1xuICAgICAgICAoMCwgYWJzdHJhY3RfY3Vyc29yXzEuYXNzZXJ0VW5pbml0aWFsaXplZCkodGhpcyk7XG4gICAgICAgIHRoaXNba0J1aWx0T3B0aW9uc10ucmV0dXJuS2V5ID0gdmFsdWU7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBNb2RpZmllcyB0aGUgb3V0cHV0IG9mIGEgcXVlcnkgYnkgYWRkaW5nIGEgZmllbGQgJHJlY29yZElkIHRvIG1hdGNoaW5nIGRvY3VtZW50cy4gJHJlY29yZElkIGlzIHRoZSBpbnRlcm5hbCBrZXkgd2hpY2ggdW5pcXVlbHkgaWRlbnRpZmllcyBhIGRvY3VtZW50IGluIGEgY29sbGVjdGlvbi5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB2YWx1ZSAtIFRoZSAkc2hvd0Rpc2tMb2Mgb3B0aW9uIGhhcyBub3cgYmVlbiBkZXByZWNhdGVkIGFuZCByZXBsYWNlZCB3aXRoIHRoZSBzaG93UmVjb3JkSWQgZmllbGQuICRzaG93RGlza0xvYyB3aWxsIHN0aWxsIGJlIGFjY2VwdGVkIGZvciBPUF9RVUVSWSBzdHllIGZpbmQuXG4gICAgICovXG4gICAgc2hvd1JlY29yZElkKHZhbHVlKSB7XG4gICAgICAgICgwLCBhYnN0cmFjdF9jdXJzb3JfMS5hc3NlcnRVbmluaXRpYWxpemVkKSh0aGlzKTtcbiAgICAgICAgdGhpc1trQnVpbHRPcHRpb25zXS5zaG93UmVjb3JkSWQgPSB2YWx1ZTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEFkZCBhIHF1ZXJ5IG1vZGlmaWVyIHRvIHRoZSBjdXJzb3IgcXVlcnlcbiAgICAgKlxuICAgICAqIEBwYXJhbSBuYW1lIC0gVGhlIHF1ZXJ5IG1vZGlmaWVyIChtdXN0IHN0YXJ0IHdpdGggJCwgc3VjaCBhcyAkb3JkZXJieSBldGMpXG4gICAgICogQHBhcmFtIHZhbHVlIC0gVGhlIG1vZGlmaWVyIHZhbHVlLlxuICAgICAqL1xuICAgIGFkZFF1ZXJ5TW9kaWZpZXIobmFtZSwgdmFsdWUpIHtcbiAgICAgICAgKDAsIGFic3RyYWN0X2N1cnNvcl8xLmFzc2VydFVuaW5pdGlhbGl6ZWQpKHRoaXMpO1xuICAgICAgICBpZiAobmFtZVswXSAhPT0gJyQnKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKGAke25hbWV9IGlzIG5vdCBhIHZhbGlkIHF1ZXJ5IG1vZGlmaWVyYCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gU3RyaXAgb2YgdGhlICRcbiAgICAgICAgY29uc3QgZmllbGQgPSBuYW1lLnN1YnN0cigxKTtcbiAgICAgICAgLy8gTk9URTogY29uc2lkZXIgc29tZSBUUyBtYWdpYyBmb3IgdGhpc1xuICAgICAgICBzd2l0Y2ggKGZpZWxkKSB7XG4gICAgICAgICAgICBjYXNlICdjb21tZW50JzpcbiAgICAgICAgICAgICAgICB0aGlzW2tCdWlsdE9wdGlvbnNdLmNvbW1lbnQgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2V4cGxhaW4nOlxuICAgICAgICAgICAgICAgIHRoaXNba0J1aWx0T3B0aW9uc10uZXhwbGFpbiA9IHZhbHVlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnaGludCc6XG4gICAgICAgICAgICAgICAgdGhpc1trQnVpbHRPcHRpb25zXS5oaW50ID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdtYXgnOlxuICAgICAgICAgICAgICAgIHRoaXNba0J1aWx0T3B0aW9uc10ubWF4ID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdtYXhUaW1lTVMnOlxuICAgICAgICAgICAgICAgIHRoaXNba0J1aWx0T3B0aW9uc10ubWF4VGltZU1TID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdtaW4nOlxuICAgICAgICAgICAgICAgIHRoaXNba0J1aWx0T3B0aW9uc10ubWluID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdvcmRlcmJ5JzpcbiAgICAgICAgICAgICAgICB0aGlzW2tCdWlsdE9wdGlvbnNdLnNvcnQgPSAoMCwgc29ydF8xLmZvcm1hdFNvcnQpKHZhbHVlKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3F1ZXJ5JzpcbiAgICAgICAgICAgICAgICB0aGlzW2tGaWx0ZXJdID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdyZXR1cm5LZXknOlxuICAgICAgICAgICAgICAgIHRoaXNba0J1aWx0T3B0aW9uc10ucmV0dXJuS2V5ID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdzaG93RGlza0xvYyc6XG4gICAgICAgICAgICAgICAgdGhpc1trQnVpbHRPcHRpb25zXS5zaG93UmVjb3JkSWQgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcihgSW52YWxpZCBxdWVyeSBtb2RpZmllcjogJHtuYW1lfWApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBZGQgYSBjb21tZW50IHRvIHRoZSBjdXJzb3IgcXVlcnkgYWxsb3dpbmcgZm9yIHRyYWNraW5nIHRoZSBjb21tZW50IGluIHRoZSBsb2cuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gdmFsdWUgLSBUaGUgY29tbWVudCBhdHRhY2hlZCB0byB0aGlzIHF1ZXJ5LlxuICAgICAqL1xuICAgIGNvbW1lbnQodmFsdWUpIHtcbiAgICAgICAgKDAsIGFic3RyYWN0X2N1cnNvcl8xLmFzc2VydFVuaW5pdGlhbGl6ZWQpKHRoaXMpO1xuICAgICAgICB0aGlzW2tCdWlsdE9wdGlvbnNdLmNvbW1lbnQgPSB2YWx1ZTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNldCBhIG1heEF3YWl0VGltZU1TIG9uIGEgdGFpbGluZyBjdXJzb3IgcXVlcnkgdG8gYWxsb3cgdG8gY3VzdG9taXplIHRoZSB0aW1lb3V0IHZhbHVlIGZvciB0aGUgb3B0aW9uIGF3YWl0RGF0YSAoT25seSBzdXBwb3J0ZWQgb24gTW9uZ29EQiAzLjIgb3IgaGlnaGVyLCBpZ25vcmVkIG90aGVyd2lzZSlcbiAgICAgKlxuICAgICAqIEBwYXJhbSB2YWx1ZSAtIE51bWJlciBvZiBtaWxsaXNlY29uZHMgdG8gd2FpdCBiZWZvcmUgYWJvcnRpbmcgdGhlIHRhaWxlZCBxdWVyeS5cbiAgICAgKi9cbiAgICBtYXhBd2FpdFRpbWVNUyh2YWx1ZSkge1xuICAgICAgICAoMCwgYWJzdHJhY3RfY3Vyc29yXzEuYXNzZXJ0VW5pbml0aWFsaXplZCkodGhpcyk7XG4gICAgICAgIGlmICh0eXBlb2YgdmFsdWUgIT09ICdudW1iZXInKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdBcmd1bWVudCBmb3IgbWF4QXdhaXRUaW1lTVMgbXVzdCBiZSBhIG51bWJlcicpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXNba0J1aWx0T3B0aW9uc10ubWF4QXdhaXRUaW1lTVMgPSB2YWx1ZTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNldCBhIG1heFRpbWVNUyBvbiB0aGUgY3Vyc29yIHF1ZXJ5LCBhbGxvd2luZyBmb3IgaGFyZCB0aW1lb3V0IGxpbWl0cyBvbiBxdWVyaWVzIChPbmx5IHN1cHBvcnRlZCBvbiBNb25nb0RCIDIuNiBvciBoaWdoZXIpXG4gICAgICpcbiAgICAgKiBAcGFyYW0gdmFsdWUgLSBOdW1iZXIgb2YgbWlsbGlzZWNvbmRzIHRvIHdhaXQgYmVmb3JlIGFib3J0aW5nIHRoZSBxdWVyeS5cbiAgICAgKi9cbiAgICBtYXhUaW1lTVModmFsdWUpIHtcbiAgICAgICAgKDAsIGFic3RyYWN0X2N1cnNvcl8xLmFzc2VydFVuaW5pdGlhbGl6ZWQpKHRoaXMpO1xuICAgICAgICBpZiAodHlwZW9mIHZhbHVlICE9PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignQXJndW1lbnQgZm9yIG1heFRpbWVNUyBtdXN0IGJlIGEgbnVtYmVyJyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpc1trQnVpbHRPcHRpb25zXS5tYXhUaW1lTVMgPSB2YWx1ZTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEFkZCBhIHByb2plY3Qgc3RhZ2UgdG8gdGhlIGFnZ3JlZ2F0aW9uIHBpcGVsaW5lXG4gICAgICpcbiAgICAgKiBAcmVtYXJrc1xuICAgICAqIEluIG9yZGVyIHRvIHN0cmljdGx5IHR5cGUgdGhpcyBmdW5jdGlvbiB5b3UgbXVzdCBwcm92aWRlIGFuIGludGVyZmFjZVxuICAgICAqIHRoYXQgcmVwcmVzZW50cyB0aGUgZWZmZWN0IG9mIHlvdXIgcHJvamVjdGlvbiBvbiB0aGUgcmVzdWx0IGRvY3VtZW50cy5cbiAgICAgKlxuICAgICAqIEJ5IGRlZmF1bHQgY2hhaW5pbmcgYSBwcm9qZWN0aW9uIHRvIHlvdXIgY3Vyc29yIGNoYW5nZXMgdGhlIHJldHVybmVkIHR5cGUgdG8gdGhlIGdlbmVyaWNcbiAgICAgKiB7QGxpbmsgRG9jdW1lbnR9IHR5cGUuXG4gICAgICogWW91IHNob3VsZCBzcGVjaWZ5IGEgcGFyYW1ldGVyaXplZCB0eXBlIHRvIGhhdmUgYXNzZXJ0aW9ucyBvbiB5b3VyIGZpbmFsIHJlc3VsdHMuXG4gICAgICpcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIGBgYHR5cGVzY3JpcHRcbiAgICAgKiAvLyBCZXN0IHdheVxuICAgICAqIGNvbnN0IGRvY3M6IEZpbmRDdXJzb3I8eyBhOiBudW1iZXIgfT4gPSBjdXJzb3IucHJvamVjdDx7IGE6IG51bWJlciB9Pih7IF9pZDogMCwgYTogdHJ1ZSB9KTtcbiAgICAgKiAvLyBGbGV4aWJsZSB3YXlcbiAgICAgKiBjb25zdCBkb2NzOiBGaW5kQ3Vyc29yPERvY3VtZW50PiA9IGN1cnNvci5wcm9qZWN0KHsgX2lkOiAwLCBhOiB0cnVlIH0pO1xuICAgICAqIGBgYFxuICAgICAqXG4gICAgICogQHJlbWFya3NcbiAgICAgKlxuICAgICAqICoqTm90ZSBmb3IgVHlwZXNjcmlwdCBVc2VyczoqKiBhZGRpbmcgYSB0cmFuc2Zvcm0gY2hhbmdlcyB0aGUgcmV0dXJuIHR5cGUgb2YgdGhlIGl0ZXJhdGlvbiBvZiB0aGlzIGN1cnNvcixcbiAgICAgKiBpdCAqKmRvZXMgbm90KiogcmV0dXJuIGEgbmV3IGluc3RhbmNlIG9mIGEgY3Vyc29yLiBUaGlzIG1lYW5zIHdoZW4gY2FsbGluZyBwcm9qZWN0LFxuICAgICAqIHlvdSBzaG91bGQgYWx3YXlzIGFzc2lnbiB0aGUgcmVzdWx0IHRvIGEgbmV3IHZhcmlhYmxlIGluIG9yZGVyIHRvIGdldCBhIGNvcnJlY3RseSB0eXBlZCBjdXJzb3IgdmFyaWFibGUuXG4gICAgICogVGFrZSBub3RlIG9mIHRoZSBmb2xsb3dpbmcgZXhhbXBsZTpcbiAgICAgKlxuICAgICAqIEBleGFtcGxlXG4gICAgICogYGBgdHlwZXNjcmlwdFxuICAgICAqIGNvbnN0IGN1cnNvcjogRmluZEN1cnNvcjx7IGE6IG51bWJlcjsgYjogc3RyaW5nIH0+ID0gY29sbC5maW5kKCk7XG4gICAgICogY29uc3QgcHJvamVjdEN1cnNvciA9IGN1cnNvci5wcm9qZWN0PHsgYTogbnVtYmVyIH0+KHsgX2lkOiAwLCBhOiB0cnVlIH0pO1xuICAgICAqIGNvbnN0IGFQcm9wT25seUFycmF5OiB7YTogbnVtYmVyfVtdID0gYXdhaXQgcHJvamVjdEN1cnNvci50b0FycmF5KCk7XG4gICAgICpcbiAgICAgKiAvLyBvciBhbHdheXMgdXNlIGNoYWluaW5nIGFuZCBzYXZlIHRoZSBmaW5hbCBjdXJzb3JcbiAgICAgKlxuICAgICAqIGNvbnN0IGN1cnNvciA9IGNvbGwuZmluZCgpLnByb2plY3Q8eyBhOiBzdHJpbmcgfT4oe1xuICAgICAqICAgX2lkOiAwLFxuICAgICAqICAgYTogeyAkY29udmVydDogeyBpbnB1dDogJyRhJywgdG86ICdzdHJpbmcnIH1cbiAgICAgKiB9fSk7XG4gICAgICogYGBgXG4gICAgICovXG4gICAgcHJvamVjdCh2YWx1ZSkge1xuICAgICAgICAoMCwgYWJzdHJhY3RfY3Vyc29yXzEuYXNzZXJ0VW5pbml0aWFsaXplZCkodGhpcyk7XG4gICAgICAgIHRoaXNba0J1aWx0T3B0aW9uc10ucHJvamVjdGlvbiA9IHZhbHVlO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgLyoqXG4gICAgICogU2V0cyB0aGUgc29ydCBvcmRlciBvZiB0aGUgY3Vyc29yIHF1ZXJ5LlxuICAgICAqXG4gICAgICogQHBhcmFtIHNvcnQgLSBUaGUga2V5IG9yIGtleXMgc2V0IGZvciB0aGUgc29ydC5cbiAgICAgKiBAcGFyYW0gZGlyZWN0aW9uIC0gVGhlIGRpcmVjdGlvbiBvZiB0aGUgc29ydGluZyAoMSBvciAtMSkuXG4gICAgICovXG4gICAgc29ydChzb3J0LCBkaXJlY3Rpb24pIHtcbiAgICAgICAgKDAsIGFic3RyYWN0X2N1cnNvcl8xLmFzc2VydFVuaW5pdGlhbGl6ZWQpKHRoaXMpO1xuICAgICAgICBpZiAodGhpc1trQnVpbHRPcHRpb25zXS50YWlsYWJsZSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29UYWlsYWJsZUN1cnNvckVycm9yKCdUYWlsYWJsZSBjdXJzb3IgZG9lcyBub3Qgc3VwcG9ydCBzb3J0aW5nJyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpc1trQnVpbHRPcHRpb25zXS5zb3J0ID0gKDAsIHNvcnRfMS5mb3JtYXRTb3J0KShzb3J0LCBkaXJlY3Rpb24pO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgLyoqXG4gICAgICogQWxsb3dzIGRpc2sgdXNlIGZvciBibG9ja2luZyBzb3J0IG9wZXJhdGlvbnMgZXhjZWVkaW5nIDEwME1CIG1lbW9yeS4gKE1vbmdvREIgMy4yIG9yIGhpZ2hlcilcbiAgICAgKlxuICAgICAqIEByZW1hcmtzXG4gICAgICoge0BsaW5rIGh0dHBzOi8vd3d3Lm1vbmdvZGIuY29tL2RvY3MvbWFudWFsL3JlZmVyZW5jZS9jb21tYW5kL2ZpbmQvI2ZpbmQtY21kLWFsbG93ZGlza3VzZSB8IGZpbmQgY29tbWFuZCBhbGxvd0Rpc2tVc2UgZG9jdW1lbnRhdGlvbn1cbiAgICAgKi9cbiAgICBhbGxvd0Rpc2tVc2UoYWxsb3cgPSB0cnVlKSB7XG4gICAgICAgICgwLCBhYnN0cmFjdF9jdXJzb3JfMS5hc3NlcnRVbmluaXRpYWxpemVkKSh0aGlzKTtcbiAgICAgICAgaWYgKCF0aGlzW2tCdWlsdE9wdGlvbnNdLnNvcnQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoJ09wdGlvbiBcImFsbG93RGlza1VzZVwiIHJlcXVpcmVzIGEgc29ydCBzcGVjaWZpY2F0aW9uJyk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gQXMgb2YgNi4wIHRoZSBkZWZhdWx0IGlzIHRydWUuIFRoaXMgYWxsb3dzIHVzZXJzIHRvIGdldCBiYWNrIHRvIHRoZSBvbGQgYmVoYXZpb3IuXG4gICAgICAgIGlmICghYWxsb3cpIHtcbiAgICAgICAgICAgIHRoaXNba0J1aWx0T3B0aW9uc10uYWxsb3dEaXNrVXNlID0gZmFsc2U7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfVxuICAgICAgICB0aGlzW2tCdWlsdE9wdGlvbnNdLmFsbG93RGlza1VzZSA9IHRydWU7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTZXQgdGhlIGNvbGxhdGlvbiBvcHRpb25zIGZvciB0aGUgY3Vyc29yLlxuICAgICAqXG4gICAgICogQHBhcmFtIHZhbHVlIC0gVGhlIGN1cnNvciBjb2xsYXRpb24gb3B0aW9ucyAoTW9uZ29EQiAzLjQgb3IgaGlnaGVyKSBzZXR0aW5ncyBmb3IgdXBkYXRlIG9wZXJhdGlvbiAoc2VlIDMuNCBkb2N1bWVudGF0aW9uIGZvciBhdmFpbGFibGUgZmllbGRzKS5cbiAgICAgKi9cbiAgICBjb2xsYXRpb24odmFsdWUpIHtcbiAgICAgICAgKDAsIGFic3RyYWN0X2N1cnNvcl8xLmFzc2VydFVuaW5pdGlhbGl6ZWQpKHRoaXMpO1xuICAgICAgICB0aGlzW2tCdWlsdE9wdGlvbnNdLmNvbGxhdGlvbiA9IHZhbHVlO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgLyoqXG4gICAgICogU2V0IHRoZSBsaW1pdCBmb3IgdGhlIGN1cnNvci5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB2YWx1ZSAtIFRoZSBsaW1pdCBmb3IgdGhlIGN1cnNvciBxdWVyeS5cbiAgICAgKi9cbiAgICBsaW1pdCh2YWx1ZSkge1xuICAgICAgICAoMCwgYWJzdHJhY3RfY3Vyc29yXzEuYXNzZXJ0VW5pbml0aWFsaXplZCkodGhpcyk7XG4gICAgICAgIGlmICh0aGlzW2tCdWlsdE9wdGlvbnNdLnRhaWxhYmxlKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1RhaWxhYmxlQ3Vyc29yRXJyb3IoJ1RhaWxhYmxlIGN1cnNvciBkb2VzIG5vdCBzdXBwb3J0IGxpbWl0Jyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoJ09wZXJhdGlvbiBcImxpbWl0XCIgcmVxdWlyZXMgYW4gaW50ZWdlcicpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXNba0J1aWx0T3B0aW9uc10ubGltaXQgPSB2YWx1ZTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNldCB0aGUgc2tpcCBmb3IgdGhlIGN1cnNvci5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB2YWx1ZSAtIFRoZSBza2lwIGZvciB0aGUgY3Vyc29yIHF1ZXJ5LlxuICAgICAqL1xuICAgIHNraXAodmFsdWUpIHtcbiAgICAgICAgKDAsIGFic3RyYWN0X2N1cnNvcl8xLmFzc2VydFVuaW5pdGlhbGl6ZWQpKHRoaXMpO1xuICAgICAgICBpZiAodGhpc1trQnVpbHRPcHRpb25zXS50YWlsYWJsZSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29UYWlsYWJsZUN1cnNvckVycm9yKCdUYWlsYWJsZSBjdXJzb3IgZG9lcyBub3Qgc3VwcG9ydCBza2lwJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoJ09wZXJhdGlvbiBcInNraXBcIiByZXF1aXJlcyBhbiBpbnRlZ2VyJyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpc1trQnVpbHRPcHRpb25zXS5za2lwID0gdmFsdWU7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbn1cbmV4cG9ydHMuRmluZEN1cnNvciA9IEZpbmRDdXJzb3I7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1maW5kX2N1cnNvci5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/cursor/find_cursor.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/cursor/list_collections_cursor.js":
/*!****************************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/cursor/list_collections_cursor.js ***!
  \****************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.ListCollectionsCursor = void 0;\nconst execute_operation_1 = __webpack_require__(/*! ../operations/execute_operation */ \"(api)/../server/node_modules/mongodb/lib/operations/execute_operation.js\");\nconst list_collections_1 = __webpack_require__(/*! ../operations/list_collections */ \"(api)/../server/node_modules/mongodb/lib/operations/list_collections.js\");\nconst abstract_cursor_1 = __webpack_require__(/*! ./abstract_cursor */ \"(api)/../server/node_modules/mongodb/lib/cursor/abstract_cursor.js\");\n/** @public */\nclass ListCollectionsCursor extends abstract_cursor_1.AbstractCursor {\n    constructor(db, filter, options) {\n        super(db.client, db.s.namespace, options);\n        this.parent = db;\n        this.filter = filter;\n        this.options = options;\n    }\n    clone() {\n        return new ListCollectionsCursor(this.parent, this.filter, {\n            ...this.options,\n            ...this.cursorOptions\n        });\n    }\n    /** @internal */\n    _initialize(session, callback) {\n        const operation = new list_collections_1.ListCollectionsOperation(this.parent, this.filter, {\n            ...this.cursorOptions,\n            ...this.options,\n            session\n        });\n        (0, execute_operation_1.executeOperation)(this.parent.client, operation, (err, response) => {\n            if (err || response == null)\n                return callback(err);\n            // TODO: NODE-2882\n            callback(undefined, { server: operation.server, session, response });\n        });\n    }\n}\nexports.ListCollectionsCursor = ListCollectionsCursor;\n//# sourceMappingURL=list_collections_cursor.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jdXJzb3IvbGlzdF9jb2xsZWN0aW9uc19jdXJzb3IuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsNkJBQTZCO0FBQzdCLDRCQUE0QixtQkFBTyxDQUFDLGlIQUFpQztBQUNyRSwyQkFBMkIsbUJBQU8sQ0FBQywrR0FBZ0M7QUFDbkUsMEJBQTBCLG1CQUFPLENBQUMsNkZBQW1CO0FBQ3JEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQyw2Q0FBNkM7QUFDL0UsU0FBUztBQUNUO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0IiLCJzb3VyY2VzIjpbIkQ6XFxzYWxvbmlcXGFwcHJhaXNhbC1zeXN0ZW1cXHNlcnZlclxcbm9kZV9tb2R1bGVzXFxtb25nb2RiXFxsaWJcXGN1cnNvclxcbGlzdF9jb2xsZWN0aW9uc19jdXJzb3IuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkxpc3RDb2xsZWN0aW9uc0N1cnNvciA9IHZvaWQgMDtcbmNvbnN0IGV4ZWN1dGVfb3BlcmF0aW9uXzEgPSByZXF1aXJlKFwiLi4vb3BlcmF0aW9ucy9leGVjdXRlX29wZXJhdGlvblwiKTtcbmNvbnN0IGxpc3RfY29sbGVjdGlvbnNfMSA9IHJlcXVpcmUoXCIuLi9vcGVyYXRpb25zL2xpc3RfY29sbGVjdGlvbnNcIik7XG5jb25zdCBhYnN0cmFjdF9jdXJzb3JfMSA9IHJlcXVpcmUoXCIuL2Fic3RyYWN0X2N1cnNvclwiKTtcbi8qKiBAcHVibGljICovXG5jbGFzcyBMaXN0Q29sbGVjdGlvbnNDdXJzb3IgZXh0ZW5kcyBhYnN0cmFjdF9jdXJzb3JfMS5BYnN0cmFjdEN1cnNvciB7XG4gICAgY29uc3RydWN0b3IoZGIsIGZpbHRlciwgb3B0aW9ucykge1xuICAgICAgICBzdXBlcihkYi5jbGllbnQsIGRiLnMubmFtZXNwYWNlLCBvcHRpb25zKTtcbiAgICAgICAgdGhpcy5wYXJlbnQgPSBkYjtcbiAgICAgICAgdGhpcy5maWx0ZXIgPSBmaWx0ZXI7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XG4gICAgfVxuICAgIGNsb25lKCkge1xuICAgICAgICByZXR1cm4gbmV3IExpc3RDb2xsZWN0aW9uc0N1cnNvcih0aGlzLnBhcmVudCwgdGhpcy5maWx0ZXIsIHtcbiAgICAgICAgICAgIC4uLnRoaXMub3B0aW9ucyxcbiAgICAgICAgICAgIC4uLnRoaXMuY3Vyc29yT3B0aW9uc1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIF9pbml0aWFsaXplKHNlc3Npb24sIGNhbGxiYWNrKSB7XG4gICAgICAgIGNvbnN0IG9wZXJhdGlvbiA9IG5ldyBsaXN0X2NvbGxlY3Rpb25zXzEuTGlzdENvbGxlY3Rpb25zT3BlcmF0aW9uKHRoaXMucGFyZW50LCB0aGlzLmZpbHRlciwge1xuICAgICAgICAgICAgLi4udGhpcy5jdXJzb3JPcHRpb25zLFxuICAgICAgICAgICAgLi4udGhpcy5vcHRpb25zLFxuICAgICAgICAgICAgc2Vzc2lvblxuICAgICAgICB9KTtcbiAgICAgICAgKDAsIGV4ZWN1dGVfb3BlcmF0aW9uXzEuZXhlY3V0ZU9wZXJhdGlvbikodGhpcy5wYXJlbnQuY2xpZW50LCBvcGVyYXRpb24sIChlcnIsIHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICBpZiAoZXJyIHx8IHJlc3BvbnNlID09IG51bGwpXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgICAgICAgICAvLyBUT0RPOiBOT0RFLTI4ODJcbiAgICAgICAgICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwgeyBzZXJ2ZXI6IG9wZXJhdGlvbi5zZXJ2ZXIsIHNlc3Npb24sIHJlc3BvbnNlIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5leHBvcnRzLkxpc3RDb2xsZWN0aW9uc0N1cnNvciA9IExpc3RDb2xsZWN0aW9uc0N1cnNvcjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWxpc3RfY29sbGVjdGlvbnNfY3Vyc29yLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/cursor/list_collections_cursor.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/cursor/list_indexes_cursor.js":
/*!************************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/cursor/list_indexes_cursor.js ***!
  \************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.ListIndexesCursor = void 0;\nconst execute_operation_1 = __webpack_require__(/*! ../operations/execute_operation */ \"(api)/../server/node_modules/mongodb/lib/operations/execute_operation.js\");\nconst indexes_1 = __webpack_require__(/*! ../operations/indexes */ \"(api)/../server/node_modules/mongodb/lib/operations/indexes.js\");\nconst abstract_cursor_1 = __webpack_require__(/*! ./abstract_cursor */ \"(api)/../server/node_modules/mongodb/lib/cursor/abstract_cursor.js\");\n/** @public */\nclass ListIndexesCursor extends abstract_cursor_1.AbstractCursor {\n    constructor(collection, options) {\n        super(collection.client, collection.s.namespace, options);\n        this.parent = collection;\n        this.options = options;\n    }\n    clone() {\n        return new ListIndexesCursor(this.parent, {\n            ...this.options,\n            ...this.cursorOptions\n        });\n    }\n    /** @internal */\n    _initialize(session, callback) {\n        const operation = new indexes_1.ListIndexesOperation(this.parent, {\n            ...this.cursorOptions,\n            ...this.options,\n            session\n        });\n        (0, execute_operation_1.executeOperation)(this.parent.client, operation, (err, response) => {\n            if (err || response == null)\n                return callback(err);\n            // TODO: NODE-2882\n            callback(undefined, { server: operation.server, session, response });\n        });\n    }\n}\nexports.ListIndexesCursor = ListIndexesCursor;\n//# sourceMappingURL=list_indexes_cursor.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jdXJzb3IvbGlzdF9pbmRleGVzX2N1cnNvci5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCx5QkFBeUI7QUFDekIsNEJBQTRCLG1CQUFPLENBQUMsaUhBQWlDO0FBQ3JFLGtCQUFrQixtQkFBTyxDQUFDLDZGQUF1QjtBQUNqRCwwQkFBMEIsbUJBQU8sQ0FBQyw2RkFBbUI7QUFDckQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQyw2Q0FBNkM7QUFDL0UsU0FBUztBQUNUO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekIiLCJzb3VyY2VzIjpbIkQ6XFxzYWxvbmlcXGFwcHJhaXNhbC1zeXN0ZW1cXHNlcnZlclxcbm9kZV9tb2R1bGVzXFxtb25nb2RiXFxsaWJcXGN1cnNvclxcbGlzdF9pbmRleGVzX2N1cnNvci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuTGlzdEluZGV4ZXNDdXJzb3IgPSB2b2lkIDA7XG5jb25zdCBleGVjdXRlX29wZXJhdGlvbl8xID0gcmVxdWlyZShcIi4uL29wZXJhdGlvbnMvZXhlY3V0ZV9vcGVyYXRpb25cIik7XG5jb25zdCBpbmRleGVzXzEgPSByZXF1aXJlKFwiLi4vb3BlcmF0aW9ucy9pbmRleGVzXCIpO1xuY29uc3QgYWJzdHJhY3RfY3Vyc29yXzEgPSByZXF1aXJlKFwiLi9hYnN0cmFjdF9jdXJzb3JcIik7XG4vKiogQHB1YmxpYyAqL1xuY2xhc3MgTGlzdEluZGV4ZXNDdXJzb3IgZXh0ZW5kcyBhYnN0cmFjdF9jdXJzb3JfMS5BYnN0cmFjdEN1cnNvciB7XG4gICAgY29uc3RydWN0b3IoY29sbGVjdGlvbiwgb3B0aW9ucykge1xuICAgICAgICBzdXBlcihjb2xsZWN0aW9uLmNsaWVudCwgY29sbGVjdGlvbi5zLm5hbWVzcGFjZSwgb3B0aW9ucyk7XG4gICAgICAgIHRoaXMucGFyZW50ID0gY29sbGVjdGlvbjtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcbiAgICB9XG4gICAgY2xvbmUoKSB7XG4gICAgICAgIHJldHVybiBuZXcgTGlzdEluZGV4ZXNDdXJzb3IodGhpcy5wYXJlbnQsIHtcbiAgICAgICAgICAgIC4uLnRoaXMub3B0aW9ucyxcbiAgICAgICAgICAgIC4uLnRoaXMuY3Vyc29yT3B0aW9uc1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIF9pbml0aWFsaXplKHNlc3Npb24sIGNhbGxiYWNrKSB7XG4gICAgICAgIGNvbnN0IG9wZXJhdGlvbiA9IG5ldyBpbmRleGVzXzEuTGlzdEluZGV4ZXNPcGVyYXRpb24odGhpcy5wYXJlbnQsIHtcbiAgICAgICAgICAgIC4uLnRoaXMuY3Vyc29yT3B0aW9ucyxcbiAgICAgICAgICAgIC4uLnRoaXMub3B0aW9ucyxcbiAgICAgICAgICAgIHNlc3Npb25cbiAgICAgICAgfSk7XG4gICAgICAgICgwLCBleGVjdXRlX29wZXJhdGlvbl8xLmV4ZWN1dGVPcGVyYXRpb24pKHRoaXMucGFyZW50LmNsaWVudCwgb3BlcmF0aW9uLCAoZXJyLCByZXNwb25zZSkgPT4ge1xuICAgICAgICAgICAgaWYgKGVyciB8fCByZXNwb25zZSA9PSBudWxsKVxuICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgICAgICAgICAgLy8gVE9ETzogTk9ERS0yODgyXG4gICAgICAgICAgICBjYWxsYmFjayh1bmRlZmluZWQsIHsgc2VydmVyOiBvcGVyYXRpb24uc2VydmVyLCBzZXNzaW9uLCByZXNwb25zZSB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuZXhwb3J0cy5MaXN0SW5kZXhlc0N1cnNvciA9IExpc3RJbmRleGVzQ3Vyc29yO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9bGlzdF9pbmRleGVzX2N1cnNvci5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/cursor/list_indexes_cursor.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/cursor/list_search_indexes_cursor.js":
/*!*******************************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/cursor/list_search_indexes_cursor.js ***!
  \*******************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.ListSearchIndexesCursor = void 0;\nconst aggregation_cursor_1 = __webpack_require__(/*! ./aggregation_cursor */ \"(api)/../server/node_modules/mongodb/lib/cursor/aggregation_cursor.js\");\n/** @public */\nclass ListSearchIndexesCursor extends aggregation_cursor_1.AggregationCursor {\n    /** @internal */\n    constructor({ fullNamespace: ns, client }, name, options = {}) {\n        const pipeline = name == null ? [{ $listSearchIndexes: {} }] : [{ $listSearchIndexes: { name } }];\n        super(client, ns, pipeline, options);\n    }\n}\nexports.ListSearchIndexesCursor = ListSearchIndexesCursor;\n//# sourceMappingURL=list_search_indexes_cursor.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jdXJzb3IvbGlzdF9zZWFyY2hfaW5kZXhlc19jdXJzb3IuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsK0JBQStCO0FBQy9CLDZCQUE2QixtQkFBTyxDQUFDLG1HQUFzQjtBQUMzRDtBQUNBO0FBQ0E7QUFDQSxrQkFBa0IsMkJBQTJCLG9CQUFvQjtBQUNqRSwyQ0FBMkMsd0JBQXdCLE9BQU8sc0JBQXNCLFFBQVE7QUFDeEc7QUFDQTtBQUNBO0FBQ0EsK0JBQStCO0FBQy9CIiwic291cmNlcyI6WyJEOlxcc2Fsb25pXFxhcHByYWlzYWwtc3lzdGVtXFxzZXJ2ZXJcXG5vZGVfbW9kdWxlc1xcbW9uZ29kYlxcbGliXFxjdXJzb3JcXGxpc3Rfc2VhcmNoX2luZGV4ZXNfY3Vyc29yLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5MaXN0U2VhcmNoSW5kZXhlc0N1cnNvciA9IHZvaWQgMDtcbmNvbnN0IGFnZ3JlZ2F0aW9uX2N1cnNvcl8xID0gcmVxdWlyZShcIi4vYWdncmVnYXRpb25fY3Vyc29yXCIpO1xuLyoqIEBwdWJsaWMgKi9cbmNsYXNzIExpc3RTZWFyY2hJbmRleGVzQ3Vyc29yIGV4dGVuZHMgYWdncmVnYXRpb25fY3Vyc29yXzEuQWdncmVnYXRpb25DdXJzb3Ige1xuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBjb25zdHJ1Y3Rvcih7IGZ1bGxOYW1lc3BhY2U6IG5zLCBjbGllbnQgfSwgbmFtZSwgb3B0aW9ucyA9IHt9KSB7XG4gICAgICAgIGNvbnN0IHBpcGVsaW5lID0gbmFtZSA9PSBudWxsID8gW3sgJGxpc3RTZWFyY2hJbmRleGVzOiB7fSB9XSA6IFt7ICRsaXN0U2VhcmNoSW5kZXhlczogeyBuYW1lIH0gfV07XG4gICAgICAgIHN1cGVyKGNsaWVudCwgbnMsIHBpcGVsaW5lLCBvcHRpb25zKTtcbiAgICB9XG59XG5leHBvcnRzLkxpc3RTZWFyY2hJbmRleGVzQ3Vyc29yID0gTGlzdFNlYXJjaEluZGV4ZXNDdXJzb3I7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1saXN0X3NlYXJjaF9pbmRleGVzX2N1cnNvci5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/cursor/list_search_indexes_cursor.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/cursor/run_command_cursor.js":
/*!***********************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/cursor/run_command_cursor.js ***!
  \***********************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.RunCommandCursor = void 0;\nconst error_1 = __webpack_require__(/*! ../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst execute_operation_1 = __webpack_require__(/*! ../operations/execute_operation */ \"(api)/../server/node_modules/mongodb/lib/operations/execute_operation.js\");\nconst get_more_1 = __webpack_require__(/*! ../operations/get_more */ \"(api)/../server/node_modules/mongodb/lib/operations/get_more.js\");\nconst run_command_1 = __webpack_require__(/*! ../operations/run_command */ \"(api)/../server/node_modules/mongodb/lib/operations/run_command.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\nconst abstract_cursor_1 = __webpack_require__(/*! ./abstract_cursor */ \"(api)/../server/node_modules/mongodb/lib/cursor/abstract_cursor.js\");\n/** @public */\nclass RunCommandCursor extends abstract_cursor_1.AbstractCursor {\n    /**\n     * Controls the `getMore.comment` field\n     * @param comment - any BSON value\n     */\n    setComment(comment) {\n        this.getMoreOptions.comment = comment;\n        return this;\n    }\n    /**\n     * Controls the `getMore.maxTimeMS` field. Only valid when cursor is tailable await\n     * @param maxTimeMS - the number of milliseconds to wait for new data\n     */\n    setMaxTimeMS(maxTimeMS) {\n        this.getMoreOptions.maxAwaitTimeMS = maxTimeMS;\n        return this;\n    }\n    /**\n     * Controls the `getMore.batchSize` field\n     * @param maxTimeMS - the number documents to return in the `nextBatch`\n     */\n    setBatchSize(batchSize) {\n        this.getMoreOptions.batchSize = batchSize;\n        return this;\n    }\n    /** Unsupported for RunCommandCursor */\n    clone() {\n        throw new error_1.MongoAPIError('Clone not supported, create a new cursor with db.runCursorCommand');\n    }\n    /** Unsupported for RunCommandCursor: readConcern must be configured directly on command document */\n    withReadConcern(_) {\n        throw new error_1.MongoAPIError('RunCommandCursor does not support readConcern it must be attached to the command being run');\n    }\n    /** Unsupported for RunCommandCursor: various cursor flags must be configured directly on command document */\n    addCursorFlag(_, __) {\n        throw new error_1.MongoAPIError('RunCommandCursor does not support cursor flags, they must be attached to the command being run');\n    }\n    /** Unsupported for RunCommandCursor: maxTimeMS must be configured directly on command document */\n    maxTimeMS(_) {\n        throw new error_1.MongoAPIError('maxTimeMS must be configured on the command document directly, to configure getMore.maxTimeMS use cursor.setMaxTimeMS()');\n    }\n    /** Unsupported for RunCommandCursor: batchSize must be configured directly on command document */\n    batchSize(_) {\n        throw new error_1.MongoAPIError('batchSize must be configured on the command document directly, to configure getMore.batchSize use cursor.setBatchSize()');\n    }\n    /** @internal */\n    constructor(db, command, options = {}) {\n        super(db.client, (0, utils_1.ns)(db.namespace), options);\n        this.getMoreOptions = {};\n        this.db = db;\n        this.command = Object.freeze({ ...command });\n    }\n    /** @internal */\n    _initialize(session, callback) {\n        const operation = new run_command_1.RunCommandOperation(this.db, this.command, {\n            ...this.cursorOptions,\n            session: session,\n            readPreference: this.cursorOptions.readPreference\n        });\n        (0, execute_operation_1.executeOperation)(this.client, operation).then(response => {\n            if (response.cursor == null) {\n                callback(new error_1.MongoUnexpectedServerResponseError('Expected server to respond with cursor'));\n                return;\n            }\n            callback(undefined, {\n                server: operation.server,\n                session,\n                response\n            });\n        }, err => callback(err));\n    }\n    /** @internal */\n    _getMore(_batchSize, callback) {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        const getMoreOperation = new get_more_1.GetMoreOperation(this.namespace, this.id, this.server, {\n            ...this.cursorOptions,\n            session: this.session,\n            ...this.getMoreOptions\n        });\n        (0, execute_operation_1.executeOperation)(this.client, getMoreOperation, callback);\n    }\n}\nexports.RunCommandCursor = RunCommandCursor;\n//# sourceMappingURL=run_command_cursor.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jdXJzb3IvcnVuX2NvbW1hbmRfY3Vyc29yLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELHdCQUF3QjtBQUN4QixnQkFBZ0IsbUJBQU8sQ0FBQyxtRUFBVTtBQUNsQyw0QkFBNEIsbUJBQU8sQ0FBQyxpSEFBaUM7QUFDckUsbUJBQW1CLG1CQUFPLENBQUMsK0ZBQXdCO0FBQ25ELHNCQUFzQixtQkFBTyxDQUFDLHFHQUEyQjtBQUN6RCxnQkFBZ0IsbUJBQU8sQ0FBQyxtRUFBVTtBQUNsQywwQkFBMEIsbUJBQU8sQ0FBQyw2RkFBbUI7QUFDckQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlDQUF5QztBQUN6QztBQUNBO0FBQ0E7QUFDQSx1Q0FBdUMsWUFBWTtBQUNuRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCO0FBQ3hCIiwic291cmNlcyI6WyJEOlxcc2Fsb25pXFxhcHByYWlzYWwtc3lzdGVtXFxzZXJ2ZXJcXG5vZGVfbW9kdWxlc1xcbW9uZ29kYlxcbGliXFxjdXJzb3JcXHJ1bl9jb21tYW5kX2N1cnNvci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuUnVuQ29tbWFuZEN1cnNvciA9IHZvaWQgMDtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi4vZXJyb3JcIik7XG5jb25zdCBleGVjdXRlX29wZXJhdGlvbl8xID0gcmVxdWlyZShcIi4uL29wZXJhdGlvbnMvZXhlY3V0ZV9vcGVyYXRpb25cIik7XG5jb25zdCBnZXRfbW9yZV8xID0gcmVxdWlyZShcIi4uL29wZXJhdGlvbnMvZ2V0X21vcmVcIik7XG5jb25zdCBydW5fY29tbWFuZF8xID0gcmVxdWlyZShcIi4uL29wZXJhdGlvbnMvcnVuX2NvbW1hbmRcIik7XG5jb25zdCB1dGlsc18xID0gcmVxdWlyZShcIi4uL3V0aWxzXCIpO1xuY29uc3QgYWJzdHJhY3RfY3Vyc29yXzEgPSByZXF1aXJlKFwiLi9hYnN0cmFjdF9jdXJzb3JcIik7XG4vKiogQHB1YmxpYyAqL1xuY2xhc3MgUnVuQ29tbWFuZEN1cnNvciBleHRlbmRzIGFic3RyYWN0X2N1cnNvcl8xLkFic3RyYWN0Q3Vyc29yIHtcbiAgICAvKipcbiAgICAgKiBDb250cm9scyB0aGUgYGdldE1vcmUuY29tbWVudGAgZmllbGRcbiAgICAgKiBAcGFyYW0gY29tbWVudCAtIGFueSBCU09OIHZhbHVlXG4gICAgICovXG4gICAgc2V0Q29tbWVudChjb21tZW50KSB7XG4gICAgICAgIHRoaXMuZ2V0TW9yZU9wdGlvbnMuY29tbWVudCA9IGNvbW1lbnQ7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDb250cm9scyB0aGUgYGdldE1vcmUubWF4VGltZU1TYCBmaWVsZC4gT25seSB2YWxpZCB3aGVuIGN1cnNvciBpcyB0YWlsYWJsZSBhd2FpdFxuICAgICAqIEBwYXJhbSBtYXhUaW1lTVMgLSB0aGUgbnVtYmVyIG9mIG1pbGxpc2Vjb25kcyB0byB3YWl0IGZvciBuZXcgZGF0YVxuICAgICAqL1xuICAgIHNldE1heFRpbWVNUyhtYXhUaW1lTVMpIHtcbiAgICAgICAgdGhpcy5nZXRNb3JlT3B0aW9ucy5tYXhBd2FpdFRpbWVNUyA9IG1heFRpbWVNUztcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENvbnRyb2xzIHRoZSBgZ2V0TW9yZS5iYXRjaFNpemVgIGZpZWxkXG4gICAgICogQHBhcmFtIG1heFRpbWVNUyAtIHRoZSBudW1iZXIgZG9jdW1lbnRzIHRvIHJldHVybiBpbiB0aGUgYG5leHRCYXRjaGBcbiAgICAgKi9cbiAgICBzZXRCYXRjaFNpemUoYmF0Y2hTaXplKSB7XG4gICAgICAgIHRoaXMuZ2V0TW9yZU9wdGlvbnMuYmF0Y2hTaXplID0gYmF0Y2hTaXplO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgLyoqIFVuc3VwcG9ydGVkIGZvciBSdW5Db21tYW5kQ3Vyc29yICovXG4gICAgY2xvbmUoKSB7XG4gICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvQVBJRXJyb3IoJ0Nsb25lIG5vdCBzdXBwb3J0ZWQsIGNyZWF0ZSBhIG5ldyBjdXJzb3Igd2l0aCBkYi5ydW5DdXJzb3JDb21tYW5kJyk7XG4gICAgfVxuICAgIC8qKiBVbnN1cHBvcnRlZCBmb3IgUnVuQ29tbWFuZEN1cnNvcjogcmVhZENvbmNlcm4gbXVzdCBiZSBjb25maWd1cmVkIGRpcmVjdGx5IG9uIGNvbW1hbmQgZG9jdW1lbnQgKi9cbiAgICB3aXRoUmVhZENvbmNlcm4oXykge1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0FQSUVycm9yKCdSdW5Db21tYW5kQ3Vyc29yIGRvZXMgbm90IHN1cHBvcnQgcmVhZENvbmNlcm4gaXQgbXVzdCBiZSBhdHRhY2hlZCB0byB0aGUgY29tbWFuZCBiZWluZyBydW4nKTtcbiAgICB9XG4gICAgLyoqIFVuc3VwcG9ydGVkIGZvciBSdW5Db21tYW5kQ3Vyc29yOiB2YXJpb3VzIGN1cnNvciBmbGFncyBtdXN0IGJlIGNvbmZpZ3VyZWQgZGlyZWN0bHkgb24gY29tbWFuZCBkb2N1bWVudCAqL1xuICAgIGFkZEN1cnNvckZsYWcoXywgX18pIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29BUElFcnJvcignUnVuQ29tbWFuZEN1cnNvciBkb2VzIG5vdCBzdXBwb3J0IGN1cnNvciBmbGFncywgdGhleSBtdXN0IGJlIGF0dGFjaGVkIHRvIHRoZSBjb21tYW5kIGJlaW5nIHJ1bicpO1xuICAgIH1cbiAgICAvKiogVW5zdXBwb3J0ZWQgZm9yIFJ1bkNvbW1hbmRDdXJzb3I6IG1heFRpbWVNUyBtdXN0IGJlIGNvbmZpZ3VyZWQgZGlyZWN0bHkgb24gY29tbWFuZCBkb2N1bWVudCAqL1xuICAgIG1heFRpbWVNUyhfKSB7XG4gICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvQVBJRXJyb3IoJ21heFRpbWVNUyBtdXN0IGJlIGNvbmZpZ3VyZWQgb24gdGhlIGNvbW1hbmQgZG9jdW1lbnQgZGlyZWN0bHksIHRvIGNvbmZpZ3VyZSBnZXRNb3JlLm1heFRpbWVNUyB1c2UgY3Vyc29yLnNldE1heFRpbWVNUygpJyk7XG4gICAgfVxuICAgIC8qKiBVbnN1cHBvcnRlZCBmb3IgUnVuQ29tbWFuZEN1cnNvcjogYmF0Y2hTaXplIG11c3QgYmUgY29uZmlndXJlZCBkaXJlY3RseSBvbiBjb21tYW5kIGRvY3VtZW50ICovXG4gICAgYmF0Y2hTaXplKF8pIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29BUElFcnJvcignYmF0Y2hTaXplIG11c3QgYmUgY29uZmlndXJlZCBvbiB0aGUgY29tbWFuZCBkb2N1bWVudCBkaXJlY3RseSwgdG8gY29uZmlndXJlIGdldE1vcmUuYmF0Y2hTaXplIHVzZSBjdXJzb3Iuc2V0QmF0Y2hTaXplKCknKTtcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGNvbnN0cnVjdG9yKGRiLCBjb21tYW5kLCBvcHRpb25zID0ge30pIHtcbiAgICAgICAgc3VwZXIoZGIuY2xpZW50LCAoMCwgdXRpbHNfMS5ucykoZGIubmFtZXNwYWNlKSwgb3B0aW9ucyk7XG4gICAgICAgIHRoaXMuZ2V0TW9yZU9wdGlvbnMgPSB7fTtcbiAgICAgICAgdGhpcy5kYiA9IGRiO1xuICAgICAgICB0aGlzLmNvbW1hbmQgPSBPYmplY3QuZnJlZXplKHsgLi4uY29tbWFuZCB9KTtcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIF9pbml0aWFsaXplKHNlc3Npb24sIGNhbGxiYWNrKSB7XG4gICAgICAgIGNvbnN0IG9wZXJhdGlvbiA9IG5ldyBydW5fY29tbWFuZF8xLlJ1bkNvbW1hbmRPcGVyYXRpb24odGhpcy5kYiwgdGhpcy5jb21tYW5kLCB7XG4gICAgICAgICAgICAuLi50aGlzLmN1cnNvck9wdGlvbnMsXG4gICAgICAgICAgICBzZXNzaW9uOiBzZXNzaW9uLFxuICAgICAgICAgICAgcmVhZFByZWZlcmVuY2U6IHRoaXMuY3Vyc29yT3B0aW9ucy5yZWFkUHJlZmVyZW5jZVxuICAgICAgICB9KTtcbiAgICAgICAgKDAsIGV4ZWN1dGVfb3BlcmF0aW9uXzEuZXhlY3V0ZU9wZXJhdGlvbikodGhpcy5jbGllbnQsIG9wZXJhdGlvbikudGhlbihyZXNwb25zZSA9PiB7XG4gICAgICAgICAgICBpZiAocmVzcG9uc2UuY3Vyc29yID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhuZXcgZXJyb3JfMS5Nb25nb1VuZXhwZWN0ZWRTZXJ2ZXJSZXNwb25zZUVycm9yKCdFeHBlY3RlZCBzZXJ2ZXIgdG8gcmVzcG9uZCB3aXRoIGN1cnNvcicpKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYWxsYmFjayh1bmRlZmluZWQsIHtcbiAgICAgICAgICAgICAgICBzZXJ2ZXI6IG9wZXJhdGlvbi5zZXJ2ZXIsXG4gICAgICAgICAgICAgICAgc2Vzc2lvbixcbiAgICAgICAgICAgICAgICByZXNwb25zZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sIGVyciA9PiBjYWxsYmFjayhlcnIpKTtcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIF9nZXRNb3JlKF9iYXRjaFNpemUsIGNhbGxiYWNrKSB7XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tbm9uLW51bGwtYXNzZXJ0aW9uXG4gICAgICAgIGNvbnN0IGdldE1vcmVPcGVyYXRpb24gPSBuZXcgZ2V0X21vcmVfMS5HZXRNb3JlT3BlcmF0aW9uKHRoaXMubmFtZXNwYWNlLCB0aGlzLmlkLCB0aGlzLnNlcnZlciwge1xuICAgICAgICAgICAgLi4udGhpcy5jdXJzb3JPcHRpb25zLFxuICAgICAgICAgICAgc2Vzc2lvbjogdGhpcy5zZXNzaW9uLFxuICAgICAgICAgICAgLi4udGhpcy5nZXRNb3JlT3B0aW9uc1xuICAgICAgICB9KTtcbiAgICAgICAgKDAsIGV4ZWN1dGVfb3BlcmF0aW9uXzEuZXhlY3V0ZU9wZXJhdGlvbikodGhpcy5jbGllbnQsIGdldE1vcmVPcGVyYXRpb24sIGNhbGxiYWNrKTtcbiAgICB9XG59XG5leHBvcnRzLlJ1bkNvbW1hbmRDdXJzb3IgPSBSdW5Db21tYW5kQ3Vyc29yO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cnVuX2NvbW1hbmRfY3Vyc29yLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/cursor/run_command_cursor.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/db.js":
/*!************************************************!*\
  !*** ../server/node_modules/mongodb/lib/db.js ***!
  \************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.Db = void 0;\nconst admin_1 = __webpack_require__(/*! ./admin */ \"(api)/../server/node_modules/mongodb/lib/admin.js\");\nconst bson_1 = __webpack_require__(/*! ./bson */ \"(api)/../server/node_modules/mongodb/lib/bson.js\");\nconst change_stream_1 = __webpack_require__(/*! ./change_stream */ \"(api)/../server/node_modules/mongodb/lib/change_stream.js\");\nconst collection_1 = __webpack_require__(/*! ./collection */ \"(api)/../server/node_modules/mongodb/lib/collection.js\");\nconst CONSTANTS = __webpack_require__(/*! ./constants */ \"(api)/../server/node_modules/mongodb/lib/constants.js\");\nconst aggregation_cursor_1 = __webpack_require__(/*! ./cursor/aggregation_cursor */ \"(api)/../server/node_modules/mongodb/lib/cursor/aggregation_cursor.js\");\nconst list_collections_cursor_1 = __webpack_require__(/*! ./cursor/list_collections_cursor */ \"(api)/../server/node_modules/mongodb/lib/cursor/list_collections_cursor.js\");\nconst run_command_cursor_1 = __webpack_require__(/*! ./cursor/run_command_cursor */ \"(api)/../server/node_modules/mongodb/lib/cursor/run_command_cursor.js\");\nconst error_1 = __webpack_require__(/*! ./error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst add_user_1 = __webpack_require__(/*! ./operations/add_user */ \"(api)/../server/node_modules/mongodb/lib/operations/add_user.js\");\nconst collections_1 = __webpack_require__(/*! ./operations/collections */ \"(api)/../server/node_modules/mongodb/lib/operations/collections.js\");\nconst create_collection_1 = __webpack_require__(/*! ./operations/create_collection */ \"(api)/../server/node_modules/mongodb/lib/operations/create_collection.js\");\nconst drop_1 = __webpack_require__(/*! ./operations/drop */ \"(api)/../server/node_modules/mongodb/lib/operations/drop.js\");\nconst execute_operation_1 = __webpack_require__(/*! ./operations/execute_operation */ \"(api)/../server/node_modules/mongodb/lib/operations/execute_operation.js\");\nconst indexes_1 = __webpack_require__(/*! ./operations/indexes */ \"(api)/../server/node_modules/mongodb/lib/operations/indexes.js\");\nconst profiling_level_1 = __webpack_require__(/*! ./operations/profiling_level */ \"(api)/../server/node_modules/mongodb/lib/operations/profiling_level.js\");\nconst remove_user_1 = __webpack_require__(/*! ./operations/remove_user */ \"(api)/../server/node_modules/mongodb/lib/operations/remove_user.js\");\nconst rename_1 = __webpack_require__(/*! ./operations/rename */ \"(api)/../server/node_modules/mongodb/lib/operations/rename.js\");\nconst run_command_1 = __webpack_require__(/*! ./operations/run_command */ \"(api)/../server/node_modules/mongodb/lib/operations/run_command.js\");\nconst set_profiling_level_1 = __webpack_require__(/*! ./operations/set_profiling_level */ \"(api)/../server/node_modules/mongodb/lib/operations/set_profiling_level.js\");\nconst stats_1 = __webpack_require__(/*! ./operations/stats */ \"(api)/../server/node_modules/mongodb/lib/operations/stats.js\");\nconst read_concern_1 = __webpack_require__(/*! ./read_concern */ \"(api)/../server/node_modules/mongodb/lib/read_concern.js\");\nconst read_preference_1 = __webpack_require__(/*! ./read_preference */ \"(api)/../server/node_modules/mongodb/lib/read_preference.js\");\nconst utils_1 = __webpack_require__(/*! ./utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\nconst write_concern_1 = __webpack_require__(/*! ./write_concern */ \"(api)/../server/node_modules/mongodb/lib/write_concern.js\");\n// Allowed parameters\nconst DB_OPTIONS_ALLOW_LIST = [\n    'writeConcern',\n    'readPreference',\n    'readPreferenceTags',\n    'native_parser',\n    'forceServerObjectId',\n    'pkFactory',\n    'serializeFunctions',\n    'raw',\n    'authSource',\n    'ignoreUndefined',\n    'readConcern',\n    'retryMiliSeconds',\n    'numberOfRetries',\n    'useBigInt64',\n    'promoteBuffers',\n    'promoteLongs',\n    'bsonRegExp',\n    'enableUtf8Validation',\n    'promoteValues',\n    'compression',\n    'retryWrites'\n];\n/**\n * The **Db** class is a class that represents a MongoDB Database.\n * @public\n *\n * @example\n * ```ts\n * import { MongoClient } from 'mongodb';\n *\n * interface Pet {\n *   name: string;\n *   kind: 'dog' | 'cat' | 'fish';\n * }\n *\n * const client = new MongoClient('mongodb://localhost:27017');\n * const db = client.db();\n *\n * // Create a collection that validates our union\n * await db.createCollection<Pet>('pets', {\n *   validator: { $expr: { $in: ['$kind', ['dog', 'cat', 'fish']] } }\n * })\n * ```\n */\nclass Db {\n    /**\n     * Creates a new Db instance\n     *\n     * @param client - The MongoClient for the database.\n     * @param databaseName - The name of the database this instance represents.\n     * @param options - Optional settings for Db construction\n     */\n    constructor(client, databaseName, options) {\n        options = options ?? {};\n        // Filter the options\n        options = (0, utils_1.filterOptions)(options, DB_OPTIONS_ALLOW_LIST);\n        // Ensure we have a valid db name\n        validateDatabaseName(databaseName);\n        // Internal state of the db object\n        this.s = {\n            // Options\n            options,\n            // Unpack read preference\n            readPreference: read_preference_1.ReadPreference.fromOptions(options),\n            // Merge bson options\n            bsonOptions: (0, bson_1.resolveBSONOptions)(options, client),\n            // Set up the primary key factory or fallback to ObjectId\n            pkFactory: options?.pkFactory ?? utils_1.DEFAULT_PK_FACTORY,\n            // ReadConcern\n            readConcern: read_concern_1.ReadConcern.fromOptions(options),\n            writeConcern: write_concern_1.WriteConcern.fromOptions(options),\n            // Namespace\n            namespace: new utils_1.MongoDBNamespace(databaseName)\n        };\n        this.client = client;\n    }\n    get databaseName() {\n        return this.s.namespace.db;\n    }\n    // Options\n    get options() {\n        return this.s.options;\n    }\n    /**\n     * Check if a secondary can be used (because the read preference is *not* set to primary)\n     */\n    get secondaryOk() {\n        return this.s.readPreference?.preference !== 'primary' || false;\n    }\n    get readConcern() {\n        return this.s.readConcern;\n    }\n    /**\n     * The current readPreference of the Db. If not explicitly defined for\n     * this Db, will be inherited from the parent MongoClient\n     */\n    get readPreference() {\n        if (this.s.readPreference == null) {\n            return this.client.readPreference;\n        }\n        return this.s.readPreference;\n    }\n    get bsonOptions() {\n        return this.s.bsonOptions;\n    }\n    // get the write Concern\n    get writeConcern() {\n        return this.s.writeConcern;\n    }\n    get namespace() {\n        return this.s.namespace.toString();\n    }\n    /**\n     * Create a new collection on a server with the specified options. Use this to create capped collections.\n     * More information about command options available at https://www.mongodb.com/docs/manual/reference/command/create/\n     *\n     * @param name - The name of the collection to create\n     * @param options - Optional settings for the command\n     */\n    async createCollection(name, options) {\n        return (0, execute_operation_1.executeOperation)(this.client, new create_collection_1.CreateCollectionOperation(this, name, (0, utils_1.resolveOptions)(this, options)));\n    }\n    /**\n     * Execute a command\n     *\n     * @remarks\n     * This command does not inherit options from the MongoClient.\n     *\n     * The driver will ensure the following fields are attached to the command sent to the server:\n     * - `lsid` - sourced from an implicit session or options.session\n     * - `$readPreference` - defaults to primary or can be configured by options.readPreference\n     * - `$db` - sourced from the name of this database\n     *\n     * If the client has a serverApi setting:\n     * - `apiVersion`\n     * - `apiStrict`\n     * - `apiDeprecationErrors`\n     *\n     * When in a transaction:\n     * - `readConcern` - sourced from readConcern set on the TransactionOptions\n     * - `writeConcern` - sourced from writeConcern set on the TransactionOptions\n     *\n     * Attaching any of the above fields to the command will have no effect as the driver will overwrite the value.\n     *\n     * @param command - The command to run\n     * @param options - Optional settings for the command\n     */\n    async command(command, options) {\n        // Intentionally, we do not inherit options from parent for this operation.\n        return (0, execute_operation_1.executeOperation)(this.client, new run_command_1.RunCommandOperation(this, command, options));\n    }\n    /**\n     * Execute an aggregation framework pipeline against the database, needs MongoDB \\>= 3.6\n     *\n     * @param pipeline - An array of aggregation stages to be executed\n     * @param options - Optional settings for the command\n     */\n    aggregate(pipeline = [], options) {\n        return new aggregation_cursor_1.AggregationCursor(this.client, this.s.namespace, pipeline, (0, utils_1.resolveOptions)(this, options));\n    }\n    /** Return the Admin db instance */\n    admin() {\n        return new admin_1.Admin(this);\n    }\n    /**\n     * Returns a reference to a MongoDB Collection. If it does not exist it will be created implicitly.\n     *\n     * @param name - the collection name we wish to access.\n     * @returns return the new Collection instance\n     */\n    collection(name, options = {}) {\n        if (typeof options === 'function') {\n            throw new error_1.MongoInvalidArgumentError('The callback form of this helper has been removed.');\n        }\n        return new collection_1.Collection(this, name, (0, utils_1.resolveOptions)(this, options));\n    }\n    /**\n     * Get all the db statistics.\n     *\n     * @param options - Optional settings for the command\n     */\n    async stats(options) {\n        return (0, execute_operation_1.executeOperation)(this.client, new stats_1.DbStatsOperation(this, (0, utils_1.resolveOptions)(this, options)));\n    }\n    listCollections(filter = {}, options = {}) {\n        return new list_collections_cursor_1.ListCollectionsCursor(this, filter, (0, utils_1.resolveOptions)(this, options));\n    }\n    /**\n     * Rename a collection.\n     *\n     * @remarks\n     * This operation does not inherit options from the MongoClient.\n     *\n     * @param fromCollection - Name of current collection to rename\n     * @param toCollection - New name of of the collection\n     * @param options - Optional settings for the command\n     */\n    async renameCollection(fromCollection, toCollection, options) {\n        // Intentionally, we do not inherit options from parent for this operation.\n        return (0, execute_operation_1.executeOperation)(this.client, new rename_1.RenameOperation(this.collection(fromCollection), toCollection, { ...options, new_collection: true, readPreference: read_preference_1.ReadPreference.primary }));\n    }\n    /**\n     * Drop a collection from the database, removing it permanently. New accesses will create a new collection.\n     *\n     * @param name - Name of collection to drop\n     * @param options - Optional settings for the command\n     */\n    async dropCollection(name, options) {\n        return (0, execute_operation_1.executeOperation)(this.client, new drop_1.DropCollectionOperation(this, name, (0, utils_1.resolveOptions)(this, options)));\n    }\n    /**\n     * Drop a database, removing it permanently from the server.\n     *\n     * @param options - Optional settings for the command\n     */\n    async dropDatabase(options) {\n        return (0, execute_operation_1.executeOperation)(this.client, new drop_1.DropDatabaseOperation(this, (0, utils_1.resolveOptions)(this, options)));\n    }\n    /**\n     * Fetch all collections for the current db.\n     *\n     * @param options - Optional settings for the command\n     */\n    async collections(options) {\n        return (0, execute_operation_1.executeOperation)(this.client, new collections_1.CollectionsOperation(this, (0, utils_1.resolveOptions)(this, options)));\n    }\n    /**\n     * Creates an index on the db and collection.\n     *\n     * @param name - Name of the collection to create the index on.\n     * @param indexSpec - Specify the field to index, or an index specification\n     * @param options - Optional settings for the command\n     */\n    async createIndex(name, indexSpec, options) {\n        return (0, execute_operation_1.executeOperation)(this.client, new indexes_1.CreateIndexOperation(this, name, indexSpec, (0, utils_1.resolveOptions)(this, options)));\n    }\n    /**\n     * Add a user to the database\n     *\n     * @param username - The username for the new user\n     * @param passwordOrOptions - An optional password for the new user, or the options for the command\n     * @param options - Optional settings for the command\n     * @deprecated Use the createUser command in `db.command()` instead.\n     * @see https://www.mongodb.com/docs/manual/reference/command/createUser/\n     */\n    async addUser(username, passwordOrOptions, options) {\n        options =\n            options != null && typeof options === 'object'\n                ? options\n                : passwordOrOptions != null && typeof passwordOrOptions === 'object'\n                    ? passwordOrOptions\n                    : undefined;\n        const password = typeof passwordOrOptions === 'string' ? passwordOrOptions : undefined;\n        return (0, execute_operation_1.executeOperation)(this.client, new add_user_1.AddUserOperation(this, username, password, (0, utils_1.resolveOptions)(this, options)));\n    }\n    /**\n     * Remove a user from a database\n     *\n     * @param username - The username to remove\n     * @param options - Optional settings for the command\n     */\n    async removeUser(username, options) {\n        return (0, execute_operation_1.executeOperation)(this.client, new remove_user_1.RemoveUserOperation(this, username, (0, utils_1.resolveOptions)(this, options)));\n    }\n    /**\n     * Set the current profiling level of MongoDB\n     *\n     * @param level - The new profiling level (off, slow_only, all).\n     * @param options - Optional settings for the command\n     */\n    async setProfilingLevel(level, options) {\n        return (0, execute_operation_1.executeOperation)(this.client, new set_profiling_level_1.SetProfilingLevelOperation(this, level, (0, utils_1.resolveOptions)(this, options)));\n    }\n    /**\n     * Retrieve the current profiling Level for MongoDB\n     *\n     * @param options - Optional settings for the command\n     */\n    async profilingLevel(options) {\n        return (0, execute_operation_1.executeOperation)(this.client, new profiling_level_1.ProfilingLevelOperation(this, (0, utils_1.resolveOptions)(this, options)));\n    }\n    /**\n     * Retrieves this collections index info.\n     *\n     * @param name - The name of the collection.\n     * @param options - Optional settings for the command\n     */\n    async indexInformation(name, options) {\n        return (0, execute_operation_1.executeOperation)(this.client, new indexes_1.IndexInformationOperation(this, name, (0, utils_1.resolveOptions)(this, options)));\n    }\n    /**\n     * Create a new Change Stream, watching for new changes (insertions, updates,\n     * replacements, deletions, and invalidations) in this database. Will ignore all\n     * changes to system collections.\n     *\n     * @remarks\n     * watch() accepts two generic arguments for distinct use cases:\n     * - The first is to provide the schema that may be defined for all the collections within this database\n     * - The second is to override the shape of the change stream document entirely, if it is not provided the type will default to ChangeStreamDocument of the first argument\n     *\n     * @param pipeline - An array of {@link https://www.mongodb.com/docs/manual/reference/operator/aggregation-pipeline/|aggregation pipeline stages} through which to pass change stream documents. This allows for filtering (using $match) and manipulating the change stream documents.\n     * @param options - Optional settings for the command\n     * @typeParam TSchema - Type of the data being detected by the change stream\n     * @typeParam TChange - Type of the whole change stream document emitted\n     */\n    watch(pipeline = [], options = {}) {\n        // Allow optionally not specifying a pipeline\n        if (!Array.isArray(pipeline)) {\n            options = pipeline;\n            pipeline = [];\n        }\n        return new change_stream_1.ChangeStream(this, pipeline, (0, utils_1.resolveOptions)(this, options));\n    }\n    /**\n     * A low level cursor API providing basic driver functionality:\n     * - ClientSession management\n     * - ReadPreference for server selection\n     * - Running getMores automatically when a local batch is exhausted\n     *\n     * @param command - The command that will start a cursor on the server.\n     * @param options - Configurations for running the command, bson options will apply to getMores\n     */\n    runCursorCommand(command, options) {\n        return new run_command_cursor_1.RunCommandCursor(this, command, options);\n    }\n}\nDb.SYSTEM_NAMESPACE_COLLECTION = CONSTANTS.SYSTEM_NAMESPACE_COLLECTION;\nDb.SYSTEM_INDEX_COLLECTION = CONSTANTS.SYSTEM_INDEX_COLLECTION;\nDb.SYSTEM_PROFILE_COLLECTION = CONSTANTS.SYSTEM_PROFILE_COLLECTION;\nDb.SYSTEM_USER_COLLECTION = CONSTANTS.SYSTEM_USER_COLLECTION;\nDb.SYSTEM_COMMAND_COLLECTION = CONSTANTS.SYSTEM_COMMAND_COLLECTION;\nDb.SYSTEM_JS_COLLECTION = CONSTANTS.SYSTEM_JS_COLLECTION;\nexports.Db = Db;\n// TODO(NODE-3484): Refactor into MongoDBNamespace\n// Validate the database name\nfunction validateDatabaseName(databaseName) {\n    if (typeof databaseName !== 'string')\n        throw new error_1.MongoInvalidArgumentError('Database name must be a string');\n    if (databaseName.length === 0)\n        throw new error_1.MongoInvalidArgumentError('Database name cannot be the empty string');\n    if (databaseName === '$external')\n        return;\n    const invalidChars = [' ', '.', '$', '/', '\\\\'];\n    for (let i = 0; i < invalidChars.length; i++) {\n        if (databaseName.indexOf(invalidChars[i]) !== -1)\n            throw new error_1.MongoAPIError(`database names cannot contain the character '${invalidChars[i]}'`);\n    }\n}\n//# sourceMappingURL=db.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9kYi5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxVQUFVO0FBQ1YsZ0JBQWdCLG1CQUFPLENBQUMsa0VBQVM7QUFDakMsZUFBZSxtQkFBTyxDQUFDLGdFQUFRO0FBQy9CLHdCQUF3QixtQkFBTyxDQUFDLGtGQUFpQjtBQUNqRCxxQkFBcUIsbUJBQU8sQ0FBQyw0RUFBYztBQUMzQyxrQkFBa0IsbUJBQU8sQ0FBQywwRUFBYTtBQUN2Qyw2QkFBNkIsbUJBQU8sQ0FBQywwR0FBNkI7QUFDbEUsa0NBQWtDLG1CQUFPLENBQUMsb0hBQWtDO0FBQzVFLDZCQUE2QixtQkFBTyxDQUFDLDBHQUE2QjtBQUNsRSxnQkFBZ0IsbUJBQU8sQ0FBQyxrRUFBUztBQUNqQyxtQkFBbUIsbUJBQU8sQ0FBQyw4RkFBdUI7QUFDbEQsc0JBQXNCLG1CQUFPLENBQUMsb0dBQTBCO0FBQ3hELDRCQUE0QixtQkFBTyxDQUFDLGdIQUFnQztBQUNwRSxlQUFlLG1CQUFPLENBQUMsc0ZBQW1CO0FBQzFDLDRCQUE0QixtQkFBTyxDQUFDLGdIQUFnQztBQUNwRSxrQkFBa0IsbUJBQU8sQ0FBQyw0RkFBc0I7QUFDaEQsMEJBQTBCLG1CQUFPLENBQUMsNEdBQThCO0FBQ2hFLHNCQUFzQixtQkFBTyxDQUFDLG9HQUEwQjtBQUN4RCxpQkFBaUIsbUJBQU8sQ0FBQywwRkFBcUI7QUFDOUMsc0JBQXNCLG1CQUFPLENBQUMsb0dBQTBCO0FBQ3hELDhCQUE4QixtQkFBTyxDQUFDLG9IQUFrQztBQUN4RSxnQkFBZ0IsbUJBQU8sQ0FBQyx3RkFBb0I7QUFDNUMsdUJBQXVCLG1CQUFPLENBQUMsZ0ZBQWdCO0FBQy9DLDBCQUEwQixtQkFBTyxDQUFDLHNGQUFtQjtBQUNyRCxnQkFBZ0IsbUJBQU8sQ0FBQyxrRUFBUztBQUNqQyx3QkFBd0IsbUJBQU8sQ0FBQyxrRkFBaUI7QUFDakQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxjQUFjO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0IsU0FBUztBQUMzQixJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQztBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQixjQUFjO0FBQzdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvSkFBb0osNEZBQTRGO0FBQ2hQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0NBQXNDLGdIQUFnSDtBQUN0SjtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFDQUFxQztBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLHlCQUF5QjtBQUM3QztBQUNBLDRGQUE0RixnQkFBZ0I7QUFDNUc7QUFDQTtBQUNBIiwic291cmNlcyI6WyJEOlxcc2Fsb25pXFxhcHByYWlzYWwtc3lzdGVtXFxzZXJ2ZXJcXG5vZGVfbW9kdWxlc1xcbW9uZ29kYlxcbGliXFxkYi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuRGIgPSB2b2lkIDA7XG5jb25zdCBhZG1pbl8xID0gcmVxdWlyZShcIi4vYWRtaW5cIik7XG5jb25zdCBic29uXzEgPSByZXF1aXJlKFwiLi9ic29uXCIpO1xuY29uc3QgY2hhbmdlX3N0cmVhbV8xID0gcmVxdWlyZShcIi4vY2hhbmdlX3N0cmVhbVwiKTtcbmNvbnN0IGNvbGxlY3Rpb25fMSA9IHJlcXVpcmUoXCIuL2NvbGxlY3Rpb25cIik7XG5jb25zdCBDT05TVEFOVFMgPSByZXF1aXJlKFwiLi9jb25zdGFudHNcIik7XG5jb25zdCBhZ2dyZWdhdGlvbl9jdXJzb3JfMSA9IHJlcXVpcmUoXCIuL2N1cnNvci9hZ2dyZWdhdGlvbl9jdXJzb3JcIik7XG5jb25zdCBsaXN0X2NvbGxlY3Rpb25zX2N1cnNvcl8xID0gcmVxdWlyZShcIi4vY3Vyc29yL2xpc3RfY29sbGVjdGlvbnNfY3Vyc29yXCIpO1xuY29uc3QgcnVuX2NvbW1hbmRfY3Vyc29yXzEgPSByZXF1aXJlKFwiLi9jdXJzb3IvcnVuX2NvbW1hbmRfY3Vyc29yXCIpO1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuL2Vycm9yXCIpO1xuY29uc3QgYWRkX3VzZXJfMSA9IHJlcXVpcmUoXCIuL29wZXJhdGlvbnMvYWRkX3VzZXJcIik7XG5jb25zdCBjb2xsZWN0aW9uc18xID0gcmVxdWlyZShcIi4vb3BlcmF0aW9ucy9jb2xsZWN0aW9uc1wiKTtcbmNvbnN0IGNyZWF0ZV9jb2xsZWN0aW9uXzEgPSByZXF1aXJlKFwiLi9vcGVyYXRpb25zL2NyZWF0ZV9jb2xsZWN0aW9uXCIpO1xuY29uc3QgZHJvcF8xID0gcmVxdWlyZShcIi4vb3BlcmF0aW9ucy9kcm9wXCIpO1xuY29uc3QgZXhlY3V0ZV9vcGVyYXRpb25fMSA9IHJlcXVpcmUoXCIuL29wZXJhdGlvbnMvZXhlY3V0ZV9vcGVyYXRpb25cIik7XG5jb25zdCBpbmRleGVzXzEgPSByZXF1aXJlKFwiLi9vcGVyYXRpb25zL2luZGV4ZXNcIik7XG5jb25zdCBwcm9maWxpbmdfbGV2ZWxfMSA9IHJlcXVpcmUoXCIuL29wZXJhdGlvbnMvcHJvZmlsaW5nX2xldmVsXCIpO1xuY29uc3QgcmVtb3ZlX3VzZXJfMSA9IHJlcXVpcmUoXCIuL29wZXJhdGlvbnMvcmVtb3ZlX3VzZXJcIik7XG5jb25zdCByZW5hbWVfMSA9IHJlcXVpcmUoXCIuL29wZXJhdGlvbnMvcmVuYW1lXCIpO1xuY29uc3QgcnVuX2NvbW1hbmRfMSA9IHJlcXVpcmUoXCIuL29wZXJhdGlvbnMvcnVuX2NvbW1hbmRcIik7XG5jb25zdCBzZXRfcHJvZmlsaW5nX2xldmVsXzEgPSByZXF1aXJlKFwiLi9vcGVyYXRpb25zL3NldF9wcm9maWxpbmdfbGV2ZWxcIik7XG5jb25zdCBzdGF0c18xID0gcmVxdWlyZShcIi4vb3BlcmF0aW9ucy9zdGF0c1wiKTtcbmNvbnN0IHJlYWRfY29uY2Vybl8xID0gcmVxdWlyZShcIi4vcmVhZF9jb25jZXJuXCIpO1xuY29uc3QgcmVhZF9wcmVmZXJlbmNlXzEgPSByZXF1aXJlKFwiLi9yZWFkX3ByZWZlcmVuY2VcIik7XG5jb25zdCB1dGlsc18xID0gcmVxdWlyZShcIi4vdXRpbHNcIik7XG5jb25zdCB3cml0ZV9jb25jZXJuXzEgPSByZXF1aXJlKFwiLi93cml0ZV9jb25jZXJuXCIpO1xuLy8gQWxsb3dlZCBwYXJhbWV0ZXJzXG5jb25zdCBEQl9PUFRJT05TX0FMTE9XX0xJU1QgPSBbXG4gICAgJ3dyaXRlQ29uY2VybicsXG4gICAgJ3JlYWRQcmVmZXJlbmNlJyxcbiAgICAncmVhZFByZWZlcmVuY2VUYWdzJyxcbiAgICAnbmF0aXZlX3BhcnNlcicsXG4gICAgJ2ZvcmNlU2VydmVyT2JqZWN0SWQnLFxuICAgICdwa0ZhY3RvcnknLFxuICAgICdzZXJpYWxpemVGdW5jdGlvbnMnLFxuICAgICdyYXcnLFxuICAgICdhdXRoU291cmNlJyxcbiAgICAnaWdub3JlVW5kZWZpbmVkJyxcbiAgICAncmVhZENvbmNlcm4nLFxuICAgICdyZXRyeU1pbGlTZWNvbmRzJyxcbiAgICAnbnVtYmVyT2ZSZXRyaWVzJyxcbiAgICAndXNlQmlnSW50NjQnLFxuICAgICdwcm9tb3RlQnVmZmVycycsXG4gICAgJ3Byb21vdGVMb25ncycsXG4gICAgJ2Jzb25SZWdFeHAnLFxuICAgICdlbmFibGVVdGY4VmFsaWRhdGlvbicsXG4gICAgJ3Byb21vdGVWYWx1ZXMnLFxuICAgICdjb21wcmVzc2lvbicsXG4gICAgJ3JldHJ5V3JpdGVzJ1xuXTtcbi8qKlxuICogVGhlICoqRGIqKiBjbGFzcyBpcyBhIGNsYXNzIHRoYXQgcmVwcmVzZW50cyBhIE1vbmdvREIgRGF0YWJhc2UuXG4gKiBAcHVibGljXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYHRzXG4gKiBpbXBvcnQgeyBNb25nb0NsaWVudCB9IGZyb20gJ21vbmdvZGInO1xuICpcbiAqIGludGVyZmFjZSBQZXQge1xuICogICBuYW1lOiBzdHJpbmc7XG4gKiAgIGtpbmQ6ICdkb2cnIHwgJ2NhdCcgfCAnZmlzaCc7XG4gKiB9XG4gKlxuICogY29uc3QgY2xpZW50ID0gbmV3IE1vbmdvQ2xpZW50KCdtb25nb2RiOi8vbG9jYWxob3N0OjI3MDE3Jyk7XG4gKiBjb25zdCBkYiA9IGNsaWVudC5kYigpO1xuICpcbiAqIC8vIENyZWF0ZSBhIGNvbGxlY3Rpb24gdGhhdCB2YWxpZGF0ZXMgb3VyIHVuaW9uXG4gKiBhd2FpdCBkYi5jcmVhdGVDb2xsZWN0aW9uPFBldD4oJ3BldHMnLCB7XG4gKiAgIHZhbGlkYXRvcjogeyAkZXhwcjogeyAkaW46IFsnJGtpbmQnLCBbJ2RvZycsICdjYXQnLCAnZmlzaCddXSB9IH1cbiAqIH0pXG4gKiBgYGBcbiAqL1xuY2xhc3MgRGIge1xuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgRGIgaW5zdGFuY2VcbiAgICAgKlxuICAgICAqIEBwYXJhbSBjbGllbnQgLSBUaGUgTW9uZ29DbGllbnQgZm9yIHRoZSBkYXRhYmFzZS5cbiAgICAgKiBAcGFyYW0gZGF0YWJhc2VOYW1lIC0gVGhlIG5hbWUgb2YgdGhlIGRhdGFiYXNlIHRoaXMgaW5zdGFuY2UgcmVwcmVzZW50cy5cbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzIGZvciBEYiBjb25zdHJ1Y3Rpb25cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihjbGllbnQsIGRhdGFiYXNlTmFtZSwgb3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gb3B0aW9ucyA/PyB7fTtcbiAgICAgICAgLy8gRmlsdGVyIHRoZSBvcHRpb25zXG4gICAgICAgIG9wdGlvbnMgPSAoMCwgdXRpbHNfMS5maWx0ZXJPcHRpb25zKShvcHRpb25zLCBEQl9PUFRJT05TX0FMTE9XX0xJU1QpO1xuICAgICAgICAvLyBFbnN1cmUgd2UgaGF2ZSBhIHZhbGlkIGRiIG5hbWVcbiAgICAgICAgdmFsaWRhdGVEYXRhYmFzZU5hbWUoZGF0YWJhc2VOYW1lKTtcbiAgICAgICAgLy8gSW50ZXJuYWwgc3RhdGUgb2YgdGhlIGRiIG9iamVjdFxuICAgICAgICB0aGlzLnMgPSB7XG4gICAgICAgICAgICAvLyBPcHRpb25zXG4gICAgICAgICAgICBvcHRpb25zLFxuICAgICAgICAgICAgLy8gVW5wYWNrIHJlYWQgcHJlZmVyZW5jZVxuICAgICAgICAgICAgcmVhZFByZWZlcmVuY2U6IHJlYWRfcHJlZmVyZW5jZV8xLlJlYWRQcmVmZXJlbmNlLmZyb21PcHRpb25zKG9wdGlvbnMpLFxuICAgICAgICAgICAgLy8gTWVyZ2UgYnNvbiBvcHRpb25zXG4gICAgICAgICAgICBic29uT3B0aW9uczogKDAsIGJzb25fMS5yZXNvbHZlQlNPTk9wdGlvbnMpKG9wdGlvbnMsIGNsaWVudCksXG4gICAgICAgICAgICAvLyBTZXQgdXAgdGhlIHByaW1hcnkga2V5IGZhY3Rvcnkgb3IgZmFsbGJhY2sgdG8gT2JqZWN0SWRcbiAgICAgICAgICAgIHBrRmFjdG9yeTogb3B0aW9ucz8ucGtGYWN0b3J5ID8/IHV0aWxzXzEuREVGQVVMVF9QS19GQUNUT1JZLFxuICAgICAgICAgICAgLy8gUmVhZENvbmNlcm5cbiAgICAgICAgICAgIHJlYWRDb25jZXJuOiByZWFkX2NvbmNlcm5fMS5SZWFkQ29uY2Vybi5mcm9tT3B0aW9ucyhvcHRpb25zKSxcbiAgICAgICAgICAgIHdyaXRlQ29uY2Vybjogd3JpdGVfY29uY2Vybl8xLldyaXRlQ29uY2Vybi5mcm9tT3B0aW9ucyhvcHRpb25zKSxcbiAgICAgICAgICAgIC8vIE5hbWVzcGFjZVxuICAgICAgICAgICAgbmFtZXNwYWNlOiBuZXcgdXRpbHNfMS5Nb25nb0RCTmFtZXNwYWNlKGRhdGFiYXNlTmFtZSlcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5jbGllbnQgPSBjbGllbnQ7XG4gICAgfVxuICAgIGdldCBkYXRhYmFzZU5hbWUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnMubmFtZXNwYWNlLmRiO1xuICAgIH1cbiAgICAvLyBPcHRpb25zXG4gICAgZ2V0IG9wdGlvbnMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnMub3B0aW9ucztcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2hlY2sgaWYgYSBzZWNvbmRhcnkgY2FuIGJlIHVzZWQgKGJlY2F1c2UgdGhlIHJlYWQgcHJlZmVyZW5jZSBpcyAqbm90KiBzZXQgdG8gcHJpbWFyeSlcbiAgICAgKi9cbiAgICBnZXQgc2Vjb25kYXJ5T2soKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnMucmVhZFByZWZlcmVuY2U/LnByZWZlcmVuY2UgIT09ICdwcmltYXJ5JyB8fCBmYWxzZTtcbiAgICB9XG4gICAgZ2V0IHJlYWRDb25jZXJuKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zLnJlYWRDb25jZXJuO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBUaGUgY3VycmVudCByZWFkUHJlZmVyZW5jZSBvZiB0aGUgRGIuIElmIG5vdCBleHBsaWNpdGx5IGRlZmluZWQgZm9yXG4gICAgICogdGhpcyBEYiwgd2lsbCBiZSBpbmhlcml0ZWQgZnJvbSB0aGUgcGFyZW50IE1vbmdvQ2xpZW50XG4gICAgICovXG4gICAgZ2V0IHJlYWRQcmVmZXJlbmNlKCkge1xuICAgICAgICBpZiAodGhpcy5zLnJlYWRQcmVmZXJlbmNlID09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNsaWVudC5yZWFkUHJlZmVyZW5jZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5zLnJlYWRQcmVmZXJlbmNlO1xuICAgIH1cbiAgICBnZXQgYnNvbk9wdGlvbnMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnMuYnNvbk9wdGlvbnM7XG4gICAgfVxuICAgIC8vIGdldCB0aGUgd3JpdGUgQ29uY2VyblxuICAgIGdldCB3cml0ZUNvbmNlcm4oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnMud3JpdGVDb25jZXJuO1xuICAgIH1cbiAgICBnZXQgbmFtZXNwYWNlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zLm5hbWVzcGFjZS50b1N0cmluZygpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBuZXcgY29sbGVjdGlvbiBvbiBhIHNlcnZlciB3aXRoIHRoZSBzcGVjaWZpZWQgb3B0aW9ucy4gVXNlIHRoaXMgdG8gY3JlYXRlIGNhcHBlZCBjb2xsZWN0aW9ucy5cbiAgICAgKiBNb3JlIGluZm9ybWF0aW9uIGFib3V0IGNvbW1hbmQgb3B0aW9ucyBhdmFpbGFibGUgYXQgaHR0cHM6Ly93d3cubW9uZ29kYi5jb20vZG9jcy9tYW51YWwvcmVmZXJlbmNlL2NvbW1hbmQvY3JlYXRlL1xuICAgICAqXG4gICAgICogQHBhcmFtIG5hbWUgLSBUaGUgbmFtZSBvZiB0aGUgY29sbGVjdGlvbiB0byBjcmVhdGVcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzIGZvciB0aGUgY29tbWFuZFxuICAgICAqL1xuICAgIGFzeW5jIGNyZWF0ZUNvbGxlY3Rpb24obmFtZSwgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4gKDAsIGV4ZWN1dGVfb3BlcmF0aW9uXzEuZXhlY3V0ZU9wZXJhdGlvbikodGhpcy5jbGllbnQsIG5ldyBjcmVhdGVfY29sbGVjdGlvbl8xLkNyZWF0ZUNvbGxlY3Rpb25PcGVyYXRpb24odGhpcywgbmFtZSwgKDAsIHV0aWxzXzEucmVzb2x2ZU9wdGlvbnMpKHRoaXMsIG9wdGlvbnMpKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEV4ZWN1dGUgYSBjb21tYW5kXG4gICAgICpcbiAgICAgKiBAcmVtYXJrc1xuICAgICAqIFRoaXMgY29tbWFuZCBkb2VzIG5vdCBpbmhlcml0IG9wdGlvbnMgZnJvbSB0aGUgTW9uZ29DbGllbnQuXG4gICAgICpcbiAgICAgKiBUaGUgZHJpdmVyIHdpbGwgZW5zdXJlIHRoZSBmb2xsb3dpbmcgZmllbGRzIGFyZSBhdHRhY2hlZCB0byB0aGUgY29tbWFuZCBzZW50IHRvIHRoZSBzZXJ2ZXI6XG4gICAgICogLSBgbHNpZGAgLSBzb3VyY2VkIGZyb20gYW4gaW1wbGljaXQgc2Vzc2lvbiBvciBvcHRpb25zLnNlc3Npb25cbiAgICAgKiAtIGAkcmVhZFByZWZlcmVuY2VgIC0gZGVmYXVsdHMgdG8gcHJpbWFyeSBvciBjYW4gYmUgY29uZmlndXJlZCBieSBvcHRpb25zLnJlYWRQcmVmZXJlbmNlXG4gICAgICogLSBgJGRiYCAtIHNvdXJjZWQgZnJvbSB0aGUgbmFtZSBvZiB0aGlzIGRhdGFiYXNlXG4gICAgICpcbiAgICAgKiBJZiB0aGUgY2xpZW50IGhhcyBhIHNlcnZlckFwaSBzZXR0aW5nOlxuICAgICAqIC0gYGFwaVZlcnNpb25gXG4gICAgICogLSBgYXBpU3RyaWN0YFxuICAgICAqIC0gYGFwaURlcHJlY2F0aW9uRXJyb3JzYFxuICAgICAqXG4gICAgICogV2hlbiBpbiBhIHRyYW5zYWN0aW9uOlxuICAgICAqIC0gYHJlYWRDb25jZXJuYCAtIHNvdXJjZWQgZnJvbSByZWFkQ29uY2VybiBzZXQgb24gdGhlIFRyYW5zYWN0aW9uT3B0aW9uc1xuICAgICAqIC0gYHdyaXRlQ29uY2VybmAgLSBzb3VyY2VkIGZyb20gd3JpdGVDb25jZXJuIHNldCBvbiB0aGUgVHJhbnNhY3Rpb25PcHRpb25zXG4gICAgICpcbiAgICAgKiBBdHRhY2hpbmcgYW55IG9mIHRoZSBhYm92ZSBmaWVsZHMgdG8gdGhlIGNvbW1hbmQgd2lsbCBoYXZlIG5vIGVmZmVjdCBhcyB0aGUgZHJpdmVyIHdpbGwgb3ZlcndyaXRlIHRoZSB2YWx1ZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBjb21tYW5kIC0gVGhlIGNvbW1hbmQgdG8gcnVuXG4gICAgICogQHBhcmFtIG9wdGlvbnMgLSBPcHRpb25hbCBzZXR0aW5ncyBmb3IgdGhlIGNvbW1hbmRcbiAgICAgKi9cbiAgICBhc3luYyBjb21tYW5kKGNvbW1hbmQsIG9wdGlvbnMpIHtcbiAgICAgICAgLy8gSW50ZW50aW9uYWxseSwgd2UgZG8gbm90IGluaGVyaXQgb3B0aW9ucyBmcm9tIHBhcmVudCBmb3IgdGhpcyBvcGVyYXRpb24uXG4gICAgICAgIHJldHVybiAoMCwgZXhlY3V0ZV9vcGVyYXRpb25fMS5leGVjdXRlT3BlcmF0aW9uKSh0aGlzLmNsaWVudCwgbmV3IHJ1bl9jb21tYW5kXzEuUnVuQ29tbWFuZE9wZXJhdGlvbih0aGlzLCBjb21tYW5kLCBvcHRpb25zKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEV4ZWN1dGUgYW4gYWdncmVnYXRpb24gZnJhbWV3b3JrIHBpcGVsaW5lIGFnYWluc3QgdGhlIGRhdGFiYXNlLCBuZWVkcyBNb25nb0RCIFxcPj0gMy42XG4gICAgICpcbiAgICAgKiBAcGFyYW0gcGlwZWxpbmUgLSBBbiBhcnJheSBvZiBhZ2dyZWdhdGlvbiBzdGFnZXMgdG8gYmUgZXhlY3V0ZWRcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzIGZvciB0aGUgY29tbWFuZFxuICAgICAqL1xuICAgIGFnZ3JlZ2F0ZShwaXBlbGluZSA9IFtdLCBvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiBuZXcgYWdncmVnYXRpb25fY3Vyc29yXzEuQWdncmVnYXRpb25DdXJzb3IodGhpcy5jbGllbnQsIHRoaXMucy5uYW1lc3BhY2UsIHBpcGVsaW5lLCAoMCwgdXRpbHNfMS5yZXNvbHZlT3B0aW9ucykodGhpcywgb3B0aW9ucykpO1xuICAgIH1cbiAgICAvKiogUmV0dXJuIHRoZSBBZG1pbiBkYiBpbnN0YW5jZSAqL1xuICAgIGFkbWluKCkge1xuICAgICAgICByZXR1cm4gbmV3IGFkbWluXzEuQWRtaW4odGhpcyk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgYSByZWZlcmVuY2UgdG8gYSBNb25nb0RCIENvbGxlY3Rpb24uIElmIGl0IGRvZXMgbm90IGV4aXN0IGl0IHdpbGwgYmUgY3JlYXRlZCBpbXBsaWNpdGx5LlxuICAgICAqXG4gICAgICogQHBhcmFtIG5hbWUgLSB0aGUgY29sbGVjdGlvbiBuYW1lIHdlIHdpc2ggdG8gYWNjZXNzLlxuICAgICAqIEByZXR1cm5zIHJldHVybiB0aGUgbmV3IENvbGxlY3Rpb24gaW5zdGFuY2VcbiAgICAgKi9cbiAgICBjb2xsZWN0aW9uKG5hbWUsIG9wdGlvbnMgPSB7fSkge1xuICAgICAgICBpZiAodHlwZW9mIG9wdGlvbnMgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoJ1RoZSBjYWxsYmFjayBmb3JtIG9mIHRoaXMgaGVscGVyIGhhcyBiZWVuIHJlbW92ZWQuJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ldyBjb2xsZWN0aW9uXzEuQ29sbGVjdGlvbih0aGlzLCBuYW1lLCAoMCwgdXRpbHNfMS5yZXNvbHZlT3B0aW9ucykodGhpcywgb3B0aW9ucykpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBHZXQgYWxsIHRoZSBkYiBzdGF0aXN0aWNzLlxuICAgICAqXG4gICAgICogQHBhcmFtIG9wdGlvbnMgLSBPcHRpb25hbCBzZXR0aW5ncyBmb3IgdGhlIGNvbW1hbmRcbiAgICAgKi9cbiAgICBhc3luYyBzdGF0cyhvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiAoMCwgZXhlY3V0ZV9vcGVyYXRpb25fMS5leGVjdXRlT3BlcmF0aW9uKSh0aGlzLmNsaWVudCwgbmV3IHN0YXRzXzEuRGJTdGF0c09wZXJhdGlvbih0aGlzLCAoMCwgdXRpbHNfMS5yZXNvbHZlT3B0aW9ucykodGhpcywgb3B0aW9ucykpKTtcbiAgICB9XG4gICAgbGlzdENvbGxlY3Rpb25zKGZpbHRlciA9IHt9LCBvcHRpb25zID0ge30pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBsaXN0X2NvbGxlY3Rpb25zX2N1cnNvcl8xLkxpc3RDb2xsZWN0aW9uc0N1cnNvcih0aGlzLCBmaWx0ZXIsICgwLCB1dGlsc18xLnJlc29sdmVPcHRpb25zKSh0aGlzLCBvcHRpb25zKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJlbmFtZSBhIGNvbGxlY3Rpb24uXG4gICAgICpcbiAgICAgKiBAcmVtYXJrc1xuICAgICAqIFRoaXMgb3BlcmF0aW9uIGRvZXMgbm90IGluaGVyaXQgb3B0aW9ucyBmcm9tIHRoZSBNb25nb0NsaWVudC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBmcm9tQ29sbGVjdGlvbiAtIE5hbWUgb2YgY3VycmVudCBjb2xsZWN0aW9uIHRvIHJlbmFtZVxuICAgICAqIEBwYXJhbSB0b0NvbGxlY3Rpb24gLSBOZXcgbmFtZSBvZiBvZiB0aGUgY29sbGVjdGlvblxuICAgICAqIEBwYXJhbSBvcHRpb25zIC0gT3B0aW9uYWwgc2V0dGluZ3MgZm9yIHRoZSBjb21tYW5kXG4gICAgICovXG4gICAgYXN5bmMgcmVuYW1lQ29sbGVjdGlvbihmcm9tQ29sbGVjdGlvbiwgdG9Db2xsZWN0aW9uLCBvcHRpb25zKSB7XG4gICAgICAgIC8vIEludGVudGlvbmFsbHksIHdlIGRvIG5vdCBpbmhlcml0IG9wdGlvbnMgZnJvbSBwYXJlbnQgZm9yIHRoaXMgb3BlcmF0aW9uLlxuICAgICAgICByZXR1cm4gKDAsIGV4ZWN1dGVfb3BlcmF0aW9uXzEuZXhlY3V0ZU9wZXJhdGlvbikodGhpcy5jbGllbnQsIG5ldyByZW5hbWVfMS5SZW5hbWVPcGVyYXRpb24odGhpcy5jb2xsZWN0aW9uKGZyb21Db2xsZWN0aW9uKSwgdG9Db2xsZWN0aW9uLCB7IC4uLm9wdGlvbnMsIG5ld19jb2xsZWN0aW9uOiB0cnVlLCByZWFkUHJlZmVyZW5jZTogcmVhZF9wcmVmZXJlbmNlXzEuUmVhZFByZWZlcmVuY2UucHJpbWFyeSB9KSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIERyb3AgYSBjb2xsZWN0aW9uIGZyb20gdGhlIGRhdGFiYXNlLCByZW1vdmluZyBpdCBwZXJtYW5lbnRseS4gTmV3IGFjY2Vzc2VzIHdpbGwgY3JlYXRlIGEgbmV3IGNvbGxlY3Rpb24uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gbmFtZSAtIE5hbWUgb2YgY29sbGVjdGlvbiB0byBkcm9wXG4gICAgICogQHBhcmFtIG9wdGlvbnMgLSBPcHRpb25hbCBzZXR0aW5ncyBmb3IgdGhlIGNvbW1hbmRcbiAgICAgKi9cbiAgICBhc3luYyBkcm9wQ29sbGVjdGlvbihuYW1lLCBvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiAoMCwgZXhlY3V0ZV9vcGVyYXRpb25fMS5leGVjdXRlT3BlcmF0aW9uKSh0aGlzLmNsaWVudCwgbmV3IGRyb3BfMS5Ecm9wQ29sbGVjdGlvbk9wZXJhdGlvbih0aGlzLCBuYW1lLCAoMCwgdXRpbHNfMS5yZXNvbHZlT3B0aW9ucykodGhpcywgb3B0aW9ucykpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRHJvcCBhIGRhdGFiYXNlLCByZW1vdmluZyBpdCBwZXJtYW5lbnRseSBmcm9tIHRoZSBzZXJ2ZXIuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzIGZvciB0aGUgY29tbWFuZFxuICAgICAqL1xuICAgIGFzeW5jIGRyb3BEYXRhYmFzZShvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiAoMCwgZXhlY3V0ZV9vcGVyYXRpb25fMS5leGVjdXRlT3BlcmF0aW9uKSh0aGlzLmNsaWVudCwgbmV3IGRyb3BfMS5Ecm9wRGF0YWJhc2VPcGVyYXRpb24odGhpcywgKDAsIHV0aWxzXzEucmVzb2x2ZU9wdGlvbnMpKHRoaXMsIG9wdGlvbnMpKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEZldGNoIGFsbCBjb2xsZWN0aW9ucyBmb3IgdGhlIGN1cnJlbnQgZGIuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzIGZvciB0aGUgY29tbWFuZFxuICAgICAqL1xuICAgIGFzeW5jIGNvbGxlY3Rpb25zKG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuICgwLCBleGVjdXRlX29wZXJhdGlvbl8xLmV4ZWN1dGVPcGVyYXRpb24pKHRoaXMuY2xpZW50LCBuZXcgY29sbGVjdGlvbnNfMS5Db2xsZWN0aW9uc09wZXJhdGlvbih0aGlzLCAoMCwgdXRpbHNfMS5yZXNvbHZlT3B0aW9ucykodGhpcywgb3B0aW9ucykpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhbiBpbmRleCBvbiB0aGUgZGIgYW5kIGNvbGxlY3Rpb24uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gbmFtZSAtIE5hbWUgb2YgdGhlIGNvbGxlY3Rpb24gdG8gY3JlYXRlIHRoZSBpbmRleCBvbi5cbiAgICAgKiBAcGFyYW0gaW5kZXhTcGVjIC0gU3BlY2lmeSB0aGUgZmllbGQgdG8gaW5kZXgsIG9yIGFuIGluZGV4IHNwZWNpZmljYXRpb25cbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzIGZvciB0aGUgY29tbWFuZFxuICAgICAqL1xuICAgIGFzeW5jIGNyZWF0ZUluZGV4KG5hbWUsIGluZGV4U3BlYywgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4gKDAsIGV4ZWN1dGVfb3BlcmF0aW9uXzEuZXhlY3V0ZU9wZXJhdGlvbikodGhpcy5jbGllbnQsIG5ldyBpbmRleGVzXzEuQ3JlYXRlSW5kZXhPcGVyYXRpb24odGhpcywgbmFtZSwgaW5kZXhTcGVjLCAoMCwgdXRpbHNfMS5yZXNvbHZlT3B0aW9ucykodGhpcywgb3B0aW9ucykpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQWRkIGEgdXNlciB0byB0aGUgZGF0YWJhc2VcbiAgICAgKlxuICAgICAqIEBwYXJhbSB1c2VybmFtZSAtIFRoZSB1c2VybmFtZSBmb3IgdGhlIG5ldyB1c2VyXG4gICAgICogQHBhcmFtIHBhc3N3b3JkT3JPcHRpb25zIC0gQW4gb3B0aW9uYWwgcGFzc3dvcmQgZm9yIHRoZSBuZXcgdXNlciwgb3IgdGhlIG9wdGlvbnMgZm9yIHRoZSBjb21tYW5kXG4gICAgICogQHBhcmFtIG9wdGlvbnMgLSBPcHRpb25hbCBzZXR0aW5ncyBmb3IgdGhlIGNvbW1hbmRcbiAgICAgKiBAZGVwcmVjYXRlZCBVc2UgdGhlIGNyZWF0ZVVzZXIgY29tbWFuZCBpbiBgZGIuY29tbWFuZCgpYCBpbnN0ZWFkLlxuICAgICAqIEBzZWUgaHR0cHM6Ly93d3cubW9uZ29kYi5jb20vZG9jcy9tYW51YWwvcmVmZXJlbmNlL2NvbW1hbmQvY3JlYXRlVXNlci9cbiAgICAgKi9cbiAgICBhc3luYyBhZGRVc2VyKHVzZXJuYW1lLCBwYXNzd29yZE9yT3B0aW9ucywgb3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID1cbiAgICAgICAgICAgIG9wdGlvbnMgIT0gbnVsbCAmJiB0eXBlb2Ygb3B0aW9ucyA9PT0gJ29iamVjdCdcbiAgICAgICAgICAgICAgICA/IG9wdGlvbnNcbiAgICAgICAgICAgICAgICA6IHBhc3N3b3JkT3JPcHRpb25zICE9IG51bGwgJiYgdHlwZW9mIHBhc3N3b3JkT3JPcHRpb25zID09PSAnb2JqZWN0J1xuICAgICAgICAgICAgICAgICAgICA/IHBhc3N3b3JkT3JPcHRpb25zXG4gICAgICAgICAgICAgICAgICAgIDogdW5kZWZpbmVkO1xuICAgICAgICBjb25zdCBwYXNzd29yZCA9IHR5cGVvZiBwYXNzd29yZE9yT3B0aW9ucyA9PT0gJ3N0cmluZycgPyBwYXNzd29yZE9yT3B0aW9ucyA6IHVuZGVmaW5lZDtcbiAgICAgICAgcmV0dXJuICgwLCBleGVjdXRlX29wZXJhdGlvbl8xLmV4ZWN1dGVPcGVyYXRpb24pKHRoaXMuY2xpZW50LCBuZXcgYWRkX3VzZXJfMS5BZGRVc2VyT3BlcmF0aW9uKHRoaXMsIHVzZXJuYW1lLCBwYXNzd29yZCwgKDAsIHV0aWxzXzEucmVzb2x2ZU9wdGlvbnMpKHRoaXMsIG9wdGlvbnMpKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJlbW92ZSBhIHVzZXIgZnJvbSBhIGRhdGFiYXNlXG4gICAgICpcbiAgICAgKiBAcGFyYW0gdXNlcm5hbWUgLSBUaGUgdXNlcm5hbWUgdG8gcmVtb3ZlXG4gICAgICogQHBhcmFtIG9wdGlvbnMgLSBPcHRpb25hbCBzZXR0aW5ncyBmb3IgdGhlIGNvbW1hbmRcbiAgICAgKi9cbiAgICBhc3luYyByZW1vdmVVc2VyKHVzZXJuYW1lLCBvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiAoMCwgZXhlY3V0ZV9vcGVyYXRpb25fMS5leGVjdXRlT3BlcmF0aW9uKSh0aGlzLmNsaWVudCwgbmV3IHJlbW92ZV91c2VyXzEuUmVtb3ZlVXNlck9wZXJhdGlvbih0aGlzLCB1c2VybmFtZSwgKDAsIHV0aWxzXzEucmVzb2x2ZU9wdGlvbnMpKHRoaXMsIG9wdGlvbnMpKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNldCB0aGUgY3VycmVudCBwcm9maWxpbmcgbGV2ZWwgb2YgTW9uZ29EQlxuICAgICAqXG4gICAgICogQHBhcmFtIGxldmVsIC0gVGhlIG5ldyBwcm9maWxpbmcgbGV2ZWwgKG9mZiwgc2xvd19vbmx5LCBhbGwpLlxuICAgICAqIEBwYXJhbSBvcHRpb25zIC0gT3B0aW9uYWwgc2V0dGluZ3MgZm9yIHRoZSBjb21tYW5kXG4gICAgICovXG4gICAgYXN5bmMgc2V0UHJvZmlsaW5nTGV2ZWwobGV2ZWwsIG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuICgwLCBleGVjdXRlX29wZXJhdGlvbl8xLmV4ZWN1dGVPcGVyYXRpb24pKHRoaXMuY2xpZW50LCBuZXcgc2V0X3Byb2ZpbGluZ19sZXZlbF8xLlNldFByb2ZpbGluZ0xldmVsT3BlcmF0aW9uKHRoaXMsIGxldmVsLCAoMCwgdXRpbHNfMS5yZXNvbHZlT3B0aW9ucykodGhpcywgb3B0aW9ucykpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0cmlldmUgdGhlIGN1cnJlbnQgcHJvZmlsaW5nIExldmVsIGZvciBNb25nb0RCXG4gICAgICpcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzIGZvciB0aGUgY29tbWFuZFxuICAgICAqL1xuICAgIGFzeW5jIHByb2ZpbGluZ0xldmVsKG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuICgwLCBleGVjdXRlX29wZXJhdGlvbl8xLmV4ZWN1dGVPcGVyYXRpb24pKHRoaXMuY2xpZW50LCBuZXcgcHJvZmlsaW5nX2xldmVsXzEuUHJvZmlsaW5nTGV2ZWxPcGVyYXRpb24odGhpcywgKDAsIHV0aWxzXzEucmVzb2x2ZU9wdGlvbnMpKHRoaXMsIG9wdGlvbnMpKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHJpZXZlcyB0aGlzIGNvbGxlY3Rpb25zIGluZGV4IGluZm8uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gbmFtZSAtIFRoZSBuYW1lIG9mIHRoZSBjb2xsZWN0aW9uLlxuICAgICAqIEBwYXJhbSBvcHRpb25zIC0gT3B0aW9uYWwgc2V0dGluZ3MgZm9yIHRoZSBjb21tYW5kXG4gICAgICovXG4gICAgYXN5bmMgaW5kZXhJbmZvcm1hdGlvbihuYW1lLCBvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiAoMCwgZXhlY3V0ZV9vcGVyYXRpb25fMS5leGVjdXRlT3BlcmF0aW9uKSh0aGlzLmNsaWVudCwgbmV3IGluZGV4ZXNfMS5JbmRleEluZm9ybWF0aW9uT3BlcmF0aW9uKHRoaXMsIG5hbWUsICgwLCB1dGlsc18xLnJlc29sdmVPcHRpb25zKSh0aGlzLCBvcHRpb25zKSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBuZXcgQ2hhbmdlIFN0cmVhbSwgd2F0Y2hpbmcgZm9yIG5ldyBjaGFuZ2VzIChpbnNlcnRpb25zLCB1cGRhdGVzLFxuICAgICAqIHJlcGxhY2VtZW50cywgZGVsZXRpb25zLCBhbmQgaW52YWxpZGF0aW9ucykgaW4gdGhpcyBkYXRhYmFzZS4gV2lsbCBpZ25vcmUgYWxsXG4gICAgICogY2hhbmdlcyB0byBzeXN0ZW0gY29sbGVjdGlvbnMuXG4gICAgICpcbiAgICAgKiBAcmVtYXJrc1xuICAgICAqIHdhdGNoKCkgYWNjZXB0cyB0d28gZ2VuZXJpYyBhcmd1bWVudHMgZm9yIGRpc3RpbmN0IHVzZSBjYXNlczpcbiAgICAgKiAtIFRoZSBmaXJzdCBpcyB0byBwcm92aWRlIHRoZSBzY2hlbWEgdGhhdCBtYXkgYmUgZGVmaW5lZCBmb3IgYWxsIHRoZSBjb2xsZWN0aW9ucyB3aXRoaW4gdGhpcyBkYXRhYmFzZVxuICAgICAqIC0gVGhlIHNlY29uZCBpcyB0byBvdmVycmlkZSB0aGUgc2hhcGUgb2YgdGhlIGNoYW5nZSBzdHJlYW0gZG9jdW1lbnQgZW50aXJlbHksIGlmIGl0IGlzIG5vdCBwcm92aWRlZCB0aGUgdHlwZSB3aWxsIGRlZmF1bHQgdG8gQ2hhbmdlU3RyZWFtRG9jdW1lbnQgb2YgdGhlIGZpcnN0IGFyZ3VtZW50XG4gICAgICpcbiAgICAgKiBAcGFyYW0gcGlwZWxpbmUgLSBBbiBhcnJheSBvZiB7QGxpbmsgaHR0cHM6Ly93d3cubW9uZ29kYi5jb20vZG9jcy9tYW51YWwvcmVmZXJlbmNlL29wZXJhdG9yL2FnZ3JlZ2F0aW9uLXBpcGVsaW5lL3xhZ2dyZWdhdGlvbiBwaXBlbGluZSBzdGFnZXN9IHRocm91Z2ggd2hpY2ggdG8gcGFzcyBjaGFuZ2Ugc3RyZWFtIGRvY3VtZW50cy4gVGhpcyBhbGxvd3MgZm9yIGZpbHRlcmluZyAodXNpbmcgJG1hdGNoKSBhbmQgbWFuaXB1bGF0aW5nIHRoZSBjaGFuZ2Ugc3RyZWFtIGRvY3VtZW50cy5cbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzIGZvciB0aGUgY29tbWFuZFxuICAgICAqIEB0eXBlUGFyYW0gVFNjaGVtYSAtIFR5cGUgb2YgdGhlIGRhdGEgYmVpbmcgZGV0ZWN0ZWQgYnkgdGhlIGNoYW5nZSBzdHJlYW1cbiAgICAgKiBAdHlwZVBhcmFtIFRDaGFuZ2UgLSBUeXBlIG9mIHRoZSB3aG9sZSBjaGFuZ2Ugc3RyZWFtIGRvY3VtZW50IGVtaXR0ZWRcbiAgICAgKi9cbiAgICB3YXRjaChwaXBlbGluZSA9IFtdLCBvcHRpb25zID0ge30pIHtcbiAgICAgICAgLy8gQWxsb3cgb3B0aW9uYWxseSBub3Qgc3BlY2lmeWluZyBhIHBpcGVsaW5lXG4gICAgICAgIGlmICghQXJyYXkuaXNBcnJheShwaXBlbGluZSkpIHtcbiAgICAgICAgICAgIG9wdGlvbnMgPSBwaXBlbGluZTtcbiAgICAgICAgICAgIHBpcGVsaW5lID0gW107XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ldyBjaGFuZ2Vfc3RyZWFtXzEuQ2hhbmdlU3RyZWFtKHRoaXMsIHBpcGVsaW5lLCAoMCwgdXRpbHNfMS5yZXNvbHZlT3B0aW9ucykodGhpcywgb3B0aW9ucykpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBIGxvdyBsZXZlbCBjdXJzb3IgQVBJIHByb3ZpZGluZyBiYXNpYyBkcml2ZXIgZnVuY3Rpb25hbGl0eTpcbiAgICAgKiAtIENsaWVudFNlc3Npb24gbWFuYWdlbWVudFxuICAgICAqIC0gUmVhZFByZWZlcmVuY2UgZm9yIHNlcnZlciBzZWxlY3Rpb25cbiAgICAgKiAtIFJ1bm5pbmcgZ2V0TW9yZXMgYXV0b21hdGljYWxseSB3aGVuIGEgbG9jYWwgYmF0Y2ggaXMgZXhoYXVzdGVkXG4gICAgICpcbiAgICAgKiBAcGFyYW0gY29tbWFuZCAtIFRoZSBjb21tYW5kIHRoYXQgd2lsbCBzdGFydCBhIGN1cnNvciBvbiB0aGUgc2VydmVyLlxuICAgICAqIEBwYXJhbSBvcHRpb25zIC0gQ29uZmlndXJhdGlvbnMgZm9yIHJ1bm5pbmcgdGhlIGNvbW1hbmQsIGJzb24gb3B0aW9ucyB3aWxsIGFwcGx5IHRvIGdldE1vcmVzXG4gICAgICovXG4gICAgcnVuQ3Vyc29yQ29tbWFuZChjb21tYW5kLCBvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiBuZXcgcnVuX2NvbW1hbmRfY3Vyc29yXzEuUnVuQ29tbWFuZEN1cnNvcih0aGlzLCBjb21tYW5kLCBvcHRpb25zKTtcbiAgICB9XG59XG5EYi5TWVNURU1fTkFNRVNQQUNFX0NPTExFQ1RJT04gPSBDT05TVEFOVFMuU1lTVEVNX05BTUVTUEFDRV9DT0xMRUNUSU9OO1xuRGIuU1lTVEVNX0lOREVYX0NPTExFQ1RJT04gPSBDT05TVEFOVFMuU1lTVEVNX0lOREVYX0NPTExFQ1RJT047XG5EYi5TWVNURU1fUFJPRklMRV9DT0xMRUNUSU9OID0gQ09OU1RBTlRTLlNZU1RFTV9QUk9GSUxFX0NPTExFQ1RJT047XG5EYi5TWVNURU1fVVNFUl9DT0xMRUNUSU9OID0gQ09OU1RBTlRTLlNZU1RFTV9VU0VSX0NPTExFQ1RJT047XG5EYi5TWVNURU1fQ09NTUFORF9DT0xMRUNUSU9OID0gQ09OU1RBTlRTLlNZU1RFTV9DT01NQU5EX0NPTExFQ1RJT047XG5EYi5TWVNURU1fSlNfQ09MTEVDVElPTiA9IENPTlNUQU5UUy5TWVNURU1fSlNfQ09MTEVDVElPTjtcbmV4cG9ydHMuRGIgPSBEYjtcbi8vIFRPRE8oTk9ERS0zNDg0KTogUmVmYWN0b3IgaW50byBNb25nb0RCTmFtZXNwYWNlXG4vLyBWYWxpZGF0ZSB0aGUgZGF0YWJhc2UgbmFtZVxuZnVuY3Rpb24gdmFsaWRhdGVEYXRhYmFzZU5hbWUoZGF0YWJhc2VOYW1lKSB7XG4gICAgaWYgKHR5cGVvZiBkYXRhYmFzZU5hbWUgIT09ICdzdHJpbmcnKVxuICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdEYXRhYmFzZSBuYW1lIG11c3QgYmUgYSBzdHJpbmcnKTtcbiAgICBpZiAoZGF0YWJhc2VOYW1lLmxlbmd0aCA9PT0gMClcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignRGF0YWJhc2UgbmFtZSBjYW5ub3QgYmUgdGhlIGVtcHR5IHN0cmluZycpO1xuICAgIGlmIChkYXRhYmFzZU5hbWUgPT09ICckZXh0ZXJuYWwnKVxuICAgICAgICByZXR1cm47XG4gICAgY29uc3QgaW52YWxpZENoYXJzID0gWycgJywgJy4nLCAnJCcsICcvJywgJ1xcXFwnXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGludmFsaWRDaGFycy5sZW5ndGg7IGkrKykge1xuICAgICAgICBpZiAoZGF0YWJhc2VOYW1lLmluZGV4T2YoaW52YWxpZENoYXJzW2ldKSAhPT0gLTEpXG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0FQSUVycm9yKGBkYXRhYmFzZSBuYW1lcyBjYW5ub3QgY29udGFpbiB0aGUgY2hhcmFjdGVyICcke2ludmFsaWRDaGFyc1tpXX0nYCk7XG4gICAgfVxufVxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZGIuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/db.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/deps.js":
/*!**************************************************!*\
  !*** ../server/node_modules/mongodb/lib/deps.js ***!
  \**************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.AutoEncryptionLoggerLevel = exports.aws4 = exports.saslprep = exports.getSnappy = exports.getAwsCredentialProvider = exports.getZstdLibrary = exports.ZStandard = exports.getKerberos = exports.Kerberos = void 0;\nconst error_1 = __webpack_require__(/*! ./error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nfunction makeErrorModule(error) {\n    const props = error ? { kModuleError: error } : {};\n    return new Proxy(props, {\n        get: (_, key) => {\n            if (key === 'kModuleError') {\n                return error;\n            }\n            throw error;\n        },\n        set: () => {\n            throw error;\n        }\n    });\n}\nexports.Kerberos = makeErrorModule(new error_1.MongoMissingDependencyError('Optional module `kerberos` not found. Please install it to enable kerberos authentication'));\nfunction getKerberos() {\n    try {\n        // Ensure you always wrap an optional require in the try block NODE-3199\n        exports.Kerberos = __webpack_require__(/*! kerberos */ \"?0896\");\n        return exports.Kerberos;\n    }\n    catch {\n        return exports.Kerberos;\n    }\n}\nexports.getKerberos = getKerberos;\nexports.ZStandard = makeErrorModule(new error_1.MongoMissingDependencyError('Optional module `@mongodb-js/zstd` not found. Please install it to enable zstd compression'));\nfunction getZstdLibrary() {\n    try {\n        exports.ZStandard = __webpack_require__(/*! @mongodb-js/zstd */ \"?e5da\");\n        return exports.ZStandard;\n    }\n    catch {\n        return exports.ZStandard;\n    }\n}\nexports.getZstdLibrary = getZstdLibrary;\nfunction getAwsCredentialProvider() {\n    try {\n        // Ensure you always wrap an optional require in the try block NODE-3199\n        const credentialProvider = __webpack_require__(/*! @aws-sdk/credential-providers */ \"?10a0\");\n        return credentialProvider;\n    }\n    catch {\n        return makeErrorModule(new error_1.MongoMissingDependencyError('Optional module `@aws-sdk/credential-providers` not found.' +\n            ' Please install it to enable getting aws credentials via the official sdk.'));\n    }\n}\nexports.getAwsCredentialProvider = getAwsCredentialProvider;\nfunction getSnappy() {\n    try {\n        // Ensure you always wrap an optional require in the try block NODE-3199\n        const value = __webpack_require__(/*! snappy */ \"?a2ff\");\n        return value;\n    }\n    catch (cause) {\n        const kModuleError = new error_1.MongoMissingDependencyError('Optional module `snappy` not found. Please install it to enable snappy compression', { cause });\n        return { kModuleError };\n    }\n}\nexports.getSnappy = getSnappy;\nexports.saslprep = makeErrorModule(new error_1.MongoMissingDependencyError('Optional module `saslprep` not found.' +\n    ' Please install it to enable Stringprep Profile for User Names and Passwords'));\ntry {\n    // Ensure you always wrap an optional require in the try block NODE-3199\n    exports.saslprep = __webpack_require__(/*! @mongodb-js/saslprep */ \"(api)/../server/node_modules/@mongodb-js/saslprep/dist/node.js\");\n}\ncatch { } // eslint-disable-line\nexports.aws4 = makeErrorModule(new error_1.MongoMissingDependencyError('Optional module `aws4` not found. Please install it to enable AWS authentication'));\ntry {\n    // Ensure you always wrap an optional require in the try block NODE-3199\n    exports.aws4 = Object(function webpackMissingModule() { var e = new Error(\"Cannot find module 'aws4'\"); e.code = 'MODULE_NOT_FOUND'; throw e; }());\n}\ncatch { } // eslint-disable-line\n/** @public */\nexports.AutoEncryptionLoggerLevel = Object.freeze({\n    FatalError: 0,\n    Error: 1,\n    Warning: 2,\n    Info: 3,\n    Trace: 4\n});\n//# sourceMappingURL=deps.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9kZXBzLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELGlDQUFpQyxHQUFHLFlBQVksR0FBRyxnQkFBZ0IsR0FBRyxpQkFBaUIsR0FBRyxnQ0FBZ0MsR0FBRyxzQkFBc0IsR0FBRyxpQkFBaUIsR0FBRyxtQkFBbUIsR0FBRyxnQkFBZ0I7QUFDaE4sZ0JBQWdCLG1CQUFPLENBQUMsa0VBQVM7QUFDakM7QUFDQSw0QkFBNEIsc0JBQXNCO0FBQ2xEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxnQkFBZ0I7QUFDaEI7QUFDQTtBQUNBO0FBQ0EsUUFBUSwrREFBc0M7QUFDOUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CO0FBQ25CLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsUUFBUSx3RUFBK0M7QUFDdkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBLG1DQUFtQyxtQkFBTyxDQUFDLDRDQUErQjtBQUMxRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQztBQUNoQztBQUNBO0FBQ0E7QUFDQSxzQkFBc0IsbUJBQU8sQ0FBQyxxQkFBUTtBQUN0QztBQUNBO0FBQ0E7QUFDQSw2SkFBNkosT0FBTztBQUNwSyxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixnQkFBZ0I7QUFDaEI7QUFDQTtBQUNBO0FBQ0EsSUFBSSxvSUFBa0Q7QUFDdEQ7QUFDQSxVQUFVO0FBQ1YsWUFBWTtBQUNaO0FBQ0E7QUFDQSxJQUFJLGtKQUE4QjtBQUNsQztBQUNBLFVBQVU7QUFDVjtBQUNBLGlDQUFpQztBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEIiwic291cmNlcyI6WyJEOlxcc2Fsb25pXFxhcHByYWlzYWwtc3lzdGVtXFxzZXJ2ZXJcXG5vZGVfbW9kdWxlc1xcbW9uZ29kYlxcbGliXFxkZXBzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5BdXRvRW5jcnlwdGlvbkxvZ2dlckxldmVsID0gZXhwb3J0cy5hd3M0ID0gZXhwb3J0cy5zYXNscHJlcCA9IGV4cG9ydHMuZ2V0U25hcHB5ID0gZXhwb3J0cy5nZXRBd3NDcmVkZW50aWFsUHJvdmlkZXIgPSBleHBvcnRzLmdldFpzdGRMaWJyYXJ5ID0gZXhwb3J0cy5aU3RhbmRhcmQgPSBleHBvcnRzLmdldEtlcmJlcm9zID0gZXhwb3J0cy5LZXJiZXJvcyA9IHZvaWQgMDtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi9lcnJvclwiKTtcbmZ1bmN0aW9uIG1ha2VFcnJvck1vZHVsZShlcnJvcikge1xuICAgIGNvbnN0IHByb3BzID0gZXJyb3IgPyB7IGtNb2R1bGVFcnJvcjogZXJyb3IgfSA6IHt9O1xuICAgIHJldHVybiBuZXcgUHJveHkocHJvcHMsIHtcbiAgICAgICAgZ2V0OiAoXywga2V5KSA9PiB7XG4gICAgICAgICAgICBpZiAoa2V5ID09PSAna01vZHVsZUVycm9yJykge1xuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICB9LFxuICAgICAgICBzZXQ6ICgpID0+IHtcbiAgICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5leHBvcnRzLktlcmJlcm9zID0gbWFrZUVycm9yTW9kdWxlKG5ldyBlcnJvcl8xLk1vbmdvTWlzc2luZ0RlcGVuZGVuY3lFcnJvcignT3B0aW9uYWwgbW9kdWxlIGBrZXJiZXJvc2Agbm90IGZvdW5kLiBQbGVhc2UgaW5zdGFsbCBpdCB0byBlbmFibGUga2VyYmVyb3MgYXV0aGVudGljYXRpb24nKSk7XG5mdW5jdGlvbiBnZXRLZXJiZXJvcygpIHtcbiAgICB0cnkge1xuICAgICAgICAvLyBFbnN1cmUgeW91IGFsd2F5cyB3cmFwIGFuIG9wdGlvbmFsIHJlcXVpcmUgaW4gdGhlIHRyeSBibG9jayBOT0RFLTMxOTlcbiAgICAgICAgZXhwb3J0cy5LZXJiZXJvcyA9IHJlcXVpcmUoJ2tlcmJlcm9zJyk7XG4gICAgICAgIHJldHVybiBleHBvcnRzLktlcmJlcm9zO1xuICAgIH1cbiAgICBjYXRjaCB7XG4gICAgICAgIHJldHVybiBleHBvcnRzLktlcmJlcm9zO1xuICAgIH1cbn1cbmV4cG9ydHMuZ2V0S2VyYmVyb3MgPSBnZXRLZXJiZXJvcztcbmV4cG9ydHMuWlN0YW5kYXJkID0gbWFrZUVycm9yTW9kdWxlKG5ldyBlcnJvcl8xLk1vbmdvTWlzc2luZ0RlcGVuZGVuY3lFcnJvcignT3B0aW9uYWwgbW9kdWxlIGBAbW9uZ29kYi1qcy96c3RkYCBub3QgZm91bmQuIFBsZWFzZSBpbnN0YWxsIGl0IHRvIGVuYWJsZSB6c3RkIGNvbXByZXNzaW9uJykpO1xuZnVuY3Rpb24gZ2V0WnN0ZExpYnJhcnkoKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgZXhwb3J0cy5aU3RhbmRhcmQgPSByZXF1aXJlKCdAbW9uZ29kYi1qcy96c3RkJyk7XG4gICAgICAgIHJldHVybiBleHBvcnRzLlpTdGFuZGFyZDtcbiAgICB9XG4gICAgY2F0Y2gge1xuICAgICAgICByZXR1cm4gZXhwb3J0cy5aU3RhbmRhcmQ7XG4gICAgfVxufVxuZXhwb3J0cy5nZXRac3RkTGlicmFyeSA9IGdldFpzdGRMaWJyYXJ5O1xuZnVuY3Rpb24gZ2V0QXdzQ3JlZGVudGlhbFByb3ZpZGVyKCkge1xuICAgIHRyeSB7XG4gICAgICAgIC8vIEVuc3VyZSB5b3UgYWx3YXlzIHdyYXAgYW4gb3B0aW9uYWwgcmVxdWlyZSBpbiB0aGUgdHJ5IGJsb2NrIE5PREUtMzE5OVxuICAgICAgICBjb25zdCBjcmVkZW50aWFsUHJvdmlkZXIgPSByZXF1aXJlKCdAYXdzLXNkay9jcmVkZW50aWFsLXByb3ZpZGVycycpO1xuICAgICAgICByZXR1cm4gY3JlZGVudGlhbFByb3ZpZGVyO1xuICAgIH1cbiAgICBjYXRjaCB7XG4gICAgICAgIHJldHVybiBtYWtlRXJyb3JNb2R1bGUobmV3IGVycm9yXzEuTW9uZ29NaXNzaW5nRGVwZW5kZW5jeUVycm9yKCdPcHRpb25hbCBtb2R1bGUgYEBhd3Mtc2RrL2NyZWRlbnRpYWwtcHJvdmlkZXJzYCBub3QgZm91bmQuJyArXG4gICAgICAgICAgICAnIFBsZWFzZSBpbnN0YWxsIGl0IHRvIGVuYWJsZSBnZXR0aW5nIGF3cyBjcmVkZW50aWFscyB2aWEgdGhlIG9mZmljaWFsIHNkay4nKSk7XG4gICAgfVxufVxuZXhwb3J0cy5nZXRBd3NDcmVkZW50aWFsUHJvdmlkZXIgPSBnZXRBd3NDcmVkZW50aWFsUHJvdmlkZXI7XG5mdW5jdGlvbiBnZXRTbmFwcHkoKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgLy8gRW5zdXJlIHlvdSBhbHdheXMgd3JhcCBhbiBvcHRpb25hbCByZXF1aXJlIGluIHRoZSB0cnkgYmxvY2sgTk9ERS0zMTk5XG4gICAgICAgIGNvbnN0IHZhbHVlID0gcmVxdWlyZSgnc25hcHB5Jyk7XG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9XG4gICAgY2F0Y2ggKGNhdXNlKSB7XG4gICAgICAgIGNvbnN0IGtNb2R1bGVFcnJvciA9IG5ldyBlcnJvcl8xLk1vbmdvTWlzc2luZ0RlcGVuZGVuY3lFcnJvcignT3B0aW9uYWwgbW9kdWxlIGBzbmFwcHlgIG5vdCBmb3VuZC4gUGxlYXNlIGluc3RhbGwgaXQgdG8gZW5hYmxlIHNuYXBweSBjb21wcmVzc2lvbicsIHsgY2F1c2UgfSk7XG4gICAgICAgIHJldHVybiB7IGtNb2R1bGVFcnJvciB9O1xuICAgIH1cbn1cbmV4cG9ydHMuZ2V0U25hcHB5ID0gZ2V0U25hcHB5O1xuZXhwb3J0cy5zYXNscHJlcCA9IG1ha2VFcnJvck1vZHVsZShuZXcgZXJyb3JfMS5Nb25nb01pc3NpbmdEZXBlbmRlbmN5RXJyb3IoJ09wdGlvbmFsIG1vZHVsZSBgc2FzbHByZXBgIG5vdCBmb3VuZC4nICtcbiAgICAnIFBsZWFzZSBpbnN0YWxsIGl0IHRvIGVuYWJsZSBTdHJpbmdwcmVwIFByb2ZpbGUgZm9yIFVzZXIgTmFtZXMgYW5kIFBhc3N3b3JkcycpKTtcbnRyeSB7XG4gICAgLy8gRW5zdXJlIHlvdSBhbHdheXMgd3JhcCBhbiBvcHRpb25hbCByZXF1aXJlIGluIHRoZSB0cnkgYmxvY2sgTk9ERS0zMTk5XG4gICAgZXhwb3J0cy5zYXNscHJlcCA9IHJlcXVpcmUoJ0Btb25nb2RiLWpzL3Nhc2xwcmVwJyk7XG59XG5jYXRjaCB7IH0gLy8gZXNsaW50LWRpc2FibGUtbGluZVxuZXhwb3J0cy5hd3M0ID0gbWFrZUVycm9yTW9kdWxlKG5ldyBlcnJvcl8xLk1vbmdvTWlzc2luZ0RlcGVuZGVuY3lFcnJvcignT3B0aW9uYWwgbW9kdWxlIGBhd3M0YCBub3QgZm91bmQuIFBsZWFzZSBpbnN0YWxsIGl0IHRvIGVuYWJsZSBBV1MgYXV0aGVudGljYXRpb24nKSk7XG50cnkge1xuICAgIC8vIEVuc3VyZSB5b3UgYWx3YXlzIHdyYXAgYW4gb3B0aW9uYWwgcmVxdWlyZSBpbiB0aGUgdHJ5IGJsb2NrIE5PREUtMzE5OVxuICAgIGV4cG9ydHMuYXdzNCA9IHJlcXVpcmUoJ2F3czQnKTtcbn1cbmNhdGNoIHsgfSAvLyBlc2xpbnQtZGlzYWJsZS1saW5lXG4vKiogQHB1YmxpYyAqL1xuZXhwb3J0cy5BdXRvRW5jcnlwdGlvbkxvZ2dlckxldmVsID0gT2JqZWN0LmZyZWV6ZSh7XG4gICAgRmF0YWxFcnJvcjogMCxcbiAgICBFcnJvcjogMSxcbiAgICBXYXJuaW5nOiAyLFxuICAgIEluZm86IDMsXG4gICAgVHJhY2U6IDRcbn0pO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZGVwcy5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/deps.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/encrypter.js":
/*!*******************************************************!*\
  !*** ../server/node_modules/mongodb/lib/encrypter.js ***!
  \*******************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\n/* eslint-disable @typescript-eslint/no-var-requires */\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.Encrypter = void 0;\nconst constants_1 = __webpack_require__(/*! ./constants */ \"(api)/../server/node_modules/mongodb/lib/constants.js\");\nconst error_1 = __webpack_require__(/*! ./error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst mongo_client_1 = __webpack_require__(/*! ./mongo_client */ \"(api)/../server/node_modules/mongodb/lib/mongo_client.js\");\nconst utils_1 = __webpack_require__(/*! ./utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\nlet AutoEncrypterClass;\n/** @internal */\nconst kInternalClient = Symbol('internalClient');\n/** @internal */\nclass Encrypter {\n    constructor(client, uri, options) {\n        if (typeof options.autoEncryption !== 'object') {\n            throw new error_1.MongoInvalidArgumentError('Option \"autoEncryption\" must be specified');\n        }\n        // initialize to null, if we call getInternalClient, we may set this it is important to not overwrite those function calls.\n        this[kInternalClient] = null;\n        this.bypassAutoEncryption = !!options.autoEncryption.bypassAutoEncryption;\n        this.needsConnecting = false;\n        if (options.maxPoolSize === 0 && options.autoEncryption.keyVaultClient == null) {\n            options.autoEncryption.keyVaultClient = client;\n        }\n        else if (options.autoEncryption.keyVaultClient == null) {\n            options.autoEncryption.keyVaultClient = this.getInternalClient(client, uri, options);\n        }\n        if (this.bypassAutoEncryption) {\n            options.autoEncryption.metadataClient = undefined;\n        }\n        else if (options.maxPoolSize === 0) {\n            options.autoEncryption.metadataClient = client;\n        }\n        else {\n            options.autoEncryption.metadataClient = this.getInternalClient(client, uri, options);\n        }\n        if (options.proxyHost) {\n            options.autoEncryption.proxyOptions = {\n                proxyHost: options.proxyHost,\n                proxyPort: options.proxyPort,\n                proxyUsername: options.proxyUsername,\n                proxyPassword: options.proxyPassword\n            };\n        }\n        this.autoEncrypter = new AutoEncrypterClass(client, options.autoEncryption);\n    }\n    getInternalClient(client, uri, options) {\n        // TODO(NODE-4144): Remove new variable for type narrowing\n        let internalClient = this[kInternalClient];\n        if (internalClient == null) {\n            const clonedOptions = {};\n            for (const key of [\n                ...Object.getOwnPropertyNames(options),\n                ...Object.getOwnPropertySymbols(options)\n            ]) {\n                if (['autoEncryption', 'minPoolSize', 'servers', 'caseTranslate', 'dbName'].includes(key))\n                    continue;\n                Reflect.set(clonedOptions, key, Reflect.get(options, key));\n            }\n            clonedOptions.minPoolSize = 0;\n            internalClient = new mongo_client_1.MongoClient(uri, clonedOptions);\n            this[kInternalClient] = internalClient;\n            for (const eventName of constants_1.MONGO_CLIENT_EVENTS) {\n                for (const listener of client.listeners(eventName)) {\n                    internalClient.on(eventName, listener);\n                }\n            }\n            client.on('newListener', (eventName, listener) => {\n                internalClient?.on(eventName, listener);\n            });\n            this.needsConnecting = true;\n        }\n        return internalClient;\n    }\n    async connectInternalClient() {\n        // TODO(NODE-4144): Remove new variable for type narrowing\n        const internalClient = this[kInternalClient];\n        if (this.needsConnecting && internalClient != null) {\n            this.needsConnecting = false;\n            await internalClient.connect();\n        }\n    }\n    close(client, force, callback) {\n        this.autoEncrypter.teardown(!!force, e => {\n            const internalClient = this[kInternalClient];\n            if (internalClient != null && client !== internalClient) {\n                internalClient.close(force).then(() => callback(), error => callback(error));\n                return;\n            }\n            callback(e);\n        });\n    }\n    static checkForMongoCrypt() {\n        const mongodbClientEncryption = (0, utils_1.getMongoDBClientEncryption)();\n        if (mongodbClientEncryption == null) {\n            throw new error_1.MongoMissingDependencyError('Auto-encryption requested, but the module is not installed. ' +\n                'Please add `mongodb-client-encryption` as a dependency of your project');\n        }\n        AutoEncrypterClass = mongodbClientEncryption.extension(__webpack_require__(/*! ../lib/index */ \"(api)/../server/node_modules/mongodb/lib/index.js\")).AutoEncrypter;\n    }\n}\nexports.Encrypter = Encrypter;\n//# sourceMappingURL=encrypter.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9lbmNyeXB0ZXIuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYjtBQUNBLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxpQkFBaUI7QUFDakIsb0JBQW9CLG1CQUFPLENBQUMsMEVBQWE7QUFDekMsZ0JBQWdCLG1CQUFPLENBQUMsa0VBQVM7QUFDakMsdUJBQXVCLG1CQUFPLENBQUMsZ0ZBQWdCO0FBQy9DLGdCQUFnQixtQkFBTyxDQUFDLGtFQUFTO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrREFBK0QsbUJBQU8sQ0FBQyx1RUFBYztBQUNyRjtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCIiwic291cmNlcyI6WyJEOlxcc2Fsb25pXFxhcHByYWlzYWwtc3lzdGVtXFxzZXJ2ZXJcXG5vZGVfbW9kdWxlc1xcbW9uZ29kYlxcbGliXFxlbmNyeXB0ZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG4vKiBlc2xpbnQtZGlzYWJsZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdmFyLXJlcXVpcmVzICovXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkVuY3J5cHRlciA9IHZvaWQgMDtcbmNvbnN0IGNvbnN0YW50c18xID0gcmVxdWlyZShcIi4vY29uc3RhbnRzXCIpO1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuL2Vycm9yXCIpO1xuY29uc3QgbW9uZ29fY2xpZW50XzEgPSByZXF1aXJlKFwiLi9tb25nb19jbGllbnRcIik7XG5jb25zdCB1dGlsc18xID0gcmVxdWlyZShcIi4vdXRpbHNcIik7XG5sZXQgQXV0b0VuY3J5cHRlckNsYXNzO1xuLyoqIEBpbnRlcm5hbCAqL1xuY29uc3Qga0ludGVybmFsQ2xpZW50ID0gU3ltYm9sKCdpbnRlcm5hbENsaWVudCcpO1xuLyoqIEBpbnRlcm5hbCAqL1xuY2xhc3MgRW5jcnlwdGVyIHtcbiAgICBjb25zdHJ1Y3RvcihjbGllbnQsIHVyaSwgb3B0aW9ucykge1xuICAgICAgICBpZiAodHlwZW9mIG9wdGlvbnMuYXV0b0VuY3J5cHRpb24gIT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdPcHRpb24gXCJhdXRvRW5jcnlwdGlvblwiIG11c3QgYmUgc3BlY2lmaWVkJyk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gaW5pdGlhbGl6ZSB0byBudWxsLCBpZiB3ZSBjYWxsIGdldEludGVybmFsQ2xpZW50LCB3ZSBtYXkgc2V0IHRoaXMgaXQgaXMgaW1wb3J0YW50IHRvIG5vdCBvdmVyd3JpdGUgdGhvc2UgZnVuY3Rpb24gY2FsbHMuXG4gICAgICAgIHRoaXNba0ludGVybmFsQ2xpZW50XSA9IG51bGw7XG4gICAgICAgIHRoaXMuYnlwYXNzQXV0b0VuY3J5cHRpb24gPSAhIW9wdGlvbnMuYXV0b0VuY3J5cHRpb24uYnlwYXNzQXV0b0VuY3J5cHRpb247XG4gICAgICAgIHRoaXMubmVlZHNDb25uZWN0aW5nID0gZmFsc2U7XG4gICAgICAgIGlmIChvcHRpb25zLm1heFBvb2xTaXplID09PSAwICYmIG9wdGlvbnMuYXV0b0VuY3J5cHRpb24ua2V5VmF1bHRDbGllbnQgPT0gbnVsbCkge1xuICAgICAgICAgICAgb3B0aW9ucy5hdXRvRW5jcnlwdGlvbi5rZXlWYXVsdENsaWVudCA9IGNsaWVudDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChvcHRpb25zLmF1dG9FbmNyeXB0aW9uLmtleVZhdWx0Q2xpZW50ID09IG51bGwpIHtcbiAgICAgICAgICAgIG9wdGlvbnMuYXV0b0VuY3J5cHRpb24ua2V5VmF1bHRDbGllbnQgPSB0aGlzLmdldEludGVybmFsQ2xpZW50KGNsaWVudCwgdXJpLCBvcHRpb25zKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5ieXBhc3NBdXRvRW5jcnlwdGlvbikge1xuICAgICAgICAgICAgb3B0aW9ucy5hdXRvRW5jcnlwdGlvbi5tZXRhZGF0YUNsaWVudCA9IHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChvcHRpb25zLm1heFBvb2xTaXplID09PSAwKSB7XG4gICAgICAgICAgICBvcHRpb25zLmF1dG9FbmNyeXB0aW9uLm1ldGFkYXRhQ2xpZW50ID0gY2xpZW50O1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgb3B0aW9ucy5hdXRvRW5jcnlwdGlvbi5tZXRhZGF0YUNsaWVudCA9IHRoaXMuZ2V0SW50ZXJuYWxDbGllbnQoY2xpZW50LCB1cmksIG9wdGlvbnMpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvcHRpb25zLnByb3h5SG9zdCkge1xuICAgICAgICAgICAgb3B0aW9ucy5hdXRvRW5jcnlwdGlvbi5wcm94eU9wdGlvbnMgPSB7XG4gICAgICAgICAgICAgICAgcHJveHlIb3N0OiBvcHRpb25zLnByb3h5SG9zdCxcbiAgICAgICAgICAgICAgICBwcm94eVBvcnQ6IG9wdGlvbnMucHJveHlQb3J0LFxuICAgICAgICAgICAgICAgIHByb3h5VXNlcm5hbWU6IG9wdGlvbnMucHJveHlVc2VybmFtZSxcbiAgICAgICAgICAgICAgICBwcm94eVBhc3N3b3JkOiBvcHRpb25zLnByb3h5UGFzc3dvcmRcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5hdXRvRW5jcnlwdGVyID0gbmV3IEF1dG9FbmNyeXB0ZXJDbGFzcyhjbGllbnQsIG9wdGlvbnMuYXV0b0VuY3J5cHRpb24pO1xuICAgIH1cbiAgICBnZXRJbnRlcm5hbENsaWVudChjbGllbnQsIHVyaSwgb3B0aW9ucykge1xuICAgICAgICAvLyBUT0RPKE5PREUtNDE0NCk6IFJlbW92ZSBuZXcgdmFyaWFibGUgZm9yIHR5cGUgbmFycm93aW5nXG4gICAgICAgIGxldCBpbnRlcm5hbENsaWVudCA9IHRoaXNba0ludGVybmFsQ2xpZW50XTtcbiAgICAgICAgaWYgKGludGVybmFsQ2xpZW50ID09IG51bGwpIHtcbiAgICAgICAgICAgIGNvbnN0IGNsb25lZE9wdGlvbnMgPSB7fTtcbiAgICAgICAgICAgIGZvciAoY29uc3Qga2V5IG9mIFtcbiAgICAgICAgICAgICAgICAuLi5PYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhvcHRpb25zKSxcbiAgICAgICAgICAgICAgICAuLi5PYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9wdGlvbnMpXG4gICAgICAgICAgICBdKSB7XG4gICAgICAgICAgICAgICAgaWYgKFsnYXV0b0VuY3J5cHRpb24nLCAnbWluUG9vbFNpemUnLCAnc2VydmVycycsICdjYXNlVHJhbnNsYXRlJywgJ2RiTmFtZSddLmluY2x1ZGVzKGtleSkpXG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIFJlZmxlY3Quc2V0KGNsb25lZE9wdGlvbnMsIGtleSwgUmVmbGVjdC5nZXQob3B0aW9ucywga2V5KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjbG9uZWRPcHRpb25zLm1pblBvb2xTaXplID0gMDtcbiAgICAgICAgICAgIGludGVybmFsQ2xpZW50ID0gbmV3IG1vbmdvX2NsaWVudF8xLk1vbmdvQ2xpZW50KHVyaSwgY2xvbmVkT3B0aW9ucyk7XG4gICAgICAgICAgICB0aGlzW2tJbnRlcm5hbENsaWVudF0gPSBpbnRlcm5hbENsaWVudDtcbiAgICAgICAgICAgIGZvciAoY29uc3QgZXZlbnROYW1lIG9mIGNvbnN0YW50c18xLk1PTkdPX0NMSUVOVF9FVkVOVFMpIHtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGxpc3RlbmVyIG9mIGNsaWVudC5saXN0ZW5lcnMoZXZlbnROYW1lKSkge1xuICAgICAgICAgICAgICAgICAgICBpbnRlcm5hbENsaWVudC5vbihldmVudE5hbWUsIGxpc3RlbmVyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjbGllbnQub24oJ25ld0xpc3RlbmVyJywgKGV2ZW50TmFtZSwgbGlzdGVuZXIpID0+IHtcbiAgICAgICAgICAgICAgICBpbnRlcm5hbENsaWVudD8ub24oZXZlbnROYW1lLCBsaXN0ZW5lcik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRoaXMubmVlZHNDb25uZWN0aW5nID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaW50ZXJuYWxDbGllbnQ7XG4gICAgfVxuICAgIGFzeW5jIGNvbm5lY3RJbnRlcm5hbENsaWVudCgpIHtcbiAgICAgICAgLy8gVE9ETyhOT0RFLTQxNDQpOiBSZW1vdmUgbmV3IHZhcmlhYmxlIGZvciB0eXBlIG5hcnJvd2luZ1xuICAgICAgICBjb25zdCBpbnRlcm5hbENsaWVudCA9IHRoaXNba0ludGVybmFsQ2xpZW50XTtcbiAgICAgICAgaWYgKHRoaXMubmVlZHNDb25uZWN0aW5nICYmIGludGVybmFsQ2xpZW50ICE9IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXMubmVlZHNDb25uZWN0aW5nID0gZmFsc2U7XG4gICAgICAgICAgICBhd2FpdCBpbnRlcm5hbENsaWVudC5jb25uZWN0KCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY2xvc2UoY2xpZW50LCBmb3JjZSwgY2FsbGJhY2spIHtcbiAgICAgICAgdGhpcy5hdXRvRW5jcnlwdGVyLnRlYXJkb3duKCEhZm9yY2UsIGUgPT4ge1xuICAgICAgICAgICAgY29uc3QgaW50ZXJuYWxDbGllbnQgPSB0aGlzW2tJbnRlcm5hbENsaWVudF07XG4gICAgICAgICAgICBpZiAoaW50ZXJuYWxDbGllbnQgIT0gbnVsbCAmJiBjbGllbnQgIT09IGludGVybmFsQ2xpZW50KSB7XG4gICAgICAgICAgICAgICAgaW50ZXJuYWxDbGllbnQuY2xvc2UoZm9yY2UpLnRoZW4oKCkgPT4gY2FsbGJhY2soKSwgZXJyb3IgPT4gY2FsbGJhY2soZXJyb3IpKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYWxsYmFjayhlKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHN0YXRpYyBjaGVja0Zvck1vbmdvQ3J5cHQoKSB7XG4gICAgICAgIGNvbnN0IG1vbmdvZGJDbGllbnRFbmNyeXB0aW9uID0gKDAsIHV0aWxzXzEuZ2V0TW9uZ29EQkNsaWVudEVuY3J5cHRpb24pKCk7XG4gICAgICAgIGlmIChtb25nb2RiQ2xpZW50RW5jcnlwdGlvbiA9PSBudWxsKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb01pc3NpbmdEZXBlbmRlbmN5RXJyb3IoJ0F1dG8tZW5jcnlwdGlvbiByZXF1ZXN0ZWQsIGJ1dCB0aGUgbW9kdWxlIGlzIG5vdCBpbnN0YWxsZWQuICcgK1xuICAgICAgICAgICAgICAgICdQbGVhc2UgYWRkIGBtb25nb2RiLWNsaWVudC1lbmNyeXB0aW9uYCBhcyBhIGRlcGVuZGVuY3kgb2YgeW91ciBwcm9qZWN0Jyk7XG4gICAgICAgIH1cbiAgICAgICAgQXV0b0VuY3J5cHRlckNsYXNzID0gbW9uZ29kYkNsaWVudEVuY3J5cHRpb24uZXh0ZW5zaW9uKHJlcXVpcmUoJy4uL2xpYi9pbmRleCcpKS5BdXRvRW5jcnlwdGVyO1xuICAgIH1cbn1cbmV4cG9ydHMuRW5jcnlwdGVyID0gRW5jcnlwdGVyO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZW5jcnlwdGVyLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/encrypter.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/error.js":
/*!***************************************************!*\
  !*** ../server/node_modules/mongodb/lib/error.js ***!
  \***************************************************/
/***/ ((__unused_webpack_module, exports) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.isResumableError = exports.isNetworkTimeoutError = exports.isSDAMUnrecoverableError = exports.isNodeShuttingDownError = exports.isRetryableReadError = exports.isRetryableWriteError = exports.needsRetryableWriteLabel = exports.MongoWriteConcernError = exports.MongoServerSelectionError = exports.MongoSystemError = exports.MongoMissingDependencyError = exports.MongoMissingCredentialsError = exports.MongoCompatibilityError = exports.MongoInvalidArgumentError = exports.MongoParseError = exports.MongoNetworkTimeoutError = exports.MongoNetworkError = exports.isNetworkErrorBeforeHandshake = exports.MongoTopologyClosedError = exports.MongoCursorExhaustedError = exports.MongoServerClosedError = exports.MongoCursorInUseError = exports.MongoUnexpectedServerResponseError = exports.MongoGridFSChunkError = exports.MongoGridFSStreamError = exports.MongoTailableCursorError = exports.MongoChangeStreamError = exports.MongoAzureError = exports.MongoAWSError = exports.MongoKerberosError = exports.MongoExpiredSessionError = exports.MongoTransactionError = exports.MongoNotConnectedError = exports.MongoDecompressionError = exports.MongoBatchReExecutionError = exports.MongoRuntimeError = exports.MongoAPIError = exports.MongoDriverError = exports.MongoServerError = exports.MongoError = exports.MongoErrorLabel = exports.GET_MORE_RESUMABLE_CODES = exports.MONGODB_ERROR_CODES = exports.NODE_IS_RECOVERING_ERROR_MESSAGE = exports.LEGACY_NOT_PRIMARY_OR_SECONDARY_ERROR_MESSAGE = exports.LEGACY_NOT_WRITABLE_PRIMARY_ERROR_MESSAGE = void 0;\n/** @internal */\nconst kErrorLabels = Symbol('errorLabels');\n/**\n * @internal\n * The legacy error message from the server that indicates the node is not a writable primary\n * https://github.com/mongodb/specifications/blob/b07c26dc40d04ac20349f989db531c9845fdd755/source/server-discovery-and-monitoring/server-discovery-and-monitoring.rst#not-writable-primary-and-node-is-recovering\n */\nexports.LEGACY_NOT_WRITABLE_PRIMARY_ERROR_MESSAGE = new RegExp('not master', 'i');\n/**\n * @internal\n * The legacy error message from the server that indicates the node is not a primary or secondary\n * https://github.com/mongodb/specifications/blob/b07c26dc40d04ac20349f989db531c9845fdd755/source/server-discovery-and-monitoring/server-discovery-and-monitoring.rst#not-writable-primary-and-node-is-recovering\n */\nexports.LEGACY_NOT_PRIMARY_OR_SECONDARY_ERROR_MESSAGE = new RegExp('not master or secondary', 'i');\n/**\n * @internal\n * The error message from the server that indicates the node is recovering\n * https://github.com/mongodb/specifications/blob/b07c26dc40d04ac20349f989db531c9845fdd755/source/server-discovery-and-monitoring/server-discovery-and-monitoring.rst#not-writable-primary-and-node-is-recovering\n */\nexports.NODE_IS_RECOVERING_ERROR_MESSAGE = new RegExp('node is recovering', 'i');\n/** @internal MongoDB Error Codes */\nexports.MONGODB_ERROR_CODES = Object.freeze({\n    HostUnreachable: 6,\n    HostNotFound: 7,\n    NetworkTimeout: 89,\n    ShutdownInProgress: 91,\n    PrimarySteppedDown: 189,\n    ExceededTimeLimit: 262,\n    SocketException: 9001,\n    NotWritablePrimary: 10107,\n    InterruptedAtShutdown: 11600,\n    InterruptedDueToReplStateChange: 11602,\n    NotPrimaryNoSecondaryOk: 13435,\n    NotPrimaryOrSecondary: 13436,\n    StaleShardVersion: 63,\n    StaleEpoch: 150,\n    StaleConfig: 13388,\n    RetryChangeStream: 234,\n    FailedToSatisfyReadPreference: 133,\n    CursorNotFound: 43,\n    LegacyNotPrimary: 10058,\n    WriteConcernFailed: 64,\n    NamespaceNotFound: 26,\n    IllegalOperation: 20,\n    MaxTimeMSExpired: 50,\n    UnknownReplWriteConcern: 79,\n    UnsatisfiableWriteConcern: 100,\n    Reauthenticate: 391\n});\n// From spec@https://github.com/mongodb/specifications/blob/f93d78191f3db2898a59013a7ed5650352ef6da8/source/change-streams/change-streams.rst#resumable-error\nexports.GET_MORE_RESUMABLE_CODES = new Set([\n    exports.MONGODB_ERROR_CODES.HostUnreachable,\n    exports.MONGODB_ERROR_CODES.HostNotFound,\n    exports.MONGODB_ERROR_CODES.NetworkTimeout,\n    exports.MONGODB_ERROR_CODES.ShutdownInProgress,\n    exports.MONGODB_ERROR_CODES.PrimarySteppedDown,\n    exports.MONGODB_ERROR_CODES.ExceededTimeLimit,\n    exports.MONGODB_ERROR_CODES.SocketException,\n    exports.MONGODB_ERROR_CODES.NotWritablePrimary,\n    exports.MONGODB_ERROR_CODES.InterruptedAtShutdown,\n    exports.MONGODB_ERROR_CODES.InterruptedDueToReplStateChange,\n    exports.MONGODB_ERROR_CODES.NotPrimaryNoSecondaryOk,\n    exports.MONGODB_ERROR_CODES.NotPrimaryOrSecondary,\n    exports.MONGODB_ERROR_CODES.StaleShardVersion,\n    exports.MONGODB_ERROR_CODES.StaleEpoch,\n    exports.MONGODB_ERROR_CODES.StaleConfig,\n    exports.MONGODB_ERROR_CODES.RetryChangeStream,\n    exports.MONGODB_ERROR_CODES.FailedToSatisfyReadPreference,\n    exports.MONGODB_ERROR_CODES.CursorNotFound\n]);\n/** @public */\nexports.MongoErrorLabel = Object.freeze({\n    RetryableWriteError: 'RetryableWriteError',\n    TransientTransactionError: 'TransientTransactionError',\n    UnknownTransactionCommitResult: 'UnknownTransactionCommitResult',\n    ResumableChangeStreamError: 'ResumableChangeStreamError',\n    HandshakeError: 'HandshakeError',\n    ResetPool: 'ResetPool',\n    InterruptInUseConnections: 'InterruptInUseConnections',\n    NoWritesPerformed: 'NoWritesPerformed'\n});\nfunction isAggregateError(e) {\n    return 'errors' in e && Array.isArray(e.errors);\n}\n/**\n * @public\n * @category Error\n *\n * @privateRemarks\n * mongodb-client-encryption has a dependency on this error, it uses the constructor with a string argument\n */\nclass MongoError extends Error {\n    constructor(message) {\n        super(MongoError.buildErrorMessage(message));\n        if (message instanceof Error) {\n            this.cause = message;\n        }\n        this[kErrorLabels] = new Set();\n    }\n    /** @internal */\n    static buildErrorMessage(e) {\n        if (typeof e === 'string') {\n            return e;\n        }\n        if (isAggregateError(e) && e.message.length === 0) {\n            return e.errors.length === 0\n                ? 'AggregateError has an empty errors array. Please check the `cause` property for more information.'\n                : e.errors.map(({ message }) => message).join(', ');\n        }\n        return e.message;\n    }\n    get name() {\n        return 'MongoError';\n    }\n    /** Legacy name for server error responses */\n    get errmsg() {\n        return this.message;\n    }\n    /**\n     * Checks the error to see if it has an error label\n     *\n     * @param label - The error label to check for\n     * @returns returns true if the error has the provided error label\n     */\n    hasErrorLabel(label) {\n        return this[kErrorLabels].has(label);\n    }\n    addErrorLabel(label) {\n        this[kErrorLabels].add(label);\n    }\n    get errorLabels() {\n        return Array.from(this[kErrorLabels]);\n    }\n}\nexports.MongoError = MongoError;\n/**\n * An error coming from the mongo server\n *\n * @public\n * @category Error\n */\nclass MongoServerError extends MongoError {\n    constructor(message) {\n        super(message.message || message.errmsg || message.$err || 'n/a');\n        if (message.errorLabels) {\n            this[kErrorLabels] = new Set(message.errorLabels);\n        }\n        for (const name in message) {\n            if (name !== 'errorLabels' && name !== 'errmsg' && name !== 'message')\n                this[name] = message[name];\n        }\n    }\n    get name() {\n        return 'MongoServerError';\n    }\n}\nexports.MongoServerError = MongoServerError;\n/**\n * An error generated by the driver\n *\n * @public\n * @category Error\n */\nclass MongoDriverError extends MongoError {\n    constructor(message) {\n        super(message);\n    }\n    get name() {\n        return 'MongoDriverError';\n    }\n}\nexports.MongoDriverError = MongoDriverError;\n/**\n * An error generated when the driver API is used incorrectly\n *\n * @privateRemarks\n * Should **never** be directly instantiated\n *\n * @public\n * @category Error\n */\nclass MongoAPIError extends MongoDriverError {\n    constructor(message) {\n        super(message);\n    }\n    get name() {\n        return 'MongoAPIError';\n    }\n}\nexports.MongoAPIError = MongoAPIError;\n/**\n * An error generated when the driver encounters unexpected input\n * or reaches an unexpected/invalid internal state\n *\n * @privateRemarks\n * Should **never** be directly instantiated.\n *\n * @public\n * @category Error\n */\nclass MongoRuntimeError extends MongoDriverError {\n    constructor(message) {\n        super(message);\n    }\n    get name() {\n        return 'MongoRuntimeError';\n    }\n}\nexports.MongoRuntimeError = MongoRuntimeError;\n/**\n * An error generated when a batch command is re-executed after one of the commands in the batch\n * has failed\n *\n * @public\n * @category Error\n */\nclass MongoBatchReExecutionError extends MongoAPIError {\n    constructor(message = 'This batch has already been executed, create new batch to execute') {\n        super(message);\n    }\n    get name() {\n        return 'MongoBatchReExecutionError';\n    }\n}\nexports.MongoBatchReExecutionError = MongoBatchReExecutionError;\n/**\n * An error generated when the driver fails to decompress\n * data received from the server.\n *\n * @public\n * @category Error\n */\nclass MongoDecompressionError extends MongoRuntimeError {\n    constructor(message) {\n        super(message);\n    }\n    get name() {\n        return 'MongoDecompressionError';\n    }\n}\nexports.MongoDecompressionError = MongoDecompressionError;\n/**\n * An error thrown when the user attempts to operate on a database or collection through a MongoClient\n * that has not yet successfully called the \"connect\" method\n *\n * @public\n * @category Error\n */\nclass MongoNotConnectedError extends MongoAPIError {\n    constructor(message) {\n        super(message);\n    }\n    get name() {\n        return 'MongoNotConnectedError';\n    }\n}\nexports.MongoNotConnectedError = MongoNotConnectedError;\n/**\n * An error generated when the user makes a mistake in the usage of transactions.\n * (e.g. attempting to commit a transaction with a readPreference other than primary)\n *\n * @public\n * @category Error\n */\nclass MongoTransactionError extends MongoAPIError {\n    constructor(message) {\n        super(message);\n    }\n    get name() {\n        return 'MongoTransactionError';\n    }\n}\nexports.MongoTransactionError = MongoTransactionError;\n/**\n * An error generated when the user attempts to operate\n * on a session that has expired or has been closed.\n *\n * @public\n * @category Error\n */\nclass MongoExpiredSessionError extends MongoAPIError {\n    constructor(message = 'Cannot use a session that has ended') {\n        super(message);\n    }\n    get name() {\n        return 'MongoExpiredSessionError';\n    }\n}\nexports.MongoExpiredSessionError = MongoExpiredSessionError;\n/**\n * A error generated when the user attempts to authenticate\n * via Kerberos, but fails to connect to the Kerberos client.\n *\n * @public\n * @category Error\n */\nclass MongoKerberosError extends MongoRuntimeError {\n    constructor(message) {\n        super(message);\n    }\n    get name() {\n        return 'MongoKerberosError';\n    }\n}\nexports.MongoKerberosError = MongoKerberosError;\n/**\n * A error generated when the user attempts to authenticate\n * via AWS, but fails\n *\n * @public\n * @category Error\n */\nclass MongoAWSError extends MongoRuntimeError {\n    constructor(message) {\n        super(message);\n    }\n    get name() {\n        return 'MongoAWSError';\n    }\n}\nexports.MongoAWSError = MongoAWSError;\n/**\n * A error generated when the user attempts to authenticate\n * via Azure, but fails.\n *\n * @public\n * @category Error\n */\nclass MongoAzureError extends MongoRuntimeError {\n    constructor(message) {\n        super(message);\n    }\n    get name() {\n        return 'MongoAzureError';\n    }\n}\nexports.MongoAzureError = MongoAzureError;\n/**\n * An error generated when a ChangeStream operation fails to execute.\n *\n * @public\n * @category Error\n */\nclass MongoChangeStreamError extends MongoRuntimeError {\n    constructor(message) {\n        super(message);\n    }\n    get name() {\n        return 'MongoChangeStreamError';\n    }\n}\nexports.MongoChangeStreamError = MongoChangeStreamError;\n/**\n * An error thrown when the user calls a function or method not supported on a tailable cursor\n *\n * @public\n * @category Error\n */\nclass MongoTailableCursorError extends MongoAPIError {\n    constructor(message = 'Tailable cursor does not support this operation') {\n        super(message);\n    }\n    get name() {\n        return 'MongoTailableCursorError';\n    }\n}\nexports.MongoTailableCursorError = MongoTailableCursorError;\n/** An error generated when a GridFSStream operation fails to execute.\n *\n * @public\n * @category Error\n */\nclass MongoGridFSStreamError extends MongoRuntimeError {\n    constructor(message) {\n        super(message);\n    }\n    get name() {\n        return 'MongoGridFSStreamError';\n    }\n}\nexports.MongoGridFSStreamError = MongoGridFSStreamError;\n/**\n * An error generated when a malformed or invalid chunk is\n * encountered when reading from a GridFSStream.\n *\n * @public\n * @category Error\n */\nclass MongoGridFSChunkError extends MongoRuntimeError {\n    constructor(message) {\n        super(message);\n    }\n    get name() {\n        return 'MongoGridFSChunkError';\n    }\n}\nexports.MongoGridFSChunkError = MongoGridFSChunkError;\n/**\n * An error generated when a **parsable** unexpected response comes from the server.\n * This is generally an error where the driver in a state expecting a certain behavior to occur in\n * the next message from MongoDB but it receives something else.\n * This error **does not** represent an issue with wire message formatting.\n *\n * #### Example\n * When an operation fails, it is the driver's job to retry it. It must perform serverSelection\n * again to make sure that it attempts the operation against a server in a good state. If server\n * selection returns a server that does not support retryable operations, this error is used.\n * This scenario is unlikely as retryable support would also have been determined on the first attempt\n * but it is possible the state change could report a selectable server that does not support retries.\n *\n * @public\n * @category Error\n */\nclass MongoUnexpectedServerResponseError extends MongoRuntimeError {\n    constructor(message) {\n        super(message);\n    }\n    get name() {\n        return 'MongoUnexpectedServerResponseError';\n    }\n}\nexports.MongoUnexpectedServerResponseError = MongoUnexpectedServerResponseError;\n/**\n * An error thrown when the user attempts to add options to a cursor that has already been\n * initialized\n *\n * @public\n * @category Error\n */\nclass MongoCursorInUseError extends MongoAPIError {\n    constructor(message = 'Cursor is already initialized') {\n        super(message);\n    }\n    get name() {\n        return 'MongoCursorInUseError';\n    }\n}\nexports.MongoCursorInUseError = MongoCursorInUseError;\n/**\n * An error generated when an attempt is made to operate\n * on a closed/closing server.\n *\n * @public\n * @category Error\n */\nclass MongoServerClosedError extends MongoAPIError {\n    constructor(message = 'Server is closed') {\n        super(message);\n    }\n    get name() {\n        return 'MongoServerClosedError';\n    }\n}\nexports.MongoServerClosedError = MongoServerClosedError;\n/**\n * An error thrown when an attempt is made to read from a cursor that has been exhausted\n *\n * @public\n * @category Error\n */\nclass MongoCursorExhaustedError extends MongoAPIError {\n    constructor(message) {\n        super(message || 'Cursor is exhausted');\n    }\n    get name() {\n        return 'MongoCursorExhaustedError';\n    }\n}\nexports.MongoCursorExhaustedError = MongoCursorExhaustedError;\n/**\n * An error generated when an attempt is made to operate on a\n * dropped, or otherwise unavailable, database.\n *\n * @public\n * @category Error\n */\nclass MongoTopologyClosedError extends MongoAPIError {\n    constructor(message = 'Topology is closed') {\n        super(message);\n    }\n    get name() {\n        return 'MongoTopologyClosedError';\n    }\n}\nexports.MongoTopologyClosedError = MongoTopologyClosedError;\n/** @internal */\nconst kBeforeHandshake = Symbol('beforeHandshake');\nfunction isNetworkErrorBeforeHandshake(err) {\n    return err[kBeforeHandshake] === true;\n}\nexports.isNetworkErrorBeforeHandshake = isNetworkErrorBeforeHandshake;\n/**\n * An error indicating an issue with the network, including TCP errors and timeouts.\n * @public\n * @category Error\n */\nclass MongoNetworkError extends MongoError {\n    constructor(message, options) {\n        super(message);\n        if (options && typeof options.beforeHandshake === 'boolean') {\n            this[kBeforeHandshake] = options.beforeHandshake;\n        }\n    }\n    get name() {\n        return 'MongoNetworkError';\n    }\n}\nexports.MongoNetworkError = MongoNetworkError;\n/**\n * An error indicating a network timeout occurred\n * @public\n * @category Error\n *\n * @privateRemarks\n * mongodb-client-encryption has a dependency on this error with an instanceof check\n */\nclass MongoNetworkTimeoutError extends MongoNetworkError {\n    constructor(message, options) {\n        super(message, options);\n    }\n    get name() {\n        return 'MongoNetworkTimeoutError';\n    }\n}\nexports.MongoNetworkTimeoutError = MongoNetworkTimeoutError;\n/**\n * An error used when attempting to parse a value (like a connection string)\n * @public\n * @category Error\n */\nclass MongoParseError extends MongoDriverError {\n    constructor(message) {\n        super(message);\n    }\n    get name() {\n        return 'MongoParseError';\n    }\n}\nexports.MongoParseError = MongoParseError;\n/**\n * An error generated when the user supplies malformed or unexpected arguments\n * or when a required argument or field is not provided.\n *\n *\n * @public\n * @category Error\n */\nclass MongoInvalidArgumentError extends MongoAPIError {\n    constructor(message) {\n        super(message);\n    }\n    get name() {\n        return 'MongoInvalidArgumentError';\n    }\n}\nexports.MongoInvalidArgumentError = MongoInvalidArgumentError;\n/**\n * An error generated when a feature that is not enabled or allowed for the current server\n * configuration is used\n *\n *\n * @public\n * @category Error\n */\nclass MongoCompatibilityError extends MongoAPIError {\n    constructor(message) {\n        super(message);\n    }\n    get name() {\n        return 'MongoCompatibilityError';\n    }\n}\nexports.MongoCompatibilityError = MongoCompatibilityError;\n/**\n * An error generated when the user fails to provide authentication credentials before attempting\n * to connect to a mongo server instance.\n *\n *\n * @public\n * @category Error\n */\nclass MongoMissingCredentialsError extends MongoAPIError {\n    constructor(message) {\n        super(message);\n    }\n    get name() {\n        return 'MongoMissingCredentialsError';\n    }\n}\nexports.MongoMissingCredentialsError = MongoMissingCredentialsError;\n/**\n * An error generated when a required module or dependency is not present in the local environment\n *\n * @public\n * @category Error\n */\nclass MongoMissingDependencyError extends MongoAPIError {\n    constructor(message, { cause } = {}) {\n        super(message);\n        if (cause)\n            this.cause = cause;\n    }\n    get name() {\n        return 'MongoMissingDependencyError';\n    }\n}\nexports.MongoMissingDependencyError = MongoMissingDependencyError;\n/**\n * An error signifying a general system issue\n * @public\n * @category Error\n */\nclass MongoSystemError extends MongoError {\n    constructor(message, reason) {\n        if (reason && reason.error) {\n            super(reason.error.message || reason.error);\n        }\n        else {\n            super(message);\n        }\n        if (reason) {\n            this.reason = reason;\n        }\n        this.code = reason.error?.code;\n    }\n    get name() {\n        return 'MongoSystemError';\n    }\n}\nexports.MongoSystemError = MongoSystemError;\n/**\n * An error signifying a client-side server selection error\n * @public\n * @category Error\n */\nclass MongoServerSelectionError extends MongoSystemError {\n    constructor(message, reason) {\n        super(message, reason);\n    }\n    get name() {\n        return 'MongoServerSelectionError';\n    }\n}\nexports.MongoServerSelectionError = MongoServerSelectionError;\nfunction makeWriteConcernResultObject(input) {\n    const output = Object.assign({}, input);\n    if (output.ok === 0) {\n        output.ok = 1;\n        delete output.errmsg;\n        delete output.code;\n        delete output.codeName;\n    }\n    return output;\n}\n/**\n * An error thrown when the server reports a writeConcernError\n * @public\n * @category Error\n */\nclass MongoWriteConcernError extends MongoServerError {\n    constructor(message, result) {\n        if (result && Array.isArray(result.errorLabels)) {\n            message.errorLabels = result.errorLabels;\n        }\n        super(message);\n        this.errInfo = message.errInfo;\n        if (result != null) {\n            this.result = makeWriteConcernResultObject(result);\n        }\n    }\n    get name() {\n        return 'MongoWriteConcernError';\n    }\n}\nexports.MongoWriteConcernError = MongoWriteConcernError;\n// https://github.com/mongodb/specifications/blob/master/source/retryable-reads/retryable-reads.rst#retryable-error\nconst RETRYABLE_READ_ERROR_CODES = new Set([\n    exports.MONGODB_ERROR_CODES.HostUnreachable,\n    exports.MONGODB_ERROR_CODES.HostNotFound,\n    exports.MONGODB_ERROR_CODES.NetworkTimeout,\n    exports.MONGODB_ERROR_CODES.ShutdownInProgress,\n    exports.MONGODB_ERROR_CODES.PrimarySteppedDown,\n    exports.MONGODB_ERROR_CODES.SocketException,\n    exports.MONGODB_ERROR_CODES.NotWritablePrimary,\n    exports.MONGODB_ERROR_CODES.InterruptedAtShutdown,\n    exports.MONGODB_ERROR_CODES.InterruptedDueToReplStateChange,\n    exports.MONGODB_ERROR_CODES.NotPrimaryNoSecondaryOk,\n    exports.MONGODB_ERROR_CODES.NotPrimaryOrSecondary\n]);\n// see: https://github.com/mongodb/specifications/blob/master/source/retryable-writes/retryable-writes.rst#terms\nconst RETRYABLE_WRITE_ERROR_CODES = new Set([\n    ...RETRYABLE_READ_ERROR_CODES,\n    exports.MONGODB_ERROR_CODES.ExceededTimeLimit\n]);\nfunction needsRetryableWriteLabel(error, maxWireVersion) {\n    // pre-4.4 server, then the driver adds an error label for every valid case\n    // execute operation will only inspect the label, code/message logic is handled here\n    if (error instanceof MongoNetworkError) {\n        return true;\n    }\n    if (error instanceof MongoError) {\n        if ((maxWireVersion >= 9 || error.hasErrorLabel(exports.MongoErrorLabel.RetryableWriteError)) &&\n            !error.hasErrorLabel(exports.MongoErrorLabel.HandshakeError)) {\n            // If we already have the error label no need to add it again. 4.4+ servers add the label.\n            // In the case where we have a handshake error, need to fall down to the logic checking\n            // the codes.\n            return false;\n        }\n    }\n    if (error instanceof MongoWriteConcernError) {\n        return RETRYABLE_WRITE_ERROR_CODES.has(error.result?.code ?? error.code ?? 0);\n    }\n    if (error instanceof MongoError && typeof error.code === 'number') {\n        return RETRYABLE_WRITE_ERROR_CODES.has(error.code);\n    }\n    const isNotWritablePrimaryError = exports.LEGACY_NOT_WRITABLE_PRIMARY_ERROR_MESSAGE.test(error.message);\n    if (isNotWritablePrimaryError) {\n        return true;\n    }\n    const isNodeIsRecoveringError = exports.NODE_IS_RECOVERING_ERROR_MESSAGE.test(error.message);\n    if (isNodeIsRecoveringError) {\n        return true;\n    }\n    return false;\n}\nexports.needsRetryableWriteLabel = needsRetryableWriteLabel;\nfunction isRetryableWriteError(error) {\n    return error.hasErrorLabel(exports.MongoErrorLabel.RetryableWriteError);\n}\nexports.isRetryableWriteError = isRetryableWriteError;\n/** Determines whether an error is something the driver should attempt to retry */\nfunction isRetryableReadError(error) {\n    const hasRetryableErrorCode = typeof error.code === 'number' ? RETRYABLE_READ_ERROR_CODES.has(error.code) : false;\n    if (hasRetryableErrorCode) {\n        return true;\n    }\n    if (error instanceof MongoNetworkError) {\n        return true;\n    }\n    const isNotWritablePrimaryError = exports.LEGACY_NOT_WRITABLE_PRIMARY_ERROR_MESSAGE.test(error.message);\n    if (isNotWritablePrimaryError) {\n        return true;\n    }\n    const isNodeIsRecoveringError = exports.NODE_IS_RECOVERING_ERROR_MESSAGE.test(error.message);\n    if (isNodeIsRecoveringError) {\n        return true;\n    }\n    return false;\n}\nexports.isRetryableReadError = isRetryableReadError;\nconst SDAM_RECOVERING_CODES = new Set([\n    exports.MONGODB_ERROR_CODES.ShutdownInProgress,\n    exports.MONGODB_ERROR_CODES.PrimarySteppedDown,\n    exports.MONGODB_ERROR_CODES.InterruptedAtShutdown,\n    exports.MONGODB_ERROR_CODES.InterruptedDueToReplStateChange,\n    exports.MONGODB_ERROR_CODES.NotPrimaryOrSecondary\n]);\nconst SDAM_NOT_PRIMARY_CODES = new Set([\n    exports.MONGODB_ERROR_CODES.NotWritablePrimary,\n    exports.MONGODB_ERROR_CODES.NotPrimaryNoSecondaryOk,\n    exports.MONGODB_ERROR_CODES.LegacyNotPrimary\n]);\nconst SDAM_NODE_SHUTTING_DOWN_ERROR_CODES = new Set([\n    exports.MONGODB_ERROR_CODES.InterruptedAtShutdown,\n    exports.MONGODB_ERROR_CODES.ShutdownInProgress\n]);\nfunction isRecoveringError(err) {\n    if (typeof err.code === 'number') {\n        // If any error code exists, we ignore the error.message\n        return SDAM_RECOVERING_CODES.has(err.code);\n    }\n    return (exports.LEGACY_NOT_PRIMARY_OR_SECONDARY_ERROR_MESSAGE.test(err.message) ||\n        exports.NODE_IS_RECOVERING_ERROR_MESSAGE.test(err.message));\n}\nfunction isNotWritablePrimaryError(err) {\n    if (typeof err.code === 'number') {\n        // If any error code exists, we ignore the error.message\n        return SDAM_NOT_PRIMARY_CODES.has(err.code);\n    }\n    if (isRecoveringError(err)) {\n        return false;\n    }\n    return exports.LEGACY_NOT_WRITABLE_PRIMARY_ERROR_MESSAGE.test(err.message);\n}\nfunction isNodeShuttingDownError(err) {\n    return !!(typeof err.code === 'number' && SDAM_NODE_SHUTTING_DOWN_ERROR_CODES.has(err.code));\n}\nexports.isNodeShuttingDownError = isNodeShuttingDownError;\n/**\n * Determines whether SDAM can recover from a given error. If it cannot\n * then the pool will be cleared, and server state will completely reset\n * locally.\n *\n * @see https://github.com/mongodb/specifications/blob/master/source/server-discovery-and-monitoring/server-discovery-and-monitoring.rst#not-master-and-node-is-recovering\n */\nfunction isSDAMUnrecoverableError(error) {\n    // NOTE: null check is here for a strictly pre-CMAP world, a timeout or\n    //       close event are considered unrecoverable\n    if (error instanceof MongoParseError || error == null) {\n        return true;\n    }\n    return isRecoveringError(error) || isNotWritablePrimaryError(error);\n}\nexports.isSDAMUnrecoverableError = isSDAMUnrecoverableError;\nfunction isNetworkTimeoutError(err) {\n    return !!(err instanceof MongoNetworkError && err.message.match(/timed out/));\n}\nexports.isNetworkTimeoutError = isNetworkTimeoutError;\nfunction isResumableError(error, wireVersion) {\n    if (error == null || !(error instanceof MongoError)) {\n        return false;\n    }\n    if (error instanceof MongoNetworkError) {\n        return true;\n    }\n    if (wireVersion != null && wireVersion >= 9) {\n        // DRIVERS-1308: For 4.4 drivers running against 4.4 servers, drivers will add a special case to treat the CursorNotFound error code as resumable\n        if (error.code === exports.MONGODB_ERROR_CODES.CursorNotFound) {\n            return true;\n        }\n        return error.hasErrorLabel(exports.MongoErrorLabel.ResumableChangeStreamError);\n    }\n    if (typeof error.code === 'number') {\n        return exports.GET_MORE_RESUMABLE_CODES.has(error.code);\n    }\n    return false;\n}\nexports.isResumableError = isResumableError;\n//# sourceMappingURL=error.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9lcnJvci5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCx3QkFBd0IsR0FBRyw2QkFBNkIsR0FBRyxnQ0FBZ0MsR0FBRywrQkFBK0IsR0FBRyw0QkFBNEIsR0FBRyw2QkFBNkIsR0FBRyxnQ0FBZ0MsR0FBRyw4QkFBOEIsR0FBRyxpQ0FBaUMsR0FBRyx3QkFBd0IsR0FBRyxtQ0FBbUMsR0FBRyxvQ0FBb0MsR0FBRywrQkFBK0IsR0FBRyxpQ0FBaUMsR0FBRyx1QkFBdUIsR0FBRyxnQ0FBZ0MsR0FBRyx5QkFBeUIsR0FBRyxxQ0FBcUMsR0FBRyxnQ0FBZ0MsR0FBRyxpQ0FBaUMsR0FBRyw4QkFBOEIsR0FBRyw2QkFBNkIsR0FBRywwQ0FBMEMsR0FBRyw2QkFBNkIsR0FBRyw4QkFBOEIsR0FBRyxnQ0FBZ0MsR0FBRyw4QkFBOEIsR0FBRyx1QkFBdUIsR0FBRyxxQkFBcUIsR0FBRywwQkFBMEIsR0FBRyxnQ0FBZ0MsR0FBRyw2QkFBNkIsR0FBRyw4QkFBOEIsR0FBRywrQkFBK0IsR0FBRyxrQ0FBa0MsR0FBRyx5QkFBeUIsR0FBRyxxQkFBcUIsR0FBRyx3QkFBd0IsR0FBRyx3QkFBd0IsR0FBRyxrQkFBa0IsR0FBRyx1QkFBdUIsR0FBRyxnQ0FBZ0MsR0FBRywyQkFBMkIsR0FBRyx3Q0FBd0MsR0FBRyxxREFBcUQsR0FBRyxpREFBaUQ7QUFDeC9DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaURBQWlEO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxREFBcUQ7QUFDckQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdDQUF3QztBQUN4QztBQUNBLDJCQUEyQjtBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0EsZ0NBQWdDO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUI7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0NBQWtDLFNBQVM7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQjtBQUNsQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0I7QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QjtBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0M7QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0JBQStCO0FBQy9CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhCQUE4QjtBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQjtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFBOEI7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQztBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhCQUE4QjtBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMENBQTBDO0FBQzFDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QjtBQUM3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFBOEI7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQztBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0M7QUFDaEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFDQUFxQztBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQztBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QjtBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQztBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQjtBQUMvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9DQUFvQztBQUNwQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixRQUFRLElBQUk7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1DQUFtQztBQUNuQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QjtBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQztBQUNqQztBQUNBLG1DQUFtQztBQUNuQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhCQUE4QjtBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QjtBQUM3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QjtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQjtBQUMvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0M7QUFDaEM7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCO0FBQ3hCIiwic291cmNlcyI6WyJEOlxcc2Fsb25pXFxhcHByYWlzYWwtc3lzdGVtXFxzZXJ2ZXJcXG5vZGVfbW9kdWxlc1xcbW9uZ29kYlxcbGliXFxlcnJvci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuaXNSZXN1bWFibGVFcnJvciA9IGV4cG9ydHMuaXNOZXR3b3JrVGltZW91dEVycm9yID0gZXhwb3J0cy5pc1NEQU1VbnJlY292ZXJhYmxlRXJyb3IgPSBleHBvcnRzLmlzTm9kZVNodXR0aW5nRG93bkVycm9yID0gZXhwb3J0cy5pc1JldHJ5YWJsZVJlYWRFcnJvciA9IGV4cG9ydHMuaXNSZXRyeWFibGVXcml0ZUVycm9yID0gZXhwb3J0cy5uZWVkc1JldHJ5YWJsZVdyaXRlTGFiZWwgPSBleHBvcnRzLk1vbmdvV3JpdGVDb25jZXJuRXJyb3IgPSBleHBvcnRzLk1vbmdvU2VydmVyU2VsZWN0aW9uRXJyb3IgPSBleHBvcnRzLk1vbmdvU3lzdGVtRXJyb3IgPSBleHBvcnRzLk1vbmdvTWlzc2luZ0RlcGVuZGVuY3lFcnJvciA9IGV4cG9ydHMuTW9uZ29NaXNzaW5nQ3JlZGVudGlhbHNFcnJvciA9IGV4cG9ydHMuTW9uZ29Db21wYXRpYmlsaXR5RXJyb3IgPSBleHBvcnRzLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IgPSBleHBvcnRzLk1vbmdvUGFyc2VFcnJvciA9IGV4cG9ydHMuTW9uZ29OZXR3b3JrVGltZW91dEVycm9yID0gZXhwb3J0cy5Nb25nb05ldHdvcmtFcnJvciA9IGV4cG9ydHMuaXNOZXR3b3JrRXJyb3JCZWZvcmVIYW5kc2hha2UgPSBleHBvcnRzLk1vbmdvVG9wb2xvZ3lDbG9zZWRFcnJvciA9IGV4cG9ydHMuTW9uZ29DdXJzb3JFeGhhdXN0ZWRFcnJvciA9IGV4cG9ydHMuTW9uZ29TZXJ2ZXJDbG9zZWRFcnJvciA9IGV4cG9ydHMuTW9uZ29DdXJzb3JJblVzZUVycm9yID0gZXhwb3J0cy5Nb25nb1VuZXhwZWN0ZWRTZXJ2ZXJSZXNwb25zZUVycm9yID0gZXhwb3J0cy5Nb25nb0dyaWRGU0NodW5rRXJyb3IgPSBleHBvcnRzLk1vbmdvR3JpZEZTU3RyZWFtRXJyb3IgPSBleHBvcnRzLk1vbmdvVGFpbGFibGVDdXJzb3JFcnJvciA9IGV4cG9ydHMuTW9uZ29DaGFuZ2VTdHJlYW1FcnJvciA9IGV4cG9ydHMuTW9uZ29BenVyZUVycm9yID0gZXhwb3J0cy5Nb25nb0FXU0Vycm9yID0gZXhwb3J0cy5Nb25nb0tlcmJlcm9zRXJyb3IgPSBleHBvcnRzLk1vbmdvRXhwaXJlZFNlc3Npb25FcnJvciA9IGV4cG9ydHMuTW9uZ29UcmFuc2FjdGlvbkVycm9yID0gZXhwb3J0cy5Nb25nb05vdENvbm5lY3RlZEVycm9yID0gZXhwb3J0cy5Nb25nb0RlY29tcHJlc3Npb25FcnJvciA9IGV4cG9ydHMuTW9uZ29CYXRjaFJlRXhlY3V0aW9uRXJyb3IgPSBleHBvcnRzLk1vbmdvUnVudGltZUVycm9yID0gZXhwb3J0cy5Nb25nb0FQSUVycm9yID0gZXhwb3J0cy5Nb25nb0RyaXZlckVycm9yID0gZXhwb3J0cy5Nb25nb1NlcnZlckVycm9yID0gZXhwb3J0cy5Nb25nb0Vycm9yID0gZXhwb3J0cy5Nb25nb0Vycm9yTGFiZWwgPSBleHBvcnRzLkdFVF9NT1JFX1JFU1VNQUJMRV9DT0RFUyA9IGV4cG9ydHMuTU9OR09EQl9FUlJPUl9DT0RFUyA9IGV4cG9ydHMuTk9ERV9JU19SRUNPVkVSSU5HX0VSUk9SX01FU1NBR0UgPSBleHBvcnRzLkxFR0FDWV9OT1RfUFJJTUFSWV9PUl9TRUNPTkRBUllfRVJST1JfTUVTU0FHRSA9IGV4cG9ydHMuTEVHQUNZX05PVF9XUklUQUJMRV9QUklNQVJZX0VSUk9SX01FU1NBR0UgPSB2b2lkIDA7XG4vKiogQGludGVybmFsICovXG5jb25zdCBrRXJyb3JMYWJlbHMgPSBTeW1ib2woJ2Vycm9yTGFiZWxzJyk7XG4vKipcbiAqIEBpbnRlcm5hbFxuICogVGhlIGxlZ2FjeSBlcnJvciBtZXNzYWdlIGZyb20gdGhlIHNlcnZlciB0aGF0IGluZGljYXRlcyB0aGUgbm9kZSBpcyBub3QgYSB3cml0YWJsZSBwcmltYXJ5XG4gKiBodHRwczovL2dpdGh1Yi5jb20vbW9uZ29kYi9zcGVjaWZpY2F0aW9ucy9ibG9iL2IwN2MyNmRjNDBkMDRhYzIwMzQ5Zjk4OWRiNTMxYzk4NDVmZGQ3NTUvc291cmNlL3NlcnZlci1kaXNjb3ZlcnktYW5kLW1vbml0b3Jpbmcvc2VydmVyLWRpc2NvdmVyeS1hbmQtbW9uaXRvcmluZy5yc3Qjbm90LXdyaXRhYmxlLXByaW1hcnktYW5kLW5vZGUtaXMtcmVjb3ZlcmluZ1xuICovXG5leHBvcnRzLkxFR0FDWV9OT1RfV1JJVEFCTEVfUFJJTUFSWV9FUlJPUl9NRVNTQUdFID0gbmV3IFJlZ0V4cCgnbm90IG1hc3RlcicsICdpJyk7XG4vKipcbiAqIEBpbnRlcm5hbFxuICogVGhlIGxlZ2FjeSBlcnJvciBtZXNzYWdlIGZyb20gdGhlIHNlcnZlciB0aGF0IGluZGljYXRlcyB0aGUgbm9kZSBpcyBub3QgYSBwcmltYXJ5IG9yIHNlY29uZGFyeVxuICogaHR0cHM6Ly9naXRodWIuY29tL21vbmdvZGIvc3BlY2lmaWNhdGlvbnMvYmxvYi9iMDdjMjZkYzQwZDA0YWMyMDM0OWY5ODlkYjUzMWM5ODQ1ZmRkNzU1L3NvdXJjZS9zZXJ2ZXItZGlzY292ZXJ5LWFuZC1tb25pdG9yaW5nL3NlcnZlci1kaXNjb3ZlcnktYW5kLW1vbml0b3JpbmcucnN0I25vdC13cml0YWJsZS1wcmltYXJ5LWFuZC1ub2RlLWlzLXJlY292ZXJpbmdcbiAqL1xuZXhwb3J0cy5MRUdBQ1lfTk9UX1BSSU1BUllfT1JfU0VDT05EQVJZX0VSUk9SX01FU1NBR0UgPSBuZXcgUmVnRXhwKCdub3QgbWFzdGVyIG9yIHNlY29uZGFyeScsICdpJyk7XG4vKipcbiAqIEBpbnRlcm5hbFxuICogVGhlIGVycm9yIG1lc3NhZ2UgZnJvbSB0aGUgc2VydmVyIHRoYXQgaW5kaWNhdGVzIHRoZSBub2RlIGlzIHJlY292ZXJpbmdcbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9tb25nb2RiL3NwZWNpZmljYXRpb25zL2Jsb2IvYjA3YzI2ZGM0MGQwNGFjMjAzNDlmOTg5ZGI1MzFjOTg0NWZkZDc1NS9zb3VyY2Uvc2VydmVyLWRpc2NvdmVyeS1hbmQtbW9uaXRvcmluZy9zZXJ2ZXItZGlzY292ZXJ5LWFuZC1tb25pdG9yaW5nLnJzdCNub3Qtd3JpdGFibGUtcHJpbWFyeS1hbmQtbm9kZS1pcy1yZWNvdmVyaW5nXG4gKi9cbmV4cG9ydHMuTk9ERV9JU19SRUNPVkVSSU5HX0VSUk9SX01FU1NBR0UgPSBuZXcgUmVnRXhwKCdub2RlIGlzIHJlY292ZXJpbmcnLCAnaScpO1xuLyoqIEBpbnRlcm5hbCBNb25nb0RCIEVycm9yIENvZGVzICovXG5leHBvcnRzLk1PTkdPREJfRVJST1JfQ09ERVMgPSBPYmplY3QuZnJlZXplKHtcbiAgICBIb3N0VW5yZWFjaGFibGU6IDYsXG4gICAgSG9zdE5vdEZvdW5kOiA3LFxuICAgIE5ldHdvcmtUaW1lb3V0OiA4OSxcbiAgICBTaHV0ZG93bkluUHJvZ3Jlc3M6IDkxLFxuICAgIFByaW1hcnlTdGVwcGVkRG93bjogMTg5LFxuICAgIEV4Y2VlZGVkVGltZUxpbWl0OiAyNjIsXG4gICAgU29ja2V0RXhjZXB0aW9uOiA5MDAxLFxuICAgIE5vdFdyaXRhYmxlUHJpbWFyeTogMTAxMDcsXG4gICAgSW50ZXJydXB0ZWRBdFNodXRkb3duOiAxMTYwMCxcbiAgICBJbnRlcnJ1cHRlZER1ZVRvUmVwbFN0YXRlQ2hhbmdlOiAxMTYwMixcbiAgICBOb3RQcmltYXJ5Tm9TZWNvbmRhcnlPazogMTM0MzUsXG4gICAgTm90UHJpbWFyeU9yU2Vjb25kYXJ5OiAxMzQzNixcbiAgICBTdGFsZVNoYXJkVmVyc2lvbjogNjMsXG4gICAgU3RhbGVFcG9jaDogMTUwLFxuICAgIFN0YWxlQ29uZmlnOiAxMzM4OCxcbiAgICBSZXRyeUNoYW5nZVN0cmVhbTogMjM0LFxuICAgIEZhaWxlZFRvU2F0aXNmeVJlYWRQcmVmZXJlbmNlOiAxMzMsXG4gICAgQ3Vyc29yTm90Rm91bmQ6IDQzLFxuICAgIExlZ2FjeU5vdFByaW1hcnk6IDEwMDU4LFxuICAgIFdyaXRlQ29uY2VybkZhaWxlZDogNjQsXG4gICAgTmFtZXNwYWNlTm90Rm91bmQ6IDI2LFxuICAgIElsbGVnYWxPcGVyYXRpb246IDIwLFxuICAgIE1heFRpbWVNU0V4cGlyZWQ6IDUwLFxuICAgIFVua25vd25SZXBsV3JpdGVDb25jZXJuOiA3OSxcbiAgICBVbnNhdGlzZmlhYmxlV3JpdGVDb25jZXJuOiAxMDAsXG4gICAgUmVhdXRoZW50aWNhdGU6IDM5MVxufSk7XG4vLyBGcm9tIHNwZWNAaHR0cHM6Ly9naXRodWIuY29tL21vbmdvZGIvc3BlY2lmaWNhdGlvbnMvYmxvYi9mOTNkNzgxOTFmM2RiMjg5OGE1OTAxM2E3ZWQ1NjUwMzUyZWY2ZGE4L3NvdXJjZS9jaGFuZ2Utc3RyZWFtcy9jaGFuZ2Utc3RyZWFtcy5yc3QjcmVzdW1hYmxlLWVycm9yXG5leHBvcnRzLkdFVF9NT1JFX1JFU1VNQUJMRV9DT0RFUyA9IG5ldyBTZXQoW1xuICAgIGV4cG9ydHMuTU9OR09EQl9FUlJPUl9DT0RFUy5Ib3N0VW5yZWFjaGFibGUsXG4gICAgZXhwb3J0cy5NT05HT0RCX0VSUk9SX0NPREVTLkhvc3ROb3RGb3VuZCxcbiAgICBleHBvcnRzLk1PTkdPREJfRVJST1JfQ09ERVMuTmV0d29ya1RpbWVvdXQsXG4gICAgZXhwb3J0cy5NT05HT0RCX0VSUk9SX0NPREVTLlNodXRkb3duSW5Qcm9ncmVzcyxcbiAgICBleHBvcnRzLk1PTkdPREJfRVJST1JfQ09ERVMuUHJpbWFyeVN0ZXBwZWREb3duLFxuICAgIGV4cG9ydHMuTU9OR09EQl9FUlJPUl9DT0RFUy5FeGNlZWRlZFRpbWVMaW1pdCxcbiAgICBleHBvcnRzLk1PTkdPREJfRVJST1JfQ09ERVMuU29ja2V0RXhjZXB0aW9uLFxuICAgIGV4cG9ydHMuTU9OR09EQl9FUlJPUl9DT0RFUy5Ob3RXcml0YWJsZVByaW1hcnksXG4gICAgZXhwb3J0cy5NT05HT0RCX0VSUk9SX0NPREVTLkludGVycnVwdGVkQXRTaHV0ZG93bixcbiAgICBleHBvcnRzLk1PTkdPREJfRVJST1JfQ09ERVMuSW50ZXJydXB0ZWREdWVUb1JlcGxTdGF0ZUNoYW5nZSxcbiAgICBleHBvcnRzLk1PTkdPREJfRVJST1JfQ09ERVMuTm90UHJpbWFyeU5vU2Vjb25kYXJ5T2ssXG4gICAgZXhwb3J0cy5NT05HT0RCX0VSUk9SX0NPREVTLk5vdFByaW1hcnlPclNlY29uZGFyeSxcbiAgICBleHBvcnRzLk1PTkdPREJfRVJST1JfQ09ERVMuU3RhbGVTaGFyZFZlcnNpb24sXG4gICAgZXhwb3J0cy5NT05HT0RCX0VSUk9SX0NPREVTLlN0YWxlRXBvY2gsXG4gICAgZXhwb3J0cy5NT05HT0RCX0VSUk9SX0NPREVTLlN0YWxlQ29uZmlnLFxuICAgIGV4cG9ydHMuTU9OR09EQl9FUlJPUl9DT0RFUy5SZXRyeUNoYW5nZVN0cmVhbSxcbiAgICBleHBvcnRzLk1PTkdPREJfRVJST1JfQ09ERVMuRmFpbGVkVG9TYXRpc2Z5UmVhZFByZWZlcmVuY2UsXG4gICAgZXhwb3J0cy5NT05HT0RCX0VSUk9SX0NPREVTLkN1cnNvck5vdEZvdW5kXG5dKTtcbi8qKiBAcHVibGljICovXG5leHBvcnRzLk1vbmdvRXJyb3JMYWJlbCA9IE9iamVjdC5mcmVlemUoe1xuICAgIFJldHJ5YWJsZVdyaXRlRXJyb3I6ICdSZXRyeWFibGVXcml0ZUVycm9yJyxcbiAgICBUcmFuc2llbnRUcmFuc2FjdGlvbkVycm9yOiAnVHJhbnNpZW50VHJhbnNhY3Rpb25FcnJvcicsXG4gICAgVW5rbm93blRyYW5zYWN0aW9uQ29tbWl0UmVzdWx0OiAnVW5rbm93blRyYW5zYWN0aW9uQ29tbWl0UmVzdWx0JyxcbiAgICBSZXN1bWFibGVDaGFuZ2VTdHJlYW1FcnJvcjogJ1Jlc3VtYWJsZUNoYW5nZVN0cmVhbUVycm9yJyxcbiAgICBIYW5kc2hha2VFcnJvcjogJ0hhbmRzaGFrZUVycm9yJyxcbiAgICBSZXNldFBvb2w6ICdSZXNldFBvb2wnLFxuICAgIEludGVycnVwdEluVXNlQ29ubmVjdGlvbnM6ICdJbnRlcnJ1cHRJblVzZUNvbm5lY3Rpb25zJyxcbiAgICBOb1dyaXRlc1BlcmZvcm1lZDogJ05vV3JpdGVzUGVyZm9ybWVkJ1xufSk7XG5mdW5jdGlvbiBpc0FnZ3JlZ2F0ZUVycm9yKGUpIHtcbiAgICByZXR1cm4gJ2Vycm9ycycgaW4gZSAmJiBBcnJheS5pc0FycmF5KGUuZXJyb3JzKTtcbn1cbi8qKlxuICogQHB1YmxpY1xuICogQGNhdGVnb3J5IEVycm9yXG4gKlxuICogQHByaXZhdGVSZW1hcmtzXG4gKiBtb25nb2RiLWNsaWVudC1lbmNyeXB0aW9uIGhhcyBhIGRlcGVuZGVuY3kgb24gdGhpcyBlcnJvciwgaXQgdXNlcyB0aGUgY29uc3RydWN0b3Igd2l0aCBhIHN0cmluZyBhcmd1bWVudFxuICovXG5jbGFzcyBNb25nb0Vycm9yIGV4dGVuZHMgRXJyb3Ige1xuICAgIGNvbnN0cnVjdG9yKG1lc3NhZ2UpIHtcbiAgICAgICAgc3VwZXIoTW9uZ29FcnJvci5idWlsZEVycm9yTWVzc2FnZShtZXNzYWdlKSk7XG4gICAgICAgIGlmIChtZXNzYWdlIGluc3RhbmNlb2YgRXJyb3IpIHtcbiAgICAgICAgICAgIHRoaXMuY2F1c2UgPSBtZXNzYWdlO1xuICAgICAgICB9XG4gICAgICAgIHRoaXNba0Vycm9yTGFiZWxzXSA9IG5ldyBTZXQoKTtcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIHN0YXRpYyBidWlsZEVycm9yTWVzc2FnZShlKSB7XG4gICAgICAgIGlmICh0eXBlb2YgZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHJldHVybiBlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpc0FnZ3JlZ2F0ZUVycm9yKGUpICYmIGUubWVzc2FnZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBlLmVycm9ycy5sZW5ndGggPT09IDBcbiAgICAgICAgICAgICAgICA/ICdBZ2dyZWdhdGVFcnJvciBoYXMgYW4gZW1wdHkgZXJyb3JzIGFycmF5LiBQbGVhc2UgY2hlY2sgdGhlIGBjYXVzZWAgcHJvcGVydHkgZm9yIG1vcmUgaW5mb3JtYXRpb24uJ1xuICAgICAgICAgICAgICAgIDogZS5lcnJvcnMubWFwKCh7IG1lc3NhZ2UgfSkgPT4gbWVzc2FnZSkuam9pbignLCAnKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZS5tZXNzYWdlO1xuICAgIH1cbiAgICBnZXQgbmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdNb25nb0Vycm9yJztcbiAgICB9XG4gICAgLyoqIExlZ2FjeSBuYW1lIGZvciBzZXJ2ZXIgZXJyb3IgcmVzcG9uc2VzICovXG4gICAgZ2V0IGVycm1zZygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubWVzc2FnZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2hlY2tzIHRoZSBlcnJvciB0byBzZWUgaWYgaXQgaGFzIGFuIGVycm9yIGxhYmVsXG4gICAgICpcbiAgICAgKiBAcGFyYW0gbGFiZWwgLSBUaGUgZXJyb3IgbGFiZWwgdG8gY2hlY2sgZm9yXG4gICAgICogQHJldHVybnMgcmV0dXJucyB0cnVlIGlmIHRoZSBlcnJvciBoYXMgdGhlIHByb3ZpZGVkIGVycm9yIGxhYmVsXG4gICAgICovXG4gICAgaGFzRXJyb3JMYWJlbChsYWJlbCkge1xuICAgICAgICByZXR1cm4gdGhpc1trRXJyb3JMYWJlbHNdLmhhcyhsYWJlbCk7XG4gICAgfVxuICAgIGFkZEVycm9yTGFiZWwobGFiZWwpIHtcbiAgICAgICAgdGhpc1trRXJyb3JMYWJlbHNdLmFkZChsYWJlbCk7XG4gICAgfVxuICAgIGdldCBlcnJvckxhYmVscygpIHtcbiAgICAgICAgcmV0dXJuIEFycmF5LmZyb20odGhpc1trRXJyb3JMYWJlbHNdKTtcbiAgICB9XG59XG5leHBvcnRzLk1vbmdvRXJyb3IgPSBNb25nb0Vycm9yO1xuLyoqXG4gKiBBbiBlcnJvciBjb21pbmcgZnJvbSB0aGUgbW9uZ28gc2VydmVyXG4gKlxuICogQHB1YmxpY1xuICogQGNhdGVnb3J5IEVycm9yXG4gKi9cbmNsYXNzIE1vbmdvU2VydmVyRXJyb3IgZXh0ZW5kcyBNb25nb0Vycm9yIHtcbiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlKSB7XG4gICAgICAgIHN1cGVyKG1lc3NhZ2UubWVzc2FnZSB8fCBtZXNzYWdlLmVycm1zZyB8fCBtZXNzYWdlLiRlcnIgfHwgJ24vYScpO1xuICAgICAgICBpZiAobWVzc2FnZS5lcnJvckxhYmVscykge1xuICAgICAgICAgICAgdGhpc1trRXJyb3JMYWJlbHNdID0gbmV3IFNldChtZXNzYWdlLmVycm9yTGFiZWxzKTtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGNvbnN0IG5hbWUgaW4gbWVzc2FnZSkge1xuICAgICAgICAgICAgaWYgKG5hbWUgIT09ICdlcnJvckxhYmVscycgJiYgbmFtZSAhPT0gJ2Vycm1zZycgJiYgbmFtZSAhPT0gJ21lc3NhZ2UnKVxuICAgICAgICAgICAgICAgIHRoaXNbbmFtZV0gPSBtZXNzYWdlW25hbWVdO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldCBuYW1lKCkge1xuICAgICAgICByZXR1cm4gJ01vbmdvU2VydmVyRXJyb3InO1xuICAgIH1cbn1cbmV4cG9ydHMuTW9uZ29TZXJ2ZXJFcnJvciA9IE1vbmdvU2VydmVyRXJyb3I7XG4vKipcbiAqIEFuIGVycm9yIGdlbmVyYXRlZCBieSB0aGUgZHJpdmVyXG4gKlxuICogQHB1YmxpY1xuICogQGNhdGVnb3J5IEVycm9yXG4gKi9cbmNsYXNzIE1vbmdvRHJpdmVyRXJyb3IgZXh0ZW5kcyBNb25nb0Vycm9yIHtcbiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlKSB7XG4gICAgICAgIHN1cGVyKG1lc3NhZ2UpO1xuICAgIH1cbiAgICBnZXQgbmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdNb25nb0RyaXZlckVycm9yJztcbiAgICB9XG59XG5leHBvcnRzLk1vbmdvRHJpdmVyRXJyb3IgPSBNb25nb0RyaXZlckVycm9yO1xuLyoqXG4gKiBBbiBlcnJvciBnZW5lcmF0ZWQgd2hlbiB0aGUgZHJpdmVyIEFQSSBpcyB1c2VkIGluY29ycmVjdGx5XG4gKlxuICogQHByaXZhdGVSZW1hcmtzXG4gKiBTaG91bGQgKipuZXZlcioqIGJlIGRpcmVjdGx5IGluc3RhbnRpYXRlZFxuICpcbiAqIEBwdWJsaWNcbiAqIEBjYXRlZ29yeSBFcnJvclxuICovXG5jbGFzcyBNb25nb0FQSUVycm9yIGV4dGVuZHMgTW9uZ29Ecml2ZXJFcnJvciB7XG4gICAgY29uc3RydWN0b3IobWVzc2FnZSkge1xuICAgICAgICBzdXBlcihtZXNzYWdlKTtcbiAgICB9XG4gICAgZ2V0IG5hbWUoKSB7XG4gICAgICAgIHJldHVybiAnTW9uZ29BUElFcnJvcic7XG4gICAgfVxufVxuZXhwb3J0cy5Nb25nb0FQSUVycm9yID0gTW9uZ29BUElFcnJvcjtcbi8qKlxuICogQW4gZXJyb3IgZ2VuZXJhdGVkIHdoZW4gdGhlIGRyaXZlciBlbmNvdW50ZXJzIHVuZXhwZWN0ZWQgaW5wdXRcbiAqIG9yIHJlYWNoZXMgYW4gdW5leHBlY3RlZC9pbnZhbGlkIGludGVybmFsIHN0YXRlXG4gKlxuICogQHByaXZhdGVSZW1hcmtzXG4gKiBTaG91bGQgKipuZXZlcioqIGJlIGRpcmVjdGx5IGluc3RhbnRpYXRlZC5cbiAqXG4gKiBAcHVibGljXG4gKiBAY2F0ZWdvcnkgRXJyb3JcbiAqL1xuY2xhc3MgTW9uZ29SdW50aW1lRXJyb3IgZXh0ZW5kcyBNb25nb0RyaXZlckVycm9yIHtcbiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlKSB7XG4gICAgICAgIHN1cGVyKG1lc3NhZ2UpO1xuICAgIH1cbiAgICBnZXQgbmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdNb25nb1J1bnRpbWVFcnJvcic7XG4gICAgfVxufVxuZXhwb3J0cy5Nb25nb1J1bnRpbWVFcnJvciA9IE1vbmdvUnVudGltZUVycm9yO1xuLyoqXG4gKiBBbiBlcnJvciBnZW5lcmF0ZWQgd2hlbiBhIGJhdGNoIGNvbW1hbmQgaXMgcmUtZXhlY3V0ZWQgYWZ0ZXIgb25lIG9mIHRoZSBjb21tYW5kcyBpbiB0aGUgYmF0Y2hcbiAqIGhhcyBmYWlsZWRcbiAqXG4gKiBAcHVibGljXG4gKiBAY2F0ZWdvcnkgRXJyb3JcbiAqL1xuY2xhc3MgTW9uZ29CYXRjaFJlRXhlY3V0aW9uRXJyb3IgZXh0ZW5kcyBNb25nb0FQSUVycm9yIHtcbiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlID0gJ1RoaXMgYmF0Y2ggaGFzIGFscmVhZHkgYmVlbiBleGVjdXRlZCwgY3JlYXRlIG5ldyBiYXRjaCB0byBleGVjdXRlJykge1xuICAgICAgICBzdXBlcihtZXNzYWdlKTtcbiAgICB9XG4gICAgZ2V0IG5hbWUoKSB7XG4gICAgICAgIHJldHVybiAnTW9uZ29CYXRjaFJlRXhlY3V0aW9uRXJyb3InO1xuICAgIH1cbn1cbmV4cG9ydHMuTW9uZ29CYXRjaFJlRXhlY3V0aW9uRXJyb3IgPSBNb25nb0JhdGNoUmVFeGVjdXRpb25FcnJvcjtcbi8qKlxuICogQW4gZXJyb3IgZ2VuZXJhdGVkIHdoZW4gdGhlIGRyaXZlciBmYWlscyB0byBkZWNvbXByZXNzXG4gKiBkYXRhIHJlY2VpdmVkIGZyb20gdGhlIHNlcnZlci5cbiAqXG4gKiBAcHVibGljXG4gKiBAY2F0ZWdvcnkgRXJyb3JcbiAqL1xuY2xhc3MgTW9uZ29EZWNvbXByZXNzaW9uRXJyb3IgZXh0ZW5kcyBNb25nb1J1bnRpbWVFcnJvciB7XG4gICAgY29uc3RydWN0b3IobWVzc2FnZSkge1xuICAgICAgICBzdXBlcihtZXNzYWdlKTtcbiAgICB9XG4gICAgZ2V0IG5hbWUoKSB7XG4gICAgICAgIHJldHVybiAnTW9uZ29EZWNvbXByZXNzaW9uRXJyb3InO1xuICAgIH1cbn1cbmV4cG9ydHMuTW9uZ29EZWNvbXByZXNzaW9uRXJyb3IgPSBNb25nb0RlY29tcHJlc3Npb25FcnJvcjtcbi8qKlxuICogQW4gZXJyb3IgdGhyb3duIHdoZW4gdGhlIHVzZXIgYXR0ZW1wdHMgdG8gb3BlcmF0ZSBvbiBhIGRhdGFiYXNlIG9yIGNvbGxlY3Rpb24gdGhyb3VnaCBhIE1vbmdvQ2xpZW50XG4gKiB0aGF0IGhhcyBub3QgeWV0IHN1Y2Nlc3NmdWxseSBjYWxsZWQgdGhlIFwiY29ubmVjdFwiIG1ldGhvZFxuICpcbiAqIEBwdWJsaWNcbiAqIEBjYXRlZ29yeSBFcnJvclxuICovXG5jbGFzcyBNb25nb05vdENvbm5lY3RlZEVycm9yIGV4dGVuZHMgTW9uZ29BUElFcnJvciB7XG4gICAgY29uc3RydWN0b3IobWVzc2FnZSkge1xuICAgICAgICBzdXBlcihtZXNzYWdlKTtcbiAgICB9XG4gICAgZ2V0IG5hbWUoKSB7XG4gICAgICAgIHJldHVybiAnTW9uZ29Ob3RDb25uZWN0ZWRFcnJvcic7XG4gICAgfVxufVxuZXhwb3J0cy5Nb25nb05vdENvbm5lY3RlZEVycm9yID0gTW9uZ29Ob3RDb25uZWN0ZWRFcnJvcjtcbi8qKlxuICogQW4gZXJyb3IgZ2VuZXJhdGVkIHdoZW4gdGhlIHVzZXIgbWFrZXMgYSBtaXN0YWtlIGluIHRoZSB1c2FnZSBvZiB0cmFuc2FjdGlvbnMuXG4gKiAoZS5nLiBhdHRlbXB0aW5nIHRvIGNvbW1pdCBhIHRyYW5zYWN0aW9uIHdpdGggYSByZWFkUHJlZmVyZW5jZSBvdGhlciB0aGFuIHByaW1hcnkpXG4gKlxuICogQHB1YmxpY1xuICogQGNhdGVnb3J5IEVycm9yXG4gKi9cbmNsYXNzIE1vbmdvVHJhbnNhY3Rpb25FcnJvciBleHRlbmRzIE1vbmdvQVBJRXJyb3Ige1xuICAgIGNvbnN0cnVjdG9yKG1lc3NhZ2UpIHtcbiAgICAgICAgc3VwZXIobWVzc2FnZSk7XG4gICAgfVxuICAgIGdldCBuYW1lKCkge1xuICAgICAgICByZXR1cm4gJ01vbmdvVHJhbnNhY3Rpb25FcnJvcic7XG4gICAgfVxufVxuZXhwb3J0cy5Nb25nb1RyYW5zYWN0aW9uRXJyb3IgPSBNb25nb1RyYW5zYWN0aW9uRXJyb3I7XG4vKipcbiAqIEFuIGVycm9yIGdlbmVyYXRlZCB3aGVuIHRoZSB1c2VyIGF0dGVtcHRzIHRvIG9wZXJhdGVcbiAqIG9uIGEgc2Vzc2lvbiB0aGF0IGhhcyBleHBpcmVkIG9yIGhhcyBiZWVuIGNsb3NlZC5cbiAqXG4gKiBAcHVibGljXG4gKiBAY2F0ZWdvcnkgRXJyb3JcbiAqL1xuY2xhc3MgTW9uZ29FeHBpcmVkU2Vzc2lvbkVycm9yIGV4dGVuZHMgTW9uZ29BUElFcnJvciB7XG4gICAgY29uc3RydWN0b3IobWVzc2FnZSA9ICdDYW5ub3QgdXNlIGEgc2Vzc2lvbiB0aGF0IGhhcyBlbmRlZCcpIHtcbiAgICAgICAgc3VwZXIobWVzc2FnZSk7XG4gICAgfVxuICAgIGdldCBuYW1lKCkge1xuICAgICAgICByZXR1cm4gJ01vbmdvRXhwaXJlZFNlc3Npb25FcnJvcic7XG4gICAgfVxufVxuZXhwb3J0cy5Nb25nb0V4cGlyZWRTZXNzaW9uRXJyb3IgPSBNb25nb0V4cGlyZWRTZXNzaW9uRXJyb3I7XG4vKipcbiAqIEEgZXJyb3IgZ2VuZXJhdGVkIHdoZW4gdGhlIHVzZXIgYXR0ZW1wdHMgdG8gYXV0aGVudGljYXRlXG4gKiB2aWEgS2VyYmVyb3MsIGJ1dCBmYWlscyB0byBjb25uZWN0IHRvIHRoZSBLZXJiZXJvcyBjbGllbnQuXG4gKlxuICogQHB1YmxpY1xuICogQGNhdGVnb3J5IEVycm9yXG4gKi9cbmNsYXNzIE1vbmdvS2VyYmVyb3NFcnJvciBleHRlbmRzIE1vbmdvUnVudGltZUVycm9yIHtcbiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlKSB7XG4gICAgICAgIHN1cGVyKG1lc3NhZ2UpO1xuICAgIH1cbiAgICBnZXQgbmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdNb25nb0tlcmJlcm9zRXJyb3InO1xuICAgIH1cbn1cbmV4cG9ydHMuTW9uZ29LZXJiZXJvc0Vycm9yID0gTW9uZ29LZXJiZXJvc0Vycm9yO1xuLyoqXG4gKiBBIGVycm9yIGdlbmVyYXRlZCB3aGVuIHRoZSB1c2VyIGF0dGVtcHRzIHRvIGF1dGhlbnRpY2F0ZVxuICogdmlhIEFXUywgYnV0IGZhaWxzXG4gKlxuICogQHB1YmxpY1xuICogQGNhdGVnb3J5IEVycm9yXG4gKi9cbmNsYXNzIE1vbmdvQVdTRXJyb3IgZXh0ZW5kcyBNb25nb1J1bnRpbWVFcnJvciB7XG4gICAgY29uc3RydWN0b3IobWVzc2FnZSkge1xuICAgICAgICBzdXBlcihtZXNzYWdlKTtcbiAgICB9XG4gICAgZ2V0IG5hbWUoKSB7XG4gICAgICAgIHJldHVybiAnTW9uZ29BV1NFcnJvcic7XG4gICAgfVxufVxuZXhwb3J0cy5Nb25nb0FXU0Vycm9yID0gTW9uZ29BV1NFcnJvcjtcbi8qKlxuICogQSBlcnJvciBnZW5lcmF0ZWQgd2hlbiB0aGUgdXNlciBhdHRlbXB0cyB0byBhdXRoZW50aWNhdGVcbiAqIHZpYSBBenVyZSwgYnV0IGZhaWxzLlxuICpcbiAqIEBwdWJsaWNcbiAqIEBjYXRlZ29yeSBFcnJvclxuICovXG5jbGFzcyBNb25nb0F6dXJlRXJyb3IgZXh0ZW5kcyBNb25nb1J1bnRpbWVFcnJvciB7XG4gICAgY29uc3RydWN0b3IobWVzc2FnZSkge1xuICAgICAgICBzdXBlcihtZXNzYWdlKTtcbiAgICB9XG4gICAgZ2V0IG5hbWUoKSB7XG4gICAgICAgIHJldHVybiAnTW9uZ29BenVyZUVycm9yJztcbiAgICB9XG59XG5leHBvcnRzLk1vbmdvQXp1cmVFcnJvciA9IE1vbmdvQXp1cmVFcnJvcjtcbi8qKlxuICogQW4gZXJyb3IgZ2VuZXJhdGVkIHdoZW4gYSBDaGFuZ2VTdHJlYW0gb3BlcmF0aW9uIGZhaWxzIHRvIGV4ZWN1dGUuXG4gKlxuICogQHB1YmxpY1xuICogQGNhdGVnb3J5IEVycm9yXG4gKi9cbmNsYXNzIE1vbmdvQ2hhbmdlU3RyZWFtRXJyb3IgZXh0ZW5kcyBNb25nb1J1bnRpbWVFcnJvciB7XG4gICAgY29uc3RydWN0b3IobWVzc2FnZSkge1xuICAgICAgICBzdXBlcihtZXNzYWdlKTtcbiAgICB9XG4gICAgZ2V0IG5hbWUoKSB7XG4gICAgICAgIHJldHVybiAnTW9uZ29DaGFuZ2VTdHJlYW1FcnJvcic7XG4gICAgfVxufVxuZXhwb3J0cy5Nb25nb0NoYW5nZVN0cmVhbUVycm9yID0gTW9uZ29DaGFuZ2VTdHJlYW1FcnJvcjtcbi8qKlxuICogQW4gZXJyb3IgdGhyb3duIHdoZW4gdGhlIHVzZXIgY2FsbHMgYSBmdW5jdGlvbiBvciBtZXRob2Qgbm90IHN1cHBvcnRlZCBvbiBhIHRhaWxhYmxlIGN1cnNvclxuICpcbiAqIEBwdWJsaWNcbiAqIEBjYXRlZ29yeSBFcnJvclxuICovXG5jbGFzcyBNb25nb1RhaWxhYmxlQ3Vyc29yRXJyb3IgZXh0ZW5kcyBNb25nb0FQSUVycm9yIHtcbiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlID0gJ1RhaWxhYmxlIGN1cnNvciBkb2VzIG5vdCBzdXBwb3J0IHRoaXMgb3BlcmF0aW9uJykge1xuICAgICAgICBzdXBlcihtZXNzYWdlKTtcbiAgICB9XG4gICAgZ2V0IG5hbWUoKSB7XG4gICAgICAgIHJldHVybiAnTW9uZ29UYWlsYWJsZUN1cnNvckVycm9yJztcbiAgICB9XG59XG5leHBvcnRzLk1vbmdvVGFpbGFibGVDdXJzb3JFcnJvciA9IE1vbmdvVGFpbGFibGVDdXJzb3JFcnJvcjtcbi8qKiBBbiBlcnJvciBnZW5lcmF0ZWQgd2hlbiBhIEdyaWRGU1N0cmVhbSBvcGVyYXRpb24gZmFpbHMgdG8gZXhlY3V0ZS5cbiAqXG4gKiBAcHVibGljXG4gKiBAY2F0ZWdvcnkgRXJyb3JcbiAqL1xuY2xhc3MgTW9uZ29HcmlkRlNTdHJlYW1FcnJvciBleHRlbmRzIE1vbmdvUnVudGltZUVycm9yIHtcbiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlKSB7XG4gICAgICAgIHN1cGVyKG1lc3NhZ2UpO1xuICAgIH1cbiAgICBnZXQgbmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdNb25nb0dyaWRGU1N0cmVhbUVycm9yJztcbiAgICB9XG59XG5leHBvcnRzLk1vbmdvR3JpZEZTU3RyZWFtRXJyb3IgPSBNb25nb0dyaWRGU1N0cmVhbUVycm9yO1xuLyoqXG4gKiBBbiBlcnJvciBnZW5lcmF0ZWQgd2hlbiBhIG1hbGZvcm1lZCBvciBpbnZhbGlkIGNodW5rIGlzXG4gKiBlbmNvdW50ZXJlZCB3aGVuIHJlYWRpbmcgZnJvbSBhIEdyaWRGU1N0cmVhbS5cbiAqXG4gKiBAcHVibGljXG4gKiBAY2F0ZWdvcnkgRXJyb3JcbiAqL1xuY2xhc3MgTW9uZ29HcmlkRlNDaHVua0Vycm9yIGV4dGVuZHMgTW9uZ29SdW50aW1lRXJyb3Ige1xuICAgIGNvbnN0cnVjdG9yKG1lc3NhZ2UpIHtcbiAgICAgICAgc3VwZXIobWVzc2FnZSk7XG4gICAgfVxuICAgIGdldCBuYW1lKCkge1xuICAgICAgICByZXR1cm4gJ01vbmdvR3JpZEZTQ2h1bmtFcnJvcic7XG4gICAgfVxufVxuZXhwb3J0cy5Nb25nb0dyaWRGU0NodW5rRXJyb3IgPSBNb25nb0dyaWRGU0NodW5rRXJyb3I7XG4vKipcbiAqIEFuIGVycm9yIGdlbmVyYXRlZCB3aGVuIGEgKipwYXJzYWJsZSoqIHVuZXhwZWN0ZWQgcmVzcG9uc2UgY29tZXMgZnJvbSB0aGUgc2VydmVyLlxuICogVGhpcyBpcyBnZW5lcmFsbHkgYW4gZXJyb3Igd2hlcmUgdGhlIGRyaXZlciBpbiBhIHN0YXRlIGV4cGVjdGluZyBhIGNlcnRhaW4gYmVoYXZpb3IgdG8gb2NjdXIgaW5cbiAqIHRoZSBuZXh0IG1lc3NhZ2UgZnJvbSBNb25nb0RCIGJ1dCBpdCByZWNlaXZlcyBzb21ldGhpbmcgZWxzZS5cbiAqIFRoaXMgZXJyb3IgKipkb2VzIG5vdCoqIHJlcHJlc2VudCBhbiBpc3N1ZSB3aXRoIHdpcmUgbWVzc2FnZSBmb3JtYXR0aW5nLlxuICpcbiAqICMjIyMgRXhhbXBsZVxuICogV2hlbiBhbiBvcGVyYXRpb24gZmFpbHMsIGl0IGlzIHRoZSBkcml2ZXIncyBqb2IgdG8gcmV0cnkgaXQuIEl0IG11c3QgcGVyZm9ybSBzZXJ2ZXJTZWxlY3Rpb25cbiAqIGFnYWluIHRvIG1ha2Ugc3VyZSB0aGF0IGl0IGF0dGVtcHRzIHRoZSBvcGVyYXRpb24gYWdhaW5zdCBhIHNlcnZlciBpbiBhIGdvb2Qgc3RhdGUuIElmIHNlcnZlclxuICogc2VsZWN0aW9uIHJldHVybnMgYSBzZXJ2ZXIgdGhhdCBkb2VzIG5vdCBzdXBwb3J0IHJldHJ5YWJsZSBvcGVyYXRpb25zLCB0aGlzIGVycm9yIGlzIHVzZWQuXG4gKiBUaGlzIHNjZW5hcmlvIGlzIHVubGlrZWx5IGFzIHJldHJ5YWJsZSBzdXBwb3J0IHdvdWxkIGFsc28gaGF2ZSBiZWVuIGRldGVybWluZWQgb24gdGhlIGZpcnN0IGF0dGVtcHRcbiAqIGJ1dCBpdCBpcyBwb3NzaWJsZSB0aGUgc3RhdGUgY2hhbmdlIGNvdWxkIHJlcG9ydCBhIHNlbGVjdGFibGUgc2VydmVyIHRoYXQgZG9lcyBub3Qgc3VwcG9ydCByZXRyaWVzLlxuICpcbiAqIEBwdWJsaWNcbiAqIEBjYXRlZ29yeSBFcnJvclxuICovXG5jbGFzcyBNb25nb1VuZXhwZWN0ZWRTZXJ2ZXJSZXNwb25zZUVycm9yIGV4dGVuZHMgTW9uZ29SdW50aW1lRXJyb3Ige1xuICAgIGNvbnN0cnVjdG9yKG1lc3NhZ2UpIHtcbiAgICAgICAgc3VwZXIobWVzc2FnZSk7XG4gICAgfVxuICAgIGdldCBuYW1lKCkge1xuICAgICAgICByZXR1cm4gJ01vbmdvVW5leHBlY3RlZFNlcnZlclJlc3BvbnNlRXJyb3InO1xuICAgIH1cbn1cbmV4cG9ydHMuTW9uZ29VbmV4cGVjdGVkU2VydmVyUmVzcG9uc2VFcnJvciA9IE1vbmdvVW5leHBlY3RlZFNlcnZlclJlc3BvbnNlRXJyb3I7XG4vKipcbiAqIEFuIGVycm9yIHRocm93biB3aGVuIHRoZSB1c2VyIGF0dGVtcHRzIHRvIGFkZCBvcHRpb25zIHRvIGEgY3Vyc29yIHRoYXQgaGFzIGFscmVhZHkgYmVlblxuICogaW5pdGlhbGl6ZWRcbiAqXG4gKiBAcHVibGljXG4gKiBAY2F0ZWdvcnkgRXJyb3JcbiAqL1xuY2xhc3MgTW9uZ29DdXJzb3JJblVzZUVycm9yIGV4dGVuZHMgTW9uZ29BUElFcnJvciB7XG4gICAgY29uc3RydWN0b3IobWVzc2FnZSA9ICdDdXJzb3IgaXMgYWxyZWFkeSBpbml0aWFsaXplZCcpIHtcbiAgICAgICAgc3VwZXIobWVzc2FnZSk7XG4gICAgfVxuICAgIGdldCBuYW1lKCkge1xuICAgICAgICByZXR1cm4gJ01vbmdvQ3Vyc29ySW5Vc2VFcnJvcic7XG4gICAgfVxufVxuZXhwb3J0cy5Nb25nb0N1cnNvckluVXNlRXJyb3IgPSBNb25nb0N1cnNvckluVXNlRXJyb3I7XG4vKipcbiAqIEFuIGVycm9yIGdlbmVyYXRlZCB3aGVuIGFuIGF0dGVtcHQgaXMgbWFkZSB0byBvcGVyYXRlXG4gKiBvbiBhIGNsb3NlZC9jbG9zaW5nIHNlcnZlci5cbiAqXG4gKiBAcHVibGljXG4gKiBAY2F0ZWdvcnkgRXJyb3JcbiAqL1xuY2xhc3MgTW9uZ29TZXJ2ZXJDbG9zZWRFcnJvciBleHRlbmRzIE1vbmdvQVBJRXJyb3Ige1xuICAgIGNvbnN0cnVjdG9yKG1lc3NhZ2UgPSAnU2VydmVyIGlzIGNsb3NlZCcpIHtcbiAgICAgICAgc3VwZXIobWVzc2FnZSk7XG4gICAgfVxuICAgIGdldCBuYW1lKCkge1xuICAgICAgICByZXR1cm4gJ01vbmdvU2VydmVyQ2xvc2VkRXJyb3InO1xuICAgIH1cbn1cbmV4cG9ydHMuTW9uZ29TZXJ2ZXJDbG9zZWRFcnJvciA9IE1vbmdvU2VydmVyQ2xvc2VkRXJyb3I7XG4vKipcbiAqIEFuIGVycm9yIHRocm93biB3aGVuIGFuIGF0dGVtcHQgaXMgbWFkZSB0byByZWFkIGZyb20gYSBjdXJzb3IgdGhhdCBoYXMgYmVlbiBleGhhdXN0ZWRcbiAqXG4gKiBAcHVibGljXG4gKiBAY2F0ZWdvcnkgRXJyb3JcbiAqL1xuY2xhc3MgTW9uZ29DdXJzb3JFeGhhdXN0ZWRFcnJvciBleHRlbmRzIE1vbmdvQVBJRXJyb3Ige1xuICAgIGNvbnN0cnVjdG9yKG1lc3NhZ2UpIHtcbiAgICAgICAgc3VwZXIobWVzc2FnZSB8fCAnQ3Vyc29yIGlzIGV4aGF1c3RlZCcpO1xuICAgIH1cbiAgICBnZXQgbmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdNb25nb0N1cnNvckV4aGF1c3RlZEVycm9yJztcbiAgICB9XG59XG5leHBvcnRzLk1vbmdvQ3Vyc29yRXhoYXVzdGVkRXJyb3IgPSBNb25nb0N1cnNvckV4aGF1c3RlZEVycm9yO1xuLyoqXG4gKiBBbiBlcnJvciBnZW5lcmF0ZWQgd2hlbiBhbiBhdHRlbXB0IGlzIG1hZGUgdG8gb3BlcmF0ZSBvbiBhXG4gKiBkcm9wcGVkLCBvciBvdGhlcndpc2UgdW5hdmFpbGFibGUsIGRhdGFiYXNlLlxuICpcbiAqIEBwdWJsaWNcbiAqIEBjYXRlZ29yeSBFcnJvclxuICovXG5jbGFzcyBNb25nb1RvcG9sb2d5Q2xvc2VkRXJyb3IgZXh0ZW5kcyBNb25nb0FQSUVycm9yIHtcbiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlID0gJ1RvcG9sb2d5IGlzIGNsb3NlZCcpIHtcbiAgICAgICAgc3VwZXIobWVzc2FnZSk7XG4gICAgfVxuICAgIGdldCBuYW1lKCkge1xuICAgICAgICByZXR1cm4gJ01vbmdvVG9wb2xvZ3lDbG9zZWRFcnJvcic7XG4gICAgfVxufVxuZXhwb3J0cy5Nb25nb1RvcG9sb2d5Q2xvc2VkRXJyb3IgPSBNb25nb1RvcG9sb2d5Q2xvc2VkRXJyb3I7XG4vKiogQGludGVybmFsICovXG5jb25zdCBrQmVmb3JlSGFuZHNoYWtlID0gU3ltYm9sKCdiZWZvcmVIYW5kc2hha2UnKTtcbmZ1bmN0aW9uIGlzTmV0d29ya0Vycm9yQmVmb3JlSGFuZHNoYWtlKGVycikge1xuICAgIHJldHVybiBlcnJba0JlZm9yZUhhbmRzaGFrZV0gPT09IHRydWU7XG59XG5leHBvcnRzLmlzTmV0d29ya0Vycm9yQmVmb3JlSGFuZHNoYWtlID0gaXNOZXR3b3JrRXJyb3JCZWZvcmVIYW5kc2hha2U7XG4vKipcbiAqIEFuIGVycm9yIGluZGljYXRpbmcgYW4gaXNzdWUgd2l0aCB0aGUgbmV0d29yaywgaW5jbHVkaW5nIFRDUCBlcnJvcnMgYW5kIHRpbWVvdXRzLlxuICogQHB1YmxpY1xuICogQGNhdGVnb3J5IEVycm9yXG4gKi9cbmNsYXNzIE1vbmdvTmV0d29ya0Vycm9yIGV4dGVuZHMgTW9uZ29FcnJvciB7XG4gICAgY29uc3RydWN0b3IobWVzc2FnZSwgb3B0aW9ucykge1xuICAgICAgICBzdXBlcihtZXNzYWdlKTtcbiAgICAgICAgaWYgKG9wdGlvbnMgJiYgdHlwZW9mIG9wdGlvbnMuYmVmb3JlSGFuZHNoYWtlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgIHRoaXNba0JlZm9yZUhhbmRzaGFrZV0gPSBvcHRpb25zLmJlZm9yZUhhbmRzaGFrZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgbmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdNb25nb05ldHdvcmtFcnJvcic7XG4gICAgfVxufVxuZXhwb3J0cy5Nb25nb05ldHdvcmtFcnJvciA9IE1vbmdvTmV0d29ya0Vycm9yO1xuLyoqXG4gKiBBbiBlcnJvciBpbmRpY2F0aW5nIGEgbmV0d29yayB0aW1lb3V0IG9jY3VycmVkXG4gKiBAcHVibGljXG4gKiBAY2F0ZWdvcnkgRXJyb3JcbiAqXG4gKiBAcHJpdmF0ZVJlbWFya3NcbiAqIG1vbmdvZGItY2xpZW50LWVuY3J5cHRpb24gaGFzIGEgZGVwZW5kZW5jeSBvbiB0aGlzIGVycm9yIHdpdGggYW4gaW5zdGFuY2VvZiBjaGVja1xuICovXG5jbGFzcyBNb25nb05ldHdvcmtUaW1lb3V0RXJyb3IgZXh0ZW5kcyBNb25nb05ldHdvcmtFcnJvciB7XG4gICAgY29uc3RydWN0b3IobWVzc2FnZSwgb3B0aW9ucykge1xuICAgICAgICBzdXBlcihtZXNzYWdlLCBvcHRpb25zKTtcbiAgICB9XG4gICAgZ2V0IG5hbWUoKSB7XG4gICAgICAgIHJldHVybiAnTW9uZ29OZXR3b3JrVGltZW91dEVycm9yJztcbiAgICB9XG59XG5leHBvcnRzLk1vbmdvTmV0d29ya1RpbWVvdXRFcnJvciA9IE1vbmdvTmV0d29ya1RpbWVvdXRFcnJvcjtcbi8qKlxuICogQW4gZXJyb3IgdXNlZCB3aGVuIGF0dGVtcHRpbmcgdG8gcGFyc2UgYSB2YWx1ZSAobGlrZSBhIGNvbm5lY3Rpb24gc3RyaW5nKVxuICogQHB1YmxpY1xuICogQGNhdGVnb3J5IEVycm9yXG4gKi9cbmNsYXNzIE1vbmdvUGFyc2VFcnJvciBleHRlbmRzIE1vbmdvRHJpdmVyRXJyb3Ige1xuICAgIGNvbnN0cnVjdG9yKG1lc3NhZ2UpIHtcbiAgICAgICAgc3VwZXIobWVzc2FnZSk7XG4gICAgfVxuICAgIGdldCBuYW1lKCkge1xuICAgICAgICByZXR1cm4gJ01vbmdvUGFyc2VFcnJvcic7XG4gICAgfVxufVxuZXhwb3J0cy5Nb25nb1BhcnNlRXJyb3IgPSBNb25nb1BhcnNlRXJyb3I7XG4vKipcbiAqIEFuIGVycm9yIGdlbmVyYXRlZCB3aGVuIHRoZSB1c2VyIHN1cHBsaWVzIG1hbGZvcm1lZCBvciB1bmV4cGVjdGVkIGFyZ3VtZW50c1xuICogb3Igd2hlbiBhIHJlcXVpcmVkIGFyZ3VtZW50IG9yIGZpZWxkIGlzIG5vdCBwcm92aWRlZC5cbiAqXG4gKlxuICogQHB1YmxpY1xuICogQGNhdGVnb3J5IEVycm9yXG4gKi9cbmNsYXNzIE1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IgZXh0ZW5kcyBNb25nb0FQSUVycm9yIHtcbiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlKSB7XG4gICAgICAgIHN1cGVyKG1lc3NhZ2UpO1xuICAgIH1cbiAgICBnZXQgbmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdNb25nb0ludmFsaWRBcmd1bWVudEVycm9yJztcbiAgICB9XG59XG5leHBvcnRzLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IgPSBNb25nb0ludmFsaWRBcmd1bWVudEVycm9yO1xuLyoqXG4gKiBBbiBlcnJvciBnZW5lcmF0ZWQgd2hlbiBhIGZlYXR1cmUgdGhhdCBpcyBub3QgZW5hYmxlZCBvciBhbGxvd2VkIGZvciB0aGUgY3VycmVudCBzZXJ2ZXJcbiAqIGNvbmZpZ3VyYXRpb24gaXMgdXNlZFxuICpcbiAqXG4gKiBAcHVibGljXG4gKiBAY2F0ZWdvcnkgRXJyb3JcbiAqL1xuY2xhc3MgTW9uZ29Db21wYXRpYmlsaXR5RXJyb3IgZXh0ZW5kcyBNb25nb0FQSUVycm9yIHtcbiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlKSB7XG4gICAgICAgIHN1cGVyKG1lc3NhZ2UpO1xuICAgIH1cbiAgICBnZXQgbmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdNb25nb0NvbXBhdGliaWxpdHlFcnJvcic7XG4gICAgfVxufVxuZXhwb3J0cy5Nb25nb0NvbXBhdGliaWxpdHlFcnJvciA9IE1vbmdvQ29tcGF0aWJpbGl0eUVycm9yO1xuLyoqXG4gKiBBbiBlcnJvciBnZW5lcmF0ZWQgd2hlbiB0aGUgdXNlciBmYWlscyB0byBwcm92aWRlIGF1dGhlbnRpY2F0aW9uIGNyZWRlbnRpYWxzIGJlZm9yZSBhdHRlbXB0aW5nXG4gKiB0byBjb25uZWN0IHRvIGEgbW9uZ28gc2VydmVyIGluc3RhbmNlLlxuICpcbiAqXG4gKiBAcHVibGljXG4gKiBAY2F0ZWdvcnkgRXJyb3JcbiAqL1xuY2xhc3MgTW9uZ29NaXNzaW5nQ3JlZGVudGlhbHNFcnJvciBleHRlbmRzIE1vbmdvQVBJRXJyb3Ige1xuICAgIGNvbnN0cnVjdG9yKG1lc3NhZ2UpIHtcbiAgICAgICAgc3VwZXIobWVzc2FnZSk7XG4gICAgfVxuICAgIGdldCBuYW1lKCkge1xuICAgICAgICByZXR1cm4gJ01vbmdvTWlzc2luZ0NyZWRlbnRpYWxzRXJyb3InO1xuICAgIH1cbn1cbmV4cG9ydHMuTW9uZ29NaXNzaW5nQ3JlZGVudGlhbHNFcnJvciA9IE1vbmdvTWlzc2luZ0NyZWRlbnRpYWxzRXJyb3I7XG4vKipcbiAqIEFuIGVycm9yIGdlbmVyYXRlZCB3aGVuIGEgcmVxdWlyZWQgbW9kdWxlIG9yIGRlcGVuZGVuY3kgaXMgbm90IHByZXNlbnQgaW4gdGhlIGxvY2FsIGVudmlyb25tZW50XG4gKlxuICogQHB1YmxpY1xuICogQGNhdGVnb3J5IEVycm9yXG4gKi9cbmNsYXNzIE1vbmdvTWlzc2luZ0RlcGVuZGVuY3lFcnJvciBleHRlbmRzIE1vbmdvQVBJRXJyb3Ige1xuICAgIGNvbnN0cnVjdG9yKG1lc3NhZ2UsIHsgY2F1c2UgfSA9IHt9KSB7XG4gICAgICAgIHN1cGVyKG1lc3NhZ2UpO1xuICAgICAgICBpZiAoY2F1c2UpXG4gICAgICAgICAgICB0aGlzLmNhdXNlID0gY2F1c2U7XG4gICAgfVxuICAgIGdldCBuYW1lKCkge1xuICAgICAgICByZXR1cm4gJ01vbmdvTWlzc2luZ0RlcGVuZGVuY3lFcnJvcic7XG4gICAgfVxufVxuZXhwb3J0cy5Nb25nb01pc3NpbmdEZXBlbmRlbmN5RXJyb3IgPSBNb25nb01pc3NpbmdEZXBlbmRlbmN5RXJyb3I7XG4vKipcbiAqIEFuIGVycm9yIHNpZ25pZnlpbmcgYSBnZW5lcmFsIHN5c3RlbSBpc3N1ZVxuICogQHB1YmxpY1xuICogQGNhdGVnb3J5IEVycm9yXG4gKi9cbmNsYXNzIE1vbmdvU3lzdGVtRXJyb3IgZXh0ZW5kcyBNb25nb0Vycm9yIHtcbiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlLCByZWFzb24pIHtcbiAgICAgICAgaWYgKHJlYXNvbiAmJiByZWFzb24uZXJyb3IpIHtcbiAgICAgICAgICAgIHN1cGVyKHJlYXNvbi5lcnJvci5tZXNzYWdlIHx8IHJlYXNvbi5lcnJvcik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBzdXBlcihtZXNzYWdlKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocmVhc29uKSB7XG4gICAgICAgICAgICB0aGlzLnJlYXNvbiA9IHJlYXNvbjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNvZGUgPSByZWFzb24uZXJyb3I/LmNvZGU7XG4gICAgfVxuICAgIGdldCBuYW1lKCkge1xuICAgICAgICByZXR1cm4gJ01vbmdvU3lzdGVtRXJyb3InO1xuICAgIH1cbn1cbmV4cG9ydHMuTW9uZ29TeXN0ZW1FcnJvciA9IE1vbmdvU3lzdGVtRXJyb3I7XG4vKipcbiAqIEFuIGVycm9yIHNpZ25pZnlpbmcgYSBjbGllbnQtc2lkZSBzZXJ2ZXIgc2VsZWN0aW9uIGVycm9yXG4gKiBAcHVibGljXG4gKiBAY2F0ZWdvcnkgRXJyb3JcbiAqL1xuY2xhc3MgTW9uZ29TZXJ2ZXJTZWxlY3Rpb25FcnJvciBleHRlbmRzIE1vbmdvU3lzdGVtRXJyb3Ige1xuICAgIGNvbnN0cnVjdG9yKG1lc3NhZ2UsIHJlYXNvbikge1xuICAgICAgICBzdXBlcihtZXNzYWdlLCByZWFzb24pO1xuICAgIH1cbiAgICBnZXQgbmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdNb25nb1NlcnZlclNlbGVjdGlvbkVycm9yJztcbiAgICB9XG59XG5leHBvcnRzLk1vbmdvU2VydmVyU2VsZWN0aW9uRXJyb3IgPSBNb25nb1NlcnZlclNlbGVjdGlvbkVycm9yO1xuZnVuY3Rpb24gbWFrZVdyaXRlQ29uY2VyblJlc3VsdE9iamVjdChpbnB1dCkge1xuICAgIGNvbnN0IG91dHB1dCA9IE9iamVjdC5hc3NpZ24oe30sIGlucHV0KTtcbiAgICBpZiAob3V0cHV0Lm9rID09PSAwKSB7XG4gICAgICAgIG91dHB1dC5vayA9IDE7XG4gICAgICAgIGRlbGV0ZSBvdXRwdXQuZXJybXNnO1xuICAgICAgICBkZWxldGUgb3V0cHV0LmNvZGU7XG4gICAgICAgIGRlbGV0ZSBvdXRwdXQuY29kZU5hbWU7XG4gICAgfVxuICAgIHJldHVybiBvdXRwdXQ7XG59XG4vKipcbiAqIEFuIGVycm9yIHRocm93biB3aGVuIHRoZSBzZXJ2ZXIgcmVwb3J0cyBhIHdyaXRlQ29uY2VybkVycm9yXG4gKiBAcHVibGljXG4gKiBAY2F0ZWdvcnkgRXJyb3JcbiAqL1xuY2xhc3MgTW9uZ29Xcml0ZUNvbmNlcm5FcnJvciBleHRlbmRzIE1vbmdvU2VydmVyRXJyb3Ige1xuICAgIGNvbnN0cnVjdG9yKG1lc3NhZ2UsIHJlc3VsdCkge1xuICAgICAgICBpZiAocmVzdWx0ICYmIEFycmF5LmlzQXJyYXkocmVzdWx0LmVycm9yTGFiZWxzKSkge1xuICAgICAgICAgICAgbWVzc2FnZS5lcnJvckxhYmVscyA9IHJlc3VsdC5lcnJvckxhYmVscztcbiAgICAgICAgfVxuICAgICAgICBzdXBlcihtZXNzYWdlKTtcbiAgICAgICAgdGhpcy5lcnJJbmZvID0gbWVzc2FnZS5lcnJJbmZvO1xuICAgICAgICBpZiAocmVzdWx0ICE9IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXMucmVzdWx0ID0gbWFrZVdyaXRlQ29uY2VyblJlc3VsdE9iamVjdChyZXN1bHQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldCBuYW1lKCkge1xuICAgICAgICByZXR1cm4gJ01vbmdvV3JpdGVDb25jZXJuRXJyb3InO1xuICAgIH1cbn1cbmV4cG9ydHMuTW9uZ29Xcml0ZUNvbmNlcm5FcnJvciA9IE1vbmdvV3JpdGVDb25jZXJuRXJyb3I7XG4vLyBodHRwczovL2dpdGh1Yi5jb20vbW9uZ29kYi9zcGVjaWZpY2F0aW9ucy9ibG9iL21hc3Rlci9zb3VyY2UvcmV0cnlhYmxlLXJlYWRzL3JldHJ5YWJsZS1yZWFkcy5yc3QjcmV0cnlhYmxlLWVycm9yXG5jb25zdCBSRVRSWUFCTEVfUkVBRF9FUlJPUl9DT0RFUyA9IG5ldyBTZXQoW1xuICAgIGV4cG9ydHMuTU9OR09EQl9FUlJPUl9DT0RFUy5Ib3N0VW5yZWFjaGFibGUsXG4gICAgZXhwb3J0cy5NT05HT0RCX0VSUk9SX0NPREVTLkhvc3ROb3RGb3VuZCxcbiAgICBleHBvcnRzLk1PTkdPREJfRVJST1JfQ09ERVMuTmV0d29ya1RpbWVvdXQsXG4gICAgZXhwb3J0cy5NT05HT0RCX0VSUk9SX0NPREVTLlNodXRkb3duSW5Qcm9ncmVzcyxcbiAgICBleHBvcnRzLk1PTkdPREJfRVJST1JfQ09ERVMuUHJpbWFyeVN0ZXBwZWREb3duLFxuICAgIGV4cG9ydHMuTU9OR09EQl9FUlJPUl9DT0RFUy5Tb2NrZXRFeGNlcHRpb24sXG4gICAgZXhwb3J0cy5NT05HT0RCX0VSUk9SX0NPREVTLk5vdFdyaXRhYmxlUHJpbWFyeSxcbiAgICBleHBvcnRzLk1PTkdPREJfRVJST1JfQ09ERVMuSW50ZXJydXB0ZWRBdFNodXRkb3duLFxuICAgIGV4cG9ydHMuTU9OR09EQl9FUlJPUl9DT0RFUy5JbnRlcnJ1cHRlZER1ZVRvUmVwbFN0YXRlQ2hhbmdlLFxuICAgIGV4cG9ydHMuTU9OR09EQl9FUlJPUl9DT0RFUy5Ob3RQcmltYXJ5Tm9TZWNvbmRhcnlPayxcbiAgICBleHBvcnRzLk1PTkdPREJfRVJST1JfQ09ERVMuTm90UHJpbWFyeU9yU2Vjb25kYXJ5XG5dKTtcbi8vIHNlZTogaHR0cHM6Ly9naXRodWIuY29tL21vbmdvZGIvc3BlY2lmaWNhdGlvbnMvYmxvYi9tYXN0ZXIvc291cmNlL3JldHJ5YWJsZS13cml0ZXMvcmV0cnlhYmxlLXdyaXRlcy5yc3QjdGVybXNcbmNvbnN0IFJFVFJZQUJMRV9XUklURV9FUlJPUl9DT0RFUyA9IG5ldyBTZXQoW1xuICAgIC4uLlJFVFJZQUJMRV9SRUFEX0VSUk9SX0NPREVTLFxuICAgIGV4cG9ydHMuTU9OR09EQl9FUlJPUl9DT0RFUy5FeGNlZWRlZFRpbWVMaW1pdFxuXSk7XG5mdW5jdGlvbiBuZWVkc1JldHJ5YWJsZVdyaXRlTGFiZWwoZXJyb3IsIG1heFdpcmVWZXJzaW9uKSB7XG4gICAgLy8gcHJlLTQuNCBzZXJ2ZXIsIHRoZW4gdGhlIGRyaXZlciBhZGRzIGFuIGVycm9yIGxhYmVsIGZvciBldmVyeSB2YWxpZCBjYXNlXG4gICAgLy8gZXhlY3V0ZSBvcGVyYXRpb24gd2lsbCBvbmx5IGluc3BlY3QgdGhlIGxhYmVsLCBjb2RlL21lc3NhZ2UgbG9naWMgaXMgaGFuZGxlZCBoZXJlXG4gICAgaWYgKGVycm9yIGluc3RhbmNlb2YgTW9uZ29OZXR3b3JrRXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIE1vbmdvRXJyb3IpIHtcbiAgICAgICAgaWYgKChtYXhXaXJlVmVyc2lvbiA+PSA5IHx8IGVycm9yLmhhc0Vycm9yTGFiZWwoZXhwb3J0cy5Nb25nb0Vycm9yTGFiZWwuUmV0cnlhYmxlV3JpdGVFcnJvcikpICYmXG4gICAgICAgICAgICAhZXJyb3IuaGFzRXJyb3JMYWJlbChleHBvcnRzLk1vbmdvRXJyb3JMYWJlbC5IYW5kc2hha2VFcnJvcikpIHtcbiAgICAgICAgICAgIC8vIElmIHdlIGFscmVhZHkgaGF2ZSB0aGUgZXJyb3IgbGFiZWwgbm8gbmVlZCB0byBhZGQgaXQgYWdhaW4uIDQuNCsgc2VydmVycyBhZGQgdGhlIGxhYmVsLlxuICAgICAgICAgICAgLy8gSW4gdGhlIGNhc2Ugd2hlcmUgd2UgaGF2ZSBhIGhhbmRzaGFrZSBlcnJvciwgbmVlZCB0byBmYWxsIGRvd24gdG8gdGhlIGxvZ2ljIGNoZWNraW5nXG4gICAgICAgICAgICAvLyB0aGUgY29kZXMuXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKGVycm9yIGluc3RhbmNlb2YgTW9uZ29Xcml0ZUNvbmNlcm5FcnJvcikge1xuICAgICAgICByZXR1cm4gUkVUUllBQkxFX1dSSVRFX0VSUk9SX0NPREVTLmhhcyhlcnJvci5yZXN1bHQ/LmNvZGUgPz8gZXJyb3IuY29kZSA/PyAwKTtcbiAgICB9XG4gICAgaWYgKGVycm9yIGluc3RhbmNlb2YgTW9uZ29FcnJvciAmJiB0eXBlb2YgZXJyb3IuY29kZSA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgcmV0dXJuIFJFVFJZQUJMRV9XUklURV9FUlJPUl9DT0RFUy5oYXMoZXJyb3IuY29kZSk7XG4gICAgfVxuICAgIGNvbnN0IGlzTm90V3JpdGFibGVQcmltYXJ5RXJyb3IgPSBleHBvcnRzLkxFR0FDWV9OT1RfV1JJVEFCTEVfUFJJTUFSWV9FUlJPUl9NRVNTQUdFLnRlc3QoZXJyb3IubWVzc2FnZSk7XG4gICAgaWYgKGlzTm90V3JpdGFibGVQcmltYXJ5RXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGNvbnN0IGlzTm9kZUlzUmVjb3ZlcmluZ0Vycm9yID0gZXhwb3J0cy5OT0RFX0lTX1JFQ09WRVJJTkdfRVJST1JfTUVTU0FHRS50ZXN0KGVycm9yLm1lc3NhZ2UpO1xuICAgIGlmIChpc05vZGVJc1JlY292ZXJpbmdFcnJvcikge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xufVxuZXhwb3J0cy5uZWVkc1JldHJ5YWJsZVdyaXRlTGFiZWwgPSBuZWVkc1JldHJ5YWJsZVdyaXRlTGFiZWw7XG5mdW5jdGlvbiBpc1JldHJ5YWJsZVdyaXRlRXJyb3IoZXJyb3IpIHtcbiAgICByZXR1cm4gZXJyb3IuaGFzRXJyb3JMYWJlbChleHBvcnRzLk1vbmdvRXJyb3JMYWJlbC5SZXRyeWFibGVXcml0ZUVycm9yKTtcbn1cbmV4cG9ydHMuaXNSZXRyeWFibGVXcml0ZUVycm9yID0gaXNSZXRyeWFibGVXcml0ZUVycm9yO1xuLyoqIERldGVybWluZXMgd2hldGhlciBhbiBlcnJvciBpcyBzb21ldGhpbmcgdGhlIGRyaXZlciBzaG91bGQgYXR0ZW1wdCB0byByZXRyeSAqL1xuZnVuY3Rpb24gaXNSZXRyeWFibGVSZWFkRXJyb3IoZXJyb3IpIHtcbiAgICBjb25zdCBoYXNSZXRyeWFibGVFcnJvckNvZGUgPSB0eXBlb2YgZXJyb3IuY29kZSA9PT0gJ251bWJlcicgPyBSRVRSWUFCTEVfUkVBRF9FUlJPUl9DT0RFUy5oYXMoZXJyb3IuY29kZSkgOiBmYWxzZTtcbiAgICBpZiAoaGFzUmV0cnlhYmxlRXJyb3JDb2RlKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBNb25nb05ldHdvcmtFcnJvcikge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgY29uc3QgaXNOb3RXcml0YWJsZVByaW1hcnlFcnJvciA9IGV4cG9ydHMuTEVHQUNZX05PVF9XUklUQUJMRV9QUklNQVJZX0VSUk9SX01FU1NBR0UudGVzdChlcnJvci5tZXNzYWdlKTtcbiAgICBpZiAoaXNOb3RXcml0YWJsZVByaW1hcnlFcnJvcikge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgY29uc3QgaXNOb2RlSXNSZWNvdmVyaW5nRXJyb3IgPSBleHBvcnRzLk5PREVfSVNfUkVDT1ZFUklOR19FUlJPUl9NRVNTQUdFLnRlc3QoZXJyb3IubWVzc2FnZSk7XG4gICAgaWYgKGlzTm9kZUlzUmVjb3ZlcmluZ0Vycm9yKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG59XG5leHBvcnRzLmlzUmV0cnlhYmxlUmVhZEVycm9yID0gaXNSZXRyeWFibGVSZWFkRXJyb3I7XG5jb25zdCBTREFNX1JFQ09WRVJJTkdfQ09ERVMgPSBuZXcgU2V0KFtcbiAgICBleHBvcnRzLk1PTkdPREJfRVJST1JfQ09ERVMuU2h1dGRvd25JblByb2dyZXNzLFxuICAgIGV4cG9ydHMuTU9OR09EQl9FUlJPUl9DT0RFUy5QcmltYXJ5U3RlcHBlZERvd24sXG4gICAgZXhwb3J0cy5NT05HT0RCX0VSUk9SX0NPREVTLkludGVycnVwdGVkQXRTaHV0ZG93bixcbiAgICBleHBvcnRzLk1PTkdPREJfRVJST1JfQ09ERVMuSW50ZXJydXB0ZWREdWVUb1JlcGxTdGF0ZUNoYW5nZSxcbiAgICBleHBvcnRzLk1PTkdPREJfRVJST1JfQ09ERVMuTm90UHJpbWFyeU9yU2Vjb25kYXJ5XG5dKTtcbmNvbnN0IFNEQU1fTk9UX1BSSU1BUllfQ09ERVMgPSBuZXcgU2V0KFtcbiAgICBleHBvcnRzLk1PTkdPREJfRVJST1JfQ09ERVMuTm90V3JpdGFibGVQcmltYXJ5LFxuICAgIGV4cG9ydHMuTU9OR09EQl9FUlJPUl9DT0RFUy5Ob3RQcmltYXJ5Tm9TZWNvbmRhcnlPayxcbiAgICBleHBvcnRzLk1PTkdPREJfRVJST1JfQ09ERVMuTGVnYWN5Tm90UHJpbWFyeVxuXSk7XG5jb25zdCBTREFNX05PREVfU0hVVFRJTkdfRE9XTl9FUlJPUl9DT0RFUyA9IG5ldyBTZXQoW1xuICAgIGV4cG9ydHMuTU9OR09EQl9FUlJPUl9DT0RFUy5JbnRlcnJ1cHRlZEF0U2h1dGRvd24sXG4gICAgZXhwb3J0cy5NT05HT0RCX0VSUk9SX0NPREVTLlNodXRkb3duSW5Qcm9ncmVzc1xuXSk7XG5mdW5jdGlvbiBpc1JlY292ZXJpbmdFcnJvcihlcnIpIHtcbiAgICBpZiAodHlwZW9mIGVyci5jb2RlID09PSAnbnVtYmVyJykge1xuICAgICAgICAvLyBJZiBhbnkgZXJyb3IgY29kZSBleGlzdHMsIHdlIGlnbm9yZSB0aGUgZXJyb3IubWVzc2FnZVxuICAgICAgICByZXR1cm4gU0RBTV9SRUNPVkVSSU5HX0NPREVTLmhhcyhlcnIuY29kZSk7XG4gICAgfVxuICAgIHJldHVybiAoZXhwb3J0cy5MRUdBQ1lfTk9UX1BSSU1BUllfT1JfU0VDT05EQVJZX0VSUk9SX01FU1NBR0UudGVzdChlcnIubWVzc2FnZSkgfHxcbiAgICAgICAgZXhwb3J0cy5OT0RFX0lTX1JFQ09WRVJJTkdfRVJST1JfTUVTU0FHRS50ZXN0KGVyci5tZXNzYWdlKSk7XG59XG5mdW5jdGlvbiBpc05vdFdyaXRhYmxlUHJpbWFyeUVycm9yKGVycikge1xuICAgIGlmICh0eXBlb2YgZXJyLmNvZGUgPT09ICdudW1iZXInKSB7XG4gICAgICAgIC8vIElmIGFueSBlcnJvciBjb2RlIGV4aXN0cywgd2UgaWdub3JlIHRoZSBlcnJvci5tZXNzYWdlXG4gICAgICAgIHJldHVybiBTREFNX05PVF9QUklNQVJZX0NPREVTLmhhcyhlcnIuY29kZSk7XG4gICAgfVxuICAgIGlmIChpc1JlY292ZXJpbmdFcnJvcihlcnIpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIGV4cG9ydHMuTEVHQUNZX05PVF9XUklUQUJMRV9QUklNQVJZX0VSUk9SX01FU1NBR0UudGVzdChlcnIubWVzc2FnZSk7XG59XG5mdW5jdGlvbiBpc05vZGVTaHV0dGluZ0Rvd25FcnJvcihlcnIpIHtcbiAgICByZXR1cm4gISEodHlwZW9mIGVyci5jb2RlID09PSAnbnVtYmVyJyAmJiBTREFNX05PREVfU0hVVFRJTkdfRE9XTl9FUlJPUl9DT0RFUy5oYXMoZXJyLmNvZGUpKTtcbn1cbmV4cG9ydHMuaXNOb2RlU2h1dHRpbmdEb3duRXJyb3IgPSBpc05vZGVTaHV0dGluZ0Rvd25FcnJvcjtcbi8qKlxuICogRGV0ZXJtaW5lcyB3aGV0aGVyIFNEQU0gY2FuIHJlY292ZXIgZnJvbSBhIGdpdmVuIGVycm9yLiBJZiBpdCBjYW5ub3RcbiAqIHRoZW4gdGhlIHBvb2wgd2lsbCBiZSBjbGVhcmVkLCBhbmQgc2VydmVyIHN0YXRlIHdpbGwgY29tcGxldGVseSByZXNldFxuICogbG9jYWxseS5cbiAqXG4gKiBAc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9tb25nb2RiL3NwZWNpZmljYXRpb25zL2Jsb2IvbWFzdGVyL3NvdXJjZS9zZXJ2ZXItZGlzY292ZXJ5LWFuZC1tb25pdG9yaW5nL3NlcnZlci1kaXNjb3ZlcnktYW5kLW1vbml0b3JpbmcucnN0I25vdC1tYXN0ZXItYW5kLW5vZGUtaXMtcmVjb3ZlcmluZ1xuICovXG5mdW5jdGlvbiBpc1NEQU1VbnJlY292ZXJhYmxlRXJyb3IoZXJyb3IpIHtcbiAgICAvLyBOT1RFOiBudWxsIGNoZWNrIGlzIGhlcmUgZm9yIGEgc3RyaWN0bHkgcHJlLUNNQVAgd29ybGQsIGEgdGltZW91dCBvclxuICAgIC8vICAgICAgIGNsb3NlIGV2ZW50IGFyZSBjb25zaWRlcmVkIHVucmVjb3ZlcmFibGVcbiAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBNb25nb1BhcnNlRXJyb3IgfHwgZXJyb3IgPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGlzUmVjb3ZlcmluZ0Vycm9yKGVycm9yKSB8fCBpc05vdFdyaXRhYmxlUHJpbWFyeUVycm9yKGVycm9yKTtcbn1cbmV4cG9ydHMuaXNTREFNVW5yZWNvdmVyYWJsZUVycm9yID0gaXNTREFNVW5yZWNvdmVyYWJsZUVycm9yO1xuZnVuY3Rpb24gaXNOZXR3b3JrVGltZW91dEVycm9yKGVycikge1xuICAgIHJldHVybiAhIShlcnIgaW5zdGFuY2VvZiBNb25nb05ldHdvcmtFcnJvciAmJiBlcnIubWVzc2FnZS5tYXRjaCgvdGltZWQgb3V0LykpO1xufVxuZXhwb3J0cy5pc05ldHdvcmtUaW1lb3V0RXJyb3IgPSBpc05ldHdvcmtUaW1lb3V0RXJyb3I7XG5mdW5jdGlvbiBpc1Jlc3VtYWJsZUVycm9yKGVycm9yLCB3aXJlVmVyc2lvbikge1xuICAgIGlmIChlcnJvciA9PSBudWxsIHx8ICEoZXJyb3IgaW5zdGFuY2VvZiBNb25nb0Vycm9yKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIE1vbmdvTmV0d29ya0Vycm9yKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBpZiAod2lyZVZlcnNpb24gIT0gbnVsbCAmJiB3aXJlVmVyc2lvbiA+PSA5KSB7XG4gICAgICAgIC8vIERSSVZFUlMtMTMwODogRm9yIDQuNCBkcml2ZXJzIHJ1bm5pbmcgYWdhaW5zdCA0LjQgc2VydmVycywgZHJpdmVycyB3aWxsIGFkZCBhIHNwZWNpYWwgY2FzZSB0byB0cmVhdCB0aGUgQ3Vyc29yTm90Rm91bmQgZXJyb3IgY29kZSBhcyByZXN1bWFibGVcbiAgICAgICAgaWYgKGVycm9yLmNvZGUgPT09IGV4cG9ydHMuTU9OR09EQl9FUlJPUl9DT0RFUy5DdXJzb3JOb3RGb3VuZCkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGVycm9yLmhhc0Vycm9yTGFiZWwoZXhwb3J0cy5Nb25nb0Vycm9yTGFiZWwuUmVzdW1hYmxlQ2hhbmdlU3RyZWFtRXJyb3IpO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIGVycm9yLmNvZGUgPT09ICdudW1iZXInKSB7XG4gICAgICAgIHJldHVybiBleHBvcnRzLkdFVF9NT1JFX1JFU1VNQUJMRV9DT0RFUy5oYXMoZXJyb3IuY29kZSk7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbn1cbmV4cG9ydHMuaXNSZXN1bWFibGVFcnJvciA9IGlzUmVzdW1hYmxlRXJyb3I7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1lcnJvci5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/error.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/explain.js":
/*!*****************************************************!*\
  !*** ../server/node_modules/mongodb/lib/explain.js ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.Explain = exports.ExplainVerbosity = void 0;\nconst error_1 = __webpack_require__(/*! ./error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\n/** @public */\nexports.ExplainVerbosity = Object.freeze({\n    queryPlanner: 'queryPlanner',\n    queryPlannerExtended: 'queryPlannerExtended',\n    executionStats: 'executionStats',\n    allPlansExecution: 'allPlansExecution'\n});\n/** @internal */\nclass Explain {\n    constructor(verbosity) {\n        if (typeof verbosity === 'boolean') {\n            this.verbosity = verbosity\n                ? exports.ExplainVerbosity.allPlansExecution\n                : exports.ExplainVerbosity.queryPlanner;\n        }\n        else {\n            this.verbosity = verbosity;\n        }\n    }\n    static fromOptions(options) {\n        if (options?.explain == null)\n            return;\n        const explain = options.explain;\n        if (typeof explain === 'boolean' || typeof explain === 'string') {\n            return new Explain(explain);\n        }\n        throw new error_1.MongoInvalidArgumentError('Field \"explain\" must be a string or a boolean');\n    }\n}\nexports.Explain = Explain;\n//# sourceMappingURL=explain.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9leHBsYWluLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELGVBQWUsR0FBRyx3QkFBd0I7QUFDMUMsZ0JBQWdCLG1CQUFPLENBQUMsa0VBQVM7QUFDakM7QUFDQSx3QkFBd0I7QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlO0FBQ2YiLCJzb3VyY2VzIjpbIkQ6XFxzYWxvbmlcXGFwcHJhaXNhbC1zeXN0ZW1cXHNlcnZlclxcbm9kZV9tb2R1bGVzXFxtb25nb2RiXFxsaWJcXGV4cGxhaW4uanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkV4cGxhaW4gPSBleHBvcnRzLkV4cGxhaW5WZXJib3NpdHkgPSB2b2lkIDA7XG5jb25zdCBlcnJvcl8xID0gcmVxdWlyZShcIi4vZXJyb3JcIik7XG4vKiogQHB1YmxpYyAqL1xuZXhwb3J0cy5FeHBsYWluVmVyYm9zaXR5ID0gT2JqZWN0LmZyZWV6ZSh7XG4gICAgcXVlcnlQbGFubmVyOiAncXVlcnlQbGFubmVyJyxcbiAgICBxdWVyeVBsYW5uZXJFeHRlbmRlZDogJ3F1ZXJ5UGxhbm5lckV4dGVuZGVkJyxcbiAgICBleGVjdXRpb25TdGF0czogJ2V4ZWN1dGlvblN0YXRzJyxcbiAgICBhbGxQbGFuc0V4ZWN1dGlvbjogJ2FsbFBsYW5zRXhlY3V0aW9uJ1xufSk7XG4vKiogQGludGVybmFsICovXG5jbGFzcyBFeHBsYWluIHtcbiAgICBjb25zdHJ1Y3Rvcih2ZXJib3NpdHkpIHtcbiAgICAgICAgaWYgKHR5cGVvZiB2ZXJib3NpdHkgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgdGhpcy52ZXJib3NpdHkgPSB2ZXJib3NpdHlcbiAgICAgICAgICAgICAgICA/IGV4cG9ydHMuRXhwbGFpblZlcmJvc2l0eS5hbGxQbGFuc0V4ZWN1dGlvblxuICAgICAgICAgICAgICAgIDogZXhwb3J0cy5FeHBsYWluVmVyYm9zaXR5LnF1ZXJ5UGxhbm5lcjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMudmVyYm9zaXR5ID0gdmVyYm9zaXR5O1xuICAgICAgICB9XG4gICAgfVxuICAgIHN0YXRpYyBmcm9tT3B0aW9ucyhvcHRpb25zKSB7XG4gICAgICAgIGlmIChvcHRpb25zPy5leHBsYWluID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGNvbnN0IGV4cGxhaW4gPSBvcHRpb25zLmV4cGxhaW47XG4gICAgICAgIGlmICh0eXBlb2YgZXhwbGFpbiA9PT0gJ2Jvb2xlYW4nIHx8IHR5cGVvZiBleHBsYWluID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBFeHBsYWluKGV4cGxhaW4pO1xuICAgICAgICB9XG4gICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoJ0ZpZWxkIFwiZXhwbGFpblwiIG11c3QgYmUgYSBzdHJpbmcgb3IgYSBib29sZWFuJyk7XG4gICAgfVxufVxuZXhwb3J0cy5FeHBsYWluID0gRXhwbGFpbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWV4cGxhaW4uanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/explain.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/gridfs/download.js":
/*!*************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/gridfs/download.js ***!
  \*************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.GridFSBucketReadStream = void 0;\nconst stream_1 = __webpack_require__(/*! stream */ \"stream\");\nconst error_1 = __webpack_require__(/*! ../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\n/**\n * A readable stream that enables you to read buffers from GridFS.\n *\n * Do not instantiate this class directly. Use `openDownloadStream()` instead.\n * @public\n */\nclass GridFSBucketReadStream extends stream_1.Readable {\n    /**\n     * @param chunks - Handle for chunks collection\n     * @param files - Handle for files collection\n     * @param readPreference - The read preference to use\n     * @param filter - The filter to use to find the file document\n     * @internal\n     */\n    constructor(chunks, files, readPreference, filter, options) {\n        super();\n        this.s = {\n            bytesToTrim: 0,\n            bytesToSkip: 0,\n            bytesRead: 0,\n            chunks,\n            expected: 0,\n            files,\n            filter,\n            init: false,\n            expectedEnd: 0,\n            options: {\n                start: 0,\n                end: 0,\n                ...options\n            },\n            readPreference\n        };\n    }\n    /**\n     * Reads from the cursor and pushes to the stream.\n     * Private Impl, do not call directly\n     * @internal\n     */\n    _read() {\n        if (this.destroyed)\n            return;\n        waitForFile(this, () => doRead(this));\n    }\n    /**\n     * Sets the 0-based offset in bytes to start streaming from. Throws\n     * an error if this stream has entered flowing mode\n     * (e.g. if you've already called `on('data')`)\n     *\n     * @param start - 0-based offset in bytes to start streaming from\n     */\n    start(start = 0) {\n        throwIfInitialized(this);\n        this.s.options.start = start;\n        return this;\n    }\n    /**\n     * Sets the 0-based offset in bytes to start streaming from. Throws\n     * an error if this stream has entered flowing mode\n     * (e.g. if you've already called `on('data')`)\n     *\n     * @param end - Offset in bytes to stop reading at\n     */\n    end(end = 0) {\n        throwIfInitialized(this);\n        this.s.options.end = end;\n        return this;\n    }\n    /**\n     * Marks this stream as aborted (will never push another `data` event)\n     * and kills the underlying cursor. Will emit the 'end' event, and then\n     * the 'close' event once the cursor is successfully killed.\n     */\n    async abort() {\n        this.push(null);\n        this.destroyed = true;\n        if (this.s.cursor) {\n            try {\n                await this.s.cursor.close();\n            }\n            finally {\n                this.emit(GridFSBucketReadStream.CLOSE);\n            }\n        }\n        else {\n            if (!this.s.init) {\n                // If not initialized, fire close event because we will never\n                // get a cursor\n                this.emit(GridFSBucketReadStream.CLOSE);\n            }\n        }\n    }\n}\n/**\n * An error occurred\n * @event\n */\nGridFSBucketReadStream.ERROR = 'error';\n/**\n * Fires when the stream loaded the file document corresponding to the provided id.\n * @event\n */\nGridFSBucketReadStream.FILE = 'file';\n/**\n * Emitted when a chunk of data is available to be consumed.\n * @event\n */\nGridFSBucketReadStream.DATA = 'data';\n/**\n * Fired when the stream is exhausted (no more data events).\n * @event\n */\nGridFSBucketReadStream.END = 'end';\n/**\n * Fired when the stream is exhausted and the underlying cursor is killed\n * @event\n */\nGridFSBucketReadStream.CLOSE = 'close';\nexports.GridFSBucketReadStream = GridFSBucketReadStream;\nfunction throwIfInitialized(stream) {\n    if (stream.s.init) {\n        throw new error_1.MongoGridFSStreamError('Options cannot be changed after the stream is initialized');\n    }\n}\nfunction doRead(stream) {\n    if (stream.destroyed)\n        return;\n    if (!stream.s.cursor)\n        return;\n    if (!stream.s.file)\n        return;\n    const handleReadResult = ({ error, doc }) => {\n        if (stream.destroyed) {\n            return;\n        }\n        if (error) {\n            stream.emit(GridFSBucketReadStream.ERROR, error);\n            return;\n        }\n        if (!doc) {\n            stream.push(null);\n            stream.s.cursor?.close().then(() => {\n                stream.emit(GridFSBucketReadStream.CLOSE);\n            }, error => {\n                stream.emit(GridFSBucketReadStream.ERROR, error);\n            });\n            return;\n        }\n        if (!stream.s.file)\n            return;\n        const bytesRemaining = stream.s.file.length - stream.s.bytesRead;\n        const expectedN = stream.s.expected++;\n        const expectedLength = Math.min(stream.s.file.chunkSize, bytesRemaining);\n        if (doc.n > expectedN) {\n            return stream.emit(GridFSBucketReadStream.ERROR, new error_1.MongoGridFSChunkError(`ChunkIsMissing: Got unexpected n: ${doc.n}, expected: ${expectedN}`));\n        }\n        if (doc.n < expectedN) {\n            return stream.emit(GridFSBucketReadStream.ERROR, new error_1.MongoGridFSChunkError(`ExtraChunk: Got unexpected n: ${doc.n}, expected: ${expectedN}`));\n        }\n        let buf = Buffer.isBuffer(doc.data) ? doc.data : doc.data.buffer;\n        if (buf.byteLength !== expectedLength) {\n            if (bytesRemaining <= 0) {\n                return stream.emit(GridFSBucketReadStream.ERROR, new error_1.MongoGridFSChunkError(`ExtraChunk: Got unexpected n: ${doc.n}, expected file length ${stream.s.file.length} bytes but already read ${stream.s.bytesRead} bytes`));\n            }\n            return stream.emit(GridFSBucketReadStream.ERROR, new error_1.MongoGridFSChunkError(`ChunkIsWrongSize: Got unexpected length: ${buf.byteLength}, expected: ${expectedLength}`));\n        }\n        stream.s.bytesRead += buf.byteLength;\n        if (buf.byteLength === 0) {\n            return stream.push(null);\n        }\n        let sliceStart = null;\n        let sliceEnd = null;\n        if (stream.s.bytesToSkip != null) {\n            sliceStart = stream.s.bytesToSkip;\n            stream.s.bytesToSkip = 0;\n        }\n        const atEndOfStream = expectedN === stream.s.expectedEnd - 1;\n        const bytesLeftToRead = stream.s.options.end - stream.s.bytesToSkip;\n        if (atEndOfStream && stream.s.bytesToTrim != null) {\n            sliceEnd = stream.s.file.chunkSize - stream.s.bytesToTrim;\n        }\n        else if (stream.s.options.end && bytesLeftToRead < doc.data.byteLength) {\n            sliceEnd = bytesLeftToRead;\n        }\n        if (sliceStart != null || sliceEnd != null) {\n            buf = buf.slice(sliceStart || 0, sliceEnd || buf.byteLength);\n        }\n        stream.push(buf);\n        return;\n    };\n    stream.s.cursor.next().then(doc => handleReadResult({ error: null, doc }), error => handleReadResult({ error, doc: null }));\n}\nfunction init(stream) {\n    const findOneOptions = {};\n    if (stream.s.readPreference) {\n        findOneOptions.readPreference = stream.s.readPreference;\n    }\n    if (stream.s.options && stream.s.options.sort) {\n        findOneOptions.sort = stream.s.options.sort;\n    }\n    if (stream.s.options && stream.s.options.skip) {\n        findOneOptions.skip = stream.s.options.skip;\n    }\n    const handleReadResult = ({ error, doc }) => {\n        if (error) {\n            return stream.emit(GridFSBucketReadStream.ERROR, error);\n        }\n        if (!doc) {\n            const identifier = stream.s.filter._id\n                ? stream.s.filter._id.toString()\n                : stream.s.filter.filename;\n            const errmsg = `FileNotFound: file ${identifier} was not found`;\n            // TODO(NODE-3483)\n            const err = new error_1.MongoRuntimeError(errmsg);\n            err.code = 'ENOENT'; // TODO: NODE-3338 set property as part of constructor\n            return stream.emit(GridFSBucketReadStream.ERROR, err);\n        }\n        // If document is empty, kill the stream immediately and don't\n        // execute any reads\n        if (doc.length <= 0) {\n            stream.push(null);\n            return;\n        }\n        if (stream.destroyed) {\n            // If user destroys the stream before we have a cursor, wait\n            // until the query is done to say we're 'closed' because we can't\n            // cancel a query.\n            stream.emit(GridFSBucketReadStream.CLOSE);\n            return;\n        }\n        try {\n            stream.s.bytesToSkip = handleStartOption(stream, doc, stream.s.options);\n        }\n        catch (error) {\n            return stream.emit(GridFSBucketReadStream.ERROR, error);\n        }\n        const filter = { files_id: doc._id };\n        // Currently (MongoDB 3.4.4) skip function does not support the index,\n        // it needs to retrieve all the documents first and then skip them. (CS-25811)\n        // As work around we use $gte on the \"n\" field.\n        if (stream.s.options && stream.s.options.start != null) {\n            const skip = Math.floor(stream.s.options.start / doc.chunkSize);\n            if (skip > 0) {\n                filter['n'] = { $gte: skip };\n            }\n        }\n        stream.s.cursor = stream.s.chunks.find(filter).sort({ n: 1 });\n        if (stream.s.readPreference) {\n            stream.s.cursor.withReadPreference(stream.s.readPreference);\n        }\n        stream.s.expectedEnd = Math.ceil(doc.length / doc.chunkSize);\n        stream.s.file = doc;\n        try {\n            stream.s.bytesToTrim = handleEndOption(stream, doc, stream.s.cursor, stream.s.options);\n        }\n        catch (error) {\n            return stream.emit(GridFSBucketReadStream.ERROR, error);\n        }\n        stream.emit(GridFSBucketReadStream.FILE, doc);\n        return;\n    };\n    stream.s.files.findOne(stream.s.filter, findOneOptions).then(doc => handleReadResult({ error: null, doc }), error => handleReadResult({ error, doc: null }));\n}\nfunction waitForFile(stream, callback) {\n    if (stream.s.file) {\n        return callback();\n    }\n    if (!stream.s.init) {\n        init(stream);\n        stream.s.init = true;\n    }\n    stream.once('file', () => {\n        callback();\n    });\n}\nfunction handleStartOption(stream, doc, options) {\n    if (options && options.start != null) {\n        if (options.start > doc.length) {\n            throw new error_1.MongoInvalidArgumentError(`Stream start (${options.start}) must not be more than the length of the file (${doc.length})`);\n        }\n        if (options.start < 0) {\n            throw new error_1.MongoInvalidArgumentError(`Stream start (${options.start}) must not be negative`);\n        }\n        if (options.end != null && options.end < options.start) {\n            throw new error_1.MongoInvalidArgumentError(`Stream start (${options.start}) must not be greater than stream end (${options.end})`);\n        }\n        stream.s.bytesRead = Math.floor(options.start / doc.chunkSize) * doc.chunkSize;\n        stream.s.expected = Math.floor(options.start / doc.chunkSize);\n        return options.start - stream.s.bytesRead;\n    }\n    throw new error_1.MongoInvalidArgumentError('Start option must be defined');\n}\nfunction handleEndOption(stream, doc, cursor, options) {\n    if (options && options.end != null) {\n        if (options.end > doc.length) {\n            throw new error_1.MongoInvalidArgumentError(`Stream end (${options.end}) must not be more than the length of the file (${doc.length})`);\n        }\n        if (options.start == null || options.start < 0) {\n            throw new error_1.MongoInvalidArgumentError(`Stream end (${options.end}) must not be negative`);\n        }\n        const start = options.start != null ? Math.floor(options.start / doc.chunkSize) : 0;\n        cursor.limit(Math.ceil(options.end / doc.chunkSize) - start);\n        stream.s.expectedEnd = Math.ceil(options.end / doc.chunkSize);\n        return Math.ceil(options.end / doc.chunkSize) * doc.chunkSize - options.end;\n    }\n    throw new error_1.MongoInvalidArgumentError('End option must be defined');\n}\n//# sourceMappingURL=download.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9ncmlkZnMvZG93bmxvYWQuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsOEJBQThCO0FBQzlCLGlCQUFpQixtQkFBTyxDQUFDLHNCQUFRO0FBQ2pDLGdCQUFnQixtQkFBTyxDQUFDLG1FQUFVO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFBOEI7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDLFlBQVk7QUFDNUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0lBQW9JLE1BQU0sY0FBYyxVQUFVO0FBQ2xLO0FBQ0E7QUFDQSxnSUFBZ0ksTUFBTSxjQUFjLFVBQVU7QUFDOUo7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvSUFBb0ksTUFBTSx5QkFBeUIsc0JBQXNCLHlCQUF5QixvQkFBb0I7QUFDdE87QUFDQSwySUFBMkksZUFBZSxjQUFjLGVBQWU7QUFDdkw7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwREFBMEQsa0JBQWtCLCtCQUErQixrQkFBa0I7QUFDN0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDLFlBQVk7QUFDNUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpREFBaUQsWUFBWTtBQUM3RDtBQUNBO0FBQ0EsaUNBQWlDO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0M7QUFDaEM7QUFDQTtBQUNBLDhEQUE4RCxNQUFNO0FBQ3BFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyRkFBMkYsa0JBQWtCLCtCQUErQixrQkFBa0I7QUFDOUo7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlFQUF5RSxjQUFjLGtEQUFrRCxXQUFXO0FBQ3BKO0FBQ0E7QUFDQSx5RUFBeUUsY0FBYztBQUN2RjtBQUNBO0FBQ0EseUVBQXlFLGNBQWMseUNBQXlDLFlBQVk7QUFDNUk7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1RUFBdUUsWUFBWSxrREFBa0QsV0FBVztBQUNoSjtBQUNBO0FBQ0EsdUVBQXVFLFlBQVk7QUFDbkY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJEOlxcc2Fsb25pXFxhcHByYWlzYWwtc3lzdGVtXFxzZXJ2ZXJcXG5vZGVfbW9kdWxlc1xcbW9uZ29kYlxcbGliXFxncmlkZnNcXGRvd25sb2FkLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5HcmlkRlNCdWNrZXRSZWFkU3RyZWFtID0gdm9pZCAwO1xuY29uc3Qgc3RyZWFtXzEgPSByZXF1aXJlKFwic3RyZWFtXCIpO1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuLi9lcnJvclwiKTtcbi8qKlxuICogQSByZWFkYWJsZSBzdHJlYW0gdGhhdCBlbmFibGVzIHlvdSB0byByZWFkIGJ1ZmZlcnMgZnJvbSBHcmlkRlMuXG4gKlxuICogRG8gbm90IGluc3RhbnRpYXRlIHRoaXMgY2xhc3MgZGlyZWN0bHkuIFVzZSBgb3BlbkRvd25sb2FkU3RyZWFtKClgIGluc3RlYWQuXG4gKiBAcHVibGljXG4gKi9cbmNsYXNzIEdyaWRGU0J1Y2tldFJlYWRTdHJlYW0gZXh0ZW5kcyBzdHJlYW1fMS5SZWFkYWJsZSB7XG4gICAgLyoqXG4gICAgICogQHBhcmFtIGNodW5rcyAtIEhhbmRsZSBmb3IgY2h1bmtzIGNvbGxlY3Rpb25cbiAgICAgKiBAcGFyYW0gZmlsZXMgLSBIYW5kbGUgZm9yIGZpbGVzIGNvbGxlY3Rpb25cbiAgICAgKiBAcGFyYW0gcmVhZFByZWZlcmVuY2UgLSBUaGUgcmVhZCBwcmVmZXJlbmNlIHRvIHVzZVxuICAgICAqIEBwYXJhbSBmaWx0ZXIgLSBUaGUgZmlsdGVyIHRvIHVzZSB0byBmaW5kIHRoZSBmaWxlIGRvY3VtZW50XG4gICAgICogQGludGVybmFsXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoY2h1bmtzLCBmaWxlcywgcmVhZFByZWZlcmVuY2UsIGZpbHRlciwgb3B0aW9ucykge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLnMgPSB7XG4gICAgICAgICAgICBieXRlc1RvVHJpbTogMCxcbiAgICAgICAgICAgIGJ5dGVzVG9Ta2lwOiAwLFxuICAgICAgICAgICAgYnl0ZXNSZWFkOiAwLFxuICAgICAgICAgICAgY2h1bmtzLFxuICAgICAgICAgICAgZXhwZWN0ZWQ6IDAsXG4gICAgICAgICAgICBmaWxlcyxcbiAgICAgICAgICAgIGZpbHRlcixcbiAgICAgICAgICAgIGluaXQ6IGZhbHNlLFxuICAgICAgICAgICAgZXhwZWN0ZWRFbmQ6IDAsXG4gICAgICAgICAgICBvcHRpb25zOiB7XG4gICAgICAgICAgICAgICAgc3RhcnQ6IDAsXG4gICAgICAgICAgICAgICAgZW5kOiAwLFxuICAgICAgICAgICAgICAgIC4uLm9wdGlvbnNcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZWFkUHJlZmVyZW5jZVxuICAgICAgICB9O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZWFkcyBmcm9tIHRoZSBjdXJzb3IgYW5kIHB1c2hlcyB0byB0aGUgc3RyZWFtLlxuICAgICAqIFByaXZhdGUgSW1wbCwgZG8gbm90IGNhbGwgZGlyZWN0bHlcbiAgICAgKiBAaW50ZXJuYWxcbiAgICAgKi9cbiAgICBfcmVhZCgpIHtcbiAgICAgICAgaWYgKHRoaXMuZGVzdHJveWVkKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB3YWl0Rm9yRmlsZSh0aGlzLCAoKSA9PiBkb1JlYWQodGhpcykpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTZXRzIHRoZSAwLWJhc2VkIG9mZnNldCBpbiBieXRlcyB0byBzdGFydCBzdHJlYW1pbmcgZnJvbS4gVGhyb3dzXG4gICAgICogYW4gZXJyb3IgaWYgdGhpcyBzdHJlYW0gaGFzIGVudGVyZWQgZmxvd2luZyBtb2RlXG4gICAgICogKGUuZy4gaWYgeW91J3ZlIGFscmVhZHkgY2FsbGVkIGBvbignZGF0YScpYClcbiAgICAgKlxuICAgICAqIEBwYXJhbSBzdGFydCAtIDAtYmFzZWQgb2Zmc2V0IGluIGJ5dGVzIHRvIHN0YXJ0IHN0cmVhbWluZyBmcm9tXG4gICAgICovXG4gICAgc3RhcnQoc3RhcnQgPSAwKSB7XG4gICAgICAgIHRocm93SWZJbml0aWFsaXplZCh0aGlzKTtcbiAgICAgICAgdGhpcy5zLm9wdGlvbnMuc3RhcnQgPSBzdGFydDtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNldHMgdGhlIDAtYmFzZWQgb2Zmc2V0IGluIGJ5dGVzIHRvIHN0YXJ0IHN0cmVhbWluZyBmcm9tLiBUaHJvd3NcbiAgICAgKiBhbiBlcnJvciBpZiB0aGlzIHN0cmVhbSBoYXMgZW50ZXJlZCBmbG93aW5nIG1vZGVcbiAgICAgKiAoZS5nLiBpZiB5b3UndmUgYWxyZWFkeSBjYWxsZWQgYG9uKCdkYXRhJylgKVxuICAgICAqXG4gICAgICogQHBhcmFtIGVuZCAtIE9mZnNldCBpbiBieXRlcyB0byBzdG9wIHJlYWRpbmcgYXRcbiAgICAgKi9cbiAgICBlbmQoZW5kID0gMCkge1xuICAgICAgICB0aHJvd0lmSW5pdGlhbGl6ZWQodGhpcyk7XG4gICAgICAgIHRoaXMucy5vcHRpb25zLmVuZCA9IGVuZDtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIE1hcmtzIHRoaXMgc3RyZWFtIGFzIGFib3J0ZWQgKHdpbGwgbmV2ZXIgcHVzaCBhbm90aGVyIGBkYXRhYCBldmVudClcbiAgICAgKiBhbmQga2lsbHMgdGhlIHVuZGVybHlpbmcgY3Vyc29yLiBXaWxsIGVtaXQgdGhlICdlbmQnIGV2ZW50LCBhbmQgdGhlblxuICAgICAqIHRoZSAnY2xvc2UnIGV2ZW50IG9uY2UgdGhlIGN1cnNvciBpcyBzdWNjZXNzZnVsbHkga2lsbGVkLlxuICAgICAqL1xuICAgIGFzeW5jIGFib3J0KCkge1xuICAgICAgICB0aGlzLnB1c2gobnVsbCk7XG4gICAgICAgIHRoaXMuZGVzdHJveWVkID0gdHJ1ZTtcbiAgICAgICAgaWYgKHRoaXMucy5jdXJzb3IpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5zLmN1cnNvci5jbG9zZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZmluYWxseSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lbWl0KEdyaWRGU0J1Y2tldFJlYWRTdHJlYW0uQ0xPU0UpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKCF0aGlzLnMuaW5pdCkge1xuICAgICAgICAgICAgICAgIC8vIElmIG5vdCBpbml0aWFsaXplZCwgZmlyZSBjbG9zZSBldmVudCBiZWNhdXNlIHdlIHdpbGwgbmV2ZXJcbiAgICAgICAgICAgICAgICAvLyBnZXQgYSBjdXJzb3JcbiAgICAgICAgICAgICAgICB0aGlzLmVtaXQoR3JpZEZTQnVja2V0UmVhZFN0cmVhbS5DTE9TRSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59XG4vKipcbiAqIEFuIGVycm9yIG9jY3VycmVkXG4gKiBAZXZlbnRcbiAqL1xuR3JpZEZTQnVja2V0UmVhZFN0cmVhbS5FUlJPUiA9ICdlcnJvcic7XG4vKipcbiAqIEZpcmVzIHdoZW4gdGhlIHN0cmVhbSBsb2FkZWQgdGhlIGZpbGUgZG9jdW1lbnQgY29ycmVzcG9uZGluZyB0byB0aGUgcHJvdmlkZWQgaWQuXG4gKiBAZXZlbnRcbiAqL1xuR3JpZEZTQnVja2V0UmVhZFN0cmVhbS5GSUxFID0gJ2ZpbGUnO1xuLyoqXG4gKiBFbWl0dGVkIHdoZW4gYSBjaHVuayBvZiBkYXRhIGlzIGF2YWlsYWJsZSB0byBiZSBjb25zdW1lZC5cbiAqIEBldmVudFxuICovXG5HcmlkRlNCdWNrZXRSZWFkU3RyZWFtLkRBVEEgPSAnZGF0YSc7XG4vKipcbiAqIEZpcmVkIHdoZW4gdGhlIHN0cmVhbSBpcyBleGhhdXN0ZWQgKG5vIG1vcmUgZGF0YSBldmVudHMpLlxuICogQGV2ZW50XG4gKi9cbkdyaWRGU0J1Y2tldFJlYWRTdHJlYW0uRU5EID0gJ2VuZCc7XG4vKipcbiAqIEZpcmVkIHdoZW4gdGhlIHN0cmVhbSBpcyBleGhhdXN0ZWQgYW5kIHRoZSB1bmRlcmx5aW5nIGN1cnNvciBpcyBraWxsZWRcbiAqIEBldmVudFxuICovXG5HcmlkRlNCdWNrZXRSZWFkU3RyZWFtLkNMT1NFID0gJ2Nsb3NlJztcbmV4cG9ydHMuR3JpZEZTQnVja2V0UmVhZFN0cmVhbSA9IEdyaWRGU0J1Y2tldFJlYWRTdHJlYW07XG5mdW5jdGlvbiB0aHJvd0lmSW5pdGlhbGl6ZWQoc3RyZWFtKSB7XG4gICAgaWYgKHN0cmVhbS5zLmluaXQpIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29HcmlkRlNTdHJlYW1FcnJvcignT3B0aW9ucyBjYW5ub3QgYmUgY2hhbmdlZCBhZnRlciB0aGUgc3RyZWFtIGlzIGluaXRpYWxpemVkJyk7XG4gICAgfVxufVxuZnVuY3Rpb24gZG9SZWFkKHN0cmVhbSkge1xuICAgIGlmIChzdHJlYW0uZGVzdHJveWVkKVxuICAgICAgICByZXR1cm47XG4gICAgaWYgKCFzdHJlYW0ucy5jdXJzb3IpXG4gICAgICAgIHJldHVybjtcbiAgICBpZiAoIXN0cmVhbS5zLmZpbGUpXG4gICAgICAgIHJldHVybjtcbiAgICBjb25zdCBoYW5kbGVSZWFkUmVzdWx0ID0gKHsgZXJyb3IsIGRvYyB9KSA9PiB7XG4gICAgICAgIGlmIChzdHJlYW0uZGVzdHJveWVkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgICBzdHJlYW0uZW1pdChHcmlkRlNCdWNrZXRSZWFkU3RyZWFtLkVSUk9SLCBlcnJvcik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFkb2MpIHtcbiAgICAgICAgICAgIHN0cmVhbS5wdXNoKG51bGwpO1xuICAgICAgICAgICAgc3RyZWFtLnMuY3Vyc29yPy5jbG9zZSgpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgIHN0cmVhbS5lbWl0KEdyaWRGU0J1Y2tldFJlYWRTdHJlYW0uQ0xPU0UpO1xuICAgICAgICAgICAgfSwgZXJyb3IgPT4ge1xuICAgICAgICAgICAgICAgIHN0cmVhbS5lbWl0KEdyaWRGU0J1Y2tldFJlYWRTdHJlYW0uRVJST1IsIGVycm9yKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICghc3RyZWFtLnMuZmlsZSlcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgY29uc3QgYnl0ZXNSZW1haW5pbmcgPSBzdHJlYW0ucy5maWxlLmxlbmd0aCAtIHN0cmVhbS5zLmJ5dGVzUmVhZDtcbiAgICAgICAgY29uc3QgZXhwZWN0ZWROID0gc3RyZWFtLnMuZXhwZWN0ZWQrKztcbiAgICAgICAgY29uc3QgZXhwZWN0ZWRMZW5ndGggPSBNYXRoLm1pbihzdHJlYW0ucy5maWxlLmNodW5rU2l6ZSwgYnl0ZXNSZW1haW5pbmcpO1xuICAgICAgICBpZiAoZG9jLm4gPiBleHBlY3RlZE4pIHtcbiAgICAgICAgICAgIHJldHVybiBzdHJlYW0uZW1pdChHcmlkRlNCdWNrZXRSZWFkU3RyZWFtLkVSUk9SLCBuZXcgZXJyb3JfMS5Nb25nb0dyaWRGU0NodW5rRXJyb3IoYENodW5rSXNNaXNzaW5nOiBHb3QgdW5leHBlY3RlZCBuOiAke2RvYy5ufSwgZXhwZWN0ZWQ6ICR7ZXhwZWN0ZWROfWApKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZG9jLm4gPCBleHBlY3RlZE4pIHtcbiAgICAgICAgICAgIHJldHVybiBzdHJlYW0uZW1pdChHcmlkRlNCdWNrZXRSZWFkU3RyZWFtLkVSUk9SLCBuZXcgZXJyb3JfMS5Nb25nb0dyaWRGU0NodW5rRXJyb3IoYEV4dHJhQ2h1bms6IEdvdCB1bmV4cGVjdGVkIG46ICR7ZG9jLm59LCBleHBlY3RlZDogJHtleHBlY3RlZE59YCkpO1xuICAgICAgICB9XG4gICAgICAgIGxldCBidWYgPSBCdWZmZXIuaXNCdWZmZXIoZG9jLmRhdGEpID8gZG9jLmRhdGEgOiBkb2MuZGF0YS5idWZmZXI7XG4gICAgICAgIGlmIChidWYuYnl0ZUxlbmd0aCAhPT0gZXhwZWN0ZWRMZW5ndGgpIHtcbiAgICAgICAgICAgIGlmIChieXRlc1JlbWFpbmluZyA8PSAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHN0cmVhbS5lbWl0KEdyaWRGU0J1Y2tldFJlYWRTdHJlYW0uRVJST1IsIG5ldyBlcnJvcl8xLk1vbmdvR3JpZEZTQ2h1bmtFcnJvcihgRXh0cmFDaHVuazogR290IHVuZXhwZWN0ZWQgbjogJHtkb2Mubn0sIGV4cGVjdGVkIGZpbGUgbGVuZ3RoICR7c3RyZWFtLnMuZmlsZS5sZW5ndGh9IGJ5dGVzIGJ1dCBhbHJlYWR5IHJlYWQgJHtzdHJlYW0ucy5ieXRlc1JlYWR9IGJ5dGVzYCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHN0cmVhbS5lbWl0KEdyaWRGU0J1Y2tldFJlYWRTdHJlYW0uRVJST1IsIG5ldyBlcnJvcl8xLk1vbmdvR3JpZEZTQ2h1bmtFcnJvcihgQ2h1bmtJc1dyb25nU2l6ZTogR290IHVuZXhwZWN0ZWQgbGVuZ3RoOiAke2J1Zi5ieXRlTGVuZ3RofSwgZXhwZWN0ZWQ6ICR7ZXhwZWN0ZWRMZW5ndGh9YCkpO1xuICAgICAgICB9XG4gICAgICAgIHN0cmVhbS5zLmJ5dGVzUmVhZCArPSBidWYuYnl0ZUxlbmd0aDtcbiAgICAgICAgaWYgKGJ1Zi5ieXRlTGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gc3RyZWFtLnB1c2gobnVsbCk7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHNsaWNlU3RhcnQgPSBudWxsO1xuICAgICAgICBsZXQgc2xpY2VFbmQgPSBudWxsO1xuICAgICAgICBpZiAoc3RyZWFtLnMuYnl0ZXNUb1NraXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgc2xpY2VTdGFydCA9IHN0cmVhbS5zLmJ5dGVzVG9Ta2lwO1xuICAgICAgICAgICAgc3RyZWFtLnMuYnl0ZXNUb1NraXAgPSAwO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGF0RW5kT2ZTdHJlYW0gPSBleHBlY3RlZE4gPT09IHN0cmVhbS5zLmV4cGVjdGVkRW5kIC0gMTtcbiAgICAgICAgY29uc3QgYnl0ZXNMZWZ0VG9SZWFkID0gc3RyZWFtLnMub3B0aW9ucy5lbmQgLSBzdHJlYW0ucy5ieXRlc1RvU2tpcDtcbiAgICAgICAgaWYgKGF0RW5kT2ZTdHJlYW0gJiYgc3RyZWFtLnMuYnl0ZXNUb1RyaW0gIT0gbnVsbCkge1xuICAgICAgICAgICAgc2xpY2VFbmQgPSBzdHJlYW0ucy5maWxlLmNodW5rU2l6ZSAtIHN0cmVhbS5zLmJ5dGVzVG9UcmltO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHN0cmVhbS5zLm9wdGlvbnMuZW5kICYmIGJ5dGVzTGVmdFRvUmVhZCA8IGRvYy5kYXRhLmJ5dGVMZW5ndGgpIHtcbiAgICAgICAgICAgIHNsaWNlRW5kID0gYnl0ZXNMZWZ0VG9SZWFkO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzbGljZVN0YXJ0ICE9IG51bGwgfHwgc2xpY2VFbmQgIT0gbnVsbCkge1xuICAgICAgICAgICAgYnVmID0gYnVmLnNsaWNlKHNsaWNlU3RhcnQgfHwgMCwgc2xpY2VFbmQgfHwgYnVmLmJ5dGVMZW5ndGgpO1xuICAgICAgICB9XG4gICAgICAgIHN0cmVhbS5wdXNoKGJ1Zik7XG4gICAgICAgIHJldHVybjtcbiAgICB9O1xuICAgIHN0cmVhbS5zLmN1cnNvci5uZXh0KCkudGhlbihkb2MgPT4gaGFuZGxlUmVhZFJlc3VsdCh7IGVycm9yOiBudWxsLCBkb2MgfSksIGVycm9yID0+IGhhbmRsZVJlYWRSZXN1bHQoeyBlcnJvciwgZG9jOiBudWxsIH0pKTtcbn1cbmZ1bmN0aW9uIGluaXQoc3RyZWFtKSB7XG4gICAgY29uc3QgZmluZE9uZU9wdGlvbnMgPSB7fTtcbiAgICBpZiAoc3RyZWFtLnMucmVhZFByZWZlcmVuY2UpIHtcbiAgICAgICAgZmluZE9uZU9wdGlvbnMucmVhZFByZWZlcmVuY2UgPSBzdHJlYW0ucy5yZWFkUHJlZmVyZW5jZTtcbiAgICB9XG4gICAgaWYgKHN0cmVhbS5zLm9wdGlvbnMgJiYgc3RyZWFtLnMub3B0aW9ucy5zb3J0KSB7XG4gICAgICAgIGZpbmRPbmVPcHRpb25zLnNvcnQgPSBzdHJlYW0ucy5vcHRpb25zLnNvcnQ7XG4gICAgfVxuICAgIGlmIChzdHJlYW0ucy5vcHRpb25zICYmIHN0cmVhbS5zLm9wdGlvbnMuc2tpcCkge1xuICAgICAgICBmaW5kT25lT3B0aW9ucy5za2lwID0gc3RyZWFtLnMub3B0aW9ucy5za2lwO1xuICAgIH1cbiAgICBjb25zdCBoYW5kbGVSZWFkUmVzdWx0ID0gKHsgZXJyb3IsIGRvYyB9KSA9PiB7XG4gICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgICAgcmV0dXJuIHN0cmVhbS5lbWl0KEdyaWRGU0J1Y2tldFJlYWRTdHJlYW0uRVJST1IsIGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWRvYykge1xuICAgICAgICAgICAgY29uc3QgaWRlbnRpZmllciA9IHN0cmVhbS5zLmZpbHRlci5faWRcbiAgICAgICAgICAgICAgICA/IHN0cmVhbS5zLmZpbHRlci5faWQudG9TdHJpbmcoKVxuICAgICAgICAgICAgICAgIDogc3RyZWFtLnMuZmlsdGVyLmZpbGVuYW1lO1xuICAgICAgICAgICAgY29uc3QgZXJybXNnID0gYEZpbGVOb3RGb3VuZDogZmlsZSAke2lkZW50aWZpZXJ9IHdhcyBub3QgZm91bmRgO1xuICAgICAgICAgICAgLy8gVE9ETyhOT0RFLTM0ODMpXG4gICAgICAgICAgICBjb25zdCBlcnIgPSBuZXcgZXJyb3JfMS5Nb25nb1J1bnRpbWVFcnJvcihlcnJtc2cpO1xuICAgICAgICAgICAgZXJyLmNvZGUgPSAnRU5PRU5UJzsgLy8gVE9ETzogTk9ERS0zMzM4IHNldCBwcm9wZXJ0eSBhcyBwYXJ0IG9mIGNvbnN0cnVjdG9yXG4gICAgICAgICAgICByZXR1cm4gc3RyZWFtLmVtaXQoR3JpZEZTQnVja2V0UmVhZFN0cmVhbS5FUlJPUiwgZXJyKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBJZiBkb2N1bWVudCBpcyBlbXB0eSwga2lsbCB0aGUgc3RyZWFtIGltbWVkaWF0ZWx5IGFuZCBkb24ndFxuICAgICAgICAvLyBleGVjdXRlIGFueSByZWFkc1xuICAgICAgICBpZiAoZG9jLmxlbmd0aCA8PSAwKSB7XG4gICAgICAgICAgICBzdHJlYW0ucHVzaChudWxsKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc3RyZWFtLmRlc3Ryb3llZCkge1xuICAgICAgICAgICAgLy8gSWYgdXNlciBkZXN0cm95cyB0aGUgc3RyZWFtIGJlZm9yZSB3ZSBoYXZlIGEgY3Vyc29yLCB3YWl0XG4gICAgICAgICAgICAvLyB1bnRpbCB0aGUgcXVlcnkgaXMgZG9uZSB0byBzYXkgd2UncmUgJ2Nsb3NlZCcgYmVjYXVzZSB3ZSBjYW4ndFxuICAgICAgICAgICAgLy8gY2FuY2VsIGEgcXVlcnkuXG4gICAgICAgICAgICBzdHJlYW0uZW1pdChHcmlkRlNCdWNrZXRSZWFkU3RyZWFtLkNMT1NFKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgc3RyZWFtLnMuYnl0ZXNUb1NraXAgPSBoYW5kbGVTdGFydE9wdGlvbihzdHJlYW0sIGRvYywgc3RyZWFtLnMub3B0aW9ucyk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICByZXR1cm4gc3RyZWFtLmVtaXQoR3JpZEZTQnVja2V0UmVhZFN0cmVhbS5FUlJPUiwgZXJyb3IpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGZpbHRlciA9IHsgZmlsZXNfaWQ6IGRvYy5faWQgfTtcbiAgICAgICAgLy8gQ3VycmVudGx5IChNb25nb0RCIDMuNC40KSBza2lwIGZ1bmN0aW9uIGRvZXMgbm90IHN1cHBvcnQgdGhlIGluZGV4LFxuICAgICAgICAvLyBpdCBuZWVkcyB0byByZXRyaWV2ZSBhbGwgdGhlIGRvY3VtZW50cyBmaXJzdCBhbmQgdGhlbiBza2lwIHRoZW0uIChDUy0yNTgxMSlcbiAgICAgICAgLy8gQXMgd29yayBhcm91bmQgd2UgdXNlICRndGUgb24gdGhlIFwiblwiIGZpZWxkLlxuICAgICAgICBpZiAoc3RyZWFtLnMub3B0aW9ucyAmJiBzdHJlYW0ucy5vcHRpb25zLnN0YXJ0ICE9IG51bGwpIHtcbiAgICAgICAgICAgIGNvbnN0IHNraXAgPSBNYXRoLmZsb29yKHN0cmVhbS5zLm9wdGlvbnMuc3RhcnQgLyBkb2MuY2h1bmtTaXplKTtcbiAgICAgICAgICAgIGlmIChza2lwID4gMCkge1xuICAgICAgICAgICAgICAgIGZpbHRlclsnbiddID0geyAkZ3RlOiBza2lwIH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgc3RyZWFtLnMuY3Vyc29yID0gc3RyZWFtLnMuY2h1bmtzLmZpbmQoZmlsdGVyKS5zb3J0KHsgbjogMSB9KTtcbiAgICAgICAgaWYgKHN0cmVhbS5zLnJlYWRQcmVmZXJlbmNlKSB7XG4gICAgICAgICAgICBzdHJlYW0ucy5jdXJzb3Iud2l0aFJlYWRQcmVmZXJlbmNlKHN0cmVhbS5zLnJlYWRQcmVmZXJlbmNlKTtcbiAgICAgICAgfVxuICAgICAgICBzdHJlYW0ucy5leHBlY3RlZEVuZCA9IE1hdGguY2VpbChkb2MubGVuZ3RoIC8gZG9jLmNodW5rU2l6ZSk7XG4gICAgICAgIHN0cmVhbS5zLmZpbGUgPSBkb2M7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBzdHJlYW0ucy5ieXRlc1RvVHJpbSA9IGhhbmRsZUVuZE9wdGlvbihzdHJlYW0sIGRvYywgc3RyZWFtLnMuY3Vyc29yLCBzdHJlYW0ucy5vcHRpb25zKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIHJldHVybiBzdHJlYW0uZW1pdChHcmlkRlNCdWNrZXRSZWFkU3RyZWFtLkVSUk9SLCBlcnJvcik7XG4gICAgICAgIH1cbiAgICAgICAgc3RyZWFtLmVtaXQoR3JpZEZTQnVja2V0UmVhZFN0cmVhbS5GSUxFLCBkb2MpO1xuICAgICAgICByZXR1cm47XG4gICAgfTtcbiAgICBzdHJlYW0ucy5maWxlcy5maW5kT25lKHN0cmVhbS5zLmZpbHRlciwgZmluZE9uZU9wdGlvbnMpLnRoZW4oZG9jID0+IGhhbmRsZVJlYWRSZXN1bHQoeyBlcnJvcjogbnVsbCwgZG9jIH0pLCBlcnJvciA9PiBoYW5kbGVSZWFkUmVzdWx0KHsgZXJyb3IsIGRvYzogbnVsbCB9KSk7XG59XG5mdW5jdGlvbiB3YWl0Rm9yRmlsZShzdHJlYW0sIGNhbGxiYWNrKSB7XG4gICAgaWYgKHN0cmVhbS5zLmZpbGUpIHtcbiAgICAgICAgcmV0dXJuIGNhbGxiYWNrKCk7XG4gICAgfVxuICAgIGlmICghc3RyZWFtLnMuaW5pdCkge1xuICAgICAgICBpbml0KHN0cmVhbSk7XG4gICAgICAgIHN0cmVhbS5zLmluaXQgPSB0cnVlO1xuICAgIH1cbiAgICBzdHJlYW0ub25jZSgnZmlsZScsICgpID0+IHtcbiAgICAgICAgY2FsbGJhY2soKTtcbiAgICB9KTtcbn1cbmZ1bmN0aW9uIGhhbmRsZVN0YXJ0T3B0aW9uKHN0cmVhbSwgZG9jLCBvcHRpb25zKSB7XG4gICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5zdGFydCAhPSBudWxsKSB7XG4gICAgICAgIGlmIChvcHRpb25zLnN0YXJ0ID4gZG9jLmxlbmd0aCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcihgU3RyZWFtIHN0YXJ0ICgke29wdGlvbnMuc3RhcnR9KSBtdXN0IG5vdCBiZSBtb3JlIHRoYW4gdGhlIGxlbmd0aCBvZiB0aGUgZmlsZSAoJHtkb2MubGVuZ3RofSlgKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAob3B0aW9ucy5zdGFydCA8IDApIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoYFN0cmVhbSBzdGFydCAoJHtvcHRpb25zLnN0YXJ0fSkgbXVzdCBub3QgYmUgbmVnYXRpdmVgKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAob3B0aW9ucy5lbmQgIT0gbnVsbCAmJiBvcHRpb25zLmVuZCA8IG9wdGlvbnMuc3RhcnQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoYFN0cmVhbSBzdGFydCAoJHtvcHRpb25zLnN0YXJ0fSkgbXVzdCBub3QgYmUgZ3JlYXRlciB0aGFuIHN0cmVhbSBlbmQgKCR7b3B0aW9ucy5lbmR9KWApO1xuICAgICAgICB9XG4gICAgICAgIHN0cmVhbS5zLmJ5dGVzUmVhZCA9IE1hdGguZmxvb3Iob3B0aW9ucy5zdGFydCAvIGRvYy5jaHVua1NpemUpICogZG9jLmNodW5rU2l6ZTtcbiAgICAgICAgc3RyZWFtLnMuZXhwZWN0ZWQgPSBNYXRoLmZsb29yKG9wdGlvbnMuc3RhcnQgLyBkb2MuY2h1bmtTaXplKTtcbiAgICAgICAgcmV0dXJuIG9wdGlvbnMuc3RhcnQgLSBzdHJlYW0ucy5ieXRlc1JlYWQ7XG4gICAgfVxuICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoJ1N0YXJ0IG9wdGlvbiBtdXN0IGJlIGRlZmluZWQnKTtcbn1cbmZ1bmN0aW9uIGhhbmRsZUVuZE9wdGlvbihzdHJlYW0sIGRvYywgY3Vyc29yLCBvcHRpb25zKSB7XG4gICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5lbmQgIT0gbnVsbCkge1xuICAgICAgICBpZiAob3B0aW9ucy5lbmQgPiBkb2MubGVuZ3RoKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKGBTdHJlYW0gZW5kICgke29wdGlvbnMuZW5kfSkgbXVzdCBub3QgYmUgbW9yZSB0aGFuIHRoZSBsZW5ndGggb2YgdGhlIGZpbGUgKCR7ZG9jLmxlbmd0aH0pYCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9wdGlvbnMuc3RhcnQgPT0gbnVsbCB8fCBvcHRpb25zLnN0YXJ0IDwgMCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcihgU3RyZWFtIGVuZCAoJHtvcHRpb25zLmVuZH0pIG11c3Qgbm90IGJlIG5lZ2F0aXZlYCk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgc3RhcnQgPSBvcHRpb25zLnN0YXJ0ICE9IG51bGwgPyBNYXRoLmZsb29yKG9wdGlvbnMuc3RhcnQgLyBkb2MuY2h1bmtTaXplKSA6IDA7XG4gICAgICAgIGN1cnNvci5saW1pdChNYXRoLmNlaWwob3B0aW9ucy5lbmQgLyBkb2MuY2h1bmtTaXplKSAtIHN0YXJ0KTtcbiAgICAgICAgc3RyZWFtLnMuZXhwZWN0ZWRFbmQgPSBNYXRoLmNlaWwob3B0aW9ucy5lbmQgLyBkb2MuY2h1bmtTaXplKTtcbiAgICAgICAgcmV0dXJuIE1hdGguY2VpbChvcHRpb25zLmVuZCAvIGRvYy5jaHVua1NpemUpICogZG9jLmNodW5rU2l6ZSAtIG9wdGlvbnMuZW5kO1xuICAgIH1cbiAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdFbmQgb3B0aW9uIG11c3QgYmUgZGVmaW5lZCcpO1xufVxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZG93bmxvYWQuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/gridfs/download.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/gridfs/index.js":
/*!**********************************************************!*\
  !*** ../server/node_modules/mongodb/lib/gridfs/index.js ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.GridFSBucket = void 0;\nconst error_1 = __webpack_require__(/*! ../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst mongo_types_1 = __webpack_require__(/*! ../mongo_types */ \"(api)/../server/node_modules/mongodb/lib/mongo_types.js\");\nconst write_concern_1 = __webpack_require__(/*! ../write_concern */ \"(api)/../server/node_modules/mongodb/lib/write_concern.js\");\nconst download_1 = __webpack_require__(/*! ./download */ \"(api)/../server/node_modules/mongodb/lib/gridfs/download.js\");\nconst upload_1 = __webpack_require__(/*! ./upload */ \"(api)/../server/node_modules/mongodb/lib/gridfs/upload.js\");\nconst DEFAULT_GRIDFS_BUCKET_OPTIONS = {\n    bucketName: 'fs',\n    chunkSizeBytes: 255 * 1024\n};\n/**\n * Constructor for a streaming GridFS interface\n * @public\n */\nclass GridFSBucket extends mongo_types_1.TypedEventEmitter {\n    constructor(db, options) {\n        super();\n        this.setMaxListeners(0);\n        const privateOptions = {\n            ...DEFAULT_GRIDFS_BUCKET_OPTIONS,\n            ...options,\n            writeConcern: write_concern_1.WriteConcern.fromOptions(options)\n        };\n        this.s = {\n            db,\n            options: privateOptions,\n            _chunksCollection: db.collection(privateOptions.bucketName + '.chunks'),\n            _filesCollection: db.collection(privateOptions.bucketName + '.files'),\n            checkedIndexes: false,\n            calledOpenUploadStream: false\n        };\n    }\n    /**\n     * Returns a writable stream (GridFSBucketWriteStream) for writing\n     * buffers to GridFS. The stream's 'id' property contains the resulting\n     * file's id.\n     *\n     * @param filename - The value of the 'filename' key in the files doc\n     * @param options - Optional settings.\n     */\n    openUploadStream(filename, options) {\n        return new upload_1.GridFSBucketWriteStream(this, filename, options);\n    }\n    /**\n     * Returns a writable stream (GridFSBucketWriteStream) for writing\n     * buffers to GridFS for a custom file id. The stream's 'id' property contains the resulting\n     * file's id.\n     */\n    openUploadStreamWithId(id, filename, options) {\n        return new upload_1.GridFSBucketWriteStream(this, filename, { ...options, id });\n    }\n    /** Returns a readable stream (GridFSBucketReadStream) for streaming file data from GridFS. */\n    openDownloadStream(id, options) {\n        return new download_1.GridFSBucketReadStream(this.s._chunksCollection, this.s._filesCollection, this.s.options.readPreference, { _id: id }, options);\n    }\n    /**\n     * Deletes a file with the given id\n     *\n     * @param id - The id of the file doc\n     */\n    async delete(id) {\n        const { deletedCount } = await this.s._filesCollection.deleteOne({ _id: id });\n        // Delete orphaned chunks before returning FileNotFound\n        await this.s._chunksCollection.deleteMany({ files_id: id });\n        if (deletedCount === 0) {\n            // TODO(NODE-3483): Replace with more appropriate error\n            // Consider creating new error MongoGridFSFileNotFoundError\n            throw new error_1.MongoRuntimeError(`File not found for id ${id}`);\n        }\n    }\n    /** Convenience wrapper around find on the files collection */\n    find(filter = {}, options = {}) {\n        return this.s._filesCollection.find(filter, options);\n    }\n    /**\n     * Returns a readable stream (GridFSBucketReadStream) for streaming the\n     * file with the given name from GridFS. If there are multiple files with\n     * the same name, this will stream the most recent file with the given name\n     * (as determined by the `uploadDate` field). You can set the `revision`\n     * option to change this behavior.\n     */\n    openDownloadStreamByName(filename, options) {\n        let sort = { uploadDate: -1 };\n        let skip = undefined;\n        if (options && options.revision != null) {\n            if (options.revision >= 0) {\n                sort = { uploadDate: 1 };\n                skip = options.revision;\n            }\n            else {\n                skip = -options.revision - 1;\n            }\n        }\n        return new download_1.GridFSBucketReadStream(this.s._chunksCollection, this.s._filesCollection, this.s.options.readPreference, { filename }, { ...options, sort, skip });\n    }\n    /**\n     * Renames the file with the given _id to the given string\n     *\n     * @param id - the id of the file to rename\n     * @param filename - new name for the file\n     */\n    async rename(id, filename) {\n        const filter = { _id: id };\n        const update = { $set: { filename } };\n        const { matchedCount } = await this.s._filesCollection.updateOne(filter, update);\n        if (matchedCount === 0) {\n            throw new error_1.MongoRuntimeError(`File with id ${id} not found`);\n        }\n    }\n    /** Removes this bucket's files collection, followed by its chunks collection. */\n    async drop() {\n        await this.s._filesCollection.drop();\n        await this.s._chunksCollection.drop();\n    }\n}\n/**\n * When the first call to openUploadStream is made, the upload stream will\n * check to see if it needs to create the proper indexes on the chunks and\n * files collections. This event is fired either when 1) it determines that\n * no index creation is necessary, 2) when it successfully creates the\n * necessary indexes.\n * @event\n */\nGridFSBucket.INDEX = 'index';\nexports.GridFSBucket = GridFSBucket;\n//# sourceMappingURL=index.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9ncmlkZnMvaW5kZXguanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0Qsb0JBQW9CO0FBQ3BCLGdCQUFnQixtQkFBTyxDQUFDLG1FQUFVO0FBQ2xDLHNCQUFzQixtQkFBTyxDQUFDLCtFQUFnQjtBQUM5Qyx3QkFBd0IsbUJBQU8sQ0FBQyxtRkFBa0I7QUFDbEQsbUJBQW1CLG1CQUFPLENBQUMsK0VBQVk7QUFDdkMsaUJBQWlCLG1CQUFPLENBQUMsMkVBQVU7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzRUFBc0UsZ0JBQWdCO0FBQ3RGO0FBQ0E7QUFDQTtBQUNBLHlJQUF5SSxTQUFTO0FBQ2xKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLGVBQWUsNENBQTRDLFNBQVM7QUFDcEY7QUFDQSxvREFBb0QsY0FBYztBQUNsRTtBQUNBO0FBQ0E7QUFDQSx5RUFBeUUsR0FBRztBQUM1RTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsY0FBYztBQUNsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUlBQXlJLFVBQVUsSUFBSSx3QkFBd0I7QUFDL0s7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6Qix5QkFBeUIsUUFBUTtBQUNqQyxnQkFBZ0IsZUFBZTtBQUMvQjtBQUNBLGdFQUFnRSxJQUFJO0FBQ3BFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0I7QUFDcEIiLCJzb3VyY2VzIjpbIkQ6XFxzYWxvbmlcXGFwcHJhaXNhbC1zeXN0ZW1cXHNlcnZlclxcbm9kZV9tb2R1bGVzXFxtb25nb2RiXFxsaWJcXGdyaWRmc1xcaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkdyaWRGU0J1Y2tldCA9IHZvaWQgMDtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi4vZXJyb3JcIik7XG5jb25zdCBtb25nb190eXBlc18xID0gcmVxdWlyZShcIi4uL21vbmdvX3R5cGVzXCIpO1xuY29uc3Qgd3JpdGVfY29uY2Vybl8xID0gcmVxdWlyZShcIi4uL3dyaXRlX2NvbmNlcm5cIik7XG5jb25zdCBkb3dubG9hZF8xID0gcmVxdWlyZShcIi4vZG93bmxvYWRcIik7XG5jb25zdCB1cGxvYWRfMSA9IHJlcXVpcmUoXCIuL3VwbG9hZFwiKTtcbmNvbnN0IERFRkFVTFRfR1JJREZTX0JVQ0tFVF9PUFRJT05TID0ge1xuICAgIGJ1Y2tldE5hbWU6ICdmcycsXG4gICAgY2h1bmtTaXplQnl0ZXM6IDI1NSAqIDEwMjRcbn07XG4vKipcbiAqIENvbnN0cnVjdG9yIGZvciBhIHN0cmVhbWluZyBHcmlkRlMgaW50ZXJmYWNlXG4gKiBAcHVibGljXG4gKi9cbmNsYXNzIEdyaWRGU0J1Y2tldCBleHRlbmRzIG1vbmdvX3R5cGVzXzEuVHlwZWRFdmVudEVtaXR0ZXIge1xuICAgIGNvbnN0cnVjdG9yKGRiLCBvcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMuc2V0TWF4TGlzdGVuZXJzKDApO1xuICAgICAgICBjb25zdCBwcml2YXRlT3B0aW9ucyA9IHtcbiAgICAgICAgICAgIC4uLkRFRkFVTFRfR1JJREZTX0JVQ0tFVF9PUFRJT05TLFxuICAgICAgICAgICAgLi4ub3B0aW9ucyxcbiAgICAgICAgICAgIHdyaXRlQ29uY2Vybjogd3JpdGVfY29uY2Vybl8xLldyaXRlQ29uY2Vybi5mcm9tT3B0aW9ucyhvcHRpb25zKVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLnMgPSB7XG4gICAgICAgICAgICBkYixcbiAgICAgICAgICAgIG9wdGlvbnM6IHByaXZhdGVPcHRpb25zLFxuICAgICAgICAgICAgX2NodW5rc0NvbGxlY3Rpb246IGRiLmNvbGxlY3Rpb24ocHJpdmF0ZU9wdGlvbnMuYnVja2V0TmFtZSArICcuY2h1bmtzJyksXG4gICAgICAgICAgICBfZmlsZXNDb2xsZWN0aW9uOiBkYi5jb2xsZWN0aW9uKHByaXZhdGVPcHRpb25zLmJ1Y2tldE5hbWUgKyAnLmZpbGVzJyksXG4gICAgICAgICAgICBjaGVja2VkSW5kZXhlczogZmFsc2UsXG4gICAgICAgICAgICBjYWxsZWRPcGVuVXBsb2FkU3RyZWFtOiBmYWxzZVxuICAgICAgICB9O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGEgd3JpdGFibGUgc3RyZWFtIChHcmlkRlNCdWNrZXRXcml0ZVN0cmVhbSkgZm9yIHdyaXRpbmdcbiAgICAgKiBidWZmZXJzIHRvIEdyaWRGUy4gVGhlIHN0cmVhbSdzICdpZCcgcHJvcGVydHkgY29udGFpbnMgdGhlIHJlc3VsdGluZ1xuICAgICAqIGZpbGUncyBpZC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBmaWxlbmFtZSAtIFRoZSB2YWx1ZSBvZiB0aGUgJ2ZpbGVuYW1lJyBrZXkgaW4gdGhlIGZpbGVzIGRvY1xuICAgICAqIEBwYXJhbSBvcHRpb25zIC0gT3B0aW9uYWwgc2V0dGluZ3MuXG4gICAgICovXG4gICAgb3BlblVwbG9hZFN0cmVhbShmaWxlbmFtZSwgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4gbmV3IHVwbG9hZF8xLkdyaWRGU0J1Y2tldFdyaXRlU3RyZWFtKHRoaXMsIGZpbGVuYW1lLCBvcHRpb25zKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhIHdyaXRhYmxlIHN0cmVhbSAoR3JpZEZTQnVja2V0V3JpdGVTdHJlYW0pIGZvciB3cml0aW5nXG4gICAgICogYnVmZmVycyB0byBHcmlkRlMgZm9yIGEgY3VzdG9tIGZpbGUgaWQuIFRoZSBzdHJlYW0ncyAnaWQnIHByb3BlcnR5IGNvbnRhaW5zIHRoZSByZXN1bHRpbmdcbiAgICAgKiBmaWxlJ3MgaWQuXG4gICAgICovXG4gICAgb3BlblVwbG9hZFN0cmVhbVdpdGhJZChpZCwgZmlsZW5hbWUsIG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIG5ldyB1cGxvYWRfMS5HcmlkRlNCdWNrZXRXcml0ZVN0cmVhbSh0aGlzLCBmaWxlbmFtZSwgeyAuLi5vcHRpb25zLCBpZCB9KTtcbiAgICB9XG4gICAgLyoqIFJldHVybnMgYSByZWFkYWJsZSBzdHJlYW0gKEdyaWRGU0J1Y2tldFJlYWRTdHJlYW0pIGZvciBzdHJlYW1pbmcgZmlsZSBkYXRhIGZyb20gR3JpZEZTLiAqL1xuICAgIG9wZW5Eb3dubG9hZFN0cmVhbShpZCwgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4gbmV3IGRvd25sb2FkXzEuR3JpZEZTQnVja2V0UmVhZFN0cmVhbSh0aGlzLnMuX2NodW5rc0NvbGxlY3Rpb24sIHRoaXMucy5fZmlsZXNDb2xsZWN0aW9uLCB0aGlzLnMub3B0aW9ucy5yZWFkUHJlZmVyZW5jZSwgeyBfaWQ6IGlkIH0sIG9wdGlvbnMpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBEZWxldGVzIGEgZmlsZSB3aXRoIHRoZSBnaXZlbiBpZFxuICAgICAqXG4gICAgICogQHBhcmFtIGlkIC0gVGhlIGlkIG9mIHRoZSBmaWxlIGRvY1xuICAgICAqL1xuICAgIGFzeW5jIGRlbGV0ZShpZCkge1xuICAgICAgICBjb25zdCB7IGRlbGV0ZWRDb3VudCB9ID0gYXdhaXQgdGhpcy5zLl9maWxlc0NvbGxlY3Rpb24uZGVsZXRlT25lKHsgX2lkOiBpZCB9KTtcbiAgICAgICAgLy8gRGVsZXRlIG9ycGhhbmVkIGNodW5rcyBiZWZvcmUgcmV0dXJuaW5nIEZpbGVOb3RGb3VuZFxuICAgICAgICBhd2FpdCB0aGlzLnMuX2NodW5rc0NvbGxlY3Rpb24uZGVsZXRlTWFueSh7IGZpbGVzX2lkOiBpZCB9KTtcbiAgICAgICAgaWYgKGRlbGV0ZWRDb3VudCA9PT0gMCkge1xuICAgICAgICAgICAgLy8gVE9ETyhOT0RFLTM0ODMpOiBSZXBsYWNlIHdpdGggbW9yZSBhcHByb3ByaWF0ZSBlcnJvclxuICAgICAgICAgICAgLy8gQ29uc2lkZXIgY3JlYXRpbmcgbmV3IGVycm9yIE1vbmdvR3JpZEZTRmlsZU5vdEZvdW5kRXJyb3JcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUnVudGltZUVycm9yKGBGaWxlIG5vdCBmb3VuZCBmb3IgaWQgJHtpZH1gKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKiogQ29udmVuaWVuY2Ugd3JhcHBlciBhcm91bmQgZmluZCBvbiB0aGUgZmlsZXMgY29sbGVjdGlvbiAqL1xuICAgIGZpbmQoZmlsdGVyID0ge30sIG9wdGlvbnMgPSB7fSkge1xuICAgICAgICByZXR1cm4gdGhpcy5zLl9maWxlc0NvbGxlY3Rpb24uZmluZChmaWx0ZXIsIG9wdGlvbnMpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGEgcmVhZGFibGUgc3RyZWFtIChHcmlkRlNCdWNrZXRSZWFkU3RyZWFtKSBmb3Igc3RyZWFtaW5nIHRoZVxuICAgICAqIGZpbGUgd2l0aCB0aGUgZ2l2ZW4gbmFtZSBmcm9tIEdyaWRGUy4gSWYgdGhlcmUgYXJlIG11bHRpcGxlIGZpbGVzIHdpdGhcbiAgICAgKiB0aGUgc2FtZSBuYW1lLCB0aGlzIHdpbGwgc3RyZWFtIHRoZSBtb3N0IHJlY2VudCBmaWxlIHdpdGggdGhlIGdpdmVuIG5hbWVcbiAgICAgKiAoYXMgZGV0ZXJtaW5lZCBieSB0aGUgYHVwbG9hZERhdGVgIGZpZWxkKS4gWW91IGNhbiBzZXQgdGhlIGByZXZpc2lvbmBcbiAgICAgKiBvcHRpb24gdG8gY2hhbmdlIHRoaXMgYmVoYXZpb3IuXG4gICAgICovXG4gICAgb3BlbkRvd25sb2FkU3RyZWFtQnlOYW1lKGZpbGVuYW1lLCBvcHRpb25zKSB7XG4gICAgICAgIGxldCBzb3J0ID0geyB1cGxvYWREYXRlOiAtMSB9O1xuICAgICAgICBsZXQgc2tpcCA9IHVuZGVmaW5lZDtcbiAgICAgICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5yZXZpc2lvbiAhPSBudWxsKSB7XG4gICAgICAgICAgICBpZiAob3B0aW9ucy5yZXZpc2lvbiA+PSAwKSB7XG4gICAgICAgICAgICAgICAgc29ydCA9IHsgdXBsb2FkRGF0ZTogMSB9O1xuICAgICAgICAgICAgICAgIHNraXAgPSBvcHRpb25zLnJldmlzaW9uO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgc2tpcCA9IC1vcHRpb25zLnJldmlzaW9uIC0gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3IGRvd25sb2FkXzEuR3JpZEZTQnVja2V0UmVhZFN0cmVhbSh0aGlzLnMuX2NodW5rc0NvbGxlY3Rpb24sIHRoaXMucy5fZmlsZXNDb2xsZWN0aW9uLCB0aGlzLnMub3B0aW9ucy5yZWFkUHJlZmVyZW5jZSwgeyBmaWxlbmFtZSB9LCB7IC4uLm9wdGlvbnMsIHNvcnQsIHNraXAgfSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJlbmFtZXMgdGhlIGZpbGUgd2l0aCB0aGUgZ2l2ZW4gX2lkIHRvIHRoZSBnaXZlbiBzdHJpbmdcbiAgICAgKlxuICAgICAqIEBwYXJhbSBpZCAtIHRoZSBpZCBvZiB0aGUgZmlsZSB0byByZW5hbWVcbiAgICAgKiBAcGFyYW0gZmlsZW5hbWUgLSBuZXcgbmFtZSBmb3IgdGhlIGZpbGVcbiAgICAgKi9cbiAgICBhc3luYyByZW5hbWUoaWQsIGZpbGVuYW1lKSB7XG4gICAgICAgIGNvbnN0IGZpbHRlciA9IHsgX2lkOiBpZCB9O1xuICAgICAgICBjb25zdCB1cGRhdGUgPSB7ICRzZXQ6IHsgZmlsZW5hbWUgfSB9O1xuICAgICAgICBjb25zdCB7IG1hdGNoZWRDb3VudCB9ID0gYXdhaXQgdGhpcy5zLl9maWxlc0NvbGxlY3Rpb24udXBkYXRlT25lKGZpbHRlciwgdXBkYXRlKTtcbiAgICAgICAgaWYgKG1hdGNoZWRDb3VudCA9PT0gMCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29SdW50aW1lRXJyb3IoYEZpbGUgd2l0aCBpZCAke2lkfSBub3QgZm91bmRgKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKiogUmVtb3ZlcyB0aGlzIGJ1Y2tldCdzIGZpbGVzIGNvbGxlY3Rpb24sIGZvbGxvd2VkIGJ5IGl0cyBjaHVua3MgY29sbGVjdGlvbi4gKi9cbiAgICBhc3luYyBkcm9wKCkge1xuICAgICAgICBhd2FpdCB0aGlzLnMuX2ZpbGVzQ29sbGVjdGlvbi5kcm9wKCk7XG4gICAgICAgIGF3YWl0IHRoaXMucy5fY2h1bmtzQ29sbGVjdGlvbi5kcm9wKCk7XG4gICAgfVxufVxuLyoqXG4gKiBXaGVuIHRoZSBmaXJzdCBjYWxsIHRvIG9wZW5VcGxvYWRTdHJlYW0gaXMgbWFkZSwgdGhlIHVwbG9hZCBzdHJlYW0gd2lsbFxuICogY2hlY2sgdG8gc2VlIGlmIGl0IG5lZWRzIHRvIGNyZWF0ZSB0aGUgcHJvcGVyIGluZGV4ZXMgb24gdGhlIGNodW5rcyBhbmRcbiAqIGZpbGVzIGNvbGxlY3Rpb25zLiBUaGlzIGV2ZW50IGlzIGZpcmVkIGVpdGhlciB3aGVuIDEpIGl0IGRldGVybWluZXMgdGhhdFxuICogbm8gaW5kZXggY3JlYXRpb24gaXMgbmVjZXNzYXJ5LCAyKSB3aGVuIGl0IHN1Y2Nlc3NmdWxseSBjcmVhdGVzIHRoZVxuICogbmVjZXNzYXJ5IGluZGV4ZXMuXG4gKiBAZXZlbnRcbiAqL1xuR3JpZEZTQnVja2V0LklOREVYID0gJ2luZGV4JztcbmV4cG9ydHMuR3JpZEZTQnVja2V0ID0gR3JpZEZTQnVja2V0O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/gridfs/index.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/gridfs/upload.js":
/*!***********************************************************!*\
  !*** ../server/node_modules/mongodb/lib/gridfs/upload.js ***!
  \***********************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.GridFSBucketWriteStream = void 0;\nconst stream_1 = __webpack_require__(/*! stream */ \"stream\");\nconst bson_1 = __webpack_require__(/*! ../bson */ \"(api)/../server/node_modules/mongodb/lib/bson.js\");\nconst error_1 = __webpack_require__(/*! ../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst write_concern_1 = __webpack_require__(/*! ./../write_concern */ \"(api)/../server/node_modules/mongodb/lib/write_concern.js\");\n/**\n * A writable stream that enables you to write buffers to GridFS.\n *\n * Do not instantiate this class directly. Use `openUploadStream()` instead.\n * @public\n */\nclass GridFSBucketWriteStream extends stream_1.Writable {\n    /**\n     * @param bucket - Handle for this stream's corresponding bucket\n     * @param filename - The value of the 'filename' key in the files doc\n     * @param options - Optional settings.\n     * @internal\n     */\n    constructor(bucket, filename, options) {\n        super();\n        options = options ?? {};\n        this.bucket = bucket;\n        this.chunks = bucket.s._chunksCollection;\n        this.filename = filename;\n        this.files = bucket.s._filesCollection;\n        this.options = options;\n        this.writeConcern = write_concern_1.WriteConcern.fromOptions(options) || bucket.s.options.writeConcern;\n        // Signals the write is all done\n        this.done = false;\n        this.id = options.id ? options.id : new bson_1.ObjectId();\n        // properly inherit the default chunksize from parent\n        this.chunkSizeBytes = options.chunkSizeBytes || this.bucket.s.options.chunkSizeBytes;\n        this.bufToStore = Buffer.alloc(this.chunkSizeBytes);\n        this.length = 0;\n        this.n = 0;\n        this.pos = 0;\n        this.state = {\n            streamEnd: false,\n            outstandingRequests: 0,\n            errored: false,\n            aborted: false\n        };\n        if (!this.bucket.s.calledOpenUploadStream) {\n            this.bucket.s.calledOpenUploadStream = true;\n            checkIndexes(this).then(() => {\n                this.bucket.s.checkedIndexes = true;\n                this.bucket.emit('index');\n            }, () => null);\n        }\n    }\n    write(chunk, encodingOrCallback, callback) {\n        const encoding = typeof encodingOrCallback === 'function' ? undefined : encodingOrCallback;\n        callback = typeof encodingOrCallback === 'function' ? encodingOrCallback : callback;\n        return waitForIndexes(this, () => doWrite(this, chunk, encoding, callback));\n    }\n    /**\n     * Places this write stream into an aborted state (all future writes fail)\n     * and deletes all chunks that have already been written.\n     */\n    async abort() {\n        if (this.state.streamEnd) {\n            // TODO(NODE-3485): Replace with MongoGridFSStreamClosed\n            throw new error_1.MongoAPIError('Cannot abort a stream that has already completed');\n        }\n        if (this.state.aborted) {\n            // TODO(NODE-3485): Replace with MongoGridFSStreamClosed\n            throw new error_1.MongoAPIError('Cannot call abort() on a stream twice');\n        }\n        this.state.aborted = true;\n        await this.chunks.deleteMany({ files_id: this.id });\n    }\n    end(chunkOrCallback, encodingOrCallback, callback) {\n        const chunk = typeof chunkOrCallback === 'function' ? undefined : chunkOrCallback;\n        const encoding = typeof encodingOrCallback === 'function' ? undefined : encodingOrCallback;\n        callback =\n            typeof chunkOrCallback === 'function'\n                ? chunkOrCallback\n                : typeof encodingOrCallback === 'function'\n                    ? encodingOrCallback\n                    : callback;\n        if (this.state.streamEnd || checkAborted(this, callback))\n            return this;\n        this.state.streamEnd = true;\n        if (callback) {\n            this.once(GridFSBucketWriteStream.FINISH, (result) => {\n                if (callback)\n                    callback(undefined, result);\n            });\n        }\n        if (!chunk) {\n            waitForIndexes(this, () => !!writeRemnant(this));\n            return this;\n        }\n        this.write(chunk, encoding, () => {\n            writeRemnant(this);\n        });\n        return this;\n    }\n}\n/** @event */\nGridFSBucketWriteStream.CLOSE = 'close';\n/** @event */\nGridFSBucketWriteStream.ERROR = 'error';\n/**\n * `end()` was called and the write stream successfully wrote the file metadata and all the chunks to MongoDB.\n * @event\n */\nGridFSBucketWriteStream.FINISH = 'finish';\nexports.GridFSBucketWriteStream = GridFSBucketWriteStream;\nfunction __handleError(stream, error, callback) {\n    if (stream.state.errored) {\n        return;\n    }\n    stream.state.errored = true;\n    if (callback) {\n        return callback(error);\n    }\n    stream.emit(GridFSBucketWriteStream.ERROR, error);\n}\nfunction createChunkDoc(filesId, n, data) {\n    return {\n        _id: new bson_1.ObjectId(),\n        files_id: filesId,\n        n,\n        data\n    };\n}\nasync function checkChunksIndex(stream) {\n    const index = { files_id: 1, n: 1 };\n    let indexes;\n    try {\n        indexes = await stream.chunks.listIndexes().toArray();\n    }\n    catch (error) {\n        if (error instanceof error_1.MongoError && error.code === error_1.MONGODB_ERROR_CODES.NamespaceNotFound) {\n            indexes = [];\n        }\n        else {\n            throw error;\n        }\n    }\n    const hasChunksIndex = !!indexes.find(index => {\n        const keys = Object.keys(index.key);\n        if (keys.length === 2 && index.key.files_id === 1 && index.key.n === 1) {\n            return true;\n        }\n        return false;\n    });\n    if (!hasChunksIndex) {\n        await stream.chunks.createIndex(index, {\n            ...stream.writeConcern,\n            background: true,\n            unique: true\n        });\n    }\n}\nfunction checkDone(stream, callback) {\n    if (stream.done)\n        return true;\n    if (stream.state.streamEnd && stream.state.outstandingRequests === 0 && !stream.state.errored) {\n        // Set done so we do not trigger duplicate createFilesDoc\n        stream.done = true;\n        // Create a new files doc\n        const filesDoc = createFilesDoc(stream.id, stream.length, stream.chunkSizeBytes, stream.filename, stream.options.contentType, stream.options.aliases, stream.options.metadata);\n        if (checkAborted(stream, callback)) {\n            return false;\n        }\n        stream.files.insertOne(filesDoc, { writeConcern: stream.writeConcern }).then(() => {\n            stream.emit(GridFSBucketWriteStream.FINISH, filesDoc);\n            stream.emit(GridFSBucketWriteStream.CLOSE);\n        }, error => {\n            return __handleError(stream, error, callback);\n        });\n        return true;\n    }\n    return false;\n}\nasync function checkIndexes(stream) {\n    const doc = await stream.files.findOne({}, { projection: { _id: 1 } });\n    if (doc != null) {\n        // If at least one document exists assume the collection has the required index\n        return;\n    }\n    const index = { filename: 1, uploadDate: 1 };\n    let indexes;\n    try {\n        indexes = await stream.files.listIndexes().toArray();\n    }\n    catch (error) {\n        if (error instanceof error_1.MongoError && error.code === error_1.MONGODB_ERROR_CODES.NamespaceNotFound) {\n            indexes = [];\n        }\n        else {\n            throw error;\n        }\n    }\n    const hasFileIndex = !!indexes.find(index => {\n        const keys = Object.keys(index.key);\n        if (keys.length === 2 && index.key.filename === 1 && index.key.uploadDate === 1) {\n            return true;\n        }\n        return false;\n    });\n    if (!hasFileIndex) {\n        await stream.files.createIndex(index, { background: false });\n    }\n    await checkChunksIndex(stream);\n}\nfunction createFilesDoc(_id, length, chunkSize, filename, contentType, aliases, metadata) {\n    const ret = {\n        _id,\n        length,\n        chunkSize,\n        uploadDate: new Date(),\n        filename\n    };\n    if (contentType) {\n        ret.contentType = contentType;\n    }\n    if (aliases) {\n        ret.aliases = aliases;\n    }\n    if (metadata) {\n        ret.metadata = metadata;\n    }\n    return ret;\n}\nfunction doWrite(stream, chunk, encoding, callback) {\n    if (checkAborted(stream, callback)) {\n        return false;\n    }\n    const inputBuf = Buffer.isBuffer(chunk) ? chunk : Buffer.from(chunk, encoding);\n    stream.length += inputBuf.length;\n    // Input is small enough to fit in our buffer\n    if (stream.pos + inputBuf.length < stream.chunkSizeBytes) {\n        inputBuf.copy(stream.bufToStore, stream.pos);\n        stream.pos += inputBuf.length;\n        callback && callback();\n        // Note that we reverse the typical semantics of write's return value\n        // to be compatible with node's `.pipe()` function.\n        // True means client can keep writing.\n        return true;\n    }\n    // Otherwise, buffer is too big for current chunk, so we need to flush\n    // to MongoDB.\n    let inputBufRemaining = inputBuf.length;\n    let spaceRemaining = stream.chunkSizeBytes - stream.pos;\n    let numToCopy = Math.min(spaceRemaining, inputBuf.length);\n    let outstandingRequests = 0;\n    while (inputBufRemaining > 0) {\n        const inputBufPos = inputBuf.length - inputBufRemaining;\n        inputBuf.copy(stream.bufToStore, stream.pos, inputBufPos, inputBufPos + numToCopy);\n        stream.pos += numToCopy;\n        spaceRemaining -= numToCopy;\n        let doc;\n        if (spaceRemaining === 0) {\n            doc = createChunkDoc(stream.id, stream.n, Buffer.from(stream.bufToStore));\n            ++stream.state.outstandingRequests;\n            ++outstandingRequests;\n            if (checkAborted(stream, callback)) {\n                return false;\n            }\n            stream.chunks.insertOne(doc, { writeConcern: stream.writeConcern }).then(() => {\n                --stream.state.outstandingRequests;\n                --outstandingRequests;\n                if (!outstandingRequests) {\n                    stream.emit('drain', doc);\n                    callback && callback();\n                    checkDone(stream);\n                }\n            }, error => {\n                return __handleError(stream, error);\n            });\n            spaceRemaining = stream.chunkSizeBytes;\n            stream.pos = 0;\n            ++stream.n;\n        }\n        inputBufRemaining -= numToCopy;\n        numToCopy = Math.min(spaceRemaining, inputBufRemaining);\n    }\n    // Note that we reverse the typical semantics of write's return value\n    // to be compatible with node's `.pipe()` function.\n    // False means the client should wait for the 'drain' event.\n    return false;\n}\nfunction waitForIndexes(stream, callback) {\n    if (stream.bucket.s.checkedIndexes) {\n        return callback(false);\n    }\n    stream.bucket.once('index', () => {\n        callback(true);\n    });\n    return true;\n}\nfunction writeRemnant(stream, callback) {\n    // Buffer is empty, so don't bother to insert\n    if (stream.pos === 0) {\n        return checkDone(stream, callback);\n    }\n    ++stream.state.outstandingRequests;\n    // Create a new buffer to make sure the buffer isn't bigger than it needs\n    // to be.\n    const remnant = Buffer.alloc(stream.pos);\n    stream.bufToStore.copy(remnant, 0, 0, stream.pos);\n    const doc = createChunkDoc(stream.id, stream.n, remnant);\n    // If the stream was aborted, do not write remnant\n    if (checkAborted(stream, callback)) {\n        return false;\n    }\n    stream.chunks.insertOne(doc, { writeConcern: stream.writeConcern }).then(() => {\n        --stream.state.outstandingRequests;\n        checkDone(stream);\n    }, error => {\n        return __handleError(stream, error);\n    });\n    return true;\n}\nfunction checkAborted(stream, callback) {\n    if (stream.state.aborted) {\n        if (typeof callback === 'function') {\n            // TODO(NODE-3485): Replace with MongoGridFSStreamClosedError\n            callback(new error_1.MongoAPIError('Stream has been aborted'));\n        }\n        return true;\n    }\n    return false;\n}\n//# sourceMappingURL=upload.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9ncmlkZnMvdXBsb2FkLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELCtCQUErQjtBQUMvQixpQkFBaUIsbUJBQU8sQ0FBQyxzQkFBUTtBQUNqQyxlQUFlLG1CQUFPLENBQUMsaUVBQVM7QUFDaEMsZ0JBQWdCLG1CQUFPLENBQUMsbUVBQVU7QUFDbEMsd0JBQXdCLG1CQUFPLENBQUMscUZBQW9CO0FBQ3BEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1Q0FBdUMsbUJBQW1CO0FBQzFEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0JBQStCO0FBQy9CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CO0FBQ3BCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkNBQTJDLG1DQUFtQztBQUM5RTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2Q0FBNkMsSUFBSSxjQUFjLFVBQVU7QUFDekU7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0I7QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsZ0RBQWdELG1CQUFtQjtBQUNuRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQ0FBMkMsbUNBQW1DO0FBQzlFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUNBQW1DLG1DQUFtQztBQUN0RTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJEOlxcc2Fsb25pXFxhcHByYWlzYWwtc3lzdGVtXFxzZXJ2ZXJcXG5vZGVfbW9kdWxlc1xcbW9uZ29kYlxcbGliXFxncmlkZnNcXHVwbG9hZC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuR3JpZEZTQnVja2V0V3JpdGVTdHJlYW0gPSB2b2lkIDA7XG5jb25zdCBzdHJlYW1fMSA9IHJlcXVpcmUoXCJzdHJlYW1cIik7XG5jb25zdCBic29uXzEgPSByZXF1aXJlKFwiLi4vYnNvblwiKTtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi4vZXJyb3JcIik7XG5jb25zdCB3cml0ZV9jb25jZXJuXzEgPSByZXF1aXJlKFwiLi8uLi93cml0ZV9jb25jZXJuXCIpO1xuLyoqXG4gKiBBIHdyaXRhYmxlIHN0cmVhbSB0aGF0IGVuYWJsZXMgeW91IHRvIHdyaXRlIGJ1ZmZlcnMgdG8gR3JpZEZTLlxuICpcbiAqIERvIG5vdCBpbnN0YW50aWF0ZSB0aGlzIGNsYXNzIGRpcmVjdGx5LiBVc2UgYG9wZW5VcGxvYWRTdHJlYW0oKWAgaW5zdGVhZC5cbiAqIEBwdWJsaWNcbiAqL1xuY2xhc3MgR3JpZEZTQnVja2V0V3JpdGVTdHJlYW0gZXh0ZW5kcyBzdHJlYW1fMS5Xcml0YWJsZSB7XG4gICAgLyoqXG4gICAgICogQHBhcmFtIGJ1Y2tldCAtIEhhbmRsZSBmb3IgdGhpcyBzdHJlYW0ncyBjb3JyZXNwb25kaW5nIGJ1Y2tldFxuICAgICAqIEBwYXJhbSBmaWxlbmFtZSAtIFRoZSB2YWx1ZSBvZiB0aGUgJ2ZpbGVuYW1lJyBrZXkgaW4gdGhlIGZpbGVzIGRvY1xuICAgICAqIEBwYXJhbSBvcHRpb25zIC0gT3B0aW9uYWwgc2V0dGluZ3MuXG4gICAgICogQGludGVybmFsXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoYnVja2V0LCBmaWxlbmFtZSwgb3B0aW9ucykge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICBvcHRpb25zID0gb3B0aW9ucyA/PyB7fTtcbiAgICAgICAgdGhpcy5idWNrZXQgPSBidWNrZXQ7XG4gICAgICAgIHRoaXMuY2h1bmtzID0gYnVja2V0LnMuX2NodW5rc0NvbGxlY3Rpb247XG4gICAgICAgIHRoaXMuZmlsZW5hbWUgPSBmaWxlbmFtZTtcbiAgICAgICAgdGhpcy5maWxlcyA9IGJ1Y2tldC5zLl9maWxlc0NvbGxlY3Rpb247XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XG4gICAgICAgIHRoaXMud3JpdGVDb25jZXJuID0gd3JpdGVfY29uY2Vybl8xLldyaXRlQ29uY2Vybi5mcm9tT3B0aW9ucyhvcHRpb25zKSB8fCBidWNrZXQucy5vcHRpb25zLndyaXRlQ29uY2VybjtcbiAgICAgICAgLy8gU2lnbmFscyB0aGUgd3JpdGUgaXMgYWxsIGRvbmVcbiAgICAgICAgdGhpcy5kb25lID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaWQgPSBvcHRpb25zLmlkID8gb3B0aW9ucy5pZCA6IG5ldyBic29uXzEuT2JqZWN0SWQoKTtcbiAgICAgICAgLy8gcHJvcGVybHkgaW5oZXJpdCB0aGUgZGVmYXVsdCBjaHVua3NpemUgZnJvbSBwYXJlbnRcbiAgICAgICAgdGhpcy5jaHVua1NpemVCeXRlcyA9IG9wdGlvbnMuY2h1bmtTaXplQnl0ZXMgfHwgdGhpcy5idWNrZXQucy5vcHRpb25zLmNodW5rU2l6ZUJ5dGVzO1xuICAgICAgICB0aGlzLmJ1ZlRvU3RvcmUgPSBCdWZmZXIuYWxsb2ModGhpcy5jaHVua1NpemVCeXRlcyk7XG4gICAgICAgIHRoaXMubGVuZ3RoID0gMDtcbiAgICAgICAgdGhpcy5uID0gMDtcbiAgICAgICAgdGhpcy5wb3MgPSAwO1xuICAgICAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgICAgICAgc3RyZWFtRW5kOiBmYWxzZSxcbiAgICAgICAgICAgIG91dHN0YW5kaW5nUmVxdWVzdHM6IDAsXG4gICAgICAgICAgICBlcnJvcmVkOiBmYWxzZSxcbiAgICAgICAgICAgIGFib3J0ZWQ6IGZhbHNlXG4gICAgICAgIH07XG4gICAgICAgIGlmICghdGhpcy5idWNrZXQucy5jYWxsZWRPcGVuVXBsb2FkU3RyZWFtKSB7XG4gICAgICAgICAgICB0aGlzLmJ1Y2tldC5zLmNhbGxlZE9wZW5VcGxvYWRTdHJlYW0gPSB0cnVlO1xuICAgICAgICAgICAgY2hlY2tJbmRleGVzKHRoaXMpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYnVja2V0LnMuY2hlY2tlZEluZGV4ZXMgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMuYnVja2V0LmVtaXQoJ2luZGV4Jyk7XG4gICAgICAgICAgICB9LCAoKSA9PiBudWxsKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICB3cml0ZShjaHVuaywgZW5jb2RpbmdPckNhbGxiYWNrLCBjYWxsYmFjaykge1xuICAgICAgICBjb25zdCBlbmNvZGluZyA9IHR5cGVvZiBlbmNvZGluZ09yQ2FsbGJhY2sgPT09ICdmdW5jdGlvbicgPyB1bmRlZmluZWQgOiBlbmNvZGluZ09yQ2FsbGJhY2s7XG4gICAgICAgIGNhbGxiYWNrID0gdHlwZW9mIGVuY29kaW5nT3JDYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJyA/IGVuY29kaW5nT3JDYWxsYmFjayA6IGNhbGxiYWNrO1xuICAgICAgICByZXR1cm4gd2FpdEZvckluZGV4ZXModGhpcywgKCkgPT4gZG9Xcml0ZSh0aGlzLCBjaHVuaywgZW5jb2RpbmcsIGNhbGxiYWNrKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFBsYWNlcyB0aGlzIHdyaXRlIHN0cmVhbSBpbnRvIGFuIGFib3J0ZWQgc3RhdGUgKGFsbCBmdXR1cmUgd3JpdGVzIGZhaWwpXG4gICAgICogYW5kIGRlbGV0ZXMgYWxsIGNodW5rcyB0aGF0IGhhdmUgYWxyZWFkeSBiZWVuIHdyaXR0ZW4uXG4gICAgICovXG4gICAgYXN5bmMgYWJvcnQoKSB7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLnN0cmVhbUVuZCkge1xuICAgICAgICAgICAgLy8gVE9ETyhOT0RFLTM0ODUpOiBSZXBsYWNlIHdpdGggTW9uZ29HcmlkRlNTdHJlYW1DbG9zZWRcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvQVBJRXJyb3IoJ0Nhbm5vdCBhYm9ydCBhIHN0cmVhbSB0aGF0IGhhcyBhbHJlYWR5IGNvbXBsZXRlZCcpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLmFib3J0ZWQpIHtcbiAgICAgICAgICAgIC8vIFRPRE8oTk9ERS0zNDg1KTogUmVwbGFjZSB3aXRoIE1vbmdvR3JpZEZTU3RyZWFtQ2xvc2VkXG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0FQSUVycm9yKCdDYW5ub3QgY2FsbCBhYm9ydCgpIG9uIGEgc3RyZWFtIHR3aWNlJyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zdGF0ZS5hYm9ydGVkID0gdHJ1ZTtcbiAgICAgICAgYXdhaXQgdGhpcy5jaHVua3MuZGVsZXRlTWFueSh7IGZpbGVzX2lkOiB0aGlzLmlkIH0pO1xuICAgIH1cbiAgICBlbmQoY2h1bmtPckNhbGxiYWNrLCBlbmNvZGluZ09yQ2FsbGJhY2ssIGNhbGxiYWNrKSB7XG4gICAgICAgIGNvbnN0IGNodW5rID0gdHlwZW9mIGNodW5rT3JDYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJyA/IHVuZGVmaW5lZCA6IGNodW5rT3JDYWxsYmFjaztcbiAgICAgICAgY29uc3QgZW5jb2RpbmcgPSB0eXBlb2YgZW5jb2RpbmdPckNhbGxiYWNrID09PSAnZnVuY3Rpb24nID8gdW5kZWZpbmVkIDogZW5jb2RpbmdPckNhbGxiYWNrO1xuICAgICAgICBjYWxsYmFjayA9XG4gICAgICAgICAgICB0eXBlb2YgY2h1bmtPckNhbGxiYWNrID09PSAnZnVuY3Rpb24nXG4gICAgICAgICAgICAgICAgPyBjaHVua09yQ2FsbGJhY2tcbiAgICAgICAgICAgICAgICA6IHR5cGVvZiBlbmNvZGluZ09yQ2FsbGJhY2sgPT09ICdmdW5jdGlvbidcbiAgICAgICAgICAgICAgICAgICAgPyBlbmNvZGluZ09yQ2FsbGJhY2tcbiAgICAgICAgICAgICAgICAgICAgOiBjYWxsYmFjaztcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUuc3RyZWFtRW5kIHx8IGNoZWNrQWJvcnRlZCh0aGlzLCBjYWxsYmFjaykpXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgdGhpcy5zdGF0ZS5zdHJlYW1FbmQgPSB0cnVlO1xuICAgICAgICBpZiAoY2FsbGJhY2spIHtcbiAgICAgICAgICAgIHRoaXMub25jZShHcmlkRlNCdWNrZXRXcml0ZVN0cmVhbS5GSU5JU0gsIChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2spXG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwgcmVzdWx0KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmICghY2h1bmspIHtcbiAgICAgICAgICAgIHdhaXRGb3JJbmRleGVzKHRoaXMsICgpID0+ICEhd3JpdGVSZW1uYW50KHRoaXMpKTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMud3JpdGUoY2h1bmssIGVuY29kaW5nLCAoKSA9PiB7XG4gICAgICAgICAgICB3cml0ZVJlbW5hbnQodGhpcyk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG59XG4vKiogQGV2ZW50ICovXG5HcmlkRlNCdWNrZXRXcml0ZVN0cmVhbS5DTE9TRSA9ICdjbG9zZSc7XG4vKiogQGV2ZW50ICovXG5HcmlkRlNCdWNrZXRXcml0ZVN0cmVhbS5FUlJPUiA9ICdlcnJvcic7XG4vKipcbiAqIGBlbmQoKWAgd2FzIGNhbGxlZCBhbmQgdGhlIHdyaXRlIHN0cmVhbSBzdWNjZXNzZnVsbHkgd3JvdGUgdGhlIGZpbGUgbWV0YWRhdGEgYW5kIGFsbCB0aGUgY2h1bmtzIHRvIE1vbmdvREIuXG4gKiBAZXZlbnRcbiAqL1xuR3JpZEZTQnVja2V0V3JpdGVTdHJlYW0uRklOSVNIID0gJ2ZpbmlzaCc7XG5leHBvcnRzLkdyaWRGU0J1Y2tldFdyaXRlU3RyZWFtID0gR3JpZEZTQnVja2V0V3JpdGVTdHJlYW07XG5mdW5jdGlvbiBfX2hhbmRsZUVycm9yKHN0cmVhbSwgZXJyb3IsIGNhbGxiYWNrKSB7XG4gICAgaWYgKHN0cmVhbS5zdGF0ZS5lcnJvcmVkKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgc3RyZWFtLnN0YXRlLmVycm9yZWQgPSB0cnVlO1xuICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICByZXR1cm4gY2FsbGJhY2soZXJyb3IpO1xuICAgIH1cbiAgICBzdHJlYW0uZW1pdChHcmlkRlNCdWNrZXRXcml0ZVN0cmVhbS5FUlJPUiwgZXJyb3IpO1xufVxuZnVuY3Rpb24gY3JlYXRlQ2h1bmtEb2MoZmlsZXNJZCwgbiwgZGF0YSkge1xuICAgIHJldHVybiB7XG4gICAgICAgIF9pZDogbmV3IGJzb25fMS5PYmplY3RJZCgpLFxuICAgICAgICBmaWxlc19pZDogZmlsZXNJZCxcbiAgICAgICAgbixcbiAgICAgICAgZGF0YVxuICAgIH07XG59XG5hc3luYyBmdW5jdGlvbiBjaGVja0NodW5rc0luZGV4KHN0cmVhbSkge1xuICAgIGNvbnN0IGluZGV4ID0geyBmaWxlc19pZDogMSwgbjogMSB9O1xuICAgIGxldCBpbmRleGVzO1xuICAgIHRyeSB7XG4gICAgICAgIGluZGV4ZXMgPSBhd2FpdCBzdHJlYW0uY2h1bmtzLmxpc3RJbmRleGVzKCkudG9BcnJheSgpO1xuICAgIH1cbiAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgZXJyb3JfMS5Nb25nb0Vycm9yICYmIGVycm9yLmNvZGUgPT09IGVycm9yXzEuTU9OR09EQl9FUlJPUl9DT0RFUy5OYW1lc3BhY2VOb3RGb3VuZCkge1xuICAgICAgICAgICAgaW5kZXhlcyA9IFtdO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29uc3QgaGFzQ2h1bmtzSW5kZXggPSAhIWluZGV4ZXMuZmluZChpbmRleCA9PiB7XG4gICAgICAgIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyhpbmRleC5rZXkpO1xuICAgICAgICBpZiAoa2V5cy5sZW5ndGggPT09IDIgJiYgaW5kZXgua2V5LmZpbGVzX2lkID09PSAxICYmIGluZGV4LmtleS5uID09PSAxKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSk7XG4gICAgaWYgKCFoYXNDaHVua3NJbmRleCkge1xuICAgICAgICBhd2FpdCBzdHJlYW0uY2h1bmtzLmNyZWF0ZUluZGV4KGluZGV4LCB7XG4gICAgICAgICAgICAuLi5zdHJlYW0ud3JpdGVDb25jZXJuLFxuICAgICAgICAgICAgYmFja2dyb3VuZDogdHJ1ZSxcbiAgICAgICAgICAgIHVuaXF1ZTogdHJ1ZVxuICAgICAgICB9KTtcbiAgICB9XG59XG5mdW5jdGlvbiBjaGVja0RvbmUoc3RyZWFtLCBjYWxsYmFjaykge1xuICAgIGlmIChzdHJlYW0uZG9uZSlcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgaWYgKHN0cmVhbS5zdGF0ZS5zdHJlYW1FbmQgJiYgc3RyZWFtLnN0YXRlLm91dHN0YW5kaW5nUmVxdWVzdHMgPT09IDAgJiYgIXN0cmVhbS5zdGF0ZS5lcnJvcmVkKSB7XG4gICAgICAgIC8vIFNldCBkb25lIHNvIHdlIGRvIG5vdCB0cmlnZ2VyIGR1cGxpY2F0ZSBjcmVhdGVGaWxlc0RvY1xuICAgICAgICBzdHJlYW0uZG9uZSA9IHRydWU7XG4gICAgICAgIC8vIENyZWF0ZSBhIG5ldyBmaWxlcyBkb2NcbiAgICAgICAgY29uc3QgZmlsZXNEb2MgPSBjcmVhdGVGaWxlc0RvYyhzdHJlYW0uaWQsIHN0cmVhbS5sZW5ndGgsIHN0cmVhbS5jaHVua1NpemVCeXRlcywgc3RyZWFtLmZpbGVuYW1lLCBzdHJlYW0ub3B0aW9ucy5jb250ZW50VHlwZSwgc3RyZWFtLm9wdGlvbnMuYWxpYXNlcywgc3RyZWFtLm9wdGlvbnMubWV0YWRhdGEpO1xuICAgICAgICBpZiAoY2hlY2tBYm9ydGVkKHN0cmVhbSwgY2FsbGJhY2spKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgc3RyZWFtLmZpbGVzLmluc2VydE9uZShmaWxlc0RvYywgeyB3cml0ZUNvbmNlcm46IHN0cmVhbS53cml0ZUNvbmNlcm4gfSkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICBzdHJlYW0uZW1pdChHcmlkRlNCdWNrZXRXcml0ZVN0cmVhbS5GSU5JU0gsIGZpbGVzRG9jKTtcbiAgICAgICAgICAgIHN0cmVhbS5lbWl0KEdyaWRGU0J1Y2tldFdyaXRlU3RyZWFtLkNMT1NFKTtcbiAgICAgICAgfSwgZXJyb3IgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIF9faGFuZGxlRXJyb3Ioc3RyZWFtLCBlcnJvciwgY2FsbGJhY2spO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGNoZWNrSW5kZXhlcyhzdHJlYW0pIHtcbiAgICBjb25zdCBkb2MgPSBhd2FpdCBzdHJlYW0uZmlsZXMuZmluZE9uZSh7fSwgeyBwcm9qZWN0aW9uOiB7IF9pZDogMSB9IH0pO1xuICAgIGlmIChkb2MgIT0gbnVsbCkge1xuICAgICAgICAvLyBJZiBhdCBsZWFzdCBvbmUgZG9jdW1lbnQgZXhpc3RzIGFzc3VtZSB0aGUgY29sbGVjdGlvbiBoYXMgdGhlIHJlcXVpcmVkIGluZGV4XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgaW5kZXggPSB7IGZpbGVuYW1lOiAxLCB1cGxvYWREYXRlOiAxIH07XG4gICAgbGV0IGluZGV4ZXM7XG4gICAgdHJ5IHtcbiAgICAgICAgaW5kZXhlcyA9IGF3YWl0IHN0cmVhbS5maWxlcy5saXN0SW5kZXhlcygpLnRvQXJyYXkoKTtcbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIGVycm9yXzEuTW9uZ29FcnJvciAmJiBlcnJvci5jb2RlID09PSBlcnJvcl8xLk1PTkdPREJfRVJST1JfQ09ERVMuTmFtZXNwYWNlTm90Rm91bmQpIHtcbiAgICAgICAgICAgIGluZGV4ZXMgPSBbXTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbnN0IGhhc0ZpbGVJbmRleCA9ICEhaW5kZXhlcy5maW5kKGluZGV4ID0+IHtcbiAgICAgICAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKGluZGV4LmtleSk7XG4gICAgICAgIGlmIChrZXlzLmxlbmd0aCA9PT0gMiAmJiBpbmRleC5rZXkuZmlsZW5hbWUgPT09IDEgJiYgaW5kZXgua2V5LnVwbG9hZERhdGUgPT09IDEpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9KTtcbiAgICBpZiAoIWhhc0ZpbGVJbmRleCkge1xuICAgICAgICBhd2FpdCBzdHJlYW0uZmlsZXMuY3JlYXRlSW5kZXgoaW5kZXgsIHsgYmFja2dyb3VuZDogZmFsc2UgfSk7XG4gICAgfVxuICAgIGF3YWl0IGNoZWNrQ2h1bmtzSW5kZXgoc3RyZWFtKTtcbn1cbmZ1bmN0aW9uIGNyZWF0ZUZpbGVzRG9jKF9pZCwgbGVuZ3RoLCBjaHVua1NpemUsIGZpbGVuYW1lLCBjb250ZW50VHlwZSwgYWxpYXNlcywgbWV0YWRhdGEpIHtcbiAgICBjb25zdCByZXQgPSB7XG4gICAgICAgIF9pZCxcbiAgICAgICAgbGVuZ3RoLFxuICAgICAgICBjaHVua1NpemUsXG4gICAgICAgIHVwbG9hZERhdGU6IG5ldyBEYXRlKCksXG4gICAgICAgIGZpbGVuYW1lXG4gICAgfTtcbiAgICBpZiAoY29udGVudFR5cGUpIHtcbiAgICAgICAgcmV0LmNvbnRlbnRUeXBlID0gY29udGVudFR5cGU7XG4gICAgfVxuICAgIGlmIChhbGlhc2VzKSB7XG4gICAgICAgIHJldC5hbGlhc2VzID0gYWxpYXNlcztcbiAgICB9XG4gICAgaWYgKG1ldGFkYXRhKSB7XG4gICAgICAgIHJldC5tZXRhZGF0YSA9IG1ldGFkYXRhO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufVxuZnVuY3Rpb24gZG9Xcml0ZShzdHJlYW0sIGNodW5rLCBlbmNvZGluZywgY2FsbGJhY2spIHtcbiAgICBpZiAoY2hlY2tBYm9ydGVkKHN0cmVhbSwgY2FsbGJhY2spKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uc3QgaW5wdXRCdWYgPSBCdWZmZXIuaXNCdWZmZXIoY2h1bmspID8gY2h1bmsgOiBCdWZmZXIuZnJvbShjaHVuaywgZW5jb2RpbmcpO1xuICAgIHN0cmVhbS5sZW5ndGggKz0gaW5wdXRCdWYubGVuZ3RoO1xuICAgIC8vIElucHV0IGlzIHNtYWxsIGVub3VnaCB0byBmaXQgaW4gb3VyIGJ1ZmZlclxuICAgIGlmIChzdHJlYW0ucG9zICsgaW5wdXRCdWYubGVuZ3RoIDwgc3RyZWFtLmNodW5rU2l6ZUJ5dGVzKSB7XG4gICAgICAgIGlucHV0QnVmLmNvcHkoc3RyZWFtLmJ1ZlRvU3RvcmUsIHN0cmVhbS5wb3MpO1xuICAgICAgICBzdHJlYW0ucG9zICs9IGlucHV0QnVmLmxlbmd0aDtcbiAgICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2soKTtcbiAgICAgICAgLy8gTm90ZSB0aGF0IHdlIHJldmVyc2UgdGhlIHR5cGljYWwgc2VtYW50aWNzIG9mIHdyaXRlJ3MgcmV0dXJuIHZhbHVlXG4gICAgICAgIC8vIHRvIGJlIGNvbXBhdGlibGUgd2l0aCBub2RlJ3MgYC5waXBlKClgIGZ1bmN0aW9uLlxuICAgICAgICAvLyBUcnVlIG1lYW5zIGNsaWVudCBjYW4ga2VlcCB3cml0aW5nLlxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgLy8gT3RoZXJ3aXNlLCBidWZmZXIgaXMgdG9vIGJpZyBmb3IgY3VycmVudCBjaHVuaywgc28gd2UgbmVlZCB0byBmbHVzaFxuICAgIC8vIHRvIE1vbmdvREIuXG4gICAgbGV0IGlucHV0QnVmUmVtYWluaW5nID0gaW5wdXRCdWYubGVuZ3RoO1xuICAgIGxldCBzcGFjZVJlbWFpbmluZyA9IHN0cmVhbS5jaHVua1NpemVCeXRlcyAtIHN0cmVhbS5wb3M7XG4gICAgbGV0IG51bVRvQ29weSA9IE1hdGgubWluKHNwYWNlUmVtYWluaW5nLCBpbnB1dEJ1Zi5sZW5ndGgpO1xuICAgIGxldCBvdXRzdGFuZGluZ1JlcXVlc3RzID0gMDtcbiAgICB3aGlsZSAoaW5wdXRCdWZSZW1haW5pbmcgPiAwKSB7XG4gICAgICAgIGNvbnN0IGlucHV0QnVmUG9zID0gaW5wdXRCdWYubGVuZ3RoIC0gaW5wdXRCdWZSZW1haW5pbmc7XG4gICAgICAgIGlucHV0QnVmLmNvcHkoc3RyZWFtLmJ1ZlRvU3RvcmUsIHN0cmVhbS5wb3MsIGlucHV0QnVmUG9zLCBpbnB1dEJ1ZlBvcyArIG51bVRvQ29weSk7XG4gICAgICAgIHN0cmVhbS5wb3MgKz0gbnVtVG9Db3B5O1xuICAgICAgICBzcGFjZVJlbWFpbmluZyAtPSBudW1Ub0NvcHk7XG4gICAgICAgIGxldCBkb2M7XG4gICAgICAgIGlmIChzcGFjZVJlbWFpbmluZyA9PT0gMCkge1xuICAgICAgICAgICAgZG9jID0gY3JlYXRlQ2h1bmtEb2Moc3RyZWFtLmlkLCBzdHJlYW0ubiwgQnVmZmVyLmZyb20oc3RyZWFtLmJ1ZlRvU3RvcmUpKTtcbiAgICAgICAgICAgICsrc3RyZWFtLnN0YXRlLm91dHN0YW5kaW5nUmVxdWVzdHM7XG4gICAgICAgICAgICArK291dHN0YW5kaW5nUmVxdWVzdHM7XG4gICAgICAgICAgICBpZiAoY2hlY2tBYm9ydGVkKHN0cmVhbSwgY2FsbGJhY2spKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc3RyZWFtLmNodW5rcy5pbnNlcnRPbmUoZG9jLCB7IHdyaXRlQ29uY2Vybjogc3RyZWFtLndyaXRlQ29uY2VybiB9KS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICAtLXN0cmVhbS5zdGF0ZS5vdXRzdGFuZGluZ1JlcXVlc3RzO1xuICAgICAgICAgICAgICAgIC0tb3V0c3RhbmRpbmdSZXF1ZXN0cztcbiAgICAgICAgICAgICAgICBpZiAoIW91dHN0YW5kaW5nUmVxdWVzdHMpIHtcbiAgICAgICAgICAgICAgICAgICAgc3RyZWFtLmVtaXQoJ2RyYWluJywgZG9jKTtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2soKTtcbiAgICAgICAgICAgICAgICAgICAgY2hlY2tEb25lKHN0cmVhbSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgZXJyb3IgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBfX2hhbmRsZUVycm9yKHN0cmVhbSwgZXJyb3IpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBzcGFjZVJlbWFpbmluZyA9IHN0cmVhbS5jaHVua1NpemVCeXRlcztcbiAgICAgICAgICAgIHN0cmVhbS5wb3MgPSAwO1xuICAgICAgICAgICAgKytzdHJlYW0ubjtcbiAgICAgICAgfVxuICAgICAgICBpbnB1dEJ1ZlJlbWFpbmluZyAtPSBudW1Ub0NvcHk7XG4gICAgICAgIG51bVRvQ29weSA9IE1hdGgubWluKHNwYWNlUmVtYWluaW5nLCBpbnB1dEJ1ZlJlbWFpbmluZyk7XG4gICAgfVxuICAgIC8vIE5vdGUgdGhhdCB3ZSByZXZlcnNlIHRoZSB0eXBpY2FsIHNlbWFudGljcyBvZiB3cml0ZSdzIHJldHVybiB2YWx1ZVxuICAgIC8vIHRvIGJlIGNvbXBhdGlibGUgd2l0aCBub2RlJ3MgYC5waXBlKClgIGZ1bmN0aW9uLlxuICAgIC8vIEZhbHNlIG1lYW5zIHRoZSBjbGllbnQgc2hvdWxkIHdhaXQgZm9yIHRoZSAnZHJhaW4nIGV2ZW50LlxuICAgIHJldHVybiBmYWxzZTtcbn1cbmZ1bmN0aW9uIHdhaXRGb3JJbmRleGVzKHN0cmVhbSwgY2FsbGJhY2spIHtcbiAgICBpZiAoc3RyZWFtLmJ1Y2tldC5zLmNoZWNrZWRJbmRleGVzKSB7XG4gICAgICAgIHJldHVybiBjYWxsYmFjayhmYWxzZSk7XG4gICAgfVxuICAgIHN0cmVhbS5idWNrZXQub25jZSgnaW5kZXgnLCAoKSA9PiB7XG4gICAgICAgIGNhbGxiYWNrKHRydWUpO1xuICAgIH0pO1xuICAgIHJldHVybiB0cnVlO1xufVxuZnVuY3Rpb24gd3JpdGVSZW1uYW50KHN0cmVhbSwgY2FsbGJhY2spIHtcbiAgICAvLyBCdWZmZXIgaXMgZW1wdHksIHNvIGRvbid0IGJvdGhlciB0byBpbnNlcnRcbiAgICBpZiAoc3RyZWFtLnBvcyA9PT0gMCkge1xuICAgICAgICByZXR1cm4gY2hlY2tEb25lKHN0cmVhbSwgY2FsbGJhY2spO1xuICAgIH1cbiAgICArK3N0cmVhbS5zdGF0ZS5vdXRzdGFuZGluZ1JlcXVlc3RzO1xuICAgIC8vIENyZWF0ZSBhIG5ldyBidWZmZXIgdG8gbWFrZSBzdXJlIHRoZSBidWZmZXIgaXNuJ3QgYmlnZ2VyIHRoYW4gaXQgbmVlZHNcbiAgICAvLyB0byBiZS5cbiAgICBjb25zdCByZW1uYW50ID0gQnVmZmVyLmFsbG9jKHN0cmVhbS5wb3MpO1xuICAgIHN0cmVhbS5idWZUb1N0b3JlLmNvcHkocmVtbmFudCwgMCwgMCwgc3RyZWFtLnBvcyk7XG4gICAgY29uc3QgZG9jID0gY3JlYXRlQ2h1bmtEb2Moc3RyZWFtLmlkLCBzdHJlYW0ubiwgcmVtbmFudCk7XG4gICAgLy8gSWYgdGhlIHN0cmVhbSB3YXMgYWJvcnRlZCwgZG8gbm90IHdyaXRlIHJlbW5hbnRcbiAgICBpZiAoY2hlY2tBYm9ydGVkKHN0cmVhbSwgY2FsbGJhY2spKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgc3RyZWFtLmNodW5rcy5pbnNlcnRPbmUoZG9jLCB7IHdyaXRlQ29uY2Vybjogc3RyZWFtLndyaXRlQ29uY2VybiB9KS50aGVuKCgpID0+IHtcbiAgICAgICAgLS1zdHJlYW0uc3RhdGUub3V0c3RhbmRpbmdSZXF1ZXN0cztcbiAgICAgICAgY2hlY2tEb25lKHN0cmVhbSk7XG4gICAgfSwgZXJyb3IgPT4ge1xuICAgICAgICByZXR1cm4gX19oYW5kbGVFcnJvcihzdHJlYW0sIGVycm9yKTtcbiAgICB9KTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmZ1bmN0aW9uIGNoZWNrQWJvcnRlZChzdHJlYW0sIGNhbGxiYWNrKSB7XG4gICAgaWYgKHN0cmVhbS5zdGF0ZS5hYm9ydGVkKSB7XG4gICAgICAgIGlmICh0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIC8vIFRPRE8oTk9ERS0zNDg1KTogUmVwbGFjZSB3aXRoIE1vbmdvR3JpZEZTU3RyZWFtQ2xvc2VkRXJyb3JcbiAgICAgICAgICAgIGNhbGxiYWNrKG5ldyBlcnJvcl8xLk1vbmdvQVBJRXJyb3IoJ1N0cmVhbSBoYXMgYmVlbiBhYm9ydGVkJykpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG59XG4vLyMgc291cmNlTWFwcGluZ1VSTD11cGxvYWQuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/gridfs/upload.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/index.js":
/*!***************************************************!*\
  !*** ../server/node_modules/mongodb/lib/index.js ***!
  \***************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.AbstractCursor = exports.MongoWriteConcernError = exports.MongoUnexpectedServerResponseError = exports.MongoTransactionError = exports.MongoTopologyClosedError = exports.MongoTailableCursorError = exports.MongoSystemError = exports.MongoServerSelectionError = exports.MongoServerError = exports.MongoServerClosedError = exports.MongoRuntimeError = exports.MongoParseError = exports.MongoNotConnectedError = exports.MongoNetworkTimeoutError = exports.MongoNetworkError = exports.MongoMissingDependencyError = exports.MongoMissingCredentialsError = exports.MongoKerberosError = exports.MongoInvalidArgumentError = exports.MongoGridFSStreamError = exports.MongoGridFSChunkError = exports.MongoExpiredSessionError = exports.MongoError = exports.MongoDriverError = exports.MongoDecompressionError = exports.MongoCursorInUseError = exports.MongoCursorExhaustedError = exports.MongoCompatibilityError = exports.MongoChangeStreamError = exports.MongoBatchReExecutionError = exports.MongoAzureError = exports.MongoAWSError = exports.MongoAPIError = exports.ChangeStreamCursor = exports.MongoBulkWriteError = exports.Timestamp = exports.ObjectId = exports.MinKey = exports.MaxKey = exports.Long = exports.Int32 = exports.Double = exports.Decimal128 = exports.DBRef = exports.Code = exports.BSONType = exports.BSONSymbol = exports.BSONRegExp = exports.Binary = exports.BSON = void 0;\nexports.ServerClosedEvent = exports.ConnectionReadyEvent = exports.ConnectionPoolReadyEvent = exports.ConnectionPoolMonitoringEvent = exports.ConnectionPoolCreatedEvent = exports.ConnectionPoolClosedEvent = exports.ConnectionPoolClearedEvent = exports.ConnectionCreatedEvent = exports.ConnectionClosedEvent = exports.ConnectionCheckOutStartedEvent = exports.ConnectionCheckOutFailedEvent = exports.ConnectionCheckedOutEvent = exports.ConnectionCheckedInEvent = exports.CommandSucceededEvent = exports.CommandStartedEvent = exports.CommandFailedEvent = exports.WriteConcern = exports.ReadPreference = exports.ReadConcern = exports.TopologyType = exports.ServerType = exports.ReadPreferenceMode = exports.ReadConcernLevel = exports.ProfilingLevel = exports.ReturnDocument = exports.ServerApiVersion = exports.ExplainVerbosity = exports.MongoErrorLabel = exports.AutoEncryptionLoggerLevel = exports.CURSOR_FLAGS = exports.Compressor = exports.AuthMechanism = exports.GSSAPICanonicalizationValue = exports.BatchType = exports.UnorderedBulkOperation = exports.OrderedBulkOperation = exports.MongoClient = exports.ListIndexesCursor = exports.ListCollectionsCursor = exports.GridFSBucketWriteStream = exports.GridFSBucketReadStream = exports.GridFSBucket = exports.FindCursor = exports.Db = exports.Collection = exports.ClientSession = exports.ChangeStream = exports.CancellationToken = exports.AggregationCursor = exports.Admin = void 0;\nexports.SrvPollingEvent = exports.TopologyOpeningEvent = exports.TopologyDescriptionChangedEvent = exports.TopologyClosedEvent = exports.ServerOpeningEvent = exports.ServerHeartbeatSucceededEvent = exports.ServerHeartbeatStartedEvent = exports.ServerHeartbeatFailedEvent = exports.ServerDescriptionChangedEvent = void 0;\nconst admin_1 = __webpack_require__(/*! ./admin */ \"(api)/../server/node_modules/mongodb/lib/admin.js\");\nObject.defineProperty(exports, \"Admin\", ({ enumerable: true, get: function () { return admin_1.Admin; } }));\nconst ordered_1 = __webpack_require__(/*! ./bulk/ordered */ \"(api)/../server/node_modules/mongodb/lib/bulk/ordered.js\");\nObject.defineProperty(exports, \"OrderedBulkOperation\", ({ enumerable: true, get: function () { return ordered_1.OrderedBulkOperation; } }));\nconst unordered_1 = __webpack_require__(/*! ./bulk/unordered */ \"(api)/../server/node_modules/mongodb/lib/bulk/unordered.js\");\nObject.defineProperty(exports, \"UnorderedBulkOperation\", ({ enumerable: true, get: function () { return unordered_1.UnorderedBulkOperation; } }));\nconst change_stream_1 = __webpack_require__(/*! ./change_stream */ \"(api)/../server/node_modules/mongodb/lib/change_stream.js\");\nObject.defineProperty(exports, \"ChangeStream\", ({ enumerable: true, get: function () { return change_stream_1.ChangeStream; } }));\nconst collection_1 = __webpack_require__(/*! ./collection */ \"(api)/../server/node_modules/mongodb/lib/collection.js\");\nObject.defineProperty(exports, \"Collection\", ({ enumerable: true, get: function () { return collection_1.Collection; } }));\nconst abstract_cursor_1 = __webpack_require__(/*! ./cursor/abstract_cursor */ \"(api)/../server/node_modules/mongodb/lib/cursor/abstract_cursor.js\");\nObject.defineProperty(exports, \"AbstractCursor\", ({ enumerable: true, get: function () { return abstract_cursor_1.AbstractCursor; } }));\nconst aggregation_cursor_1 = __webpack_require__(/*! ./cursor/aggregation_cursor */ \"(api)/../server/node_modules/mongodb/lib/cursor/aggregation_cursor.js\");\nObject.defineProperty(exports, \"AggregationCursor\", ({ enumerable: true, get: function () { return aggregation_cursor_1.AggregationCursor; } }));\nconst find_cursor_1 = __webpack_require__(/*! ./cursor/find_cursor */ \"(api)/../server/node_modules/mongodb/lib/cursor/find_cursor.js\");\nObject.defineProperty(exports, \"FindCursor\", ({ enumerable: true, get: function () { return find_cursor_1.FindCursor; } }));\nconst list_collections_cursor_1 = __webpack_require__(/*! ./cursor/list_collections_cursor */ \"(api)/../server/node_modules/mongodb/lib/cursor/list_collections_cursor.js\");\nObject.defineProperty(exports, \"ListCollectionsCursor\", ({ enumerable: true, get: function () { return list_collections_cursor_1.ListCollectionsCursor; } }));\nconst list_indexes_cursor_1 = __webpack_require__(/*! ./cursor/list_indexes_cursor */ \"(api)/../server/node_modules/mongodb/lib/cursor/list_indexes_cursor.js\");\nObject.defineProperty(exports, \"ListIndexesCursor\", ({ enumerable: true, get: function () { return list_indexes_cursor_1.ListIndexesCursor; } }));\nconst db_1 = __webpack_require__(/*! ./db */ \"(api)/../server/node_modules/mongodb/lib/db.js\");\nObject.defineProperty(exports, \"Db\", ({ enumerable: true, get: function () { return db_1.Db; } }));\nconst gridfs_1 = __webpack_require__(/*! ./gridfs */ \"(api)/../server/node_modules/mongodb/lib/gridfs/index.js\");\nObject.defineProperty(exports, \"GridFSBucket\", ({ enumerable: true, get: function () { return gridfs_1.GridFSBucket; } }));\nconst download_1 = __webpack_require__(/*! ./gridfs/download */ \"(api)/../server/node_modules/mongodb/lib/gridfs/download.js\");\nObject.defineProperty(exports, \"GridFSBucketReadStream\", ({ enumerable: true, get: function () { return download_1.GridFSBucketReadStream; } }));\nconst upload_1 = __webpack_require__(/*! ./gridfs/upload */ \"(api)/../server/node_modules/mongodb/lib/gridfs/upload.js\");\nObject.defineProperty(exports, \"GridFSBucketWriteStream\", ({ enumerable: true, get: function () { return upload_1.GridFSBucketWriteStream; } }));\nconst mongo_client_1 = __webpack_require__(/*! ./mongo_client */ \"(api)/../server/node_modules/mongodb/lib/mongo_client.js\");\nObject.defineProperty(exports, \"MongoClient\", ({ enumerable: true, get: function () { return mongo_client_1.MongoClient; } }));\nconst mongo_types_1 = __webpack_require__(/*! ./mongo_types */ \"(api)/../server/node_modules/mongodb/lib/mongo_types.js\");\nObject.defineProperty(exports, \"CancellationToken\", ({ enumerable: true, get: function () { return mongo_types_1.CancellationToken; } }));\nconst sessions_1 = __webpack_require__(/*! ./sessions */ \"(api)/../server/node_modules/mongodb/lib/sessions.js\");\nObject.defineProperty(exports, \"ClientSession\", ({ enumerable: true, get: function () { return sessions_1.ClientSession; } }));\n/** @public */\nvar bson_1 = __webpack_require__(/*! ./bson */ \"(api)/../server/node_modules/mongodb/lib/bson.js\");\nObject.defineProperty(exports, \"BSON\", ({ enumerable: true, get: function () { return bson_1.BSON; } }));\nvar bson_2 = __webpack_require__(/*! ./bson */ \"(api)/../server/node_modules/mongodb/lib/bson.js\");\nObject.defineProperty(exports, \"Binary\", ({ enumerable: true, get: function () { return bson_2.Binary; } }));\nObject.defineProperty(exports, \"BSONRegExp\", ({ enumerable: true, get: function () { return bson_2.BSONRegExp; } }));\nObject.defineProperty(exports, \"BSONSymbol\", ({ enumerable: true, get: function () { return bson_2.BSONSymbol; } }));\nObject.defineProperty(exports, \"BSONType\", ({ enumerable: true, get: function () { return bson_2.BSONType; } }));\nObject.defineProperty(exports, \"Code\", ({ enumerable: true, get: function () { return bson_2.Code; } }));\nObject.defineProperty(exports, \"DBRef\", ({ enumerable: true, get: function () { return bson_2.DBRef; } }));\nObject.defineProperty(exports, \"Decimal128\", ({ enumerable: true, get: function () { return bson_2.Decimal128; } }));\nObject.defineProperty(exports, \"Double\", ({ enumerable: true, get: function () { return bson_2.Double; } }));\nObject.defineProperty(exports, \"Int32\", ({ enumerable: true, get: function () { return bson_2.Int32; } }));\nObject.defineProperty(exports, \"Long\", ({ enumerable: true, get: function () { return bson_2.Long; } }));\nObject.defineProperty(exports, \"MaxKey\", ({ enumerable: true, get: function () { return bson_2.MaxKey; } }));\nObject.defineProperty(exports, \"MinKey\", ({ enumerable: true, get: function () { return bson_2.MinKey; } }));\nObject.defineProperty(exports, \"ObjectId\", ({ enumerable: true, get: function () { return bson_2.ObjectId; } }));\nObject.defineProperty(exports, \"Timestamp\", ({ enumerable: true, get: function () { return bson_2.Timestamp; } }));\nvar common_1 = __webpack_require__(/*! ./bulk/common */ \"(api)/../server/node_modules/mongodb/lib/bulk/common.js\");\nObject.defineProperty(exports, \"MongoBulkWriteError\", ({ enumerable: true, get: function () { return common_1.MongoBulkWriteError; } }));\nvar change_stream_cursor_1 = __webpack_require__(/*! ./cursor/change_stream_cursor */ \"(api)/../server/node_modules/mongodb/lib/cursor/change_stream_cursor.js\");\nObject.defineProperty(exports, \"ChangeStreamCursor\", ({ enumerable: true, get: function () { return change_stream_cursor_1.ChangeStreamCursor; } }));\nvar error_1 = __webpack_require__(/*! ./error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nObject.defineProperty(exports, \"MongoAPIError\", ({ enumerable: true, get: function () { return error_1.MongoAPIError; } }));\nObject.defineProperty(exports, \"MongoAWSError\", ({ enumerable: true, get: function () { return error_1.MongoAWSError; } }));\nObject.defineProperty(exports, \"MongoAzureError\", ({ enumerable: true, get: function () { return error_1.MongoAzureError; } }));\nObject.defineProperty(exports, \"MongoBatchReExecutionError\", ({ enumerable: true, get: function () { return error_1.MongoBatchReExecutionError; } }));\nObject.defineProperty(exports, \"MongoChangeStreamError\", ({ enumerable: true, get: function () { return error_1.MongoChangeStreamError; } }));\nObject.defineProperty(exports, \"MongoCompatibilityError\", ({ enumerable: true, get: function () { return error_1.MongoCompatibilityError; } }));\nObject.defineProperty(exports, \"MongoCursorExhaustedError\", ({ enumerable: true, get: function () { return error_1.MongoCursorExhaustedError; } }));\nObject.defineProperty(exports, \"MongoCursorInUseError\", ({ enumerable: true, get: function () { return error_1.MongoCursorInUseError; } }));\nObject.defineProperty(exports, \"MongoDecompressionError\", ({ enumerable: true, get: function () { return error_1.MongoDecompressionError; } }));\nObject.defineProperty(exports, \"MongoDriverError\", ({ enumerable: true, get: function () { return error_1.MongoDriverError; } }));\nObject.defineProperty(exports, \"MongoError\", ({ enumerable: true, get: function () { return error_1.MongoError; } }));\nObject.defineProperty(exports, \"MongoExpiredSessionError\", ({ enumerable: true, get: function () { return error_1.MongoExpiredSessionError; } }));\nObject.defineProperty(exports, \"MongoGridFSChunkError\", ({ enumerable: true, get: function () { return error_1.MongoGridFSChunkError; } }));\nObject.defineProperty(exports, \"MongoGridFSStreamError\", ({ enumerable: true, get: function () { return error_1.MongoGridFSStreamError; } }));\nObject.defineProperty(exports, \"MongoInvalidArgumentError\", ({ enumerable: true, get: function () { return error_1.MongoInvalidArgumentError; } }));\nObject.defineProperty(exports, \"MongoKerberosError\", ({ enumerable: true, get: function () { return error_1.MongoKerberosError; } }));\nObject.defineProperty(exports, \"MongoMissingCredentialsError\", ({ enumerable: true, get: function () { return error_1.MongoMissingCredentialsError; } }));\nObject.defineProperty(exports, \"MongoMissingDependencyError\", ({ enumerable: true, get: function () { return error_1.MongoMissingDependencyError; } }));\nObject.defineProperty(exports, \"MongoNetworkError\", ({ enumerable: true, get: function () { return error_1.MongoNetworkError; } }));\nObject.defineProperty(exports, \"MongoNetworkTimeoutError\", ({ enumerable: true, get: function () { return error_1.MongoNetworkTimeoutError; } }));\nObject.defineProperty(exports, \"MongoNotConnectedError\", ({ enumerable: true, get: function () { return error_1.MongoNotConnectedError; } }));\nObject.defineProperty(exports, \"MongoParseError\", ({ enumerable: true, get: function () { return error_1.MongoParseError; } }));\nObject.defineProperty(exports, \"MongoRuntimeError\", ({ enumerable: true, get: function () { return error_1.MongoRuntimeError; } }));\nObject.defineProperty(exports, \"MongoServerClosedError\", ({ enumerable: true, get: function () { return error_1.MongoServerClosedError; } }));\nObject.defineProperty(exports, \"MongoServerError\", ({ enumerable: true, get: function () { return error_1.MongoServerError; } }));\nObject.defineProperty(exports, \"MongoServerSelectionError\", ({ enumerable: true, get: function () { return error_1.MongoServerSelectionError; } }));\nObject.defineProperty(exports, \"MongoSystemError\", ({ enumerable: true, get: function () { return error_1.MongoSystemError; } }));\nObject.defineProperty(exports, \"MongoTailableCursorError\", ({ enumerable: true, get: function () { return error_1.MongoTailableCursorError; } }));\nObject.defineProperty(exports, \"MongoTopologyClosedError\", ({ enumerable: true, get: function () { return error_1.MongoTopologyClosedError; } }));\nObject.defineProperty(exports, \"MongoTransactionError\", ({ enumerable: true, get: function () { return error_1.MongoTransactionError; } }));\nObject.defineProperty(exports, \"MongoUnexpectedServerResponseError\", ({ enumerable: true, get: function () { return error_1.MongoUnexpectedServerResponseError; } }));\nObject.defineProperty(exports, \"MongoWriteConcernError\", ({ enumerable: true, get: function () { return error_1.MongoWriteConcernError; } }));\n// enums\nvar common_2 = __webpack_require__(/*! ./bulk/common */ \"(api)/../server/node_modules/mongodb/lib/bulk/common.js\");\nObject.defineProperty(exports, \"BatchType\", ({ enumerable: true, get: function () { return common_2.BatchType; } }));\nvar gssapi_1 = __webpack_require__(/*! ./cmap/auth/gssapi */ \"(api)/../server/node_modules/mongodb/lib/cmap/auth/gssapi.js\");\nObject.defineProperty(exports, \"GSSAPICanonicalizationValue\", ({ enumerable: true, get: function () { return gssapi_1.GSSAPICanonicalizationValue; } }));\nvar providers_1 = __webpack_require__(/*! ./cmap/auth/providers */ \"(api)/../server/node_modules/mongodb/lib/cmap/auth/providers.js\");\nObject.defineProperty(exports, \"AuthMechanism\", ({ enumerable: true, get: function () { return providers_1.AuthMechanism; } }));\nvar compression_1 = __webpack_require__(/*! ./cmap/wire_protocol/compression */ \"(api)/../server/node_modules/mongodb/lib/cmap/wire_protocol/compression.js\");\nObject.defineProperty(exports, \"Compressor\", ({ enumerable: true, get: function () { return compression_1.Compressor; } }));\nvar abstract_cursor_2 = __webpack_require__(/*! ./cursor/abstract_cursor */ \"(api)/../server/node_modules/mongodb/lib/cursor/abstract_cursor.js\");\nObject.defineProperty(exports, \"CURSOR_FLAGS\", ({ enumerable: true, get: function () { return abstract_cursor_2.CURSOR_FLAGS; } }));\nvar deps_1 = __webpack_require__(/*! ./deps */ \"(api)/../server/node_modules/mongodb/lib/deps.js\");\nObject.defineProperty(exports, \"AutoEncryptionLoggerLevel\", ({ enumerable: true, get: function () { return deps_1.AutoEncryptionLoggerLevel; } }));\nvar error_2 = __webpack_require__(/*! ./error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nObject.defineProperty(exports, \"MongoErrorLabel\", ({ enumerable: true, get: function () { return error_2.MongoErrorLabel; } }));\nvar explain_1 = __webpack_require__(/*! ./explain */ \"(api)/../server/node_modules/mongodb/lib/explain.js\");\nObject.defineProperty(exports, \"ExplainVerbosity\", ({ enumerable: true, get: function () { return explain_1.ExplainVerbosity; } }));\nvar mongo_client_2 = __webpack_require__(/*! ./mongo_client */ \"(api)/../server/node_modules/mongodb/lib/mongo_client.js\");\nObject.defineProperty(exports, \"ServerApiVersion\", ({ enumerable: true, get: function () { return mongo_client_2.ServerApiVersion; } }));\nvar find_and_modify_1 = __webpack_require__(/*! ./operations/find_and_modify */ \"(api)/../server/node_modules/mongodb/lib/operations/find_and_modify.js\");\nObject.defineProperty(exports, \"ReturnDocument\", ({ enumerable: true, get: function () { return find_and_modify_1.ReturnDocument; } }));\nvar set_profiling_level_1 = __webpack_require__(/*! ./operations/set_profiling_level */ \"(api)/../server/node_modules/mongodb/lib/operations/set_profiling_level.js\");\nObject.defineProperty(exports, \"ProfilingLevel\", ({ enumerable: true, get: function () { return set_profiling_level_1.ProfilingLevel; } }));\nvar read_concern_1 = __webpack_require__(/*! ./read_concern */ \"(api)/../server/node_modules/mongodb/lib/read_concern.js\");\nObject.defineProperty(exports, \"ReadConcernLevel\", ({ enumerable: true, get: function () { return read_concern_1.ReadConcernLevel; } }));\nvar read_preference_1 = __webpack_require__(/*! ./read_preference */ \"(api)/../server/node_modules/mongodb/lib/read_preference.js\");\nObject.defineProperty(exports, \"ReadPreferenceMode\", ({ enumerable: true, get: function () { return read_preference_1.ReadPreferenceMode; } }));\nvar common_3 = __webpack_require__(/*! ./sdam/common */ \"(api)/../server/node_modules/mongodb/lib/sdam/common.js\");\nObject.defineProperty(exports, \"ServerType\", ({ enumerable: true, get: function () { return common_3.ServerType; } }));\nObject.defineProperty(exports, \"TopologyType\", ({ enumerable: true, get: function () { return common_3.TopologyType; } }));\n// Helper classes\nvar read_concern_2 = __webpack_require__(/*! ./read_concern */ \"(api)/../server/node_modules/mongodb/lib/read_concern.js\");\nObject.defineProperty(exports, \"ReadConcern\", ({ enumerable: true, get: function () { return read_concern_2.ReadConcern; } }));\nvar read_preference_2 = __webpack_require__(/*! ./read_preference */ \"(api)/../server/node_modules/mongodb/lib/read_preference.js\");\nObject.defineProperty(exports, \"ReadPreference\", ({ enumerable: true, get: function () { return read_preference_2.ReadPreference; } }));\nvar write_concern_1 = __webpack_require__(/*! ./write_concern */ \"(api)/../server/node_modules/mongodb/lib/write_concern.js\");\nObject.defineProperty(exports, \"WriteConcern\", ({ enumerable: true, get: function () { return write_concern_1.WriteConcern; } }));\n// events\nvar command_monitoring_events_1 = __webpack_require__(/*! ./cmap/command_monitoring_events */ \"(api)/../server/node_modules/mongodb/lib/cmap/command_monitoring_events.js\");\nObject.defineProperty(exports, \"CommandFailedEvent\", ({ enumerable: true, get: function () { return command_monitoring_events_1.CommandFailedEvent; } }));\nObject.defineProperty(exports, \"CommandStartedEvent\", ({ enumerable: true, get: function () { return command_monitoring_events_1.CommandStartedEvent; } }));\nObject.defineProperty(exports, \"CommandSucceededEvent\", ({ enumerable: true, get: function () { return command_monitoring_events_1.CommandSucceededEvent; } }));\nvar connection_pool_events_1 = __webpack_require__(/*! ./cmap/connection_pool_events */ \"(api)/../server/node_modules/mongodb/lib/cmap/connection_pool_events.js\");\nObject.defineProperty(exports, \"ConnectionCheckedInEvent\", ({ enumerable: true, get: function () { return connection_pool_events_1.ConnectionCheckedInEvent; } }));\nObject.defineProperty(exports, \"ConnectionCheckedOutEvent\", ({ enumerable: true, get: function () { return connection_pool_events_1.ConnectionCheckedOutEvent; } }));\nObject.defineProperty(exports, \"ConnectionCheckOutFailedEvent\", ({ enumerable: true, get: function () { return connection_pool_events_1.ConnectionCheckOutFailedEvent; } }));\nObject.defineProperty(exports, \"ConnectionCheckOutStartedEvent\", ({ enumerable: true, get: function () { return connection_pool_events_1.ConnectionCheckOutStartedEvent; } }));\nObject.defineProperty(exports, \"ConnectionClosedEvent\", ({ enumerable: true, get: function () { return connection_pool_events_1.ConnectionClosedEvent; } }));\nObject.defineProperty(exports, \"ConnectionCreatedEvent\", ({ enumerable: true, get: function () { return connection_pool_events_1.ConnectionCreatedEvent; } }));\nObject.defineProperty(exports, \"ConnectionPoolClearedEvent\", ({ enumerable: true, get: function () { return connection_pool_events_1.ConnectionPoolClearedEvent; } }));\nObject.defineProperty(exports, \"ConnectionPoolClosedEvent\", ({ enumerable: true, get: function () { return connection_pool_events_1.ConnectionPoolClosedEvent; } }));\nObject.defineProperty(exports, \"ConnectionPoolCreatedEvent\", ({ enumerable: true, get: function () { return connection_pool_events_1.ConnectionPoolCreatedEvent; } }));\nObject.defineProperty(exports, \"ConnectionPoolMonitoringEvent\", ({ enumerable: true, get: function () { return connection_pool_events_1.ConnectionPoolMonitoringEvent; } }));\nObject.defineProperty(exports, \"ConnectionPoolReadyEvent\", ({ enumerable: true, get: function () { return connection_pool_events_1.ConnectionPoolReadyEvent; } }));\nObject.defineProperty(exports, \"ConnectionReadyEvent\", ({ enumerable: true, get: function () { return connection_pool_events_1.ConnectionReadyEvent; } }));\nvar events_1 = __webpack_require__(/*! ./sdam/events */ \"(api)/../server/node_modules/mongodb/lib/sdam/events.js\");\nObject.defineProperty(exports, \"ServerClosedEvent\", ({ enumerable: true, get: function () { return events_1.ServerClosedEvent; } }));\nObject.defineProperty(exports, \"ServerDescriptionChangedEvent\", ({ enumerable: true, get: function () { return events_1.ServerDescriptionChangedEvent; } }));\nObject.defineProperty(exports, \"ServerHeartbeatFailedEvent\", ({ enumerable: true, get: function () { return events_1.ServerHeartbeatFailedEvent; } }));\nObject.defineProperty(exports, \"ServerHeartbeatStartedEvent\", ({ enumerable: true, get: function () { return events_1.ServerHeartbeatStartedEvent; } }));\nObject.defineProperty(exports, \"ServerHeartbeatSucceededEvent\", ({ enumerable: true, get: function () { return events_1.ServerHeartbeatSucceededEvent; } }));\nObject.defineProperty(exports, \"ServerOpeningEvent\", ({ enumerable: true, get: function () { return events_1.ServerOpeningEvent; } }));\nObject.defineProperty(exports, \"TopologyClosedEvent\", ({ enumerable: true, get: function () { return events_1.TopologyClosedEvent; } }));\nObject.defineProperty(exports, \"TopologyDescriptionChangedEvent\", ({ enumerable: true, get: function () { return events_1.TopologyDescriptionChangedEvent; } }));\nObject.defineProperty(exports, \"TopologyOpeningEvent\", ({ enumerable: true, get: function () { return events_1.TopologyOpeningEvent; } }));\nvar srv_polling_1 = __webpack_require__(/*! ./sdam/srv_polling */ \"(api)/../server/node_modules/mongodb/lib/sdam/srv_polling.js\");\nObject.defineProperty(exports, \"SrvPollingEvent\", ({ enumerable: true, get: function () { return srv_polling_1.SrvPollingEvent; } }));\n//# sourceMappingURL=index.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9pbmRleC5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxzQkFBc0IsR0FBRyw4QkFBOEIsR0FBRywwQ0FBMEMsR0FBRyw2QkFBNkIsR0FBRyxnQ0FBZ0MsR0FBRyxnQ0FBZ0MsR0FBRyx3QkFBd0IsR0FBRyxpQ0FBaUMsR0FBRyx3QkFBd0IsR0FBRyw4QkFBOEIsR0FBRyx5QkFBeUIsR0FBRyx1QkFBdUIsR0FBRyw4QkFBOEIsR0FBRyxnQ0FBZ0MsR0FBRyx5QkFBeUIsR0FBRyxtQ0FBbUMsR0FBRyxvQ0FBb0MsR0FBRywwQkFBMEIsR0FBRyxpQ0FBaUMsR0FBRyw4QkFBOEIsR0FBRyw2QkFBNkIsR0FBRyxnQ0FBZ0MsR0FBRyxrQkFBa0IsR0FBRyx3QkFBd0IsR0FBRywrQkFBK0IsR0FBRyw2QkFBNkIsR0FBRyxpQ0FBaUMsR0FBRywrQkFBK0IsR0FBRyw4QkFBOEIsR0FBRyxrQ0FBa0MsR0FBRyx1QkFBdUIsR0FBRyxxQkFBcUIsR0FBRyxxQkFBcUIsR0FBRywwQkFBMEIsR0FBRywyQkFBMkIsR0FBRyxpQkFBaUIsR0FBRyxnQkFBZ0IsR0FBRyxjQUFjLEdBQUcsY0FBYyxHQUFHLFlBQVksR0FBRyxhQUFhLEdBQUcsY0FBYyxHQUFHLGtCQUFrQixHQUFHLGFBQWEsR0FBRyxZQUFZLEdBQUcsZ0JBQWdCLEdBQUcsa0JBQWtCLEdBQUcsa0JBQWtCLEdBQUcsY0FBYyxHQUFHLFlBQVk7QUFDMTFDLHlCQUF5QixHQUFHLDRCQUE0QixHQUFHLGdDQUFnQyxHQUFHLHFDQUFxQyxHQUFHLGtDQUFrQyxHQUFHLGlDQUFpQyxHQUFHLGtDQUFrQyxHQUFHLDhCQUE4QixHQUFHLDZCQUE2QixHQUFHLHNDQUFzQyxHQUFHLHFDQUFxQyxHQUFHLGlDQUFpQyxHQUFHLGdDQUFnQyxHQUFHLDZCQUE2QixHQUFHLDJCQUEyQixHQUFHLDBCQUEwQixHQUFHLG9CQUFvQixHQUFHLHNCQUFzQixHQUFHLG1CQUFtQixHQUFHLG9CQUFvQixHQUFHLGtCQUFrQixHQUFHLDBCQUEwQixHQUFHLHdCQUF3QixHQUFHLHNCQUFzQixHQUFHLHNCQUFzQixHQUFHLHdCQUF3QixHQUFHLHdCQUF3QixHQUFHLHVCQUF1QixHQUFHLGlDQUFpQyxHQUFHLG9CQUFvQixHQUFHLGtCQUFrQixHQUFHLHFCQUFxQixHQUFHLG1DQUFtQyxHQUFHLGlCQUFpQixHQUFHLDhCQUE4QixHQUFHLDRCQUE0QixHQUFHLG1CQUFtQixHQUFHLHlCQUF5QixHQUFHLDZCQUE2QixHQUFHLCtCQUErQixHQUFHLDhCQUE4QixHQUFHLG9CQUFvQixHQUFHLGtCQUFrQixHQUFHLFVBQVUsR0FBRyxrQkFBa0IsR0FBRyxxQkFBcUIsR0FBRyxvQkFBb0IsR0FBRyx5QkFBeUIsR0FBRyx5QkFBeUIsR0FBRyxhQUFhO0FBQzc0Qyx1QkFBdUIsR0FBRyw0QkFBNEIsR0FBRyx1Q0FBdUMsR0FBRywyQkFBMkIsR0FBRywwQkFBMEIsR0FBRyxxQ0FBcUMsR0FBRyxtQ0FBbUMsR0FBRyxrQ0FBa0MsR0FBRyxxQ0FBcUM7QUFDdFQsZ0JBQWdCLG1CQUFPLENBQUMsa0VBQVM7QUFDakMseUNBQXdDLEVBQUUscUNBQXFDLHlCQUF5QixFQUFDO0FBQ3pHLGtCQUFrQixtQkFBTyxDQUFDLGdGQUFnQjtBQUMxQyx3REFBdUQsRUFBRSxxQ0FBcUMsMENBQTBDLEVBQUM7QUFDekksb0JBQW9CLG1CQUFPLENBQUMsb0ZBQWtCO0FBQzlDLDBEQUF5RCxFQUFFLHFDQUFxQyw4Q0FBOEMsRUFBQztBQUMvSSx3QkFBd0IsbUJBQU8sQ0FBQyxrRkFBaUI7QUFDakQsZ0RBQStDLEVBQUUscUNBQXFDLHdDQUF3QyxFQUFDO0FBQy9ILHFCQUFxQixtQkFBTyxDQUFDLDRFQUFjO0FBQzNDLDhDQUE2QyxFQUFFLHFDQUFxQyxtQ0FBbUMsRUFBQztBQUN4SCwwQkFBMEIsbUJBQU8sQ0FBQyxvR0FBMEI7QUFDNUQsa0RBQWlELEVBQUUscUNBQXFDLDRDQUE0QyxFQUFDO0FBQ3JJLDZCQUE2QixtQkFBTyxDQUFDLDBHQUE2QjtBQUNsRSxxREFBb0QsRUFBRSxxQ0FBcUMsa0RBQWtELEVBQUM7QUFDOUksc0JBQXNCLG1CQUFPLENBQUMsNEZBQXNCO0FBQ3BELDhDQUE2QyxFQUFFLHFDQUFxQyxvQ0FBb0MsRUFBQztBQUN6SCxrQ0FBa0MsbUJBQU8sQ0FBQyxvSEFBa0M7QUFDNUUseURBQXdELEVBQUUscUNBQXFDLDJEQUEyRCxFQUFDO0FBQzNKLDhCQUE4QixtQkFBTyxDQUFDLDRHQUE4QjtBQUNwRSxxREFBb0QsRUFBRSxxQ0FBcUMsbURBQW1ELEVBQUM7QUFDL0ksYUFBYSxtQkFBTyxDQUFDLDREQUFNO0FBQzNCLHNDQUFxQyxFQUFFLHFDQUFxQyxtQkFBbUIsRUFBQztBQUNoRyxpQkFBaUIsbUJBQU8sQ0FBQywwRUFBVTtBQUNuQyxnREFBK0MsRUFBRSxxQ0FBcUMsaUNBQWlDLEVBQUM7QUFDeEgsbUJBQW1CLG1CQUFPLENBQUMsc0ZBQW1CO0FBQzlDLDBEQUF5RCxFQUFFLHFDQUFxQyw2Q0FBNkMsRUFBQztBQUM5SSxpQkFBaUIsbUJBQU8sQ0FBQyxrRkFBaUI7QUFDMUMsMkRBQTBELEVBQUUscUNBQXFDLDRDQUE0QyxFQUFDO0FBQzlJLHVCQUF1QixtQkFBTyxDQUFDLGdGQUFnQjtBQUMvQywrQ0FBOEMsRUFBRSxxQ0FBcUMsc0NBQXNDLEVBQUM7QUFDNUgsc0JBQXNCLG1CQUFPLENBQUMsOEVBQWU7QUFDN0MscURBQW9ELEVBQUUscUNBQXFDLDJDQUEyQyxFQUFDO0FBQ3ZJLG1CQUFtQixtQkFBTyxDQUFDLHdFQUFZO0FBQ3ZDLGlEQUFnRCxFQUFFLHFDQUFxQyxvQ0FBb0MsRUFBQztBQUM1SDtBQUNBLGFBQWEsbUJBQU8sQ0FBQyxnRUFBUTtBQUM3Qix3Q0FBdUMsRUFBRSxxQ0FBcUMsdUJBQXVCLEVBQUM7QUFDdEcsYUFBYSxtQkFBTyxDQUFDLGdFQUFRO0FBQzdCLDBDQUF5QyxFQUFFLHFDQUFxQyx5QkFBeUIsRUFBQztBQUMxRyw4Q0FBNkMsRUFBRSxxQ0FBcUMsNkJBQTZCLEVBQUM7QUFDbEgsOENBQTZDLEVBQUUscUNBQXFDLDZCQUE2QixFQUFDO0FBQ2xILDRDQUEyQyxFQUFFLHFDQUFxQywyQkFBMkIsRUFBQztBQUM5Ryx3Q0FBdUMsRUFBRSxxQ0FBcUMsdUJBQXVCLEVBQUM7QUFDdEcseUNBQXdDLEVBQUUscUNBQXFDLHdCQUF3QixFQUFDO0FBQ3hHLDhDQUE2QyxFQUFFLHFDQUFxQyw2QkFBNkIsRUFBQztBQUNsSCwwQ0FBeUMsRUFBRSxxQ0FBcUMseUJBQXlCLEVBQUM7QUFDMUcseUNBQXdDLEVBQUUscUNBQXFDLHdCQUF3QixFQUFDO0FBQ3hHLHdDQUF1QyxFQUFFLHFDQUFxQyx1QkFBdUIsRUFBQztBQUN0RywwQ0FBeUMsRUFBRSxxQ0FBcUMseUJBQXlCLEVBQUM7QUFDMUcsMENBQXlDLEVBQUUscUNBQXFDLHlCQUF5QixFQUFDO0FBQzFHLDRDQUEyQyxFQUFFLHFDQUFxQywyQkFBMkIsRUFBQztBQUM5Ryw2Q0FBNEMsRUFBRSxxQ0FBcUMsNEJBQTRCLEVBQUM7QUFDaEgsZUFBZSxtQkFBTyxDQUFDLDhFQUFlO0FBQ3RDLHVEQUFzRCxFQUFFLHFDQUFxQyx3Q0FBd0MsRUFBQztBQUN0SSw2QkFBNkIsbUJBQU8sQ0FBQyw4R0FBK0I7QUFDcEUsc0RBQXFELEVBQUUscUNBQXFDLHFEQUFxRCxFQUFDO0FBQ2xKLGNBQWMsbUJBQU8sQ0FBQyxrRUFBUztBQUMvQixpREFBZ0QsRUFBRSxxQ0FBcUMsaUNBQWlDLEVBQUM7QUFDekgsaURBQWdELEVBQUUscUNBQXFDLGlDQUFpQyxFQUFDO0FBQ3pILG1EQUFrRCxFQUFFLHFDQUFxQyxtQ0FBbUMsRUFBQztBQUM3SCw4REFBNkQsRUFBRSxxQ0FBcUMsOENBQThDLEVBQUM7QUFDbkosMERBQXlELEVBQUUscUNBQXFDLDBDQUEwQyxFQUFDO0FBQzNJLDJEQUEwRCxFQUFFLHFDQUFxQywyQ0FBMkMsRUFBQztBQUM3SSw2REFBNEQsRUFBRSxxQ0FBcUMsNkNBQTZDLEVBQUM7QUFDakoseURBQXdELEVBQUUscUNBQXFDLHlDQUF5QyxFQUFDO0FBQ3pJLDJEQUEwRCxFQUFFLHFDQUFxQywyQ0FBMkMsRUFBQztBQUM3SSxvREFBbUQsRUFBRSxxQ0FBcUMsb0NBQW9DLEVBQUM7QUFDL0gsOENBQTZDLEVBQUUscUNBQXFDLDhCQUE4QixFQUFDO0FBQ25ILDREQUEyRCxFQUFFLHFDQUFxQyw0Q0FBNEMsRUFBQztBQUMvSSx5REFBd0QsRUFBRSxxQ0FBcUMseUNBQXlDLEVBQUM7QUFDekksMERBQXlELEVBQUUscUNBQXFDLDBDQUEwQyxFQUFDO0FBQzNJLDZEQUE0RCxFQUFFLHFDQUFxQyw2Q0FBNkMsRUFBQztBQUNqSixzREFBcUQsRUFBRSxxQ0FBcUMsc0NBQXNDLEVBQUM7QUFDbkksZ0VBQStELEVBQUUscUNBQXFDLGdEQUFnRCxFQUFDO0FBQ3ZKLCtEQUE4RCxFQUFFLHFDQUFxQywrQ0FBK0MsRUFBQztBQUNySixxREFBb0QsRUFBRSxxQ0FBcUMscUNBQXFDLEVBQUM7QUFDakksNERBQTJELEVBQUUscUNBQXFDLDRDQUE0QyxFQUFDO0FBQy9JLDBEQUF5RCxFQUFFLHFDQUFxQywwQ0FBMEMsRUFBQztBQUMzSSxtREFBa0QsRUFBRSxxQ0FBcUMsbUNBQW1DLEVBQUM7QUFDN0gscURBQW9ELEVBQUUscUNBQXFDLHFDQUFxQyxFQUFDO0FBQ2pJLDBEQUF5RCxFQUFFLHFDQUFxQywwQ0FBMEMsRUFBQztBQUMzSSxvREFBbUQsRUFBRSxxQ0FBcUMsb0NBQW9DLEVBQUM7QUFDL0gsNkRBQTRELEVBQUUscUNBQXFDLDZDQUE2QyxFQUFDO0FBQ2pKLG9EQUFtRCxFQUFFLHFDQUFxQyxvQ0FBb0MsRUFBQztBQUMvSCw0REFBMkQsRUFBRSxxQ0FBcUMsNENBQTRDLEVBQUM7QUFDL0ksNERBQTJELEVBQUUscUNBQXFDLDRDQUE0QyxFQUFDO0FBQy9JLHlEQUF3RCxFQUFFLHFDQUFxQyx5Q0FBeUMsRUFBQztBQUN6SSxzRUFBcUUsRUFBRSxxQ0FBcUMsc0RBQXNELEVBQUM7QUFDbkssMERBQXlELEVBQUUscUNBQXFDLDBDQUEwQyxFQUFDO0FBQzNJO0FBQ0EsZUFBZSxtQkFBTyxDQUFDLDhFQUFlO0FBQ3RDLDZDQUE0QyxFQUFFLHFDQUFxQyw4QkFBOEIsRUFBQztBQUNsSCxlQUFlLG1CQUFPLENBQUMsd0ZBQW9CO0FBQzNDLCtEQUE4RCxFQUFFLHFDQUFxQyxnREFBZ0QsRUFBQztBQUN0SixrQkFBa0IsbUJBQU8sQ0FBQyw4RkFBdUI7QUFDakQsaURBQWdELEVBQUUscUNBQXFDLHFDQUFxQyxFQUFDO0FBQzdILG9CQUFvQixtQkFBTyxDQUFDLG9IQUFrQztBQUM5RCw4Q0FBNkMsRUFBRSxxQ0FBcUMsb0NBQW9DLEVBQUM7QUFDekgsd0JBQXdCLG1CQUFPLENBQUMsb0dBQTBCO0FBQzFELGdEQUErQyxFQUFFLHFDQUFxQywwQ0FBMEMsRUFBQztBQUNqSSxhQUFhLG1CQUFPLENBQUMsZ0VBQVE7QUFDN0IsNkRBQTRELEVBQUUscUNBQXFDLDRDQUE0QyxFQUFDO0FBQ2hKLGNBQWMsbUJBQU8sQ0FBQyxrRUFBUztBQUMvQixtREFBa0QsRUFBRSxxQ0FBcUMsbUNBQW1DLEVBQUM7QUFDN0gsZ0JBQWdCLG1CQUFPLENBQUMsc0VBQVc7QUFDbkMsb0RBQW1ELEVBQUUscUNBQXFDLHNDQUFzQyxFQUFDO0FBQ2pJLHFCQUFxQixtQkFBTyxDQUFDLGdGQUFnQjtBQUM3QyxvREFBbUQsRUFBRSxxQ0FBcUMsMkNBQTJDLEVBQUM7QUFDdEksd0JBQXdCLG1CQUFPLENBQUMsNEdBQThCO0FBQzlELGtEQUFpRCxFQUFFLHFDQUFxQyw0Q0FBNEMsRUFBQztBQUNySSw0QkFBNEIsbUJBQU8sQ0FBQyxvSEFBa0M7QUFDdEUsa0RBQWlELEVBQUUscUNBQXFDLGdEQUFnRCxFQUFDO0FBQ3pJLHFCQUFxQixtQkFBTyxDQUFDLGdGQUFnQjtBQUM3QyxvREFBbUQsRUFBRSxxQ0FBcUMsMkNBQTJDLEVBQUM7QUFDdEksd0JBQXdCLG1CQUFPLENBQUMsc0ZBQW1CO0FBQ25ELHNEQUFxRCxFQUFFLHFDQUFxQyxnREFBZ0QsRUFBQztBQUM3SSxlQUFlLG1CQUFPLENBQUMsOEVBQWU7QUFDdEMsOENBQTZDLEVBQUUscUNBQXFDLCtCQUErQixFQUFDO0FBQ3BILGdEQUErQyxFQUFFLHFDQUFxQyxpQ0FBaUMsRUFBQztBQUN4SDtBQUNBLHFCQUFxQixtQkFBTyxDQUFDLGdGQUFnQjtBQUM3QywrQ0FBOEMsRUFBRSxxQ0FBcUMsc0NBQXNDLEVBQUM7QUFDNUgsd0JBQXdCLG1CQUFPLENBQUMsc0ZBQW1CO0FBQ25ELGtEQUFpRCxFQUFFLHFDQUFxQyw0Q0FBNEMsRUFBQztBQUNySSxzQkFBc0IsbUJBQU8sQ0FBQyxrRkFBaUI7QUFDL0MsZ0RBQStDLEVBQUUscUNBQXFDLHdDQUF3QyxFQUFDO0FBQy9IO0FBQ0Esa0NBQWtDLG1CQUFPLENBQUMsb0hBQWtDO0FBQzVFLHNEQUFxRCxFQUFFLHFDQUFxQywwREFBMEQsRUFBQztBQUN2Six1REFBc0QsRUFBRSxxQ0FBcUMsMkRBQTJELEVBQUM7QUFDekoseURBQXdELEVBQUUscUNBQXFDLDZEQUE2RCxFQUFDO0FBQzdKLCtCQUErQixtQkFBTyxDQUFDLDhHQUErQjtBQUN0RSw0REFBMkQsRUFBRSxxQ0FBcUMsNkRBQTZELEVBQUM7QUFDaEssNkRBQTRELEVBQUUscUNBQXFDLDhEQUE4RCxFQUFDO0FBQ2xLLGlFQUFnRSxFQUFFLHFDQUFxQyxrRUFBa0UsRUFBQztBQUMxSyxrRUFBaUUsRUFBRSxxQ0FBcUMsbUVBQW1FLEVBQUM7QUFDNUsseURBQXdELEVBQUUscUNBQXFDLDBEQUEwRCxFQUFDO0FBQzFKLDBEQUF5RCxFQUFFLHFDQUFxQywyREFBMkQsRUFBQztBQUM1Siw4REFBNkQsRUFBRSxxQ0FBcUMsK0RBQStELEVBQUM7QUFDcEssNkRBQTRELEVBQUUscUNBQXFDLDhEQUE4RCxFQUFDO0FBQ2xLLDhEQUE2RCxFQUFFLHFDQUFxQywrREFBK0QsRUFBQztBQUNwSyxpRUFBZ0UsRUFBRSxxQ0FBcUMsa0VBQWtFLEVBQUM7QUFDMUssNERBQTJELEVBQUUscUNBQXFDLDZEQUE2RCxFQUFDO0FBQ2hLLHdEQUF1RCxFQUFFLHFDQUFxQyx5REFBeUQsRUFBQztBQUN4SixlQUFlLG1CQUFPLENBQUMsOEVBQWU7QUFDdEMscURBQW9ELEVBQUUscUNBQXFDLHNDQUFzQyxFQUFDO0FBQ2xJLGlFQUFnRSxFQUFFLHFDQUFxQyxrREFBa0QsRUFBQztBQUMxSiw4REFBNkQsRUFBRSxxQ0FBcUMsK0NBQStDLEVBQUM7QUFDcEosK0RBQThELEVBQUUscUNBQXFDLGdEQUFnRCxFQUFDO0FBQ3RKLGlFQUFnRSxFQUFFLHFDQUFxQyxrREFBa0QsRUFBQztBQUMxSixzREFBcUQsRUFBRSxxQ0FBcUMsdUNBQXVDLEVBQUM7QUFDcEksdURBQXNELEVBQUUscUNBQXFDLHdDQUF3QyxFQUFDO0FBQ3RJLG1FQUFrRSxFQUFFLHFDQUFxQyxvREFBb0QsRUFBQztBQUM5Six3REFBdUQsRUFBRSxxQ0FBcUMseUNBQXlDLEVBQUM7QUFDeEksb0JBQW9CLG1CQUFPLENBQUMsd0ZBQW9CO0FBQ2hELG1EQUFrRCxFQUFFLHFDQUFxQyx5Q0FBeUMsRUFBQztBQUNuSSIsInNvdXJjZXMiOlsiRDpcXHNhbG9uaVxcYXBwcmFpc2FsLXN5c3RlbVxcc2VydmVyXFxub2RlX21vZHVsZXNcXG1vbmdvZGJcXGxpYlxcaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkFic3RyYWN0Q3Vyc29yID0gZXhwb3J0cy5Nb25nb1dyaXRlQ29uY2VybkVycm9yID0gZXhwb3J0cy5Nb25nb1VuZXhwZWN0ZWRTZXJ2ZXJSZXNwb25zZUVycm9yID0gZXhwb3J0cy5Nb25nb1RyYW5zYWN0aW9uRXJyb3IgPSBleHBvcnRzLk1vbmdvVG9wb2xvZ3lDbG9zZWRFcnJvciA9IGV4cG9ydHMuTW9uZ29UYWlsYWJsZUN1cnNvckVycm9yID0gZXhwb3J0cy5Nb25nb1N5c3RlbUVycm9yID0gZXhwb3J0cy5Nb25nb1NlcnZlclNlbGVjdGlvbkVycm9yID0gZXhwb3J0cy5Nb25nb1NlcnZlckVycm9yID0gZXhwb3J0cy5Nb25nb1NlcnZlckNsb3NlZEVycm9yID0gZXhwb3J0cy5Nb25nb1J1bnRpbWVFcnJvciA9IGV4cG9ydHMuTW9uZ29QYXJzZUVycm9yID0gZXhwb3J0cy5Nb25nb05vdENvbm5lY3RlZEVycm9yID0gZXhwb3J0cy5Nb25nb05ldHdvcmtUaW1lb3V0RXJyb3IgPSBleHBvcnRzLk1vbmdvTmV0d29ya0Vycm9yID0gZXhwb3J0cy5Nb25nb01pc3NpbmdEZXBlbmRlbmN5RXJyb3IgPSBleHBvcnRzLk1vbmdvTWlzc2luZ0NyZWRlbnRpYWxzRXJyb3IgPSBleHBvcnRzLk1vbmdvS2VyYmVyb3NFcnJvciA9IGV4cG9ydHMuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvciA9IGV4cG9ydHMuTW9uZ29HcmlkRlNTdHJlYW1FcnJvciA9IGV4cG9ydHMuTW9uZ29HcmlkRlNDaHVua0Vycm9yID0gZXhwb3J0cy5Nb25nb0V4cGlyZWRTZXNzaW9uRXJyb3IgPSBleHBvcnRzLk1vbmdvRXJyb3IgPSBleHBvcnRzLk1vbmdvRHJpdmVyRXJyb3IgPSBleHBvcnRzLk1vbmdvRGVjb21wcmVzc2lvbkVycm9yID0gZXhwb3J0cy5Nb25nb0N1cnNvckluVXNlRXJyb3IgPSBleHBvcnRzLk1vbmdvQ3Vyc29yRXhoYXVzdGVkRXJyb3IgPSBleHBvcnRzLk1vbmdvQ29tcGF0aWJpbGl0eUVycm9yID0gZXhwb3J0cy5Nb25nb0NoYW5nZVN0cmVhbUVycm9yID0gZXhwb3J0cy5Nb25nb0JhdGNoUmVFeGVjdXRpb25FcnJvciA9IGV4cG9ydHMuTW9uZ29BenVyZUVycm9yID0gZXhwb3J0cy5Nb25nb0FXU0Vycm9yID0gZXhwb3J0cy5Nb25nb0FQSUVycm9yID0gZXhwb3J0cy5DaGFuZ2VTdHJlYW1DdXJzb3IgPSBleHBvcnRzLk1vbmdvQnVsa1dyaXRlRXJyb3IgPSBleHBvcnRzLlRpbWVzdGFtcCA9IGV4cG9ydHMuT2JqZWN0SWQgPSBleHBvcnRzLk1pbktleSA9IGV4cG9ydHMuTWF4S2V5ID0gZXhwb3J0cy5Mb25nID0gZXhwb3J0cy5JbnQzMiA9IGV4cG9ydHMuRG91YmxlID0gZXhwb3J0cy5EZWNpbWFsMTI4ID0gZXhwb3J0cy5EQlJlZiA9IGV4cG9ydHMuQ29kZSA9IGV4cG9ydHMuQlNPTlR5cGUgPSBleHBvcnRzLkJTT05TeW1ib2wgPSBleHBvcnRzLkJTT05SZWdFeHAgPSBleHBvcnRzLkJpbmFyeSA9IGV4cG9ydHMuQlNPTiA9IHZvaWQgMDtcbmV4cG9ydHMuU2VydmVyQ2xvc2VkRXZlbnQgPSBleHBvcnRzLkNvbm5lY3Rpb25SZWFkeUV2ZW50ID0gZXhwb3J0cy5Db25uZWN0aW9uUG9vbFJlYWR5RXZlbnQgPSBleHBvcnRzLkNvbm5lY3Rpb25Qb29sTW9uaXRvcmluZ0V2ZW50ID0gZXhwb3J0cy5Db25uZWN0aW9uUG9vbENyZWF0ZWRFdmVudCA9IGV4cG9ydHMuQ29ubmVjdGlvblBvb2xDbG9zZWRFdmVudCA9IGV4cG9ydHMuQ29ubmVjdGlvblBvb2xDbGVhcmVkRXZlbnQgPSBleHBvcnRzLkNvbm5lY3Rpb25DcmVhdGVkRXZlbnQgPSBleHBvcnRzLkNvbm5lY3Rpb25DbG9zZWRFdmVudCA9IGV4cG9ydHMuQ29ubmVjdGlvbkNoZWNrT3V0U3RhcnRlZEV2ZW50ID0gZXhwb3J0cy5Db25uZWN0aW9uQ2hlY2tPdXRGYWlsZWRFdmVudCA9IGV4cG9ydHMuQ29ubmVjdGlvbkNoZWNrZWRPdXRFdmVudCA9IGV4cG9ydHMuQ29ubmVjdGlvbkNoZWNrZWRJbkV2ZW50ID0gZXhwb3J0cy5Db21tYW5kU3VjY2VlZGVkRXZlbnQgPSBleHBvcnRzLkNvbW1hbmRTdGFydGVkRXZlbnQgPSBleHBvcnRzLkNvbW1hbmRGYWlsZWRFdmVudCA9IGV4cG9ydHMuV3JpdGVDb25jZXJuID0gZXhwb3J0cy5SZWFkUHJlZmVyZW5jZSA9IGV4cG9ydHMuUmVhZENvbmNlcm4gPSBleHBvcnRzLlRvcG9sb2d5VHlwZSA9IGV4cG9ydHMuU2VydmVyVHlwZSA9IGV4cG9ydHMuUmVhZFByZWZlcmVuY2VNb2RlID0gZXhwb3J0cy5SZWFkQ29uY2VybkxldmVsID0gZXhwb3J0cy5Qcm9maWxpbmdMZXZlbCA9IGV4cG9ydHMuUmV0dXJuRG9jdW1lbnQgPSBleHBvcnRzLlNlcnZlckFwaVZlcnNpb24gPSBleHBvcnRzLkV4cGxhaW5WZXJib3NpdHkgPSBleHBvcnRzLk1vbmdvRXJyb3JMYWJlbCA9IGV4cG9ydHMuQXV0b0VuY3J5cHRpb25Mb2dnZXJMZXZlbCA9IGV4cG9ydHMuQ1VSU09SX0ZMQUdTID0gZXhwb3J0cy5Db21wcmVzc29yID0gZXhwb3J0cy5BdXRoTWVjaGFuaXNtID0gZXhwb3J0cy5HU1NBUElDYW5vbmljYWxpemF0aW9uVmFsdWUgPSBleHBvcnRzLkJhdGNoVHlwZSA9IGV4cG9ydHMuVW5vcmRlcmVkQnVsa09wZXJhdGlvbiA9IGV4cG9ydHMuT3JkZXJlZEJ1bGtPcGVyYXRpb24gPSBleHBvcnRzLk1vbmdvQ2xpZW50ID0gZXhwb3J0cy5MaXN0SW5kZXhlc0N1cnNvciA9IGV4cG9ydHMuTGlzdENvbGxlY3Rpb25zQ3Vyc29yID0gZXhwb3J0cy5HcmlkRlNCdWNrZXRXcml0ZVN0cmVhbSA9IGV4cG9ydHMuR3JpZEZTQnVja2V0UmVhZFN0cmVhbSA9IGV4cG9ydHMuR3JpZEZTQnVja2V0ID0gZXhwb3J0cy5GaW5kQ3Vyc29yID0gZXhwb3J0cy5EYiA9IGV4cG9ydHMuQ29sbGVjdGlvbiA9IGV4cG9ydHMuQ2xpZW50U2Vzc2lvbiA9IGV4cG9ydHMuQ2hhbmdlU3RyZWFtID0gZXhwb3J0cy5DYW5jZWxsYXRpb25Ub2tlbiA9IGV4cG9ydHMuQWdncmVnYXRpb25DdXJzb3IgPSBleHBvcnRzLkFkbWluID0gdm9pZCAwO1xuZXhwb3J0cy5TcnZQb2xsaW5nRXZlbnQgPSBleHBvcnRzLlRvcG9sb2d5T3BlbmluZ0V2ZW50ID0gZXhwb3J0cy5Ub3BvbG9neURlc2NyaXB0aW9uQ2hhbmdlZEV2ZW50ID0gZXhwb3J0cy5Ub3BvbG9neUNsb3NlZEV2ZW50ID0gZXhwb3J0cy5TZXJ2ZXJPcGVuaW5nRXZlbnQgPSBleHBvcnRzLlNlcnZlckhlYXJ0YmVhdFN1Y2NlZWRlZEV2ZW50ID0gZXhwb3J0cy5TZXJ2ZXJIZWFydGJlYXRTdGFydGVkRXZlbnQgPSBleHBvcnRzLlNlcnZlckhlYXJ0YmVhdEZhaWxlZEV2ZW50ID0gZXhwb3J0cy5TZXJ2ZXJEZXNjcmlwdGlvbkNoYW5nZWRFdmVudCA9IHZvaWQgMDtcbmNvbnN0IGFkbWluXzEgPSByZXF1aXJlKFwiLi9hZG1pblwiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIkFkbWluXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBhZG1pbl8xLkFkbWluOyB9IH0pO1xuY29uc3Qgb3JkZXJlZF8xID0gcmVxdWlyZShcIi4vYnVsay9vcmRlcmVkXCIpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiT3JkZXJlZEJ1bGtPcGVyYXRpb25cIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIG9yZGVyZWRfMS5PcmRlcmVkQnVsa09wZXJhdGlvbjsgfSB9KTtcbmNvbnN0IHVub3JkZXJlZF8xID0gcmVxdWlyZShcIi4vYnVsay91bm9yZGVyZWRcIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJVbm9yZGVyZWRCdWxrT3BlcmF0aW9uXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiB1bm9yZGVyZWRfMS5Vbm9yZGVyZWRCdWxrT3BlcmF0aW9uOyB9IH0pO1xuY29uc3QgY2hhbmdlX3N0cmVhbV8xID0gcmVxdWlyZShcIi4vY2hhbmdlX3N0cmVhbVwiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIkNoYW5nZVN0cmVhbVwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gY2hhbmdlX3N0cmVhbV8xLkNoYW5nZVN0cmVhbTsgfSB9KTtcbmNvbnN0IGNvbGxlY3Rpb25fMSA9IHJlcXVpcmUoXCIuL2NvbGxlY3Rpb25cIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJDb2xsZWN0aW9uXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBjb2xsZWN0aW9uXzEuQ29sbGVjdGlvbjsgfSB9KTtcbmNvbnN0IGFic3RyYWN0X2N1cnNvcl8xID0gcmVxdWlyZShcIi4vY3Vyc29yL2Fic3RyYWN0X2N1cnNvclwiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIkFic3RyYWN0Q3Vyc29yXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBhYnN0cmFjdF9jdXJzb3JfMS5BYnN0cmFjdEN1cnNvcjsgfSB9KTtcbmNvbnN0IGFnZ3JlZ2F0aW9uX2N1cnNvcl8xID0gcmVxdWlyZShcIi4vY3Vyc29yL2FnZ3JlZ2F0aW9uX2N1cnNvclwiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIkFnZ3JlZ2F0aW9uQ3Vyc29yXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBhZ2dyZWdhdGlvbl9jdXJzb3JfMS5BZ2dyZWdhdGlvbkN1cnNvcjsgfSB9KTtcbmNvbnN0IGZpbmRfY3Vyc29yXzEgPSByZXF1aXJlKFwiLi9jdXJzb3IvZmluZF9jdXJzb3JcIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJGaW5kQ3Vyc29yXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBmaW5kX2N1cnNvcl8xLkZpbmRDdXJzb3I7IH0gfSk7XG5jb25zdCBsaXN0X2NvbGxlY3Rpb25zX2N1cnNvcl8xID0gcmVxdWlyZShcIi4vY3Vyc29yL2xpc3RfY29sbGVjdGlvbnNfY3Vyc29yXCIpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiTGlzdENvbGxlY3Rpb25zQ3Vyc29yXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBsaXN0X2NvbGxlY3Rpb25zX2N1cnNvcl8xLkxpc3RDb2xsZWN0aW9uc0N1cnNvcjsgfSB9KTtcbmNvbnN0IGxpc3RfaW5kZXhlc19jdXJzb3JfMSA9IHJlcXVpcmUoXCIuL2N1cnNvci9saXN0X2luZGV4ZXNfY3Vyc29yXCIpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiTGlzdEluZGV4ZXNDdXJzb3JcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGxpc3RfaW5kZXhlc19jdXJzb3JfMS5MaXN0SW5kZXhlc0N1cnNvcjsgfSB9KTtcbmNvbnN0IGRiXzEgPSByZXF1aXJlKFwiLi9kYlwiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIkRiXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBkYl8xLkRiOyB9IH0pO1xuY29uc3QgZ3JpZGZzXzEgPSByZXF1aXJlKFwiLi9ncmlkZnNcIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJHcmlkRlNCdWNrZXRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGdyaWRmc18xLkdyaWRGU0J1Y2tldDsgfSB9KTtcbmNvbnN0IGRvd25sb2FkXzEgPSByZXF1aXJlKFwiLi9ncmlkZnMvZG93bmxvYWRcIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJHcmlkRlNCdWNrZXRSZWFkU3RyZWFtXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBkb3dubG9hZF8xLkdyaWRGU0J1Y2tldFJlYWRTdHJlYW07IH0gfSk7XG5jb25zdCB1cGxvYWRfMSA9IHJlcXVpcmUoXCIuL2dyaWRmcy91cGxvYWRcIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJHcmlkRlNCdWNrZXRXcml0ZVN0cmVhbVwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdXBsb2FkXzEuR3JpZEZTQnVja2V0V3JpdGVTdHJlYW07IH0gfSk7XG5jb25zdCBtb25nb19jbGllbnRfMSA9IHJlcXVpcmUoXCIuL21vbmdvX2NsaWVudFwiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIk1vbmdvQ2xpZW50XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBtb25nb19jbGllbnRfMS5Nb25nb0NsaWVudDsgfSB9KTtcbmNvbnN0IG1vbmdvX3R5cGVzXzEgPSByZXF1aXJlKFwiLi9tb25nb190eXBlc1wiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIkNhbmNlbGxhdGlvblRva2VuXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBtb25nb190eXBlc18xLkNhbmNlbGxhdGlvblRva2VuOyB9IH0pO1xuY29uc3Qgc2Vzc2lvbnNfMSA9IHJlcXVpcmUoXCIuL3Nlc3Npb25zXCIpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiQ2xpZW50U2Vzc2lvblwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gc2Vzc2lvbnNfMS5DbGllbnRTZXNzaW9uOyB9IH0pO1xuLyoqIEBwdWJsaWMgKi9cbnZhciBic29uXzEgPSByZXF1aXJlKFwiLi9ic29uXCIpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiQlNPTlwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gYnNvbl8xLkJTT047IH0gfSk7XG52YXIgYnNvbl8yID0gcmVxdWlyZShcIi4vYnNvblwiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIkJpbmFyeVwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gYnNvbl8yLkJpbmFyeTsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIkJTT05SZWdFeHBcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGJzb25fMi5CU09OUmVnRXhwOyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiQlNPTlN5bWJvbFwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gYnNvbl8yLkJTT05TeW1ib2w7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJCU09OVHlwZVwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gYnNvbl8yLkJTT05UeXBlOyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiQ29kZVwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gYnNvbl8yLkNvZGU7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJEQlJlZlwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gYnNvbl8yLkRCUmVmOyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiRGVjaW1hbDEyOFwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gYnNvbl8yLkRlY2ltYWwxMjg7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJEb3VibGVcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGJzb25fMi5Eb3VibGU7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJJbnQzMlwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gYnNvbl8yLkludDMyOyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiTG9uZ1wiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gYnNvbl8yLkxvbmc7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJNYXhLZXlcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGJzb25fMi5NYXhLZXk7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJNaW5LZXlcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGJzb25fMi5NaW5LZXk7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJPYmplY3RJZFwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gYnNvbl8yLk9iamVjdElkOyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiVGltZXN0YW1wXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBic29uXzIuVGltZXN0YW1wOyB9IH0pO1xudmFyIGNvbW1vbl8xID0gcmVxdWlyZShcIi4vYnVsay9jb21tb25cIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJNb25nb0J1bGtXcml0ZUVycm9yXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBjb21tb25fMS5Nb25nb0J1bGtXcml0ZUVycm9yOyB9IH0pO1xudmFyIGNoYW5nZV9zdHJlYW1fY3Vyc29yXzEgPSByZXF1aXJlKFwiLi9jdXJzb3IvY2hhbmdlX3N0cmVhbV9jdXJzb3JcIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJDaGFuZ2VTdHJlYW1DdXJzb3JcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGNoYW5nZV9zdHJlYW1fY3Vyc29yXzEuQ2hhbmdlU3RyZWFtQ3Vyc29yOyB9IH0pO1xudmFyIGVycm9yXzEgPSByZXF1aXJlKFwiLi9lcnJvclwiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIk1vbmdvQVBJRXJyb3JcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGVycm9yXzEuTW9uZ29BUElFcnJvcjsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIk1vbmdvQVdTRXJyb3JcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGVycm9yXzEuTW9uZ29BV1NFcnJvcjsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIk1vbmdvQXp1cmVFcnJvclwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gZXJyb3JfMS5Nb25nb0F6dXJlRXJyb3I7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJNb25nb0JhdGNoUmVFeGVjdXRpb25FcnJvclwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gZXJyb3JfMS5Nb25nb0JhdGNoUmVFeGVjdXRpb25FcnJvcjsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIk1vbmdvQ2hhbmdlU3RyZWFtRXJyb3JcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGVycm9yXzEuTW9uZ29DaGFuZ2VTdHJlYW1FcnJvcjsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIk1vbmdvQ29tcGF0aWJpbGl0eUVycm9yXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBlcnJvcl8xLk1vbmdvQ29tcGF0aWJpbGl0eUVycm9yOyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiTW9uZ29DdXJzb3JFeGhhdXN0ZWRFcnJvclwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gZXJyb3JfMS5Nb25nb0N1cnNvckV4aGF1c3RlZEVycm9yOyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiTW9uZ29DdXJzb3JJblVzZUVycm9yXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBlcnJvcl8xLk1vbmdvQ3Vyc29ySW5Vc2VFcnJvcjsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIk1vbmdvRGVjb21wcmVzc2lvbkVycm9yXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBlcnJvcl8xLk1vbmdvRGVjb21wcmVzc2lvbkVycm9yOyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiTW9uZ29Ecml2ZXJFcnJvclwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gZXJyb3JfMS5Nb25nb0RyaXZlckVycm9yOyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiTW9uZ29FcnJvclwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gZXJyb3JfMS5Nb25nb0Vycm9yOyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiTW9uZ29FeHBpcmVkU2Vzc2lvbkVycm9yXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBlcnJvcl8xLk1vbmdvRXhwaXJlZFNlc3Npb25FcnJvcjsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIk1vbmdvR3JpZEZTQ2h1bmtFcnJvclwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gZXJyb3JfMS5Nb25nb0dyaWRGU0NodW5rRXJyb3I7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJNb25nb0dyaWRGU1N0cmVhbUVycm9yXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBlcnJvcl8xLk1vbmdvR3JpZEZTU3RyZWFtRXJyb3I7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJNb25nb0ludmFsaWRBcmd1bWVudEVycm9yXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3I7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJNb25nb0tlcmJlcm9zRXJyb3JcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGVycm9yXzEuTW9uZ29LZXJiZXJvc0Vycm9yOyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiTW9uZ29NaXNzaW5nQ3JlZGVudGlhbHNFcnJvclwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gZXJyb3JfMS5Nb25nb01pc3NpbmdDcmVkZW50aWFsc0Vycm9yOyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiTW9uZ29NaXNzaW5nRGVwZW5kZW5jeUVycm9yXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBlcnJvcl8xLk1vbmdvTWlzc2luZ0RlcGVuZGVuY3lFcnJvcjsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIk1vbmdvTmV0d29ya0Vycm9yXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBlcnJvcl8xLk1vbmdvTmV0d29ya0Vycm9yOyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiTW9uZ29OZXR3b3JrVGltZW91dEVycm9yXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBlcnJvcl8xLk1vbmdvTmV0d29ya1RpbWVvdXRFcnJvcjsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIk1vbmdvTm90Q29ubmVjdGVkRXJyb3JcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGVycm9yXzEuTW9uZ29Ob3RDb25uZWN0ZWRFcnJvcjsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIk1vbmdvUGFyc2VFcnJvclwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gZXJyb3JfMS5Nb25nb1BhcnNlRXJyb3I7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJNb25nb1J1bnRpbWVFcnJvclwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gZXJyb3JfMS5Nb25nb1J1bnRpbWVFcnJvcjsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIk1vbmdvU2VydmVyQ2xvc2VkRXJyb3JcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGVycm9yXzEuTW9uZ29TZXJ2ZXJDbG9zZWRFcnJvcjsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIk1vbmdvU2VydmVyRXJyb3JcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGVycm9yXzEuTW9uZ29TZXJ2ZXJFcnJvcjsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIk1vbmdvU2VydmVyU2VsZWN0aW9uRXJyb3JcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGVycm9yXzEuTW9uZ29TZXJ2ZXJTZWxlY3Rpb25FcnJvcjsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIk1vbmdvU3lzdGVtRXJyb3JcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGVycm9yXzEuTW9uZ29TeXN0ZW1FcnJvcjsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIk1vbmdvVGFpbGFibGVDdXJzb3JFcnJvclwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gZXJyb3JfMS5Nb25nb1RhaWxhYmxlQ3Vyc29yRXJyb3I7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJNb25nb1RvcG9sb2d5Q2xvc2VkRXJyb3JcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGVycm9yXzEuTW9uZ29Ub3BvbG9neUNsb3NlZEVycm9yOyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiTW9uZ29UcmFuc2FjdGlvbkVycm9yXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBlcnJvcl8xLk1vbmdvVHJhbnNhY3Rpb25FcnJvcjsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIk1vbmdvVW5leHBlY3RlZFNlcnZlclJlc3BvbnNlRXJyb3JcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGVycm9yXzEuTW9uZ29VbmV4cGVjdGVkU2VydmVyUmVzcG9uc2VFcnJvcjsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIk1vbmdvV3JpdGVDb25jZXJuRXJyb3JcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGVycm9yXzEuTW9uZ29Xcml0ZUNvbmNlcm5FcnJvcjsgfSB9KTtcbi8vIGVudW1zXG52YXIgY29tbW9uXzIgPSByZXF1aXJlKFwiLi9idWxrL2NvbW1vblwiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIkJhdGNoVHlwZVwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gY29tbW9uXzIuQmF0Y2hUeXBlOyB9IH0pO1xudmFyIGdzc2FwaV8xID0gcmVxdWlyZShcIi4vY21hcC9hdXRoL2dzc2FwaVwiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIkdTU0FQSUNhbm9uaWNhbGl6YXRpb25WYWx1ZVwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gZ3NzYXBpXzEuR1NTQVBJQ2Fub25pY2FsaXphdGlvblZhbHVlOyB9IH0pO1xudmFyIHByb3ZpZGVyc18xID0gcmVxdWlyZShcIi4vY21hcC9hdXRoL3Byb3ZpZGVyc1wiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIkF1dGhNZWNoYW5pc21cIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHByb3ZpZGVyc18xLkF1dGhNZWNoYW5pc207IH0gfSk7XG52YXIgY29tcHJlc3Npb25fMSA9IHJlcXVpcmUoXCIuL2NtYXAvd2lyZV9wcm90b2NvbC9jb21wcmVzc2lvblwiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIkNvbXByZXNzb3JcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGNvbXByZXNzaW9uXzEuQ29tcHJlc3NvcjsgfSB9KTtcbnZhciBhYnN0cmFjdF9jdXJzb3JfMiA9IHJlcXVpcmUoXCIuL2N1cnNvci9hYnN0cmFjdF9jdXJzb3JcIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJDVVJTT1JfRkxBR1NcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGFic3RyYWN0X2N1cnNvcl8yLkNVUlNPUl9GTEFHUzsgfSB9KTtcbnZhciBkZXBzXzEgPSByZXF1aXJlKFwiLi9kZXBzXCIpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiQXV0b0VuY3J5cHRpb25Mb2dnZXJMZXZlbFwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gZGVwc18xLkF1dG9FbmNyeXB0aW9uTG9nZ2VyTGV2ZWw7IH0gfSk7XG52YXIgZXJyb3JfMiA9IHJlcXVpcmUoXCIuL2Vycm9yXCIpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiTW9uZ29FcnJvckxhYmVsXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBlcnJvcl8yLk1vbmdvRXJyb3JMYWJlbDsgfSB9KTtcbnZhciBleHBsYWluXzEgPSByZXF1aXJlKFwiLi9leHBsYWluXCIpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiRXhwbGFpblZlcmJvc2l0eVwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gZXhwbGFpbl8xLkV4cGxhaW5WZXJib3NpdHk7IH0gfSk7XG52YXIgbW9uZ29fY2xpZW50XzIgPSByZXF1aXJlKFwiLi9tb25nb19jbGllbnRcIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJTZXJ2ZXJBcGlWZXJzaW9uXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBtb25nb19jbGllbnRfMi5TZXJ2ZXJBcGlWZXJzaW9uOyB9IH0pO1xudmFyIGZpbmRfYW5kX21vZGlmeV8xID0gcmVxdWlyZShcIi4vb3BlcmF0aW9ucy9maW5kX2FuZF9tb2RpZnlcIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJSZXR1cm5Eb2N1bWVudFwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gZmluZF9hbmRfbW9kaWZ5XzEuUmV0dXJuRG9jdW1lbnQ7IH0gfSk7XG52YXIgc2V0X3Byb2ZpbGluZ19sZXZlbF8xID0gcmVxdWlyZShcIi4vb3BlcmF0aW9ucy9zZXRfcHJvZmlsaW5nX2xldmVsXCIpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiUHJvZmlsaW5nTGV2ZWxcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHNldF9wcm9maWxpbmdfbGV2ZWxfMS5Qcm9maWxpbmdMZXZlbDsgfSB9KTtcbnZhciByZWFkX2NvbmNlcm5fMSA9IHJlcXVpcmUoXCIuL3JlYWRfY29uY2VyblwiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIlJlYWRDb25jZXJuTGV2ZWxcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHJlYWRfY29uY2Vybl8xLlJlYWRDb25jZXJuTGV2ZWw7IH0gfSk7XG52YXIgcmVhZF9wcmVmZXJlbmNlXzEgPSByZXF1aXJlKFwiLi9yZWFkX3ByZWZlcmVuY2VcIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJSZWFkUHJlZmVyZW5jZU1vZGVcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHJlYWRfcHJlZmVyZW5jZV8xLlJlYWRQcmVmZXJlbmNlTW9kZTsgfSB9KTtcbnZhciBjb21tb25fMyA9IHJlcXVpcmUoXCIuL3NkYW0vY29tbW9uXCIpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiU2VydmVyVHlwZVwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gY29tbW9uXzMuU2VydmVyVHlwZTsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIlRvcG9sb2d5VHlwZVwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gY29tbW9uXzMuVG9wb2xvZ3lUeXBlOyB9IH0pO1xuLy8gSGVscGVyIGNsYXNzZXNcbnZhciByZWFkX2NvbmNlcm5fMiA9IHJlcXVpcmUoXCIuL3JlYWRfY29uY2VyblwiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIlJlYWRDb25jZXJuXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiByZWFkX2NvbmNlcm5fMi5SZWFkQ29uY2VybjsgfSB9KTtcbnZhciByZWFkX3ByZWZlcmVuY2VfMiA9IHJlcXVpcmUoXCIuL3JlYWRfcHJlZmVyZW5jZVwiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIlJlYWRQcmVmZXJlbmNlXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiByZWFkX3ByZWZlcmVuY2VfMi5SZWFkUHJlZmVyZW5jZTsgfSB9KTtcbnZhciB3cml0ZV9jb25jZXJuXzEgPSByZXF1aXJlKFwiLi93cml0ZV9jb25jZXJuXCIpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiV3JpdGVDb25jZXJuXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiB3cml0ZV9jb25jZXJuXzEuV3JpdGVDb25jZXJuOyB9IH0pO1xuLy8gZXZlbnRzXG52YXIgY29tbWFuZF9tb25pdG9yaW5nX2V2ZW50c18xID0gcmVxdWlyZShcIi4vY21hcC9jb21tYW5kX21vbml0b3JpbmdfZXZlbnRzXCIpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiQ29tbWFuZEZhaWxlZEV2ZW50XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBjb21tYW5kX21vbml0b3JpbmdfZXZlbnRzXzEuQ29tbWFuZEZhaWxlZEV2ZW50OyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiQ29tbWFuZFN0YXJ0ZWRFdmVudFwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gY29tbWFuZF9tb25pdG9yaW5nX2V2ZW50c18xLkNvbW1hbmRTdGFydGVkRXZlbnQ7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJDb21tYW5kU3VjY2VlZGVkRXZlbnRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGNvbW1hbmRfbW9uaXRvcmluZ19ldmVudHNfMS5Db21tYW5kU3VjY2VlZGVkRXZlbnQ7IH0gfSk7XG52YXIgY29ubmVjdGlvbl9wb29sX2V2ZW50c18xID0gcmVxdWlyZShcIi4vY21hcC9jb25uZWN0aW9uX3Bvb2xfZXZlbnRzXCIpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiQ29ubmVjdGlvbkNoZWNrZWRJbkV2ZW50XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBjb25uZWN0aW9uX3Bvb2xfZXZlbnRzXzEuQ29ubmVjdGlvbkNoZWNrZWRJbkV2ZW50OyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiQ29ubmVjdGlvbkNoZWNrZWRPdXRFdmVudFwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gY29ubmVjdGlvbl9wb29sX2V2ZW50c18xLkNvbm5lY3Rpb25DaGVja2VkT3V0RXZlbnQ7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJDb25uZWN0aW9uQ2hlY2tPdXRGYWlsZWRFdmVudFwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gY29ubmVjdGlvbl9wb29sX2V2ZW50c18xLkNvbm5lY3Rpb25DaGVja091dEZhaWxlZEV2ZW50OyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiQ29ubmVjdGlvbkNoZWNrT3V0U3RhcnRlZEV2ZW50XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBjb25uZWN0aW9uX3Bvb2xfZXZlbnRzXzEuQ29ubmVjdGlvbkNoZWNrT3V0U3RhcnRlZEV2ZW50OyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiQ29ubmVjdGlvbkNsb3NlZEV2ZW50XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBjb25uZWN0aW9uX3Bvb2xfZXZlbnRzXzEuQ29ubmVjdGlvbkNsb3NlZEV2ZW50OyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiQ29ubmVjdGlvbkNyZWF0ZWRFdmVudFwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gY29ubmVjdGlvbl9wb29sX2V2ZW50c18xLkNvbm5lY3Rpb25DcmVhdGVkRXZlbnQ7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJDb25uZWN0aW9uUG9vbENsZWFyZWRFdmVudFwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gY29ubmVjdGlvbl9wb29sX2V2ZW50c18xLkNvbm5lY3Rpb25Qb29sQ2xlYXJlZEV2ZW50OyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiQ29ubmVjdGlvblBvb2xDbG9zZWRFdmVudFwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gY29ubmVjdGlvbl9wb29sX2V2ZW50c18xLkNvbm5lY3Rpb25Qb29sQ2xvc2VkRXZlbnQ7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJDb25uZWN0aW9uUG9vbENyZWF0ZWRFdmVudFwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gY29ubmVjdGlvbl9wb29sX2V2ZW50c18xLkNvbm5lY3Rpb25Qb29sQ3JlYXRlZEV2ZW50OyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiQ29ubmVjdGlvblBvb2xNb25pdG9yaW5nRXZlbnRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGNvbm5lY3Rpb25fcG9vbF9ldmVudHNfMS5Db25uZWN0aW9uUG9vbE1vbml0b3JpbmdFdmVudDsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIkNvbm5lY3Rpb25Qb29sUmVhZHlFdmVudFwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gY29ubmVjdGlvbl9wb29sX2V2ZW50c18xLkNvbm5lY3Rpb25Qb29sUmVhZHlFdmVudDsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIkNvbm5lY3Rpb25SZWFkeUV2ZW50XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBjb25uZWN0aW9uX3Bvb2xfZXZlbnRzXzEuQ29ubmVjdGlvblJlYWR5RXZlbnQ7IH0gfSk7XG52YXIgZXZlbnRzXzEgPSByZXF1aXJlKFwiLi9zZGFtL2V2ZW50c1wiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIlNlcnZlckNsb3NlZEV2ZW50XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBldmVudHNfMS5TZXJ2ZXJDbG9zZWRFdmVudDsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIlNlcnZlckRlc2NyaXB0aW9uQ2hhbmdlZEV2ZW50XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBldmVudHNfMS5TZXJ2ZXJEZXNjcmlwdGlvbkNoYW5nZWRFdmVudDsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIlNlcnZlckhlYXJ0YmVhdEZhaWxlZEV2ZW50XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBldmVudHNfMS5TZXJ2ZXJIZWFydGJlYXRGYWlsZWRFdmVudDsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIlNlcnZlckhlYXJ0YmVhdFN0YXJ0ZWRFdmVudFwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gZXZlbnRzXzEuU2VydmVySGVhcnRiZWF0U3RhcnRlZEV2ZW50OyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiU2VydmVySGVhcnRiZWF0U3VjY2VlZGVkRXZlbnRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGV2ZW50c18xLlNlcnZlckhlYXJ0YmVhdFN1Y2NlZWRlZEV2ZW50OyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiU2VydmVyT3BlbmluZ0V2ZW50XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBldmVudHNfMS5TZXJ2ZXJPcGVuaW5nRXZlbnQ7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJUb3BvbG9neUNsb3NlZEV2ZW50XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBldmVudHNfMS5Ub3BvbG9neUNsb3NlZEV2ZW50OyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiVG9wb2xvZ3lEZXNjcmlwdGlvbkNoYW5nZWRFdmVudFwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gZXZlbnRzXzEuVG9wb2xvZ3lEZXNjcmlwdGlvbkNoYW5nZWRFdmVudDsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIlRvcG9sb2d5T3BlbmluZ0V2ZW50XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBldmVudHNfMS5Ub3BvbG9neU9wZW5pbmdFdmVudDsgfSB9KTtcbnZhciBzcnZfcG9sbGluZ18xID0gcmVxdWlyZShcIi4vc2RhbS9zcnZfcG9sbGluZ1wiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIlNydlBvbGxpbmdFdmVudFwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gc3J2X3BvbGxpbmdfMS5TcnZQb2xsaW5nRXZlbnQ7IH0gfSk7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/index.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/mongo_client.js":
/*!**********************************************************!*\
  !*** ../server/node_modules/mongodb/lib/mongo_client.js ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.MongoClient = exports.ServerApiVersion = void 0;\nconst util_1 = __webpack_require__(/*! util */ \"util\");\nconst bson_1 = __webpack_require__(/*! ./bson */ \"(api)/../server/node_modules/mongodb/lib/bson.js\");\nconst change_stream_1 = __webpack_require__(/*! ./change_stream */ \"(api)/../server/node_modules/mongodb/lib/change_stream.js\");\nconst mongo_credentials_1 = __webpack_require__(/*! ./cmap/auth/mongo_credentials */ \"(api)/../server/node_modules/mongodb/lib/cmap/auth/mongo_credentials.js\");\nconst providers_1 = __webpack_require__(/*! ./cmap/auth/providers */ \"(api)/../server/node_modules/mongodb/lib/cmap/auth/providers.js\");\nconst connection_string_1 = __webpack_require__(/*! ./connection_string */ \"(api)/../server/node_modules/mongodb/lib/connection_string.js\");\nconst constants_1 = __webpack_require__(/*! ./constants */ \"(api)/../server/node_modules/mongodb/lib/constants.js\");\nconst db_1 = __webpack_require__(/*! ./db */ \"(api)/../server/node_modules/mongodb/lib/db.js\");\nconst error_1 = __webpack_require__(/*! ./error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst mongo_logger_1 = __webpack_require__(/*! ./mongo_logger */ \"(api)/../server/node_modules/mongodb/lib/mongo_logger.js\");\nconst mongo_types_1 = __webpack_require__(/*! ./mongo_types */ \"(api)/../server/node_modules/mongodb/lib/mongo_types.js\");\nconst read_preference_1 = __webpack_require__(/*! ./read_preference */ \"(api)/../server/node_modules/mongodb/lib/read_preference.js\");\nconst server_selection_1 = __webpack_require__(/*! ./sdam/server_selection */ \"(api)/../server/node_modules/mongodb/lib/sdam/server_selection.js\");\nconst topology_1 = __webpack_require__(/*! ./sdam/topology */ \"(api)/../server/node_modules/mongodb/lib/sdam/topology.js\");\nconst sessions_1 = __webpack_require__(/*! ./sessions */ \"(api)/../server/node_modules/mongodb/lib/sessions.js\");\nconst utils_1 = __webpack_require__(/*! ./utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\n/** @public */\nexports.ServerApiVersion = Object.freeze({\n    v1: '1'\n});\n/** @internal */\nconst kOptions = Symbol('options');\n/**\n * The **MongoClient** class is a class that allows for making Connections to MongoDB.\n * @public\n *\n * @remarks\n * The programmatically provided options take precedence over the URI options.\n *\n * @example\n * ```ts\n * import { MongoClient } from 'mongodb';\n *\n * // Enable command monitoring for debugging\n * const client = new MongoClient('mongodb://localhost:27017', { monitorCommands: true });\n *\n * client.on('commandStarted', started => console.log(started));\n * client.db().collection('pets');\n * await client.insertOne({ name: 'spot', kind: 'dog' });\n * ```\n */\nclass MongoClient extends mongo_types_1.TypedEventEmitter {\n    constructor(url, options) {\n        super();\n        this[kOptions] = (0, connection_string_1.parseOptions)(url, this, options);\n        this.mongoLogger = new mongo_logger_1.MongoLogger(this[kOptions].mongoLoggerOptions);\n        // eslint-disable-next-line @typescript-eslint/no-this-alias\n        const client = this;\n        // The internal state\n        this.s = {\n            url,\n            bsonOptions: (0, bson_1.resolveBSONOptions)(this[kOptions]),\n            namespace: (0, utils_1.ns)('admin'),\n            hasBeenClosed: false,\n            sessionPool: new sessions_1.ServerSessionPool(this),\n            activeSessions: new Set(),\n            get options() {\n                return client[kOptions];\n            },\n            get readConcern() {\n                return client[kOptions].readConcern;\n            },\n            get writeConcern() {\n                return client[kOptions].writeConcern;\n            },\n            get readPreference() {\n                return client[kOptions].readPreference;\n            },\n            get isMongoClient() {\n                return true;\n            }\n        };\n    }\n    /** @see MongoOptions */\n    get options() {\n        return Object.freeze({ ...this[kOptions] });\n    }\n    get serverApi() {\n        return this[kOptions].serverApi && Object.freeze({ ...this[kOptions].serverApi });\n    }\n    /**\n     * Intended for APM use only\n     * @internal\n     */\n    get monitorCommands() {\n        return this[kOptions].monitorCommands;\n    }\n    set monitorCommands(value) {\n        this[kOptions].monitorCommands = value;\n    }\n    /**\n     * @deprecated This method will be removed in the next major version.\n     */\n    get autoEncrypter() {\n        return this[kOptions].autoEncrypter;\n    }\n    get readConcern() {\n        return this.s.readConcern;\n    }\n    get writeConcern() {\n        return this.s.writeConcern;\n    }\n    get readPreference() {\n        return this.s.readPreference;\n    }\n    get bsonOptions() {\n        return this.s.bsonOptions;\n    }\n    /**\n     * Connect to MongoDB using a url\n     *\n     * @see docs.mongodb.org/manual/reference/connection-string/\n     */\n    async connect() {\n        if (this.connectionLock) {\n            return this.connectionLock;\n        }\n        try {\n            this.connectionLock = this._connect();\n            await this.connectionLock;\n        }\n        finally {\n            // release\n            this.connectionLock = undefined;\n        }\n        return this;\n    }\n    /**\n     * Create a topology to open the connection, must be locked to avoid topology leaks in concurrency scenario.\n     * Locking is enforced by the connect method.\n     *\n     * @internal\n     */\n    async _connect() {\n        if (this.topology && this.topology.isConnected()) {\n            return this;\n        }\n        const options = this[kOptions];\n        if (typeof options.srvHost === 'string') {\n            const hosts = await (0, connection_string_1.resolveSRVRecord)(options);\n            for (const [index, host] of hosts.entries()) {\n                options.hosts[index] = host;\n            }\n        }\n        // It is important to perform validation of hosts AFTER SRV resolution, to check the real hostname,\n        // but BEFORE we even attempt connecting with a potentially not allowed hostname\n        if (options.credentials?.mechanism === providers_1.AuthMechanism.MONGODB_OIDC) {\n            const allowedHosts = options.credentials?.mechanismProperties?.ALLOWED_HOSTS || mongo_credentials_1.DEFAULT_ALLOWED_HOSTS;\n            const isServiceAuth = !!options.credentials?.mechanismProperties?.PROVIDER_NAME;\n            if (!isServiceAuth) {\n                for (const host of options.hosts) {\n                    if (!(0, utils_1.hostMatchesWildcards)(host.toHostPort().host, allowedHosts)) {\n                        throw new error_1.MongoInvalidArgumentError(`Host '${host}' is not valid for OIDC authentication with ALLOWED_HOSTS of '${allowedHosts.join(',')}'`);\n                    }\n                }\n            }\n        }\n        this.topology = new topology_1.Topology(this, options.hosts, options);\n        // Events can be emitted before initialization is complete so we have to\n        // save the reference to the topology on the client ASAP if the event handlers need to access it\n        this.topology.once(topology_1.Topology.OPEN, () => this.emit('open', this));\n        for (const event of constants_1.MONGO_CLIENT_EVENTS) {\n            this.topology.on(event, (...args) => this.emit(event, ...args));\n        }\n        const topologyConnect = async () => {\n            try {\n                await (0, util_1.promisify)(callback => this.topology?.connect(options, callback))();\n            }\n            catch (error) {\n                this.topology?.close({ force: true });\n                throw error;\n            }\n        };\n        if (this.autoEncrypter) {\n            const initAutoEncrypter = (0, util_1.promisify)(callback => this.autoEncrypter?.init(callback));\n            await initAutoEncrypter();\n            await topologyConnect();\n            await options.encrypter.connectInternalClient();\n        }\n        else {\n            await topologyConnect();\n        }\n        return this;\n    }\n    /**\n     * Close the client and its underlying connections\n     *\n     * @param force - Force close, emitting no events\n     */\n    async close(force = false) {\n        // There's no way to set hasBeenClosed back to false\n        Object.defineProperty(this.s, 'hasBeenClosed', {\n            value: true,\n            enumerable: true,\n            configurable: false,\n            writable: false\n        });\n        const activeSessionEnds = Array.from(this.s.activeSessions, session => session.endSession());\n        this.s.activeSessions.clear();\n        await Promise.all(activeSessionEnds);\n        if (this.topology == null) {\n            return;\n        }\n        // If we would attempt to select a server and get nothing back we short circuit\n        // to avoid the server selection timeout.\n        const selector = (0, server_selection_1.readPreferenceServerSelector)(read_preference_1.ReadPreference.primaryPreferred);\n        const topologyDescription = this.topology.description;\n        const serverDescriptions = Array.from(topologyDescription.servers.values());\n        const servers = selector(topologyDescription, serverDescriptions);\n        if (servers.length !== 0) {\n            const endSessions = Array.from(this.s.sessionPool.sessions, ({ id }) => id);\n            if (endSessions.length !== 0) {\n                await this.db('admin')\n                    .command({ endSessions }, { readPreference: read_preference_1.ReadPreference.primaryPreferred, noResponse: true })\n                    .catch(() => null); // outcome does not matter\n            }\n        }\n        // clear out references to old topology\n        const topology = this.topology;\n        this.topology = undefined;\n        await new Promise((resolve, reject) => {\n            topology.close({ force }, error => {\n                if (error)\n                    return reject(error);\n                const { encrypter } = this[kOptions];\n                if (encrypter) {\n                    return encrypter.close(this, force, error => {\n                        if (error)\n                            return reject(error);\n                        resolve();\n                    });\n                }\n                resolve();\n            });\n        });\n    }\n    /**\n     * Create a new Db instance sharing the current socket connections.\n     *\n     * @param dbName - The name of the database we want to use. If not provided, use database name from connection string.\n     * @param options - Optional settings for Db construction\n     */\n    db(dbName, options) {\n        options = options ?? {};\n        // Default to db from connection string if not provided\n        if (!dbName) {\n            dbName = this.options.dbName;\n        }\n        // Copy the options and add out internal override of the not shared flag\n        const finalOptions = Object.assign({}, this[kOptions], options);\n        // Return the db object\n        const db = new db_1.Db(this, dbName, finalOptions);\n        // Return the database\n        return db;\n    }\n    /**\n     * Connect to MongoDB using a url\n     *\n     * @remarks\n     * The programmatically provided options take precedence over the URI options.\n     *\n     * @see https://www.mongodb.com/docs/manual/reference/connection-string/\n     */\n    static async connect(url, options) {\n        const client = new this(url, options);\n        return client.connect();\n    }\n    /** Starts a new session on the server */\n    startSession(options) {\n        const session = new sessions_1.ClientSession(this, this.s.sessionPool, { explicit: true, ...options }, this[kOptions]);\n        this.s.activeSessions.add(session);\n        session.once('ended', () => {\n            this.s.activeSessions.delete(session);\n        });\n        return session;\n    }\n    async withSession(optionsOrOperation, callback) {\n        const options = {\n            // Always define an owner\n            owner: Symbol(),\n            // If it's an object inherit the options\n            ...(typeof optionsOrOperation === 'object' ? optionsOrOperation : {})\n        };\n        const withSessionCallback = typeof optionsOrOperation === 'function' ? optionsOrOperation : callback;\n        if (withSessionCallback == null) {\n            throw new error_1.MongoInvalidArgumentError('Missing required callback parameter');\n        }\n        const session = this.startSession(options);\n        try {\n            await withSessionCallback(session);\n        }\n        finally {\n            try {\n                await session.endSession();\n            }\n            catch {\n                // We are not concerned with errors from endSession()\n            }\n        }\n    }\n    /**\n     * Create a new Change Stream, watching for new changes (insertions, updates,\n     * replacements, deletions, and invalidations) in this cluster. Will ignore all\n     * changes to system collections, as well as the local, admin, and config databases.\n     *\n     * @remarks\n     * watch() accepts two generic arguments for distinct use cases:\n     * - The first is to provide the schema that may be defined for all the data within the current cluster\n     * - The second is to override the shape of the change stream document entirely, if it is not provided the type will default to ChangeStreamDocument of the first argument\n     *\n     * @param pipeline - An array of {@link https://www.mongodb.com/docs/manual/reference/operator/aggregation-pipeline/|aggregation pipeline stages} through which to pass change stream documents. This allows for filtering (using $match) and manipulating the change stream documents.\n     * @param options - Optional settings for the command\n     * @typeParam TSchema - Type of the data being detected by the change stream\n     * @typeParam TChange - Type of the whole change stream document emitted\n     */\n    watch(pipeline = [], options = {}) {\n        // Allow optionally not specifying a pipeline\n        if (!Array.isArray(pipeline)) {\n            options = pipeline;\n            pipeline = [];\n        }\n        return new change_stream_1.ChangeStream(this, pipeline, (0, utils_1.resolveOptions)(this, options));\n    }\n}\nexports.MongoClient = MongoClient;\n//# sourceMappingURL=mongo_client.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9tb25nb19jbGllbnQuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsbUJBQW1CLEdBQUcsd0JBQXdCO0FBQzlDLGVBQWUsbUJBQU8sQ0FBQyxrQkFBTTtBQUM3QixlQUFlLG1CQUFPLENBQUMsZ0VBQVE7QUFDL0Isd0JBQXdCLG1CQUFPLENBQUMsa0ZBQWlCO0FBQ2pELDRCQUE0QixtQkFBTyxDQUFDLDhHQUErQjtBQUNuRSxvQkFBb0IsbUJBQU8sQ0FBQyw4RkFBdUI7QUFDbkQsNEJBQTRCLG1CQUFPLENBQUMsMEZBQXFCO0FBQ3pELG9CQUFvQixtQkFBTyxDQUFDLDBFQUFhO0FBQ3pDLGFBQWEsbUJBQU8sQ0FBQyw0REFBTTtBQUMzQixnQkFBZ0IsbUJBQU8sQ0FBQyxrRUFBUztBQUNqQyx1QkFBdUIsbUJBQU8sQ0FBQyxnRkFBZ0I7QUFDL0Msc0JBQXNCLG1CQUFPLENBQUMsOEVBQWU7QUFDN0MsMEJBQTBCLG1CQUFPLENBQUMsc0ZBQW1CO0FBQ3JELDJCQUEyQixtQkFBTyxDQUFDLGtHQUF5QjtBQUM1RCxtQkFBbUIsbUJBQU8sQ0FBQyxrRkFBaUI7QUFDNUMsbUJBQW1CLG1CQUFPLENBQUMsd0VBQVk7QUFDdkMsZ0JBQWdCLG1CQUFPLENBQUMsa0VBQVM7QUFDakM7QUFDQSx3QkFBd0I7QUFDeEI7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksY0FBYztBQUMxQjtBQUNBO0FBQ0EsaUVBQWlFLHVCQUF1QjtBQUN4RjtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsMkJBQTJCO0FBQ3ZEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLG1CQUFtQjtBQUNsRDtBQUNBO0FBQ0EsMkRBQTJELDZCQUE2QjtBQUN4RjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZFQUE2RSxLQUFLLGdFQUFnRSx1QkFBdUI7QUFDeks7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1Q0FBdUMsYUFBYTtBQUNwRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkVBQTJFLElBQUk7QUFDL0U7QUFDQTtBQUNBLCtCQUErQixhQUFhLElBQUkscUZBQXFGO0FBQ3JJLHdDQUF3QztBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkIsT0FBTztBQUNwQztBQUNBO0FBQ0Esd0JBQXdCLFlBQVk7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkNBQTZDO0FBQzdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUZBQWlGLDRCQUE0QjtBQUM3RztBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnRkFBZ0Y7QUFDaEY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0MsZ0hBQWdIO0FBQ3RKO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUNBQXFDO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUI7QUFDbkIiLCJzb3VyY2VzIjpbIkQ6XFxzYWxvbmlcXGFwcHJhaXNhbC1zeXN0ZW1cXHNlcnZlclxcbm9kZV9tb2R1bGVzXFxtb25nb2RiXFxsaWJcXG1vbmdvX2NsaWVudC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuTW9uZ29DbGllbnQgPSBleHBvcnRzLlNlcnZlckFwaVZlcnNpb24gPSB2b2lkIDA7XG5jb25zdCB1dGlsXzEgPSByZXF1aXJlKFwidXRpbFwiKTtcbmNvbnN0IGJzb25fMSA9IHJlcXVpcmUoXCIuL2Jzb25cIik7XG5jb25zdCBjaGFuZ2Vfc3RyZWFtXzEgPSByZXF1aXJlKFwiLi9jaGFuZ2Vfc3RyZWFtXCIpO1xuY29uc3QgbW9uZ29fY3JlZGVudGlhbHNfMSA9IHJlcXVpcmUoXCIuL2NtYXAvYXV0aC9tb25nb19jcmVkZW50aWFsc1wiKTtcbmNvbnN0IHByb3ZpZGVyc18xID0gcmVxdWlyZShcIi4vY21hcC9hdXRoL3Byb3ZpZGVyc1wiKTtcbmNvbnN0IGNvbm5lY3Rpb25fc3RyaW5nXzEgPSByZXF1aXJlKFwiLi9jb25uZWN0aW9uX3N0cmluZ1wiKTtcbmNvbnN0IGNvbnN0YW50c18xID0gcmVxdWlyZShcIi4vY29uc3RhbnRzXCIpO1xuY29uc3QgZGJfMSA9IHJlcXVpcmUoXCIuL2RiXCIpO1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuL2Vycm9yXCIpO1xuY29uc3QgbW9uZ29fbG9nZ2VyXzEgPSByZXF1aXJlKFwiLi9tb25nb19sb2dnZXJcIik7XG5jb25zdCBtb25nb190eXBlc18xID0gcmVxdWlyZShcIi4vbW9uZ29fdHlwZXNcIik7XG5jb25zdCByZWFkX3ByZWZlcmVuY2VfMSA9IHJlcXVpcmUoXCIuL3JlYWRfcHJlZmVyZW5jZVwiKTtcbmNvbnN0IHNlcnZlcl9zZWxlY3Rpb25fMSA9IHJlcXVpcmUoXCIuL3NkYW0vc2VydmVyX3NlbGVjdGlvblwiKTtcbmNvbnN0IHRvcG9sb2d5XzEgPSByZXF1aXJlKFwiLi9zZGFtL3RvcG9sb2d5XCIpO1xuY29uc3Qgc2Vzc2lvbnNfMSA9IHJlcXVpcmUoXCIuL3Nlc3Npb25zXCIpO1xuY29uc3QgdXRpbHNfMSA9IHJlcXVpcmUoXCIuL3V0aWxzXCIpO1xuLyoqIEBwdWJsaWMgKi9cbmV4cG9ydHMuU2VydmVyQXBpVmVyc2lvbiA9IE9iamVjdC5mcmVlemUoe1xuICAgIHYxOiAnMSdcbn0pO1xuLyoqIEBpbnRlcm5hbCAqL1xuY29uc3Qga09wdGlvbnMgPSBTeW1ib2woJ29wdGlvbnMnKTtcbi8qKlxuICogVGhlICoqTW9uZ29DbGllbnQqKiBjbGFzcyBpcyBhIGNsYXNzIHRoYXQgYWxsb3dzIGZvciBtYWtpbmcgQ29ubmVjdGlvbnMgdG8gTW9uZ29EQi5cbiAqIEBwdWJsaWNcbiAqXG4gKiBAcmVtYXJrc1xuICogVGhlIHByb2dyYW1tYXRpY2FsbHkgcHJvdmlkZWQgb3B0aW9ucyB0YWtlIHByZWNlZGVuY2Ugb3ZlciB0aGUgVVJJIG9wdGlvbnMuXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYHRzXG4gKiBpbXBvcnQgeyBNb25nb0NsaWVudCB9IGZyb20gJ21vbmdvZGInO1xuICpcbiAqIC8vIEVuYWJsZSBjb21tYW5kIG1vbml0b3JpbmcgZm9yIGRlYnVnZ2luZ1xuICogY29uc3QgY2xpZW50ID0gbmV3IE1vbmdvQ2xpZW50KCdtb25nb2RiOi8vbG9jYWxob3N0OjI3MDE3JywgeyBtb25pdG9yQ29tbWFuZHM6IHRydWUgfSk7XG4gKlxuICogY2xpZW50Lm9uKCdjb21tYW5kU3RhcnRlZCcsIHN0YXJ0ZWQgPT4gY29uc29sZS5sb2coc3RhcnRlZCkpO1xuICogY2xpZW50LmRiKCkuY29sbGVjdGlvbigncGV0cycpO1xuICogYXdhaXQgY2xpZW50Lmluc2VydE9uZSh7IG5hbWU6ICdzcG90Jywga2luZDogJ2RvZycgfSk7XG4gKiBgYGBcbiAqL1xuY2xhc3MgTW9uZ29DbGllbnQgZXh0ZW5kcyBtb25nb190eXBlc18xLlR5cGVkRXZlbnRFbWl0dGVyIHtcbiAgICBjb25zdHJ1Y3Rvcih1cmwsIG9wdGlvbnMpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpc1trT3B0aW9uc10gPSAoMCwgY29ubmVjdGlvbl9zdHJpbmdfMS5wYXJzZU9wdGlvbnMpKHVybCwgdGhpcywgb3B0aW9ucyk7XG4gICAgICAgIHRoaXMubW9uZ29Mb2dnZXIgPSBuZXcgbW9uZ29fbG9nZ2VyXzEuTW9uZ29Mb2dnZXIodGhpc1trT3B0aW9uc10ubW9uZ29Mb2dnZXJPcHRpb25zKTtcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby10aGlzLWFsaWFzXG4gICAgICAgIGNvbnN0IGNsaWVudCA9IHRoaXM7XG4gICAgICAgIC8vIFRoZSBpbnRlcm5hbCBzdGF0ZVxuICAgICAgICB0aGlzLnMgPSB7XG4gICAgICAgICAgICB1cmwsXG4gICAgICAgICAgICBic29uT3B0aW9uczogKDAsIGJzb25fMS5yZXNvbHZlQlNPTk9wdGlvbnMpKHRoaXNba09wdGlvbnNdKSxcbiAgICAgICAgICAgIG5hbWVzcGFjZTogKDAsIHV0aWxzXzEubnMpKCdhZG1pbicpLFxuICAgICAgICAgICAgaGFzQmVlbkNsb3NlZDogZmFsc2UsXG4gICAgICAgICAgICBzZXNzaW9uUG9vbDogbmV3IHNlc3Npb25zXzEuU2VydmVyU2Vzc2lvblBvb2wodGhpcyksXG4gICAgICAgICAgICBhY3RpdmVTZXNzaW9uczogbmV3IFNldCgpLFxuICAgICAgICAgICAgZ2V0IG9wdGlvbnMoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNsaWVudFtrT3B0aW9uc107XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0IHJlYWRDb25jZXJuKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBjbGllbnRba09wdGlvbnNdLnJlYWRDb25jZXJuO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldCB3cml0ZUNvbmNlcm4oKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNsaWVudFtrT3B0aW9uc10ud3JpdGVDb25jZXJuO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldCByZWFkUHJlZmVyZW5jZSgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gY2xpZW50W2tPcHRpb25zXS5yZWFkUHJlZmVyZW5jZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXQgaXNNb25nb0NsaWVudCgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9XG4gICAgLyoqIEBzZWUgTW9uZ29PcHRpb25zICovXG4gICAgZ2V0IG9wdGlvbnMoKSB7XG4gICAgICAgIHJldHVybiBPYmplY3QuZnJlZXplKHsgLi4udGhpc1trT3B0aW9uc10gfSk7XG4gICAgfVxuICAgIGdldCBzZXJ2ZXJBcGkoKSB7XG4gICAgICAgIHJldHVybiB0aGlzW2tPcHRpb25zXS5zZXJ2ZXJBcGkgJiYgT2JqZWN0LmZyZWV6ZSh7IC4uLnRoaXNba09wdGlvbnNdLnNlcnZlckFwaSB9KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogSW50ZW5kZWQgZm9yIEFQTSB1c2Ugb25seVxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIGdldCBtb25pdG9yQ29tbWFuZHMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzW2tPcHRpb25zXS5tb25pdG9yQ29tbWFuZHM7XG4gICAgfVxuICAgIHNldCBtb25pdG9yQ29tbWFuZHModmFsdWUpIHtcbiAgICAgICAgdGhpc1trT3B0aW9uc10ubW9uaXRvckNvbW1hbmRzID0gdmFsdWU7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBkZXByZWNhdGVkIFRoaXMgbWV0aG9kIHdpbGwgYmUgcmVtb3ZlZCBpbiB0aGUgbmV4dCBtYWpvciB2ZXJzaW9uLlxuICAgICAqL1xuICAgIGdldCBhdXRvRW5jcnlwdGVyKCkge1xuICAgICAgICByZXR1cm4gdGhpc1trT3B0aW9uc10uYXV0b0VuY3J5cHRlcjtcbiAgICB9XG4gICAgZ2V0IHJlYWRDb25jZXJuKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zLnJlYWRDb25jZXJuO1xuICAgIH1cbiAgICBnZXQgd3JpdGVDb25jZXJuKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zLndyaXRlQ29uY2VybjtcbiAgICB9XG4gICAgZ2V0IHJlYWRQcmVmZXJlbmNlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zLnJlYWRQcmVmZXJlbmNlO1xuICAgIH1cbiAgICBnZXQgYnNvbk9wdGlvbnMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnMuYnNvbk9wdGlvbnM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENvbm5lY3QgdG8gTW9uZ29EQiB1c2luZyBhIHVybFxuICAgICAqXG4gICAgICogQHNlZSBkb2NzLm1vbmdvZGIub3JnL21hbnVhbC9yZWZlcmVuY2UvY29ubmVjdGlvbi1zdHJpbmcvXG4gICAgICovXG4gICAgYXN5bmMgY29ubmVjdCgpIHtcbiAgICAgICAgaWYgKHRoaXMuY29ubmVjdGlvbkxvY2spIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbm5lY3Rpb25Mb2NrO1xuICAgICAgICB9XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICB0aGlzLmNvbm5lY3Rpb25Mb2NrID0gdGhpcy5fY29ubmVjdCgpO1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5jb25uZWN0aW9uTG9jaztcbiAgICAgICAgfVxuICAgICAgICBmaW5hbGx5IHtcbiAgICAgICAgICAgIC8vIHJlbGVhc2VcbiAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvbkxvY2sgPSB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIHRvcG9sb2d5IHRvIG9wZW4gdGhlIGNvbm5lY3Rpb24sIG11c3QgYmUgbG9ja2VkIHRvIGF2b2lkIHRvcG9sb2d5IGxlYWtzIGluIGNvbmN1cnJlbmN5IHNjZW5hcmlvLlxuICAgICAqIExvY2tpbmcgaXMgZW5mb3JjZWQgYnkgdGhlIGNvbm5lY3QgbWV0aG9kLlxuICAgICAqXG4gICAgICogQGludGVybmFsXG4gICAgICovXG4gICAgYXN5bmMgX2Nvbm5lY3QoKSB7XG4gICAgICAgIGlmICh0aGlzLnRvcG9sb2d5ICYmIHRoaXMudG9wb2xvZ3kuaXNDb25uZWN0ZWQoKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgb3B0aW9ucyA9IHRoaXNba09wdGlvbnNdO1xuICAgICAgICBpZiAodHlwZW9mIG9wdGlvbnMuc3J2SG9zdCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIGNvbnN0IGhvc3RzID0gYXdhaXQgKDAsIGNvbm5lY3Rpb25fc3RyaW5nXzEucmVzb2x2ZVNSVlJlY29yZCkob3B0aW9ucyk7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IFtpbmRleCwgaG9zdF0gb2YgaG9zdHMuZW50cmllcygpKSB7XG4gICAgICAgICAgICAgICAgb3B0aW9ucy5ob3N0c1tpbmRleF0gPSBob3N0O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIEl0IGlzIGltcG9ydGFudCB0byBwZXJmb3JtIHZhbGlkYXRpb24gb2YgaG9zdHMgQUZURVIgU1JWIHJlc29sdXRpb24sIHRvIGNoZWNrIHRoZSByZWFsIGhvc3RuYW1lLFxuICAgICAgICAvLyBidXQgQkVGT1JFIHdlIGV2ZW4gYXR0ZW1wdCBjb25uZWN0aW5nIHdpdGggYSBwb3RlbnRpYWxseSBub3QgYWxsb3dlZCBob3N0bmFtZVxuICAgICAgICBpZiAob3B0aW9ucy5jcmVkZW50aWFscz8ubWVjaGFuaXNtID09PSBwcm92aWRlcnNfMS5BdXRoTWVjaGFuaXNtLk1PTkdPREJfT0lEQykge1xuICAgICAgICAgICAgY29uc3QgYWxsb3dlZEhvc3RzID0gb3B0aW9ucy5jcmVkZW50aWFscz8ubWVjaGFuaXNtUHJvcGVydGllcz8uQUxMT1dFRF9IT1NUUyB8fCBtb25nb19jcmVkZW50aWFsc18xLkRFRkFVTFRfQUxMT1dFRF9IT1NUUztcbiAgICAgICAgICAgIGNvbnN0IGlzU2VydmljZUF1dGggPSAhIW9wdGlvbnMuY3JlZGVudGlhbHM/Lm1lY2hhbmlzbVByb3BlcnRpZXM/LlBST1ZJREVSX05BTUU7XG4gICAgICAgICAgICBpZiAoIWlzU2VydmljZUF1dGgpIHtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGhvc3Qgb2Ygb3B0aW9ucy5ob3N0cykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoISgwLCB1dGlsc18xLmhvc3RNYXRjaGVzV2lsZGNhcmRzKShob3N0LnRvSG9zdFBvcnQoKS5ob3N0LCBhbGxvd2VkSG9zdHMpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKGBIb3N0ICcke2hvc3R9JyBpcyBub3QgdmFsaWQgZm9yIE9JREMgYXV0aGVudGljYXRpb24gd2l0aCBBTExPV0VEX0hPU1RTIG9mICcke2FsbG93ZWRIb3N0cy5qb2luKCcsJyl9J2ApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMudG9wb2xvZ3kgPSBuZXcgdG9wb2xvZ3lfMS5Ub3BvbG9neSh0aGlzLCBvcHRpb25zLmhvc3RzLCBvcHRpb25zKTtcbiAgICAgICAgLy8gRXZlbnRzIGNhbiBiZSBlbWl0dGVkIGJlZm9yZSBpbml0aWFsaXphdGlvbiBpcyBjb21wbGV0ZSBzbyB3ZSBoYXZlIHRvXG4gICAgICAgIC8vIHNhdmUgdGhlIHJlZmVyZW5jZSB0byB0aGUgdG9wb2xvZ3kgb24gdGhlIGNsaWVudCBBU0FQIGlmIHRoZSBldmVudCBoYW5kbGVycyBuZWVkIHRvIGFjY2VzcyBpdFxuICAgICAgICB0aGlzLnRvcG9sb2d5Lm9uY2UodG9wb2xvZ3lfMS5Ub3BvbG9neS5PUEVOLCAoKSA9PiB0aGlzLmVtaXQoJ29wZW4nLCB0aGlzKSk7XG4gICAgICAgIGZvciAoY29uc3QgZXZlbnQgb2YgY29uc3RhbnRzXzEuTU9OR09fQ0xJRU5UX0VWRU5UUykge1xuICAgICAgICAgICAgdGhpcy50b3BvbG9neS5vbihldmVudCwgKC4uLmFyZ3MpID0+IHRoaXMuZW1pdChldmVudCwgLi4uYXJncykpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHRvcG9sb2d5Q29ubmVjdCA9IGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgKDAsIHV0aWxfMS5wcm9taXNpZnkpKGNhbGxiYWNrID0+IHRoaXMudG9wb2xvZ3k/LmNvbm5lY3Qob3B0aW9ucywgY2FsbGJhY2spKSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50b3BvbG9neT8uY2xvc2UoeyBmb3JjZTogdHJ1ZSB9KTtcbiAgICAgICAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgaWYgKHRoaXMuYXV0b0VuY3J5cHRlcikge1xuICAgICAgICAgICAgY29uc3QgaW5pdEF1dG9FbmNyeXB0ZXIgPSAoMCwgdXRpbF8xLnByb21pc2lmeSkoY2FsbGJhY2sgPT4gdGhpcy5hdXRvRW5jcnlwdGVyPy5pbml0KGNhbGxiYWNrKSk7XG4gICAgICAgICAgICBhd2FpdCBpbml0QXV0b0VuY3J5cHRlcigpO1xuICAgICAgICAgICAgYXdhaXQgdG9wb2xvZ3lDb25uZWN0KCk7XG4gICAgICAgICAgICBhd2FpdCBvcHRpb25zLmVuY3J5cHRlci5jb25uZWN0SW50ZXJuYWxDbGllbnQoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGF3YWl0IHRvcG9sb2d5Q29ubmVjdCgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDbG9zZSB0aGUgY2xpZW50IGFuZCBpdHMgdW5kZXJseWluZyBjb25uZWN0aW9uc1xuICAgICAqXG4gICAgICogQHBhcmFtIGZvcmNlIC0gRm9yY2UgY2xvc2UsIGVtaXR0aW5nIG5vIGV2ZW50c1xuICAgICAqL1xuICAgIGFzeW5jIGNsb3NlKGZvcmNlID0gZmFsc2UpIHtcbiAgICAgICAgLy8gVGhlcmUncyBubyB3YXkgdG8gc2V0IGhhc0JlZW5DbG9zZWQgYmFjayB0byBmYWxzZVxuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcy5zLCAnaGFzQmVlbkNsb3NlZCcsIHtcbiAgICAgICAgICAgIHZhbHVlOiB0cnVlLFxuICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogZmFsc2UsXG4gICAgICAgICAgICB3cml0YWJsZTogZmFsc2VcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IGFjdGl2ZVNlc3Npb25FbmRzID0gQXJyYXkuZnJvbSh0aGlzLnMuYWN0aXZlU2Vzc2lvbnMsIHNlc3Npb24gPT4gc2Vzc2lvbi5lbmRTZXNzaW9uKCkpO1xuICAgICAgICB0aGlzLnMuYWN0aXZlU2Vzc2lvbnMuY2xlYXIoKTtcbiAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoYWN0aXZlU2Vzc2lvbkVuZHMpO1xuICAgICAgICBpZiAodGhpcy50b3BvbG9neSA9PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy8gSWYgd2Ugd291bGQgYXR0ZW1wdCB0byBzZWxlY3QgYSBzZXJ2ZXIgYW5kIGdldCBub3RoaW5nIGJhY2sgd2Ugc2hvcnQgY2lyY3VpdFxuICAgICAgICAvLyB0byBhdm9pZCB0aGUgc2VydmVyIHNlbGVjdGlvbiB0aW1lb3V0LlxuICAgICAgICBjb25zdCBzZWxlY3RvciA9ICgwLCBzZXJ2ZXJfc2VsZWN0aW9uXzEucmVhZFByZWZlcmVuY2VTZXJ2ZXJTZWxlY3RvcikocmVhZF9wcmVmZXJlbmNlXzEuUmVhZFByZWZlcmVuY2UucHJpbWFyeVByZWZlcnJlZCk7XG4gICAgICAgIGNvbnN0IHRvcG9sb2d5RGVzY3JpcHRpb24gPSB0aGlzLnRvcG9sb2d5LmRlc2NyaXB0aW9uO1xuICAgICAgICBjb25zdCBzZXJ2ZXJEZXNjcmlwdGlvbnMgPSBBcnJheS5mcm9tKHRvcG9sb2d5RGVzY3JpcHRpb24uc2VydmVycy52YWx1ZXMoKSk7XG4gICAgICAgIGNvbnN0IHNlcnZlcnMgPSBzZWxlY3Rvcih0b3BvbG9neURlc2NyaXB0aW9uLCBzZXJ2ZXJEZXNjcmlwdGlvbnMpO1xuICAgICAgICBpZiAoc2VydmVycy5sZW5ndGggIT09IDApIHtcbiAgICAgICAgICAgIGNvbnN0IGVuZFNlc3Npb25zID0gQXJyYXkuZnJvbSh0aGlzLnMuc2Vzc2lvblBvb2wuc2Vzc2lvbnMsICh7IGlkIH0pID0+IGlkKTtcbiAgICAgICAgICAgIGlmIChlbmRTZXNzaW9ucy5sZW5ndGggIT09IDApIHtcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmRiKCdhZG1pbicpXG4gICAgICAgICAgICAgICAgICAgIC5jb21tYW5kKHsgZW5kU2Vzc2lvbnMgfSwgeyByZWFkUHJlZmVyZW5jZTogcmVhZF9wcmVmZXJlbmNlXzEuUmVhZFByZWZlcmVuY2UucHJpbWFyeVByZWZlcnJlZCwgbm9SZXNwb25zZTogdHJ1ZSB9KVxuICAgICAgICAgICAgICAgICAgICAuY2F0Y2goKCkgPT4gbnVsbCk7IC8vIG91dGNvbWUgZG9lcyBub3QgbWF0dGVyXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gY2xlYXIgb3V0IHJlZmVyZW5jZXMgdG8gb2xkIHRvcG9sb2d5XG4gICAgICAgIGNvbnN0IHRvcG9sb2d5ID0gdGhpcy50b3BvbG9neTtcbiAgICAgICAgdGhpcy50b3BvbG9neSA9IHVuZGVmaW5lZDtcbiAgICAgICAgYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgdG9wb2xvZ3kuY2xvc2UoeyBmb3JjZSB9LCBlcnJvciA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGVycm9yKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICBjb25zdCB7IGVuY3J5cHRlciB9ID0gdGhpc1trT3B0aW9uc107XG4gICAgICAgICAgICAgICAgaWYgKGVuY3J5cHRlcikge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZW5jcnlwdGVyLmNsb3NlKHRoaXMsIGZvcmNlLCBlcnJvciA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXJyb3IpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIG5ldyBEYiBpbnN0YW5jZSBzaGFyaW5nIHRoZSBjdXJyZW50IHNvY2tldCBjb25uZWN0aW9ucy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBkYk5hbWUgLSBUaGUgbmFtZSBvZiB0aGUgZGF0YWJhc2Ugd2Ugd2FudCB0byB1c2UuIElmIG5vdCBwcm92aWRlZCwgdXNlIGRhdGFiYXNlIG5hbWUgZnJvbSBjb25uZWN0aW9uIHN0cmluZy5cbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzIGZvciBEYiBjb25zdHJ1Y3Rpb25cbiAgICAgKi9cbiAgICBkYihkYk5hbWUsIG9wdGlvbnMpIHtcbiAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgPz8ge307XG4gICAgICAgIC8vIERlZmF1bHQgdG8gZGIgZnJvbSBjb25uZWN0aW9uIHN0cmluZyBpZiBub3QgcHJvdmlkZWRcbiAgICAgICAgaWYgKCFkYk5hbWUpIHtcbiAgICAgICAgICAgIGRiTmFtZSA9IHRoaXMub3B0aW9ucy5kYk5hbWU7XG4gICAgICAgIH1cbiAgICAgICAgLy8gQ29weSB0aGUgb3B0aW9ucyBhbmQgYWRkIG91dCBpbnRlcm5hbCBvdmVycmlkZSBvZiB0aGUgbm90IHNoYXJlZCBmbGFnXG4gICAgICAgIGNvbnN0IGZpbmFsT3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXNba09wdGlvbnNdLCBvcHRpb25zKTtcbiAgICAgICAgLy8gUmV0dXJuIHRoZSBkYiBvYmplY3RcbiAgICAgICAgY29uc3QgZGIgPSBuZXcgZGJfMS5EYih0aGlzLCBkYk5hbWUsIGZpbmFsT3B0aW9ucyk7XG4gICAgICAgIC8vIFJldHVybiB0aGUgZGF0YWJhc2VcbiAgICAgICAgcmV0dXJuIGRiO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDb25uZWN0IHRvIE1vbmdvREIgdXNpbmcgYSB1cmxcbiAgICAgKlxuICAgICAqIEByZW1hcmtzXG4gICAgICogVGhlIHByb2dyYW1tYXRpY2FsbHkgcHJvdmlkZWQgb3B0aW9ucyB0YWtlIHByZWNlZGVuY2Ugb3ZlciB0aGUgVVJJIG9wdGlvbnMuXG4gICAgICpcbiAgICAgKiBAc2VlIGh0dHBzOi8vd3d3Lm1vbmdvZGIuY29tL2RvY3MvbWFudWFsL3JlZmVyZW5jZS9jb25uZWN0aW9uLXN0cmluZy9cbiAgICAgKi9cbiAgICBzdGF0aWMgYXN5bmMgY29ubmVjdCh1cmwsIG9wdGlvbnMpIHtcbiAgICAgICAgY29uc3QgY2xpZW50ID0gbmV3IHRoaXModXJsLCBvcHRpb25zKTtcbiAgICAgICAgcmV0dXJuIGNsaWVudC5jb25uZWN0KCk7XG4gICAgfVxuICAgIC8qKiBTdGFydHMgYSBuZXcgc2Vzc2lvbiBvbiB0aGUgc2VydmVyICovXG4gICAgc3RhcnRTZXNzaW9uKG9wdGlvbnMpIHtcbiAgICAgICAgY29uc3Qgc2Vzc2lvbiA9IG5ldyBzZXNzaW9uc18xLkNsaWVudFNlc3Npb24odGhpcywgdGhpcy5zLnNlc3Npb25Qb29sLCB7IGV4cGxpY2l0OiB0cnVlLCAuLi5vcHRpb25zIH0sIHRoaXNba09wdGlvbnNdKTtcbiAgICAgICAgdGhpcy5zLmFjdGl2ZVNlc3Npb25zLmFkZChzZXNzaW9uKTtcbiAgICAgICAgc2Vzc2lvbi5vbmNlKCdlbmRlZCcsICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMucy5hY3RpdmVTZXNzaW9ucy5kZWxldGUoc2Vzc2lvbik7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gc2Vzc2lvbjtcbiAgICB9XG4gICAgYXN5bmMgd2l0aFNlc3Npb24ob3B0aW9uc09yT3BlcmF0aW9uLCBjYWxsYmFjaykge1xuICAgICAgICBjb25zdCBvcHRpb25zID0ge1xuICAgICAgICAgICAgLy8gQWx3YXlzIGRlZmluZSBhbiBvd25lclxuICAgICAgICAgICAgb3duZXI6IFN5bWJvbCgpLFxuICAgICAgICAgICAgLy8gSWYgaXQncyBhbiBvYmplY3QgaW5oZXJpdCB0aGUgb3B0aW9uc1xuICAgICAgICAgICAgLi4uKHR5cGVvZiBvcHRpb25zT3JPcGVyYXRpb24gPT09ICdvYmplY3QnID8gb3B0aW9uc09yT3BlcmF0aW9uIDoge30pXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IHdpdGhTZXNzaW9uQ2FsbGJhY2sgPSB0eXBlb2Ygb3B0aW9uc09yT3BlcmF0aW9uID09PSAnZnVuY3Rpb24nID8gb3B0aW9uc09yT3BlcmF0aW9uIDogY2FsbGJhY2s7XG4gICAgICAgIGlmICh3aXRoU2Vzc2lvbkNhbGxiYWNrID09IG51bGwpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoJ01pc3NpbmcgcmVxdWlyZWQgY2FsbGJhY2sgcGFyYW1ldGVyJyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgc2Vzc2lvbiA9IHRoaXMuc3RhcnRTZXNzaW9uKG9wdGlvbnMpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgd2l0aFNlc3Npb25DYWxsYmFjayhzZXNzaW9uKTtcbiAgICAgICAgfVxuICAgICAgICBmaW5hbGx5IHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgc2Vzc2lvbi5lbmRTZXNzaW9uKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCB7XG4gICAgICAgICAgICAgICAgLy8gV2UgYXJlIG5vdCBjb25jZXJuZWQgd2l0aCBlcnJvcnMgZnJvbSBlbmRTZXNzaW9uKClcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBuZXcgQ2hhbmdlIFN0cmVhbSwgd2F0Y2hpbmcgZm9yIG5ldyBjaGFuZ2VzIChpbnNlcnRpb25zLCB1cGRhdGVzLFxuICAgICAqIHJlcGxhY2VtZW50cywgZGVsZXRpb25zLCBhbmQgaW52YWxpZGF0aW9ucykgaW4gdGhpcyBjbHVzdGVyLiBXaWxsIGlnbm9yZSBhbGxcbiAgICAgKiBjaGFuZ2VzIHRvIHN5c3RlbSBjb2xsZWN0aW9ucywgYXMgd2VsbCBhcyB0aGUgbG9jYWwsIGFkbWluLCBhbmQgY29uZmlnIGRhdGFiYXNlcy5cbiAgICAgKlxuICAgICAqIEByZW1hcmtzXG4gICAgICogd2F0Y2goKSBhY2NlcHRzIHR3byBnZW5lcmljIGFyZ3VtZW50cyBmb3IgZGlzdGluY3QgdXNlIGNhc2VzOlxuICAgICAqIC0gVGhlIGZpcnN0IGlzIHRvIHByb3ZpZGUgdGhlIHNjaGVtYSB0aGF0IG1heSBiZSBkZWZpbmVkIGZvciBhbGwgdGhlIGRhdGEgd2l0aGluIHRoZSBjdXJyZW50IGNsdXN0ZXJcbiAgICAgKiAtIFRoZSBzZWNvbmQgaXMgdG8gb3ZlcnJpZGUgdGhlIHNoYXBlIG9mIHRoZSBjaGFuZ2Ugc3RyZWFtIGRvY3VtZW50IGVudGlyZWx5LCBpZiBpdCBpcyBub3QgcHJvdmlkZWQgdGhlIHR5cGUgd2lsbCBkZWZhdWx0IHRvIENoYW5nZVN0cmVhbURvY3VtZW50IG9mIHRoZSBmaXJzdCBhcmd1bWVudFxuICAgICAqXG4gICAgICogQHBhcmFtIHBpcGVsaW5lIC0gQW4gYXJyYXkgb2Yge0BsaW5rIGh0dHBzOi8vd3d3Lm1vbmdvZGIuY29tL2RvY3MvbWFudWFsL3JlZmVyZW5jZS9vcGVyYXRvci9hZ2dyZWdhdGlvbi1waXBlbGluZS98YWdncmVnYXRpb24gcGlwZWxpbmUgc3RhZ2VzfSB0aHJvdWdoIHdoaWNoIHRvIHBhc3MgY2hhbmdlIHN0cmVhbSBkb2N1bWVudHMuIFRoaXMgYWxsb3dzIGZvciBmaWx0ZXJpbmcgKHVzaW5nICRtYXRjaCkgYW5kIG1hbmlwdWxhdGluZyB0aGUgY2hhbmdlIHN0cmVhbSBkb2N1bWVudHMuXG4gICAgICogQHBhcmFtIG9wdGlvbnMgLSBPcHRpb25hbCBzZXR0aW5ncyBmb3IgdGhlIGNvbW1hbmRcbiAgICAgKiBAdHlwZVBhcmFtIFRTY2hlbWEgLSBUeXBlIG9mIHRoZSBkYXRhIGJlaW5nIGRldGVjdGVkIGJ5IHRoZSBjaGFuZ2Ugc3RyZWFtXG4gICAgICogQHR5cGVQYXJhbSBUQ2hhbmdlIC0gVHlwZSBvZiB0aGUgd2hvbGUgY2hhbmdlIHN0cmVhbSBkb2N1bWVudCBlbWl0dGVkXG4gICAgICovXG4gICAgd2F0Y2gocGlwZWxpbmUgPSBbXSwgb3B0aW9ucyA9IHt9KSB7XG4gICAgICAgIC8vIEFsbG93IG9wdGlvbmFsbHkgbm90IHNwZWNpZnlpbmcgYSBwaXBlbGluZVxuICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkocGlwZWxpbmUpKSB7XG4gICAgICAgICAgICBvcHRpb25zID0gcGlwZWxpbmU7XG4gICAgICAgICAgICBwaXBlbGluZSA9IFtdO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgY2hhbmdlX3N0cmVhbV8xLkNoYW5nZVN0cmVhbSh0aGlzLCBwaXBlbGluZSwgKDAsIHV0aWxzXzEucmVzb2x2ZU9wdGlvbnMpKHRoaXMsIG9wdGlvbnMpKTtcbiAgICB9XG59XG5leHBvcnRzLk1vbmdvQ2xpZW50ID0gTW9uZ29DbGllbnQ7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1tb25nb19jbGllbnQuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/mongo_client.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/mongo_logger.js":
/*!**********************************************************!*\
  !*** ../server/node_modules/mongodb/lib/mongo_logger.js ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.MongoLogger = exports.stringifyWithMaxLen = exports.createStdioLogger = exports.MongoLoggableComponent = exports.SEVERITY_LEVEL_MAP = exports.DEFAULT_MAX_DOCUMENT_LENGTH = exports.SeverityLevel = void 0;\nconst bson_1 = __webpack_require__(/*! bson */ \"(api)/../server/node_modules/bson/lib/bson.cjs\");\nconst util_1 = __webpack_require__(/*! util */ \"util\");\nconst constants_1 = __webpack_require__(/*! ./constants */ \"(api)/../server/node_modules/mongodb/lib/constants.js\");\nconst utils_1 = __webpack_require__(/*! ./utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\n/** @internal */\nexports.SeverityLevel = Object.freeze({\n    EMERGENCY: 'emergency',\n    ALERT: 'alert',\n    CRITICAL: 'critical',\n    ERROR: 'error',\n    WARNING: 'warn',\n    NOTICE: 'notice',\n    INFORMATIONAL: 'info',\n    DEBUG: 'debug',\n    TRACE: 'trace',\n    OFF: 'off'\n});\n/** @internal */\nexports.DEFAULT_MAX_DOCUMENT_LENGTH = 1000;\n/** @internal */\nclass SeverityLevelMap extends Map {\n    constructor(entries) {\n        const newEntries = [];\n        for (const [level, value] of entries) {\n            newEntries.push([value, level]);\n        }\n        newEntries.push(...entries);\n        super(newEntries);\n    }\n    getNumericSeverityLevel(severity) {\n        return this.get(severity);\n    }\n    getSeverityLevelName(level) {\n        return this.get(level);\n    }\n}\n/** @internal */\nexports.SEVERITY_LEVEL_MAP = new SeverityLevelMap([\n    [exports.SeverityLevel.OFF, -Infinity],\n    [exports.SeverityLevel.EMERGENCY, 0],\n    [exports.SeverityLevel.ALERT, 1],\n    [exports.SeverityLevel.CRITICAL, 2],\n    [exports.SeverityLevel.ERROR, 3],\n    [exports.SeverityLevel.WARNING, 4],\n    [exports.SeverityLevel.NOTICE, 5],\n    [exports.SeverityLevel.INFORMATIONAL, 6],\n    [exports.SeverityLevel.DEBUG, 7],\n    [exports.SeverityLevel.TRACE, 8]\n]);\n/** @internal */\nexports.MongoLoggableComponent = Object.freeze({\n    COMMAND: 'command',\n    TOPOLOGY: 'topology',\n    SERVER_SELECTION: 'serverSelection',\n    CONNECTION: 'connection'\n});\n/**\n * Parses a string as one of SeverityLevel\n *\n * @param s - the value to be parsed\n * @returns one of SeverityLevel if value can be parsed as such, otherwise null\n */\nfunction parseSeverityFromString(s) {\n    const validSeverities = Object.values(exports.SeverityLevel);\n    const lowerSeverity = s?.toLowerCase();\n    if (lowerSeverity != null && validSeverities.includes(lowerSeverity)) {\n        return lowerSeverity;\n    }\n    return null;\n}\n/** @internal */\nfunction createStdioLogger(stream) {\n    return {\n        write: (log) => {\n            stream.write((0, util_1.inspect)(log, { compact: true, breakLength: Infinity }), 'utf-8');\n            return;\n        }\n    };\n}\nexports.createStdioLogger = createStdioLogger;\n/**\n * resolves the MONGODB_LOG_PATH and mongodbLogPath options from the environment and the\n * mongo client options respectively. The mongodbLogPath can be either 'stdout', 'stderr', a NodeJS\n * Writable or an object which has a `write` method with the signature:\n * ```ts\n * write(log: Log): void\n * ```\n *\n * @returns the MongoDBLogWritable object to write logs to\n */\nfunction resolveLogPath({ MONGODB_LOG_PATH }, { mongodbLogPath }) {\n    if (typeof mongodbLogPath === 'string' && /^stderr$/i.test(mongodbLogPath)) {\n        return createStdioLogger(process.stderr);\n    }\n    if (typeof mongodbLogPath === 'string' && /^stdout$/i.test(mongodbLogPath)) {\n        return createStdioLogger(process.stdout);\n    }\n    if (typeof mongodbLogPath === 'object' && typeof mongodbLogPath?.write === 'function') {\n        return mongodbLogPath;\n    }\n    if (MONGODB_LOG_PATH && /^stderr$/i.test(MONGODB_LOG_PATH)) {\n        return createStdioLogger(process.stderr);\n    }\n    if (MONGODB_LOG_PATH && /^stdout$/i.test(MONGODB_LOG_PATH)) {\n        return createStdioLogger(process.stdout);\n    }\n    return createStdioLogger(process.stderr);\n}\nfunction compareSeverity(s0, s1) {\n    const s0Num = exports.SEVERITY_LEVEL_MAP.getNumericSeverityLevel(s0);\n    const s1Num = exports.SEVERITY_LEVEL_MAP.getNumericSeverityLevel(s1);\n    return s0Num < s1Num ? -1 : s0Num > s1Num ? 1 : 0;\n}\n/** @internal */\nfunction stringifyWithMaxLen(value, maxDocumentLength) {\n    const ejson = bson_1.EJSON.stringify(value);\n    return maxDocumentLength !== 0 && ejson.length > maxDocumentLength\n        ? `${ejson.slice(0, maxDocumentLength)}...`\n        : ejson;\n}\nexports.stringifyWithMaxLen = stringifyWithMaxLen;\nfunction isLogConvertible(obj) {\n    const objAsLogConvertible = obj;\n    // eslint-disable-next-line no-restricted-syntax\n    return objAsLogConvertible.toLog !== undefined && typeof objAsLogConvertible.toLog === 'function';\n}\nfunction attachCommandFields(log, commandEvent) {\n    log.commandName = commandEvent.commandName;\n    log.requestId = commandEvent.requestId;\n    log.driverConnectionId = commandEvent?.connectionId;\n    const { host, port } = utils_1.HostAddress.fromString(commandEvent.address).toHostPort();\n    log.serverHost = host;\n    log.serverPort = port;\n    if (commandEvent?.serviceId) {\n        log.serviceId = commandEvent.serviceId.toHexString();\n    }\n    return log;\n}\nfunction attachConnectionFields(log, connectionPoolEvent) {\n    const { host, port } = utils_1.HostAddress.fromString(connectionPoolEvent.address).toHostPort();\n    log.serverHost = host;\n    log.serverPort = port;\n    return log;\n}\nfunction defaultLogTransform(logObject, maxDocumentLength = exports.DEFAULT_MAX_DOCUMENT_LENGTH) {\n    let log = Object.create(null);\n    switch (logObject.name) {\n        case constants_1.COMMAND_STARTED:\n            log = attachCommandFields(log, logObject);\n            log.message = 'Command started';\n            log.command = stringifyWithMaxLen(logObject.command, maxDocumentLength);\n            log.databaseName = logObject.databaseName;\n            return log;\n        case constants_1.COMMAND_SUCCEEDED:\n            log = attachCommandFields(log, logObject);\n            log.message = 'Command succeeded';\n            log.durationMS = logObject.duration;\n            log.reply = stringifyWithMaxLen(logObject.reply, maxDocumentLength);\n            return log;\n        case constants_1.COMMAND_FAILED:\n            log = attachCommandFields(log, logObject);\n            log.message = 'Command failed';\n            log.durationMS = logObject.duration;\n            log.failure = logObject.failure;\n            return log;\n        case constants_1.CONNECTION_POOL_CREATED:\n            log = attachConnectionFields(log, logObject);\n            log.message = 'Connection pool created';\n            if (logObject.options) {\n                const { maxIdleTimeMS, minPoolSize, maxPoolSize, maxConnecting, waitQueueTimeoutMS } = logObject.options;\n                log = {\n                    ...log,\n                    maxIdleTimeMS,\n                    minPoolSize,\n                    maxPoolSize,\n                    maxConnecting,\n                    waitQueueTimeoutMS\n                };\n            }\n            return log;\n        case constants_1.CONNECTION_POOL_READY:\n            log = attachConnectionFields(log, logObject);\n            log.message = 'Connection pool ready';\n            return log;\n        case constants_1.CONNECTION_POOL_CLEARED:\n            log = attachConnectionFields(log, logObject);\n            log.message = 'Connection pool cleared';\n            if (logObject.serviceId?._bsontype === 'ObjectId') {\n                log.serviceId = logObject.serviceId.toHexString();\n            }\n            return log;\n        case constants_1.CONNECTION_POOL_CLOSED:\n            log = attachConnectionFields(log, logObject);\n            log.message = 'Connection pool closed';\n            return log;\n        case constants_1.CONNECTION_CREATED:\n            log = attachConnectionFields(log, logObject);\n            log.message = 'Connection created';\n            log.driverConnectionId = logObject.connectionId;\n            return log;\n        case constants_1.CONNECTION_READY:\n            log = attachConnectionFields(log, logObject);\n            log.message = 'Connection ready';\n            log.driverConnectionId = logObject.connectionId;\n            return log;\n        case constants_1.CONNECTION_CLOSED:\n            log = attachConnectionFields(log, logObject);\n            log.message = 'Connection closed';\n            log.driverConnectionId = logObject.connectionId;\n            switch (logObject.reason) {\n                case 'stale':\n                    log.reason = 'Connection became stale because the pool was cleared';\n                    break;\n                case 'idle':\n                    log.reason =\n                        'Connection has been available but unused for longer than the configured max idle time';\n                    break;\n                case 'error':\n                    log.reason = 'An error occurred while using the connection';\n                    if (logObject.error) {\n                        log.error = logObject.error;\n                    }\n                    break;\n                case 'poolClosed':\n                    log.reason = 'Connection pool was closed';\n                    break;\n                default:\n                    log.reason = `Unknown close reason: ${logObject.reason}`;\n            }\n            return log;\n        case constants_1.CONNECTION_CHECK_OUT_STARTED:\n            log = attachConnectionFields(log, logObject);\n            log.message = 'Connection checkout started';\n            return log;\n        case constants_1.CONNECTION_CHECK_OUT_FAILED:\n            log = attachConnectionFields(log, logObject);\n            log.message = 'Connection checkout failed';\n            switch (logObject.reason) {\n                case 'poolClosed':\n                    log.reason = 'Connection pool was closed';\n                    break;\n                case 'timeout':\n                    log.reason = 'Wait queue timeout elapsed without a connection becoming available';\n                    break;\n                case 'connectionError':\n                    log.reason = 'An error occurred while trying to establish a new connection';\n                    if (logObject.error) {\n                        log.error = logObject.error;\n                    }\n                    break;\n                default:\n                    log.reason = `Unknown close reason: ${logObject.reason}`;\n            }\n            return log;\n        case constants_1.CONNECTION_CHECKED_OUT:\n            log = attachConnectionFields(log, logObject);\n            log.message = 'Connection checked out';\n            log.driverConnectionId = logObject.connectionId;\n            return log;\n        case constants_1.CONNECTION_CHECKED_IN:\n            log = attachConnectionFields(log, logObject);\n            log.message = 'Connection checked in';\n            log.driverConnectionId = logObject.connectionId;\n            return log;\n        default:\n            for (const [key, value] of Object.entries(logObject)) {\n                if (value != null)\n                    log[key] = value;\n            }\n    }\n    return log;\n}\n/** @internal */\nclass MongoLogger {\n    constructor(options) {\n        /**\n         * This method should be used when logging errors that do not have a public driver API for\n         * reporting errors.\n         */\n        this.error = this.log.bind(this, 'error');\n        /**\n         * This method should be used to log situations where undesirable application behaviour might\n         * occur. For example, failing to end sessions on `MongoClient.close`.\n         */\n        this.warn = this.log.bind(this, 'warn');\n        /**\n         * This method should be used to report high-level information about normal driver behaviour.\n         * For example, the creation of a `MongoClient`.\n         */\n        this.info = this.log.bind(this, 'info');\n        /**\n         * This method should be used to report information that would be helpful when debugging an\n         * application. For example, a command starting, succeeding or failing.\n         */\n        this.debug = this.log.bind(this, 'debug');\n        /**\n         * This method should be used to report fine-grained details related to logic flow. For example,\n         * entering and exiting a function body.\n         */\n        this.trace = this.log.bind(this, 'trace');\n        this.componentSeverities = options.componentSeverities;\n        this.maxDocumentLength = options.maxDocumentLength;\n        this.logDestination = options.logDestination;\n    }\n    log(severity, component, message) {\n        if (compareSeverity(severity, this.componentSeverities[component]) > 0)\n            return;\n        let logMessage = { t: new Date(), c: component, s: severity };\n        if (typeof message === 'string') {\n            logMessage.message = message;\n        }\n        else if (typeof message === 'object') {\n            if (isLogConvertible(message)) {\n                logMessage = { ...logMessage, ...message.toLog() };\n            }\n            else {\n                logMessage = { ...logMessage, ...defaultLogTransform(message, this.maxDocumentLength) };\n            }\n        }\n        this.logDestination.write(logMessage);\n    }\n    /**\n     * Merges options set through environment variables and the MongoClient, preferring environment\n     * variables when both are set, and substituting defaults for values not set. Options set in\n     * constructor take precedence over both environment variables and MongoClient options.\n     *\n     * @remarks\n     * When parsing component severity levels, invalid values are treated as unset and replaced with\n     * the default severity.\n     *\n     * @param envOptions - options set for the logger from the environment\n     * @param clientOptions - options set for the logger in the MongoClient options\n     * @returns a MongoLoggerOptions object to be used when instantiating a new MongoLogger\n     */\n    static resolveOptions(envOptions, clientOptions) {\n        // client options take precedence over env options\n        const combinedOptions = {\n            ...envOptions,\n            ...clientOptions,\n            mongodbLogPath: resolveLogPath(envOptions, clientOptions)\n        };\n        const defaultSeverity = parseSeverityFromString(combinedOptions.MONGODB_LOG_ALL) ?? exports.SeverityLevel.OFF;\n        return {\n            componentSeverities: {\n                command: parseSeverityFromString(combinedOptions.MONGODB_LOG_COMMAND) ?? defaultSeverity,\n                topology: parseSeverityFromString(combinedOptions.MONGODB_LOG_TOPOLOGY) ?? defaultSeverity,\n                serverSelection: parseSeverityFromString(combinedOptions.MONGODB_LOG_SERVER_SELECTION) ?? defaultSeverity,\n                connection: parseSeverityFromString(combinedOptions.MONGODB_LOG_CONNECTION) ?? defaultSeverity,\n                default: defaultSeverity\n            },\n            maxDocumentLength: (0, utils_1.parseUnsignedInteger)(combinedOptions.MONGODB_LOG_MAX_DOCUMENT_LENGTH) ?? 1000,\n            logDestination: combinedOptions.mongodbLogPath\n        };\n    }\n}\nexports.MongoLogger = MongoLogger;\n//# sourceMappingURL=mongo_logger.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9tb25nb19sb2dnZXIuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsbUJBQW1CLEdBQUcsMkJBQTJCLEdBQUcseUJBQXlCLEdBQUcsOEJBQThCLEdBQUcsMEJBQTBCLEdBQUcsbUNBQW1DLEdBQUcscUJBQXFCO0FBQ3pNLGVBQWUsbUJBQU8sQ0FBQyw0REFBTTtBQUM3QixlQUFlLG1CQUFPLENBQUMsa0JBQU07QUFDN0Isb0JBQW9CLG1CQUFPLENBQUMsMEVBQWE7QUFDekMsZ0JBQWdCLG1CQUFPLENBQUMsa0VBQVM7QUFDakM7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQSxtQ0FBbUM7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhCQUE4QjtBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvREFBb0Qsc0NBQXNDO0FBQzFGO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCLGtCQUFrQixJQUFJLGdCQUFnQjtBQUNoRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYSxrQ0FBa0M7QUFDL0M7QUFDQTtBQUNBLDJCQUEyQjtBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLGFBQWE7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksYUFBYTtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLDZFQUE2RTtBQUNyRztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwREFBMEQsaUJBQWlCO0FBQzNFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwREFBMEQsaUJBQWlCO0FBQzNFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0I7QUFDL0I7QUFDQTtBQUNBLCtCQUErQjtBQUMvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUI7QUFDbkIiLCJzb3VyY2VzIjpbIkQ6XFxzYWxvbmlcXGFwcHJhaXNhbC1zeXN0ZW1cXHNlcnZlclxcbm9kZV9tb2R1bGVzXFxtb25nb2RiXFxsaWJcXG1vbmdvX2xvZ2dlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuTW9uZ29Mb2dnZXIgPSBleHBvcnRzLnN0cmluZ2lmeVdpdGhNYXhMZW4gPSBleHBvcnRzLmNyZWF0ZVN0ZGlvTG9nZ2VyID0gZXhwb3J0cy5Nb25nb0xvZ2dhYmxlQ29tcG9uZW50ID0gZXhwb3J0cy5TRVZFUklUWV9MRVZFTF9NQVAgPSBleHBvcnRzLkRFRkFVTFRfTUFYX0RPQ1VNRU5UX0xFTkdUSCA9IGV4cG9ydHMuU2V2ZXJpdHlMZXZlbCA9IHZvaWQgMDtcbmNvbnN0IGJzb25fMSA9IHJlcXVpcmUoXCJic29uXCIpO1xuY29uc3QgdXRpbF8xID0gcmVxdWlyZShcInV0aWxcIik7XG5jb25zdCBjb25zdGFudHNfMSA9IHJlcXVpcmUoXCIuL2NvbnN0YW50c1wiKTtcbmNvbnN0IHV0aWxzXzEgPSByZXF1aXJlKFwiLi91dGlsc1wiKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmV4cG9ydHMuU2V2ZXJpdHlMZXZlbCA9IE9iamVjdC5mcmVlemUoe1xuICAgIEVNRVJHRU5DWTogJ2VtZXJnZW5jeScsXG4gICAgQUxFUlQ6ICdhbGVydCcsXG4gICAgQ1JJVElDQUw6ICdjcml0aWNhbCcsXG4gICAgRVJST1I6ICdlcnJvcicsXG4gICAgV0FSTklORzogJ3dhcm4nLFxuICAgIE5PVElDRTogJ25vdGljZScsXG4gICAgSU5GT1JNQVRJT05BTDogJ2luZm8nLFxuICAgIERFQlVHOiAnZGVidWcnLFxuICAgIFRSQUNFOiAndHJhY2UnLFxuICAgIE9GRjogJ29mZidcbn0pO1xuLyoqIEBpbnRlcm5hbCAqL1xuZXhwb3J0cy5ERUZBVUxUX01BWF9ET0NVTUVOVF9MRU5HVEggPSAxMDAwO1xuLyoqIEBpbnRlcm5hbCAqL1xuY2xhc3MgU2V2ZXJpdHlMZXZlbE1hcCBleHRlbmRzIE1hcCB7XG4gICAgY29uc3RydWN0b3IoZW50cmllcykge1xuICAgICAgICBjb25zdCBuZXdFbnRyaWVzID0gW107XG4gICAgICAgIGZvciAoY29uc3QgW2xldmVsLCB2YWx1ZV0gb2YgZW50cmllcykge1xuICAgICAgICAgICAgbmV3RW50cmllcy5wdXNoKFt2YWx1ZSwgbGV2ZWxdKTtcbiAgICAgICAgfVxuICAgICAgICBuZXdFbnRyaWVzLnB1c2goLi4uZW50cmllcyk7XG4gICAgICAgIHN1cGVyKG5ld0VudHJpZXMpO1xuICAgIH1cbiAgICBnZXROdW1lcmljU2V2ZXJpdHlMZXZlbChzZXZlcml0eSkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXQoc2V2ZXJpdHkpO1xuICAgIH1cbiAgICBnZXRTZXZlcml0eUxldmVsTmFtZShsZXZlbCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXQobGV2ZWwpO1xuICAgIH1cbn1cbi8qKiBAaW50ZXJuYWwgKi9cbmV4cG9ydHMuU0VWRVJJVFlfTEVWRUxfTUFQID0gbmV3IFNldmVyaXR5TGV2ZWxNYXAoW1xuICAgIFtleHBvcnRzLlNldmVyaXR5TGV2ZWwuT0ZGLCAtSW5maW5pdHldLFxuICAgIFtleHBvcnRzLlNldmVyaXR5TGV2ZWwuRU1FUkdFTkNZLCAwXSxcbiAgICBbZXhwb3J0cy5TZXZlcml0eUxldmVsLkFMRVJULCAxXSxcbiAgICBbZXhwb3J0cy5TZXZlcml0eUxldmVsLkNSSVRJQ0FMLCAyXSxcbiAgICBbZXhwb3J0cy5TZXZlcml0eUxldmVsLkVSUk9SLCAzXSxcbiAgICBbZXhwb3J0cy5TZXZlcml0eUxldmVsLldBUk5JTkcsIDRdLFxuICAgIFtleHBvcnRzLlNldmVyaXR5TGV2ZWwuTk9USUNFLCA1XSxcbiAgICBbZXhwb3J0cy5TZXZlcml0eUxldmVsLklORk9STUFUSU9OQUwsIDZdLFxuICAgIFtleHBvcnRzLlNldmVyaXR5TGV2ZWwuREVCVUcsIDddLFxuICAgIFtleHBvcnRzLlNldmVyaXR5TGV2ZWwuVFJBQ0UsIDhdXG5dKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmV4cG9ydHMuTW9uZ29Mb2dnYWJsZUNvbXBvbmVudCA9IE9iamVjdC5mcmVlemUoe1xuICAgIENPTU1BTkQ6ICdjb21tYW5kJyxcbiAgICBUT1BPTE9HWTogJ3RvcG9sb2d5JyxcbiAgICBTRVJWRVJfU0VMRUNUSU9OOiAnc2VydmVyU2VsZWN0aW9uJyxcbiAgICBDT05ORUNUSU9OOiAnY29ubmVjdGlvbidcbn0pO1xuLyoqXG4gKiBQYXJzZXMgYSBzdHJpbmcgYXMgb25lIG9mIFNldmVyaXR5TGV2ZWxcbiAqXG4gKiBAcGFyYW0gcyAtIHRoZSB2YWx1ZSB0byBiZSBwYXJzZWRcbiAqIEByZXR1cm5zIG9uZSBvZiBTZXZlcml0eUxldmVsIGlmIHZhbHVlIGNhbiBiZSBwYXJzZWQgYXMgc3VjaCwgb3RoZXJ3aXNlIG51bGxcbiAqL1xuZnVuY3Rpb24gcGFyc2VTZXZlcml0eUZyb21TdHJpbmcocykge1xuICAgIGNvbnN0IHZhbGlkU2V2ZXJpdGllcyA9IE9iamVjdC52YWx1ZXMoZXhwb3J0cy5TZXZlcml0eUxldmVsKTtcbiAgICBjb25zdCBsb3dlclNldmVyaXR5ID0gcz8udG9Mb3dlckNhc2UoKTtcbiAgICBpZiAobG93ZXJTZXZlcml0eSAhPSBudWxsICYmIHZhbGlkU2V2ZXJpdGllcy5pbmNsdWRlcyhsb3dlclNldmVyaXR5KSkge1xuICAgICAgICByZXR1cm4gbG93ZXJTZXZlcml0eTtcbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG59XG4vKiogQGludGVybmFsICovXG5mdW5jdGlvbiBjcmVhdGVTdGRpb0xvZ2dlcihzdHJlYW0pIHtcbiAgICByZXR1cm4ge1xuICAgICAgICB3cml0ZTogKGxvZykgPT4ge1xuICAgICAgICAgICAgc3RyZWFtLndyaXRlKCgwLCB1dGlsXzEuaW5zcGVjdCkobG9nLCB7IGNvbXBhY3Q6IHRydWUsIGJyZWFrTGVuZ3RoOiBJbmZpbml0eSB9KSwgJ3V0Zi04Jyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICB9O1xufVxuZXhwb3J0cy5jcmVhdGVTdGRpb0xvZ2dlciA9IGNyZWF0ZVN0ZGlvTG9nZ2VyO1xuLyoqXG4gKiByZXNvbHZlcyB0aGUgTU9OR09EQl9MT0dfUEFUSCBhbmQgbW9uZ29kYkxvZ1BhdGggb3B0aW9ucyBmcm9tIHRoZSBlbnZpcm9ubWVudCBhbmQgdGhlXG4gKiBtb25nbyBjbGllbnQgb3B0aW9ucyByZXNwZWN0aXZlbHkuIFRoZSBtb25nb2RiTG9nUGF0aCBjYW4gYmUgZWl0aGVyICdzdGRvdXQnLCAnc3RkZXJyJywgYSBOb2RlSlNcbiAqIFdyaXRhYmxlIG9yIGFuIG9iamVjdCB3aGljaCBoYXMgYSBgd3JpdGVgIG1ldGhvZCB3aXRoIHRoZSBzaWduYXR1cmU6XG4gKiBgYGB0c1xuICogd3JpdGUobG9nOiBMb2cpOiB2b2lkXG4gKiBgYGBcbiAqXG4gKiBAcmV0dXJucyB0aGUgTW9uZ29EQkxvZ1dyaXRhYmxlIG9iamVjdCB0byB3cml0ZSBsb2dzIHRvXG4gKi9cbmZ1bmN0aW9uIHJlc29sdmVMb2dQYXRoKHsgTU9OR09EQl9MT0dfUEFUSCB9LCB7IG1vbmdvZGJMb2dQYXRoIH0pIHtcbiAgICBpZiAodHlwZW9mIG1vbmdvZGJMb2dQYXRoID09PSAnc3RyaW5nJyAmJiAvXnN0ZGVyciQvaS50ZXN0KG1vbmdvZGJMb2dQYXRoKSkge1xuICAgICAgICByZXR1cm4gY3JlYXRlU3RkaW9Mb2dnZXIocHJvY2Vzcy5zdGRlcnIpO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIG1vbmdvZGJMb2dQYXRoID09PSAnc3RyaW5nJyAmJiAvXnN0ZG91dCQvaS50ZXN0KG1vbmdvZGJMb2dQYXRoKSkge1xuICAgICAgICByZXR1cm4gY3JlYXRlU3RkaW9Mb2dnZXIocHJvY2Vzcy5zdGRvdXQpO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIG1vbmdvZGJMb2dQYXRoID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9uZ29kYkxvZ1BhdGg/LndyaXRlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIHJldHVybiBtb25nb2RiTG9nUGF0aDtcbiAgICB9XG4gICAgaWYgKE1PTkdPREJfTE9HX1BBVEggJiYgL15zdGRlcnIkL2kudGVzdChNT05HT0RCX0xPR19QQVRIKSkge1xuICAgICAgICByZXR1cm4gY3JlYXRlU3RkaW9Mb2dnZXIocHJvY2Vzcy5zdGRlcnIpO1xuICAgIH1cbiAgICBpZiAoTU9OR09EQl9MT0dfUEFUSCAmJiAvXnN0ZG91dCQvaS50ZXN0KE1PTkdPREJfTE9HX1BBVEgpKSB7XG4gICAgICAgIHJldHVybiBjcmVhdGVTdGRpb0xvZ2dlcihwcm9jZXNzLnN0ZG91dCk7XG4gICAgfVxuICAgIHJldHVybiBjcmVhdGVTdGRpb0xvZ2dlcihwcm9jZXNzLnN0ZGVycik7XG59XG5mdW5jdGlvbiBjb21wYXJlU2V2ZXJpdHkoczAsIHMxKSB7XG4gICAgY29uc3QgczBOdW0gPSBleHBvcnRzLlNFVkVSSVRZX0xFVkVMX01BUC5nZXROdW1lcmljU2V2ZXJpdHlMZXZlbChzMCk7XG4gICAgY29uc3QgczFOdW0gPSBleHBvcnRzLlNFVkVSSVRZX0xFVkVMX01BUC5nZXROdW1lcmljU2V2ZXJpdHlMZXZlbChzMSk7XG4gICAgcmV0dXJuIHMwTnVtIDwgczFOdW0gPyAtMSA6IHMwTnVtID4gczFOdW0gPyAxIDogMDtcbn1cbi8qKiBAaW50ZXJuYWwgKi9cbmZ1bmN0aW9uIHN0cmluZ2lmeVdpdGhNYXhMZW4odmFsdWUsIG1heERvY3VtZW50TGVuZ3RoKSB7XG4gICAgY29uc3QgZWpzb24gPSBic29uXzEuRUpTT04uc3RyaW5naWZ5KHZhbHVlKTtcbiAgICByZXR1cm4gbWF4RG9jdW1lbnRMZW5ndGggIT09IDAgJiYgZWpzb24ubGVuZ3RoID4gbWF4RG9jdW1lbnRMZW5ndGhcbiAgICAgICAgPyBgJHtlanNvbi5zbGljZSgwLCBtYXhEb2N1bWVudExlbmd0aCl9Li4uYFxuICAgICAgICA6IGVqc29uO1xufVxuZXhwb3J0cy5zdHJpbmdpZnlXaXRoTWF4TGVuID0gc3RyaW5naWZ5V2l0aE1heExlbjtcbmZ1bmN0aW9uIGlzTG9nQ29udmVydGlibGUob2JqKSB7XG4gICAgY29uc3Qgb2JqQXNMb2dDb252ZXJ0aWJsZSA9IG9iajtcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcmVzdHJpY3RlZC1zeW50YXhcbiAgICByZXR1cm4gb2JqQXNMb2dDb252ZXJ0aWJsZS50b0xvZyAhPT0gdW5kZWZpbmVkICYmIHR5cGVvZiBvYmpBc0xvZ0NvbnZlcnRpYmxlLnRvTG9nID09PSAnZnVuY3Rpb24nO1xufVxuZnVuY3Rpb24gYXR0YWNoQ29tbWFuZEZpZWxkcyhsb2csIGNvbW1hbmRFdmVudCkge1xuICAgIGxvZy5jb21tYW5kTmFtZSA9IGNvbW1hbmRFdmVudC5jb21tYW5kTmFtZTtcbiAgICBsb2cucmVxdWVzdElkID0gY29tbWFuZEV2ZW50LnJlcXVlc3RJZDtcbiAgICBsb2cuZHJpdmVyQ29ubmVjdGlvbklkID0gY29tbWFuZEV2ZW50Py5jb25uZWN0aW9uSWQ7XG4gICAgY29uc3QgeyBob3N0LCBwb3J0IH0gPSB1dGlsc18xLkhvc3RBZGRyZXNzLmZyb21TdHJpbmcoY29tbWFuZEV2ZW50LmFkZHJlc3MpLnRvSG9zdFBvcnQoKTtcbiAgICBsb2cuc2VydmVySG9zdCA9IGhvc3Q7XG4gICAgbG9nLnNlcnZlclBvcnQgPSBwb3J0O1xuICAgIGlmIChjb21tYW5kRXZlbnQ/LnNlcnZpY2VJZCkge1xuICAgICAgICBsb2cuc2VydmljZUlkID0gY29tbWFuZEV2ZW50LnNlcnZpY2VJZC50b0hleFN0cmluZygpO1xuICAgIH1cbiAgICByZXR1cm4gbG9nO1xufVxuZnVuY3Rpb24gYXR0YWNoQ29ubmVjdGlvbkZpZWxkcyhsb2csIGNvbm5lY3Rpb25Qb29sRXZlbnQpIHtcbiAgICBjb25zdCB7IGhvc3QsIHBvcnQgfSA9IHV0aWxzXzEuSG9zdEFkZHJlc3MuZnJvbVN0cmluZyhjb25uZWN0aW9uUG9vbEV2ZW50LmFkZHJlc3MpLnRvSG9zdFBvcnQoKTtcbiAgICBsb2cuc2VydmVySG9zdCA9IGhvc3Q7XG4gICAgbG9nLnNlcnZlclBvcnQgPSBwb3J0O1xuICAgIHJldHVybiBsb2c7XG59XG5mdW5jdGlvbiBkZWZhdWx0TG9nVHJhbnNmb3JtKGxvZ09iamVjdCwgbWF4RG9jdW1lbnRMZW5ndGggPSBleHBvcnRzLkRFRkFVTFRfTUFYX0RPQ1VNRU5UX0xFTkdUSCkge1xuICAgIGxldCBsb2cgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuICAgIHN3aXRjaCAobG9nT2JqZWN0Lm5hbWUpIHtcbiAgICAgICAgY2FzZSBjb25zdGFudHNfMS5DT01NQU5EX1NUQVJURUQ6XG4gICAgICAgICAgICBsb2cgPSBhdHRhY2hDb21tYW5kRmllbGRzKGxvZywgbG9nT2JqZWN0KTtcbiAgICAgICAgICAgIGxvZy5tZXNzYWdlID0gJ0NvbW1hbmQgc3RhcnRlZCc7XG4gICAgICAgICAgICBsb2cuY29tbWFuZCA9IHN0cmluZ2lmeVdpdGhNYXhMZW4obG9nT2JqZWN0LmNvbW1hbmQsIG1heERvY3VtZW50TGVuZ3RoKTtcbiAgICAgICAgICAgIGxvZy5kYXRhYmFzZU5hbWUgPSBsb2dPYmplY3QuZGF0YWJhc2VOYW1lO1xuICAgICAgICAgICAgcmV0dXJuIGxvZztcbiAgICAgICAgY2FzZSBjb25zdGFudHNfMS5DT01NQU5EX1NVQ0NFRURFRDpcbiAgICAgICAgICAgIGxvZyA9IGF0dGFjaENvbW1hbmRGaWVsZHMobG9nLCBsb2dPYmplY3QpO1xuICAgICAgICAgICAgbG9nLm1lc3NhZ2UgPSAnQ29tbWFuZCBzdWNjZWVkZWQnO1xuICAgICAgICAgICAgbG9nLmR1cmF0aW9uTVMgPSBsb2dPYmplY3QuZHVyYXRpb247XG4gICAgICAgICAgICBsb2cucmVwbHkgPSBzdHJpbmdpZnlXaXRoTWF4TGVuKGxvZ09iamVjdC5yZXBseSwgbWF4RG9jdW1lbnRMZW5ndGgpO1xuICAgICAgICAgICAgcmV0dXJuIGxvZztcbiAgICAgICAgY2FzZSBjb25zdGFudHNfMS5DT01NQU5EX0ZBSUxFRDpcbiAgICAgICAgICAgIGxvZyA9IGF0dGFjaENvbW1hbmRGaWVsZHMobG9nLCBsb2dPYmplY3QpO1xuICAgICAgICAgICAgbG9nLm1lc3NhZ2UgPSAnQ29tbWFuZCBmYWlsZWQnO1xuICAgICAgICAgICAgbG9nLmR1cmF0aW9uTVMgPSBsb2dPYmplY3QuZHVyYXRpb247XG4gICAgICAgICAgICBsb2cuZmFpbHVyZSA9IGxvZ09iamVjdC5mYWlsdXJlO1xuICAgICAgICAgICAgcmV0dXJuIGxvZztcbiAgICAgICAgY2FzZSBjb25zdGFudHNfMS5DT05ORUNUSU9OX1BPT0xfQ1JFQVRFRDpcbiAgICAgICAgICAgIGxvZyA9IGF0dGFjaENvbm5lY3Rpb25GaWVsZHMobG9nLCBsb2dPYmplY3QpO1xuICAgICAgICAgICAgbG9nLm1lc3NhZ2UgPSAnQ29ubmVjdGlvbiBwb29sIGNyZWF0ZWQnO1xuICAgICAgICAgICAgaWYgKGxvZ09iamVjdC5vcHRpb25zKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBtYXhJZGxlVGltZU1TLCBtaW5Qb29sU2l6ZSwgbWF4UG9vbFNpemUsIG1heENvbm5lY3RpbmcsIHdhaXRRdWV1ZVRpbWVvdXRNUyB9ID0gbG9nT2JqZWN0Lm9wdGlvbnM7XG4gICAgICAgICAgICAgICAgbG9nID0ge1xuICAgICAgICAgICAgICAgICAgICAuLi5sb2csXG4gICAgICAgICAgICAgICAgICAgIG1heElkbGVUaW1lTVMsXG4gICAgICAgICAgICAgICAgICAgIG1pblBvb2xTaXplLFxuICAgICAgICAgICAgICAgICAgICBtYXhQb29sU2l6ZSxcbiAgICAgICAgICAgICAgICAgICAgbWF4Q29ubmVjdGluZyxcbiAgICAgICAgICAgICAgICAgICAgd2FpdFF1ZXVlVGltZW91dE1TXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBsb2c7XG4gICAgICAgIGNhc2UgY29uc3RhbnRzXzEuQ09OTkVDVElPTl9QT09MX1JFQURZOlxuICAgICAgICAgICAgbG9nID0gYXR0YWNoQ29ubmVjdGlvbkZpZWxkcyhsb2csIGxvZ09iamVjdCk7XG4gICAgICAgICAgICBsb2cubWVzc2FnZSA9ICdDb25uZWN0aW9uIHBvb2wgcmVhZHknO1xuICAgICAgICAgICAgcmV0dXJuIGxvZztcbiAgICAgICAgY2FzZSBjb25zdGFudHNfMS5DT05ORUNUSU9OX1BPT0xfQ0xFQVJFRDpcbiAgICAgICAgICAgIGxvZyA9IGF0dGFjaENvbm5lY3Rpb25GaWVsZHMobG9nLCBsb2dPYmplY3QpO1xuICAgICAgICAgICAgbG9nLm1lc3NhZ2UgPSAnQ29ubmVjdGlvbiBwb29sIGNsZWFyZWQnO1xuICAgICAgICAgICAgaWYgKGxvZ09iamVjdC5zZXJ2aWNlSWQ/Ll9ic29udHlwZSA9PT0gJ09iamVjdElkJykge1xuICAgICAgICAgICAgICAgIGxvZy5zZXJ2aWNlSWQgPSBsb2dPYmplY3Quc2VydmljZUlkLnRvSGV4U3RyaW5nKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbG9nO1xuICAgICAgICBjYXNlIGNvbnN0YW50c18xLkNPTk5FQ1RJT05fUE9PTF9DTE9TRUQ6XG4gICAgICAgICAgICBsb2cgPSBhdHRhY2hDb25uZWN0aW9uRmllbGRzKGxvZywgbG9nT2JqZWN0KTtcbiAgICAgICAgICAgIGxvZy5tZXNzYWdlID0gJ0Nvbm5lY3Rpb24gcG9vbCBjbG9zZWQnO1xuICAgICAgICAgICAgcmV0dXJuIGxvZztcbiAgICAgICAgY2FzZSBjb25zdGFudHNfMS5DT05ORUNUSU9OX0NSRUFURUQ6XG4gICAgICAgICAgICBsb2cgPSBhdHRhY2hDb25uZWN0aW9uRmllbGRzKGxvZywgbG9nT2JqZWN0KTtcbiAgICAgICAgICAgIGxvZy5tZXNzYWdlID0gJ0Nvbm5lY3Rpb24gY3JlYXRlZCc7XG4gICAgICAgICAgICBsb2cuZHJpdmVyQ29ubmVjdGlvbklkID0gbG9nT2JqZWN0LmNvbm5lY3Rpb25JZDtcbiAgICAgICAgICAgIHJldHVybiBsb2c7XG4gICAgICAgIGNhc2UgY29uc3RhbnRzXzEuQ09OTkVDVElPTl9SRUFEWTpcbiAgICAgICAgICAgIGxvZyA9IGF0dGFjaENvbm5lY3Rpb25GaWVsZHMobG9nLCBsb2dPYmplY3QpO1xuICAgICAgICAgICAgbG9nLm1lc3NhZ2UgPSAnQ29ubmVjdGlvbiByZWFkeSc7XG4gICAgICAgICAgICBsb2cuZHJpdmVyQ29ubmVjdGlvbklkID0gbG9nT2JqZWN0LmNvbm5lY3Rpb25JZDtcbiAgICAgICAgICAgIHJldHVybiBsb2c7XG4gICAgICAgIGNhc2UgY29uc3RhbnRzXzEuQ09OTkVDVElPTl9DTE9TRUQ6XG4gICAgICAgICAgICBsb2cgPSBhdHRhY2hDb25uZWN0aW9uRmllbGRzKGxvZywgbG9nT2JqZWN0KTtcbiAgICAgICAgICAgIGxvZy5tZXNzYWdlID0gJ0Nvbm5lY3Rpb24gY2xvc2VkJztcbiAgICAgICAgICAgIGxvZy5kcml2ZXJDb25uZWN0aW9uSWQgPSBsb2dPYmplY3QuY29ubmVjdGlvbklkO1xuICAgICAgICAgICAgc3dpdGNoIChsb2dPYmplY3QucmVhc29uKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnc3RhbGUnOlxuICAgICAgICAgICAgICAgICAgICBsb2cucmVhc29uID0gJ0Nvbm5lY3Rpb24gYmVjYW1lIHN0YWxlIGJlY2F1c2UgdGhlIHBvb2wgd2FzIGNsZWFyZWQnO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdpZGxlJzpcbiAgICAgICAgICAgICAgICAgICAgbG9nLnJlYXNvbiA9XG4gICAgICAgICAgICAgICAgICAgICAgICAnQ29ubmVjdGlvbiBoYXMgYmVlbiBhdmFpbGFibGUgYnV0IHVudXNlZCBmb3IgbG9uZ2VyIHRoYW4gdGhlIGNvbmZpZ3VyZWQgbWF4IGlkbGUgdGltZSc7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ2Vycm9yJzpcbiAgICAgICAgICAgICAgICAgICAgbG9nLnJlYXNvbiA9ICdBbiBlcnJvciBvY2N1cnJlZCB3aGlsZSB1c2luZyB0aGUgY29ubmVjdGlvbic7XG4gICAgICAgICAgICAgICAgICAgIGlmIChsb2dPYmplY3QuZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZy5lcnJvciA9IGxvZ09iamVjdC5lcnJvcjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdwb29sQ2xvc2VkJzpcbiAgICAgICAgICAgICAgICAgICAgbG9nLnJlYXNvbiA9ICdDb25uZWN0aW9uIHBvb2wgd2FzIGNsb3NlZCc7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIGxvZy5yZWFzb24gPSBgVW5rbm93biBjbG9zZSByZWFzb246ICR7bG9nT2JqZWN0LnJlYXNvbn1gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGxvZztcbiAgICAgICAgY2FzZSBjb25zdGFudHNfMS5DT05ORUNUSU9OX0NIRUNLX09VVF9TVEFSVEVEOlxuICAgICAgICAgICAgbG9nID0gYXR0YWNoQ29ubmVjdGlvbkZpZWxkcyhsb2csIGxvZ09iamVjdCk7XG4gICAgICAgICAgICBsb2cubWVzc2FnZSA9ICdDb25uZWN0aW9uIGNoZWNrb3V0IHN0YXJ0ZWQnO1xuICAgICAgICAgICAgcmV0dXJuIGxvZztcbiAgICAgICAgY2FzZSBjb25zdGFudHNfMS5DT05ORUNUSU9OX0NIRUNLX09VVF9GQUlMRUQ6XG4gICAgICAgICAgICBsb2cgPSBhdHRhY2hDb25uZWN0aW9uRmllbGRzKGxvZywgbG9nT2JqZWN0KTtcbiAgICAgICAgICAgIGxvZy5tZXNzYWdlID0gJ0Nvbm5lY3Rpb24gY2hlY2tvdXQgZmFpbGVkJztcbiAgICAgICAgICAgIHN3aXRjaCAobG9nT2JqZWN0LnJlYXNvbikge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3Bvb2xDbG9zZWQnOlxuICAgICAgICAgICAgICAgICAgICBsb2cucmVhc29uID0gJ0Nvbm5lY3Rpb24gcG9vbCB3YXMgY2xvc2VkJztcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAndGltZW91dCc6XG4gICAgICAgICAgICAgICAgICAgIGxvZy5yZWFzb24gPSAnV2FpdCBxdWV1ZSB0aW1lb3V0IGVsYXBzZWQgd2l0aG91dCBhIGNvbm5lY3Rpb24gYmVjb21pbmcgYXZhaWxhYmxlJztcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnY29ubmVjdGlvbkVycm9yJzpcbiAgICAgICAgICAgICAgICAgICAgbG9nLnJlYXNvbiA9ICdBbiBlcnJvciBvY2N1cnJlZCB3aGlsZSB0cnlpbmcgdG8gZXN0YWJsaXNoIGEgbmV3IGNvbm5lY3Rpb24nO1xuICAgICAgICAgICAgICAgICAgICBpZiAobG9nT2JqZWN0LmVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsb2cuZXJyb3IgPSBsb2dPYmplY3QuZXJyb3I7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgbG9nLnJlYXNvbiA9IGBVbmtub3duIGNsb3NlIHJlYXNvbjogJHtsb2dPYmplY3QucmVhc29ufWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbG9nO1xuICAgICAgICBjYXNlIGNvbnN0YW50c18xLkNPTk5FQ1RJT05fQ0hFQ0tFRF9PVVQ6XG4gICAgICAgICAgICBsb2cgPSBhdHRhY2hDb25uZWN0aW9uRmllbGRzKGxvZywgbG9nT2JqZWN0KTtcbiAgICAgICAgICAgIGxvZy5tZXNzYWdlID0gJ0Nvbm5lY3Rpb24gY2hlY2tlZCBvdXQnO1xuICAgICAgICAgICAgbG9nLmRyaXZlckNvbm5lY3Rpb25JZCA9IGxvZ09iamVjdC5jb25uZWN0aW9uSWQ7XG4gICAgICAgICAgICByZXR1cm4gbG9nO1xuICAgICAgICBjYXNlIGNvbnN0YW50c18xLkNPTk5FQ1RJT05fQ0hFQ0tFRF9JTjpcbiAgICAgICAgICAgIGxvZyA9IGF0dGFjaENvbm5lY3Rpb25GaWVsZHMobG9nLCBsb2dPYmplY3QpO1xuICAgICAgICAgICAgbG9nLm1lc3NhZ2UgPSAnQ29ubmVjdGlvbiBjaGVja2VkIGluJztcbiAgICAgICAgICAgIGxvZy5kcml2ZXJDb25uZWN0aW9uSWQgPSBsb2dPYmplY3QuY29ubmVjdGlvbklkO1xuICAgICAgICAgICAgcmV0dXJuIGxvZztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKGxvZ09iamVjdCkpIHtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT0gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgbG9nW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGxvZztcbn1cbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIE1vbmdvTG9nZ2VyIHtcbiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGlzIG1ldGhvZCBzaG91bGQgYmUgdXNlZCB3aGVuIGxvZ2dpbmcgZXJyb3JzIHRoYXQgZG8gbm90IGhhdmUgYSBwdWJsaWMgZHJpdmVyIEFQSSBmb3JcbiAgICAgICAgICogcmVwb3J0aW5nIGVycm9ycy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZXJyb3IgPSB0aGlzLmxvZy5iaW5kKHRoaXMsICdlcnJvcicpO1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhpcyBtZXRob2Qgc2hvdWxkIGJlIHVzZWQgdG8gbG9nIHNpdHVhdGlvbnMgd2hlcmUgdW5kZXNpcmFibGUgYXBwbGljYXRpb24gYmVoYXZpb3VyIG1pZ2h0XG4gICAgICAgICAqIG9jY3VyLiBGb3IgZXhhbXBsZSwgZmFpbGluZyB0byBlbmQgc2Vzc2lvbnMgb24gYE1vbmdvQ2xpZW50LmNsb3NlYC5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMud2FybiA9IHRoaXMubG9nLmJpbmQodGhpcywgJ3dhcm4nKTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoaXMgbWV0aG9kIHNob3VsZCBiZSB1c2VkIHRvIHJlcG9ydCBoaWdoLWxldmVsIGluZm9ybWF0aW9uIGFib3V0IG5vcm1hbCBkcml2ZXIgYmVoYXZpb3VyLlxuICAgICAgICAgKiBGb3IgZXhhbXBsZSwgdGhlIGNyZWF0aW9uIG9mIGEgYE1vbmdvQ2xpZW50YC5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuaW5mbyA9IHRoaXMubG9nLmJpbmQodGhpcywgJ2luZm8nKTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoaXMgbWV0aG9kIHNob3VsZCBiZSB1c2VkIHRvIHJlcG9ydCBpbmZvcm1hdGlvbiB0aGF0IHdvdWxkIGJlIGhlbHBmdWwgd2hlbiBkZWJ1Z2dpbmcgYW5cbiAgICAgICAgICogYXBwbGljYXRpb24uIEZvciBleGFtcGxlLCBhIGNvbW1hbmQgc3RhcnRpbmcsIHN1Y2NlZWRpbmcgb3IgZmFpbGluZy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZGVidWcgPSB0aGlzLmxvZy5iaW5kKHRoaXMsICdkZWJ1ZycpO1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhpcyBtZXRob2Qgc2hvdWxkIGJlIHVzZWQgdG8gcmVwb3J0IGZpbmUtZ3JhaW5lZCBkZXRhaWxzIHJlbGF0ZWQgdG8gbG9naWMgZmxvdy4gRm9yIGV4YW1wbGUsXG4gICAgICAgICAqIGVudGVyaW5nIGFuZCBleGl0aW5nIGEgZnVuY3Rpb24gYm9keS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudHJhY2UgPSB0aGlzLmxvZy5iaW5kKHRoaXMsICd0cmFjZScpO1xuICAgICAgICB0aGlzLmNvbXBvbmVudFNldmVyaXRpZXMgPSBvcHRpb25zLmNvbXBvbmVudFNldmVyaXRpZXM7XG4gICAgICAgIHRoaXMubWF4RG9jdW1lbnRMZW5ndGggPSBvcHRpb25zLm1heERvY3VtZW50TGVuZ3RoO1xuICAgICAgICB0aGlzLmxvZ0Rlc3RpbmF0aW9uID0gb3B0aW9ucy5sb2dEZXN0aW5hdGlvbjtcbiAgICB9XG4gICAgbG9nKHNldmVyaXR5LCBjb21wb25lbnQsIG1lc3NhZ2UpIHtcbiAgICAgICAgaWYgKGNvbXBhcmVTZXZlcml0eShzZXZlcml0eSwgdGhpcy5jb21wb25lbnRTZXZlcml0aWVzW2NvbXBvbmVudF0pID4gMClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgbGV0IGxvZ01lc3NhZ2UgPSB7IHQ6IG5ldyBEYXRlKCksIGM6IGNvbXBvbmVudCwgczogc2V2ZXJpdHkgfTtcbiAgICAgICAgaWYgKHR5cGVvZiBtZXNzYWdlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgbG9nTWVzc2FnZS5tZXNzYWdlID0gbWVzc2FnZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0eXBlb2YgbWVzc2FnZSA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgIGlmIChpc0xvZ0NvbnZlcnRpYmxlKG1lc3NhZ2UpKSB7XG4gICAgICAgICAgICAgICAgbG9nTWVzc2FnZSA9IHsgLi4ubG9nTWVzc2FnZSwgLi4ubWVzc2FnZS50b0xvZygpIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBsb2dNZXNzYWdlID0geyAuLi5sb2dNZXNzYWdlLCAuLi5kZWZhdWx0TG9nVHJhbnNmb3JtKG1lc3NhZ2UsIHRoaXMubWF4RG9jdW1lbnRMZW5ndGgpIH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5sb2dEZXN0aW5hdGlvbi53cml0ZShsb2dNZXNzYWdlKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogTWVyZ2VzIG9wdGlvbnMgc2V0IHRocm91Z2ggZW52aXJvbm1lbnQgdmFyaWFibGVzIGFuZCB0aGUgTW9uZ29DbGllbnQsIHByZWZlcnJpbmcgZW52aXJvbm1lbnRcbiAgICAgKiB2YXJpYWJsZXMgd2hlbiBib3RoIGFyZSBzZXQsIGFuZCBzdWJzdGl0dXRpbmcgZGVmYXVsdHMgZm9yIHZhbHVlcyBub3Qgc2V0LiBPcHRpb25zIHNldCBpblxuICAgICAqIGNvbnN0cnVjdG9yIHRha2UgcHJlY2VkZW5jZSBvdmVyIGJvdGggZW52aXJvbm1lbnQgdmFyaWFibGVzIGFuZCBNb25nb0NsaWVudCBvcHRpb25zLlxuICAgICAqXG4gICAgICogQHJlbWFya3NcbiAgICAgKiBXaGVuIHBhcnNpbmcgY29tcG9uZW50IHNldmVyaXR5IGxldmVscywgaW52YWxpZCB2YWx1ZXMgYXJlIHRyZWF0ZWQgYXMgdW5zZXQgYW5kIHJlcGxhY2VkIHdpdGhcbiAgICAgKiB0aGUgZGVmYXVsdCBzZXZlcml0eS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBlbnZPcHRpb25zIC0gb3B0aW9ucyBzZXQgZm9yIHRoZSBsb2dnZXIgZnJvbSB0aGUgZW52aXJvbm1lbnRcbiAgICAgKiBAcGFyYW0gY2xpZW50T3B0aW9ucyAtIG9wdGlvbnMgc2V0IGZvciB0aGUgbG9nZ2VyIGluIHRoZSBNb25nb0NsaWVudCBvcHRpb25zXG4gICAgICogQHJldHVybnMgYSBNb25nb0xvZ2dlck9wdGlvbnMgb2JqZWN0IHRvIGJlIHVzZWQgd2hlbiBpbnN0YW50aWF0aW5nIGEgbmV3IE1vbmdvTG9nZ2VyXG4gICAgICovXG4gICAgc3RhdGljIHJlc29sdmVPcHRpb25zKGVudk9wdGlvbnMsIGNsaWVudE9wdGlvbnMpIHtcbiAgICAgICAgLy8gY2xpZW50IG9wdGlvbnMgdGFrZSBwcmVjZWRlbmNlIG92ZXIgZW52IG9wdGlvbnNcbiAgICAgICAgY29uc3QgY29tYmluZWRPcHRpb25zID0ge1xuICAgICAgICAgICAgLi4uZW52T3B0aW9ucyxcbiAgICAgICAgICAgIC4uLmNsaWVudE9wdGlvbnMsXG4gICAgICAgICAgICBtb25nb2RiTG9nUGF0aDogcmVzb2x2ZUxvZ1BhdGgoZW52T3B0aW9ucywgY2xpZW50T3B0aW9ucylcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgZGVmYXVsdFNldmVyaXR5ID0gcGFyc2VTZXZlcml0eUZyb21TdHJpbmcoY29tYmluZWRPcHRpb25zLk1PTkdPREJfTE9HX0FMTCkgPz8gZXhwb3J0cy5TZXZlcml0eUxldmVsLk9GRjtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGNvbXBvbmVudFNldmVyaXRpZXM6IHtcbiAgICAgICAgICAgICAgICBjb21tYW5kOiBwYXJzZVNldmVyaXR5RnJvbVN0cmluZyhjb21iaW5lZE9wdGlvbnMuTU9OR09EQl9MT0dfQ09NTUFORCkgPz8gZGVmYXVsdFNldmVyaXR5LFxuICAgICAgICAgICAgICAgIHRvcG9sb2d5OiBwYXJzZVNldmVyaXR5RnJvbVN0cmluZyhjb21iaW5lZE9wdGlvbnMuTU9OR09EQl9MT0dfVE9QT0xPR1kpID8/IGRlZmF1bHRTZXZlcml0eSxcbiAgICAgICAgICAgICAgICBzZXJ2ZXJTZWxlY3Rpb246IHBhcnNlU2V2ZXJpdHlGcm9tU3RyaW5nKGNvbWJpbmVkT3B0aW9ucy5NT05HT0RCX0xPR19TRVJWRVJfU0VMRUNUSU9OKSA/PyBkZWZhdWx0U2V2ZXJpdHksXG4gICAgICAgICAgICAgICAgY29ubmVjdGlvbjogcGFyc2VTZXZlcml0eUZyb21TdHJpbmcoY29tYmluZWRPcHRpb25zLk1PTkdPREJfTE9HX0NPTk5FQ1RJT04pID8/IGRlZmF1bHRTZXZlcml0eSxcbiAgICAgICAgICAgICAgICBkZWZhdWx0OiBkZWZhdWx0U2V2ZXJpdHlcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBtYXhEb2N1bWVudExlbmd0aDogKDAsIHV0aWxzXzEucGFyc2VVbnNpZ25lZEludGVnZXIpKGNvbWJpbmVkT3B0aW9ucy5NT05HT0RCX0xPR19NQVhfRE9DVU1FTlRfTEVOR1RIKSA/PyAxMDAwLFxuICAgICAgICAgICAgbG9nRGVzdGluYXRpb246IGNvbWJpbmVkT3B0aW9ucy5tb25nb2RiTG9nUGF0aFxuICAgICAgICB9O1xuICAgIH1cbn1cbmV4cG9ydHMuTW9uZ29Mb2dnZXIgPSBNb25nb0xvZ2dlcjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPW1vbmdvX2xvZ2dlci5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/mongo_logger.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/mongo_types.js":
/*!*********************************************************!*\
  !*** ../server/node_modules/mongodb/lib/mongo_types.js ***!
  \*********************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.CancellationToken = exports.TypedEventEmitter = void 0;\nconst events_1 = __webpack_require__(/*! events */ \"events\");\n/**\n * Typescript type safe event emitter\n * @public\n */\nclass TypedEventEmitter extends events_1.EventEmitter {\n    /** @internal */\n    emitAndLog(event, ...args) {\n        this.emit(event, ...args);\n        if (this.component)\n            this.mongoLogger?.debug(this.component, args[0]);\n    }\n}\nexports.TypedEventEmitter = TypedEventEmitter;\n/** @public */\nclass CancellationToken extends TypedEventEmitter {\n}\nexports.CancellationToken = CancellationToken;\n//# sourceMappingURL=mongo_types.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9tb25nb190eXBlcy5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCx5QkFBeUIsR0FBRyx5QkFBeUI7QUFDckQsaUJBQWlCLG1CQUFPLENBQUMsc0JBQVE7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QiIsInNvdXJjZXMiOlsiRDpcXHNhbG9uaVxcYXBwcmFpc2FsLXN5c3RlbVxcc2VydmVyXFxub2RlX21vZHVsZXNcXG1vbmdvZGJcXGxpYlxcbW9uZ29fdHlwZXMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkNhbmNlbGxhdGlvblRva2VuID0gZXhwb3J0cy5UeXBlZEV2ZW50RW1pdHRlciA9IHZvaWQgMDtcbmNvbnN0IGV2ZW50c18xID0gcmVxdWlyZShcImV2ZW50c1wiKTtcbi8qKlxuICogVHlwZXNjcmlwdCB0eXBlIHNhZmUgZXZlbnQgZW1pdHRlclxuICogQHB1YmxpY1xuICovXG5jbGFzcyBUeXBlZEV2ZW50RW1pdHRlciBleHRlbmRzIGV2ZW50c18xLkV2ZW50RW1pdHRlciB7XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGVtaXRBbmRMb2coZXZlbnQsIC4uLmFyZ3MpIHtcbiAgICAgICAgdGhpcy5lbWl0KGV2ZW50LCAuLi5hcmdzKTtcbiAgICAgICAgaWYgKHRoaXMuY29tcG9uZW50KVxuICAgICAgICAgICAgdGhpcy5tb25nb0xvZ2dlcj8uZGVidWcodGhpcy5jb21wb25lbnQsIGFyZ3NbMF0pO1xuICAgIH1cbn1cbmV4cG9ydHMuVHlwZWRFdmVudEVtaXR0ZXIgPSBUeXBlZEV2ZW50RW1pdHRlcjtcbi8qKiBAcHVibGljICovXG5jbGFzcyBDYW5jZWxsYXRpb25Ub2tlbiBleHRlbmRzIFR5cGVkRXZlbnRFbWl0dGVyIHtcbn1cbmV4cG9ydHMuQ2FuY2VsbGF0aW9uVG9rZW4gPSBDYW5jZWxsYXRpb25Ub2tlbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPW1vbmdvX3R5cGVzLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/mongo_types.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/operations/add_user.js":
/*!*****************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/operations/add_user.js ***!
  \*****************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.AddUserOperation = void 0;\nconst crypto = __webpack_require__(/*! crypto */ \"crypto\");\nconst error_1 = __webpack_require__(/*! ../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\nconst command_1 = __webpack_require__(/*! ./command */ \"(api)/../server/node_modules/mongodb/lib/operations/command.js\");\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(api)/../server/node_modules/mongodb/lib/operations/operation.js\");\n/** @internal */\nclass AddUserOperation extends command_1.CommandCallbackOperation {\n    constructor(db, username, password, options) {\n        super(db, options);\n        this.db = db;\n        this.username = username;\n        this.password = password;\n        this.options = options ?? {};\n    }\n    executeCallback(server, session, callback) {\n        const db = this.db;\n        const username = this.username;\n        const password = this.password;\n        const options = this.options;\n        // Error out if digestPassword set\n        // v5 removed the digestPassword option from AddUserOptions but we still want to throw\n        // an error when digestPassword is provided.\n        if ('digestPassword' in options && options.digestPassword != null) {\n            return callback(new error_1.MongoInvalidArgumentError('Option \"digestPassword\" not supported via addUser, use db.command(...) instead'));\n        }\n        let roles;\n        if (!options.roles || (Array.isArray(options.roles) && options.roles.length === 0)) {\n            (0, utils_1.emitWarningOnce)('Creating a user without roles is deprecated. Defaults to \"root\" if db is \"admin\" or \"dbOwner\" otherwise');\n            if (db.databaseName.toLowerCase() === 'admin') {\n                roles = ['root'];\n            }\n            else {\n                roles = ['dbOwner'];\n            }\n        }\n        else {\n            roles = Array.isArray(options.roles) ? options.roles : [options.roles];\n        }\n        let topology;\n        try {\n            topology = (0, utils_1.getTopology)(db);\n        }\n        catch (error) {\n            return callback(error);\n        }\n        const digestPassword = topology.lastHello().maxWireVersion >= 7;\n        let userPassword = password;\n        if (!digestPassword) {\n            // Use node md5 generator\n            const md5 = crypto.createHash('md5');\n            // Generate keys used for authentication\n            md5.update(`${username}:mongo:${password}`);\n            userPassword = md5.digest('hex');\n        }\n        // Build the command to execute\n        const command = {\n            createUser: username,\n            customData: options.customData || {},\n            roles: roles,\n            digestPassword\n        };\n        // No password\n        if (typeof password === 'string') {\n            command.pwd = userPassword;\n        }\n        super.executeCommandCallback(server, session, command, callback);\n    }\n}\nexports.AddUserOperation = AddUserOperation;\n(0, operation_1.defineAspects)(AddUserOperation, [operation_1.Aspect.WRITE_OPERATION]);\n//# sourceMappingURL=add_user.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL2FkZF91c2VyLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELHdCQUF3QjtBQUN4QixlQUFlLG1CQUFPLENBQUMsc0JBQVE7QUFDL0IsZ0JBQWdCLG1CQUFPLENBQUMsbUVBQVU7QUFDbEMsZ0JBQWdCLG1CQUFPLENBQUMsbUVBQVU7QUFDbEMsa0JBQWtCLG1CQUFPLENBQUMsaUZBQVc7QUFDckMsb0JBQW9CLG1CQUFPLENBQUMscUZBQWE7QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEIsU0FBUyxTQUFTLFNBQVM7QUFDckQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdEQUFnRDtBQUNoRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QjtBQUN4QjtBQUNBIiwic291cmNlcyI6WyJEOlxcc2Fsb25pXFxhcHByYWlzYWwtc3lzdGVtXFxzZXJ2ZXJcXG5vZGVfbW9kdWxlc1xcbW9uZ29kYlxcbGliXFxvcGVyYXRpb25zXFxhZGRfdXNlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuQWRkVXNlck9wZXJhdGlvbiA9IHZvaWQgMDtcbmNvbnN0IGNyeXB0byA9IHJlcXVpcmUoXCJjcnlwdG9cIik7XG5jb25zdCBlcnJvcl8xID0gcmVxdWlyZShcIi4uL2Vycm9yXCIpO1xuY29uc3QgdXRpbHNfMSA9IHJlcXVpcmUoXCIuLi91dGlsc1wiKTtcbmNvbnN0IGNvbW1hbmRfMSA9IHJlcXVpcmUoXCIuL2NvbW1hbmRcIik7XG5jb25zdCBvcGVyYXRpb25fMSA9IHJlcXVpcmUoXCIuL29wZXJhdGlvblwiKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIEFkZFVzZXJPcGVyYXRpb24gZXh0ZW5kcyBjb21tYW5kXzEuQ29tbWFuZENhbGxiYWNrT3BlcmF0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcihkYiwgdXNlcm5hbWUsIHBhc3N3b3JkLCBvcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKGRiLCBvcHRpb25zKTtcbiAgICAgICAgdGhpcy5kYiA9IGRiO1xuICAgICAgICB0aGlzLnVzZXJuYW1lID0gdXNlcm5hbWU7XG4gICAgICAgIHRoaXMucGFzc3dvcmQgPSBwYXNzd29yZDtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucyA/PyB7fTtcbiAgICB9XG4gICAgZXhlY3V0ZUNhbGxiYWNrKHNlcnZlciwgc2Vzc2lvbiwgY2FsbGJhY2spIHtcbiAgICAgICAgY29uc3QgZGIgPSB0aGlzLmRiO1xuICAgICAgICBjb25zdCB1c2VybmFtZSA9IHRoaXMudXNlcm5hbWU7XG4gICAgICAgIGNvbnN0IHBhc3N3b3JkID0gdGhpcy5wYXNzd29yZDtcbiAgICAgICAgY29uc3Qgb3B0aW9ucyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgLy8gRXJyb3Igb3V0IGlmIGRpZ2VzdFBhc3N3b3JkIHNldFxuICAgICAgICAvLyB2NSByZW1vdmVkIHRoZSBkaWdlc3RQYXNzd29yZCBvcHRpb24gZnJvbSBBZGRVc2VyT3B0aW9ucyBidXQgd2Ugc3RpbGwgd2FudCB0byB0aHJvd1xuICAgICAgICAvLyBhbiBlcnJvciB3aGVuIGRpZ2VzdFBhc3N3b3JkIGlzIHByb3ZpZGVkLlxuICAgICAgICBpZiAoJ2RpZ2VzdFBhc3N3b3JkJyBpbiBvcHRpb25zICYmIG9wdGlvbnMuZGlnZXN0UGFzc3dvcmQgIT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoJ09wdGlvbiBcImRpZ2VzdFBhc3N3b3JkXCIgbm90IHN1cHBvcnRlZCB2aWEgYWRkVXNlciwgdXNlIGRiLmNvbW1hbmQoLi4uKSBpbnN0ZWFkJykpO1xuICAgICAgICB9XG4gICAgICAgIGxldCByb2xlcztcbiAgICAgICAgaWYgKCFvcHRpb25zLnJvbGVzIHx8IChBcnJheS5pc0FycmF5KG9wdGlvbnMucm9sZXMpICYmIG9wdGlvbnMucm9sZXMubGVuZ3RoID09PSAwKSkge1xuICAgICAgICAgICAgKDAsIHV0aWxzXzEuZW1pdFdhcm5pbmdPbmNlKSgnQ3JlYXRpbmcgYSB1c2VyIHdpdGhvdXQgcm9sZXMgaXMgZGVwcmVjYXRlZC4gRGVmYXVsdHMgdG8gXCJyb290XCIgaWYgZGIgaXMgXCJhZG1pblwiIG9yIFwiZGJPd25lclwiIG90aGVyd2lzZScpO1xuICAgICAgICAgICAgaWYgKGRiLmRhdGFiYXNlTmFtZS50b0xvd2VyQ2FzZSgpID09PSAnYWRtaW4nKSB7XG4gICAgICAgICAgICAgICAgcm9sZXMgPSBbJ3Jvb3QnXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJvbGVzID0gWydkYk93bmVyJ107XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByb2xlcyA9IEFycmF5LmlzQXJyYXkob3B0aW9ucy5yb2xlcykgPyBvcHRpb25zLnJvbGVzIDogW29wdGlvbnMucm9sZXNdO1xuICAgICAgICB9XG4gICAgICAgIGxldCB0b3BvbG9neTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHRvcG9sb2d5ID0gKDAsIHV0aWxzXzEuZ2V0VG9wb2xvZ3kpKGRiKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhlcnJvcik7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZGlnZXN0UGFzc3dvcmQgPSB0b3BvbG9neS5sYXN0SGVsbG8oKS5tYXhXaXJlVmVyc2lvbiA+PSA3O1xuICAgICAgICBsZXQgdXNlclBhc3N3b3JkID0gcGFzc3dvcmQ7XG4gICAgICAgIGlmICghZGlnZXN0UGFzc3dvcmQpIHtcbiAgICAgICAgICAgIC8vIFVzZSBub2RlIG1kNSBnZW5lcmF0b3JcbiAgICAgICAgICAgIGNvbnN0IG1kNSA9IGNyeXB0by5jcmVhdGVIYXNoKCdtZDUnKTtcbiAgICAgICAgICAgIC8vIEdlbmVyYXRlIGtleXMgdXNlZCBmb3IgYXV0aGVudGljYXRpb25cbiAgICAgICAgICAgIG1kNS51cGRhdGUoYCR7dXNlcm5hbWV9Om1vbmdvOiR7cGFzc3dvcmR9YCk7XG4gICAgICAgICAgICB1c2VyUGFzc3dvcmQgPSBtZDUuZGlnZXN0KCdoZXgnKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBCdWlsZCB0aGUgY29tbWFuZCB0byBleGVjdXRlXG4gICAgICAgIGNvbnN0IGNvbW1hbmQgPSB7XG4gICAgICAgICAgICBjcmVhdGVVc2VyOiB1c2VybmFtZSxcbiAgICAgICAgICAgIGN1c3RvbURhdGE6IG9wdGlvbnMuY3VzdG9tRGF0YSB8fCB7fSxcbiAgICAgICAgICAgIHJvbGVzOiByb2xlcyxcbiAgICAgICAgICAgIGRpZ2VzdFBhc3N3b3JkXG4gICAgICAgIH07XG4gICAgICAgIC8vIE5vIHBhc3N3b3JkXG4gICAgICAgIGlmICh0eXBlb2YgcGFzc3dvcmQgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICBjb21tYW5kLnB3ZCA9IHVzZXJQYXNzd29yZDtcbiAgICAgICAgfVxuICAgICAgICBzdXBlci5leGVjdXRlQ29tbWFuZENhbGxiYWNrKHNlcnZlciwgc2Vzc2lvbiwgY29tbWFuZCwgY2FsbGJhY2spO1xuICAgIH1cbn1cbmV4cG9ydHMuQWRkVXNlck9wZXJhdGlvbiA9IEFkZFVzZXJPcGVyYXRpb247XG4oMCwgb3BlcmF0aW9uXzEuZGVmaW5lQXNwZWN0cykoQWRkVXNlck9wZXJhdGlvbiwgW29wZXJhdGlvbl8xLkFzcGVjdC5XUklURV9PUEVSQVRJT05dKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFkZF91c2VyLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/operations/add_user.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/operations/aggregate.js":
/*!******************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/operations/aggregate.js ***!
  \******************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.AggregateOperation = exports.DB_AGGREGATE_COLLECTION = void 0;\nconst error_1 = __webpack_require__(/*! ../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\nconst write_concern_1 = __webpack_require__(/*! ../write_concern */ \"(api)/../server/node_modules/mongodb/lib/write_concern.js\");\nconst command_1 = __webpack_require__(/*! ./command */ \"(api)/../server/node_modules/mongodb/lib/operations/command.js\");\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(api)/../server/node_modules/mongodb/lib/operations/operation.js\");\n/** @internal */\nexports.DB_AGGREGATE_COLLECTION = 1;\nconst MIN_WIRE_VERSION_$OUT_READ_CONCERN_SUPPORT = 8;\n/** @internal */\nclass AggregateOperation extends command_1.CommandCallbackOperation {\n    constructor(ns, pipeline, options) {\n        super(undefined, { ...options, dbName: ns.db });\n        this.options = { ...options };\n        // Covers when ns.collection is null, undefined or the empty string, use DB_AGGREGATE_COLLECTION\n        this.target = ns.collection || exports.DB_AGGREGATE_COLLECTION;\n        this.pipeline = pipeline;\n        // determine if we have a write stage, override read preference if so\n        this.hasWriteStage = false;\n        if (typeof options?.out === 'string') {\n            this.pipeline = this.pipeline.concat({ $out: options.out });\n            this.hasWriteStage = true;\n        }\n        else if (pipeline.length > 0) {\n            const finalStage = pipeline[pipeline.length - 1];\n            if (finalStage.$out || finalStage.$merge) {\n                this.hasWriteStage = true;\n            }\n        }\n        if (this.hasWriteStage) {\n            this.trySecondaryWrite = true;\n        }\n        else {\n            delete this.options.writeConcern;\n        }\n        if (this.explain && this.writeConcern) {\n            throw new error_1.MongoInvalidArgumentError('Option \"explain\" cannot be used on an aggregate call with writeConcern');\n        }\n        if (options?.cursor != null && typeof options.cursor !== 'object') {\n            throw new error_1.MongoInvalidArgumentError('Cursor options must be an object');\n        }\n    }\n    get canRetryRead() {\n        return !this.hasWriteStage;\n    }\n    addToPipeline(stage) {\n        this.pipeline.push(stage);\n    }\n    executeCallback(server, session, callback) {\n        const options = this.options;\n        const serverWireVersion = (0, utils_1.maxWireVersion)(server);\n        const command = { aggregate: this.target, pipeline: this.pipeline };\n        if (this.hasWriteStage && serverWireVersion < MIN_WIRE_VERSION_$OUT_READ_CONCERN_SUPPORT) {\n            this.readConcern = undefined;\n        }\n        if (this.hasWriteStage && this.writeConcern) {\n            write_concern_1.WriteConcern.apply(command, this.writeConcern);\n        }\n        if (options.bypassDocumentValidation === true) {\n            command.bypassDocumentValidation = options.bypassDocumentValidation;\n        }\n        if (typeof options.allowDiskUse === 'boolean') {\n            command.allowDiskUse = options.allowDiskUse;\n        }\n        if (options.hint) {\n            command.hint = options.hint;\n        }\n        if (options.let) {\n            command.let = options.let;\n        }\n        // we check for undefined specifically here to allow falsy values\n        // eslint-disable-next-line no-restricted-syntax\n        if (options.comment !== undefined) {\n            command.comment = options.comment;\n        }\n        command.cursor = options.cursor || {};\n        if (options.batchSize && !this.hasWriteStage) {\n            command.cursor.batchSize = options.batchSize;\n        }\n        super.executeCommandCallback(server, session, command, callback);\n    }\n}\nexports.AggregateOperation = AggregateOperation;\n(0, operation_1.defineAspects)(AggregateOperation, [\n    operation_1.Aspect.READ_OPERATION,\n    operation_1.Aspect.RETRYABLE,\n    operation_1.Aspect.EXPLAINABLE,\n    operation_1.Aspect.CURSOR_CREATING\n]);\n//# sourceMappingURL=aggregate.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL2FnZ3JlZ2F0ZS5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCwwQkFBMEIsR0FBRywrQkFBK0I7QUFDNUQsZ0JBQWdCLG1CQUFPLENBQUMsbUVBQVU7QUFDbEMsZ0JBQWdCLG1CQUFPLENBQUMsbUVBQVU7QUFDbEMsd0JBQXdCLG1CQUFPLENBQUMsbUZBQWtCO0FBQ2xELGtCQUFrQixtQkFBTyxDQUFDLGlGQUFXO0FBQ3JDLG9CQUFvQixtQkFBTyxDQUFDLHFGQUFhO0FBQ3pDO0FBQ0EsK0JBQStCO0FBQy9CO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLDJCQUEyQjtBQUN0RCx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbURBQW1ELG1CQUFtQjtBQUN0RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEI7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJEOlxcc2Fsb25pXFxhcHByYWlzYWwtc3lzdGVtXFxzZXJ2ZXJcXG5vZGVfbW9kdWxlc1xcbW9uZ29kYlxcbGliXFxvcGVyYXRpb25zXFxhZ2dyZWdhdGUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkFnZ3JlZ2F0ZU9wZXJhdGlvbiA9IGV4cG9ydHMuREJfQUdHUkVHQVRFX0NPTExFQ1RJT04gPSB2b2lkIDA7XG5jb25zdCBlcnJvcl8xID0gcmVxdWlyZShcIi4uL2Vycm9yXCIpO1xuY29uc3QgdXRpbHNfMSA9IHJlcXVpcmUoXCIuLi91dGlsc1wiKTtcbmNvbnN0IHdyaXRlX2NvbmNlcm5fMSA9IHJlcXVpcmUoXCIuLi93cml0ZV9jb25jZXJuXCIpO1xuY29uc3QgY29tbWFuZF8xID0gcmVxdWlyZShcIi4vY29tbWFuZFwiKTtcbmNvbnN0IG9wZXJhdGlvbl8xID0gcmVxdWlyZShcIi4vb3BlcmF0aW9uXCIpO1xuLyoqIEBpbnRlcm5hbCAqL1xuZXhwb3J0cy5EQl9BR0dSRUdBVEVfQ09MTEVDVElPTiA9IDE7XG5jb25zdCBNSU5fV0lSRV9WRVJTSU9OXyRPVVRfUkVBRF9DT05DRVJOX1NVUFBPUlQgPSA4O1xuLyoqIEBpbnRlcm5hbCAqL1xuY2xhc3MgQWdncmVnYXRlT3BlcmF0aW9uIGV4dGVuZHMgY29tbWFuZF8xLkNvbW1hbmRDYWxsYmFja09wZXJhdGlvbiB7XG4gICAgY29uc3RydWN0b3IobnMsIHBpcGVsaW5lLCBvcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKHVuZGVmaW5lZCwgeyAuLi5vcHRpb25zLCBkYk5hbWU6IG5zLmRiIH0pO1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSB7IC4uLm9wdGlvbnMgfTtcbiAgICAgICAgLy8gQ292ZXJzIHdoZW4gbnMuY29sbGVjdGlvbiBpcyBudWxsLCB1bmRlZmluZWQgb3IgdGhlIGVtcHR5IHN0cmluZywgdXNlIERCX0FHR1JFR0FURV9DT0xMRUNUSU9OXG4gICAgICAgIHRoaXMudGFyZ2V0ID0gbnMuY29sbGVjdGlvbiB8fCBleHBvcnRzLkRCX0FHR1JFR0FURV9DT0xMRUNUSU9OO1xuICAgICAgICB0aGlzLnBpcGVsaW5lID0gcGlwZWxpbmU7XG4gICAgICAgIC8vIGRldGVybWluZSBpZiB3ZSBoYXZlIGEgd3JpdGUgc3RhZ2UsIG92ZXJyaWRlIHJlYWQgcHJlZmVyZW5jZSBpZiBzb1xuICAgICAgICB0aGlzLmhhc1dyaXRlU3RhZ2UgPSBmYWxzZTtcbiAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zPy5vdXQgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICB0aGlzLnBpcGVsaW5lID0gdGhpcy5waXBlbGluZS5jb25jYXQoeyAkb3V0OiBvcHRpb25zLm91dCB9KTtcbiAgICAgICAgICAgIHRoaXMuaGFzV3JpdGVTdGFnZSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAocGlwZWxpbmUubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgY29uc3QgZmluYWxTdGFnZSA9IHBpcGVsaW5lW3BpcGVsaW5lLmxlbmd0aCAtIDFdO1xuICAgICAgICAgICAgaWYgKGZpbmFsU3RhZ2UuJG91dCB8fCBmaW5hbFN0YWdlLiRtZXJnZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuaGFzV3JpdGVTdGFnZSA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuaGFzV3JpdGVTdGFnZSkge1xuICAgICAgICAgICAgdGhpcy50cnlTZWNvbmRhcnlXcml0ZSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBkZWxldGUgdGhpcy5vcHRpb25zLndyaXRlQ29uY2VybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5leHBsYWluICYmIHRoaXMud3JpdGVDb25jZXJuKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdPcHRpb24gXCJleHBsYWluXCIgY2Fubm90IGJlIHVzZWQgb24gYW4gYWdncmVnYXRlIGNhbGwgd2l0aCB3cml0ZUNvbmNlcm4nKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAob3B0aW9ucz8uY3Vyc29yICE9IG51bGwgJiYgdHlwZW9mIG9wdGlvbnMuY3Vyc29yICE9PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignQ3Vyc29yIG9wdGlvbnMgbXVzdCBiZSBhbiBvYmplY3QnKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgY2FuUmV0cnlSZWFkKCkge1xuICAgICAgICByZXR1cm4gIXRoaXMuaGFzV3JpdGVTdGFnZTtcbiAgICB9XG4gICAgYWRkVG9QaXBlbGluZShzdGFnZSkge1xuICAgICAgICB0aGlzLnBpcGVsaW5lLnB1c2goc3RhZ2UpO1xuICAgIH1cbiAgICBleGVjdXRlQ2FsbGJhY2soc2VydmVyLCBzZXNzaW9uLCBjYWxsYmFjaykge1xuICAgICAgICBjb25zdCBvcHRpb25zID0gdGhpcy5vcHRpb25zO1xuICAgICAgICBjb25zdCBzZXJ2ZXJXaXJlVmVyc2lvbiA9ICgwLCB1dGlsc18xLm1heFdpcmVWZXJzaW9uKShzZXJ2ZXIpO1xuICAgICAgICBjb25zdCBjb21tYW5kID0geyBhZ2dyZWdhdGU6IHRoaXMudGFyZ2V0LCBwaXBlbGluZTogdGhpcy5waXBlbGluZSB9O1xuICAgICAgICBpZiAodGhpcy5oYXNXcml0ZVN0YWdlICYmIHNlcnZlcldpcmVWZXJzaW9uIDwgTUlOX1dJUkVfVkVSU0lPTl8kT1VUX1JFQURfQ09OQ0VSTl9TVVBQT1JUKSB7XG4gICAgICAgICAgICB0aGlzLnJlYWRDb25jZXJuID0gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmhhc1dyaXRlU3RhZ2UgJiYgdGhpcy53cml0ZUNvbmNlcm4pIHtcbiAgICAgICAgICAgIHdyaXRlX2NvbmNlcm5fMS5Xcml0ZUNvbmNlcm4uYXBwbHkoY29tbWFuZCwgdGhpcy53cml0ZUNvbmNlcm4pO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvcHRpb25zLmJ5cGFzc0RvY3VtZW50VmFsaWRhdGlvbiA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgY29tbWFuZC5ieXBhc3NEb2N1bWVudFZhbGlkYXRpb24gPSBvcHRpb25zLmJ5cGFzc0RvY3VtZW50VmFsaWRhdGlvbjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZW9mIG9wdGlvbnMuYWxsb3dEaXNrVXNlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgIGNvbW1hbmQuYWxsb3dEaXNrVXNlID0gb3B0aW9ucy5hbGxvd0Rpc2tVc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9wdGlvbnMuaGludCkge1xuICAgICAgICAgICAgY29tbWFuZC5oaW50ID0gb3B0aW9ucy5oaW50O1xuICAgICAgICB9XG4gICAgICAgIGlmIChvcHRpb25zLmxldCkge1xuICAgICAgICAgICAgY29tbWFuZC5sZXQgPSBvcHRpb25zLmxldDtcbiAgICAgICAgfVxuICAgICAgICAvLyB3ZSBjaGVjayBmb3IgdW5kZWZpbmVkIHNwZWNpZmljYWxseSBoZXJlIHRvIGFsbG93IGZhbHN5IHZhbHVlc1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcmVzdHJpY3RlZC1zeW50YXhcbiAgICAgICAgaWYgKG9wdGlvbnMuY29tbWVudCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBjb21tYW5kLmNvbW1lbnQgPSBvcHRpb25zLmNvbW1lbnQ7XG4gICAgICAgIH1cbiAgICAgICAgY29tbWFuZC5jdXJzb3IgPSBvcHRpb25zLmN1cnNvciB8fCB7fTtcbiAgICAgICAgaWYgKG9wdGlvbnMuYmF0Y2hTaXplICYmICF0aGlzLmhhc1dyaXRlU3RhZ2UpIHtcbiAgICAgICAgICAgIGNvbW1hbmQuY3Vyc29yLmJhdGNoU2l6ZSA9IG9wdGlvbnMuYmF0Y2hTaXplO1xuICAgICAgICB9XG4gICAgICAgIHN1cGVyLmV4ZWN1dGVDb21tYW5kQ2FsbGJhY2soc2VydmVyLCBzZXNzaW9uLCBjb21tYW5kLCBjYWxsYmFjayk7XG4gICAgfVxufVxuZXhwb3J0cy5BZ2dyZWdhdGVPcGVyYXRpb24gPSBBZ2dyZWdhdGVPcGVyYXRpb247XG4oMCwgb3BlcmF0aW9uXzEuZGVmaW5lQXNwZWN0cykoQWdncmVnYXRlT3BlcmF0aW9uLCBbXG4gICAgb3BlcmF0aW9uXzEuQXNwZWN0LlJFQURfT1BFUkFUSU9OLFxuICAgIG9wZXJhdGlvbl8xLkFzcGVjdC5SRVRSWUFCTEUsXG4gICAgb3BlcmF0aW9uXzEuQXNwZWN0LkVYUExBSU5BQkxFLFxuICAgIG9wZXJhdGlvbl8xLkFzcGVjdC5DVVJTT1JfQ1JFQVRJTkdcbl0pO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YWdncmVnYXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/operations/aggregate.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/operations/bulk_write.js":
/*!*******************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/operations/bulk_write.js ***!
  \*******************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.BulkWriteOperation = void 0;\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(api)/../server/node_modules/mongodb/lib/operations/operation.js\");\n/** @internal */\nclass BulkWriteOperation extends operation_1.AbstractCallbackOperation {\n    constructor(collection, operations, options) {\n        super(options);\n        this.options = options;\n        this.collection = collection;\n        this.operations = operations;\n    }\n    executeCallback(server, session, callback) {\n        const coll = this.collection;\n        const operations = this.operations;\n        const options = { ...this.options, ...this.bsonOptions, readPreference: this.readPreference };\n        // Create the bulk operation\n        const bulk = options.ordered === false\n            ? coll.initializeUnorderedBulkOp(options)\n            : coll.initializeOrderedBulkOp(options);\n        // for each op go through and add to the bulk\n        try {\n            for (let i = 0; i < operations.length; i++) {\n                bulk.raw(operations[i]);\n            }\n        }\n        catch (err) {\n            return callback(err);\n        }\n        // Execute the bulk\n        bulk.execute({ ...options, session }).then(result => callback(undefined, result), error => callback(error));\n    }\n}\nexports.BulkWriteOperation = BulkWriteOperation;\n(0, operation_1.defineAspects)(BulkWriteOperation, [operation_1.Aspect.WRITE_OPERATION]);\n//# sourceMappingURL=bulk_write.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL2J1bGtfd3JpdGUuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsMEJBQTBCO0FBQzFCLG9CQUFvQixtQkFBTyxDQUFDLHFGQUFhO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEI7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLHVCQUF1QjtBQUNuRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixxQkFBcUI7QUFDNUM7QUFDQTtBQUNBLDBCQUEwQjtBQUMxQjtBQUNBIiwic291cmNlcyI6WyJEOlxcc2Fsb25pXFxhcHByYWlzYWwtc3lzdGVtXFxzZXJ2ZXJcXG5vZGVfbW9kdWxlc1xcbW9uZ29kYlxcbGliXFxvcGVyYXRpb25zXFxidWxrX3dyaXRlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5CdWxrV3JpdGVPcGVyYXRpb24gPSB2b2lkIDA7XG5jb25zdCBvcGVyYXRpb25fMSA9IHJlcXVpcmUoXCIuL29wZXJhdGlvblwiKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIEJ1bGtXcml0ZU9wZXJhdGlvbiBleHRlbmRzIG9wZXJhdGlvbl8xLkFic3RyYWN0Q2FsbGJhY2tPcGVyYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKGNvbGxlY3Rpb24sIG9wZXJhdGlvbnMsIG9wdGlvbnMpIHtcbiAgICAgICAgc3VwZXIob3B0aW9ucyk7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XG4gICAgICAgIHRoaXMuY29sbGVjdGlvbiA9IGNvbGxlY3Rpb247XG4gICAgICAgIHRoaXMub3BlcmF0aW9ucyA9IG9wZXJhdGlvbnM7XG4gICAgfVxuICAgIGV4ZWN1dGVDYWxsYmFjayhzZXJ2ZXIsIHNlc3Npb24sIGNhbGxiYWNrKSB7XG4gICAgICAgIGNvbnN0IGNvbGwgPSB0aGlzLmNvbGxlY3Rpb247XG4gICAgICAgIGNvbnN0IG9wZXJhdGlvbnMgPSB0aGlzLm9wZXJhdGlvbnM7XG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7IC4uLnRoaXMub3B0aW9ucywgLi4udGhpcy5ic29uT3B0aW9ucywgcmVhZFByZWZlcmVuY2U6IHRoaXMucmVhZFByZWZlcmVuY2UgfTtcbiAgICAgICAgLy8gQ3JlYXRlIHRoZSBidWxrIG9wZXJhdGlvblxuICAgICAgICBjb25zdCBidWxrID0gb3B0aW9ucy5vcmRlcmVkID09PSBmYWxzZVxuICAgICAgICAgICAgPyBjb2xsLmluaXRpYWxpemVVbm9yZGVyZWRCdWxrT3Aob3B0aW9ucylcbiAgICAgICAgICAgIDogY29sbC5pbml0aWFsaXplT3JkZXJlZEJ1bGtPcChvcHRpb25zKTtcbiAgICAgICAgLy8gZm9yIGVhY2ggb3AgZ28gdGhyb3VnaCBhbmQgYWRkIHRvIHRoZSBidWxrXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG9wZXJhdGlvbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBidWxrLnJhdyhvcGVyYXRpb25zW2ldKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBFeGVjdXRlIHRoZSBidWxrXG4gICAgICAgIGJ1bGsuZXhlY3V0ZSh7IC4uLm9wdGlvbnMsIHNlc3Npb24gfSkudGhlbihyZXN1bHQgPT4gY2FsbGJhY2sodW5kZWZpbmVkLCByZXN1bHQpLCBlcnJvciA9PiBjYWxsYmFjayhlcnJvcikpO1xuICAgIH1cbn1cbmV4cG9ydHMuQnVsa1dyaXRlT3BlcmF0aW9uID0gQnVsa1dyaXRlT3BlcmF0aW9uO1xuKDAsIG9wZXJhdGlvbl8xLmRlZmluZUFzcGVjdHMpKEJ1bGtXcml0ZU9wZXJhdGlvbiwgW29wZXJhdGlvbl8xLkFzcGVjdC5XUklURV9PUEVSQVRJT05dKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWJ1bGtfd3JpdGUuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/operations/bulk_write.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/operations/collections.js":
/*!********************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/operations/collections.js ***!
  \********************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.CollectionsOperation = void 0;\nconst collection_1 = __webpack_require__(/*! ../collection */ \"(api)/../server/node_modules/mongodb/lib/collection.js\");\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(api)/../server/node_modules/mongodb/lib/operations/operation.js\");\n/** @internal */\nclass CollectionsOperation extends operation_1.AbstractCallbackOperation {\n    constructor(db, options) {\n        super(options);\n        this.options = options;\n        this.db = db;\n    }\n    executeCallback(server, session, callback) {\n        // Let's get the collection names\n        this.db\n            .listCollections({}, { ...this.options, nameOnly: true, readPreference: this.readPreference, session })\n            .toArray()\n            .then(documents => {\n            const collections = [];\n            for (const { name } of documents) {\n                if (!name.includes('$')) {\n                    // Filter collections removing any illegal ones\n                    collections.push(new collection_1.Collection(this.db, name, this.db.s.options));\n                }\n            }\n            // Return the collection objects\n            callback(undefined, collections);\n        }, error => callback(error));\n    }\n}\nexports.CollectionsOperation = CollectionsOperation;\n//# sourceMappingURL=collections.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL2NvbGxlY3Rpb25zLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELDRCQUE0QjtBQUM1QixxQkFBcUIsbUJBQU8sQ0FBQyw2RUFBZTtBQUM1QyxvQkFBb0IsbUJBQU8sQ0FBQyxxRkFBYTtBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQixJQUFJLCtFQUErRTtBQUNsSDtBQUNBO0FBQ0E7QUFDQSx5QkFBeUIsT0FBTztBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsNEJBQTRCO0FBQzVCIiwic291cmNlcyI6WyJEOlxcc2Fsb25pXFxhcHByYWlzYWwtc3lzdGVtXFxzZXJ2ZXJcXG5vZGVfbW9kdWxlc1xcbW9uZ29kYlxcbGliXFxvcGVyYXRpb25zXFxjb2xsZWN0aW9ucy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuQ29sbGVjdGlvbnNPcGVyYXRpb24gPSB2b2lkIDA7XG5jb25zdCBjb2xsZWN0aW9uXzEgPSByZXF1aXJlKFwiLi4vY29sbGVjdGlvblwiKTtcbmNvbnN0IG9wZXJhdGlvbl8xID0gcmVxdWlyZShcIi4vb3BlcmF0aW9uXCIpO1xuLyoqIEBpbnRlcm5hbCAqL1xuY2xhc3MgQ29sbGVjdGlvbnNPcGVyYXRpb24gZXh0ZW5kcyBvcGVyYXRpb25fMS5BYnN0cmFjdENhbGxiYWNrT3BlcmF0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcihkYiwgb3B0aW9ucykge1xuICAgICAgICBzdXBlcihvcHRpb25zKTtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcbiAgICAgICAgdGhpcy5kYiA9IGRiO1xuICAgIH1cbiAgICBleGVjdXRlQ2FsbGJhY2soc2VydmVyLCBzZXNzaW9uLCBjYWxsYmFjaykge1xuICAgICAgICAvLyBMZXQncyBnZXQgdGhlIGNvbGxlY3Rpb24gbmFtZXNcbiAgICAgICAgdGhpcy5kYlxuICAgICAgICAgICAgLmxpc3RDb2xsZWN0aW9ucyh7fSwgeyAuLi50aGlzLm9wdGlvbnMsIG5hbWVPbmx5OiB0cnVlLCByZWFkUHJlZmVyZW5jZTogdGhpcy5yZWFkUHJlZmVyZW5jZSwgc2Vzc2lvbiB9KVxuICAgICAgICAgICAgLnRvQXJyYXkoKVxuICAgICAgICAgICAgLnRoZW4oZG9jdW1lbnRzID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNvbGxlY3Rpb25zID0gW107XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHsgbmFtZSB9IG9mIGRvY3VtZW50cykge1xuICAgICAgICAgICAgICAgIGlmICghbmFtZS5pbmNsdWRlcygnJCcpKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEZpbHRlciBjb2xsZWN0aW9ucyByZW1vdmluZyBhbnkgaWxsZWdhbCBvbmVzXG4gICAgICAgICAgICAgICAgICAgIGNvbGxlY3Rpb25zLnB1c2gobmV3IGNvbGxlY3Rpb25fMS5Db2xsZWN0aW9uKHRoaXMuZGIsIG5hbWUsIHRoaXMuZGIucy5vcHRpb25zKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gUmV0dXJuIHRoZSBjb2xsZWN0aW9uIG9iamVjdHNcbiAgICAgICAgICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwgY29sbGVjdGlvbnMpO1xuICAgICAgICB9LCBlcnJvciA9PiBjYWxsYmFjayhlcnJvcikpO1xuICAgIH1cbn1cbmV4cG9ydHMuQ29sbGVjdGlvbnNPcGVyYXRpb24gPSBDb2xsZWN0aW9uc09wZXJhdGlvbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWNvbGxlY3Rpb25zLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/operations/collections.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/operations/command.js":
/*!****************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/operations/command.js ***!
  \****************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.CommandCallbackOperation = exports.CommandOperation = void 0;\nconst error_1 = __webpack_require__(/*! ../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst explain_1 = __webpack_require__(/*! ../explain */ \"(api)/../server/node_modules/mongodb/lib/explain.js\");\nconst read_concern_1 = __webpack_require__(/*! ../read_concern */ \"(api)/../server/node_modules/mongodb/lib/read_concern.js\");\nconst server_selection_1 = __webpack_require__(/*! ../sdam/server_selection */ \"(api)/../server/node_modules/mongodb/lib/sdam/server_selection.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\nconst write_concern_1 = __webpack_require__(/*! ../write_concern */ \"(api)/../server/node_modules/mongodb/lib/write_concern.js\");\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(api)/../server/node_modules/mongodb/lib/operations/operation.js\");\n/** @internal */\nclass CommandOperation extends operation_1.AbstractCallbackOperation {\n    constructor(parent, options) {\n        super(options);\n        this.options = options ?? {};\n        // NOTE: this was explicitly added for the add/remove user operations, it's likely\n        //       something we'd want to reconsider. Perhaps those commands can use `Admin`\n        //       as a parent?\n        const dbNameOverride = options?.dbName || options?.authdb;\n        if (dbNameOverride) {\n            this.ns = new utils_1.MongoDBNamespace(dbNameOverride, '$cmd');\n        }\n        else {\n            this.ns = parent\n                ? parent.s.namespace.withCollection('$cmd')\n                : new utils_1.MongoDBNamespace('admin', '$cmd');\n        }\n        this.readConcern = read_concern_1.ReadConcern.fromOptions(options);\n        this.writeConcern = write_concern_1.WriteConcern.fromOptions(options);\n        if (this.hasAspect(operation_1.Aspect.EXPLAINABLE)) {\n            this.explain = explain_1.Explain.fromOptions(options);\n        }\n        else if (options?.explain != null) {\n            throw new error_1.MongoInvalidArgumentError(`Option \"explain\" is not supported on this command`);\n        }\n    }\n    get canRetryWrite() {\n        if (this.hasAspect(operation_1.Aspect.EXPLAINABLE)) {\n            return this.explain == null;\n        }\n        return true;\n    }\n    async executeCommand(server, session, cmd) {\n        // TODO: consider making this a non-enumerable property\n        this.server = server;\n        const options = {\n            ...this.options,\n            ...this.bsonOptions,\n            readPreference: this.readPreference,\n            session\n        };\n        const serverWireVersion = (0, utils_1.maxWireVersion)(server);\n        const inTransaction = this.session && this.session.inTransaction();\n        if (this.readConcern && (0, utils_1.commandSupportsReadConcern)(cmd) && !inTransaction) {\n            Object.assign(cmd, { readConcern: this.readConcern });\n        }\n        if (this.trySecondaryWrite && serverWireVersion < server_selection_1.MIN_SECONDARY_WRITE_WIRE_VERSION) {\n            options.omitReadPreference = true;\n        }\n        if (this.writeConcern && this.hasAspect(operation_1.Aspect.WRITE_OPERATION) && !inTransaction) {\n            write_concern_1.WriteConcern.apply(cmd, this.writeConcern);\n        }\n        if (options.collation &&\n            typeof options.collation === 'object' &&\n            !this.hasAspect(operation_1.Aspect.SKIP_COLLATION)) {\n            Object.assign(cmd, { collation: options.collation });\n        }\n        if (typeof options.maxTimeMS === 'number') {\n            cmd.maxTimeMS = options.maxTimeMS;\n        }\n        if (this.hasAspect(operation_1.Aspect.EXPLAINABLE) && this.explain) {\n            cmd = (0, utils_1.decorateWithExplain)(cmd, this.explain);\n        }\n        return server.commandAsync(this.ns, cmd, options);\n    }\n}\nexports.CommandOperation = CommandOperation;\n/** @internal */\nclass CommandCallbackOperation extends CommandOperation {\n    constructor(parent, options) {\n        super(parent, options);\n    }\n    executeCommandCallback(server, session, cmd, callback) {\n        super.executeCommand(server, session, cmd).then(res => callback(undefined, res), err => callback(err, undefined));\n    }\n}\nexports.CommandCallbackOperation = CommandCallbackOperation;\n//# sourceMappingURL=command.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL2NvbW1hbmQuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsZ0NBQWdDLEdBQUcsd0JBQXdCO0FBQzNELGdCQUFnQixtQkFBTyxDQUFDLG1FQUFVO0FBQ2xDLGtCQUFrQixtQkFBTyxDQUFDLHVFQUFZO0FBQ3RDLHVCQUF1QixtQkFBTyxDQUFDLGlGQUFpQjtBQUNoRCwyQkFBMkIsbUJBQU8sQ0FBQyxtR0FBMEI7QUFDN0QsZ0JBQWdCLG1CQUFPLENBQUMsbUVBQVU7QUFDbEMsd0JBQXdCLG1CQUFPLENBQUMsbUZBQWtCO0FBQ2xELG9CQUFvQixtQkFBTyxDQUFDLHFGQUFhO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQ0FBaUMsK0JBQStCO0FBQ2hFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDLDhCQUE4QjtBQUMvRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QjtBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0M7QUFDaEMiLCJzb3VyY2VzIjpbIkQ6XFxzYWxvbmlcXGFwcHJhaXNhbC1zeXN0ZW1cXHNlcnZlclxcbm9kZV9tb2R1bGVzXFxtb25nb2RiXFxsaWJcXG9wZXJhdGlvbnNcXGNvbW1hbmQuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkNvbW1hbmRDYWxsYmFja09wZXJhdGlvbiA9IGV4cG9ydHMuQ29tbWFuZE9wZXJhdGlvbiA9IHZvaWQgMDtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi4vZXJyb3JcIik7XG5jb25zdCBleHBsYWluXzEgPSByZXF1aXJlKFwiLi4vZXhwbGFpblwiKTtcbmNvbnN0IHJlYWRfY29uY2Vybl8xID0gcmVxdWlyZShcIi4uL3JlYWRfY29uY2VyblwiKTtcbmNvbnN0IHNlcnZlcl9zZWxlY3Rpb25fMSA9IHJlcXVpcmUoXCIuLi9zZGFtL3NlcnZlcl9zZWxlY3Rpb25cIik7XG5jb25zdCB1dGlsc18xID0gcmVxdWlyZShcIi4uL3V0aWxzXCIpO1xuY29uc3Qgd3JpdGVfY29uY2Vybl8xID0gcmVxdWlyZShcIi4uL3dyaXRlX2NvbmNlcm5cIik7XG5jb25zdCBvcGVyYXRpb25fMSA9IHJlcXVpcmUoXCIuL29wZXJhdGlvblwiKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIENvbW1hbmRPcGVyYXRpb24gZXh0ZW5kcyBvcGVyYXRpb25fMS5BYnN0cmFjdENhbGxiYWNrT3BlcmF0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcihwYXJlbnQsIG9wdGlvbnMpIHtcbiAgICAgICAgc3VwZXIob3B0aW9ucyk7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnMgPz8ge307XG4gICAgICAgIC8vIE5PVEU6IHRoaXMgd2FzIGV4cGxpY2l0bHkgYWRkZWQgZm9yIHRoZSBhZGQvcmVtb3ZlIHVzZXIgb3BlcmF0aW9ucywgaXQncyBsaWtlbHlcbiAgICAgICAgLy8gICAgICAgc29tZXRoaW5nIHdlJ2Qgd2FudCB0byByZWNvbnNpZGVyLiBQZXJoYXBzIHRob3NlIGNvbW1hbmRzIGNhbiB1c2UgYEFkbWluYFxuICAgICAgICAvLyAgICAgICBhcyBhIHBhcmVudD9cbiAgICAgICAgY29uc3QgZGJOYW1lT3ZlcnJpZGUgPSBvcHRpb25zPy5kYk5hbWUgfHwgb3B0aW9ucz8uYXV0aGRiO1xuICAgICAgICBpZiAoZGJOYW1lT3ZlcnJpZGUpIHtcbiAgICAgICAgICAgIHRoaXMubnMgPSBuZXcgdXRpbHNfMS5Nb25nb0RCTmFtZXNwYWNlKGRiTmFtZU92ZXJyaWRlLCAnJGNtZCcpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5ucyA9IHBhcmVudFxuICAgICAgICAgICAgICAgID8gcGFyZW50LnMubmFtZXNwYWNlLndpdGhDb2xsZWN0aW9uKCckY21kJylcbiAgICAgICAgICAgICAgICA6IG5ldyB1dGlsc18xLk1vbmdvREJOYW1lc3BhY2UoJ2FkbWluJywgJyRjbWQnKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnJlYWRDb25jZXJuID0gcmVhZF9jb25jZXJuXzEuUmVhZENvbmNlcm4uZnJvbU9wdGlvbnMob3B0aW9ucyk7XG4gICAgICAgIHRoaXMud3JpdGVDb25jZXJuID0gd3JpdGVfY29uY2Vybl8xLldyaXRlQ29uY2Vybi5mcm9tT3B0aW9ucyhvcHRpb25zKTtcbiAgICAgICAgaWYgKHRoaXMuaGFzQXNwZWN0KG9wZXJhdGlvbl8xLkFzcGVjdC5FWFBMQUlOQUJMRSkpIHtcbiAgICAgICAgICAgIHRoaXMuZXhwbGFpbiA9IGV4cGxhaW5fMS5FeHBsYWluLmZyb21PcHRpb25zKG9wdGlvbnMpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKG9wdGlvbnM/LmV4cGxhaW4gIT0gbnVsbCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcihgT3B0aW9uIFwiZXhwbGFpblwiIGlzIG5vdCBzdXBwb3J0ZWQgb24gdGhpcyBjb21tYW5kYCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IGNhblJldHJ5V3JpdGUoKSB7XG4gICAgICAgIGlmICh0aGlzLmhhc0FzcGVjdChvcGVyYXRpb25fMS5Bc3BlY3QuRVhQTEFJTkFCTEUpKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5leHBsYWluID09IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGFzeW5jIGV4ZWN1dGVDb21tYW5kKHNlcnZlciwgc2Vzc2lvbiwgY21kKSB7XG4gICAgICAgIC8vIFRPRE86IGNvbnNpZGVyIG1ha2luZyB0aGlzIGEgbm9uLWVudW1lcmFibGUgcHJvcGVydHlcbiAgICAgICAgdGhpcy5zZXJ2ZXIgPSBzZXJ2ZXI7XG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICAgICAgICAuLi50aGlzLm9wdGlvbnMsXG4gICAgICAgICAgICAuLi50aGlzLmJzb25PcHRpb25zLFxuICAgICAgICAgICAgcmVhZFByZWZlcmVuY2U6IHRoaXMucmVhZFByZWZlcmVuY2UsXG4gICAgICAgICAgICBzZXNzaW9uXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IHNlcnZlcldpcmVWZXJzaW9uID0gKDAsIHV0aWxzXzEubWF4V2lyZVZlcnNpb24pKHNlcnZlcik7XG4gICAgICAgIGNvbnN0IGluVHJhbnNhY3Rpb24gPSB0aGlzLnNlc3Npb24gJiYgdGhpcy5zZXNzaW9uLmluVHJhbnNhY3Rpb24oKTtcbiAgICAgICAgaWYgKHRoaXMucmVhZENvbmNlcm4gJiYgKDAsIHV0aWxzXzEuY29tbWFuZFN1cHBvcnRzUmVhZENvbmNlcm4pKGNtZCkgJiYgIWluVHJhbnNhY3Rpb24pIHtcbiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oY21kLCB7IHJlYWRDb25jZXJuOiB0aGlzLnJlYWRDb25jZXJuIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnRyeVNlY29uZGFyeVdyaXRlICYmIHNlcnZlcldpcmVWZXJzaW9uIDwgc2VydmVyX3NlbGVjdGlvbl8xLk1JTl9TRUNPTkRBUllfV1JJVEVfV0lSRV9WRVJTSU9OKSB7XG4gICAgICAgICAgICBvcHRpb25zLm9taXRSZWFkUHJlZmVyZW5jZSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMud3JpdGVDb25jZXJuICYmIHRoaXMuaGFzQXNwZWN0KG9wZXJhdGlvbl8xLkFzcGVjdC5XUklURV9PUEVSQVRJT04pICYmICFpblRyYW5zYWN0aW9uKSB7XG4gICAgICAgICAgICB3cml0ZV9jb25jZXJuXzEuV3JpdGVDb25jZXJuLmFwcGx5KGNtZCwgdGhpcy53cml0ZUNvbmNlcm4pO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvcHRpb25zLmNvbGxhdGlvbiAmJlxuICAgICAgICAgICAgdHlwZW9mIG9wdGlvbnMuY29sbGF0aW9uID09PSAnb2JqZWN0JyAmJlxuICAgICAgICAgICAgIXRoaXMuaGFzQXNwZWN0KG9wZXJhdGlvbl8xLkFzcGVjdC5TS0lQX0NPTExBVElPTikpIHtcbiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oY21kLCB7IGNvbGxhdGlvbjogb3B0aW9ucy5jb2xsYXRpb24gfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLm1heFRpbWVNUyA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgIGNtZC5tYXhUaW1lTVMgPSBvcHRpb25zLm1heFRpbWVNUztcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5oYXNBc3BlY3Qob3BlcmF0aW9uXzEuQXNwZWN0LkVYUExBSU5BQkxFKSAmJiB0aGlzLmV4cGxhaW4pIHtcbiAgICAgICAgICAgIGNtZCA9ICgwLCB1dGlsc18xLmRlY29yYXRlV2l0aEV4cGxhaW4pKGNtZCwgdGhpcy5leHBsYWluKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc2VydmVyLmNvbW1hbmRBc3luYyh0aGlzLm5zLCBjbWQsIG9wdGlvbnMpO1xuICAgIH1cbn1cbmV4cG9ydHMuQ29tbWFuZE9wZXJhdGlvbiA9IENvbW1hbmRPcGVyYXRpb247XG4vKiogQGludGVybmFsICovXG5jbGFzcyBDb21tYW5kQ2FsbGJhY2tPcGVyYXRpb24gZXh0ZW5kcyBDb21tYW5kT3BlcmF0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcihwYXJlbnQsIG9wdGlvbnMpIHtcbiAgICAgICAgc3VwZXIocGFyZW50LCBvcHRpb25zKTtcbiAgICB9XG4gICAgZXhlY3V0ZUNvbW1hbmRDYWxsYmFjayhzZXJ2ZXIsIHNlc3Npb24sIGNtZCwgY2FsbGJhY2spIHtcbiAgICAgICAgc3VwZXIuZXhlY3V0ZUNvbW1hbmQoc2VydmVyLCBzZXNzaW9uLCBjbWQpLnRoZW4ocmVzID0+IGNhbGxiYWNrKHVuZGVmaW5lZCwgcmVzKSwgZXJyID0+IGNhbGxiYWNrKGVyciwgdW5kZWZpbmVkKSk7XG4gICAgfVxufVxuZXhwb3J0cy5Db21tYW5kQ2FsbGJhY2tPcGVyYXRpb24gPSBDb21tYW5kQ2FsbGJhY2tPcGVyYXRpb247XG4vLyMgc291cmNlTWFwcGluZ1VSTD1jb21tYW5kLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/operations/command.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/operations/common_functions.js":
/*!*************************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/operations/common_functions.js ***!
  \*************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.prepareDocs = exports.indexInformation = void 0;\nconst error_1 = __webpack_require__(/*! ../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\nfunction indexInformation(db, name, _optionsOrCallback, _callback) {\n    let options = _optionsOrCallback;\n    let callback = _callback;\n    if ('function' === typeof _optionsOrCallback) {\n        callback = _optionsOrCallback;\n        options = {};\n    }\n    // If we specified full information\n    const full = options.full == null ? false : options.full;\n    let topology;\n    try {\n        topology = (0, utils_1.getTopology)(db);\n    }\n    catch (error) {\n        return callback(error);\n    }\n    // Did the user destroy the topology\n    if (topology.isDestroyed())\n        return callback(new error_1.MongoTopologyClosedError());\n    // Process all the results from the index command and collection\n    function processResults(indexes) {\n        // Contains all the information\n        const info = {};\n        // Process all the indexes\n        for (let i = 0; i < indexes.length; i++) {\n            const index = indexes[i];\n            // Let's unpack the object\n            info[index.name] = [];\n            for (const name in index.key) {\n                info[index.name].push([name, index.key[name]]);\n            }\n        }\n        return info;\n    }\n    // Get the list of indexes of the specified collection\n    db.collection(name)\n        .listIndexes(options)\n        .toArray()\n        .then(indexes => {\n        if (!Array.isArray(indexes))\n            return callback(undefined, []);\n        if (full)\n            return callback(undefined, indexes);\n        callback(undefined, processResults(indexes));\n    }, error => callback(error));\n}\nexports.indexInformation = indexInformation;\nfunction prepareDocs(coll, docs, options) {\n    const forceServerObjectId = typeof options.forceServerObjectId === 'boolean'\n        ? options.forceServerObjectId\n        : coll.s.db.options?.forceServerObjectId;\n    // no need to modify the docs if server sets the ObjectId\n    if (forceServerObjectId === true) {\n        return docs;\n    }\n    return docs.map(doc => {\n        if (doc._id == null) {\n            doc._id = coll.s.pkFactory.createPk();\n        }\n        return doc;\n    });\n}\nexports.prepareDocs = prepareDocs;\n//# sourceMappingURL=common_functions.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL2NvbW1vbl9mdW5jdGlvbnMuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsbUJBQW1CLEdBQUcsd0JBQXdCO0FBQzlDLGdCQUFnQixtQkFBTyxDQUFDLG1FQUFVO0FBQ2xDLGdCQUFnQixtQkFBTyxDQUFDLG1FQUFVO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixvQkFBb0I7QUFDNUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSx3QkFBd0I7QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxtQkFBbUI7QUFDbkIiLCJzb3VyY2VzIjpbIkQ6XFxzYWxvbmlcXGFwcHJhaXNhbC1zeXN0ZW1cXHNlcnZlclxcbm9kZV9tb2R1bGVzXFxtb25nb2RiXFxsaWJcXG9wZXJhdGlvbnNcXGNvbW1vbl9mdW5jdGlvbnMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnByZXBhcmVEb2NzID0gZXhwb3J0cy5pbmRleEluZm9ybWF0aW9uID0gdm9pZCAwO1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuLi9lcnJvclwiKTtcbmNvbnN0IHV0aWxzXzEgPSByZXF1aXJlKFwiLi4vdXRpbHNcIik7XG5mdW5jdGlvbiBpbmRleEluZm9ybWF0aW9uKGRiLCBuYW1lLCBfb3B0aW9uc09yQ2FsbGJhY2ssIF9jYWxsYmFjaykge1xuICAgIGxldCBvcHRpb25zID0gX29wdGlvbnNPckNhbGxiYWNrO1xuICAgIGxldCBjYWxsYmFjayA9IF9jYWxsYmFjaztcbiAgICBpZiAoJ2Z1bmN0aW9uJyA9PT0gdHlwZW9mIF9vcHRpb25zT3JDYWxsYmFjaykge1xuICAgICAgICBjYWxsYmFjayA9IF9vcHRpb25zT3JDYWxsYmFjaztcbiAgICAgICAgb3B0aW9ucyA9IHt9O1xuICAgIH1cbiAgICAvLyBJZiB3ZSBzcGVjaWZpZWQgZnVsbCBpbmZvcm1hdGlvblxuICAgIGNvbnN0IGZ1bGwgPSBvcHRpb25zLmZ1bGwgPT0gbnVsbCA/IGZhbHNlIDogb3B0aW9ucy5mdWxsO1xuICAgIGxldCB0b3BvbG9neTtcbiAgICB0cnkge1xuICAgICAgICB0b3BvbG9neSA9ICgwLCB1dGlsc18xLmdldFRvcG9sb2d5KShkYik7XG4gICAgfVxuICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICByZXR1cm4gY2FsbGJhY2soZXJyb3IpO1xuICAgIH1cbiAgICAvLyBEaWQgdGhlIHVzZXIgZGVzdHJveSB0aGUgdG9wb2xvZ3lcbiAgICBpZiAodG9wb2xvZ3kuaXNEZXN0cm95ZWQoKSlcbiAgICAgICAgcmV0dXJuIGNhbGxiYWNrKG5ldyBlcnJvcl8xLk1vbmdvVG9wb2xvZ3lDbG9zZWRFcnJvcigpKTtcbiAgICAvLyBQcm9jZXNzIGFsbCB0aGUgcmVzdWx0cyBmcm9tIHRoZSBpbmRleCBjb21tYW5kIGFuZCBjb2xsZWN0aW9uXG4gICAgZnVuY3Rpb24gcHJvY2Vzc1Jlc3VsdHMoaW5kZXhlcykge1xuICAgICAgICAvLyBDb250YWlucyBhbGwgdGhlIGluZm9ybWF0aW9uXG4gICAgICAgIGNvbnN0IGluZm8gPSB7fTtcbiAgICAgICAgLy8gUHJvY2VzcyBhbGwgdGhlIGluZGV4ZXNcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpbmRleGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCBpbmRleCA9IGluZGV4ZXNbaV07XG4gICAgICAgICAgICAvLyBMZXQncyB1bnBhY2sgdGhlIG9iamVjdFxuICAgICAgICAgICAgaW5mb1tpbmRleC5uYW1lXSA9IFtdO1xuICAgICAgICAgICAgZm9yIChjb25zdCBuYW1lIGluIGluZGV4LmtleSkge1xuICAgICAgICAgICAgICAgIGluZm9baW5kZXgubmFtZV0ucHVzaChbbmFtZSwgaW5kZXgua2V5W25hbWVdXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGluZm87XG4gICAgfVxuICAgIC8vIEdldCB0aGUgbGlzdCBvZiBpbmRleGVzIG9mIHRoZSBzcGVjaWZpZWQgY29sbGVjdGlvblxuICAgIGRiLmNvbGxlY3Rpb24obmFtZSlcbiAgICAgICAgLmxpc3RJbmRleGVzKG9wdGlvbnMpXG4gICAgICAgIC50b0FycmF5KClcbiAgICAgICAgLnRoZW4oaW5kZXhlcyA9PiB7XG4gICAgICAgIGlmICghQXJyYXkuaXNBcnJheShpbmRleGVzKSlcbiAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayh1bmRlZmluZWQsIFtdKTtcbiAgICAgICAgaWYgKGZ1bGwpXG4gICAgICAgICAgICByZXR1cm4gY2FsbGJhY2sodW5kZWZpbmVkLCBpbmRleGVzKTtcbiAgICAgICAgY2FsbGJhY2sodW5kZWZpbmVkLCBwcm9jZXNzUmVzdWx0cyhpbmRleGVzKSk7XG4gICAgfSwgZXJyb3IgPT4gY2FsbGJhY2soZXJyb3IpKTtcbn1cbmV4cG9ydHMuaW5kZXhJbmZvcm1hdGlvbiA9IGluZGV4SW5mb3JtYXRpb247XG5mdW5jdGlvbiBwcmVwYXJlRG9jcyhjb2xsLCBkb2NzLCBvcHRpb25zKSB7XG4gICAgY29uc3QgZm9yY2VTZXJ2ZXJPYmplY3RJZCA9IHR5cGVvZiBvcHRpb25zLmZvcmNlU2VydmVyT2JqZWN0SWQgPT09ICdib29sZWFuJ1xuICAgICAgICA/IG9wdGlvbnMuZm9yY2VTZXJ2ZXJPYmplY3RJZFxuICAgICAgICA6IGNvbGwucy5kYi5vcHRpb25zPy5mb3JjZVNlcnZlck9iamVjdElkO1xuICAgIC8vIG5vIG5lZWQgdG8gbW9kaWZ5IHRoZSBkb2NzIGlmIHNlcnZlciBzZXRzIHRoZSBPYmplY3RJZFxuICAgIGlmIChmb3JjZVNlcnZlck9iamVjdElkID09PSB0cnVlKSB7XG4gICAgICAgIHJldHVybiBkb2NzO1xuICAgIH1cbiAgICByZXR1cm4gZG9jcy5tYXAoZG9jID0+IHtcbiAgICAgICAgaWYgKGRvYy5faWQgPT0gbnVsbCkge1xuICAgICAgICAgICAgZG9jLl9pZCA9IGNvbGwucy5wa0ZhY3RvcnkuY3JlYXRlUGsoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZG9jO1xuICAgIH0pO1xufVxuZXhwb3J0cy5wcmVwYXJlRG9jcyA9IHByZXBhcmVEb2NzO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y29tbW9uX2Z1bmN0aW9ucy5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/operations/common_functions.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/operations/count.js":
/*!**************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/operations/count.js ***!
  \**************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.CountOperation = void 0;\nconst command_1 = __webpack_require__(/*! ./command */ \"(api)/../server/node_modules/mongodb/lib/operations/command.js\");\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(api)/../server/node_modules/mongodb/lib/operations/operation.js\");\n/** @internal */\nclass CountOperation extends command_1.CommandCallbackOperation {\n    constructor(namespace, filter, options) {\n        super({ s: { namespace: namespace } }, options);\n        this.options = options;\n        this.collectionName = namespace.collection;\n        this.query = filter;\n    }\n    executeCallback(server, session, callback) {\n        const options = this.options;\n        const cmd = {\n            count: this.collectionName,\n            query: this.query\n        };\n        if (typeof options.limit === 'number') {\n            cmd.limit = options.limit;\n        }\n        if (typeof options.skip === 'number') {\n            cmd.skip = options.skip;\n        }\n        if (options.hint != null) {\n            cmd.hint = options.hint;\n        }\n        if (typeof options.maxTimeMS === 'number') {\n            cmd.maxTimeMS = options.maxTimeMS;\n        }\n        super.executeCommandCallback(server, session, cmd, (err, result) => {\n            callback(err, result ? result.n : 0);\n        });\n    }\n}\nexports.CountOperation = CountOperation;\n(0, operation_1.defineAspects)(CountOperation, [operation_1.Aspect.READ_OPERATION, operation_1.Aspect.RETRYABLE]);\n//# sourceMappingURL=count.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL2NvdW50LmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELHNCQUFzQjtBQUN0QixrQkFBa0IsbUJBQU8sQ0FBQyxpRkFBVztBQUNyQyxvQkFBb0IsbUJBQU8sQ0FBQyxxRkFBYTtBQUN6QztBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsS0FBSyx3QkFBd0I7QUFDN0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxzQkFBc0I7QUFDdEI7QUFDQSIsInNvdXJjZXMiOlsiRDpcXHNhbG9uaVxcYXBwcmFpc2FsLXN5c3RlbVxcc2VydmVyXFxub2RlX21vZHVsZXNcXG1vbmdvZGJcXGxpYlxcb3BlcmF0aW9uc1xcY291bnQuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkNvdW50T3BlcmF0aW9uID0gdm9pZCAwO1xuY29uc3QgY29tbWFuZF8xID0gcmVxdWlyZShcIi4vY29tbWFuZFwiKTtcbmNvbnN0IG9wZXJhdGlvbl8xID0gcmVxdWlyZShcIi4vb3BlcmF0aW9uXCIpO1xuLyoqIEBpbnRlcm5hbCAqL1xuY2xhc3MgQ291bnRPcGVyYXRpb24gZXh0ZW5kcyBjb21tYW5kXzEuQ29tbWFuZENhbGxiYWNrT3BlcmF0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcihuYW1lc3BhY2UsIGZpbHRlciwgb3B0aW9ucykge1xuICAgICAgICBzdXBlcih7IHM6IHsgbmFtZXNwYWNlOiBuYW1lc3BhY2UgfSB9LCBvcHRpb25zKTtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcbiAgICAgICAgdGhpcy5jb2xsZWN0aW9uTmFtZSA9IG5hbWVzcGFjZS5jb2xsZWN0aW9uO1xuICAgICAgICB0aGlzLnF1ZXJ5ID0gZmlsdGVyO1xuICAgIH1cbiAgICBleGVjdXRlQ2FsbGJhY2soc2VydmVyLCBzZXNzaW9uLCBjYWxsYmFjaykge1xuICAgICAgICBjb25zdCBvcHRpb25zID0gdGhpcy5vcHRpb25zO1xuICAgICAgICBjb25zdCBjbWQgPSB7XG4gICAgICAgICAgICBjb3VudDogdGhpcy5jb2xsZWN0aW9uTmFtZSxcbiAgICAgICAgICAgIHF1ZXJ5OiB0aGlzLnF1ZXJ5XG4gICAgICAgIH07XG4gICAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5saW1pdCA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgIGNtZC5saW1pdCA9IG9wdGlvbnMubGltaXQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLnNraXAgPT09ICdudW1iZXInKSB7XG4gICAgICAgICAgICBjbWQuc2tpcCA9IG9wdGlvbnMuc2tpcDtcbiAgICAgICAgfVxuICAgICAgICBpZiAob3B0aW9ucy5oaW50ICE9IG51bGwpIHtcbiAgICAgICAgICAgIGNtZC5oaW50ID0gb3B0aW9ucy5oaW50O1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5tYXhUaW1lTVMgPT09ICdudW1iZXInKSB7XG4gICAgICAgICAgICBjbWQubWF4VGltZU1TID0gb3B0aW9ucy5tYXhUaW1lTVM7XG4gICAgICAgIH1cbiAgICAgICAgc3VwZXIuZXhlY3V0ZUNvbW1hbmRDYWxsYmFjayhzZXJ2ZXIsIHNlc3Npb24sIGNtZCwgKGVyciwgcmVzdWx0KSA9PiB7XG4gICAgICAgICAgICBjYWxsYmFjayhlcnIsIHJlc3VsdCA/IHJlc3VsdC5uIDogMCk7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmV4cG9ydHMuQ291bnRPcGVyYXRpb24gPSBDb3VudE9wZXJhdGlvbjtcbigwLCBvcGVyYXRpb25fMS5kZWZpbmVBc3BlY3RzKShDb3VudE9wZXJhdGlvbiwgW29wZXJhdGlvbl8xLkFzcGVjdC5SRUFEX09QRVJBVElPTiwgb3BlcmF0aW9uXzEuQXNwZWN0LlJFVFJZQUJMRV0pO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y291bnQuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/operations/count.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/operations/count_documents.js":
/*!************************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/operations/count_documents.js ***!
  \************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.CountDocumentsOperation = void 0;\nconst aggregate_1 = __webpack_require__(/*! ./aggregate */ \"(api)/../server/node_modules/mongodb/lib/operations/aggregate.js\");\n/** @internal */\nclass CountDocumentsOperation extends aggregate_1.AggregateOperation {\n    constructor(collection, query, options) {\n        const pipeline = [];\n        pipeline.push({ $match: query });\n        if (typeof options.skip === 'number') {\n            pipeline.push({ $skip: options.skip });\n        }\n        if (typeof options.limit === 'number') {\n            pipeline.push({ $limit: options.limit });\n        }\n        pipeline.push({ $group: { _id: 1, n: { $sum: 1 } } });\n        super(collection.s.namespace, pipeline, options);\n    }\n    executeCallback(server, session, callback) {\n        super.executeCallback(server, session, (err, result) => {\n            if (err || !result) {\n                callback(err);\n                return;\n            }\n            // NOTE: We're avoiding creating a cursor here to reduce the callstack.\n            const response = result;\n            if (response.cursor == null || response.cursor.firstBatch == null) {\n                callback(undefined, 0);\n                return;\n            }\n            const docs = response.cursor.firstBatch;\n            callback(undefined, docs.length ? docs[0].n : 0);\n        });\n    }\n}\nexports.CountDocumentsOperation = CountDocumentsOperation;\n//# sourceMappingURL=count_documents.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL2NvdW50X2RvY3VtZW50cy5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCwrQkFBK0I7QUFDL0Isb0JBQW9CLG1CQUFPLENBQUMscUZBQWE7QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsZUFBZTtBQUN2QztBQUNBLDRCQUE0QixxQkFBcUI7QUFDakQ7QUFDQTtBQUNBLDRCQUE0Qix1QkFBdUI7QUFDbkQ7QUFDQSx3QkFBd0IsVUFBVSxhQUFhLGFBQWE7QUFDNUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLCtCQUErQjtBQUMvQiIsInNvdXJjZXMiOlsiRDpcXHNhbG9uaVxcYXBwcmFpc2FsLXN5c3RlbVxcc2VydmVyXFxub2RlX21vZHVsZXNcXG1vbmdvZGJcXGxpYlxcb3BlcmF0aW9uc1xcY291bnRfZG9jdW1lbnRzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5Db3VudERvY3VtZW50c09wZXJhdGlvbiA9IHZvaWQgMDtcbmNvbnN0IGFnZ3JlZ2F0ZV8xID0gcmVxdWlyZShcIi4vYWdncmVnYXRlXCIpO1xuLyoqIEBpbnRlcm5hbCAqL1xuY2xhc3MgQ291bnREb2N1bWVudHNPcGVyYXRpb24gZXh0ZW5kcyBhZ2dyZWdhdGVfMS5BZ2dyZWdhdGVPcGVyYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKGNvbGxlY3Rpb24sIHF1ZXJ5LCBvcHRpb25zKSB7XG4gICAgICAgIGNvbnN0IHBpcGVsaW5lID0gW107XG4gICAgICAgIHBpcGVsaW5lLnB1c2goeyAkbWF0Y2g6IHF1ZXJ5IH0pO1xuICAgICAgICBpZiAodHlwZW9mIG9wdGlvbnMuc2tpcCA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgIHBpcGVsaW5lLnB1c2goeyAkc2tpcDogb3B0aW9ucy5za2lwIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5saW1pdCA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgIHBpcGVsaW5lLnB1c2goeyAkbGltaXQ6IG9wdGlvbnMubGltaXQgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcGlwZWxpbmUucHVzaCh7ICRncm91cDogeyBfaWQ6IDEsIG46IHsgJHN1bTogMSB9IH0gfSk7XG4gICAgICAgIHN1cGVyKGNvbGxlY3Rpb24ucy5uYW1lc3BhY2UsIHBpcGVsaW5lLCBvcHRpb25zKTtcbiAgICB9XG4gICAgZXhlY3V0ZUNhbGxiYWNrKHNlcnZlciwgc2Vzc2lvbiwgY2FsbGJhY2spIHtcbiAgICAgICAgc3VwZXIuZXhlY3V0ZUNhbGxiYWNrKHNlcnZlciwgc2Vzc2lvbiwgKGVyciwgcmVzdWx0KSA9PiB7XG4gICAgICAgICAgICBpZiAoZXJyIHx8ICFyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnIpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIE5PVEU6IFdlJ3JlIGF2b2lkaW5nIGNyZWF0aW5nIGEgY3Vyc29yIGhlcmUgdG8gcmVkdWNlIHRoZSBjYWxsc3RhY2suXG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IHJlc3VsdDtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5jdXJzb3IgPT0gbnVsbCB8fCByZXNwb25zZS5jdXJzb3IuZmlyc3RCYXRjaCA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2sodW5kZWZpbmVkLCAwKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBkb2NzID0gcmVzcG9uc2UuY3Vyc29yLmZpcnN0QmF0Y2g7XG4gICAgICAgICAgICBjYWxsYmFjayh1bmRlZmluZWQsIGRvY3MubGVuZ3RoID8gZG9jc1swXS5uIDogMCk7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmV4cG9ydHMuQ291bnREb2N1bWVudHNPcGVyYXRpb24gPSBDb3VudERvY3VtZW50c09wZXJhdGlvbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWNvdW50X2RvY3VtZW50cy5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/operations/count_documents.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/operations/create_collection.js":
/*!**************************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/operations/create_collection.js ***!
  \**************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.CreateCollectionOperation = void 0;\nconst constants_1 = __webpack_require__(/*! ../cmap/wire_protocol/constants */ \"(api)/../server/node_modules/mongodb/lib/cmap/wire_protocol/constants.js\");\nconst collection_1 = __webpack_require__(/*! ../collection */ \"(api)/../server/node_modules/mongodb/lib/collection.js\");\nconst error_1 = __webpack_require__(/*! ../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst command_1 = __webpack_require__(/*! ./command */ \"(api)/../server/node_modules/mongodb/lib/operations/command.js\");\nconst indexes_1 = __webpack_require__(/*! ./indexes */ \"(api)/../server/node_modules/mongodb/lib/operations/indexes.js\");\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(api)/../server/node_modules/mongodb/lib/operations/operation.js\");\nconst ILLEGAL_COMMAND_FIELDS = new Set([\n    'w',\n    'wtimeout',\n    'j',\n    'fsync',\n    'autoIndexId',\n    'pkFactory',\n    'raw',\n    'readPreference',\n    'session',\n    'readConcern',\n    'writeConcern',\n    'raw',\n    'fieldsAsRaw',\n    'useBigInt64',\n    'promoteLongs',\n    'promoteValues',\n    'promoteBuffers',\n    'bsonRegExp',\n    'serializeFunctions',\n    'ignoreUndefined',\n    'enableUtf8Validation'\n]);\n/* @internal */\nconst INVALID_QE_VERSION = 'Driver support of Queryable Encryption is incompatible with server. Upgrade server to use Queryable Encryption.';\n/** @internal */\nclass CreateCollectionOperation extends command_1.CommandCallbackOperation {\n    constructor(db, name, options = {}) {\n        super(db, options);\n        this.options = options;\n        this.db = db;\n        this.name = name;\n    }\n    executeCallback(server, session, callback) {\n        (async () => {\n            const db = this.db;\n            const name = this.name;\n            const options = this.options;\n            const encryptedFields = options.encryptedFields ??\n                db.client.options.autoEncryption?.encryptedFieldsMap?.[`${db.databaseName}.${name}`];\n            if (encryptedFields) {\n                // Creating a QE collection required min server of 7.0.0\n                // TODO(NODE-5353): Get wire version information from connection.\n                if (!server.loadBalanced &&\n                    server.description.maxWireVersion < constants_1.MIN_SUPPORTED_QE_WIRE_VERSION) {\n                    throw new error_1.MongoCompatibilityError(`${INVALID_QE_VERSION} The minimum server version required is ${constants_1.MIN_SUPPORTED_QE_SERVER_VERSION}`);\n                }\n                // Create auxilliary collections for queryable encryption support.\n                const escCollection = encryptedFields.escCollection ?? `enxcol_.${name}.esc`;\n                const ecocCollection = encryptedFields.ecocCollection ?? `enxcol_.${name}.ecoc`;\n                for (const collectionName of [escCollection, ecocCollection]) {\n                    const createOp = new CreateCollectionOperation(db, collectionName, {\n                        clusteredIndex: {\n                            key: { _id: 1 },\n                            unique: true\n                        }\n                    });\n                    await createOp.executeWithoutEncryptedFieldsCheck(server, session);\n                }\n                if (!options.encryptedFields) {\n                    this.options = { ...this.options, encryptedFields };\n                }\n            }\n            const coll = await this.executeWithoutEncryptedFieldsCheck(server, session);\n            if (encryptedFields) {\n                // Create the required index for queryable encryption support.\n                const createIndexOp = new indexes_1.CreateIndexOperation(db, name, { __safeContent__: 1 }, {});\n                await createIndexOp.execute(server, session);\n            }\n            return coll;\n        })().then(coll => callback(undefined, coll), err => callback(err));\n    }\n    executeWithoutEncryptedFieldsCheck(server, session) {\n        return new Promise((resolve, reject) => {\n            const db = this.db;\n            const name = this.name;\n            const options = this.options;\n            const done = err => {\n                if (err) {\n                    return reject(err);\n                }\n                resolve(new collection_1.Collection(db, name, options));\n            };\n            const cmd = { create: name };\n            for (const n in options) {\n                if (options[n] != null &&\n                    typeof options[n] !== 'function' &&\n                    !ILLEGAL_COMMAND_FIELDS.has(n)) {\n                    cmd[n] = options[n];\n                }\n            }\n            // otherwise just execute the command\n            super.executeCommandCallback(server, session, cmd, done);\n        });\n    }\n}\nexports.CreateCollectionOperation = CreateCollectionOperation;\n(0, operation_1.defineAspects)(CreateCollectionOperation, [operation_1.Aspect.WRITE_OPERATION]);\n//# sourceMappingURL=create_collection.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL2NyZWF0ZV9jb2xsZWN0aW9uLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELGlDQUFpQztBQUNqQyxvQkFBb0IsbUJBQU8sQ0FBQyxpSEFBaUM7QUFDN0QscUJBQXFCLG1CQUFPLENBQUMsNkVBQWU7QUFDNUMsZ0JBQWdCLG1CQUFPLENBQUMsbUVBQVU7QUFDbEMsa0JBQWtCLG1CQUFPLENBQUMsaUZBQVc7QUFDckMsa0JBQWtCLG1CQUFPLENBQUMsaUZBQVc7QUFDckMsb0JBQW9CLG1CQUFPLENBQUMscUZBQWE7QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0NBQXNDO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwRUFBMEUsZ0JBQWdCLEdBQUcsS0FBSztBQUNsRztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUVBQWlFLG9CQUFvQix5Q0FBeUMsNENBQTRDO0FBQzFLO0FBQ0E7QUFDQSxrRkFBa0YsS0FBSztBQUN2RixvRkFBb0YsS0FBSztBQUN6RjtBQUNBO0FBQ0E7QUFDQSxtQ0FBbUMsUUFBUTtBQUMzQztBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBLHFDQUFxQztBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUZBQXFGLG9CQUFvQixJQUFJO0FBQzdHO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEI7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxpQ0FBaUM7QUFDakM7QUFDQSIsInNvdXJjZXMiOlsiRDpcXHNhbG9uaVxcYXBwcmFpc2FsLXN5c3RlbVxcc2VydmVyXFxub2RlX21vZHVsZXNcXG1vbmdvZGJcXGxpYlxcb3BlcmF0aW9uc1xcY3JlYXRlX2NvbGxlY3Rpb24uanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkNyZWF0ZUNvbGxlY3Rpb25PcGVyYXRpb24gPSB2b2lkIDA7XG5jb25zdCBjb25zdGFudHNfMSA9IHJlcXVpcmUoXCIuLi9jbWFwL3dpcmVfcHJvdG9jb2wvY29uc3RhbnRzXCIpO1xuY29uc3QgY29sbGVjdGlvbl8xID0gcmVxdWlyZShcIi4uL2NvbGxlY3Rpb25cIik7XG5jb25zdCBlcnJvcl8xID0gcmVxdWlyZShcIi4uL2Vycm9yXCIpO1xuY29uc3QgY29tbWFuZF8xID0gcmVxdWlyZShcIi4vY29tbWFuZFwiKTtcbmNvbnN0IGluZGV4ZXNfMSA9IHJlcXVpcmUoXCIuL2luZGV4ZXNcIik7XG5jb25zdCBvcGVyYXRpb25fMSA9IHJlcXVpcmUoXCIuL29wZXJhdGlvblwiKTtcbmNvbnN0IElMTEVHQUxfQ09NTUFORF9GSUVMRFMgPSBuZXcgU2V0KFtcbiAgICAndycsXG4gICAgJ3d0aW1lb3V0JyxcbiAgICAnaicsXG4gICAgJ2ZzeW5jJyxcbiAgICAnYXV0b0luZGV4SWQnLFxuICAgICdwa0ZhY3RvcnknLFxuICAgICdyYXcnLFxuICAgICdyZWFkUHJlZmVyZW5jZScsXG4gICAgJ3Nlc3Npb24nLFxuICAgICdyZWFkQ29uY2VybicsXG4gICAgJ3dyaXRlQ29uY2VybicsXG4gICAgJ3JhdycsXG4gICAgJ2ZpZWxkc0FzUmF3JyxcbiAgICAndXNlQmlnSW50NjQnLFxuICAgICdwcm9tb3RlTG9uZ3MnLFxuICAgICdwcm9tb3RlVmFsdWVzJyxcbiAgICAncHJvbW90ZUJ1ZmZlcnMnLFxuICAgICdic29uUmVnRXhwJyxcbiAgICAnc2VyaWFsaXplRnVuY3Rpb25zJyxcbiAgICAnaWdub3JlVW5kZWZpbmVkJyxcbiAgICAnZW5hYmxlVXRmOFZhbGlkYXRpb24nXG5dKTtcbi8qIEBpbnRlcm5hbCAqL1xuY29uc3QgSU5WQUxJRF9RRV9WRVJTSU9OID0gJ0RyaXZlciBzdXBwb3J0IG9mIFF1ZXJ5YWJsZSBFbmNyeXB0aW9uIGlzIGluY29tcGF0aWJsZSB3aXRoIHNlcnZlci4gVXBncmFkZSBzZXJ2ZXIgdG8gdXNlIFF1ZXJ5YWJsZSBFbmNyeXB0aW9uLic7XG4vKiogQGludGVybmFsICovXG5jbGFzcyBDcmVhdGVDb2xsZWN0aW9uT3BlcmF0aW9uIGV4dGVuZHMgY29tbWFuZF8xLkNvbW1hbmRDYWxsYmFja09wZXJhdGlvbiB7XG4gICAgY29uc3RydWN0b3IoZGIsIG5hbWUsIG9wdGlvbnMgPSB7fSkge1xuICAgICAgICBzdXBlcihkYiwgb3B0aW9ucyk7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XG4gICAgICAgIHRoaXMuZGIgPSBkYjtcbiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICB9XG4gICAgZXhlY3V0ZUNhbGxiYWNrKHNlcnZlciwgc2Vzc2lvbiwgY2FsbGJhY2spIHtcbiAgICAgICAgKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGRiID0gdGhpcy5kYjtcbiAgICAgICAgICAgIGNvbnN0IG5hbWUgPSB0aGlzLm5hbWU7XG4gICAgICAgICAgICBjb25zdCBvcHRpb25zID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgY29uc3QgZW5jcnlwdGVkRmllbGRzID0gb3B0aW9ucy5lbmNyeXB0ZWRGaWVsZHMgPz9cbiAgICAgICAgICAgICAgICBkYi5jbGllbnQub3B0aW9ucy5hdXRvRW5jcnlwdGlvbj8uZW5jcnlwdGVkRmllbGRzTWFwPy5bYCR7ZGIuZGF0YWJhc2VOYW1lfS4ke25hbWV9YF07XG4gICAgICAgICAgICBpZiAoZW5jcnlwdGVkRmllbGRzKSB7XG4gICAgICAgICAgICAgICAgLy8gQ3JlYXRpbmcgYSBRRSBjb2xsZWN0aW9uIHJlcXVpcmVkIG1pbiBzZXJ2ZXIgb2YgNy4wLjBcbiAgICAgICAgICAgICAgICAvLyBUT0RPKE5PREUtNTM1Myk6IEdldCB3aXJlIHZlcnNpb24gaW5mb3JtYXRpb24gZnJvbSBjb25uZWN0aW9uLlxuICAgICAgICAgICAgICAgIGlmICghc2VydmVyLmxvYWRCYWxhbmNlZCAmJlxuICAgICAgICAgICAgICAgICAgICBzZXJ2ZXIuZGVzY3JpcHRpb24ubWF4V2lyZVZlcnNpb24gPCBjb25zdGFudHNfMS5NSU5fU1VQUE9SVEVEX1FFX1dJUkVfVkVSU0lPTikge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0NvbXBhdGliaWxpdHlFcnJvcihgJHtJTlZBTElEX1FFX1ZFUlNJT059IFRoZSBtaW5pbXVtIHNlcnZlciB2ZXJzaW9uIHJlcXVpcmVkIGlzICR7Y29uc3RhbnRzXzEuTUlOX1NVUFBPUlRFRF9RRV9TRVJWRVJfVkVSU0lPTn1gKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gQ3JlYXRlIGF1eGlsbGlhcnkgY29sbGVjdGlvbnMgZm9yIHF1ZXJ5YWJsZSBlbmNyeXB0aW9uIHN1cHBvcnQuXG4gICAgICAgICAgICAgICAgY29uc3QgZXNjQ29sbGVjdGlvbiA9IGVuY3J5cHRlZEZpZWxkcy5lc2NDb2xsZWN0aW9uID8/IGBlbnhjb2xfLiR7bmFtZX0uZXNjYDtcbiAgICAgICAgICAgICAgICBjb25zdCBlY29jQ29sbGVjdGlvbiA9IGVuY3J5cHRlZEZpZWxkcy5lY29jQ29sbGVjdGlvbiA/PyBgZW54Y29sXy4ke25hbWV9LmVjb2NgO1xuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgY29sbGVjdGlvbk5hbWUgb2YgW2VzY0NvbGxlY3Rpb24sIGVjb2NDb2xsZWN0aW9uXSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjcmVhdGVPcCA9IG5ldyBDcmVhdGVDb2xsZWN0aW9uT3BlcmF0aW9uKGRiLCBjb2xsZWN0aW9uTmFtZSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2x1c3RlcmVkSW5kZXg6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXk6IHsgX2lkOiAxIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5pcXVlOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCBjcmVhdGVPcC5leGVjdXRlV2l0aG91dEVuY3J5cHRlZEZpZWxkc0NoZWNrKHNlcnZlciwgc2Vzc2lvbik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICghb3B0aW9ucy5lbmNyeXB0ZWRGaWVsZHMpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zID0geyAuLi50aGlzLm9wdGlvbnMsIGVuY3J5cHRlZEZpZWxkcyB9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGNvbGwgPSBhd2FpdCB0aGlzLmV4ZWN1dGVXaXRob3V0RW5jcnlwdGVkRmllbGRzQ2hlY2soc2VydmVyLCBzZXNzaW9uKTtcbiAgICAgICAgICAgIGlmIChlbmNyeXB0ZWRGaWVsZHMpIHtcbiAgICAgICAgICAgICAgICAvLyBDcmVhdGUgdGhlIHJlcXVpcmVkIGluZGV4IGZvciBxdWVyeWFibGUgZW5jcnlwdGlvbiBzdXBwb3J0LlxuICAgICAgICAgICAgICAgIGNvbnN0IGNyZWF0ZUluZGV4T3AgPSBuZXcgaW5kZXhlc18xLkNyZWF0ZUluZGV4T3BlcmF0aW9uKGRiLCBuYW1lLCB7IF9fc2FmZUNvbnRlbnRfXzogMSB9LCB7fSk7XG4gICAgICAgICAgICAgICAgYXdhaXQgY3JlYXRlSW5kZXhPcC5leGVjdXRlKHNlcnZlciwgc2Vzc2lvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gY29sbDtcbiAgICAgICAgfSkoKS50aGVuKGNvbGwgPT4gY2FsbGJhY2sodW5kZWZpbmVkLCBjb2xsKSwgZXJyID0+IGNhbGxiYWNrKGVycikpO1xuICAgIH1cbiAgICBleGVjdXRlV2l0aG91dEVuY3J5cHRlZEZpZWxkc0NoZWNrKHNlcnZlciwgc2Vzc2lvbikge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZGIgPSB0aGlzLmRiO1xuICAgICAgICAgICAgY29uc3QgbmFtZSA9IHRoaXMubmFtZTtcbiAgICAgICAgICAgIGNvbnN0IG9wdGlvbnMgPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICBjb25zdCBkb25lID0gZXJyID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmVzb2x2ZShuZXcgY29sbGVjdGlvbl8xLkNvbGxlY3Rpb24oZGIsIG5hbWUsIG9wdGlvbnMpKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBjb25zdCBjbWQgPSB7IGNyZWF0ZTogbmFtZSB9O1xuICAgICAgICAgICAgZm9yIChjb25zdCBuIGluIG9wdGlvbnMpIHtcbiAgICAgICAgICAgICAgICBpZiAob3B0aW9uc1tuXSAhPSBudWxsICYmXG4gICAgICAgICAgICAgICAgICAgIHR5cGVvZiBvcHRpb25zW25dICE9PSAnZnVuY3Rpb24nICYmXG4gICAgICAgICAgICAgICAgICAgICFJTExFR0FMX0NPTU1BTkRfRklFTERTLmhhcyhuKSkge1xuICAgICAgICAgICAgICAgICAgICBjbWRbbl0gPSBvcHRpb25zW25dO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIG90aGVyd2lzZSBqdXN0IGV4ZWN1dGUgdGhlIGNvbW1hbmRcbiAgICAgICAgICAgIHN1cGVyLmV4ZWN1dGVDb21tYW5kQ2FsbGJhY2soc2VydmVyLCBzZXNzaW9uLCBjbWQsIGRvbmUpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5leHBvcnRzLkNyZWF0ZUNvbGxlY3Rpb25PcGVyYXRpb24gPSBDcmVhdGVDb2xsZWN0aW9uT3BlcmF0aW9uO1xuKDAsIG9wZXJhdGlvbl8xLmRlZmluZUFzcGVjdHMpKENyZWF0ZUNvbGxlY3Rpb25PcGVyYXRpb24sIFtvcGVyYXRpb25fMS5Bc3BlY3QuV1JJVEVfT1BFUkFUSU9OXSk7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1jcmVhdGVfY29sbGVjdGlvbi5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/operations/create_collection.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/operations/delete.js":
/*!***************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/operations/delete.js ***!
  \***************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.makeDeleteStatement = exports.DeleteManyOperation = exports.DeleteOneOperation = exports.DeleteOperation = void 0;\nconst error_1 = __webpack_require__(/*! ../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst command_1 = __webpack_require__(/*! ./command */ \"(api)/../server/node_modules/mongodb/lib/operations/command.js\");\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(api)/../server/node_modules/mongodb/lib/operations/operation.js\");\n/** @internal */\nclass DeleteOperation extends command_1.CommandCallbackOperation {\n    constructor(ns, statements, options) {\n        super(undefined, options);\n        this.options = options;\n        this.ns = ns;\n        this.statements = statements;\n    }\n    get canRetryWrite() {\n        if (super.canRetryWrite === false) {\n            return false;\n        }\n        return this.statements.every(op => (op.limit != null ? op.limit > 0 : true));\n    }\n    executeCallback(server, session, callback) {\n        const options = this.options ?? {};\n        const ordered = typeof options.ordered === 'boolean' ? options.ordered : true;\n        const command = {\n            delete: this.ns.collection,\n            deletes: this.statements,\n            ordered\n        };\n        if (options.let) {\n            command.let = options.let;\n        }\n        // we check for undefined specifically here to allow falsy values\n        // eslint-disable-next-line no-restricted-syntax\n        if (options.comment !== undefined) {\n            command.comment = options.comment;\n        }\n        const unacknowledgedWrite = this.writeConcern && this.writeConcern.w === 0;\n        if (unacknowledgedWrite) {\n            if (this.statements.find((o) => o.hint)) {\n                // TODO(NODE-3541): fix error for hint with unacknowledged writes\n                callback(new error_1.MongoCompatibilityError(`hint is not supported with unacknowledged writes`));\n                return;\n            }\n        }\n        super.executeCommandCallback(server, session, command, callback);\n    }\n}\nexports.DeleteOperation = DeleteOperation;\nclass DeleteOneOperation extends DeleteOperation {\n    constructor(collection, filter, options) {\n        super(collection.s.namespace, [makeDeleteStatement(filter, { ...options, limit: 1 })], options);\n    }\n    executeCallback(server, session, callback) {\n        super.executeCallback(server, session, (err, res) => {\n            if (err || res == null)\n                return callback(err);\n            if (res.code)\n                return callback(new error_1.MongoServerError(res));\n            if (res.writeErrors)\n                return callback(new error_1.MongoServerError(res.writeErrors[0]));\n            if (this.explain)\n                return callback(undefined, res);\n            callback(undefined, {\n                acknowledged: this.writeConcern?.w !== 0 ?? true,\n                deletedCount: res.n\n            });\n        });\n    }\n}\nexports.DeleteOneOperation = DeleteOneOperation;\nclass DeleteManyOperation extends DeleteOperation {\n    constructor(collection, filter, options) {\n        super(collection.s.namespace, [makeDeleteStatement(filter, options)], options);\n    }\n    executeCallback(server, session, callback) {\n        super.executeCallback(server, session, (err, res) => {\n            if (err || res == null)\n                return callback(err);\n            if (res.code)\n                return callback(new error_1.MongoServerError(res));\n            if (res.writeErrors)\n                return callback(new error_1.MongoServerError(res.writeErrors[0]));\n            if (this.explain)\n                return callback(undefined, res);\n            callback(undefined, {\n                acknowledged: this.writeConcern?.w !== 0 ?? true,\n                deletedCount: res.n\n            });\n        });\n    }\n}\nexports.DeleteManyOperation = DeleteManyOperation;\nfunction makeDeleteStatement(filter, options) {\n    const op = {\n        q: filter,\n        limit: typeof options.limit === 'number' ? options.limit : 0\n    };\n    if (options.collation) {\n        op.collation = options.collation;\n    }\n    if (options.hint) {\n        op.hint = options.hint;\n    }\n    return op;\n}\nexports.makeDeleteStatement = makeDeleteStatement;\n(0, operation_1.defineAspects)(DeleteOperation, [operation_1.Aspect.RETRYABLE, operation_1.Aspect.WRITE_OPERATION]);\n(0, operation_1.defineAspects)(DeleteOneOperation, [\n    operation_1.Aspect.RETRYABLE,\n    operation_1.Aspect.WRITE_OPERATION,\n    operation_1.Aspect.EXPLAINABLE,\n    operation_1.Aspect.SKIP_COLLATION\n]);\n(0, operation_1.defineAspects)(DeleteManyOperation, [\n    operation_1.Aspect.WRITE_OPERATION,\n    operation_1.Aspect.EXPLAINABLE,\n    operation_1.Aspect.SKIP_COLLATION\n]);\n//# sourceMappingURL=delete.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL2RlbGV0ZS5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCwyQkFBMkIsR0FBRywyQkFBMkIsR0FBRywwQkFBMEIsR0FBRyx1QkFBdUI7QUFDaEgsZ0JBQWdCLG1CQUFPLENBQUMsbUVBQVU7QUFDbEMsa0JBQWtCLG1CQUFPLENBQUMsaUZBQVc7QUFDckMsb0JBQW9CLG1CQUFPLENBQUMscUZBQWE7QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QjtBQUN2QjtBQUNBO0FBQ0EscUVBQXFFLHNCQUFzQjtBQUMzRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0EsMEJBQTBCO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQSwyQkFBMkI7QUFDM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkI7QUFDM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIkQ6XFxzYWxvbmlcXGFwcHJhaXNhbC1zeXN0ZW1cXHNlcnZlclxcbm9kZV9tb2R1bGVzXFxtb25nb2RiXFxsaWJcXG9wZXJhdGlvbnNcXGRlbGV0ZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMubWFrZURlbGV0ZVN0YXRlbWVudCA9IGV4cG9ydHMuRGVsZXRlTWFueU9wZXJhdGlvbiA9IGV4cG9ydHMuRGVsZXRlT25lT3BlcmF0aW9uID0gZXhwb3J0cy5EZWxldGVPcGVyYXRpb24gPSB2b2lkIDA7XG5jb25zdCBlcnJvcl8xID0gcmVxdWlyZShcIi4uL2Vycm9yXCIpO1xuY29uc3QgY29tbWFuZF8xID0gcmVxdWlyZShcIi4vY29tbWFuZFwiKTtcbmNvbnN0IG9wZXJhdGlvbl8xID0gcmVxdWlyZShcIi4vb3BlcmF0aW9uXCIpO1xuLyoqIEBpbnRlcm5hbCAqL1xuY2xhc3MgRGVsZXRlT3BlcmF0aW9uIGV4dGVuZHMgY29tbWFuZF8xLkNvbW1hbmRDYWxsYmFja09wZXJhdGlvbiB7XG4gICAgY29uc3RydWN0b3IobnMsIHN0YXRlbWVudHMsIG9wdGlvbnMpIHtcbiAgICAgICAgc3VwZXIodW5kZWZpbmVkLCBvcHRpb25zKTtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcbiAgICAgICAgdGhpcy5ucyA9IG5zO1xuICAgICAgICB0aGlzLnN0YXRlbWVudHMgPSBzdGF0ZW1lbnRzO1xuICAgIH1cbiAgICBnZXQgY2FuUmV0cnlXcml0ZSgpIHtcbiAgICAgICAgaWYgKHN1cGVyLmNhblJldHJ5V3JpdGUgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGVtZW50cy5ldmVyeShvcCA9PiAob3AubGltaXQgIT0gbnVsbCA/IG9wLmxpbWl0ID4gMCA6IHRydWUpKTtcbiAgICB9XG4gICAgZXhlY3V0ZUNhbGxiYWNrKHNlcnZlciwgc2Vzc2lvbiwgY2FsbGJhY2spIHtcbiAgICAgICAgY29uc3Qgb3B0aW9ucyA9IHRoaXMub3B0aW9ucyA/PyB7fTtcbiAgICAgICAgY29uc3Qgb3JkZXJlZCA9IHR5cGVvZiBvcHRpb25zLm9yZGVyZWQgPT09ICdib29sZWFuJyA/IG9wdGlvbnMub3JkZXJlZCA6IHRydWU7XG4gICAgICAgIGNvbnN0IGNvbW1hbmQgPSB7XG4gICAgICAgICAgICBkZWxldGU6IHRoaXMubnMuY29sbGVjdGlvbixcbiAgICAgICAgICAgIGRlbGV0ZXM6IHRoaXMuc3RhdGVtZW50cyxcbiAgICAgICAgICAgIG9yZGVyZWRcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKG9wdGlvbnMubGV0KSB7XG4gICAgICAgICAgICBjb21tYW5kLmxldCA9IG9wdGlvbnMubGV0O1xuICAgICAgICB9XG4gICAgICAgIC8vIHdlIGNoZWNrIGZvciB1bmRlZmluZWQgc3BlY2lmaWNhbGx5IGhlcmUgdG8gYWxsb3cgZmFsc3kgdmFsdWVzXG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1yZXN0cmljdGVkLXN5bnRheFxuICAgICAgICBpZiAob3B0aW9ucy5jb21tZW50ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGNvbW1hbmQuY29tbWVudCA9IG9wdGlvbnMuY29tbWVudDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB1bmFja25vd2xlZGdlZFdyaXRlID0gdGhpcy53cml0ZUNvbmNlcm4gJiYgdGhpcy53cml0ZUNvbmNlcm4udyA9PT0gMDtcbiAgICAgICAgaWYgKHVuYWNrbm93bGVkZ2VkV3JpdGUpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlbWVudHMuZmluZCgobykgPT4gby5oaW50KSkge1xuICAgICAgICAgICAgICAgIC8vIFRPRE8oTk9ERS0zNTQxKTogZml4IGVycm9yIGZvciBoaW50IHdpdGggdW5hY2tub3dsZWRnZWQgd3JpdGVzXG4gICAgICAgICAgICAgICAgY2FsbGJhY2sobmV3IGVycm9yXzEuTW9uZ29Db21wYXRpYmlsaXR5RXJyb3IoYGhpbnQgaXMgbm90IHN1cHBvcnRlZCB3aXRoIHVuYWNrbm93bGVkZ2VkIHdyaXRlc2ApKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgc3VwZXIuZXhlY3V0ZUNvbW1hbmRDYWxsYmFjayhzZXJ2ZXIsIHNlc3Npb24sIGNvbW1hbmQsIGNhbGxiYWNrKTtcbiAgICB9XG59XG5leHBvcnRzLkRlbGV0ZU9wZXJhdGlvbiA9IERlbGV0ZU9wZXJhdGlvbjtcbmNsYXNzIERlbGV0ZU9uZU9wZXJhdGlvbiBleHRlbmRzIERlbGV0ZU9wZXJhdGlvbiB7XG4gICAgY29uc3RydWN0b3IoY29sbGVjdGlvbiwgZmlsdGVyLCBvcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKGNvbGxlY3Rpb24ucy5uYW1lc3BhY2UsIFttYWtlRGVsZXRlU3RhdGVtZW50KGZpbHRlciwgeyAuLi5vcHRpb25zLCBsaW1pdDogMSB9KV0sIG9wdGlvbnMpO1xuICAgIH1cbiAgICBleGVjdXRlQ2FsbGJhY2soc2VydmVyLCBzZXNzaW9uLCBjYWxsYmFjaykge1xuICAgICAgICBzdXBlci5leGVjdXRlQ2FsbGJhY2soc2VydmVyLCBzZXNzaW9uLCAoZXJyLCByZXMpID0+IHtcbiAgICAgICAgICAgIGlmIChlcnIgfHwgcmVzID09IG51bGwpXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgICAgICAgICBpZiAocmVzLmNvZGUpXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKG5ldyBlcnJvcl8xLk1vbmdvU2VydmVyRXJyb3IocmVzKSk7XG4gICAgICAgICAgICBpZiAocmVzLndyaXRlRXJyb3JzKVxuICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhuZXcgZXJyb3JfMS5Nb25nb1NlcnZlckVycm9yKHJlcy53cml0ZUVycm9yc1swXSkpO1xuICAgICAgICAgICAgaWYgKHRoaXMuZXhwbGFpbilcbiAgICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2sodW5kZWZpbmVkLCByZXMpO1xuICAgICAgICAgICAgY2FsbGJhY2sodW5kZWZpbmVkLCB7XG4gICAgICAgICAgICAgICAgYWNrbm93bGVkZ2VkOiB0aGlzLndyaXRlQ29uY2Vybj8udyAhPT0gMCA/PyB0cnVlLFxuICAgICAgICAgICAgICAgIGRlbGV0ZWRDb3VudDogcmVzLm5cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5leHBvcnRzLkRlbGV0ZU9uZU9wZXJhdGlvbiA9IERlbGV0ZU9uZU9wZXJhdGlvbjtcbmNsYXNzIERlbGV0ZU1hbnlPcGVyYXRpb24gZXh0ZW5kcyBEZWxldGVPcGVyYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKGNvbGxlY3Rpb24sIGZpbHRlciwgb3B0aW9ucykge1xuICAgICAgICBzdXBlcihjb2xsZWN0aW9uLnMubmFtZXNwYWNlLCBbbWFrZURlbGV0ZVN0YXRlbWVudChmaWx0ZXIsIG9wdGlvbnMpXSwgb3B0aW9ucyk7XG4gICAgfVxuICAgIGV4ZWN1dGVDYWxsYmFjayhzZXJ2ZXIsIHNlc3Npb24sIGNhbGxiYWNrKSB7XG4gICAgICAgIHN1cGVyLmV4ZWN1dGVDYWxsYmFjayhzZXJ2ZXIsIHNlc3Npb24sIChlcnIsIHJlcykgPT4ge1xuICAgICAgICAgICAgaWYgKGVyciB8fCByZXMgPT0gbnVsbClcbiAgICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICAgICAgICAgIGlmIChyZXMuY29kZSlcbiAgICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2sobmV3IGVycm9yXzEuTW9uZ29TZXJ2ZXJFcnJvcihyZXMpKTtcbiAgICAgICAgICAgIGlmIChyZXMud3JpdGVFcnJvcnMpXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKG5ldyBlcnJvcl8xLk1vbmdvU2VydmVyRXJyb3IocmVzLndyaXRlRXJyb3JzWzBdKSk7XG4gICAgICAgICAgICBpZiAodGhpcy5leHBsYWluKVxuICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayh1bmRlZmluZWQsIHJlcyk7XG4gICAgICAgICAgICBjYWxsYmFjayh1bmRlZmluZWQsIHtcbiAgICAgICAgICAgICAgICBhY2tub3dsZWRnZWQ6IHRoaXMud3JpdGVDb25jZXJuPy53ICE9PSAwID8/IHRydWUsXG4gICAgICAgICAgICAgICAgZGVsZXRlZENvdW50OiByZXMublxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmV4cG9ydHMuRGVsZXRlTWFueU9wZXJhdGlvbiA9IERlbGV0ZU1hbnlPcGVyYXRpb247XG5mdW5jdGlvbiBtYWtlRGVsZXRlU3RhdGVtZW50KGZpbHRlciwgb3B0aW9ucykge1xuICAgIGNvbnN0IG9wID0ge1xuICAgICAgICBxOiBmaWx0ZXIsXG4gICAgICAgIGxpbWl0OiB0eXBlb2Ygb3B0aW9ucy5saW1pdCA9PT0gJ251bWJlcicgPyBvcHRpb25zLmxpbWl0IDogMFxuICAgIH07XG4gICAgaWYgKG9wdGlvbnMuY29sbGF0aW9uKSB7XG4gICAgICAgIG9wLmNvbGxhdGlvbiA9IG9wdGlvbnMuY29sbGF0aW9uO1xuICAgIH1cbiAgICBpZiAob3B0aW9ucy5oaW50KSB7XG4gICAgICAgIG9wLmhpbnQgPSBvcHRpb25zLmhpbnQ7XG4gICAgfVxuICAgIHJldHVybiBvcDtcbn1cbmV4cG9ydHMubWFrZURlbGV0ZVN0YXRlbWVudCA9IG1ha2VEZWxldGVTdGF0ZW1lbnQ7XG4oMCwgb3BlcmF0aW9uXzEuZGVmaW5lQXNwZWN0cykoRGVsZXRlT3BlcmF0aW9uLCBbb3BlcmF0aW9uXzEuQXNwZWN0LlJFVFJZQUJMRSwgb3BlcmF0aW9uXzEuQXNwZWN0LldSSVRFX09QRVJBVElPTl0pO1xuKDAsIG9wZXJhdGlvbl8xLmRlZmluZUFzcGVjdHMpKERlbGV0ZU9uZU9wZXJhdGlvbiwgW1xuICAgIG9wZXJhdGlvbl8xLkFzcGVjdC5SRVRSWUFCTEUsXG4gICAgb3BlcmF0aW9uXzEuQXNwZWN0LldSSVRFX09QRVJBVElPTixcbiAgICBvcGVyYXRpb25fMS5Bc3BlY3QuRVhQTEFJTkFCTEUsXG4gICAgb3BlcmF0aW9uXzEuQXNwZWN0LlNLSVBfQ09MTEFUSU9OXG5dKTtcbigwLCBvcGVyYXRpb25fMS5kZWZpbmVBc3BlY3RzKShEZWxldGVNYW55T3BlcmF0aW9uLCBbXG4gICAgb3BlcmF0aW9uXzEuQXNwZWN0LldSSVRFX09QRVJBVElPTixcbiAgICBvcGVyYXRpb25fMS5Bc3BlY3QuRVhQTEFJTkFCTEUsXG4gICAgb3BlcmF0aW9uXzEuQXNwZWN0LlNLSVBfQ09MTEFUSU9OXG5dKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWRlbGV0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/operations/delete.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/operations/distinct.js":
/*!*****************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/operations/distinct.js ***!
  \*****************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.DistinctOperation = void 0;\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\nconst command_1 = __webpack_require__(/*! ./command */ \"(api)/../server/node_modules/mongodb/lib/operations/command.js\");\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(api)/../server/node_modules/mongodb/lib/operations/operation.js\");\n/**\n * Return a list of distinct values for the given key across a collection.\n * @internal\n */\nclass DistinctOperation extends command_1.CommandCallbackOperation {\n    /**\n     * Construct a Distinct operation.\n     *\n     * @param collection - Collection instance.\n     * @param key - Field of the document to find distinct values for.\n     * @param query - The query for filtering the set of documents to which we apply the distinct filter.\n     * @param options - Optional settings. See Collection.prototype.distinct for a list of options.\n     */\n    constructor(collection, key, query, options) {\n        super(collection, options);\n        this.options = options ?? {};\n        this.collection = collection;\n        this.key = key;\n        this.query = query;\n    }\n    executeCallback(server, session, callback) {\n        const coll = this.collection;\n        const key = this.key;\n        const query = this.query;\n        const options = this.options;\n        // Distinct command\n        const cmd = {\n            distinct: coll.collectionName,\n            key: key,\n            query: query\n        };\n        // Add maxTimeMS if defined\n        if (typeof options.maxTimeMS === 'number') {\n            cmd.maxTimeMS = options.maxTimeMS;\n        }\n        // we check for undefined specifically here to allow falsy values\n        // eslint-disable-next-line no-restricted-syntax\n        if (typeof options.comment !== 'undefined') {\n            cmd.comment = options.comment;\n        }\n        // Do we have a readConcern specified\n        (0, utils_1.decorateWithReadConcern)(cmd, coll, options);\n        // Have we specified collation\n        try {\n            (0, utils_1.decorateWithCollation)(cmd, coll, options);\n        }\n        catch (err) {\n            return callback(err);\n        }\n        super.executeCommandCallback(server, session, cmd, (err, result) => {\n            if (err) {\n                callback(err);\n                return;\n            }\n            callback(undefined, this.explain ? result : result.values);\n        });\n    }\n}\nexports.DistinctOperation = DistinctOperation;\n(0, operation_1.defineAspects)(DistinctOperation, [operation_1.Aspect.READ_OPERATION, operation_1.Aspect.RETRYABLE, operation_1.Aspect.EXPLAINABLE]);\n//# sourceMappingURL=distinct.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL2Rpc3RpbmN0LmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELHlCQUF5QjtBQUN6QixnQkFBZ0IsbUJBQU8sQ0FBQyxtRUFBVTtBQUNsQyxrQkFBa0IsbUJBQU8sQ0FBQyxpRkFBVztBQUNyQyxvQkFBb0IsbUJBQU8sQ0FBQyxxRkFBYTtBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0EiLCJzb3VyY2VzIjpbIkQ6XFxzYWxvbmlcXGFwcHJhaXNhbC1zeXN0ZW1cXHNlcnZlclxcbm9kZV9tb2R1bGVzXFxtb25nb2RiXFxsaWJcXG9wZXJhdGlvbnNcXGRpc3RpbmN0LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5EaXN0aW5jdE9wZXJhdGlvbiA9IHZvaWQgMDtcbmNvbnN0IHV0aWxzXzEgPSByZXF1aXJlKFwiLi4vdXRpbHNcIik7XG5jb25zdCBjb21tYW5kXzEgPSByZXF1aXJlKFwiLi9jb21tYW5kXCIpO1xuY29uc3Qgb3BlcmF0aW9uXzEgPSByZXF1aXJlKFwiLi9vcGVyYXRpb25cIik7XG4vKipcbiAqIFJldHVybiBhIGxpc3Qgb2YgZGlzdGluY3QgdmFsdWVzIGZvciB0aGUgZ2l2ZW4ga2V5IGFjcm9zcyBhIGNvbGxlY3Rpb24uXG4gKiBAaW50ZXJuYWxcbiAqL1xuY2xhc3MgRGlzdGluY3RPcGVyYXRpb24gZXh0ZW5kcyBjb21tYW5kXzEuQ29tbWFuZENhbGxiYWNrT3BlcmF0aW9uIHtcbiAgICAvKipcbiAgICAgKiBDb25zdHJ1Y3QgYSBEaXN0aW5jdCBvcGVyYXRpb24uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gY29sbGVjdGlvbiAtIENvbGxlY3Rpb24gaW5zdGFuY2UuXG4gICAgICogQHBhcmFtIGtleSAtIEZpZWxkIG9mIHRoZSBkb2N1bWVudCB0byBmaW5kIGRpc3RpbmN0IHZhbHVlcyBmb3IuXG4gICAgICogQHBhcmFtIHF1ZXJ5IC0gVGhlIHF1ZXJ5IGZvciBmaWx0ZXJpbmcgdGhlIHNldCBvZiBkb2N1bWVudHMgdG8gd2hpY2ggd2UgYXBwbHkgdGhlIGRpc3RpbmN0IGZpbHRlci5cbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzLiBTZWUgQ29sbGVjdGlvbi5wcm90b3R5cGUuZGlzdGluY3QgZm9yIGEgbGlzdCBvZiBvcHRpb25zLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGNvbGxlY3Rpb24sIGtleSwgcXVlcnksIG9wdGlvbnMpIHtcbiAgICAgICAgc3VwZXIoY29sbGVjdGlvbiwgb3B0aW9ucyk7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnMgPz8ge307XG4gICAgICAgIHRoaXMuY29sbGVjdGlvbiA9IGNvbGxlY3Rpb247XG4gICAgICAgIHRoaXMua2V5ID0ga2V5O1xuICAgICAgICB0aGlzLnF1ZXJ5ID0gcXVlcnk7XG4gICAgfVxuICAgIGV4ZWN1dGVDYWxsYmFjayhzZXJ2ZXIsIHNlc3Npb24sIGNhbGxiYWNrKSB7XG4gICAgICAgIGNvbnN0IGNvbGwgPSB0aGlzLmNvbGxlY3Rpb247XG4gICAgICAgIGNvbnN0IGtleSA9IHRoaXMua2V5O1xuICAgICAgICBjb25zdCBxdWVyeSA9IHRoaXMucXVlcnk7XG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgIC8vIERpc3RpbmN0IGNvbW1hbmRcbiAgICAgICAgY29uc3QgY21kID0ge1xuICAgICAgICAgICAgZGlzdGluY3Q6IGNvbGwuY29sbGVjdGlvbk5hbWUsXG4gICAgICAgICAgICBrZXk6IGtleSxcbiAgICAgICAgICAgIHF1ZXJ5OiBxdWVyeVxuICAgICAgICB9O1xuICAgICAgICAvLyBBZGQgbWF4VGltZU1TIGlmIGRlZmluZWRcbiAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLm1heFRpbWVNUyA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgIGNtZC5tYXhUaW1lTVMgPSBvcHRpb25zLm1heFRpbWVNUztcbiAgICAgICAgfVxuICAgICAgICAvLyB3ZSBjaGVjayBmb3IgdW5kZWZpbmVkIHNwZWNpZmljYWxseSBoZXJlIHRvIGFsbG93IGZhbHN5IHZhbHVlc1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcmVzdHJpY3RlZC1zeW50YXhcbiAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLmNvbW1lbnQgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICBjbWQuY29tbWVudCA9IG9wdGlvbnMuY29tbWVudDtcbiAgICAgICAgfVxuICAgICAgICAvLyBEbyB3ZSBoYXZlIGEgcmVhZENvbmNlcm4gc3BlY2lmaWVkXG4gICAgICAgICgwLCB1dGlsc18xLmRlY29yYXRlV2l0aFJlYWRDb25jZXJuKShjbWQsIGNvbGwsIG9wdGlvbnMpO1xuICAgICAgICAvLyBIYXZlIHdlIHNwZWNpZmllZCBjb2xsYXRpb25cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICgwLCB1dGlsc18xLmRlY29yYXRlV2l0aENvbGxhdGlvbikoY21kLCBjb2xsLCBvcHRpb25zKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICAgICAgfVxuICAgICAgICBzdXBlci5leGVjdXRlQ29tbWFuZENhbGxiYWNrKHNlcnZlciwgc2Vzc2lvbiwgY21kLCAoZXJyLCByZXN1bHQpID0+IHtcbiAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnIpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwgdGhpcy5leHBsYWluID8gcmVzdWx0IDogcmVzdWx0LnZhbHVlcyk7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmV4cG9ydHMuRGlzdGluY3RPcGVyYXRpb24gPSBEaXN0aW5jdE9wZXJhdGlvbjtcbigwLCBvcGVyYXRpb25fMS5kZWZpbmVBc3BlY3RzKShEaXN0aW5jdE9wZXJhdGlvbiwgW29wZXJhdGlvbl8xLkFzcGVjdC5SRUFEX09QRVJBVElPTiwgb3BlcmF0aW9uXzEuQXNwZWN0LlJFVFJZQUJMRSwgb3BlcmF0aW9uXzEuQXNwZWN0LkVYUExBSU5BQkxFXSk7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1kaXN0aW5jdC5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/operations/distinct.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/operations/drop.js":
/*!*************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/operations/drop.js ***!
  \*************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.DropDatabaseOperation = exports.DropCollectionOperation = void 0;\nconst error_1 = __webpack_require__(/*! ../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst command_1 = __webpack_require__(/*! ./command */ \"(api)/../server/node_modules/mongodb/lib/operations/command.js\");\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(api)/../server/node_modules/mongodb/lib/operations/operation.js\");\n/** @internal */\nclass DropCollectionOperation extends command_1.CommandCallbackOperation {\n    constructor(db, name, options = {}) {\n        super(db, options);\n        this.db = db;\n        this.options = options;\n        this.name = name;\n    }\n    executeCallback(server, session, callback) {\n        (async () => {\n            const db = this.db;\n            const options = this.options;\n            const name = this.name;\n            const encryptedFieldsMap = db.client.options.autoEncryption?.encryptedFieldsMap;\n            let encryptedFields = options.encryptedFields ?? encryptedFieldsMap?.[`${db.databaseName}.${name}`];\n            if (!encryptedFields && encryptedFieldsMap) {\n                // If the MongoClient was configured with an encryptedFieldsMap,\n                // and no encryptedFields config was available in it or explicitly\n                // passed as an argument, the spec tells us to look one up using\n                // listCollections().\n                const listCollectionsResult = await db\n                    .listCollections({ name }, { nameOnly: false })\n                    .toArray();\n                encryptedFields = listCollectionsResult?.[0]?.options?.encryptedFields;\n            }\n            if (encryptedFields) {\n                const escCollection = encryptedFields.escCollection || `enxcol_.${name}.esc`;\n                const ecocCollection = encryptedFields.ecocCollection || `enxcol_.${name}.ecoc`;\n                for (const collectionName of [escCollection, ecocCollection]) {\n                    // Drop auxilliary collections, ignoring potential NamespaceNotFound errors.\n                    const dropOp = new DropCollectionOperation(db, collectionName);\n                    try {\n                        await dropOp.executeWithoutEncryptedFieldsCheck(server, session);\n                    }\n                    catch (err) {\n                        if (!(err instanceof error_1.MongoServerError) ||\n                            err.code !== error_1.MONGODB_ERROR_CODES.NamespaceNotFound) {\n                            throw err;\n                        }\n                    }\n                }\n            }\n            return this.executeWithoutEncryptedFieldsCheck(server, session);\n        })().then(result => callback(undefined, result), err => callback(err));\n    }\n    executeWithoutEncryptedFieldsCheck(server, session) {\n        return new Promise((resolve, reject) => {\n            super.executeCommandCallback(server, session, { drop: this.name }, (err, result) => {\n                if (err)\n                    return reject(err);\n                resolve(!!result.ok);\n            });\n        });\n    }\n}\nexports.DropCollectionOperation = DropCollectionOperation;\n/** @internal */\nclass DropDatabaseOperation extends command_1.CommandCallbackOperation {\n    constructor(db, options) {\n        super(db, options);\n        this.options = options;\n    }\n    executeCallback(server, session, callback) {\n        super.executeCommandCallback(server, session, { dropDatabase: 1 }, (err, result) => {\n            if (err)\n                return callback(err);\n            if (result.ok)\n                return callback(undefined, true);\n            callback(undefined, false);\n        });\n    }\n}\nexports.DropDatabaseOperation = DropDatabaseOperation;\n(0, operation_1.defineAspects)(DropCollectionOperation, [operation_1.Aspect.WRITE_OPERATION]);\n(0, operation_1.defineAspects)(DropDatabaseOperation, [operation_1.Aspect.WRITE_OPERATION]);\n//# sourceMappingURL=drop.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL2Ryb3AuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsNkJBQTZCLEdBQUcsK0JBQStCO0FBQy9ELGdCQUFnQixtQkFBTyxDQUFDLG1FQUFVO0FBQ2xDLGtCQUFrQixtQkFBTyxDQUFDLGlGQUFXO0FBQ3JDLG9CQUFvQixtQkFBTyxDQUFDLHFGQUFhO0FBQ3pDO0FBQ0E7QUFDQSxzQ0FBc0M7QUFDdEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFGQUFxRixnQkFBZ0IsR0FBRyxLQUFLO0FBQzdHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVDQUF1QyxNQUFNLElBQUksaUJBQWlCO0FBQ2xFO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0ZBQWtGLEtBQUs7QUFDdkYsb0ZBQW9GLEtBQUs7QUFDekY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLDREQUE0RCxpQkFBaUI7QUFDN0U7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0EsK0JBQStCO0FBQy9CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0RBQXdELGlCQUFpQjtBQUN6RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0I7QUFDQTtBQUNBIiwic291cmNlcyI6WyJEOlxcc2Fsb25pXFxhcHByYWlzYWwtc3lzdGVtXFxzZXJ2ZXJcXG5vZGVfbW9kdWxlc1xcbW9uZ29kYlxcbGliXFxvcGVyYXRpb25zXFxkcm9wLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5Ecm9wRGF0YWJhc2VPcGVyYXRpb24gPSBleHBvcnRzLkRyb3BDb2xsZWN0aW9uT3BlcmF0aW9uID0gdm9pZCAwO1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuLi9lcnJvclwiKTtcbmNvbnN0IGNvbW1hbmRfMSA9IHJlcXVpcmUoXCIuL2NvbW1hbmRcIik7XG5jb25zdCBvcGVyYXRpb25fMSA9IHJlcXVpcmUoXCIuL29wZXJhdGlvblwiKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIERyb3BDb2xsZWN0aW9uT3BlcmF0aW9uIGV4dGVuZHMgY29tbWFuZF8xLkNvbW1hbmRDYWxsYmFja09wZXJhdGlvbiB7XG4gICAgY29uc3RydWN0b3IoZGIsIG5hbWUsIG9wdGlvbnMgPSB7fSkge1xuICAgICAgICBzdXBlcihkYiwgb3B0aW9ucyk7XG4gICAgICAgIHRoaXMuZGIgPSBkYjtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcbiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICB9XG4gICAgZXhlY3V0ZUNhbGxiYWNrKHNlcnZlciwgc2Vzc2lvbiwgY2FsbGJhY2spIHtcbiAgICAgICAgKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGRiID0gdGhpcy5kYjtcbiAgICAgICAgICAgIGNvbnN0IG9wdGlvbnMgPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICBjb25zdCBuYW1lID0gdGhpcy5uYW1lO1xuICAgICAgICAgICAgY29uc3QgZW5jcnlwdGVkRmllbGRzTWFwID0gZGIuY2xpZW50Lm9wdGlvbnMuYXV0b0VuY3J5cHRpb24/LmVuY3J5cHRlZEZpZWxkc01hcDtcbiAgICAgICAgICAgIGxldCBlbmNyeXB0ZWRGaWVsZHMgPSBvcHRpb25zLmVuY3J5cHRlZEZpZWxkcyA/PyBlbmNyeXB0ZWRGaWVsZHNNYXA/LltgJHtkYi5kYXRhYmFzZU5hbWV9LiR7bmFtZX1gXTtcbiAgICAgICAgICAgIGlmICghZW5jcnlwdGVkRmllbGRzICYmIGVuY3J5cHRlZEZpZWxkc01hcCkge1xuICAgICAgICAgICAgICAgIC8vIElmIHRoZSBNb25nb0NsaWVudCB3YXMgY29uZmlndXJlZCB3aXRoIGFuIGVuY3J5cHRlZEZpZWxkc01hcCxcbiAgICAgICAgICAgICAgICAvLyBhbmQgbm8gZW5jcnlwdGVkRmllbGRzIGNvbmZpZyB3YXMgYXZhaWxhYmxlIGluIGl0IG9yIGV4cGxpY2l0bHlcbiAgICAgICAgICAgICAgICAvLyBwYXNzZWQgYXMgYW4gYXJndW1lbnQsIHRoZSBzcGVjIHRlbGxzIHVzIHRvIGxvb2sgb25lIHVwIHVzaW5nXG4gICAgICAgICAgICAgICAgLy8gbGlzdENvbGxlY3Rpb25zKCkuXG4gICAgICAgICAgICAgICAgY29uc3QgbGlzdENvbGxlY3Rpb25zUmVzdWx0ID0gYXdhaXQgZGJcbiAgICAgICAgICAgICAgICAgICAgLmxpc3RDb2xsZWN0aW9ucyh7IG5hbWUgfSwgeyBuYW1lT25seTogZmFsc2UgfSlcbiAgICAgICAgICAgICAgICAgICAgLnRvQXJyYXkoKTtcbiAgICAgICAgICAgICAgICBlbmNyeXB0ZWRGaWVsZHMgPSBsaXN0Q29sbGVjdGlvbnNSZXN1bHQ/LlswXT8ub3B0aW9ucz8uZW5jcnlwdGVkRmllbGRzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGVuY3J5cHRlZEZpZWxkcykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGVzY0NvbGxlY3Rpb24gPSBlbmNyeXB0ZWRGaWVsZHMuZXNjQ29sbGVjdGlvbiB8fCBgZW54Y29sXy4ke25hbWV9LmVzY2A7XG4gICAgICAgICAgICAgICAgY29uc3QgZWNvY0NvbGxlY3Rpb24gPSBlbmNyeXB0ZWRGaWVsZHMuZWNvY0NvbGxlY3Rpb24gfHwgYGVueGNvbF8uJHtuYW1lfS5lY29jYDtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGNvbGxlY3Rpb25OYW1lIG9mIFtlc2NDb2xsZWN0aW9uLCBlY29jQ29sbGVjdGlvbl0pIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gRHJvcCBhdXhpbGxpYXJ5IGNvbGxlY3Rpb25zLCBpZ25vcmluZyBwb3RlbnRpYWwgTmFtZXNwYWNlTm90Rm91bmQgZXJyb3JzLlxuICAgICAgICAgICAgICAgICAgICBjb25zdCBkcm9wT3AgPSBuZXcgRHJvcENvbGxlY3Rpb25PcGVyYXRpb24oZGIsIGNvbGxlY3Rpb25OYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGRyb3BPcC5leGVjdXRlV2l0aG91dEVuY3J5cHRlZEZpZWxkc0NoZWNrKHNlcnZlciwgc2Vzc2lvbik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEoZXJyIGluc3RhbmNlb2YgZXJyb3JfMS5Nb25nb1NlcnZlckVycm9yKSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVyci5jb2RlICE9PSBlcnJvcl8xLk1PTkdPREJfRVJST1JfQ09ERVMuTmFtZXNwYWNlTm90Rm91bmQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBlcnI7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5leGVjdXRlV2l0aG91dEVuY3J5cHRlZEZpZWxkc0NoZWNrKHNlcnZlciwgc2Vzc2lvbik7XG4gICAgICAgIH0pKCkudGhlbihyZXN1bHQgPT4gY2FsbGJhY2sodW5kZWZpbmVkLCByZXN1bHQpLCBlcnIgPT4gY2FsbGJhY2soZXJyKSk7XG4gICAgfVxuICAgIGV4ZWN1dGVXaXRob3V0RW5jcnlwdGVkRmllbGRzQ2hlY2soc2VydmVyLCBzZXNzaW9uKSB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICBzdXBlci5leGVjdXRlQ29tbWFuZENhbGxiYWNrKHNlcnZlciwgc2Vzc2lvbiwgeyBkcm9wOiB0aGlzLm5hbWUgfSwgKGVyciwgcmVzdWx0KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGVycilcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgIHJlc29sdmUoISFyZXN1bHQub2spO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmV4cG9ydHMuRHJvcENvbGxlY3Rpb25PcGVyYXRpb24gPSBEcm9wQ29sbGVjdGlvbk9wZXJhdGlvbjtcbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIERyb3BEYXRhYmFzZU9wZXJhdGlvbiBleHRlbmRzIGNvbW1hbmRfMS5Db21tYW5kQ2FsbGJhY2tPcGVyYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKGRiLCBvcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKGRiLCBvcHRpb25zKTtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcbiAgICB9XG4gICAgZXhlY3V0ZUNhbGxiYWNrKHNlcnZlciwgc2Vzc2lvbiwgY2FsbGJhY2spIHtcbiAgICAgICAgc3VwZXIuZXhlY3V0ZUNvbW1hbmRDYWxsYmFjayhzZXJ2ZXIsIHNlc3Npb24sIHsgZHJvcERhdGFiYXNlOiAxIH0sIChlcnIsIHJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgaWYgKGVycilcbiAgICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICAgICAgICAgIGlmIChyZXN1bHQub2spXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKHVuZGVmaW5lZCwgdHJ1ZSk7XG4gICAgICAgICAgICBjYWxsYmFjayh1bmRlZmluZWQsIGZhbHNlKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuZXhwb3J0cy5Ecm9wRGF0YWJhc2VPcGVyYXRpb24gPSBEcm9wRGF0YWJhc2VPcGVyYXRpb247XG4oMCwgb3BlcmF0aW9uXzEuZGVmaW5lQXNwZWN0cykoRHJvcENvbGxlY3Rpb25PcGVyYXRpb24sIFtvcGVyYXRpb25fMS5Bc3BlY3QuV1JJVEVfT1BFUkFUSU9OXSk7XG4oMCwgb3BlcmF0aW9uXzEuZGVmaW5lQXNwZWN0cykoRHJvcERhdGFiYXNlT3BlcmF0aW9uLCBbb3BlcmF0aW9uXzEuQXNwZWN0LldSSVRFX09QRVJBVElPTl0pO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZHJvcC5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/operations/drop.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/operations/estimated_document_count.js":
/*!*********************************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/operations/estimated_document_count.js ***!
  \*********************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.EstimatedDocumentCountOperation = void 0;\nconst command_1 = __webpack_require__(/*! ./command */ \"(api)/../server/node_modules/mongodb/lib/operations/command.js\");\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(api)/../server/node_modules/mongodb/lib/operations/operation.js\");\n/** @internal */\nclass EstimatedDocumentCountOperation extends command_1.CommandCallbackOperation {\n    constructor(collection, options = {}) {\n        super(collection, options);\n        this.options = options;\n        this.collectionName = collection.collectionName;\n    }\n    executeCallback(server, session, callback) {\n        const cmd = { count: this.collectionName };\n        if (typeof this.options.maxTimeMS === 'number') {\n            cmd.maxTimeMS = this.options.maxTimeMS;\n        }\n        // we check for undefined specifically here to allow falsy values\n        // eslint-disable-next-line no-restricted-syntax\n        if (this.options.comment !== undefined) {\n            cmd.comment = this.options.comment;\n        }\n        super.executeCommandCallback(server, session, cmd, (err, response) => {\n            if (err) {\n                callback(err);\n                return;\n            }\n            callback(undefined, response?.n || 0);\n        });\n    }\n}\nexports.EstimatedDocumentCountOperation = EstimatedDocumentCountOperation;\n(0, operation_1.defineAspects)(EstimatedDocumentCountOperation, [\n    operation_1.Aspect.READ_OPERATION,\n    operation_1.Aspect.RETRYABLE,\n    operation_1.Aspect.CURSOR_CREATING\n]);\n//# sourceMappingURL=estimated_document_count.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL2VzdGltYXRlZF9kb2N1bWVudF9jb3VudC5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCx1Q0FBdUM7QUFDdkMsa0JBQWtCLG1CQUFPLENBQUMsaUZBQVc7QUFDckMsb0JBQW9CLG1CQUFPLENBQUMscUZBQWE7QUFDekM7QUFDQTtBQUNBLHdDQUF3QztBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLHVDQUF1QztBQUN2QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIkQ6XFxzYWxvbmlcXGFwcHJhaXNhbC1zeXN0ZW1cXHNlcnZlclxcbm9kZV9tb2R1bGVzXFxtb25nb2RiXFxsaWJcXG9wZXJhdGlvbnNcXGVzdGltYXRlZF9kb2N1bWVudF9jb3VudC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuRXN0aW1hdGVkRG9jdW1lbnRDb3VudE9wZXJhdGlvbiA9IHZvaWQgMDtcbmNvbnN0IGNvbW1hbmRfMSA9IHJlcXVpcmUoXCIuL2NvbW1hbmRcIik7XG5jb25zdCBvcGVyYXRpb25fMSA9IHJlcXVpcmUoXCIuL29wZXJhdGlvblwiKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIEVzdGltYXRlZERvY3VtZW50Q291bnRPcGVyYXRpb24gZXh0ZW5kcyBjb21tYW5kXzEuQ29tbWFuZENhbGxiYWNrT3BlcmF0aW9uIHtcbiAgICBjb25zdHJ1Y3Rvcihjb2xsZWN0aW9uLCBvcHRpb25zID0ge30pIHtcbiAgICAgICAgc3VwZXIoY29sbGVjdGlvbiwgb3B0aW9ucyk7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XG4gICAgICAgIHRoaXMuY29sbGVjdGlvbk5hbWUgPSBjb2xsZWN0aW9uLmNvbGxlY3Rpb25OYW1lO1xuICAgIH1cbiAgICBleGVjdXRlQ2FsbGJhY2soc2VydmVyLCBzZXNzaW9uLCBjYWxsYmFjaykge1xuICAgICAgICBjb25zdCBjbWQgPSB7IGNvdW50OiB0aGlzLmNvbGxlY3Rpb25OYW1lIH07XG4gICAgICAgIGlmICh0eXBlb2YgdGhpcy5vcHRpb25zLm1heFRpbWVNUyA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgIGNtZC5tYXhUaW1lTVMgPSB0aGlzLm9wdGlvbnMubWF4VGltZU1TO1xuICAgICAgICB9XG4gICAgICAgIC8vIHdlIGNoZWNrIGZvciB1bmRlZmluZWQgc3BlY2lmaWNhbGx5IGhlcmUgdG8gYWxsb3cgZmFsc3kgdmFsdWVzXG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1yZXN0cmljdGVkLXN5bnRheFxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmNvbW1lbnQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgY21kLmNvbW1lbnQgPSB0aGlzLm9wdGlvbnMuY29tbWVudDtcbiAgICAgICAgfVxuICAgICAgICBzdXBlci5leGVjdXRlQ29tbWFuZENhbGxiYWNrKHNlcnZlciwgc2Vzc2lvbiwgY21kLCAoZXJyLCByZXNwb25zZSkgPT4ge1xuICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycik7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FsbGJhY2sodW5kZWZpbmVkLCByZXNwb25zZT8ubiB8fCAwKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuZXhwb3J0cy5Fc3RpbWF0ZWREb2N1bWVudENvdW50T3BlcmF0aW9uID0gRXN0aW1hdGVkRG9jdW1lbnRDb3VudE9wZXJhdGlvbjtcbigwLCBvcGVyYXRpb25fMS5kZWZpbmVBc3BlY3RzKShFc3RpbWF0ZWREb2N1bWVudENvdW50T3BlcmF0aW9uLCBbXG4gICAgb3BlcmF0aW9uXzEuQXNwZWN0LlJFQURfT1BFUkFUSU9OLFxuICAgIG9wZXJhdGlvbl8xLkFzcGVjdC5SRVRSWUFCTEUsXG4gICAgb3BlcmF0aW9uXzEuQXNwZWN0LkNVUlNPUl9DUkVBVElOR1xuXSk7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1lc3RpbWF0ZWRfZG9jdW1lbnRfY291bnQuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/operations/estimated_document_count.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/operations/execute_operation.js":
/*!**************************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/operations/execute_operation.js ***!
  \**************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.executeOperation = void 0;\nconst error_1 = __webpack_require__(/*! ../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst read_preference_1 = __webpack_require__(/*! ../read_preference */ \"(api)/../server/node_modules/mongodb/lib/read_preference.js\");\nconst server_selection_1 = __webpack_require__(/*! ../sdam/server_selection */ \"(api)/../server/node_modules/mongodb/lib/sdam/server_selection.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(api)/../server/node_modules/mongodb/lib/operations/operation.js\");\nconst MMAPv1_RETRY_WRITES_ERROR_CODE = error_1.MONGODB_ERROR_CODES.IllegalOperation;\nconst MMAPv1_RETRY_WRITES_ERROR_MESSAGE = 'This MongoDB deployment does not support retryable writes. Please add retryWrites=false to your connection string.';\nfunction executeOperation(client, operation, callback) {\n    return (0, utils_1.maybeCallback)(() => executeOperationAsync(client, operation), callback);\n}\nexports.executeOperation = executeOperation;\nasync function executeOperationAsync(client, operation) {\n    if (!(operation instanceof operation_1.AbstractCallbackOperation)) {\n        // TODO(NODE-3483): Extend MongoRuntimeError\n        throw new error_1.MongoRuntimeError('This method requires a valid operation instance');\n    }\n    if (client.topology == null) {\n        // Auto connect on operation\n        if (client.s.hasBeenClosed) {\n            throw new error_1.MongoNotConnectedError('Client must be connected before running operations');\n        }\n        client.s.options[Symbol.for('@@mdb.skipPingOnConnect')] = true;\n        try {\n            await client.connect();\n        }\n        finally {\n            delete client.s.options[Symbol.for('@@mdb.skipPingOnConnect')];\n        }\n    }\n    const { topology } = client;\n    if (topology == null) {\n        throw new error_1.MongoRuntimeError('client.connect did not create a topology but also did not throw');\n    }\n    // The driver sessions spec mandates that we implicitly create sessions for operations\n    // that are not explicitly provided with a session.\n    let session = operation.session;\n    let owner;\n    if (session == null) {\n        owner = Symbol();\n        session = client.startSession({ owner, explicit: false });\n    }\n    else if (session.hasEnded) {\n        throw new error_1.MongoExpiredSessionError('Use of expired sessions is not permitted');\n    }\n    else if (session.snapshotEnabled && !topology.capabilities.supportsSnapshotReads) {\n        throw new error_1.MongoCompatibilityError('Snapshot reads require MongoDB 5.0 or later');\n    }\n    const readPreference = operation.readPreference ?? read_preference_1.ReadPreference.primary;\n    const inTransaction = !!session?.inTransaction();\n    if (inTransaction && !readPreference.equals(read_preference_1.ReadPreference.primary)) {\n        throw new error_1.MongoTransactionError(`Read preference in a transaction must be primary, not: ${readPreference.mode}`);\n    }\n    if (session?.isPinned && session.transaction.isCommitted && !operation.bypassPinningCheck) {\n        session.unpin();\n    }\n    let selector;\n    if (operation.hasAspect(operation_1.Aspect.MUST_SELECT_SAME_SERVER)) {\n        // GetMore and KillCursor operations must always select the same server, but run through\n        // server selection to potentially force monitor checks if the server is\n        // in an unknown state.\n        selector = (0, server_selection_1.sameServerSelector)(operation.server?.description);\n    }\n    else if (operation.trySecondaryWrite) {\n        // If operation should try to write to secondary use the custom server selector\n        // otherwise provide the read preference.\n        selector = (0, server_selection_1.secondaryWritableServerSelector)(topology.commonWireVersion, readPreference);\n    }\n    else {\n        selector = readPreference;\n    }\n    const server = await topology.selectServerAsync(selector, { session });\n    if (session == null) {\n        // No session also means it is not retryable, early exit\n        return operation.execute(server, undefined);\n    }\n    if (!operation.hasAspect(operation_1.Aspect.RETRYABLE)) {\n        // non-retryable operation, early exit\n        try {\n            return await operation.execute(server, session);\n        }\n        finally {\n            if (session?.owner != null && session.owner === owner) {\n                await session.endSession().catch(() => null);\n            }\n        }\n    }\n    const willRetryRead = topology.s.options.retryReads && !inTransaction && operation.canRetryRead;\n    const willRetryWrite = topology.s.options.retryWrites &&\n        !inTransaction &&\n        (0, utils_1.supportsRetryableWrites)(server) &&\n        operation.canRetryWrite;\n    const hasReadAspect = operation.hasAspect(operation_1.Aspect.READ_OPERATION);\n    const hasWriteAspect = operation.hasAspect(operation_1.Aspect.WRITE_OPERATION);\n    const willRetry = (hasReadAspect && willRetryRead) || (hasWriteAspect && willRetryWrite);\n    if (hasWriteAspect && willRetryWrite) {\n        operation.options.willRetryWrite = true;\n        session.incrementTransactionNumber();\n    }\n    try {\n        return await operation.execute(server, session);\n    }\n    catch (operationError) {\n        if (willRetry && operationError instanceof error_1.MongoError) {\n            return await retryOperation(operation, operationError, {\n                session,\n                topology,\n                selector\n            });\n        }\n        throw operationError;\n    }\n    finally {\n        if (session?.owner != null && session.owner === owner) {\n            await session.endSession().catch(() => null);\n        }\n    }\n}\nasync function retryOperation(operation, originalError, { session, topology, selector }) {\n    const isWriteOperation = operation.hasAspect(operation_1.Aspect.WRITE_OPERATION);\n    const isReadOperation = operation.hasAspect(operation_1.Aspect.READ_OPERATION);\n    if (isWriteOperation && originalError.code === MMAPv1_RETRY_WRITES_ERROR_CODE) {\n        throw new error_1.MongoServerError({\n            message: MMAPv1_RETRY_WRITES_ERROR_MESSAGE,\n            errmsg: MMAPv1_RETRY_WRITES_ERROR_MESSAGE,\n            originalError\n        });\n    }\n    if (isWriteOperation && !(0, error_1.isRetryableWriteError)(originalError)) {\n        throw originalError;\n    }\n    if (isReadOperation && !(0, error_1.isRetryableReadError)(originalError)) {\n        throw originalError;\n    }\n    if (originalError instanceof error_1.MongoNetworkError &&\n        session.isPinned &&\n        !session.inTransaction() &&\n        operation.hasAspect(operation_1.Aspect.CURSOR_CREATING)) {\n        // If we have a cursor and the initial command fails with a network error,\n        // we can retry it on another connection. So we need to check it back in, clear the\n        // pool for the service id, and retry again.\n        session.unpin({ force: true, forceClear: true });\n    }\n    // select a new server, and attempt to retry the operation\n    const server = await topology.selectServerAsync(selector, { session });\n    if (isWriteOperation && !(0, utils_1.supportsRetryableWrites)(server)) {\n        throw new error_1.MongoUnexpectedServerResponseError('Selected server does not support retryable writes');\n    }\n    try {\n        return await operation.execute(server, session);\n    }\n    catch (retryError) {\n        if (retryError instanceof error_1.MongoError &&\n            retryError.hasErrorLabel(error_1.MongoErrorLabel.NoWritesPerformed)) {\n            throw originalError;\n        }\n        throw retryError;\n    }\n}\n//# sourceMappingURL=execute_operation.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL2V4ZWN1dGVfb3BlcmF0aW9uLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELHdCQUF3QjtBQUN4QixnQkFBZ0IsbUJBQU8sQ0FBQyxtRUFBVTtBQUNsQywwQkFBMEIsbUJBQU8sQ0FBQyx1RkFBb0I7QUFDdEQsMkJBQTJCLG1CQUFPLENBQUMsbUdBQTBCO0FBQzdELGdCQUFnQixtQkFBTyxDQUFDLG1FQUFVO0FBQ2xDLG9CQUFvQixtQkFBTyxDQUFDLHFGQUFhO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0I7QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxXQUFXO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdDQUF3Qyx3QkFBd0I7QUFDaEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwR0FBMEcsb0JBQW9CO0FBQzlIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0VBQWdFLFNBQVM7QUFDekU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBEQUEwRCw2QkFBNkI7QUFDdkY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QiwrQkFBK0I7QUFDdkQ7QUFDQTtBQUNBLGdFQUFnRSxTQUFTO0FBQ3pFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsiRDpcXHNhbG9uaVxcYXBwcmFpc2FsLXN5c3RlbVxcc2VydmVyXFxub2RlX21vZHVsZXNcXG1vbmdvZGJcXGxpYlxcb3BlcmF0aW9uc1xcZXhlY3V0ZV9vcGVyYXRpb24uanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmV4ZWN1dGVPcGVyYXRpb24gPSB2b2lkIDA7XG5jb25zdCBlcnJvcl8xID0gcmVxdWlyZShcIi4uL2Vycm9yXCIpO1xuY29uc3QgcmVhZF9wcmVmZXJlbmNlXzEgPSByZXF1aXJlKFwiLi4vcmVhZF9wcmVmZXJlbmNlXCIpO1xuY29uc3Qgc2VydmVyX3NlbGVjdGlvbl8xID0gcmVxdWlyZShcIi4uL3NkYW0vc2VydmVyX3NlbGVjdGlvblwiKTtcbmNvbnN0IHV0aWxzXzEgPSByZXF1aXJlKFwiLi4vdXRpbHNcIik7XG5jb25zdCBvcGVyYXRpb25fMSA9IHJlcXVpcmUoXCIuL29wZXJhdGlvblwiKTtcbmNvbnN0IE1NQVB2MV9SRVRSWV9XUklURVNfRVJST1JfQ09ERSA9IGVycm9yXzEuTU9OR09EQl9FUlJPUl9DT0RFUy5JbGxlZ2FsT3BlcmF0aW9uO1xuY29uc3QgTU1BUHYxX1JFVFJZX1dSSVRFU19FUlJPUl9NRVNTQUdFID0gJ1RoaXMgTW9uZ29EQiBkZXBsb3ltZW50IGRvZXMgbm90IHN1cHBvcnQgcmV0cnlhYmxlIHdyaXRlcy4gUGxlYXNlIGFkZCByZXRyeVdyaXRlcz1mYWxzZSB0byB5b3VyIGNvbm5lY3Rpb24gc3RyaW5nLic7XG5mdW5jdGlvbiBleGVjdXRlT3BlcmF0aW9uKGNsaWVudCwgb3BlcmF0aW9uLCBjYWxsYmFjaykge1xuICAgIHJldHVybiAoMCwgdXRpbHNfMS5tYXliZUNhbGxiYWNrKSgoKSA9PiBleGVjdXRlT3BlcmF0aW9uQXN5bmMoY2xpZW50LCBvcGVyYXRpb24pLCBjYWxsYmFjayk7XG59XG5leHBvcnRzLmV4ZWN1dGVPcGVyYXRpb24gPSBleGVjdXRlT3BlcmF0aW9uO1xuYXN5bmMgZnVuY3Rpb24gZXhlY3V0ZU9wZXJhdGlvbkFzeW5jKGNsaWVudCwgb3BlcmF0aW9uKSB7XG4gICAgaWYgKCEob3BlcmF0aW9uIGluc3RhbmNlb2Ygb3BlcmF0aW9uXzEuQWJzdHJhY3RDYWxsYmFja09wZXJhdGlvbikpIHtcbiAgICAgICAgLy8gVE9ETyhOT0RFLTM0ODMpOiBFeHRlbmQgTW9uZ29SdW50aW1lRXJyb3JcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29SdW50aW1lRXJyb3IoJ1RoaXMgbWV0aG9kIHJlcXVpcmVzIGEgdmFsaWQgb3BlcmF0aW9uIGluc3RhbmNlJyk7XG4gICAgfVxuICAgIGlmIChjbGllbnQudG9wb2xvZ3kgPT0gbnVsbCkge1xuICAgICAgICAvLyBBdXRvIGNvbm5lY3Qgb24gb3BlcmF0aW9uXG4gICAgICAgIGlmIChjbGllbnQucy5oYXNCZWVuQ2xvc2VkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb05vdENvbm5lY3RlZEVycm9yKCdDbGllbnQgbXVzdCBiZSBjb25uZWN0ZWQgYmVmb3JlIHJ1bm5pbmcgb3BlcmF0aW9ucycpO1xuICAgICAgICB9XG4gICAgICAgIGNsaWVudC5zLm9wdGlvbnNbU3ltYm9sLmZvcignQEBtZGIuc2tpcFBpbmdPbkNvbm5lY3QnKV0gPSB0cnVlO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgY2xpZW50LmNvbm5lY3QoKTtcbiAgICAgICAgfVxuICAgICAgICBmaW5hbGx5IHtcbiAgICAgICAgICAgIGRlbGV0ZSBjbGllbnQucy5vcHRpb25zW1N5bWJvbC5mb3IoJ0BAbWRiLnNraXBQaW5nT25Db25uZWN0JyldO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbnN0IHsgdG9wb2xvZ3kgfSA9IGNsaWVudDtcbiAgICBpZiAodG9wb2xvZ3kgPT0gbnVsbCkge1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1J1bnRpbWVFcnJvcignY2xpZW50LmNvbm5lY3QgZGlkIG5vdCBjcmVhdGUgYSB0b3BvbG9neSBidXQgYWxzbyBkaWQgbm90IHRocm93Jyk7XG4gICAgfVxuICAgIC8vIFRoZSBkcml2ZXIgc2Vzc2lvbnMgc3BlYyBtYW5kYXRlcyB0aGF0IHdlIGltcGxpY2l0bHkgY3JlYXRlIHNlc3Npb25zIGZvciBvcGVyYXRpb25zXG4gICAgLy8gdGhhdCBhcmUgbm90IGV4cGxpY2l0bHkgcHJvdmlkZWQgd2l0aCBhIHNlc3Npb24uXG4gICAgbGV0IHNlc3Npb24gPSBvcGVyYXRpb24uc2Vzc2lvbjtcbiAgICBsZXQgb3duZXI7XG4gICAgaWYgKHNlc3Npb24gPT0gbnVsbCkge1xuICAgICAgICBvd25lciA9IFN5bWJvbCgpO1xuICAgICAgICBzZXNzaW9uID0gY2xpZW50LnN0YXJ0U2Vzc2lvbih7IG93bmVyLCBleHBsaWNpdDogZmFsc2UgfSk7XG4gICAgfVxuICAgIGVsc2UgaWYgKHNlc3Npb24uaGFzRW5kZWQpIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29FeHBpcmVkU2Vzc2lvbkVycm9yKCdVc2Ugb2YgZXhwaXJlZCBzZXNzaW9ucyBpcyBub3QgcGVybWl0dGVkJyk7XG4gICAgfVxuICAgIGVsc2UgaWYgKHNlc3Npb24uc25hcHNob3RFbmFibGVkICYmICF0b3BvbG9neS5jYXBhYmlsaXRpZXMuc3VwcG9ydHNTbmFwc2hvdFJlYWRzKSB7XG4gICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvQ29tcGF0aWJpbGl0eUVycm9yKCdTbmFwc2hvdCByZWFkcyByZXF1aXJlIE1vbmdvREIgNS4wIG9yIGxhdGVyJyk7XG4gICAgfVxuICAgIGNvbnN0IHJlYWRQcmVmZXJlbmNlID0gb3BlcmF0aW9uLnJlYWRQcmVmZXJlbmNlID8/IHJlYWRfcHJlZmVyZW5jZV8xLlJlYWRQcmVmZXJlbmNlLnByaW1hcnk7XG4gICAgY29uc3QgaW5UcmFuc2FjdGlvbiA9ICEhc2Vzc2lvbj8uaW5UcmFuc2FjdGlvbigpO1xuICAgIGlmIChpblRyYW5zYWN0aW9uICYmICFyZWFkUHJlZmVyZW5jZS5lcXVhbHMocmVhZF9wcmVmZXJlbmNlXzEuUmVhZFByZWZlcmVuY2UucHJpbWFyeSkpIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29UcmFuc2FjdGlvbkVycm9yKGBSZWFkIHByZWZlcmVuY2UgaW4gYSB0cmFuc2FjdGlvbiBtdXN0IGJlIHByaW1hcnksIG5vdDogJHtyZWFkUHJlZmVyZW5jZS5tb2RlfWApO1xuICAgIH1cbiAgICBpZiAoc2Vzc2lvbj8uaXNQaW5uZWQgJiYgc2Vzc2lvbi50cmFuc2FjdGlvbi5pc0NvbW1pdHRlZCAmJiAhb3BlcmF0aW9uLmJ5cGFzc1Bpbm5pbmdDaGVjaykge1xuICAgICAgICBzZXNzaW9uLnVucGluKCk7XG4gICAgfVxuICAgIGxldCBzZWxlY3RvcjtcbiAgICBpZiAob3BlcmF0aW9uLmhhc0FzcGVjdChvcGVyYXRpb25fMS5Bc3BlY3QuTVVTVF9TRUxFQ1RfU0FNRV9TRVJWRVIpKSB7XG4gICAgICAgIC8vIEdldE1vcmUgYW5kIEtpbGxDdXJzb3Igb3BlcmF0aW9ucyBtdXN0IGFsd2F5cyBzZWxlY3QgdGhlIHNhbWUgc2VydmVyLCBidXQgcnVuIHRocm91Z2hcbiAgICAgICAgLy8gc2VydmVyIHNlbGVjdGlvbiB0byBwb3RlbnRpYWxseSBmb3JjZSBtb25pdG9yIGNoZWNrcyBpZiB0aGUgc2VydmVyIGlzXG4gICAgICAgIC8vIGluIGFuIHVua25vd24gc3RhdGUuXG4gICAgICAgIHNlbGVjdG9yID0gKDAsIHNlcnZlcl9zZWxlY3Rpb25fMS5zYW1lU2VydmVyU2VsZWN0b3IpKG9wZXJhdGlvbi5zZXJ2ZXI/LmRlc2NyaXB0aW9uKTtcbiAgICB9XG4gICAgZWxzZSBpZiAob3BlcmF0aW9uLnRyeVNlY29uZGFyeVdyaXRlKSB7XG4gICAgICAgIC8vIElmIG9wZXJhdGlvbiBzaG91bGQgdHJ5IHRvIHdyaXRlIHRvIHNlY29uZGFyeSB1c2UgdGhlIGN1c3RvbSBzZXJ2ZXIgc2VsZWN0b3JcbiAgICAgICAgLy8gb3RoZXJ3aXNlIHByb3ZpZGUgdGhlIHJlYWQgcHJlZmVyZW5jZS5cbiAgICAgICAgc2VsZWN0b3IgPSAoMCwgc2VydmVyX3NlbGVjdGlvbl8xLnNlY29uZGFyeVdyaXRhYmxlU2VydmVyU2VsZWN0b3IpKHRvcG9sb2d5LmNvbW1vbldpcmVWZXJzaW9uLCByZWFkUHJlZmVyZW5jZSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBzZWxlY3RvciA9IHJlYWRQcmVmZXJlbmNlO1xuICAgIH1cbiAgICBjb25zdCBzZXJ2ZXIgPSBhd2FpdCB0b3BvbG9neS5zZWxlY3RTZXJ2ZXJBc3luYyhzZWxlY3RvciwgeyBzZXNzaW9uIH0pO1xuICAgIGlmIChzZXNzaW9uID09IG51bGwpIHtcbiAgICAgICAgLy8gTm8gc2Vzc2lvbiBhbHNvIG1lYW5zIGl0IGlzIG5vdCByZXRyeWFibGUsIGVhcmx5IGV4aXRcbiAgICAgICAgcmV0dXJuIG9wZXJhdGlvbi5leGVjdXRlKHNlcnZlciwgdW5kZWZpbmVkKTtcbiAgICB9XG4gICAgaWYgKCFvcGVyYXRpb24uaGFzQXNwZWN0KG9wZXJhdGlvbl8xLkFzcGVjdC5SRVRSWUFCTEUpKSB7XG4gICAgICAgIC8vIG5vbi1yZXRyeWFibGUgb3BlcmF0aW9uLCBlYXJseSBleGl0XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgb3BlcmF0aW9uLmV4ZWN1dGUoc2VydmVyLCBzZXNzaW9uKTtcbiAgICAgICAgfVxuICAgICAgICBmaW5hbGx5IHtcbiAgICAgICAgICAgIGlmIChzZXNzaW9uPy5vd25lciAhPSBudWxsICYmIHNlc3Npb24ub3duZXIgPT09IG93bmVyKSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgc2Vzc2lvbi5lbmRTZXNzaW9uKCkuY2F0Y2goKCkgPT4gbnVsbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29uc3Qgd2lsbFJldHJ5UmVhZCA9IHRvcG9sb2d5LnMub3B0aW9ucy5yZXRyeVJlYWRzICYmICFpblRyYW5zYWN0aW9uICYmIG9wZXJhdGlvbi5jYW5SZXRyeVJlYWQ7XG4gICAgY29uc3Qgd2lsbFJldHJ5V3JpdGUgPSB0b3BvbG9neS5zLm9wdGlvbnMucmV0cnlXcml0ZXMgJiZcbiAgICAgICAgIWluVHJhbnNhY3Rpb24gJiZcbiAgICAgICAgKDAsIHV0aWxzXzEuc3VwcG9ydHNSZXRyeWFibGVXcml0ZXMpKHNlcnZlcikgJiZcbiAgICAgICAgb3BlcmF0aW9uLmNhblJldHJ5V3JpdGU7XG4gICAgY29uc3QgaGFzUmVhZEFzcGVjdCA9IG9wZXJhdGlvbi5oYXNBc3BlY3Qob3BlcmF0aW9uXzEuQXNwZWN0LlJFQURfT1BFUkFUSU9OKTtcbiAgICBjb25zdCBoYXNXcml0ZUFzcGVjdCA9IG9wZXJhdGlvbi5oYXNBc3BlY3Qob3BlcmF0aW9uXzEuQXNwZWN0LldSSVRFX09QRVJBVElPTik7XG4gICAgY29uc3Qgd2lsbFJldHJ5ID0gKGhhc1JlYWRBc3BlY3QgJiYgd2lsbFJldHJ5UmVhZCkgfHwgKGhhc1dyaXRlQXNwZWN0ICYmIHdpbGxSZXRyeVdyaXRlKTtcbiAgICBpZiAoaGFzV3JpdGVBc3BlY3QgJiYgd2lsbFJldHJ5V3JpdGUpIHtcbiAgICAgICAgb3BlcmF0aW9uLm9wdGlvbnMud2lsbFJldHJ5V3JpdGUgPSB0cnVlO1xuICAgICAgICBzZXNzaW9uLmluY3JlbWVudFRyYW5zYWN0aW9uTnVtYmVyKCk7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICAgIHJldHVybiBhd2FpdCBvcGVyYXRpb24uZXhlY3V0ZShzZXJ2ZXIsIHNlc3Npb24pO1xuICAgIH1cbiAgICBjYXRjaCAob3BlcmF0aW9uRXJyb3IpIHtcbiAgICAgICAgaWYgKHdpbGxSZXRyeSAmJiBvcGVyYXRpb25FcnJvciBpbnN0YW5jZW9mIGVycm9yXzEuTW9uZ29FcnJvcikge1xuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHJldHJ5T3BlcmF0aW9uKG9wZXJhdGlvbiwgb3BlcmF0aW9uRXJyb3IsIHtcbiAgICAgICAgICAgICAgICBzZXNzaW9uLFxuICAgICAgICAgICAgICAgIHRvcG9sb2d5LFxuICAgICAgICAgICAgICAgIHNlbGVjdG9yXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICB0aHJvdyBvcGVyYXRpb25FcnJvcjtcbiAgICB9XG4gICAgZmluYWxseSB7XG4gICAgICAgIGlmIChzZXNzaW9uPy5vd25lciAhPSBudWxsICYmIHNlc3Npb24ub3duZXIgPT09IG93bmVyKSB7XG4gICAgICAgICAgICBhd2FpdCBzZXNzaW9uLmVuZFNlc3Npb24oKS5jYXRjaCgoKSA9PiBudWxsKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbmFzeW5jIGZ1bmN0aW9uIHJldHJ5T3BlcmF0aW9uKG9wZXJhdGlvbiwgb3JpZ2luYWxFcnJvciwgeyBzZXNzaW9uLCB0b3BvbG9neSwgc2VsZWN0b3IgfSkge1xuICAgIGNvbnN0IGlzV3JpdGVPcGVyYXRpb24gPSBvcGVyYXRpb24uaGFzQXNwZWN0KG9wZXJhdGlvbl8xLkFzcGVjdC5XUklURV9PUEVSQVRJT04pO1xuICAgIGNvbnN0IGlzUmVhZE9wZXJhdGlvbiA9IG9wZXJhdGlvbi5oYXNBc3BlY3Qob3BlcmF0aW9uXzEuQXNwZWN0LlJFQURfT1BFUkFUSU9OKTtcbiAgICBpZiAoaXNXcml0ZU9wZXJhdGlvbiAmJiBvcmlnaW5hbEVycm9yLmNvZGUgPT09IE1NQVB2MV9SRVRSWV9XUklURVNfRVJST1JfQ09ERSkge1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1NlcnZlckVycm9yKHtcbiAgICAgICAgICAgIG1lc3NhZ2U6IE1NQVB2MV9SRVRSWV9XUklURVNfRVJST1JfTUVTU0FHRSxcbiAgICAgICAgICAgIGVycm1zZzogTU1BUHYxX1JFVFJZX1dSSVRFU19FUlJPUl9NRVNTQUdFLFxuICAgICAgICAgICAgb3JpZ2luYWxFcnJvclxuICAgICAgICB9KTtcbiAgICB9XG4gICAgaWYgKGlzV3JpdGVPcGVyYXRpb24gJiYgISgwLCBlcnJvcl8xLmlzUmV0cnlhYmxlV3JpdGVFcnJvcikob3JpZ2luYWxFcnJvcikpIHtcbiAgICAgICAgdGhyb3cgb3JpZ2luYWxFcnJvcjtcbiAgICB9XG4gICAgaWYgKGlzUmVhZE9wZXJhdGlvbiAmJiAhKDAsIGVycm9yXzEuaXNSZXRyeWFibGVSZWFkRXJyb3IpKG9yaWdpbmFsRXJyb3IpKSB7XG4gICAgICAgIHRocm93IG9yaWdpbmFsRXJyb3I7XG4gICAgfVxuICAgIGlmIChvcmlnaW5hbEVycm9yIGluc3RhbmNlb2YgZXJyb3JfMS5Nb25nb05ldHdvcmtFcnJvciAmJlxuICAgICAgICBzZXNzaW9uLmlzUGlubmVkICYmXG4gICAgICAgICFzZXNzaW9uLmluVHJhbnNhY3Rpb24oKSAmJlxuICAgICAgICBvcGVyYXRpb24uaGFzQXNwZWN0KG9wZXJhdGlvbl8xLkFzcGVjdC5DVVJTT1JfQ1JFQVRJTkcpKSB7XG4gICAgICAgIC8vIElmIHdlIGhhdmUgYSBjdXJzb3IgYW5kIHRoZSBpbml0aWFsIGNvbW1hbmQgZmFpbHMgd2l0aCBhIG5ldHdvcmsgZXJyb3IsXG4gICAgICAgIC8vIHdlIGNhbiByZXRyeSBpdCBvbiBhbm90aGVyIGNvbm5lY3Rpb24uIFNvIHdlIG5lZWQgdG8gY2hlY2sgaXQgYmFjayBpbiwgY2xlYXIgdGhlXG4gICAgICAgIC8vIHBvb2wgZm9yIHRoZSBzZXJ2aWNlIGlkLCBhbmQgcmV0cnkgYWdhaW4uXG4gICAgICAgIHNlc3Npb24udW5waW4oeyBmb3JjZTogdHJ1ZSwgZm9yY2VDbGVhcjogdHJ1ZSB9KTtcbiAgICB9XG4gICAgLy8gc2VsZWN0IGEgbmV3IHNlcnZlciwgYW5kIGF0dGVtcHQgdG8gcmV0cnkgdGhlIG9wZXJhdGlvblxuICAgIGNvbnN0IHNlcnZlciA9IGF3YWl0IHRvcG9sb2d5LnNlbGVjdFNlcnZlckFzeW5jKHNlbGVjdG9yLCB7IHNlc3Npb24gfSk7XG4gICAgaWYgKGlzV3JpdGVPcGVyYXRpb24gJiYgISgwLCB1dGlsc18xLnN1cHBvcnRzUmV0cnlhYmxlV3JpdGVzKShzZXJ2ZXIpKSB7XG4gICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvVW5leHBlY3RlZFNlcnZlclJlc3BvbnNlRXJyb3IoJ1NlbGVjdGVkIHNlcnZlciBkb2VzIG5vdCBzdXBwb3J0IHJldHJ5YWJsZSB3cml0ZXMnKTtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgICAgcmV0dXJuIGF3YWl0IG9wZXJhdGlvbi5leGVjdXRlKHNlcnZlciwgc2Vzc2lvbik7XG4gICAgfVxuICAgIGNhdGNoIChyZXRyeUVycm9yKSB7XG4gICAgICAgIGlmIChyZXRyeUVycm9yIGluc3RhbmNlb2YgZXJyb3JfMS5Nb25nb0Vycm9yICYmXG4gICAgICAgICAgICByZXRyeUVycm9yLmhhc0Vycm9yTGFiZWwoZXJyb3JfMS5Nb25nb0Vycm9yTGFiZWwuTm9Xcml0ZXNQZXJmb3JtZWQpKSB7XG4gICAgICAgICAgICB0aHJvdyBvcmlnaW5hbEVycm9yO1xuICAgICAgICB9XG4gICAgICAgIHRocm93IHJldHJ5RXJyb3I7XG4gICAgfVxufVxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZXhlY3V0ZV9vcGVyYXRpb24uanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/operations/execute_operation.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/operations/find.js":
/*!*************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/operations/find.js ***!
  \*************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.FindOperation = void 0;\nconst error_1 = __webpack_require__(/*! ../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst read_concern_1 = __webpack_require__(/*! ../read_concern */ \"(api)/../server/node_modules/mongodb/lib/read_concern.js\");\nconst sort_1 = __webpack_require__(/*! ../sort */ \"(api)/../server/node_modules/mongodb/lib/sort.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\nconst command_1 = __webpack_require__(/*! ./command */ \"(api)/../server/node_modules/mongodb/lib/operations/command.js\");\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(api)/../server/node_modules/mongodb/lib/operations/operation.js\");\n/** @internal */\nclass FindOperation extends command_1.CommandCallbackOperation {\n    constructor(collection, ns, filter = {}, options = {}) {\n        super(collection, options);\n        this.options = { ...options };\n        delete this.options.writeConcern;\n        this.ns = ns;\n        if (typeof filter !== 'object' || Array.isArray(filter)) {\n            throw new error_1.MongoInvalidArgumentError('Query filter must be a plain object or ObjectId');\n        }\n        // special case passing in an ObjectId as a filter\n        this.filter = filter != null && filter._bsontype === 'ObjectId' ? { _id: filter } : filter;\n    }\n    executeCallback(server, session, callback) {\n        this.server = server;\n        const options = this.options;\n        let findCommand = makeFindCommand(this.ns, this.filter, options);\n        if (this.explain) {\n            findCommand = (0, utils_1.decorateWithExplain)(findCommand, this.explain);\n        }\n        server.command(this.ns, findCommand, {\n            ...this.options,\n            ...this.bsonOptions,\n            documentsReturnedIn: 'firstBatch',\n            session\n        }, callback);\n    }\n}\nexports.FindOperation = FindOperation;\nfunction makeFindCommand(ns, filter, options) {\n    const findCommand = {\n        find: ns.collection,\n        filter\n    };\n    if (options.sort) {\n        findCommand.sort = (0, sort_1.formatSort)(options.sort);\n    }\n    if (options.projection) {\n        let projection = options.projection;\n        if (projection && Array.isArray(projection)) {\n            projection = projection.length\n                ? projection.reduce((result, field) => {\n                    result[field] = 1;\n                    return result;\n                }, {})\n                : { _id: 1 };\n        }\n        findCommand.projection = projection;\n    }\n    if (options.hint) {\n        findCommand.hint = (0, utils_1.normalizeHintField)(options.hint);\n    }\n    if (typeof options.skip === 'number') {\n        findCommand.skip = options.skip;\n    }\n    if (typeof options.limit === 'number') {\n        if (options.limit < 0) {\n            findCommand.limit = -options.limit;\n            findCommand.singleBatch = true;\n        }\n        else {\n            findCommand.limit = options.limit;\n        }\n    }\n    if (typeof options.batchSize === 'number') {\n        if (options.batchSize < 0) {\n            if (options.limit &&\n                options.limit !== 0 &&\n                Math.abs(options.batchSize) < Math.abs(options.limit)) {\n                findCommand.limit = -options.batchSize;\n            }\n            findCommand.singleBatch = true;\n        }\n        else {\n            findCommand.batchSize = options.batchSize;\n        }\n    }\n    if (typeof options.singleBatch === 'boolean') {\n        findCommand.singleBatch = options.singleBatch;\n    }\n    // we check for undefined specifically here to allow falsy values\n    // eslint-disable-next-line no-restricted-syntax\n    if (options.comment !== undefined) {\n        findCommand.comment = options.comment;\n    }\n    if (typeof options.maxTimeMS === 'number') {\n        findCommand.maxTimeMS = options.maxTimeMS;\n    }\n    const readConcern = read_concern_1.ReadConcern.fromOptions(options);\n    if (readConcern) {\n        findCommand.readConcern = readConcern.toJSON();\n    }\n    if (options.max) {\n        findCommand.max = options.max;\n    }\n    if (options.min) {\n        findCommand.min = options.min;\n    }\n    if (typeof options.returnKey === 'boolean') {\n        findCommand.returnKey = options.returnKey;\n    }\n    if (typeof options.showRecordId === 'boolean') {\n        findCommand.showRecordId = options.showRecordId;\n    }\n    if (typeof options.tailable === 'boolean') {\n        findCommand.tailable = options.tailable;\n    }\n    if (typeof options.oplogReplay === 'boolean') {\n        findCommand.oplogReplay = options.oplogReplay;\n    }\n    if (typeof options.timeout === 'boolean') {\n        findCommand.noCursorTimeout = !options.timeout;\n    }\n    else if (typeof options.noCursorTimeout === 'boolean') {\n        findCommand.noCursorTimeout = options.noCursorTimeout;\n    }\n    if (typeof options.awaitData === 'boolean') {\n        findCommand.awaitData = options.awaitData;\n    }\n    if (typeof options.allowPartialResults === 'boolean') {\n        findCommand.allowPartialResults = options.allowPartialResults;\n    }\n    if (options.collation) {\n        findCommand.collation = options.collation;\n    }\n    if (typeof options.allowDiskUse === 'boolean') {\n        findCommand.allowDiskUse = options.allowDiskUse;\n    }\n    if (options.let) {\n        findCommand.let = options.let;\n    }\n    return findCommand;\n}\n(0, operation_1.defineAspects)(FindOperation, [\n    operation_1.Aspect.READ_OPERATION,\n    operation_1.Aspect.RETRYABLE,\n    operation_1.Aspect.EXPLAINABLE,\n    operation_1.Aspect.CURSOR_CREATING\n]);\n//# sourceMappingURL=find.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL2ZpbmQuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QscUJBQXFCO0FBQ3JCLGdCQUFnQixtQkFBTyxDQUFDLG1FQUFVO0FBQ2xDLHVCQUF1QixtQkFBTyxDQUFDLGlGQUFpQjtBQUNoRCxlQUFlLG1CQUFPLENBQUMsaUVBQVM7QUFDaEMsZ0JBQWdCLG1CQUFPLENBQUMsbUVBQVU7QUFDbEMsa0JBQWtCLG1CQUFPLENBQUMsaUZBQVc7QUFDckMsb0JBQW9CLG1CQUFPLENBQUMscUZBQWE7QUFDekM7QUFDQTtBQUNBLDJDQUEyQyxjQUFjO0FBQ3pEO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRFQUE0RSxjQUFjO0FBQzFGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCLElBQUk7QUFDckIsb0JBQW9CO0FBQ3BCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJEOlxcc2Fsb25pXFxhcHByYWlzYWwtc3lzdGVtXFxzZXJ2ZXJcXG5vZGVfbW9kdWxlc1xcbW9uZ29kYlxcbGliXFxvcGVyYXRpb25zXFxmaW5kLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5GaW5kT3BlcmF0aW9uID0gdm9pZCAwO1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuLi9lcnJvclwiKTtcbmNvbnN0IHJlYWRfY29uY2Vybl8xID0gcmVxdWlyZShcIi4uL3JlYWRfY29uY2VyblwiKTtcbmNvbnN0IHNvcnRfMSA9IHJlcXVpcmUoXCIuLi9zb3J0XCIpO1xuY29uc3QgdXRpbHNfMSA9IHJlcXVpcmUoXCIuLi91dGlsc1wiKTtcbmNvbnN0IGNvbW1hbmRfMSA9IHJlcXVpcmUoXCIuL2NvbW1hbmRcIik7XG5jb25zdCBvcGVyYXRpb25fMSA9IHJlcXVpcmUoXCIuL29wZXJhdGlvblwiKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIEZpbmRPcGVyYXRpb24gZXh0ZW5kcyBjb21tYW5kXzEuQ29tbWFuZENhbGxiYWNrT3BlcmF0aW9uIHtcbiAgICBjb25zdHJ1Y3Rvcihjb2xsZWN0aW9uLCBucywgZmlsdGVyID0ge30sIG9wdGlvbnMgPSB7fSkge1xuICAgICAgICBzdXBlcihjb2xsZWN0aW9uLCBvcHRpb25zKTtcbiAgICAgICAgdGhpcy5vcHRpb25zID0geyAuLi5vcHRpb25zIH07XG4gICAgICAgIGRlbGV0ZSB0aGlzLm9wdGlvbnMud3JpdGVDb25jZXJuO1xuICAgICAgICB0aGlzLm5zID0gbnM7XG4gICAgICAgIGlmICh0eXBlb2YgZmlsdGVyICE9PSAnb2JqZWN0JyB8fCBBcnJheS5pc0FycmF5KGZpbHRlcikpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoJ1F1ZXJ5IGZpbHRlciBtdXN0IGJlIGEgcGxhaW4gb2JqZWN0IG9yIE9iamVjdElkJyk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gc3BlY2lhbCBjYXNlIHBhc3NpbmcgaW4gYW4gT2JqZWN0SWQgYXMgYSBmaWx0ZXJcbiAgICAgICAgdGhpcy5maWx0ZXIgPSBmaWx0ZXIgIT0gbnVsbCAmJiBmaWx0ZXIuX2Jzb250eXBlID09PSAnT2JqZWN0SWQnID8geyBfaWQ6IGZpbHRlciB9IDogZmlsdGVyO1xuICAgIH1cbiAgICBleGVjdXRlQ2FsbGJhY2soc2VydmVyLCBzZXNzaW9uLCBjYWxsYmFjaykge1xuICAgICAgICB0aGlzLnNlcnZlciA9IHNlcnZlcjtcbiAgICAgICAgY29uc3Qgb3B0aW9ucyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgbGV0IGZpbmRDb21tYW5kID0gbWFrZUZpbmRDb21tYW5kKHRoaXMubnMsIHRoaXMuZmlsdGVyLCBvcHRpb25zKTtcbiAgICAgICAgaWYgKHRoaXMuZXhwbGFpbikge1xuICAgICAgICAgICAgZmluZENvbW1hbmQgPSAoMCwgdXRpbHNfMS5kZWNvcmF0ZVdpdGhFeHBsYWluKShmaW5kQ29tbWFuZCwgdGhpcy5leHBsYWluKTtcbiAgICAgICAgfVxuICAgICAgICBzZXJ2ZXIuY29tbWFuZCh0aGlzLm5zLCBmaW5kQ29tbWFuZCwge1xuICAgICAgICAgICAgLi4udGhpcy5vcHRpb25zLFxuICAgICAgICAgICAgLi4udGhpcy5ic29uT3B0aW9ucyxcbiAgICAgICAgICAgIGRvY3VtZW50c1JldHVybmVkSW46ICdmaXJzdEJhdGNoJyxcbiAgICAgICAgICAgIHNlc3Npb25cbiAgICAgICAgfSwgY2FsbGJhY2spO1xuICAgIH1cbn1cbmV4cG9ydHMuRmluZE9wZXJhdGlvbiA9IEZpbmRPcGVyYXRpb247XG5mdW5jdGlvbiBtYWtlRmluZENvbW1hbmQobnMsIGZpbHRlciwgb3B0aW9ucykge1xuICAgIGNvbnN0IGZpbmRDb21tYW5kID0ge1xuICAgICAgICBmaW5kOiBucy5jb2xsZWN0aW9uLFxuICAgICAgICBmaWx0ZXJcbiAgICB9O1xuICAgIGlmIChvcHRpb25zLnNvcnQpIHtcbiAgICAgICAgZmluZENvbW1hbmQuc29ydCA9ICgwLCBzb3J0XzEuZm9ybWF0U29ydCkob3B0aW9ucy5zb3J0KTtcbiAgICB9XG4gICAgaWYgKG9wdGlvbnMucHJvamVjdGlvbikge1xuICAgICAgICBsZXQgcHJvamVjdGlvbiA9IG9wdGlvbnMucHJvamVjdGlvbjtcbiAgICAgICAgaWYgKHByb2plY3Rpb24gJiYgQXJyYXkuaXNBcnJheShwcm9qZWN0aW9uKSkge1xuICAgICAgICAgICAgcHJvamVjdGlvbiA9IHByb2plY3Rpb24ubGVuZ3RoXG4gICAgICAgICAgICAgICAgPyBwcm9qZWN0aW9uLnJlZHVjZSgocmVzdWx0LCBmaWVsZCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHRbZmllbGRdID0gMTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgICAgICAgICB9LCB7fSlcbiAgICAgICAgICAgICAgICA6IHsgX2lkOiAxIH07XG4gICAgICAgIH1cbiAgICAgICAgZmluZENvbW1hbmQucHJvamVjdGlvbiA9IHByb2plY3Rpb247XG4gICAgfVxuICAgIGlmIChvcHRpb25zLmhpbnQpIHtcbiAgICAgICAgZmluZENvbW1hbmQuaGludCA9ICgwLCB1dGlsc18xLm5vcm1hbGl6ZUhpbnRGaWVsZCkob3B0aW9ucy5oaW50KTtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBvcHRpb25zLnNraXAgPT09ICdudW1iZXInKSB7XG4gICAgICAgIGZpbmRDb21tYW5kLnNraXAgPSBvcHRpb25zLnNraXA7XG4gICAgfVxuICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5saW1pdCA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgaWYgKG9wdGlvbnMubGltaXQgPCAwKSB7XG4gICAgICAgICAgICBmaW5kQ29tbWFuZC5saW1pdCA9IC1vcHRpb25zLmxpbWl0O1xuICAgICAgICAgICAgZmluZENvbW1hbmQuc2luZ2xlQmF0Y2ggPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZmluZENvbW1hbmQubGltaXQgPSBvcHRpb25zLmxpbWl0O1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5iYXRjaFNpemUgPT09ICdudW1iZXInKSB7XG4gICAgICAgIGlmIChvcHRpb25zLmJhdGNoU2l6ZSA8IDApIHtcbiAgICAgICAgICAgIGlmIChvcHRpb25zLmxpbWl0ICYmXG4gICAgICAgICAgICAgICAgb3B0aW9ucy5saW1pdCAhPT0gMCAmJlxuICAgICAgICAgICAgICAgIE1hdGguYWJzKG9wdGlvbnMuYmF0Y2hTaXplKSA8IE1hdGguYWJzKG9wdGlvbnMubGltaXQpKSB7XG4gICAgICAgICAgICAgICAgZmluZENvbW1hbmQubGltaXQgPSAtb3B0aW9ucy5iYXRjaFNpemU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmaW5kQ29tbWFuZC5zaW5nbGVCYXRjaCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBmaW5kQ29tbWFuZC5iYXRjaFNpemUgPSBvcHRpb25zLmJhdGNoU2l6ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAodHlwZW9mIG9wdGlvbnMuc2luZ2xlQmF0Y2ggPT09ICdib29sZWFuJykge1xuICAgICAgICBmaW5kQ29tbWFuZC5zaW5nbGVCYXRjaCA9IG9wdGlvbnMuc2luZ2xlQmF0Y2g7XG4gICAgfVxuICAgIC8vIHdlIGNoZWNrIGZvciB1bmRlZmluZWQgc3BlY2lmaWNhbGx5IGhlcmUgdG8gYWxsb3cgZmFsc3kgdmFsdWVzXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXJlc3RyaWN0ZWQtc3ludGF4XG4gICAgaWYgKG9wdGlvbnMuY29tbWVudCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGZpbmRDb21tYW5kLmNvbW1lbnQgPSBvcHRpb25zLmNvbW1lbnQ7XG4gICAgfVxuICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5tYXhUaW1lTVMgPT09ICdudW1iZXInKSB7XG4gICAgICAgIGZpbmRDb21tYW5kLm1heFRpbWVNUyA9IG9wdGlvbnMubWF4VGltZU1TO1xuICAgIH1cbiAgICBjb25zdCByZWFkQ29uY2VybiA9IHJlYWRfY29uY2Vybl8xLlJlYWRDb25jZXJuLmZyb21PcHRpb25zKG9wdGlvbnMpO1xuICAgIGlmIChyZWFkQ29uY2Vybikge1xuICAgICAgICBmaW5kQ29tbWFuZC5yZWFkQ29uY2VybiA9IHJlYWRDb25jZXJuLnRvSlNPTigpO1xuICAgIH1cbiAgICBpZiAob3B0aW9ucy5tYXgpIHtcbiAgICAgICAgZmluZENvbW1hbmQubWF4ID0gb3B0aW9ucy5tYXg7XG4gICAgfVxuICAgIGlmIChvcHRpb25zLm1pbikge1xuICAgICAgICBmaW5kQ29tbWFuZC5taW4gPSBvcHRpb25zLm1pbjtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBvcHRpb25zLnJldHVybktleSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgIGZpbmRDb21tYW5kLnJldHVybktleSA9IG9wdGlvbnMucmV0dXJuS2V5O1xuICAgIH1cbiAgICBpZiAodHlwZW9mIG9wdGlvbnMuc2hvd1JlY29yZElkID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgZmluZENvbW1hbmQuc2hvd1JlY29yZElkID0gb3B0aW9ucy5zaG93UmVjb3JkSWQ7XG4gICAgfVxuICAgIGlmICh0eXBlb2Ygb3B0aW9ucy50YWlsYWJsZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgIGZpbmRDb21tYW5kLnRhaWxhYmxlID0gb3B0aW9ucy50YWlsYWJsZTtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBvcHRpb25zLm9wbG9nUmVwbGF5ID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgZmluZENvbW1hbmQub3Bsb2dSZXBsYXkgPSBvcHRpb25zLm9wbG9nUmVwbGF5O1xuICAgIH1cbiAgICBpZiAodHlwZW9mIG9wdGlvbnMudGltZW91dCA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgIGZpbmRDb21tYW5kLm5vQ3Vyc29yVGltZW91dCA9ICFvcHRpb25zLnRpbWVvdXQ7XG4gICAgfVxuICAgIGVsc2UgaWYgKHR5cGVvZiBvcHRpb25zLm5vQ3Vyc29yVGltZW91dCA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgIGZpbmRDb21tYW5kLm5vQ3Vyc29yVGltZW91dCA9IG9wdGlvbnMubm9DdXJzb3JUaW1lb3V0O1xuICAgIH1cbiAgICBpZiAodHlwZW9mIG9wdGlvbnMuYXdhaXREYXRhID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgZmluZENvbW1hbmQuYXdhaXREYXRhID0gb3B0aW9ucy5hd2FpdERhdGE7XG4gICAgfVxuICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5hbGxvd1BhcnRpYWxSZXN1bHRzID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgZmluZENvbW1hbmQuYWxsb3dQYXJ0aWFsUmVzdWx0cyA9IG9wdGlvbnMuYWxsb3dQYXJ0aWFsUmVzdWx0cztcbiAgICB9XG4gICAgaWYgKG9wdGlvbnMuY29sbGF0aW9uKSB7XG4gICAgICAgIGZpbmRDb21tYW5kLmNvbGxhdGlvbiA9IG9wdGlvbnMuY29sbGF0aW9uO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIG9wdGlvbnMuYWxsb3dEaXNrVXNlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgZmluZENvbW1hbmQuYWxsb3dEaXNrVXNlID0gb3B0aW9ucy5hbGxvd0Rpc2tVc2U7XG4gICAgfVxuICAgIGlmIChvcHRpb25zLmxldCkge1xuICAgICAgICBmaW5kQ29tbWFuZC5sZXQgPSBvcHRpb25zLmxldDtcbiAgICB9XG4gICAgcmV0dXJuIGZpbmRDb21tYW5kO1xufVxuKDAsIG9wZXJhdGlvbl8xLmRlZmluZUFzcGVjdHMpKEZpbmRPcGVyYXRpb24sIFtcbiAgICBvcGVyYXRpb25fMS5Bc3BlY3QuUkVBRF9PUEVSQVRJT04sXG4gICAgb3BlcmF0aW9uXzEuQXNwZWN0LlJFVFJZQUJMRSxcbiAgICBvcGVyYXRpb25fMS5Bc3BlY3QuRVhQTEFJTkFCTEUsXG4gICAgb3BlcmF0aW9uXzEuQXNwZWN0LkNVUlNPUl9DUkVBVElOR1xuXSk7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1maW5kLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/operations/find.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/operations/find_and_modify.js":
/*!************************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/operations/find_and_modify.js ***!
  \************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.FindOneAndUpdateOperation = exports.FindOneAndReplaceOperation = exports.FindOneAndDeleteOperation = exports.ReturnDocument = void 0;\nconst error_1 = __webpack_require__(/*! ../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst read_preference_1 = __webpack_require__(/*! ../read_preference */ \"(api)/../server/node_modules/mongodb/lib/read_preference.js\");\nconst sort_1 = __webpack_require__(/*! ../sort */ \"(api)/../server/node_modules/mongodb/lib/sort.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\nconst command_1 = __webpack_require__(/*! ./command */ \"(api)/../server/node_modules/mongodb/lib/operations/command.js\");\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(api)/../server/node_modules/mongodb/lib/operations/operation.js\");\n/** @public */\nexports.ReturnDocument = Object.freeze({\n    BEFORE: 'before',\n    AFTER: 'after'\n});\nfunction configureFindAndModifyCmdBaseUpdateOpts(cmdBase, options) {\n    cmdBase.new = options.returnDocument === exports.ReturnDocument.AFTER;\n    cmdBase.upsert = options.upsert === true;\n    if (options.bypassDocumentValidation === true) {\n        cmdBase.bypassDocumentValidation = options.bypassDocumentValidation;\n    }\n    return cmdBase;\n}\n/** @internal */\nclass FindAndModifyOperation extends command_1.CommandCallbackOperation {\n    constructor(collection, query, options) {\n        super(collection, options);\n        this.options = options ?? {};\n        this.cmdBase = {\n            remove: false,\n            new: false,\n            upsert: false\n        };\n        options.includeResultMetadata ?? (options.includeResultMetadata = true);\n        const sort = (0, sort_1.formatSort)(options.sort);\n        if (sort) {\n            this.cmdBase.sort = sort;\n        }\n        if (options.projection) {\n            this.cmdBase.fields = options.projection;\n        }\n        if (options.maxTimeMS) {\n            this.cmdBase.maxTimeMS = options.maxTimeMS;\n        }\n        // Decorate the findAndModify command with the write Concern\n        if (options.writeConcern) {\n            this.cmdBase.writeConcern = options.writeConcern;\n        }\n        if (options.let) {\n            this.cmdBase.let = options.let;\n        }\n        // we check for undefined specifically here to allow falsy values\n        // eslint-disable-next-line no-restricted-syntax\n        if (options.comment !== undefined) {\n            this.cmdBase.comment = options.comment;\n        }\n        // force primary read preference\n        this.readPreference = read_preference_1.ReadPreference.primary;\n        this.collection = collection;\n        this.query = query;\n    }\n    executeCallback(server, session, callback) {\n        const coll = this.collection;\n        const query = this.query;\n        const options = { ...this.options, ...this.bsonOptions };\n        // Create findAndModify command object\n        const cmd = {\n            findAndModify: coll.collectionName,\n            query: query,\n            ...this.cmdBase\n        };\n        // Have we specified collation\n        try {\n            (0, utils_1.decorateWithCollation)(cmd, coll, options);\n        }\n        catch (err) {\n            return callback(err);\n        }\n        if (options.hint) {\n            // TODO: once this method becomes a CommandOperation we will have the server\n            // in place to check.\n            const unacknowledgedWrite = this.writeConcern?.w === 0;\n            if (unacknowledgedWrite || (0, utils_1.maxWireVersion)(server) < 8) {\n                callback(new error_1.MongoCompatibilityError('The current topology does not support a hint on findAndModify commands'));\n                return;\n            }\n            cmd.hint = options.hint;\n        }\n        // Execute the command\n        super.executeCommandCallback(server, session, cmd, (err, result) => {\n            if (err)\n                return callback(err);\n            return callback(undefined, options.includeResultMetadata ? result : result.value ?? null);\n        });\n    }\n}\n/** @internal */\nclass FindOneAndDeleteOperation extends FindAndModifyOperation {\n    constructor(collection, filter, options) {\n        // Basic validation\n        if (filter == null || typeof filter !== 'object') {\n            throw new error_1.MongoInvalidArgumentError('Argument \"filter\" must be an object');\n        }\n        super(collection, filter, options);\n        this.cmdBase.remove = true;\n    }\n}\nexports.FindOneAndDeleteOperation = FindOneAndDeleteOperation;\n/** @internal */\nclass FindOneAndReplaceOperation extends FindAndModifyOperation {\n    constructor(collection, filter, replacement, options) {\n        if (filter == null || typeof filter !== 'object') {\n            throw new error_1.MongoInvalidArgumentError('Argument \"filter\" must be an object');\n        }\n        if (replacement == null || typeof replacement !== 'object') {\n            throw new error_1.MongoInvalidArgumentError('Argument \"replacement\" must be an object');\n        }\n        if ((0, utils_1.hasAtomicOperators)(replacement)) {\n            throw new error_1.MongoInvalidArgumentError('Replacement document must not contain atomic operators');\n        }\n        super(collection, filter, options);\n        this.cmdBase.update = replacement;\n        configureFindAndModifyCmdBaseUpdateOpts(this.cmdBase, options);\n    }\n}\nexports.FindOneAndReplaceOperation = FindOneAndReplaceOperation;\n/** @internal */\nclass FindOneAndUpdateOperation extends FindAndModifyOperation {\n    constructor(collection, filter, update, options) {\n        if (filter == null || typeof filter !== 'object') {\n            throw new error_1.MongoInvalidArgumentError('Argument \"filter\" must be an object');\n        }\n        if (update == null || typeof update !== 'object') {\n            throw new error_1.MongoInvalidArgumentError('Argument \"update\" must be an object');\n        }\n        if (!(0, utils_1.hasAtomicOperators)(update)) {\n            throw new error_1.MongoInvalidArgumentError('Update document requires atomic operators');\n        }\n        super(collection, filter, options);\n        this.cmdBase.update = update;\n        configureFindAndModifyCmdBaseUpdateOpts(this.cmdBase, options);\n        if (options.arrayFilters) {\n            this.cmdBase.arrayFilters = options.arrayFilters;\n        }\n    }\n}\nexports.FindOneAndUpdateOperation = FindOneAndUpdateOperation;\n(0, operation_1.defineAspects)(FindAndModifyOperation, [\n    operation_1.Aspect.WRITE_OPERATION,\n    operation_1.Aspect.RETRYABLE,\n    operation_1.Aspect.EXPLAINABLE\n]);\n//# sourceMappingURL=find_and_modify.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL2ZpbmRfYW5kX21vZGlmeS5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxpQ0FBaUMsR0FBRyxrQ0FBa0MsR0FBRyxpQ0FBaUMsR0FBRyxzQkFBc0I7QUFDbkksZ0JBQWdCLG1CQUFPLENBQUMsbUVBQVU7QUFDbEMsMEJBQTBCLG1CQUFPLENBQUMsdUZBQW9CO0FBQ3RELGVBQWUsbUJBQU8sQ0FBQyxpRUFBUztBQUNoQyxnQkFBZ0IsbUJBQU8sQ0FBQyxtRUFBVTtBQUNsQyxrQkFBa0IsbUJBQU8sQ0FBQyxpRkFBVztBQUNyQyxvQkFBb0IsbUJBQU8sQ0FBQyxxRkFBYTtBQUN6QztBQUNBLHNCQUFzQjtBQUN0QjtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0M7QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQztBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIkQ6XFxzYWxvbmlcXGFwcHJhaXNhbC1zeXN0ZW1cXHNlcnZlclxcbm9kZV9tb2R1bGVzXFxtb25nb2RiXFxsaWJcXG9wZXJhdGlvbnNcXGZpbmRfYW5kX21vZGlmeS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuRmluZE9uZUFuZFVwZGF0ZU9wZXJhdGlvbiA9IGV4cG9ydHMuRmluZE9uZUFuZFJlcGxhY2VPcGVyYXRpb24gPSBleHBvcnRzLkZpbmRPbmVBbmREZWxldGVPcGVyYXRpb24gPSBleHBvcnRzLlJldHVybkRvY3VtZW50ID0gdm9pZCAwO1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuLi9lcnJvclwiKTtcbmNvbnN0IHJlYWRfcHJlZmVyZW5jZV8xID0gcmVxdWlyZShcIi4uL3JlYWRfcHJlZmVyZW5jZVwiKTtcbmNvbnN0IHNvcnRfMSA9IHJlcXVpcmUoXCIuLi9zb3J0XCIpO1xuY29uc3QgdXRpbHNfMSA9IHJlcXVpcmUoXCIuLi91dGlsc1wiKTtcbmNvbnN0IGNvbW1hbmRfMSA9IHJlcXVpcmUoXCIuL2NvbW1hbmRcIik7XG5jb25zdCBvcGVyYXRpb25fMSA9IHJlcXVpcmUoXCIuL29wZXJhdGlvblwiKTtcbi8qKiBAcHVibGljICovXG5leHBvcnRzLlJldHVybkRvY3VtZW50ID0gT2JqZWN0LmZyZWV6ZSh7XG4gICAgQkVGT1JFOiAnYmVmb3JlJyxcbiAgICBBRlRFUjogJ2FmdGVyJ1xufSk7XG5mdW5jdGlvbiBjb25maWd1cmVGaW5kQW5kTW9kaWZ5Q21kQmFzZVVwZGF0ZU9wdHMoY21kQmFzZSwgb3B0aW9ucykge1xuICAgIGNtZEJhc2UubmV3ID0gb3B0aW9ucy5yZXR1cm5Eb2N1bWVudCA9PT0gZXhwb3J0cy5SZXR1cm5Eb2N1bWVudC5BRlRFUjtcbiAgICBjbWRCYXNlLnVwc2VydCA9IG9wdGlvbnMudXBzZXJ0ID09PSB0cnVlO1xuICAgIGlmIChvcHRpb25zLmJ5cGFzc0RvY3VtZW50VmFsaWRhdGlvbiA9PT0gdHJ1ZSkge1xuICAgICAgICBjbWRCYXNlLmJ5cGFzc0RvY3VtZW50VmFsaWRhdGlvbiA9IG9wdGlvbnMuYnlwYXNzRG9jdW1lbnRWYWxpZGF0aW9uO1xuICAgIH1cbiAgICByZXR1cm4gY21kQmFzZTtcbn1cbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIEZpbmRBbmRNb2RpZnlPcGVyYXRpb24gZXh0ZW5kcyBjb21tYW5kXzEuQ29tbWFuZENhbGxiYWNrT3BlcmF0aW9uIHtcbiAgICBjb25zdHJ1Y3Rvcihjb2xsZWN0aW9uLCBxdWVyeSwgb3B0aW9ucykge1xuICAgICAgICBzdXBlcihjb2xsZWN0aW9uLCBvcHRpb25zKTtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucyA/PyB7fTtcbiAgICAgICAgdGhpcy5jbWRCYXNlID0ge1xuICAgICAgICAgICAgcmVtb3ZlOiBmYWxzZSxcbiAgICAgICAgICAgIG5ldzogZmFsc2UsXG4gICAgICAgICAgICB1cHNlcnQ6IGZhbHNlXG4gICAgICAgIH07XG4gICAgICAgIG9wdGlvbnMuaW5jbHVkZVJlc3VsdE1ldGFkYXRhID8/IChvcHRpb25zLmluY2x1ZGVSZXN1bHRNZXRhZGF0YSA9IHRydWUpO1xuICAgICAgICBjb25zdCBzb3J0ID0gKDAsIHNvcnRfMS5mb3JtYXRTb3J0KShvcHRpb25zLnNvcnQpO1xuICAgICAgICBpZiAoc29ydCkge1xuICAgICAgICAgICAgdGhpcy5jbWRCYXNlLnNvcnQgPSBzb3J0O1xuICAgICAgICB9XG4gICAgICAgIGlmIChvcHRpb25zLnByb2plY3Rpb24pIHtcbiAgICAgICAgICAgIHRoaXMuY21kQmFzZS5maWVsZHMgPSBvcHRpb25zLnByb2plY3Rpb247XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9wdGlvbnMubWF4VGltZU1TKSB7XG4gICAgICAgICAgICB0aGlzLmNtZEJhc2UubWF4VGltZU1TID0gb3B0aW9ucy5tYXhUaW1lTVM7XG4gICAgICAgIH1cbiAgICAgICAgLy8gRGVjb3JhdGUgdGhlIGZpbmRBbmRNb2RpZnkgY29tbWFuZCB3aXRoIHRoZSB3cml0ZSBDb25jZXJuXG4gICAgICAgIGlmIChvcHRpb25zLndyaXRlQ29uY2Vybikge1xuICAgICAgICAgICAgdGhpcy5jbWRCYXNlLndyaXRlQ29uY2VybiA9IG9wdGlvbnMud3JpdGVDb25jZXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvcHRpb25zLmxldCkge1xuICAgICAgICAgICAgdGhpcy5jbWRCYXNlLmxldCA9IG9wdGlvbnMubGV0O1xuICAgICAgICB9XG4gICAgICAgIC8vIHdlIGNoZWNrIGZvciB1bmRlZmluZWQgc3BlY2lmaWNhbGx5IGhlcmUgdG8gYWxsb3cgZmFsc3kgdmFsdWVzXG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1yZXN0cmljdGVkLXN5bnRheFxuICAgICAgICBpZiAob3B0aW9ucy5jb21tZW50ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuY21kQmFzZS5jb21tZW50ID0gb3B0aW9ucy5jb21tZW50O1xuICAgICAgICB9XG4gICAgICAgIC8vIGZvcmNlIHByaW1hcnkgcmVhZCBwcmVmZXJlbmNlXG4gICAgICAgIHRoaXMucmVhZFByZWZlcmVuY2UgPSByZWFkX3ByZWZlcmVuY2VfMS5SZWFkUHJlZmVyZW5jZS5wcmltYXJ5O1xuICAgICAgICB0aGlzLmNvbGxlY3Rpb24gPSBjb2xsZWN0aW9uO1xuICAgICAgICB0aGlzLnF1ZXJ5ID0gcXVlcnk7XG4gICAgfVxuICAgIGV4ZWN1dGVDYWxsYmFjayhzZXJ2ZXIsIHNlc3Npb24sIGNhbGxiYWNrKSB7XG4gICAgICAgIGNvbnN0IGNvbGwgPSB0aGlzLmNvbGxlY3Rpb247XG4gICAgICAgIGNvbnN0IHF1ZXJ5ID0gdGhpcy5xdWVyeTtcbiAgICAgICAgY29uc3Qgb3B0aW9ucyA9IHsgLi4udGhpcy5vcHRpb25zLCAuLi50aGlzLmJzb25PcHRpb25zIH07XG4gICAgICAgIC8vIENyZWF0ZSBmaW5kQW5kTW9kaWZ5IGNvbW1hbmQgb2JqZWN0XG4gICAgICAgIGNvbnN0IGNtZCA9IHtcbiAgICAgICAgICAgIGZpbmRBbmRNb2RpZnk6IGNvbGwuY29sbGVjdGlvbk5hbWUsXG4gICAgICAgICAgICBxdWVyeTogcXVlcnksXG4gICAgICAgICAgICAuLi50aGlzLmNtZEJhc2VcbiAgICAgICAgfTtcbiAgICAgICAgLy8gSGF2ZSB3ZSBzcGVjaWZpZWQgY29sbGF0aW9uXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICAoMCwgdXRpbHNfMS5kZWNvcmF0ZVdpdGhDb2xsYXRpb24pKGNtZCwgY29sbCwgb3B0aW9ucyk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9wdGlvbnMuaGludCkge1xuICAgICAgICAgICAgLy8gVE9ETzogb25jZSB0aGlzIG1ldGhvZCBiZWNvbWVzIGEgQ29tbWFuZE9wZXJhdGlvbiB3ZSB3aWxsIGhhdmUgdGhlIHNlcnZlclxuICAgICAgICAgICAgLy8gaW4gcGxhY2UgdG8gY2hlY2suXG4gICAgICAgICAgICBjb25zdCB1bmFja25vd2xlZGdlZFdyaXRlID0gdGhpcy53cml0ZUNvbmNlcm4/LncgPT09IDA7XG4gICAgICAgICAgICBpZiAodW5hY2tub3dsZWRnZWRXcml0ZSB8fCAoMCwgdXRpbHNfMS5tYXhXaXJlVmVyc2lvbikoc2VydmVyKSA8IDgpIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhuZXcgZXJyb3JfMS5Nb25nb0NvbXBhdGliaWxpdHlFcnJvcignVGhlIGN1cnJlbnQgdG9wb2xvZ3kgZG9lcyBub3Qgc3VwcG9ydCBhIGhpbnQgb24gZmluZEFuZE1vZGlmeSBjb21tYW5kcycpKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjbWQuaGludCA9IG9wdGlvbnMuaGludDtcbiAgICAgICAgfVxuICAgICAgICAvLyBFeGVjdXRlIHRoZSBjb21tYW5kXG4gICAgICAgIHN1cGVyLmV4ZWN1dGVDb21tYW5kQ2FsbGJhY2soc2VydmVyLCBzZXNzaW9uLCBjbWQsIChlcnIsIHJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgaWYgKGVycilcbiAgICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayh1bmRlZmluZWQsIG9wdGlvbnMuaW5jbHVkZVJlc3VsdE1ldGFkYXRhID8gcmVzdWx0IDogcmVzdWx0LnZhbHVlID8/IG51bGwpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG4vKiogQGludGVybmFsICovXG5jbGFzcyBGaW5kT25lQW5kRGVsZXRlT3BlcmF0aW9uIGV4dGVuZHMgRmluZEFuZE1vZGlmeU9wZXJhdGlvbiB7XG4gICAgY29uc3RydWN0b3IoY29sbGVjdGlvbiwgZmlsdGVyLCBvcHRpb25zKSB7XG4gICAgICAgIC8vIEJhc2ljIHZhbGlkYXRpb25cbiAgICAgICAgaWYgKGZpbHRlciA9PSBudWxsIHx8IHR5cGVvZiBmaWx0ZXIgIT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdBcmd1bWVudCBcImZpbHRlclwiIG11c3QgYmUgYW4gb2JqZWN0Jyk7XG4gICAgICAgIH1cbiAgICAgICAgc3VwZXIoY29sbGVjdGlvbiwgZmlsdGVyLCBvcHRpb25zKTtcbiAgICAgICAgdGhpcy5jbWRCYXNlLnJlbW92ZSA9IHRydWU7XG4gICAgfVxufVxuZXhwb3J0cy5GaW5kT25lQW5kRGVsZXRlT3BlcmF0aW9uID0gRmluZE9uZUFuZERlbGV0ZU9wZXJhdGlvbjtcbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIEZpbmRPbmVBbmRSZXBsYWNlT3BlcmF0aW9uIGV4dGVuZHMgRmluZEFuZE1vZGlmeU9wZXJhdGlvbiB7XG4gICAgY29uc3RydWN0b3IoY29sbGVjdGlvbiwgZmlsdGVyLCByZXBsYWNlbWVudCwgb3B0aW9ucykge1xuICAgICAgICBpZiAoZmlsdGVyID09IG51bGwgfHwgdHlwZW9mIGZpbHRlciAhPT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoJ0FyZ3VtZW50IFwiZmlsdGVyXCIgbXVzdCBiZSBhbiBvYmplY3QnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocmVwbGFjZW1lbnQgPT0gbnVsbCB8fCB0eXBlb2YgcmVwbGFjZW1lbnQgIT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdBcmd1bWVudCBcInJlcGxhY2VtZW50XCIgbXVzdCBiZSBhbiBvYmplY3QnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoKDAsIHV0aWxzXzEuaGFzQXRvbWljT3BlcmF0b3JzKShyZXBsYWNlbWVudCkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoJ1JlcGxhY2VtZW50IGRvY3VtZW50IG11c3Qgbm90IGNvbnRhaW4gYXRvbWljIG9wZXJhdG9ycycpO1xuICAgICAgICB9XG4gICAgICAgIHN1cGVyKGNvbGxlY3Rpb24sIGZpbHRlciwgb3B0aW9ucyk7XG4gICAgICAgIHRoaXMuY21kQmFzZS51cGRhdGUgPSByZXBsYWNlbWVudDtcbiAgICAgICAgY29uZmlndXJlRmluZEFuZE1vZGlmeUNtZEJhc2VVcGRhdGVPcHRzKHRoaXMuY21kQmFzZSwgb3B0aW9ucyk7XG4gICAgfVxufVxuZXhwb3J0cy5GaW5kT25lQW5kUmVwbGFjZU9wZXJhdGlvbiA9IEZpbmRPbmVBbmRSZXBsYWNlT3BlcmF0aW9uO1xuLyoqIEBpbnRlcm5hbCAqL1xuY2xhc3MgRmluZE9uZUFuZFVwZGF0ZU9wZXJhdGlvbiBleHRlbmRzIEZpbmRBbmRNb2RpZnlPcGVyYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKGNvbGxlY3Rpb24sIGZpbHRlciwgdXBkYXRlLCBvcHRpb25zKSB7XG4gICAgICAgIGlmIChmaWx0ZXIgPT0gbnVsbCB8fCB0eXBlb2YgZmlsdGVyICE9PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignQXJndW1lbnQgXCJmaWx0ZXJcIiBtdXN0IGJlIGFuIG9iamVjdCcpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh1cGRhdGUgPT0gbnVsbCB8fCB0eXBlb2YgdXBkYXRlICE9PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignQXJndW1lbnQgXCJ1cGRhdGVcIiBtdXN0IGJlIGFuIG9iamVjdCcpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghKDAsIHV0aWxzXzEuaGFzQXRvbWljT3BlcmF0b3JzKSh1cGRhdGUpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdVcGRhdGUgZG9jdW1lbnQgcmVxdWlyZXMgYXRvbWljIG9wZXJhdG9ycycpO1xuICAgICAgICB9XG4gICAgICAgIHN1cGVyKGNvbGxlY3Rpb24sIGZpbHRlciwgb3B0aW9ucyk7XG4gICAgICAgIHRoaXMuY21kQmFzZS51cGRhdGUgPSB1cGRhdGU7XG4gICAgICAgIGNvbmZpZ3VyZUZpbmRBbmRNb2RpZnlDbWRCYXNlVXBkYXRlT3B0cyh0aGlzLmNtZEJhc2UsIG9wdGlvbnMpO1xuICAgICAgICBpZiAob3B0aW9ucy5hcnJheUZpbHRlcnMpIHtcbiAgICAgICAgICAgIHRoaXMuY21kQmFzZS5hcnJheUZpbHRlcnMgPSBvcHRpb25zLmFycmF5RmlsdGVycztcbiAgICAgICAgfVxuICAgIH1cbn1cbmV4cG9ydHMuRmluZE9uZUFuZFVwZGF0ZU9wZXJhdGlvbiA9IEZpbmRPbmVBbmRVcGRhdGVPcGVyYXRpb247XG4oMCwgb3BlcmF0aW9uXzEuZGVmaW5lQXNwZWN0cykoRmluZEFuZE1vZGlmeU9wZXJhdGlvbiwgW1xuICAgIG9wZXJhdGlvbl8xLkFzcGVjdC5XUklURV9PUEVSQVRJT04sXG4gICAgb3BlcmF0aW9uXzEuQXNwZWN0LlJFVFJZQUJMRSxcbiAgICBvcGVyYXRpb25fMS5Bc3BlY3QuRVhQTEFJTkFCTEVcbl0pO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZmluZF9hbmRfbW9kaWZ5LmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/operations/find_and_modify.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/operations/get_more.js":
/*!*****************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/operations/get_more.js ***!
  \*****************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.GetMoreOperation = void 0;\nconst error_1 = __webpack_require__(/*! ../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(api)/../server/node_modules/mongodb/lib/operations/operation.js\");\n/** @internal */\nclass GetMoreOperation extends operation_1.AbstractCallbackOperation {\n    constructor(ns, cursorId, server, options) {\n        super(options);\n        this.options = options;\n        this.ns = ns;\n        this.cursorId = cursorId;\n        this.server = server;\n    }\n    /**\n     * Although there is a server already associated with the get more operation, the signature\n     * for execute passes a server so we will just use that one.\n     */\n    executeCallback(server, session, callback) {\n        if (server !== this.server) {\n            return callback(new error_1.MongoRuntimeError('Getmore must run on the same server operation began on'));\n        }\n        if (this.cursorId == null || this.cursorId.isZero()) {\n            return callback(new error_1.MongoRuntimeError('Unable to iterate cursor with no id'));\n        }\n        const collection = this.ns.collection;\n        if (collection == null) {\n            // Cursors should have adopted the namespace returned by MongoDB\n            // which should always defined a collection name (even a pseudo one, ex. db.aggregate())\n            return callback(new error_1.MongoRuntimeError('A collection name must be determined before getMore'));\n        }\n        const getMoreCmd = {\n            getMore: this.cursorId,\n            collection\n        };\n        if (typeof this.options.batchSize === 'number') {\n            getMoreCmd.batchSize = Math.abs(this.options.batchSize);\n        }\n        if (typeof this.options.maxAwaitTimeMS === 'number') {\n            getMoreCmd.maxTimeMS = this.options.maxAwaitTimeMS;\n        }\n        // we check for undefined specifically here to allow falsy values\n        // eslint-disable-next-line no-restricted-syntax\n        if (this.options.comment !== undefined && (0, utils_1.maxWireVersion)(server) >= 9) {\n            getMoreCmd.comment = this.options.comment;\n        }\n        const commandOptions = {\n            returnFieldSelector: null,\n            documentsReturnedIn: 'nextBatch',\n            ...this.options\n        };\n        server.command(this.ns, getMoreCmd, commandOptions, callback);\n    }\n}\nexports.GetMoreOperation = GetMoreOperation;\n(0, operation_1.defineAspects)(GetMoreOperation, [operation_1.Aspect.READ_OPERATION, operation_1.Aspect.MUST_SELECT_SAME_SERVER]);\n//# sourceMappingURL=get_more.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL2dldF9tb3JlLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELHdCQUF3QjtBQUN4QixnQkFBZ0IsbUJBQU8sQ0FBQyxtRUFBVTtBQUNsQyxnQkFBZ0IsbUJBQU8sQ0FBQyxtRUFBVTtBQUNsQyxvQkFBb0IsbUJBQU8sQ0FBQyxxRkFBYTtBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QjtBQUN4QjtBQUNBIiwic291cmNlcyI6WyJEOlxcc2Fsb25pXFxhcHByYWlzYWwtc3lzdGVtXFxzZXJ2ZXJcXG5vZGVfbW9kdWxlc1xcbW9uZ29kYlxcbGliXFxvcGVyYXRpb25zXFxnZXRfbW9yZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuR2V0TW9yZU9wZXJhdGlvbiA9IHZvaWQgMDtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi4vZXJyb3JcIik7XG5jb25zdCB1dGlsc18xID0gcmVxdWlyZShcIi4uL3V0aWxzXCIpO1xuY29uc3Qgb3BlcmF0aW9uXzEgPSByZXF1aXJlKFwiLi9vcGVyYXRpb25cIik7XG4vKiogQGludGVybmFsICovXG5jbGFzcyBHZXRNb3JlT3BlcmF0aW9uIGV4dGVuZHMgb3BlcmF0aW9uXzEuQWJzdHJhY3RDYWxsYmFja09wZXJhdGlvbiB7XG4gICAgY29uc3RydWN0b3IobnMsIGN1cnNvcklkLCBzZXJ2ZXIsIG9wdGlvbnMpIHtcbiAgICAgICAgc3VwZXIob3B0aW9ucyk7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XG4gICAgICAgIHRoaXMubnMgPSBucztcbiAgICAgICAgdGhpcy5jdXJzb3JJZCA9IGN1cnNvcklkO1xuICAgICAgICB0aGlzLnNlcnZlciA9IHNlcnZlcjtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQWx0aG91Z2ggdGhlcmUgaXMgYSBzZXJ2ZXIgYWxyZWFkeSBhc3NvY2lhdGVkIHdpdGggdGhlIGdldCBtb3JlIG9wZXJhdGlvbiwgdGhlIHNpZ25hdHVyZVxuICAgICAqIGZvciBleGVjdXRlIHBhc3NlcyBhIHNlcnZlciBzbyB3ZSB3aWxsIGp1c3QgdXNlIHRoYXQgb25lLlxuICAgICAqL1xuICAgIGV4ZWN1dGVDYWxsYmFjayhzZXJ2ZXIsIHNlc3Npb24sIGNhbGxiYWNrKSB7XG4gICAgICAgIGlmIChzZXJ2ZXIgIT09IHRoaXMuc2VydmVyKSB7XG4gICAgICAgICAgICByZXR1cm4gY2FsbGJhY2sobmV3IGVycm9yXzEuTW9uZ29SdW50aW1lRXJyb3IoJ0dldG1vcmUgbXVzdCBydW4gb24gdGhlIHNhbWUgc2VydmVyIG9wZXJhdGlvbiBiZWdhbiBvbicpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5jdXJzb3JJZCA9PSBudWxsIHx8IHRoaXMuY3Vyc29ySWQuaXNaZXJvKCkpIHtcbiAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhuZXcgZXJyb3JfMS5Nb25nb1J1bnRpbWVFcnJvcignVW5hYmxlIHRvIGl0ZXJhdGUgY3Vyc29yIHdpdGggbm8gaWQnKSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY29sbGVjdGlvbiA9IHRoaXMubnMuY29sbGVjdGlvbjtcbiAgICAgICAgaWYgKGNvbGxlY3Rpb24gPT0gbnVsbCkge1xuICAgICAgICAgICAgLy8gQ3Vyc29ycyBzaG91bGQgaGF2ZSBhZG9wdGVkIHRoZSBuYW1lc3BhY2UgcmV0dXJuZWQgYnkgTW9uZ29EQlxuICAgICAgICAgICAgLy8gd2hpY2ggc2hvdWxkIGFsd2F5cyBkZWZpbmVkIGEgY29sbGVjdGlvbiBuYW1lIChldmVuIGEgcHNldWRvIG9uZSwgZXguIGRiLmFnZ3JlZ2F0ZSgpKVxuICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKG5ldyBlcnJvcl8xLk1vbmdvUnVudGltZUVycm9yKCdBIGNvbGxlY3Rpb24gbmFtZSBtdXN0IGJlIGRldGVybWluZWQgYmVmb3JlIGdldE1vcmUnKSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZ2V0TW9yZUNtZCA9IHtcbiAgICAgICAgICAgIGdldE1vcmU6IHRoaXMuY3Vyc29ySWQsXG4gICAgICAgICAgICBjb2xsZWN0aW9uXG4gICAgICAgIH07XG4gICAgICAgIGlmICh0eXBlb2YgdGhpcy5vcHRpb25zLmJhdGNoU2l6ZSA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgIGdldE1vcmVDbWQuYmF0Y2hTaXplID0gTWF0aC5hYnModGhpcy5vcHRpb25zLmJhdGNoU2l6ZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiB0aGlzLm9wdGlvbnMubWF4QXdhaXRUaW1lTVMgPT09ICdudW1iZXInKSB7XG4gICAgICAgICAgICBnZXRNb3JlQ21kLm1heFRpbWVNUyA9IHRoaXMub3B0aW9ucy5tYXhBd2FpdFRpbWVNUztcbiAgICAgICAgfVxuICAgICAgICAvLyB3ZSBjaGVjayBmb3IgdW5kZWZpbmVkIHNwZWNpZmljYWxseSBoZXJlIHRvIGFsbG93IGZhbHN5IHZhbHVlc1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcmVzdHJpY3RlZC1zeW50YXhcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5jb21tZW50ICE9PSB1bmRlZmluZWQgJiYgKDAsIHV0aWxzXzEubWF4V2lyZVZlcnNpb24pKHNlcnZlcikgPj0gOSkge1xuICAgICAgICAgICAgZ2V0TW9yZUNtZC5jb21tZW50ID0gdGhpcy5vcHRpb25zLmNvbW1lbnQ7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY29tbWFuZE9wdGlvbnMgPSB7XG4gICAgICAgICAgICByZXR1cm5GaWVsZFNlbGVjdG9yOiBudWxsLFxuICAgICAgICAgICAgZG9jdW1lbnRzUmV0dXJuZWRJbjogJ25leHRCYXRjaCcsXG4gICAgICAgICAgICAuLi50aGlzLm9wdGlvbnNcbiAgICAgICAgfTtcbiAgICAgICAgc2VydmVyLmNvbW1hbmQodGhpcy5ucywgZ2V0TW9yZUNtZCwgY29tbWFuZE9wdGlvbnMsIGNhbGxiYWNrKTtcbiAgICB9XG59XG5leHBvcnRzLkdldE1vcmVPcGVyYXRpb24gPSBHZXRNb3JlT3BlcmF0aW9uO1xuKDAsIG9wZXJhdGlvbl8xLmRlZmluZUFzcGVjdHMpKEdldE1vcmVPcGVyYXRpb24sIFtvcGVyYXRpb25fMS5Bc3BlY3QuUkVBRF9PUEVSQVRJT04sIG9wZXJhdGlvbl8xLkFzcGVjdC5NVVNUX1NFTEVDVF9TQU1FX1NFUlZFUl0pO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Z2V0X21vcmUuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/operations/get_more.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/operations/indexes.js":
/*!****************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/operations/indexes.js ***!
  \****************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.IndexInformationOperation = exports.IndexExistsOperation = exports.ListIndexesOperation = exports.DropIndexesOperation = exports.DropIndexOperation = exports.EnsureIndexOperation = exports.CreateIndexOperation = exports.CreateIndexesOperation = exports.IndexesOperation = void 0;\nconst error_1 = __webpack_require__(/*! ../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst read_preference_1 = __webpack_require__(/*! ../read_preference */ \"(api)/../server/node_modules/mongodb/lib/read_preference.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\nconst command_1 = __webpack_require__(/*! ./command */ \"(api)/../server/node_modules/mongodb/lib/operations/command.js\");\nconst common_functions_1 = __webpack_require__(/*! ./common_functions */ \"(api)/../server/node_modules/mongodb/lib/operations/common_functions.js\");\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(api)/../server/node_modules/mongodb/lib/operations/operation.js\");\nconst VALID_INDEX_OPTIONS = new Set([\n    'background',\n    'unique',\n    'name',\n    'partialFilterExpression',\n    'sparse',\n    'hidden',\n    'expireAfterSeconds',\n    'storageEngine',\n    'collation',\n    'version',\n    // text indexes\n    'weights',\n    'default_language',\n    'language_override',\n    'textIndexVersion',\n    // 2d-sphere indexes\n    '2dsphereIndexVersion',\n    // 2d indexes\n    'bits',\n    'min',\n    'max',\n    // geoHaystack Indexes\n    'bucketSize',\n    // wildcard indexes\n    'wildcardProjection'\n]);\nfunction isIndexDirection(x) {\n    return (typeof x === 'number' || x === '2d' || x === '2dsphere' || x === 'text' || x === 'geoHaystack');\n}\nfunction isSingleIndexTuple(t) {\n    return Array.isArray(t) && t.length === 2 && isIndexDirection(t[1]);\n}\nfunction makeIndexSpec(indexSpec, options) {\n    const key = new Map();\n    const indexSpecs = !Array.isArray(indexSpec) || isSingleIndexTuple(indexSpec) ? [indexSpec] : indexSpec;\n    // Iterate through array and handle different types\n    for (const spec of indexSpecs) {\n        if (typeof spec === 'string') {\n            key.set(spec, 1);\n        }\n        else if (Array.isArray(spec)) {\n            key.set(spec[0], spec[1] ?? 1);\n        }\n        else if (spec instanceof Map) {\n            for (const [property, value] of spec) {\n                key.set(property, value);\n            }\n        }\n        else if ((0, utils_1.isObject)(spec)) {\n            for (const [property, value] of Object.entries(spec)) {\n                key.set(property, value);\n            }\n        }\n    }\n    return { ...options, key };\n}\n/** @internal */\nclass IndexesOperation extends operation_1.AbstractCallbackOperation {\n    constructor(collection, options) {\n        super(options);\n        this.options = options;\n        this.collection = collection;\n    }\n    executeCallback(server, session, callback) {\n        const coll = this.collection;\n        const options = this.options;\n        (0, common_functions_1.indexInformation)(coll.s.db, coll.collectionName, { full: true, ...options, readPreference: this.readPreference, session }, callback);\n    }\n}\nexports.IndexesOperation = IndexesOperation;\n/** @internal */\nclass CreateIndexesOperation extends command_1.CommandCallbackOperation {\n    constructor(parent, collectionName, indexes, options) {\n        super(parent, options);\n        this.options = options ?? {};\n        this.collectionName = collectionName;\n        this.indexes = indexes.map(userIndex => {\n            // Ensure the key is a Map to preserve index key ordering\n            const key = userIndex.key instanceof Map ? userIndex.key : new Map(Object.entries(userIndex.key));\n            const name = userIndex.name != null ? userIndex.name : Array.from(key).flat().join('_');\n            const validIndexOptions = Object.fromEntries(Object.entries({ ...userIndex }).filter(([optionName]) => VALID_INDEX_OPTIONS.has(optionName)));\n            return {\n                ...validIndexOptions,\n                name,\n                key\n            };\n        });\n    }\n    executeCallback(server, session, callback) {\n        const options = this.options;\n        const indexes = this.indexes;\n        const serverWireVersion = (0, utils_1.maxWireVersion)(server);\n        const cmd = { createIndexes: this.collectionName, indexes };\n        if (options.commitQuorum != null) {\n            if (serverWireVersion < 9) {\n                callback(new error_1.MongoCompatibilityError('Option `commitQuorum` for `createIndexes` not supported on servers < 4.4'));\n                return;\n            }\n            cmd.commitQuorum = options.commitQuorum;\n        }\n        // collation is set on each index, it should not be defined at the root\n        this.options.collation = undefined;\n        super.executeCommandCallback(server, session, cmd, err => {\n            if (err) {\n                callback(err);\n                return;\n            }\n            const indexNames = indexes.map(index => index.name || '');\n            callback(undefined, indexNames);\n        });\n    }\n}\nexports.CreateIndexesOperation = CreateIndexesOperation;\n/** @internal */\nclass CreateIndexOperation extends CreateIndexesOperation {\n    constructor(parent, collectionName, indexSpec, options) {\n        super(parent, collectionName, [makeIndexSpec(indexSpec, options)], options);\n    }\n    executeCallback(server, session, callback) {\n        super.executeCallback(server, session, (err, indexNames) => {\n            if (err || !indexNames)\n                return callback(err);\n            return callback(undefined, indexNames[0]);\n        });\n    }\n}\nexports.CreateIndexOperation = CreateIndexOperation;\n/** @internal */\nclass EnsureIndexOperation extends CreateIndexOperation {\n    constructor(db, collectionName, indexSpec, options) {\n        super(db, collectionName, indexSpec, options);\n        this.readPreference = read_preference_1.ReadPreference.primary;\n        this.db = db;\n        this.collectionName = collectionName;\n    }\n    executeCallback(server, session, callback) {\n        const indexName = this.indexes[0].name;\n        const cursor = this.db.collection(this.collectionName).listIndexes({ session });\n        cursor.toArray().then(indexes => {\n            indexes = Array.isArray(indexes) ? indexes : [indexes];\n            if (indexes.some(index => index.name === indexName)) {\n                callback(undefined, indexName);\n                return;\n            }\n            super.executeCallback(server, session, callback);\n        }, error => {\n            if (error instanceof error_1.MongoError && error.code === error_1.MONGODB_ERROR_CODES.NamespaceNotFound) {\n                // ignore \"NamespaceNotFound\" errors\n                return super.executeCallback(server, session, callback);\n            }\n            return callback(error);\n        });\n    }\n}\nexports.EnsureIndexOperation = EnsureIndexOperation;\n/** @internal */\nclass DropIndexOperation extends command_1.CommandCallbackOperation {\n    constructor(collection, indexName, options) {\n        super(collection, options);\n        this.options = options ?? {};\n        this.collection = collection;\n        this.indexName = indexName;\n    }\n    executeCallback(server, session, callback) {\n        const cmd = { dropIndexes: this.collection.collectionName, index: this.indexName };\n        super.executeCommandCallback(server, session, cmd, callback);\n    }\n}\nexports.DropIndexOperation = DropIndexOperation;\n/** @internal */\nclass DropIndexesOperation extends DropIndexOperation {\n    constructor(collection, options) {\n        super(collection, '*', options);\n    }\n    executeCallback(server, session, callback) {\n        super.executeCallback(server, session, err => {\n            if (err)\n                return callback(err, false);\n            callback(undefined, true);\n        });\n    }\n}\nexports.DropIndexesOperation = DropIndexesOperation;\n/** @internal */\nclass ListIndexesOperation extends command_1.CommandCallbackOperation {\n    constructor(collection, options) {\n        super(collection, options);\n        this.options = { ...options };\n        delete this.options.writeConcern;\n        this.collectionNamespace = collection.s.namespace;\n    }\n    executeCallback(server, session, callback) {\n        const serverWireVersion = (0, utils_1.maxWireVersion)(server);\n        const cursor = this.options.batchSize ? { batchSize: this.options.batchSize } : {};\n        const command = { listIndexes: this.collectionNamespace.collection, cursor };\n        // we check for undefined specifically here to allow falsy values\n        // eslint-disable-next-line no-restricted-syntax\n        if (serverWireVersion >= 9 && this.options.comment !== undefined) {\n            command.comment = this.options.comment;\n        }\n        super.executeCommandCallback(server, session, command, callback);\n    }\n}\nexports.ListIndexesOperation = ListIndexesOperation;\n/** @internal */\nclass IndexExistsOperation extends operation_1.AbstractCallbackOperation {\n    constructor(collection, indexes, options) {\n        super(options);\n        this.options = options;\n        this.collection = collection;\n        this.indexes = indexes;\n    }\n    executeCallback(server, session, callback) {\n        const coll = this.collection;\n        const indexes = this.indexes;\n        (0, common_functions_1.indexInformation)(coll.s.db, coll.collectionName, { ...this.options, readPreference: this.readPreference, session }, (err, indexInformation) => {\n            // If we have an error return\n            if (err != null)\n                return callback(err);\n            // Let's check for the index names\n            if (!Array.isArray(indexes))\n                return callback(undefined, indexInformation[indexes] != null);\n            // Check in list of indexes\n            for (let i = 0; i < indexes.length; i++) {\n                if (indexInformation[indexes[i]] == null) {\n                    return callback(undefined, false);\n                }\n            }\n            // All keys found return true\n            return callback(undefined, true);\n        });\n    }\n}\nexports.IndexExistsOperation = IndexExistsOperation;\n/** @internal */\nclass IndexInformationOperation extends operation_1.AbstractCallbackOperation {\n    constructor(db, name, options) {\n        super(options);\n        this.options = options ?? {};\n        this.db = db;\n        this.name = name;\n    }\n    executeCallback(server, session, callback) {\n        const db = this.db;\n        const name = this.name;\n        (0, common_functions_1.indexInformation)(db, name, { ...this.options, readPreference: this.readPreference, session }, callback);\n    }\n}\nexports.IndexInformationOperation = IndexInformationOperation;\n(0, operation_1.defineAspects)(ListIndexesOperation, [\n    operation_1.Aspect.READ_OPERATION,\n    operation_1.Aspect.RETRYABLE,\n    operation_1.Aspect.CURSOR_CREATING\n]);\n(0, operation_1.defineAspects)(CreateIndexesOperation, [operation_1.Aspect.WRITE_OPERATION]);\n(0, operation_1.defineAspects)(CreateIndexOperation, [operation_1.Aspect.WRITE_OPERATION]);\n(0, operation_1.defineAspects)(EnsureIndexOperation, [operation_1.Aspect.WRITE_OPERATION]);\n(0, operation_1.defineAspects)(DropIndexOperation, [operation_1.Aspect.WRITE_OPERATION]);\n(0, operation_1.defineAspects)(DropIndexesOperation, [operation_1.Aspect.WRITE_OPERATION]);\n//# sourceMappingURL=indexes.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL2luZGV4ZXMuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsaUNBQWlDLEdBQUcsNEJBQTRCLEdBQUcsNEJBQTRCLEdBQUcsNEJBQTRCLEdBQUcsMEJBQTBCLEdBQUcsNEJBQTRCLEdBQUcsNEJBQTRCLEdBQUcsOEJBQThCLEdBQUcsd0JBQXdCO0FBQ3JSLGdCQUFnQixtQkFBTyxDQUFDLG1FQUFVO0FBQ2xDLDBCQUEwQixtQkFBTyxDQUFDLHVGQUFvQjtBQUN0RCxnQkFBZ0IsbUJBQU8sQ0FBQyxtRUFBVTtBQUNsQyxrQkFBa0IsbUJBQU8sQ0FBQyxpRkFBVztBQUNyQywyQkFBMkIsbUJBQU8sQ0FBQyxtR0FBb0I7QUFDdkQsb0JBQW9CLG1CQUFPLENBQUMscUZBQWE7QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1GQUFtRixzRUFBc0U7QUFDeko7QUFDQTtBQUNBLHdCQUF3QjtBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBFQUEwRSxjQUFjO0FBQ3hGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQjtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsOEJBQThCO0FBQzlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSw0QkFBNEI7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2RUFBNkUsU0FBUztBQUN0RjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSw0QkFBNEI7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQjtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsNEJBQTRCO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrREFBa0Qsb0NBQW9DO0FBQ3RGLDBCQUEwQjtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtRkFBbUYsK0RBQStEO0FBQ2xKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLG9CQUFvQjtBQUNoRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLDRCQUE0QjtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkRBQTZELCtEQUErRDtBQUM1SDtBQUNBO0FBQ0EsaUNBQWlDO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIkQ6XFxzYWxvbmlcXGFwcHJhaXNhbC1zeXN0ZW1cXHNlcnZlclxcbm9kZV9tb2R1bGVzXFxtb25nb2RiXFxsaWJcXG9wZXJhdGlvbnNcXGluZGV4ZXMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkluZGV4SW5mb3JtYXRpb25PcGVyYXRpb24gPSBleHBvcnRzLkluZGV4RXhpc3RzT3BlcmF0aW9uID0gZXhwb3J0cy5MaXN0SW5kZXhlc09wZXJhdGlvbiA9IGV4cG9ydHMuRHJvcEluZGV4ZXNPcGVyYXRpb24gPSBleHBvcnRzLkRyb3BJbmRleE9wZXJhdGlvbiA9IGV4cG9ydHMuRW5zdXJlSW5kZXhPcGVyYXRpb24gPSBleHBvcnRzLkNyZWF0ZUluZGV4T3BlcmF0aW9uID0gZXhwb3J0cy5DcmVhdGVJbmRleGVzT3BlcmF0aW9uID0gZXhwb3J0cy5JbmRleGVzT3BlcmF0aW9uID0gdm9pZCAwO1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuLi9lcnJvclwiKTtcbmNvbnN0IHJlYWRfcHJlZmVyZW5jZV8xID0gcmVxdWlyZShcIi4uL3JlYWRfcHJlZmVyZW5jZVwiKTtcbmNvbnN0IHV0aWxzXzEgPSByZXF1aXJlKFwiLi4vdXRpbHNcIik7XG5jb25zdCBjb21tYW5kXzEgPSByZXF1aXJlKFwiLi9jb21tYW5kXCIpO1xuY29uc3QgY29tbW9uX2Z1bmN0aW9uc18xID0gcmVxdWlyZShcIi4vY29tbW9uX2Z1bmN0aW9uc1wiKTtcbmNvbnN0IG9wZXJhdGlvbl8xID0gcmVxdWlyZShcIi4vb3BlcmF0aW9uXCIpO1xuY29uc3QgVkFMSURfSU5ERVhfT1BUSU9OUyA9IG5ldyBTZXQoW1xuICAgICdiYWNrZ3JvdW5kJyxcbiAgICAndW5pcXVlJyxcbiAgICAnbmFtZScsXG4gICAgJ3BhcnRpYWxGaWx0ZXJFeHByZXNzaW9uJyxcbiAgICAnc3BhcnNlJyxcbiAgICAnaGlkZGVuJyxcbiAgICAnZXhwaXJlQWZ0ZXJTZWNvbmRzJyxcbiAgICAnc3RvcmFnZUVuZ2luZScsXG4gICAgJ2NvbGxhdGlvbicsXG4gICAgJ3ZlcnNpb24nLFxuICAgIC8vIHRleHQgaW5kZXhlc1xuICAgICd3ZWlnaHRzJyxcbiAgICAnZGVmYXVsdF9sYW5ndWFnZScsXG4gICAgJ2xhbmd1YWdlX292ZXJyaWRlJyxcbiAgICAndGV4dEluZGV4VmVyc2lvbicsXG4gICAgLy8gMmQtc3BoZXJlIGluZGV4ZXNcbiAgICAnMmRzcGhlcmVJbmRleFZlcnNpb24nLFxuICAgIC8vIDJkIGluZGV4ZXNcbiAgICAnYml0cycsXG4gICAgJ21pbicsXG4gICAgJ21heCcsXG4gICAgLy8gZ2VvSGF5c3RhY2sgSW5kZXhlc1xuICAgICdidWNrZXRTaXplJyxcbiAgICAvLyB3aWxkY2FyZCBpbmRleGVzXG4gICAgJ3dpbGRjYXJkUHJvamVjdGlvbidcbl0pO1xuZnVuY3Rpb24gaXNJbmRleERpcmVjdGlvbih4KSB7XG4gICAgcmV0dXJuICh0eXBlb2YgeCA9PT0gJ251bWJlcicgfHwgeCA9PT0gJzJkJyB8fCB4ID09PSAnMmRzcGhlcmUnIHx8IHggPT09ICd0ZXh0JyB8fCB4ID09PSAnZ2VvSGF5c3RhY2snKTtcbn1cbmZ1bmN0aW9uIGlzU2luZ2xlSW5kZXhUdXBsZSh0KSB7XG4gICAgcmV0dXJuIEFycmF5LmlzQXJyYXkodCkgJiYgdC5sZW5ndGggPT09IDIgJiYgaXNJbmRleERpcmVjdGlvbih0WzFdKTtcbn1cbmZ1bmN0aW9uIG1ha2VJbmRleFNwZWMoaW5kZXhTcGVjLCBvcHRpb25zKSB7XG4gICAgY29uc3Qga2V5ID0gbmV3IE1hcCgpO1xuICAgIGNvbnN0IGluZGV4U3BlY3MgPSAhQXJyYXkuaXNBcnJheShpbmRleFNwZWMpIHx8IGlzU2luZ2xlSW5kZXhUdXBsZShpbmRleFNwZWMpID8gW2luZGV4U3BlY10gOiBpbmRleFNwZWM7XG4gICAgLy8gSXRlcmF0ZSB0aHJvdWdoIGFycmF5IGFuZCBoYW5kbGUgZGlmZmVyZW50IHR5cGVzXG4gICAgZm9yIChjb25zdCBzcGVjIG9mIGluZGV4U3BlY3MpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBzcGVjID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAga2V5LnNldChzcGVjLCAxKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChBcnJheS5pc0FycmF5KHNwZWMpKSB7XG4gICAgICAgICAgICBrZXkuc2V0KHNwZWNbMF0sIHNwZWNbMV0gPz8gMSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoc3BlYyBpbnN0YW5jZW9mIE1hcCkge1xuICAgICAgICAgICAgZm9yIChjb25zdCBbcHJvcGVydHksIHZhbHVlXSBvZiBzcGVjKSB7XG4gICAgICAgICAgICAgICAga2V5LnNldChwcm9wZXJ0eSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKCgwLCB1dGlsc18xLmlzT2JqZWN0KShzcGVjKSkge1xuICAgICAgICAgICAgZm9yIChjb25zdCBbcHJvcGVydHksIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhzcGVjKSkge1xuICAgICAgICAgICAgICAgIGtleS5zZXQocHJvcGVydHksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4geyAuLi5vcHRpb25zLCBrZXkgfTtcbn1cbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIEluZGV4ZXNPcGVyYXRpb24gZXh0ZW5kcyBvcGVyYXRpb25fMS5BYnN0cmFjdENhbGxiYWNrT3BlcmF0aW9uIHtcbiAgICBjb25zdHJ1Y3Rvcihjb2xsZWN0aW9uLCBvcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKG9wdGlvbnMpO1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuICAgICAgICB0aGlzLmNvbGxlY3Rpb24gPSBjb2xsZWN0aW9uO1xuICAgIH1cbiAgICBleGVjdXRlQ2FsbGJhY2soc2VydmVyLCBzZXNzaW9uLCBjYWxsYmFjaykge1xuICAgICAgICBjb25zdCBjb2xsID0gdGhpcy5jb2xsZWN0aW9uO1xuICAgICAgICBjb25zdCBvcHRpb25zID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAoMCwgY29tbW9uX2Z1bmN0aW9uc18xLmluZGV4SW5mb3JtYXRpb24pKGNvbGwucy5kYiwgY29sbC5jb2xsZWN0aW9uTmFtZSwgeyBmdWxsOiB0cnVlLCAuLi5vcHRpb25zLCByZWFkUHJlZmVyZW5jZTogdGhpcy5yZWFkUHJlZmVyZW5jZSwgc2Vzc2lvbiB9LCBjYWxsYmFjayk7XG4gICAgfVxufVxuZXhwb3J0cy5JbmRleGVzT3BlcmF0aW9uID0gSW5kZXhlc09wZXJhdGlvbjtcbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIENyZWF0ZUluZGV4ZXNPcGVyYXRpb24gZXh0ZW5kcyBjb21tYW5kXzEuQ29tbWFuZENhbGxiYWNrT3BlcmF0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcihwYXJlbnQsIGNvbGxlY3Rpb25OYW1lLCBpbmRleGVzLCBvcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKHBhcmVudCwgb3B0aW9ucyk7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnMgPz8ge307XG4gICAgICAgIHRoaXMuY29sbGVjdGlvbk5hbWUgPSBjb2xsZWN0aW9uTmFtZTtcbiAgICAgICAgdGhpcy5pbmRleGVzID0gaW5kZXhlcy5tYXAodXNlckluZGV4ID0+IHtcbiAgICAgICAgICAgIC8vIEVuc3VyZSB0aGUga2V5IGlzIGEgTWFwIHRvIHByZXNlcnZlIGluZGV4IGtleSBvcmRlcmluZ1xuICAgICAgICAgICAgY29uc3Qga2V5ID0gdXNlckluZGV4LmtleSBpbnN0YW5jZW9mIE1hcCA/IHVzZXJJbmRleC5rZXkgOiBuZXcgTWFwKE9iamVjdC5lbnRyaWVzKHVzZXJJbmRleC5rZXkpKTtcbiAgICAgICAgICAgIGNvbnN0IG5hbWUgPSB1c2VySW5kZXgubmFtZSAhPSBudWxsID8gdXNlckluZGV4Lm5hbWUgOiBBcnJheS5mcm9tKGtleSkuZmxhdCgpLmpvaW4oJ18nKTtcbiAgICAgICAgICAgIGNvbnN0IHZhbGlkSW5kZXhPcHRpb25zID0gT2JqZWN0LmZyb21FbnRyaWVzKE9iamVjdC5lbnRyaWVzKHsgLi4udXNlckluZGV4IH0pLmZpbHRlcigoW29wdGlvbk5hbWVdKSA9PiBWQUxJRF9JTkRFWF9PUFRJT05TLmhhcyhvcHRpb25OYW1lKSkpO1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAuLi52YWxpZEluZGV4T3B0aW9ucyxcbiAgICAgICAgICAgICAgICBuYW1lLFxuICAgICAgICAgICAgICAgIGtleVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGV4ZWN1dGVDYWxsYmFjayhzZXJ2ZXIsIHNlc3Npb24sIGNhbGxiYWNrKSB7XG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgIGNvbnN0IGluZGV4ZXMgPSB0aGlzLmluZGV4ZXM7XG4gICAgICAgIGNvbnN0IHNlcnZlcldpcmVWZXJzaW9uID0gKDAsIHV0aWxzXzEubWF4V2lyZVZlcnNpb24pKHNlcnZlcik7XG4gICAgICAgIGNvbnN0IGNtZCA9IHsgY3JlYXRlSW5kZXhlczogdGhpcy5jb2xsZWN0aW9uTmFtZSwgaW5kZXhlcyB9O1xuICAgICAgICBpZiAob3B0aW9ucy5jb21taXRRdW9ydW0gIT0gbnVsbCkge1xuICAgICAgICAgICAgaWYgKHNlcnZlcldpcmVWZXJzaW9uIDwgOSkge1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKG5ldyBlcnJvcl8xLk1vbmdvQ29tcGF0aWJpbGl0eUVycm9yKCdPcHRpb24gYGNvbW1pdFF1b3J1bWAgZm9yIGBjcmVhdGVJbmRleGVzYCBub3Qgc3VwcG9ydGVkIG9uIHNlcnZlcnMgPCA0LjQnKSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY21kLmNvbW1pdFF1b3J1bSA9IG9wdGlvbnMuY29tbWl0UXVvcnVtO1xuICAgICAgICB9XG4gICAgICAgIC8vIGNvbGxhdGlvbiBpcyBzZXQgb24gZWFjaCBpbmRleCwgaXQgc2hvdWxkIG5vdCBiZSBkZWZpbmVkIGF0IHRoZSByb290XG4gICAgICAgIHRoaXMub3B0aW9ucy5jb2xsYXRpb24gPSB1bmRlZmluZWQ7XG4gICAgICAgIHN1cGVyLmV4ZWN1dGVDb21tYW5kQ2FsbGJhY2soc2VydmVyLCBzZXNzaW9uLCBjbWQsIGVyciA9PiB7XG4gICAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBpbmRleE5hbWVzID0gaW5kZXhlcy5tYXAoaW5kZXggPT4gaW5kZXgubmFtZSB8fCAnJyk7XG4gICAgICAgICAgICBjYWxsYmFjayh1bmRlZmluZWQsIGluZGV4TmFtZXMpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5leHBvcnRzLkNyZWF0ZUluZGV4ZXNPcGVyYXRpb24gPSBDcmVhdGVJbmRleGVzT3BlcmF0aW9uO1xuLyoqIEBpbnRlcm5hbCAqL1xuY2xhc3MgQ3JlYXRlSW5kZXhPcGVyYXRpb24gZXh0ZW5kcyBDcmVhdGVJbmRleGVzT3BlcmF0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcihwYXJlbnQsIGNvbGxlY3Rpb25OYW1lLCBpbmRleFNwZWMsIG9wdGlvbnMpIHtcbiAgICAgICAgc3VwZXIocGFyZW50LCBjb2xsZWN0aW9uTmFtZSwgW21ha2VJbmRleFNwZWMoaW5kZXhTcGVjLCBvcHRpb25zKV0sIG9wdGlvbnMpO1xuICAgIH1cbiAgICBleGVjdXRlQ2FsbGJhY2soc2VydmVyLCBzZXNzaW9uLCBjYWxsYmFjaykge1xuICAgICAgICBzdXBlci5leGVjdXRlQ2FsbGJhY2soc2VydmVyLCBzZXNzaW9uLCAoZXJyLCBpbmRleE5hbWVzKSA9PiB7XG4gICAgICAgICAgICBpZiAoZXJyIHx8ICFpbmRleE5hbWVzKVxuICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKHVuZGVmaW5lZCwgaW5kZXhOYW1lc1swXSk7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmV4cG9ydHMuQ3JlYXRlSW5kZXhPcGVyYXRpb24gPSBDcmVhdGVJbmRleE9wZXJhdGlvbjtcbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIEVuc3VyZUluZGV4T3BlcmF0aW9uIGV4dGVuZHMgQ3JlYXRlSW5kZXhPcGVyYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKGRiLCBjb2xsZWN0aW9uTmFtZSwgaW5kZXhTcGVjLCBvcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKGRiLCBjb2xsZWN0aW9uTmFtZSwgaW5kZXhTcGVjLCBvcHRpb25zKTtcbiAgICAgICAgdGhpcy5yZWFkUHJlZmVyZW5jZSA9IHJlYWRfcHJlZmVyZW5jZV8xLlJlYWRQcmVmZXJlbmNlLnByaW1hcnk7XG4gICAgICAgIHRoaXMuZGIgPSBkYjtcbiAgICAgICAgdGhpcy5jb2xsZWN0aW9uTmFtZSA9IGNvbGxlY3Rpb25OYW1lO1xuICAgIH1cbiAgICBleGVjdXRlQ2FsbGJhY2soc2VydmVyLCBzZXNzaW9uLCBjYWxsYmFjaykge1xuICAgICAgICBjb25zdCBpbmRleE5hbWUgPSB0aGlzLmluZGV4ZXNbMF0ubmFtZTtcbiAgICAgICAgY29uc3QgY3Vyc29yID0gdGhpcy5kYi5jb2xsZWN0aW9uKHRoaXMuY29sbGVjdGlvbk5hbWUpLmxpc3RJbmRleGVzKHsgc2Vzc2lvbiB9KTtcbiAgICAgICAgY3Vyc29yLnRvQXJyYXkoKS50aGVuKGluZGV4ZXMgPT4ge1xuICAgICAgICAgICAgaW5kZXhlcyA9IEFycmF5LmlzQXJyYXkoaW5kZXhlcykgPyBpbmRleGVzIDogW2luZGV4ZXNdO1xuICAgICAgICAgICAgaWYgKGluZGV4ZXMuc29tZShpbmRleCA9PiBpbmRleC5uYW1lID09PSBpbmRleE5hbWUpKSB7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2sodW5kZWZpbmVkLCBpbmRleE5hbWUpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHN1cGVyLmV4ZWN1dGVDYWxsYmFjayhzZXJ2ZXIsIHNlc3Npb24sIGNhbGxiYWNrKTtcbiAgICAgICAgfSwgZXJyb3IgPT4ge1xuICAgICAgICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgZXJyb3JfMS5Nb25nb0Vycm9yICYmIGVycm9yLmNvZGUgPT09IGVycm9yXzEuTU9OR09EQl9FUlJPUl9DT0RFUy5OYW1lc3BhY2VOb3RGb3VuZCkge1xuICAgICAgICAgICAgICAgIC8vIGlnbm9yZSBcIk5hbWVzcGFjZU5vdEZvdW5kXCIgZXJyb3JzXG4gICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmV4ZWN1dGVDYWxsYmFjayhzZXJ2ZXIsIHNlc3Npb24sIGNhbGxiYWNrKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhlcnJvcik7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmV4cG9ydHMuRW5zdXJlSW5kZXhPcGVyYXRpb24gPSBFbnN1cmVJbmRleE9wZXJhdGlvbjtcbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIERyb3BJbmRleE9wZXJhdGlvbiBleHRlbmRzIGNvbW1hbmRfMS5Db21tYW5kQ2FsbGJhY2tPcGVyYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKGNvbGxlY3Rpb24sIGluZGV4TmFtZSwgb3B0aW9ucykge1xuICAgICAgICBzdXBlcihjb2xsZWN0aW9uLCBvcHRpb25zKTtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucyA/PyB7fTtcbiAgICAgICAgdGhpcy5jb2xsZWN0aW9uID0gY29sbGVjdGlvbjtcbiAgICAgICAgdGhpcy5pbmRleE5hbWUgPSBpbmRleE5hbWU7XG4gICAgfVxuICAgIGV4ZWN1dGVDYWxsYmFjayhzZXJ2ZXIsIHNlc3Npb24sIGNhbGxiYWNrKSB7XG4gICAgICAgIGNvbnN0IGNtZCA9IHsgZHJvcEluZGV4ZXM6IHRoaXMuY29sbGVjdGlvbi5jb2xsZWN0aW9uTmFtZSwgaW5kZXg6IHRoaXMuaW5kZXhOYW1lIH07XG4gICAgICAgIHN1cGVyLmV4ZWN1dGVDb21tYW5kQ2FsbGJhY2soc2VydmVyLCBzZXNzaW9uLCBjbWQsIGNhbGxiYWNrKTtcbiAgICB9XG59XG5leHBvcnRzLkRyb3BJbmRleE9wZXJhdGlvbiA9IERyb3BJbmRleE9wZXJhdGlvbjtcbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIERyb3BJbmRleGVzT3BlcmF0aW9uIGV4dGVuZHMgRHJvcEluZGV4T3BlcmF0aW9uIHtcbiAgICBjb25zdHJ1Y3Rvcihjb2xsZWN0aW9uLCBvcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKGNvbGxlY3Rpb24sICcqJywgb3B0aW9ucyk7XG4gICAgfVxuICAgIGV4ZWN1dGVDYWxsYmFjayhzZXJ2ZXIsIHNlc3Npb24sIGNhbGxiYWNrKSB7XG4gICAgICAgIHN1cGVyLmV4ZWN1dGVDYWxsYmFjayhzZXJ2ZXIsIHNlc3Npb24sIGVyciA9PiB7XG4gICAgICAgICAgICBpZiAoZXJyKVxuICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhlcnIsIGZhbHNlKTtcbiAgICAgICAgICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwgdHJ1ZSk7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmV4cG9ydHMuRHJvcEluZGV4ZXNPcGVyYXRpb24gPSBEcm9wSW5kZXhlc09wZXJhdGlvbjtcbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIExpc3RJbmRleGVzT3BlcmF0aW9uIGV4dGVuZHMgY29tbWFuZF8xLkNvbW1hbmRDYWxsYmFja09wZXJhdGlvbiB7XG4gICAgY29uc3RydWN0b3IoY29sbGVjdGlvbiwgb3B0aW9ucykge1xuICAgICAgICBzdXBlcihjb2xsZWN0aW9uLCBvcHRpb25zKTtcbiAgICAgICAgdGhpcy5vcHRpb25zID0geyAuLi5vcHRpb25zIH07XG4gICAgICAgIGRlbGV0ZSB0aGlzLm9wdGlvbnMud3JpdGVDb25jZXJuO1xuICAgICAgICB0aGlzLmNvbGxlY3Rpb25OYW1lc3BhY2UgPSBjb2xsZWN0aW9uLnMubmFtZXNwYWNlO1xuICAgIH1cbiAgICBleGVjdXRlQ2FsbGJhY2soc2VydmVyLCBzZXNzaW9uLCBjYWxsYmFjaykge1xuICAgICAgICBjb25zdCBzZXJ2ZXJXaXJlVmVyc2lvbiA9ICgwLCB1dGlsc18xLm1heFdpcmVWZXJzaW9uKShzZXJ2ZXIpO1xuICAgICAgICBjb25zdCBjdXJzb3IgPSB0aGlzLm9wdGlvbnMuYmF0Y2hTaXplID8geyBiYXRjaFNpemU6IHRoaXMub3B0aW9ucy5iYXRjaFNpemUgfSA6IHt9O1xuICAgICAgICBjb25zdCBjb21tYW5kID0geyBsaXN0SW5kZXhlczogdGhpcy5jb2xsZWN0aW9uTmFtZXNwYWNlLmNvbGxlY3Rpb24sIGN1cnNvciB9O1xuICAgICAgICAvLyB3ZSBjaGVjayBmb3IgdW5kZWZpbmVkIHNwZWNpZmljYWxseSBoZXJlIHRvIGFsbG93IGZhbHN5IHZhbHVlc1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcmVzdHJpY3RlZC1zeW50YXhcbiAgICAgICAgaWYgKHNlcnZlcldpcmVWZXJzaW9uID49IDkgJiYgdGhpcy5vcHRpb25zLmNvbW1lbnQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgY29tbWFuZC5jb21tZW50ID0gdGhpcy5vcHRpb25zLmNvbW1lbnQ7XG4gICAgICAgIH1cbiAgICAgICAgc3VwZXIuZXhlY3V0ZUNvbW1hbmRDYWxsYmFjayhzZXJ2ZXIsIHNlc3Npb24sIGNvbW1hbmQsIGNhbGxiYWNrKTtcbiAgICB9XG59XG5leHBvcnRzLkxpc3RJbmRleGVzT3BlcmF0aW9uID0gTGlzdEluZGV4ZXNPcGVyYXRpb247XG4vKiogQGludGVybmFsICovXG5jbGFzcyBJbmRleEV4aXN0c09wZXJhdGlvbiBleHRlbmRzIG9wZXJhdGlvbl8xLkFic3RyYWN0Q2FsbGJhY2tPcGVyYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKGNvbGxlY3Rpb24sIGluZGV4ZXMsIG9wdGlvbnMpIHtcbiAgICAgICAgc3VwZXIob3B0aW9ucyk7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XG4gICAgICAgIHRoaXMuY29sbGVjdGlvbiA9IGNvbGxlY3Rpb247XG4gICAgICAgIHRoaXMuaW5kZXhlcyA9IGluZGV4ZXM7XG4gICAgfVxuICAgIGV4ZWN1dGVDYWxsYmFjayhzZXJ2ZXIsIHNlc3Npb24sIGNhbGxiYWNrKSB7XG4gICAgICAgIGNvbnN0IGNvbGwgPSB0aGlzLmNvbGxlY3Rpb247XG4gICAgICAgIGNvbnN0IGluZGV4ZXMgPSB0aGlzLmluZGV4ZXM7XG4gICAgICAgICgwLCBjb21tb25fZnVuY3Rpb25zXzEuaW5kZXhJbmZvcm1hdGlvbikoY29sbC5zLmRiLCBjb2xsLmNvbGxlY3Rpb25OYW1lLCB7IC4uLnRoaXMub3B0aW9ucywgcmVhZFByZWZlcmVuY2U6IHRoaXMucmVhZFByZWZlcmVuY2UsIHNlc3Npb24gfSwgKGVyciwgaW5kZXhJbmZvcm1hdGlvbikgPT4ge1xuICAgICAgICAgICAgLy8gSWYgd2UgaGF2ZSBhbiBlcnJvciByZXR1cm5cbiAgICAgICAgICAgIGlmIChlcnIgIT0gbnVsbClcbiAgICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICAgICAgICAgIC8vIExldCdzIGNoZWNrIGZvciB0aGUgaW5kZXggbmFtZXNcbiAgICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheShpbmRleGVzKSlcbiAgICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2sodW5kZWZpbmVkLCBpbmRleEluZm9ybWF0aW9uW2luZGV4ZXNdICE9IG51bGwpO1xuICAgICAgICAgICAgLy8gQ2hlY2sgaW4gbGlzdCBvZiBpbmRleGVzXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGluZGV4ZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBpZiAoaW5kZXhJbmZvcm1hdGlvbltpbmRleGVzW2ldXSA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayh1bmRlZmluZWQsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBBbGwga2V5cyBmb3VuZCByZXR1cm4gdHJ1ZVxuICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKHVuZGVmaW5lZCwgdHJ1ZSk7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmV4cG9ydHMuSW5kZXhFeGlzdHNPcGVyYXRpb24gPSBJbmRleEV4aXN0c09wZXJhdGlvbjtcbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIEluZGV4SW5mb3JtYXRpb25PcGVyYXRpb24gZXh0ZW5kcyBvcGVyYXRpb25fMS5BYnN0cmFjdENhbGxiYWNrT3BlcmF0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcihkYiwgbmFtZSwgb3B0aW9ucykge1xuICAgICAgICBzdXBlcihvcHRpb25zKTtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucyA/PyB7fTtcbiAgICAgICAgdGhpcy5kYiA9IGRiO1xuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgIH1cbiAgICBleGVjdXRlQ2FsbGJhY2soc2VydmVyLCBzZXNzaW9uLCBjYWxsYmFjaykge1xuICAgICAgICBjb25zdCBkYiA9IHRoaXMuZGI7XG4gICAgICAgIGNvbnN0IG5hbWUgPSB0aGlzLm5hbWU7XG4gICAgICAgICgwLCBjb21tb25fZnVuY3Rpb25zXzEuaW5kZXhJbmZvcm1hdGlvbikoZGIsIG5hbWUsIHsgLi4udGhpcy5vcHRpb25zLCByZWFkUHJlZmVyZW5jZTogdGhpcy5yZWFkUHJlZmVyZW5jZSwgc2Vzc2lvbiB9LCBjYWxsYmFjayk7XG4gICAgfVxufVxuZXhwb3J0cy5JbmRleEluZm9ybWF0aW9uT3BlcmF0aW9uID0gSW5kZXhJbmZvcm1hdGlvbk9wZXJhdGlvbjtcbigwLCBvcGVyYXRpb25fMS5kZWZpbmVBc3BlY3RzKShMaXN0SW5kZXhlc09wZXJhdGlvbiwgW1xuICAgIG9wZXJhdGlvbl8xLkFzcGVjdC5SRUFEX09QRVJBVElPTixcbiAgICBvcGVyYXRpb25fMS5Bc3BlY3QuUkVUUllBQkxFLFxuICAgIG9wZXJhdGlvbl8xLkFzcGVjdC5DVVJTT1JfQ1JFQVRJTkdcbl0pO1xuKDAsIG9wZXJhdGlvbl8xLmRlZmluZUFzcGVjdHMpKENyZWF0ZUluZGV4ZXNPcGVyYXRpb24sIFtvcGVyYXRpb25fMS5Bc3BlY3QuV1JJVEVfT1BFUkFUSU9OXSk7XG4oMCwgb3BlcmF0aW9uXzEuZGVmaW5lQXNwZWN0cykoQ3JlYXRlSW5kZXhPcGVyYXRpb24sIFtvcGVyYXRpb25fMS5Bc3BlY3QuV1JJVEVfT1BFUkFUSU9OXSk7XG4oMCwgb3BlcmF0aW9uXzEuZGVmaW5lQXNwZWN0cykoRW5zdXJlSW5kZXhPcGVyYXRpb24sIFtvcGVyYXRpb25fMS5Bc3BlY3QuV1JJVEVfT1BFUkFUSU9OXSk7XG4oMCwgb3BlcmF0aW9uXzEuZGVmaW5lQXNwZWN0cykoRHJvcEluZGV4T3BlcmF0aW9uLCBbb3BlcmF0aW9uXzEuQXNwZWN0LldSSVRFX09QRVJBVElPTl0pO1xuKDAsIG9wZXJhdGlvbl8xLmRlZmluZUFzcGVjdHMpKERyb3BJbmRleGVzT3BlcmF0aW9uLCBbb3BlcmF0aW9uXzEuQXNwZWN0LldSSVRFX09QRVJBVElPTl0pO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXhlcy5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/operations/indexes.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/operations/insert.js":
/*!***************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/operations/insert.js ***!
  \***************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.InsertManyOperation = exports.InsertOneOperation = exports.InsertOperation = void 0;\nconst error_1 = __webpack_require__(/*! ../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst write_concern_1 = __webpack_require__(/*! ../write_concern */ \"(api)/../server/node_modules/mongodb/lib/write_concern.js\");\nconst bulk_write_1 = __webpack_require__(/*! ./bulk_write */ \"(api)/../server/node_modules/mongodb/lib/operations/bulk_write.js\");\nconst command_1 = __webpack_require__(/*! ./command */ \"(api)/../server/node_modules/mongodb/lib/operations/command.js\");\nconst common_functions_1 = __webpack_require__(/*! ./common_functions */ \"(api)/../server/node_modules/mongodb/lib/operations/common_functions.js\");\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(api)/../server/node_modules/mongodb/lib/operations/operation.js\");\n/** @internal */\nclass InsertOperation extends command_1.CommandCallbackOperation {\n    constructor(ns, documents, options) {\n        super(undefined, options);\n        this.options = { ...options, checkKeys: options.checkKeys ?? false };\n        this.ns = ns;\n        this.documents = documents;\n    }\n    executeCallback(server, session, callback) {\n        const options = this.options ?? {};\n        const ordered = typeof options.ordered === 'boolean' ? options.ordered : true;\n        const command = {\n            insert: this.ns.collection,\n            documents: this.documents,\n            ordered\n        };\n        if (typeof options.bypassDocumentValidation === 'boolean') {\n            command.bypassDocumentValidation = options.bypassDocumentValidation;\n        }\n        // we check for undefined specifically here to allow falsy values\n        // eslint-disable-next-line no-restricted-syntax\n        if (options.comment !== undefined) {\n            command.comment = options.comment;\n        }\n        super.executeCommandCallback(server, session, command, callback);\n    }\n}\nexports.InsertOperation = InsertOperation;\nclass InsertOneOperation extends InsertOperation {\n    constructor(collection, doc, options) {\n        super(collection.s.namespace, (0, common_functions_1.prepareDocs)(collection, [doc], options), options);\n    }\n    executeCallback(server, session, callback) {\n        super.executeCallback(server, session, (err, res) => {\n            if (err || res == null)\n                return callback(err);\n            if (res.code)\n                return callback(new error_1.MongoServerError(res));\n            if (res.writeErrors) {\n                // This should be a WriteError but we can't change it now because of error hierarchy\n                return callback(new error_1.MongoServerError(res.writeErrors[0]));\n            }\n            callback(undefined, {\n                acknowledged: this.writeConcern?.w !== 0 ?? true,\n                insertedId: this.documents[0]._id\n            });\n        });\n    }\n}\nexports.InsertOneOperation = InsertOneOperation;\n/** @internal */\nclass InsertManyOperation extends operation_1.AbstractCallbackOperation {\n    constructor(collection, docs, options) {\n        super(options);\n        if (!Array.isArray(docs)) {\n            throw new error_1.MongoInvalidArgumentError('Argument \"docs\" must be an array of documents');\n        }\n        this.options = options;\n        this.collection = collection;\n        this.docs = docs;\n    }\n    executeCallback(server, session, callback) {\n        const coll = this.collection;\n        const options = { ...this.options, ...this.bsonOptions, readPreference: this.readPreference };\n        const writeConcern = write_concern_1.WriteConcern.fromOptions(options);\n        const bulkWriteOperation = new bulk_write_1.BulkWriteOperation(coll, (0, common_functions_1.prepareDocs)(coll, this.docs, options).map(document => ({ insertOne: { document } })), options);\n        bulkWriteOperation.executeCallback(server, session, (err, res) => {\n            if (err || res == null) {\n                if (err && err.message === 'Operation must be an object with an operation key') {\n                    err = new error_1.MongoInvalidArgumentError('Collection.insertMany() cannot be called with an array that has null/undefined values');\n                }\n                return callback(err);\n            }\n            callback(undefined, {\n                acknowledged: writeConcern?.w !== 0 ?? true,\n                insertedCount: res.insertedCount,\n                insertedIds: res.insertedIds\n            });\n        });\n    }\n}\nexports.InsertManyOperation = InsertManyOperation;\n(0, operation_1.defineAspects)(InsertOperation, [operation_1.Aspect.RETRYABLE, operation_1.Aspect.WRITE_OPERATION]);\n(0, operation_1.defineAspects)(InsertOneOperation, [operation_1.Aspect.RETRYABLE, operation_1.Aspect.WRITE_OPERATION]);\n(0, operation_1.defineAspects)(InsertManyOperation, [operation_1.Aspect.WRITE_OPERATION]);\n//# sourceMappingURL=insert.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL2luc2VydC5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCwyQkFBMkIsR0FBRywwQkFBMEIsR0FBRyx1QkFBdUI7QUFDbEYsZ0JBQWdCLG1CQUFPLENBQUMsbUVBQVU7QUFDbEMsd0JBQXdCLG1CQUFPLENBQUMsbUZBQWtCO0FBQ2xELHFCQUFxQixtQkFBTyxDQUFDLHVGQUFjO0FBQzNDLGtCQUFrQixtQkFBTyxDQUFDLGlGQUFXO0FBQ3JDLDJCQUEyQixtQkFBTyxDQUFDLG1HQUFvQjtBQUN2RCxvQkFBb0IsbUJBQU8sQ0FBQyxxRkFBYTtBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QjtBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0EsMEJBQTBCO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCO0FBQzFCO0FBQ0EsOEpBQThKLGFBQWEsWUFBWTtBQUN2TDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0EsMkJBQTJCO0FBQzNCO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJEOlxcc2Fsb25pXFxhcHByYWlzYWwtc3lzdGVtXFxzZXJ2ZXJcXG5vZGVfbW9kdWxlc1xcbW9uZ29kYlxcbGliXFxvcGVyYXRpb25zXFxpbnNlcnQuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkluc2VydE1hbnlPcGVyYXRpb24gPSBleHBvcnRzLkluc2VydE9uZU9wZXJhdGlvbiA9IGV4cG9ydHMuSW5zZXJ0T3BlcmF0aW9uID0gdm9pZCAwO1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuLi9lcnJvclwiKTtcbmNvbnN0IHdyaXRlX2NvbmNlcm5fMSA9IHJlcXVpcmUoXCIuLi93cml0ZV9jb25jZXJuXCIpO1xuY29uc3QgYnVsa193cml0ZV8xID0gcmVxdWlyZShcIi4vYnVsa193cml0ZVwiKTtcbmNvbnN0IGNvbW1hbmRfMSA9IHJlcXVpcmUoXCIuL2NvbW1hbmRcIik7XG5jb25zdCBjb21tb25fZnVuY3Rpb25zXzEgPSByZXF1aXJlKFwiLi9jb21tb25fZnVuY3Rpb25zXCIpO1xuY29uc3Qgb3BlcmF0aW9uXzEgPSByZXF1aXJlKFwiLi9vcGVyYXRpb25cIik7XG4vKiogQGludGVybmFsICovXG5jbGFzcyBJbnNlcnRPcGVyYXRpb24gZXh0ZW5kcyBjb21tYW5kXzEuQ29tbWFuZENhbGxiYWNrT3BlcmF0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcihucywgZG9jdW1lbnRzLCBvcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKHVuZGVmaW5lZCwgb3B0aW9ucyk7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IHsgLi4ub3B0aW9ucywgY2hlY2tLZXlzOiBvcHRpb25zLmNoZWNrS2V5cyA/PyBmYWxzZSB9O1xuICAgICAgICB0aGlzLm5zID0gbnM7XG4gICAgICAgIHRoaXMuZG9jdW1lbnRzID0gZG9jdW1lbnRzO1xuICAgIH1cbiAgICBleGVjdXRlQ2FsbGJhY2soc2VydmVyLCBzZXNzaW9uLCBjYWxsYmFjaykge1xuICAgICAgICBjb25zdCBvcHRpb25zID0gdGhpcy5vcHRpb25zID8/IHt9O1xuICAgICAgICBjb25zdCBvcmRlcmVkID0gdHlwZW9mIG9wdGlvbnMub3JkZXJlZCA9PT0gJ2Jvb2xlYW4nID8gb3B0aW9ucy5vcmRlcmVkIDogdHJ1ZTtcbiAgICAgICAgY29uc3QgY29tbWFuZCA9IHtcbiAgICAgICAgICAgIGluc2VydDogdGhpcy5ucy5jb2xsZWN0aW9uLFxuICAgICAgICAgICAgZG9jdW1lbnRzOiB0aGlzLmRvY3VtZW50cyxcbiAgICAgICAgICAgIG9yZGVyZWRcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLmJ5cGFzc0RvY3VtZW50VmFsaWRhdGlvbiA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICBjb21tYW5kLmJ5cGFzc0RvY3VtZW50VmFsaWRhdGlvbiA9IG9wdGlvbnMuYnlwYXNzRG9jdW1lbnRWYWxpZGF0aW9uO1xuICAgICAgICB9XG4gICAgICAgIC8vIHdlIGNoZWNrIGZvciB1bmRlZmluZWQgc3BlY2lmaWNhbGx5IGhlcmUgdG8gYWxsb3cgZmFsc3kgdmFsdWVzXG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1yZXN0cmljdGVkLXN5bnRheFxuICAgICAgICBpZiAob3B0aW9ucy5jb21tZW50ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGNvbW1hbmQuY29tbWVudCA9IG9wdGlvbnMuY29tbWVudDtcbiAgICAgICAgfVxuICAgICAgICBzdXBlci5leGVjdXRlQ29tbWFuZENhbGxiYWNrKHNlcnZlciwgc2Vzc2lvbiwgY29tbWFuZCwgY2FsbGJhY2spO1xuICAgIH1cbn1cbmV4cG9ydHMuSW5zZXJ0T3BlcmF0aW9uID0gSW5zZXJ0T3BlcmF0aW9uO1xuY2xhc3MgSW5zZXJ0T25lT3BlcmF0aW9uIGV4dGVuZHMgSW5zZXJ0T3BlcmF0aW9uIHtcbiAgICBjb25zdHJ1Y3Rvcihjb2xsZWN0aW9uLCBkb2MsIG9wdGlvbnMpIHtcbiAgICAgICAgc3VwZXIoY29sbGVjdGlvbi5zLm5hbWVzcGFjZSwgKDAsIGNvbW1vbl9mdW5jdGlvbnNfMS5wcmVwYXJlRG9jcykoY29sbGVjdGlvbiwgW2RvY10sIG9wdGlvbnMpLCBvcHRpb25zKTtcbiAgICB9XG4gICAgZXhlY3V0ZUNhbGxiYWNrKHNlcnZlciwgc2Vzc2lvbiwgY2FsbGJhY2spIHtcbiAgICAgICAgc3VwZXIuZXhlY3V0ZUNhbGxiYWNrKHNlcnZlciwgc2Vzc2lvbiwgKGVyciwgcmVzKSA9PiB7XG4gICAgICAgICAgICBpZiAoZXJyIHx8IHJlcyA9PSBudWxsKVxuICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgICAgICAgICAgaWYgKHJlcy5jb2RlKVxuICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhuZXcgZXJyb3JfMS5Nb25nb1NlcnZlckVycm9yKHJlcykpO1xuICAgICAgICAgICAgaWYgKHJlcy53cml0ZUVycm9ycykge1xuICAgICAgICAgICAgICAgIC8vIFRoaXMgc2hvdWxkIGJlIGEgV3JpdGVFcnJvciBidXQgd2UgY2FuJ3QgY2hhbmdlIGl0IG5vdyBiZWNhdXNlIG9mIGVycm9yIGhpZXJhcmNoeVxuICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhuZXcgZXJyb3JfMS5Nb25nb1NlcnZlckVycm9yKHJlcy53cml0ZUVycm9yc1swXSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FsbGJhY2sodW5kZWZpbmVkLCB7XG4gICAgICAgICAgICAgICAgYWNrbm93bGVkZ2VkOiB0aGlzLndyaXRlQ29uY2Vybj8udyAhPT0gMCA/PyB0cnVlLFxuICAgICAgICAgICAgICAgIGluc2VydGVkSWQ6IHRoaXMuZG9jdW1lbnRzWzBdLl9pZFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmV4cG9ydHMuSW5zZXJ0T25lT3BlcmF0aW9uID0gSW5zZXJ0T25lT3BlcmF0aW9uO1xuLyoqIEBpbnRlcm5hbCAqL1xuY2xhc3MgSW5zZXJ0TWFueU9wZXJhdGlvbiBleHRlbmRzIG9wZXJhdGlvbl8xLkFic3RyYWN0Q2FsbGJhY2tPcGVyYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKGNvbGxlY3Rpb24sIGRvY3MsIG9wdGlvbnMpIHtcbiAgICAgICAgc3VwZXIob3B0aW9ucyk7XG4gICAgICAgIGlmICghQXJyYXkuaXNBcnJheShkb2NzKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignQXJndW1lbnQgXCJkb2NzXCIgbXVzdCBiZSBhbiBhcnJheSBvZiBkb2N1bWVudHMnKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuICAgICAgICB0aGlzLmNvbGxlY3Rpb24gPSBjb2xsZWN0aW9uO1xuICAgICAgICB0aGlzLmRvY3MgPSBkb2NzO1xuICAgIH1cbiAgICBleGVjdXRlQ2FsbGJhY2soc2VydmVyLCBzZXNzaW9uLCBjYWxsYmFjaykge1xuICAgICAgICBjb25zdCBjb2xsID0gdGhpcy5jb2xsZWN0aW9uO1xuICAgICAgICBjb25zdCBvcHRpb25zID0geyAuLi50aGlzLm9wdGlvbnMsIC4uLnRoaXMuYnNvbk9wdGlvbnMsIHJlYWRQcmVmZXJlbmNlOiB0aGlzLnJlYWRQcmVmZXJlbmNlIH07XG4gICAgICAgIGNvbnN0IHdyaXRlQ29uY2VybiA9IHdyaXRlX2NvbmNlcm5fMS5Xcml0ZUNvbmNlcm4uZnJvbU9wdGlvbnMob3B0aW9ucyk7XG4gICAgICAgIGNvbnN0IGJ1bGtXcml0ZU9wZXJhdGlvbiA9IG5ldyBidWxrX3dyaXRlXzEuQnVsa1dyaXRlT3BlcmF0aW9uKGNvbGwsICgwLCBjb21tb25fZnVuY3Rpb25zXzEucHJlcGFyZURvY3MpKGNvbGwsIHRoaXMuZG9jcywgb3B0aW9ucykubWFwKGRvY3VtZW50ID0+ICh7IGluc2VydE9uZTogeyBkb2N1bWVudCB9IH0pKSwgb3B0aW9ucyk7XG4gICAgICAgIGJ1bGtXcml0ZU9wZXJhdGlvbi5leGVjdXRlQ2FsbGJhY2soc2VydmVyLCBzZXNzaW9uLCAoZXJyLCByZXMpID0+IHtcbiAgICAgICAgICAgIGlmIChlcnIgfHwgcmVzID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAoZXJyICYmIGVyci5tZXNzYWdlID09PSAnT3BlcmF0aW9uIG11c3QgYmUgYW4gb2JqZWN0IHdpdGggYW4gb3BlcmF0aW9uIGtleScpIHtcbiAgICAgICAgICAgICAgICAgICAgZXJyID0gbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignQ29sbGVjdGlvbi5pbnNlcnRNYW55KCkgY2Fubm90IGJlIGNhbGxlZCB3aXRoIGFuIGFycmF5IHRoYXQgaGFzIG51bGwvdW5kZWZpbmVkIHZhbHVlcycpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwge1xuICAgICAgICAgICAgICAgIGFja25vd2xlZGdlZDogd3JpdGVDb25jZXJuPy53ICE9PSAwID8/IHRydWUsXG4gICAgICAgICAgICAgICAgaW5zZXJ0ZWRDb3VudDogcmVzLmluc2VydGVkQ291bnQsXG4gICAgICAgICAgICAgICAgaW5zZXJ0ZWRJZHM6IHJlcy5pbnNlcnRlZElkc1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmV4cG9ydHMuSW5zZXJ0TWFueU9wZXJhdGlvbiA9IEluc2VydE1hbnlPcGVyYXRpb247XG4oMCwgb3BlcmF0aW9uXzEuZGVmaW5lQXNwZWN0cykoSW5zZXJ0T3BlcmF0aW9uLCBbb3BlcmF0aW9uXzEuQXNwZWN0LlJFVFJZQUJMRSwgb3BlcmF0aW9uXzEuQXNwZWN0LldSSVRFX09QRVJBVElPTl0pO1xuKDAsIG9wZXJhdGlvbl8xLmRlZmluZUFzcGVjdHMpKEluc2VydE9uZU9wZXJhdGlvbiwgW29wZXJhdGlvbl8xLkFzcGVjdC5SRVRSWUFCTEUsIG9wZXJhdGlvbl8xLkFzcGVjdC5XUklURV9PUEVSQVRJT05dKTtcbigwLCBvcGVyYXRpb25fMS5kZWZpbmVBc3BlY3RzKShJbnNlcnRNYW55T3BlcmF0aW9uLCBbb3BlcmF0aW9uXzEuQXNwZWN0LldSSVRFX09QRVJBVElPTl0pO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5zZXJ0LmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/operations/insert.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/operations/is_capped.js":
/*!******************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/operations/is_capped.js ***!
  \******************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.IsCappedOperation = void 0;\nconst error_1 = __webpack_require__(/*! ../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(api)/../server/node_modules/mongodb/lib/operations/operation.js\");\n/** @internal */\nclass IsCappedOperation extends operation_1.AbstractCallbackOperation {\n    constructor(collection, options) {\n        super(options);\n        this.options = options;\n        this.collection = collection;\n    }\n    executeCallback(server, session, callback) {\n        const coll = this.collection;\n        coll.s.db\n            .listCollections({ name: coll.collectionName }, { ...this.options, nameOnly: false, readPreference: this.readPreference, session })\n            .toArray()\n            .then(collections => {\n            if (collections.length === 0) {\n                // TODO(NODE-3485)\n                return callback(new error_1.MongoAPIError(`collection ${coll.namespace} not found`));\n            }\n            callback(undefined, !!collections[0].options?.capped);\n        }, error => callback(error));\n    }\n}\nexports.IsCappedOperation = IsCappedOperation;\n//# sourceMappingURL=is_capped.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL2lzX2NhcHBlZC5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCx5QkFBeUI7QUFDekIsZ0JBQWdCLG1CQUFPLENBQUMsbUVBQVU7QUFDbEMsb0JBQW9CLG1CQUFPLENBQUMscUZBQWE7QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsMkJBQTJCLElBQUksZ0ZBQWdGO0FBQzlJO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0VBQXdFLGdCQUFnQjtBQUN4RjtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekIiLCJzb3VyY2VzIjpbIkQ6XFxzYWxvbmlcXGFwcHJhaXNhbC1zeXN0ZW1cXHNlcnZlclxcbm9kZV9tb2R1bGVzXFxtb25nb2RiXFxsaWJcXG9wZXJhdGlvbnNcXGlzX2NhcHBlZC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuSXNDYXBwZWRPcGVyYXRpb24gPSB2b2lkIDA7XG5jb25zdCBlcnJvcl8xID0gcmVxdWlyZShcIi4uL2Vycm9yXCIpO1xuY29uc3Qgb3BlcmF0aW9uXzEgPSByZXF1aXJlKFwiLi9vcGVyYXRpb25cIik7XG4vKiogQGludGVybmFsICovXG5jbGFzcyBJc0NhcHBlZE9wZXJhdGlvbiBleHRlbmRzIG9wZXJhdGlvbl8xLkFic3RyYWN0Q2FsbGJhY2tPcGVyYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKGNvbGxlY3Rpb24sIG9wdGlvbnMpIHtcbiAgICAgICAgc3VwZXIob3B0aW9ucyk7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XG4gICAgICAgIHRoaXMuY29sbGVjdGlvbiA9IGNvbGxlY3Rpb247XG4gICAgfVxuICAgIGV4ZWN1dGVDYWxsYmFjayhzZXJ2ZXIsIHNlc3Npb24sIGNhbGxiYWNrKSB7XG4gICAgICAgIGNvbnN0IGNvbGwgPSB0aGlzLmNvbGxlY3Rpb247XG4gICAgICAgIGNvbGwucy5kYlxuICAgICAgICAgICAgLmxpc3RDb2xsZWN0aW9ucyh7IG5hbWU6IGNvbGwuY29sbGVjdGlvbk5hbWUgfSwgeyAuLi50aGlzLm9wdGlvbnMsIG5hbWVPbmx5OiBmYWxzZSwgcmVhZFByZWZlcmVuY2U6IHRoaXMucmVhZFByZWZlcmVuY2UsIHNlc3Npb24gfSlcbiAgICAgICAgICAgIC50b0FycmF5KClcbiAgICAgICAgICAgIC50aGVuKGNvbGxlY3Rpb25zID0+IHtcbiAgICAgICAgICAgIGlmIChjb2xsZWN0aW9ucy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAvLyBUT0RPKE5PREUtMzQ4NSlcbiAgICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2sobmV3IGVycm9yXzEuTW9uZ29BUElFcnJvcihgY29sbGVjdGlvbiAke2NvbGwubmFtZXNwYWNlfSBub3QgZm91bmRgKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYWxsYmFjayh1bmRlZmluZWQsICEhY29sbGVjdGlvbnNbMF0ub3B0aW9ucz8uY2FwcGVkKTtcbiAgICAgICAgfSwgZXJyb3IgPT4gY2FsbGJhY2soZXJyb3IpKTtcbiAgICB9XG59XG5leHBvcnRzLklzQ2FwcGVkT3BlcmF0aW9uID0gSXNDYXBwZWRPcGVyYXRpb247XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pc19jYXBwZWQuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/operations/is_capped.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/operations/kill_cursors.js":
/*!*********************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/operations/kill_cursors.js ***!
  \*********************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.KillCursorsOperation = void 0;\nconst error_1 = __webpack_require__(/*! ../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(api)/../server/node_modules/mongodb/lib/operations/operation.js\");\nclass KillCursorsOperation extends operation_1.AbstractCallbackOperation {\n    constructor(cursorId, ns, server, options) {\n        super(options);\n        this.ns = ns;\n        this.cursorId = cursorId;\n        this.server = server;\n    }\n    executeCallback(server, session, callback) {\n        if (server !== this.server) {\n            return callback(new error_1.MongoRuntimeError('Killcursor must run on the same server operation began on'));\n        }\n        const killCursors = this.ns.collection;\n        if (killCursors == null) {\n            // Cursors should have adopted the namespace returned by MongoDB\n            // which should always defined a collection name (even a pseudo one, ex. db.aggregate())\n            return callback(new error_1.MongoRuntimeError('A collection name must be determined before killCursors'));\n        }\n        const killCursorsCommand = {\n            killCursors,\n            cursors: [this.cursorId]\n        };\n        server.command(this.ns, killCursorsCommand, { session }, () => callback());\n    }\n}\nexports.KillCursorsOperation = KillCursorsOperation;\n(0, operation_1.defineAspects)(KillCursorsOperation, [operation_1.Aspect.MUST_SELECT_SAME_SERVER]);\n//# sourceMappingURL=kill_cursors.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL2tpbGxfY3Vyc29ycy5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCw0QkFBNEI7QUFDNUIsZ0JBQWdCLG1CQUFPLENBQUMsbUVBQVU7QUFDbEMsb0JBQW9CLG1CQUFPLENBQUMscUZBQWE7QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0RBQXNELFNBQVM7QUFDL0Q7QUFDQTtBQUNBLDRCQUE0QjtBQUM1QjtBQUNBIiwic291cmNlcyI6WyJEOlxcc2Fsb25pXFxhcHByYWlzYWwtc3lzdGVtXFxzZXJ2ZXJcXG5vZGVfbW9kdWxlc1xcbW9uZ29kYlxcbGliXFxvcGVyYXRpb25zXFxraWxsX2N1cnNvcnMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLktpbGxDdXJzb3JzT3BlcmF0aW9uID0gdm9pZCAwO1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuLi9lcnJvclwiKTtcbmNvbnN0IG9wZXJhdGlvbl8xID0gcmVxdWlyZShcIi4vb3BlcmF0aW9uXCIpO1xuY2xhc3MgS2lsbEN1cnNvcnNPcGVyYXRpb24gZXh0ZW5kcyBvcGVyYXRpb25fMS5BYnN0cmFjdENhbGxiYWNrT3BlcmF0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcihjdXJzb3JJZCwgbnMsIHNlcnZlciwgb3B0aW9ucykge1xuICAgICAgICBzdXBlcihvcHRpb25zKTtcbiAgICAgICAgdGhpcy5ucyA9IG5zO1xuICAgICAgICB0aGlzLmN1cnNvcklkID0gY3Vyc29ySWQ7XG4gICAgICAgIHRoaXMuc2VydmVyID0gc2VydmVyO1xuICAgIH1cbiAgICBleGVjdXRlQ2FsbGJhY2soc2VydmVyLCBzZXNzaW9uLCBjYWxsYmFjaykge1xuICAgICAgICBpZiAoc2VydmVyICE9PSB0aGlzLnNlcnZlcikge1xuICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKG5ldyBlcnJvcl8xLk1vbmdvUnVudGltZUVycm9yKCdLaWxsY3Vyc29yIG11c3QgcnVuIG9uIHRoZSBzYW1lIHNlcnZlciBvcGVyYXRpb24gYmVnYW4gb24nKSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qga2lsbEN1cnNvcnMgPSB0aGlzLm5zLmNvbGxlY3Rpb247XG4gICAgICAgIGlmIChraWxsQ3Vyc29ycyA9PSBudWxsKSB7XG4gICAgICAgICAgICAvLyBDdXJzb3JzIHNob3VsZCBoYXZlIGFkb3B0ZWQgdGhlIG5hbWVzcGFjZSByZXR1cm5lZCBieSBNb25nb0RCXG4gICAgICAgICAgICAvLyB3aGljaCBzaG91bGQgYWx3YXlzIGRlZmluZWQgYSBjb2xsZWN0aW9uIG5hbWUgKGV2ZW4gYSBwc2V1ZG8gb25lLCBleC4gZGIuYWdncmVnYXRlKCkpXG4gICAgICAgICAgICByZXR1cm4gY2FsbGJhY2sobmV3IGVycm9yXzEuTW9uZ29SdW50aW1lRXJyb3IoJ0EgY29sbGVjdGlvbiBuYW1lIG11c3QgYmUgZGV0ZXJtaW5lZCBiZWZvcmUga2lsbEN1cnNvcnMnKSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qga2lsbEN1cnNvcnNDb21tYW5kID0ge1xuICAgICAgICAgICAga2lsbEN1cnNvcnMsXG4gICAgICAgICAgICBjdXJzb3JzOiBbdGhpcy5jdXJzb3JJZF1cbiAgICAgICAgfTtcbiAgICAgICAgc2VydmVyLmNvbW1hbmQodGhpcy5ucywga2lsbEN1cnNvcnNDb21tYW5kLCB7IHNlc3Npb24gfSwgKCkgPT4gY2FsbGJhY2soKSk7XG4gICAgfVxufVxuZXhwb3J0cy5LaWxsQ3Vyc29yc09wZXJhdGlvbiA9IEtpbGxDdXJzb3JzT3BlcmF0aW9uO1xuKDAsIG9wZXJhdGlvbl8xLmRlZmluZUFzcGVjdHMpKEtpbGxDdXJzb3JzT3BlcmF0aW9uLCBbb3BlcmF0aW9uXzEuQXNwZWN0Lk1VU1RfU0VMRUNUX1NBTUVfU0VSVkVSXSk7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1raWxsX2N1cnNvcnMuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/operations/kill_cursors.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/operations/list_collections.js":
/*!*************************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/operations/list_collections.js ***!
  \*************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.ListCollectionsOperation = void 0;\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\nconst command_1 = __webpack_require__(/*! ./command */ \"(api)/../server/node_modules/mongodb/lib/operations/command.js\");\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(api)/../server/node_modules/mongodb/lib/operations/operation.js\");\n/** @internal */\nclass ListCollectionsOperation extends command_1.CommandCallbackOperation {\n    constructor(db, filter, options) {\n        super(db, options);\n        this.options = { ...options };\n        delete this.options.writeConcern;\n        this.db = db;\n        this.filter = filter;\n        this.nameOnly = !!this.options.nameOnly;\n        this.authorizedCollections = !!this.options.authorizedCollections;\n        if (typeof this.options.batchSize === 'number') {\n            this.batchSize = this.options.batchSize;\n        }\n    }\n    executeCallback(server, session, callback) {\n        return super.executeCommandCallback(server, session, this.generateCommand((0, utils_1.maxWireVersion)(server)), callback);\n    }\n    /* This is here for the purpose of unit testing the final command that gets sent. */\n    generateCommand(wireVersion) {\n        const command = {\n            listCollections: 1,\n            filter: this.filter,\n            cursor: this.batchSize ? { batchSize: this.batchSize } : {},\n            nameOnly: this.nameOnly,\n            authorizedCollections: this.authorizedCollections\n        };\n        // we check for undefined specifically here to allow falsy values\n        // eslint-disable-next-line no-restricted-syntax\n        if (wireVersion >= 9 && this.options.comment !== undefined) {\n            command.comment = this.options.comment;\n        }\n        return command;\n    }\n}\nexports.ListCollectionsOperation = ListCollectionsOperation;\n(0, operation_1.defineAspects)(ListCollectionsOperation, [\n    operation_1.Aspect.READ_OPERATION,\n    operation_1.Aspect.RETRYABLE,\n    operation_1.Aspect.CURSOR_CREATING\n]);\n//# sourceMappingURL=list_collections.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL2xpc3RfY29sbGVjdGlvbnMuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsZ0NBQWdDO0FBQ2hDLGdCQUFnQixtQkFBTyxDQUFDLG1FQUFVO0FBQ2xDLGtCQUFrQixtQkFBTyxDQUFDLGlGQUFXO0FBQ3JDLG9CQUFvQixtQkFBTyxDQUFDLHFGQUFhO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1Q0FBdUMsNEJBQTRCLElBQUk7QUFDdkU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQztBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIkQ6XFxzYWxvbmlcXGFwcHJhaXNhbC1zeXN0ZW1cXHNlcnZlclxcbm9kZV9tb2R1bGVzXFxtb25nb2RiXFxsaWJcXG9wZXJhdGlvbnNcXGxpc3RfY29sbGVjdGlvbnMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkxpc3RDb2xsZWN0aW9uc09wZXJhdGlvbiA9IHZvaWQgMDtcbmNvbnN0IHV0aWxzXzEgPSByZXF1aXJlKFwiLi4vdXRpbHNcIik7XG5jb25zdCBjb21tYW5kXzEgPSByZXF1aXJlKFwiLi9jb21tYW5kXCIpO1xuY29uc3Qgb3BlcmF0aW9uXzEgPSByZXF1aXJlKFwiLi9vcGVyYXRpb25cIik7XG4vKiogQGludGVybmFsICovXG5jbGFzcyBMaXN0Q29sbGVjdGlvbnNPcGVyYXRpb24gZXh0ZW5kcyBjb21tYW5kXzEuQ29tbWFuZENhbGxiYWNrT3BlcmF0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcihkYiwgZmlsdGVyLCBvcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKGRiLCBvcHRpb25zKTtcbiAgICAgICAgdGhpcy5vcHRpb25zID0geyAuLi5vcHRpb25zIH07XG4gICAgICAgIGRlbGV0ZSB0aGlzLm9wdGlvbnMud3JpdGVDb25jZXJuO1xuICAgICAgICB0aGlzLmRiID0gZGI7XG4gICAgICAgIHRoaXMuZmlsdGVyID0gZmlsdGVyO1xuICAgICAgICB0aGlzLm5hbWVPbmx5ID0gISF0aGlzLm9wdGlvbnMubmFtZU9ubHk7XG4gICAgICAgIHRoaXMuYXV0aG9yaXplZENvbGxlY3Rpb25zID0gISF0aGlzLm9wdGlvbnMuYXV0aG9yaXplZENvbGxlY3Rpb25zO1xuICAgICAgICBpZiAodHlwZW9mIHRoaXMub3B0aW9ucy5iYXRjaFNpemUgPT09ICdudW1iZXInKSB7XG4gICAgICAgICAgICB0aGlzLmJhdGNoU2l6ZSA9IHRoaXMub3B0aW9ucy5iYXRjaFNpemU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZXhlY3V0ZUNhbGxiYWNrKHNlcnZlciwgc2Vzc2lvbiwgY2FsbGJhY2spIHtcbiAgICAgICAgcmV0dXJuIHN1cGVyLmV4ZWN1dGVDb21tYW5kQ2FsbGJhY2soc2VydmVyLCBzZXNzaW9uLCB0aGlzLmdlbmVyYXRlQ29tbWFuZCgoMCwgdXRpbHNfMS5tYXhXaXJlVmVyc2lvbikoc2VydmVyKSksIGNhbGxiYWNrKTtcbiAgICB9XG4gICAgLyogVGhpcyBpcyBoZXJlIGZvciB0aGUgcHVycG9zZSBvZiB1bml0IHRlc3RpbmcgdGhlIGZpbmFsIGNvbW1hbmQgdGhhdCBnZXRzIHNlbnQuICovXG4gICAgZ2VuZXJhdGVDb21tYW5kKHdpcmVWZXJzaW9uKSB7XG4gICAgICAgIGNvbnN0IGNvbW1hbmQgPSB7XG4gICAgICAgICAgICBsaXN0Q29sbGVjdGlvbnM6IDEsXG4gICAgICAgICAgICBmaWx0ZXI6IHRoaXMuZmlsdGVyLFxuICAgICAgICAgICAgY3Vyc29yOiB0aGlzLmJhdGNoU2l6ZSA/IHsgYmF0Y2hTaXplOiB0aGlzLmJhdGNoU2l6ZSB9IDoge30sXG4gICAgICAgICAgICBuYW1lT25seTogdGhpcy5uYW1lT25seSxcbiAgICAgICAgICAgIGF1dGhvcml6ZWRDb2xsZWN0aW9uczogdGhpcy5hdXRob3JpemVkQ29sbGVjdGlvbnNcbiAgICAgICAgfTtcbiAgICAgICAgLy8gd2UgY2hlY2sgZm9yIHVuZGVmaW5lZCBzcGVjaWZpY2FsbHkgaGVyZSB0byBhbGxvdyBmYWxzeSB2YWx1ZXNcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXJlc3RyaWN0ZWQtc3ludGF4XG4gICAgICAgIGlmICh3aXJlVmVyc2lvbiA+PSA5ICYmIHRoaXMub3B0aW9ucy5jb21tZW50ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGNvbW1hbmQuY29tbWVudCA9IHRoaXMub3B0aW9ucy5jb21tZW50O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjb21tYW5kO1xuICAgIH1cbn1cbmV4cG9ydHMuTGlzdENvbGxlY3Rpb25zT3BlcmF0aW9uID0gTGlzdENvbGxlY3Rpb25zT3BlcmF0aW9uO1xuKDAsIG9wZXJhdGlvbl8xLmRlZmluZUFzcGVjdHMpKExpc3RDb2xsZWN0aW9uc09wZXJhdGlvbiwgW1xuICAgIG9wZXJhdGlvbl8xLkFzcGVjdC5SRUFEX09QRVJBVElPTixcbiAgICBvcGVyYXRpb25fMS5Bc3BlY3QuUkVUUllBQkxFLFxuICAgIG9wZXJhdGlvbl8xLkFzcGVjdC5DVVJTT1JfQ1JFQVRJTkdcbl0pO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9bGlzdF9jb2xsZWN0aW9ucy5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/operations/list_collections.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/operations/list_databases.js":
/*!***********************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/operations/list_databases.js ***!
  \***********************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.ListDatabasesOperation = void 0;\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\nconst command_1 = __webpack_require__(/*! ./command */ \"(api)/../server/node_modules/mongodb/lib/operations/command.js\");\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(api)/../server/node_modules/mongodb/lib/operations/operation.js\");\n/** @internal */\nclass ListDatabasesOperation extends command_1.CommandCallbackOperation {\n    constructor(db, options) {\n        super(db, options);\n        this.options = options ?? {};\n        this.ns = new utils_1.MongoDBNamespace('admin', '$cmd');\n    }\n    executeCallback(server, session, callback) {\n        const cmd = { listDatabases: 1 };\n        if (typeof this.options.nameOnly === 'boolean') {\n            cmd.nameOnly = this.options.nameOnly;\n        }\n        if (this.options.filter) {\n            cmd.filter = this.options.filter;\n        }\n        if (typeof this.options.authorizedDatabases === 'boolean') {\n            cmd.authorizedDatabases = this.options.authorizedDatabases;\n        }\n        // we check for undefined specifically here to allow falsy values\n        // eslint-disable-next-line no-restricted-syntax\n        if ((0, utils_1.maxWireVersion)(server) >= 9 && this.options.comment !== undefined) {\n            cmd.comment = this.options.comment;\n        }\n        super.executeCommandCallback(server, session, cmd, callback);\n    }\n}\nexports.ListDatabasesOperation = ListDatabasesOperation;\n(0, operation_1.defineAspects)(ListDatabasesOperation, [operation_1.Aspect.READ_OPERATION, operation_1.Aspect.RETRYABLE]);\n//# sourceMappingURL=list_databases.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL2xpc3RfZGF0YWJhc2VzLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELDhCQUE4QjtBQUM5QixnQkFBZ0IsbUJBQU8sQ0FBQyxtRUFBVTtBQUNsQyxrQkFBa0IsbUJBQU8sQ0FBQyxpRkFBVztBQUNyQyxvQkFBb0IsbUJBQU8sQ0FBQyxxRkFBYTtBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFBOEI7QUFDOUI7QUFDQSIsInNvdXJjZXMiOlsiRDpcXHNhbG9uaVxcYXBwcmFpc2FsLXN5c3RlbVxcc2VydmVyXFxub2RlX21vZHVsZXNcXG1vbmdvZGJcXGxpYlxcb3BlcmF0aW9uc1xcbGlzdF9kYXRhYmFzZXMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkxpc3REYXRhYmFzZXNPcGVyYXRpb24gPSB2b2lkIDA7XG5jb25zdCB1dGlsc18xID0gcmVxdWlyZShcIi4uL3V0aWxzXCIpO1xuY29uc3QgY29tbWFuZF8xID0gcmVxdWlyZShcIi4vY29tbWFuZFwiKTtcbmNvbnN0IG9wZXJhdGlvbl8xID0gcmVxdWlyZShcIi4vb3BlcmF0aW9uXCIpO1xuLyoqIEBpbnRlcm5hbCAqL1xuY2xhc3MgTGlzdERhdGFiYXNlc09wZXJhdGlvbiBleHRlbmRzIGNvbW1hbmRfMS5Db21tYW5kQ2FsbGJhY2tPcGVyYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKGRiLCBvcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKGRiLCBvcHRpb25zKTtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucyA/PyB7fTtcbiAgICAgICAgdGhpcy5ucyA9IG5ldyB1dGlsc18xLk1vbmdvREJOYW1lc3BhY2UoJ2FkbWluJywgJyRjbWQnKTtcbiAgICB9XG4gICAgZXhlY3V0ZUNhbGxiYWNrKHNlcnZlciwgc2Vzc2lvbiwgY2FsbGJhY2spIHtcbiAgICAgICAgY29uc3QgY21kID0geyBsaXN0RGF0YWJhc2VzOiAxIH07XG4gICAgICAgIGlmICh0eXBlb2YgdGhpcy5vcHRpb25zLm5hbWVPbmx5ID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgIGNtZC5uYW1lT25seSA9IHRoaXMub3B0aW9ucy5uYW1lT25seTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmZpbHRlcikge1xuICAgICAgICAgICAgY21kLmZpbHRlciA9IHRoaXMub3B0aW9ucy5maWx0ZXI7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiB0aGlzLm9wdGlvbnMuYXV0aG9yaXplZERhdGFiYXNlcyA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICBjbWQuYXV0aG9yaXplZERhdGFiYXNlcyA9IHRoaXMub3B0aW9ucy5hdXRob3JpemVkRGF0YWJhc2VzO1xuICAgICAgICB9XG4gICAgICAgIC8vIHdlIGNoZWNrIGZvciB1bmRlZmluZWQgc3BlY2lmaWNhbGx5IGhlcmUgdG8gYWxsb3cgZmFsc3kgdmFsdWVzXG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1yZXN0cmljdGVkLXN5bnRheFxuICAgICAgICBpZiAoKDAsIHV0aWxzXzEubWF4V2lyZVZlcnNpb24pKHNlcnZlcikgPj0gOSAmJiB0aGlzLm9wdGlvbnMuY29tbWVudCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBjbWQuY29tbWVudCA9IHRoaXMub3B0aW9ucy5jb21tZW50O1xuICAgICAgICB9XG4gICAgICAgIHN1cGVyLmV4ZWN1dGVDb21tYW5kQ2FsbGJhY2soc2VydmVyLCBzZXNzaW9uLCBjbWQsIGNhbGxiYWNrKTtcbiAgICB9XG59XG5leHBvcnRzLkxpc3REYXRhYmFzZXNPcGVyYXRpb24gPSBMaXN0RGF0YWJhc2VzT3BlcmF0aW9uO1xuKDAsIG9wZXJhdGlvbl8xLmRlZmluZUFzcGVjdHMpKExpc3REYXRhYmFzZXNPcGVyYXRpb24sIFtvcGVyYXRpb25fMS5Bc3BlY3QuUkVBRF9PUEVSQVRJT04sIG9wZXJhdGlvbl8xLkFzcGVjdC5SRVRSWUFCTEVdKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWxpc3RfZGF0YWJhc2VzLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/operations/list_databases.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/operations/operation.js":
/*!******************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/operations/operation.js ***!
  \******************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.defineAspects = exports.AbstractCallbackOperation = exports.AbstractOperation = exports.Aspect = void 0;\nconst util_1 = __webpack_require__(/*! util */ \"util\");\nconst bson_1 = __webpack_require__(/*! ../bson */ \"(api)/../server/node_modules/mongodb/lib/bson.js\");\nconst read_preference_1 = __webpack_require__(/*! ../read_preference */ \"(api)/../server/node_modules/mongodb/lib/read_preference.js\");\nexports.Aspect = {\n    READ_OPERATION: Symbol('READ_OPERATION'),\n    WRITE_OPERATION: Symbol('WRITE_OPERATION'),\n    RETRYABLE: Symbol('RETRYABLE'),\n    EXPLAINABLE: Symbol('EXPLAINABLE'),\n    SKIP_COLLATION: Symbol('SKIP_COLLATION'),\n    CURSOR_CREATING: Symbol('CURSOR_CREATING'),\n    MUST_SELECT_SAME_SERVER: Symbol('MUST_SELECT_SAME_SERVER')\n};\n/** @internal */\nconst kSession = Symbol('session');\n/**\n * This class acts as a parent class for any operation and is responsible for setting this.options,\n * as well as setting and getting a session.\n * Additionally, this class implements `hasAspect`, which determines whether an operation has\n * a specific aspect.\n * @internal\n */\nclass AbstractOperation {\n    constructor(options = {}) {\n        this.readPreference = this.hasAspect(exports.Aspect.WRITE_OPERATION)\n            ? read_preference_1.ReadPreference.primary\n            : read_preference_1.ReadPreference.fromOptions(options) ?? read_preference_1.ReadPreference.primary;\n        // Pull the BSON serialize options from the already-resolved options\n        this.bsonOptions = (0, bson_1.resolveBSONOptions)(options);\n        this[kSession] = options.session != null ? options.session : undefined;\n        this.options = options;\n        this.bypassPinningCheck = !!options.bypassPinningCheck;\n        this.trySecondaryWrite = false;\n    }\n    hasAspect(aspect) {\n        const ctor = this.constructor;\n        if (ctor.aspects == null) {\n            return false;\n        }\n        return ctor.aspects.has(aspect);\n    }\n    get session() {\n        return this[kSession];\n    }\n    clearSession() {\n        this[kSession] = undefined;\n    }\n    get canRetryRead() {\n        return true;\n    }\n    get canRetryWrite() {\n        return true;\n    }\n}\nexports.AbstractOperation = AbstractOperation;\n/** @internal */\nclass AbstractCallbackOperation extends AbstractOperation {\n    constructor(options = {}) {\n        super(options);\n    }\n    execute(server, session) {\n        return (0, util_1.promisify)((callback) => {\n            this.executeCallback(server, session, callback);\n        })();\n    }\n}\nexports.AbstractCallbackOperation = AbstractCallbackOperation;\nfunction defineAspects(operation, aspects) {\n    if (!Array.isArray(aspects) && !(aspects instanceof Set)) {\n        aspects = [aspects];\n    }\n    aspects = new Set(aspects);\n    Object.defineProperty(operation, 'aspects', {\n        value: aspects,\n        writable: false\n    });\n    return aspects;\n}\nexports.defineAspects = defineAspects;\n//# sourceMappingURL=operation.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL29wZXJhdGlvbi5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxxQkFBcUIsR0FBRyxpQ0FBaUMsR0FBRyx5QkFBeUIsR0FBRyxjQUFjO0FBQ3RHLGVBQWUsbUJBQU8sQ0FBQyxrQkFBTTtBQUM3QixlQUFlLG1CQUFPLENBQUMsaUVBQVM7QUFDaEMsMEJBQTBCLG1CQUFPLENBQUMsdUZBQW9CO0FBQ3RELGNBQWM7QUFDZDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEI7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQSw0QkFBNEI7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsaUNBQWlDO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQiIsInNvdXJjZXMiOlsiRDpcXHNhbG9uaVxcYXBwcmFpc2FsLXN5c3RlbVxcc2VydmVyXFxub2RlX21vZHVsZXNcXG1vbmdvZGJcXGxpYlxcb3BlcmF0aW9uc1xcb3BlcmF0aW9uLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5kZWZpbmVBc3BlY3RzID0gZXhwb3J0cy5BYnN0cmFjdENhbGxiYWNrT3BlcmF0aW9uID0gZXhwb3J0cy5BYnN0cmFjdE9wZXJhdGlvbiA9IGV4cG9ydHMuQXNwZWN0ID0gdm9pZCAwO1xuY29uc3QgdXRpbF8xID0gcmVxdWlyZShcInV0aWxcIik7XG5jb25zdCBic29uXzEgPSByZXF1aXJlKFwiLi4vYnNvblwiKTtcbmNvbnN0IHJlYWRfcHJlZmVyZW5jZV8xID0gcmVxdWlyZShcIi4uL3JlYWRfcHJlZmVyZW5jZVwiKTtcbmV4cG9ydHMuQXNwZWN0ID0ge1xuICAgIFJFQURfT1BFUkFUSU9OOiBTeW1ib2woJ1JFQURfT1BFUkFUSU9OJyksXG4gICAgV1JJVEVfT1BFUkFUSU9OOiBTeW1ib2woJ1dSSVRFX09QRVJBVElPTicpLFxuICAgIFJFVFJZQUJMRTogU3ltYm9sKCdSRVRSWUFCTEUnKSxcbiAgICBFWFBMQUlOQUJMRTogU3ltYm9sKCdFWFBMQUlOQUJMRScpLFxuICAgIFNLSVBfQ09MTEFUSU9OOiBTeW1ib2woJ1NLSVBfQ09MTEFUSU9OJyksXG4gICAgQ1VSU09SX0NSRUFUSU5HOiBTeW1ib2woJ0NVUlNPUl9DUkVBVElORycpLFxuICAgIE1VU1RfU0VMRUNUX1NBTUVfU0VSVkVSOiBTeW1ib2woJ01VU1RfU0VMRUNUX1NBTUVfU0VSVkVSJylcbn07XG4vKiogQGludGVybmFsICovXG5jb25zdCBrU2Vzc2lvbiA9IFN5bWJvbCgnc2Vzc2lvbicpO1xuLyoqXG4gKiBUaGlzIGNsYXNzIGFjdHMgYXMgYSBwYXJlbnQgY2xhc3MgZm9yIGFueSBvcGVyYXRpb24gYW5kIGlzIHJlc3BvbnNpYmxlIGZvciBzZXR0aW5nIHRoaXMub3B0aW9ucyxcbiAqIGFzIHdlbGwgYXMgc2V0dGluZyBhbmQgZ2V0dGluZyBhIHNlc3Npb24uXG4gKiBBZGRpdGlvbmFsbHksIHRoaXMgY2xhc3MgaW1wbGVtZW50cyBgaGFzQXNwZWN0YCwgd2hpY2ggZGV0ZXJtaW5lcyB3aGV0aGVyIGFuIG9wZXJhdGlvbiBoYXNcbiAqIGEgc3BlY2lmaWMgYXNwZWN0LlxuICogQGludGVybmFsXG4gKi9cbmNsYXNzIEFic3RyYWN0T3BlcmF0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcihvcHRpb25zID0ge30pIHtcbiAgICAgICAgdGhpcy5yZWFkUHJlZmVyZW5jZSA9IHRoaXMuaGFzQXNwZWN0KGV4cG9ydHMuQXNwZWN0LldSSVRFX09QRVJBVElPTilcbiAgICAgICAgICAgID8gcmVhZF9wcmVmZXJlbmNlXzEuUmVhZFByZWZlcmVuY2UucHJpbWFyeVxuICAgICAgICAgICAgOiByZWFkX3ByZWZlcmVuY2VfMS5SZWFkUHJlZmVyZW5jZS5mcm9tT3B0aW9ucyhvcHRpb25zKSA/PyByZWFkX3ByZWZlcmVuY2VfMS5SZWFkUHJlZmVyZW5jZS5wcmltYXJ5O1xuICAgICAgICAvLyBQdWxsIHRoZSBCU09OIHNlcmlhbGl6ZSBvcHRpb25zIGZyb20gdGhlIGFscmVhZHktcmVzb2x2ZWQgb3B0aW9uc1xuICAgICAgICB0aGlzLmJzb25PcHRpb25zID0gKDAsIGJzb25fMS5yZXNvbHZlQlNPTk9wdGlvbnMpKG9wdGlvbnMpO1xuICAgICAgICB0aGlzW2tTZXNzaW9uXSA9IG9wdGlvbnMuc2Vzc2lvbiAhPSBudWxsID8gb3B0aW9ucy5zZXNzaW9uIDogdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuICAgICAgICB0aGlzLmJ5cGFzc1Bpbm5pbmdDaGVjayA9ICEhb3B0aW9ucy5ieXBhc3NQaW5uaW5nQ2hlY2s7XG4gICAgICAgIHRoaXMudHJ5U2Vjb25kYXJ5V3JpdGUgPSBmYWxzZTtcbiAgICB9XG4gICAgaGFzQXNwZWN0KGFzcGVjdCkge1xuICAgICAgICBjb25zdCBjdG9yID0gdGhpcy5jb25zdHJ1Y3RvcjtcbiAgICAgICAgaWYgKGN0b3IuYXNwZWN0cyA9PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGN0b3IuYXNwZWN0cy5oYXMoYXNwZWN0KTtcbiAgICB9XG4gICAgZ2V0IHNlc3Npb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzW2tTZXNzaW9uXTtcbiAgICB9XG4gICAgY2xlYXJTZXNzaW9uKCkge1xuICAgICAgICB0aGlzW2tTZXNzaW9uXSA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgZ2V0IGNhblJldHJ5UmVhZCgpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGdldCBjYW5SZXRyeVdyaXRlKCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG59XG5leHBvcnRzLkFic3RyYWN0T3BlcmF0aW9uID0gQWJzdHJhY3RPcGVyYXRpb247XG4vKiogQGludGVybmFsICovXG5jbGFzcyBBYnN0cmFjdENhbGxiYWNrT3BlcmF0aW9uIGV4dGVuZHMgQWJzdHJhY3RPcGVyYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMgPSB7fSkge1xuICAgICAgICBzdXBlcihvcHRpb25zKTtcbiAgICB9XG4gICAgZXhlY3V0ZShzZXJ2ZXIsIHNlc3Npb24pIHtcbiAgICAgICAgcmV0dXJuICgwLCB1dGlsXzEucHJvbWlzaWZ5KSgoY2FsbGJhY2spID0+IHtcbiAgICAgICAgICAgIHRoaXMuZXhlY3V0ZUNhbGxiYWNrKHNlcnZlciwgc2Vzc2lvbiwgY2FsbGJhY2spO1xuICAgICAgICB9KSgpO1xuICAgIH1cbn1cbmV4cG9ydHMuQWJzdHJhY3RDYWxsYmFja09wZXJhdGlvbiA9IEFic3RyYWN0Q2FsbGJhY2tPcGVyYXRpb247XG5mdW5jdGlvbiBkZWZpbmVBc3BlY3RzKG9wZXJhdGlvbiwgYXNwZWN0cykge1xuICAgIGlmICghQXJyYXkuaXNBcnJheShhc3BlY3RzKSAmJiAhKGFzcGVjdHMgaW5zdGFuY2VvZiBTZXQpKSB7XG4gICAgICAgIGFzcGVjdHMgPSBbYXNwZWN0c107XG4gICAgfVxuICAgIGFzcGVjdHMgPSBuZXcgU2V0KGFzcGVjdHMpO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvcGVyYXRpb24sICdhc3BlY3RzJywge1xuICAgICAgICB2YWx1ZTogYXNwZWN0cyxcbiAgICAgICAgd3JpdGFibGU6IGZhbHNlXG4gICAgfSk7XG4gICAgcmV0dXJuIGFzcGVjdHM7XG59XG5leHBvcnRzLmRlZmluZUFzcGVjdHMgPSBkZWZpbmVBc3BlY3RzO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9b3BlcmF0aW9uLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/operations/operation.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/operations/options_operation.js":
/*!**************************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/operations/options_operation.js ***!
  \**************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.OptionsOperation = void 0;\nconst error_1 = __webpack_require__(/*! ../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(api)/../server/node_modules/mongodb/lib/operations/operation.js\");\n/** @internal */\nclass OptionsOperation extends operation_1.AbstractCallbackOperation {\n    constructor(collection, options) {\n        super(options);\n        this.options = options;\n        this.collection = collection;\n    }\n    executeCallback(server, session, callback) {\n        const coll = this.collection;\n        coll.s.db\n            .listCollections({ name: coll.collectionName }, { ...this.options, nameOnly: false, readPreference: this.readPreference, session })\n            .toArray()\n            .then(collections => {\n            if (collections.length === 0) {\n                // TODO(NODE-3485)\n                return callback(new error_1.MongoAPIError(`collection ${coll.namespace} not found`));\n            }\n            callback(undefined, collections[0].options);\n        }, error => callback(error));\n    }\n}\nexports.OptionsOperation = OptionsOperation;\n//# sourceMappingURL=options_operation.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL29wdGlvbnNfb3BlcmF0aW9uLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELHdCQUF3QjtBQUN4QixnQkFBZ0IsbUJBQU8sQ0FBQyxtRUFBVTtBQUNsQyxvQkFBb0IsbUJBQU8sQ0FBQyxxRkFBYTtBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQiwyQkFBMkIsSUFBSSxnRkFBZ0Y7QUFDOUk7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3RUFBd0UsZ0JBQWdCO0FBQ3hGO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLHdCQUF3QjtBQUN4QiIsInNvdXJjZXMiOlsiRDpcXHNhbG9uaVxcYXBwcmFpc2FsLXN5c3RlbVxcc2VydmVyXFxub2RlX21vZHVsZXNcXG1vbmdvZGJcXGxpYlxcb3BlcmF0aW9uc1xcb3B0aW9uc19vcGVyYXRpb24uanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk9wdGlvbnNPcGVyYXRpb24gPSB2b2lkIDA7XG5jb25zdCBlcnJvcl8xID0gcmVxdWlyZShcIi4uL2Vycm9yXCIpO1xuY29uc3Qgb3BlcmF0aW9uXzEgPSByZXF1aXJlKFwiLi9vcGVyYXRpb25cIik7XG4vKiogQGludGVybmFsICovXG5jbGFzcyBPcHRpb25zT3BlcmF0aW9uIGV4dGVuZHMgb3BlcmF0aW9uXzEuQWJzdHJhY3RDYWxsYmFja09wZXJhdGlvbiB7XG4gICAgY29uc3RydWN0b3IoY29sbGVjdGlvbiwgb3B0aW9ucykge1xuICAgICAgICBzdXBlcihvcHRpb25zKTtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcbiAgICAgICAgdGhpcy5jb2xsZWN0aW9uID0gY29sbGVjdGlvbjtcbiAgICB9XG4gICAgZXhlY3V0ZUNhbGxiYWNrKHNlcnZlciwgc2Vzc2lvbiwgY2FsbGJhY2spIHtcbiAgICAgICAgY29uc3QgY29sbCA9IHRoaXMuY29sbGVjdGlvbjtcbiAgICAgICAgY29sbC5zLmRiXG4gICAgICAgICAgICAubGlzdENvbGxlY3Rpb25zKHsgbmFtZTogY29sbC5jb2xsZWN0aW9uTmFtZSB9LCB7IC4uLnRoaXMub3B0aW9ucywgbmFtZU9ubHk6IGZhbHNlLCByZWFkUHJlZmVyZW5jZTogdGhpcy5yZWFkUHJlZmVyZW5jZSwgc2Vzc2lvbiB9KVxuICAgICAgICAgICAgLnRvQXJyYXkoKVxuICAgICAgICAgICAgLnRoZW4oY29sbGVjdGlvbnMgPT4ge1xuICAgICAgICAgICAgaWYgKGNvbGxlY3Rpb25zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIC8vIFRPRE8oTk9ERS0zNDg1KVxuICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhuZXcgZXJyb3JfMS5Nb25nb0FQSUVycm9yKGBjb2xsZWN0aW9uICR7Y29sbC5uYW1lc3BhY2V9IG5vdCBmb3VuZGApKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwgY29sbGVjdGlvbnNbMF0ub3B0aW9ucyk7XG4gICAgICAgIH0sIGVycm9yID0+IGNhbGxiYWNrKGVycm9yKSk7XG4gICAgfVxufVxuZXhwb3J0cy5PcHRpb25zT3BlcmF0aW9uID0gT3B0aW9uc09wZXJhdGlvbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPW9wdGlvbnNfb3BlcmF0aW9uLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/operations/options_operation.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/operations/profiling_level.js":
/*!************************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/operations/profiling_level.js ***!
  \************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.ProfilingLevelOperation = void 0;\nconst error_1 = __webpack_require__(/*! ../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst command_1 = __webpack_require__(/*! ./command */ \"(api)/../server/node_modules/mongodb/lib/operations/command.js\");\n/** @internal */\nclass ProfilingLevelOperation extends command_1.CommandCallbackOperation {\n    constructor(db, options) {\n        super(db, options);\n        this.options = options;\n    }\n    executeCallback(server, session, callback) {\n        super.executeCommandCallback(server, session, { profile: -1 }, (err, doc) => {\n            if (err == null && doc.ok === 1) {\n                const was = doc.was;\n                if (was === 0)\n                    return callback(undefined, 'off');\n                if (was === 1)\n                    return callback(undefined, 'slow_only');\n                if (was === 2)\n                    return callback(undefined, 'all');\n                // TODO(NODE-3483)\n                return callback(new error_1.MongoRuntimeError(`Illegal profiling level value ${was}`));\n            }\n            else {\n                // TODO(NODE-3483): Consider MongoUnexpectedServerResponseError\n                err != null ? callback(err) : callback(new error_1.MongoRuntimeError('Error with profile command'));\n            }\n        });\n    }\n}\nexports.ProfilingLevelOperation = ProfilingLevelOperation;\n//# sourceMappingURL=profiling_level.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL3Byb2ZpbGluZ19sZXZlbC5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCwrQkFBK0I7QUFDL0IsZ0JBQWdCLG1CQUFPLENBQUMsbUVBQVU7QUFDbEMsa0JBQWtCLG1CQUFPLENBQUMsaUZBQVc7QUFDckM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3REFBd0QsYUFBYTtBQUNyRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrRkFBK0YsSUFBSTtBQUNuRztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSwrQkFBK0I7QUFDL0IiLCJzb3VyY2VzIjpbIkQ6XFxzYWxvbmlcXGFwcHJhaXNhbC1zeXN0ZW1cXHNlcnZlclxcbm9kZV9tb2R1bGVzXFxtb25nb2RiXFxsaWJcXG9wZXJhdGlvbnNcXHByb2ZpbGluZ19sZXZlbC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuUHJvZmlsaW5nTGV2ZWxPcGVyYXRpb24gPSB2b2lkIDA7XG5jb25zdCBlcnJvcl8xID0gcmVxdWlyZShcIi4uL2Vycm9yXCIpO1xuY29uc3QgY29tbWFuZF8xID0gcmVxdWlyZShcIi4vY29tbWFuZFwiKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIFByb2ZpbGluZ0xldmVsT3BlcmF0aW9uIGV4dGVuZHMgY29tbWFuZF8xLkNvbW1hbmRDYWxsYmFja09wZXJhdGlvbiB7XG4gICAgY29uc3RydWN0b3IoZGIsIG9wdGlvbnMpIHtcbiAgICAgICAgc3VwZXIoZGIsIG9wdGlvbnMpO1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuICAgIH1cbiAgICBleGVjdXRlQ2FsbGJhY2soc2VydmVyLCBzZXNzaW9uLCBjYWxsYmFjaykge1xuICAgICAgICBzdXBlci5leGVjdXRlQ29tbWFuZENhbGxiYWNrKHNlcnZlciwgc2Vzc2lvbiwgeyBwcm9maWxlOiAtMSB9LCAoZXJyLCBkb2MpID0+IHtcbiAgICAgICAgICAgIGlmIChlcnIgPT0gbnVsbCAmJiBkb2Mub2sgPT09IDEpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB3YXMgPSBkb2Mud2FzO1xuICAgICAgICAgICAgICAgIGlmICh3YXMgPT09IDApXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayh1bmRlZmluZWQsICdvZmYnKTtcbiAgICAgICAgICAgICAgICBpZiAod2FzID09PSAxKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2sodW5kZWZpbmVkLCAnc2xvd19vbmx5Jyk7XG4gICAgICAgICAgICAgICAgaWYgKHdhcyA9PT0gMilcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKHVuZGVmaW5lZCwgJ2FsbCcpO1xuICAgICAgICAgICAgICAgIC8vIFRPRE8oTk9ERS0zNDgzKVxuICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhuZXcgZXJyb3JfMS5Nb25nb1J1bnRpbWVFcnJvcihgSWxsZWdhbCBwcm9maWxpbmcgbGV2ZWwgdmFsdWUgJHt3YXN9YCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gVE9ETyhOT0RFLTM0ODMpOiBDb25zaWRlciBNb25nb1VuZXhwZWN0ZWRTZXJ2ZXJSZXNwb25zZUVycm9yXG4gICAgICAgICAgICAgICAgZXJyICE9IG51bGwgPyBjYWxsYmFjayhlcnIpIDogY2FsbGJhY2sobmV3IGVycm9yXzEuTW9uZ29SdW50aW1lRXJyb3IoJ0Vycm9yIHdpdGggcHJvZmlsZSBjb21tYW5kJykpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG59XG5leHBvcnRzLlByb2ZpbGluZ0xldmVsT3BlcmF0aW9uID0gUHJvZmlsaW5nTGV2ZWxPcGVyYXRpb247XG4vLyMgc291cmNlTWFwcGluZ1VSTD1wcm9maWxpbmdfbGV2ZWwuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/operations/profiling_level.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/operations/remove_user.js":
/*!********************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/operations/remove_user.js ***!
  \********************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.RemoveUserOperation = void 0;\nconst command_1 = __webpack_require__(/*! ./command */ \"(api)/../server/node_modules/mongodb/lib/operations/command.js\");\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(api)/../server/node_modules/mongodb/lib/operations/operation.js\");\n/** @internal */\nclass RemoveUserOperation extends command_1.CommandCallbackOperation {\n    constructor(db, username, options) {\n        super(db, options);\n        this.options = options;\n        this.username = username;\n    }\n    executeCallback(server, session, callback) {\n        super.executeCommandCallback(server, session, { dropUser: this.username }, err => {\n            callback(err, err ? false : true);\n        });\n    }\n}\nexports.RemoveUserOperation = RemoveUserOperation;\n(0, operation_1.defineAspects)(RemoveUserOperation, [operation_1.Aspect.WRITE_OPERATION]);\n//# sourceMappingURL=remove_user.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL3JlbW92ZV91c2VyLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELDJCQUEyQjtBQUMzQixrQkFBa0IsbUJBQU8sQ0FBQyxpRkFBVztBQUNyQyxvQkFBb0IsbUJBQU8sQ0FBQyxxRkFBYTtBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0RBQXdELHlCQUF5QjtBQUNqRjtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsMkJBQTJCO0FBQzNCO0FBQ0EiLCJzb3VyY2VzIjpbIkQ6XFxzYWxvbmlcXGFwcHJhaXNhbC1zeXN0ZW1cXHNlcnZlclxcbm9kZV9tb2R1bGVzXFxtb25nb2RiXFxsaWJcXG9wZXJhdGlvbnNcXHJlbW92ZV91c2VyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5SZW1vdmVVc2VyT3BlcmF0aW9uID0gdm9pZCAwO1xuY29uc3QgY29tbWFuZF8xID0gcmVxdWlyZShcIi4vY29tbWFuZFwiKTtcbmNvbnN0IG9wZXJhdGlvbl8xID0gcmVxdWlyZShcIi4vb3BlcmF0aW9uXCIpO1xuLyoqIEBpbnRlcm5hbCAqL1xuY2xhc3MgUmVtb3ZlVXNlck9wZXJhdGlvbiBleHRlbmRzIGNvbW1hbmRfMS5Db21tYW5kQ2FsbGJhY2tPcGVyYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKGRiLCB1c2VybmFtZSwgb3B0aW9ucykge1xuICAgICAgICBzdXBlcihkYiwgb3B0aW9ucyk7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XG4gICAgICAgIHRoaXMudXNlcm5hbWUgPSB1c2VybmFtZTtcbiAgICB9XG4gICAgZXhlY3V0ZUNhbGxiYWNrKHNlcnZlciwgc2Vzc2lvbiwgY2FsbGJhY2spIHtcbiAgICAgICAgc3VwZXIuZXhlY3V0ZUNvbW1hbmRDYWxsYmFjayhzZXJ2ZXIsIHNlc3Npb24sIHsgZHJvcFVzZXI6IHRoaXMudXNlcm5hbWUgfSwgZXJyID0+IHtcbiAgICAgICAgICAgIGNhbGxiYWNrKGVyciwgZXJyID8gZmFsc2UgOiB0cnVlKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuZXhwb3J0cy5SZW1vdmVVc2VyT3BlcmF0aW9uID0gUmVtb3ZlVXNlck9wZXJhdGlvbjtcbigwLCBvcGVyYXRpb25fMS5kZWZpbmVBc3BlY3RzKShSZW1vdmVVc2VyT3BlcmF0aW9uLCBbb3BlcmF0aW9uXzEuQXNwZWN0LldSSVRFX09QRVJBVElPTl0pO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cmVtb3ZlX3VzZXIuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/operations/remove_user.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/operations/rename.js":
/*!***************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/operations/rename.js ***!
  \***************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.RenameOperation = void 0;\nconst collection_1 = __webpack_require__(/*! ../collection */ \"(api)/../server/node_modules/mongodb/lib/collection.js\");\nconst error_1 = __webpack_require__(/*! ../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(api)/../server/node_modules/mongodb/lib/operations/operation.js\");\nconst run_command_1 = __webpack_require__(/*! ./run_command */ \"(api)/../server/node_modules/mongodb/lib/operations/run_command.js\");\n/** @internal */\nclass RenameOperation extends run_command_1.RunAdminCommandOperation {\n    constructor(collection, newName, options) {\n        // Check the collection name\n        (0, utils_1.checkCollectionName)(newName);\n        // Build the command\n        const renameCollection = collection.namespace;\n        const toCollection = collection.s.namespace.withCollection(newName).toString();\n        const dropTarget = typeof options.dropTarget === 'boolean' ? options.dropTarget : false;\n        const cmd = { renameCollection: renameCollection, to: toCollection, dropTarget: dropTarget };\n        super(collection, cmd, options);\n        this.options = options;\n        this.collection = collection;\n        this.newName = newName;\n    }\n    executeCallback(server, session, callback) {\n        const coll = this.collection;\n        super.executeCallback(server, session, (err, doc) => {\n            if (err)\n                return callback(err);\n            // We have an error\n            if (doc?.errmsg) {\n                return callback(new error_1.MongoServerError(doc));\n            }\n            let newColl;\n            try {\n                newColl = new collection_1.Collection(coll.s.db, this.newName, coll.s.options);\n            }\n            catch (err) {\n                return callback(err);\n            }\n            return callback(undefined, newColl);\n        });\n    }\n}\nexports.RenameOperation = RenameOperation;\n(0, operation_1.defineAspects)(RenameOperation, [operation_1.Aspect.WRITE_OPERATION]);\n//# sourceMappingURL=rename.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL3JlbmFtZS5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCx1QkFBdUI7QUFDdkIscUJBQXFCLG1CQUFPLENBQUMsNkVBQWU7QUFDNUMsZ0JBQWdCLG1CQUFPLENBQUMsbUVBQVU7QUFDbEMsZ0JBQWdCLG1CQUFPLENBQUMsbUVBQVU7QUFDbEMsb0JBQW9CLG1CQUFPLENBQUMscUZBQWE7QUFDekMsc0JBQXNCLG1CQUFPLENBQUMseUZBQWU7QUFDN0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSx1QkFBdUI7QUFDdkI7QUFDQSIsInNvdXJjZXMiOlsiRDpcXHNhbG9uaVxcYXBwcmFpc2FsLXN5c3RlbVxcc2VydmVyXFxub2RlX21vZHVsZXNcXG1vbmdvZGJcXGxpYlxcb3BlcmF0aW9uc1xccmVuYW1lLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5SZW5hbWVPcGVyYXRpb24gPSB2b2lkIDA7XG5jb25zdCBjb2xsZWN0aW9uXzEgPSByZXF1aXJlKFwiLi4vY29sbGVjdGlvblwiKTtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi4vZXJyb3JcIik7XG5jb25zdCB1dGlsc18xID0gcmVxdWlyZShcIi4uL3V0aWxzXCIpO1xuY29uc3Qgb3BlcmF0aW9uXzEgPSByZXF1aXJlKFwiLi9vcGVyYXRpb25cIik7XG5jb25zdCBydW5fY29tbWFuZF8xID0gcmVxdWlyZShcIi4vcnVuX2NvbW1hbmRcIik7XG4vKiogQGludGVybmFsICovXG5jbGFzcyBSZW5hbWVPcGVyYXRpb24gZXh0ZW5kcyBydW5fY29tbWFuZF8xLlJ1bkFkbWluQ29tbWFuZE9wZXJhdGlvbiB7XG4gICAgY29uc3RydWN0b3IoY29sbGVjdGlvbiwgbmV3TmFtZSwgb3B0aW9ucykge1xuICAgICAgICAvLyBDaGVjayB0aGUgY29sbGVjdGlvbiBuYW1lXG4gICAgICAgICgwLCB1dGlsc18xLmNoZWNrQ29sbGVjdGlvbk5hbWUpKG5ld05hbWUpO1xuICAgICAgICAvLyBCdWlsZCB0aGUgY29tbWFuZFxuICAgICAgICBjb25zdCByZW5hbWVDb2xsZWN0aW9uID0gY29sbGVjdGlvbi5uYW1lc3BhY2U7XG4gICAgICAgIGNvbnN0IHRvQ29sbGVjdGlvbiA9IGNvbGxlY3Rpb24ucy5uYW1lc3BhY2Uud2l0aENvbGxlY3Rpb24obmV3TmFtZSkudG9TdHJpbmcoKTtcbiAgICAgICAgY29uc3QgZHJvcFRhcmdldCA9IHR5cGVvZiBvcHRpb25zLmRyb3BUYXJnZXQgPT09ICdib29sZWFuJyA/IG9wdGlvbnMuZHJvcFRhcmdldCA6IGZhbHNlO1xuICAgICAgICBjb25zdCBjbWQgPSB7IHJlbmFtZUNvbGxlY3Rpb246IHJlbmFtZUNvbGxlY3Rpb24sIHRvOiB0b0NvbGxlY3Rpb24sIGRyb3BUYXJnZXQ6IGRyb3BUYXJnZXQgfTtcbiAgICAgICAgc3VwZXIoY29sbGVjdGlvbiwgY21kLCBvcHRpb25zKTtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcbiAgICAgICAgdGhpcy5jb2xsZWN0aW9uID0gY29sbGVjdGlvbjtcbiAgICAgICAgdGhpcy5uZXdOYW1lID0gbmV3TmFtZTtcbiAgICB9XG4gICAgZXhlY3V0ZUNhbGxiYWNrKHNlcnZlciwgc2Vzc2lvbiwgY2FsbGJhY2spIHtcbiAgICAgICAgY29uc3QgY29sbCA9IHRoaXMuY29sbGVjdGlvbjtcbiAgICAgICAgc3VwZXIuZXhlY3V0ZUNhbGxiYWNrKHNlcnZlciwgc2Vzc2lvbiwgKGVyciwgZG9jKSA9PiB7XG4gICAgICAgICAgICBpZiAoZXJyKVxuICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgICAgICAgICAgLy8gV2UgaGF2ZSBhbiBlcnJvclxuICAgICAgICAgICAgaWYgKGRvYz8uZXJybXNnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKG5ldyBlcnJvcl8xLk1vbmdvU2VydmVyRXJyb3IoZG9jKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgbmV3Q29sbDtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgbmV3Q29sbCA9IG5ldyBjb2xsZWN0aW9uXzEuQ29sbGVjdGlvbihjb2xsLnMuZGIsIHRoaXMubmV3TmFtZSwgY29sbC5zLm9wdGlvbnMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKHVuZGVmaW5lZCwgbmV3Q29sbCk7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmV4cG9ydHMuUmVuYW1lT3BlcmF0aW9uID0gUmVuYW1lT3BlcmF0aW9uO1xuKDAsIG9wZXJhdGlvbl8xLmRlZmluZUFzcGVjdHMpKFJlbmFtZU9wZXJhdGlvbiwgW29wZXJhdGlvbl8xLkFzcGVjdC5XUklURV9PUEVSQVRJT05dKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXJlbmFtZS5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/operations/rename.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/operations/run_command.js":
/*!********************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/operations/run_command.js ***!
  \********************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.RunAdminCommandOperation = exports.RunCommandOperation = void 0;\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\nconst command_1 = __webpack_require__(/*! ./command */ \"(api)/../server/node_modules/mongodb/lib/operations/command.js\");\n/** @internal */\nclass RunCommandOperation extends command_1.CommandCallbackOperation {\n    constructor(parent, command, options) {\n        super(parent, options);\n        this.options = options ?? {};\n        this.command = command;\n    }\n    executeCallback(server, session, callback) {\n        const command = this.command;\n        this.executeCommandCallback(server, session, command, callback);\n    }\n}\nexports.RunCommandOperation = RunCommandOperation;\nclass RunAdminCommandOperation extends RunCommandOperation {\n    constructor(parent, command, options) {\n        super(parent, command, options);\n        this.ns = new utils_1.MongoDBNamespace('admin');\n    }\n}\nexports.RunAdminCommandOperation = RunAdminCommandOperation;\n//# sourceMappingURL=run_command.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL3J1bl9jb21tYW5kLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELGdDQUFnQyxHQUFHLDJCQUEyQjtBQUM5RCxnQkFBZ0IsbUJBQU8sQ0FBQyxtRUFBVTtBQUNsQyxrQkFBa0IsbUJBQU8sQ0FBQyxpRkFBVztBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkI7QUFDM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDO0FBQ2hDIiwic291cmNlcyI6WyJEOlxcc2Fsb25pXFxhcHByYWlzYWwtc3lzdGVtXFxzZXJ2ZXJcXG5vZGVfbW9kdWxlc1xcbW9uZ29kYlxcbGliXFxvcGVyYXRpb25zXFxydW5fY29tbWFuZC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuUnVuQWRtaW5Db21tYW5kT3BlcmF0aW9uID0gZXhwb3J0cy5SdW5Db21tYW5kT3BlcmF0aW9uID0gdm9pZCAwO1xuY29uc3QgdXRpbHNfMSA9IHJlcXVpcmUoXCIuLi91dGlsc1wiKTtcbmNvbnN0IGNvbW1hbmRfMSA9IHJlcXVpcmUoXCIuL2NvbW1hbmRcIik7XG4vKiogQGludGVybmFsICovXG5jbGFzcyBSdW5Db21tYW5kT3BlcmF0aW9uIGV4dGVuZHMgY29tbWFuZF8xLkNvbW1hbmRDYWxsYmFja09wZXJhdGlvbiB7XG4gICAgY29uc3RydWN0b3IocGFyZW50LCBjb21tYW5kLCBvcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKHBhcmVudCwgb3B0aW9ucyk7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnMgPz8ge307XG4gICAgICAgIHRoaXMuY29tbWFuZCA9IGNvbW1hbmQ7XG4gICAgfVxuICAgIGV4ZWN1dGVDYWxsYmFjayhzZXJ2ZXIsIHNlc3Npb24sIGNhbGxiYWNrKSB7XG4gICAgICAgIGNvbnN0IGNvbW1hbmQgPSB0aGlzLmNvbW1hbmQ7XG4gICAgICAgIHRoaXMuZXhlY3V0ZUNvbW1hbmRDYWxsYmFjayhzZXJ2ZXIsIHNlc3Npb24sIGNvbW1hbmQsIGNhbGxiYWNrKTtcbiAgICB9XG59XG5leHBvcnRzLlJ1bkNvbW1hbmRPcGVyYXRpb24gPSBSdW5Db21tYW5kT3BlcmF0aW9uO1xuY2xhc3MgUnVuQWRtaW5Db21tYW5kT3BlcmF0aW9uIGV4dGVuZHMgUnVuQ29tbWFuZE9wZXJhdGlvbiB7XG4gICAgY29uc3RydWN0b3IocGFyZW50LCBjb21tYW5kLCBvcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKHBhcmVudCwgY29tbWFuZCwgb3B0aW9ucyk7XG4gICAgICAgIHRoaXMubnMgPSBuZXcgdXRpbHNfMS5Nb25nb0RCTmFtZXNwYWNlKCdhZG1pbicpO1xuICAgIH1cbn1cbmV4cG9ydHMuUnVuQWRtaW5Db21tYW5kT3BlcmF0aW9uID0gUnVuQWRtaW5Db21tYW5kT3BlcmF0aW9uO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cnVuX2NvbW1hbmQuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/operations/run_command.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/operations/search_indexes/create.js":
/*!******************************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/operations/search_indexes/create.js ***!
  \******************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.CreateSearchIndexesOperation = void 0;\nconst operation_1 = __webpack_require__(/*! ../operation */ \"(api)/../server/node_modules/mongodb/lib/operations/operation.js\");\n/** @internal */\nclass CreateSearchIndexesOperation extends operation_1.AbstractCallbackOperation {\n    constructor(collection, descriptions) {\n        super();\n        this.collection = collection;\n        this.descriptions = descriptions;\n    }\n    executeCallback(server, session, callback) {\n        const namespace = this.collection.fullNamespace;\n        const command = {\n            createSearchIndexes: namespace.collection,\n            indexes: this.descriptions\n        };\n        server.command(namespace, command, { session }, (err, res) => {\n            if (err || !res) {\n                callback(err);\n                return;\n            }\n            const indexesCreated = res?.indexesCreated ?? [];\n            callback(undefined, indexesCreated.map(({ name }) => name));\n        });\n    }\n}\nexports.CreateSearchIndexesOperation = CreateSearchIndexesOperation;\n//# sourceMappingURL=create.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL3NlYXJjaF9pbmRleGVzL2NyZWF0ZS5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxvQ0FBb0M7QUFDcEMsb0JBQW9CLG1CQUFPLENBQUMsc0ZBQWM7QUFDMUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2Q0FBNkMsU0FBUztBQUN0RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0RBQXNELE1BQU07QUFDNUQsU0FBUztBQUNUO0FBQ0E7QUFDQSxvQ0FBb0M7QUFDcEMiLCJzb3VyY2VzIjpbIkQ6XFxzYWxvbmlcXGFwcHJhaXNhbC1zeXN0ZW1cXHNlcnZlclxcbm9kZV9tb2R1bGVzXFxtb25nb2RiXFxsaWJcXG9wZXJhdGlvbnNcXHNlYXJjaF9pbmRleGVzXFxjcmVhdGUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkNyZWF0ZVNlYXJjaEluZGV4ZXNPcGVyYXRpb24gPSB2b2lkIDA7XG5jb25zdCBvcGVyYXRpb25fMSA9IHJlcXVpcmUoXCIuLi9vcGVyYXRpb25cIik7XG4vKiogQGludGVybmFsICovXG5jbGFzcyBDcmVhdGVTZWFyY2hJbmRleGVzT3BlcmF0aW9uIGV4dGVuZHMgb3BlcmF0aW9uXzEuQWJzdHJhY3RDYWxsYmFja09wZXJhdGlvbiB7XG4gICAgY29uc3RydWN0b3IoY29sbGVjdGlvbiwgZGVzY3JpcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMuY29sbGVjdGlvbiA9IGNvbGxlY3Rpb247XG4gICAgICAgIHRoaXMuZGVzY3JpcHRpb25zID0gZGVzY3JpcHRpb25zO1xuICAgIH1cbiAgICBleGVjdXRlQ2FsbGJhY2soc2VydmVyLCBzZXNzaW9uLCBjYWxsYmFjaykge1xuICAgICAgICBjb25zdCBuYW1lc3BhY2UgPSB0aGlzLmNvbGxlY3Rpb24uZnVsbE5hbWVzcGFjZTtcbiAgICAgICAgY29uc3QgY29tbWFuZCA9IHtcbiAgICAgICAgICAgIGNyZWF0ZVNlYXJjaEluZGV4ZXM6IG5hbWVzcGFjZS5jb2xsZWN0aW9uLFxuICAgICAgICAgICAgaW5kZXhlczogdGhpcy5kZXNjcmlwdGlvbnNcbiAgICAgICAgfTtcbiAgICAgICAgc2VydmVyLmNvbW1hbmQobmFtZXNwYWNlLCBjb21tYW5kLCB7IHNlc3Npb24gfSwgKGVyciwgcmVzKSA9PiB7XG4gICAgICAgICAgICBpZiAoZXJyIHx8ICFyZXMpIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnIpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGluZGV4ZXNDcmVhdGVkID0gcmVzPy5pbmRleGVzQ3JlYXRlZCA/PyBbXTtcbiAgICAgICAgICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwgaW5kZXhlc0NyZWF0ZWQubWFwKCh7IG5hbWUgfSkgPT4gbmFtZSkpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5leHBvcnRzLkNyZWF0ZVNlYXJjaEluZGV4ZXNPcGVyYXRpb24gPSBDcmVhdGVTZWFyY2hJbmRleGVzT3BlcmF0aW9uO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y3JlYXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/operations/search_indexes/create.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/operations/search_indexes/drop.js":
/*!****************************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/operations/search_indexes/drop.js ***!
  \****************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.DropSearchIndexOperation = void 0;\nconst operation_1 = __webpack_require__(/*! ../operation */ \"(api)/../server/node_modules/mongodb/lib/operations/operation.js\");\n/** @internal */\nclass DropSearchIndexOperation extends operation_1.AbstractCallbackOperation {\n    constructor(collection, name) {\n        super();\n        this.collection = collection;\n        this.name = name;\n    }\n    executeCallback(server, session, callback) {\n        const namespace = this.collection.fullNamespace;\n        const command = {\n            dropSearchIndex: namespace.collection\n        };\n        if (typeof this.name === 'string') {\n            command.name = this.name;\n        }\n        server.command(namespace, command, { session }, err => {\n            if (err) {\n                callback(err);\n                return;\n            }\n            callback();\n        });\n    }\n}\nexports.DropSearchIndexOperation = DropSearchIndexOperation;\n//# sourceMappingURL=drop.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL3NlYXJjaF9pbmRleGVzL2Ryb3AuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsZ0NBQWdDO0FBQ2hDLG9CQUFvQixtQkFBTyxDQUFDLHNGQUFjO0FBQzFDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZDQUE2QyxTQUFTO0FBQ3REO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLGdDQUFnQztBQUNoQyIsInNvdXJjZXMiOlsiRDpcXHNhbG9uaVxcYXBwcmFpc2FsLXN5c3RlbVxcc2VydmVyXFxub2RlX21vZHVsZXNcXG1vbmdvZGJcXGxpYlxcb3BlcmF0aW9uc1xcc2VhcmNoX2luZGV4ZXNcXGRyb3AuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkRyb3BTZWFyY2hJbmRleE9wZXJhdGlvbiA9IHZvaWQgMDtcbmNvbnN0IG9wZXJhdGlvbl8xID0gcmVxdWlyZShcIi4uL29wZXJhdGlvblwiKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIERyb3BTZWFyY2hJbmRleE9wZXJhdGlvbiBleHRlbmRzIG9wZXJhdGlvbl8xLkFic3RyYWN0Q2FsbGJhY2tPcGVyYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKGNvbGxlY3Rpb24sIG5hbWUpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5jb2xsZWN0aW9uID0gY29sbGVjdGlvbjtcbiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICB9XG4gICAgZXhlY3V0ZUNhbGxiYWNrKHNlcnZlciwgc2Vzc2lvbiwgY2FsbGJhY2spIHtcbiAgICAgICAgY29uc3QgbmFtZXNwYWNlID0gdGhpcy5jb2xsZWN0aW9uLmZ1bGxOYW1lc3BhY2U7XG4gICAgICAgIGNvbnN0IGNvbW1hbmQgPSB7XG4gICAgICAgICAgICBkcm9wU2VhcmNoSW5kZXg6IG5hbWVzcGFjZS5jb2xsZWN0aW9uXG4gICAgICAgIH07XG4gICAgICAgIGlmICh0eXBlb2YgdGhpcy5uYW1lID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgY29tbWFuZC5uYW1lID0gdGhpcy5uYW1lO1xuICAgICAgICB9XG4gICAgICAgIHNlcnZlci5jb21tYW5kKG5hbWVzcGFjZSwgY29tbWFuZCwgeyBzZXNzaW9uIH0sIGVyciA9PiB7XG4gICAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5leHBvcnRzLkRyb3BTZWFyY2hJbmRleE9wZXJhdGlvbiA9IERyb3BTZWFyY2hJbmRleE9wZXJhdGlvbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWRyb3AuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/operations/search_indexes/drop.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/operations/search_indexes/update.js":
/*!******************************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/operations/search_indexes/update.js ***!
  \******************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.UpdateSearchIndexOperation = void 0;\nconst operation_1 = __webpack_require__(/*! ../operation */ \"(api)/../server/node_modules/mongodb/lib/operations/operation.js\");\n/** @internal */\nclass UpdateSearchIndexOperation extends operation_1.AbstractCallbackOperation {\n    constructor(collection, name, definition) {\n        super();\n        this.collection = collection;\n        this.name = name;\n        this.definition = definition;\n    }\n    executeCallback(server, session, callback) {\n        const namespace = this.collection.fullNamespace;\n        const command = {\n            updateSearchIndex: namespace.collection,\n            name: this.name,\n            definition: this.definition\n        };\n        server.command(namespace, command, { session }, err => {\n            if (err) {\n                callback(err);\n                return;\n            }\n            callback();\n        });\n    }\n}\nexports.UpdateSearchIndexOperation = UpdateSearchIndexOperation;\n//# sourceMappingURL=update.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL3NlYXJjaF9pbmRleGVzL3VwZGF0ZS5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxrQ0FBa0M7QUFDbEMsb0JBQW9CLG1CQUFPLENBQUMsc0ZBQWM7QUFDMUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkNBQTZDLFNBQVM7QUFDdEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0Esa0NBQWtDO0FBQ2xDIiwic291cmNlcyI6WyJEOlxcc2Fsb25pXFxhcHByYWlzYWwtc3lzdGVtXFxzZXJ2ZXJcXG5vZGVfbW9kdWxlc1xcbW9uZ29kYlxcbGliXFxvcGVyYXRpb25zXFxzZWFyY2hfaW5kZXhlc1xcdXBkYXRlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5VcGRhdGVTZWFyY2hJbmRleE9wZXJhdGlvbiA9IHZvaWQgMDtcbmNvbnN0IG9wZXJhdGlvbl8xID0gcmVxdWlyZShcIi4uL29wZXJhdGlvblwiKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIFVwZGF0ZVNlYXJjaEluZGV4T3BlcmF0aW9uIGV4dGVuZHMgb3BlcmF0aW9uXzEuQWJzdHJhY3RDYWxsYmFja09wZXJhdGlvbiB7XG4gICAgY29uc3RydWN0b3IoY29sbGVjdGlvbiwgbmFtZSwgZGVmaW5pdGlvbikge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLmNvbGxlY3Rpb24gPSBjb2xsZWN0aW9uO1xuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICB0aGlzLmRlZmluaXRpb24gPSBkZWZpbml0aW9uO1xuICAgIH1cbiAgICBleGVjdXRlQ2FsbGJhY2soc2VydmVyLCBzZXNzaW9uLCBjYWxsYmFjaykge1xuICAgICAgICBjb25zdCBuYW1lc3BhY2UgPSB0aGlzLmNvbGxlY3Rpb24uZnVsbE5hbWVzcGFjZTtcbiAgICAgICAgY29uc3QgY29tbWFuZCA9IHtcbiAgICAgICAgICAgIHVwZGF0ZVNlYXJjaEluZGV4OiBuYW1lc3BhY2UuY29sbGVjdGlvbixcbiAgICAgICAgICAgIG5hbWU6IHRoaXMubmFtZSxcbiAgICAgICAgICAgIGRlZmluaXRpb246IHRoaXMuZGVmaW5pdGlvblxuICAgICAgICB9O1xuICAgICAgICBzZXJ2ZXIuY29tbWFuZChuYW1lc3BhY2UsIGNvbW1hbmQsIHsgc2Vzc2lvbiB9LCBlcnIgPT4ge1xuICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycik7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuZXhwb3J0cy5VcGRhdGVTZWFyY2hJbmRleE9wZXJhdGlvbiA9IFVwZGF0ZVNlYXJjaEluZGV4T3BlcmF0aW9uO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9dXBkYXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/operations/search_indexes/update.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/operations/set_profiling_level.js":
/*!****************************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/operations/set_profiling_level.js ***!
  \****************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.SetProfilingLevelOperation = exports.ProfilingLevel = void 0;\nconst error_1 = __webpack_require__(/*! ../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\nconst command_1 = __webpack_require__(/*! ./command */ \"(api)/../server/node_modules/mongodb/lib/operations/command.js\");\nconst levelValues = new Set(['off', 'slow_only', 'all']);\n/** @public */\nexports.ProfilingLevel = Object.freeze({\n    off: 'off',\n    slowOnly: 'slow_only',\n    all: 'all'\n});\n/** @internal */\nclass SetProfilingLevelOperation extends command_1.CommandCallbackOperation {\n    constructor(db, level, options) {\n        super(db, options);\n        this.options = options;\n        switch (level) {\n            case exports.ProfilingLevel.off:\n                this.profile = 0;\n                break;\n            case exports.ProfilingLevel.slowOnly:\n                this.profile = 1;\n                break;\n            case exports.ProfilingLevel.all:\n                this.profile = 2;\n                break;\n            default:\n                this.profile = 0;\n                break;\n        }\n        this.level = level;\n    }\n    executeCallback(server, session, callback) {\n        const level = this.level;\n        if (!levelValues.has(level)) {\n            return callback(new error_1.MongoInvalidArgumentError(`Profiling level must be one of \"${(0, utils_1.enumToString)(exports.ProfilingLevel)}\"`));\n        }\n        // TODO(NODE-3483): Determine error to put here\n        super.executeCommandCallback(server, session, { profile: this.profile }, (err, doc) => {\n            if (err == null && doc.ok === 1)\n                return callback(undefined, level);\n            return err != null\n                ? callback(err)\n                : callback(new error_1.MongoRuntimeError('Error with profile command'));\n        });\n    }\n}\nexports.SetProfilingLevelOperation = SetProfilingLevelOperation;\n//# sourceMappingURL=set_profiling_level.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL3NldF9wcm9maWxpbmdfbGV2ZWwuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0Qsa0NBQWtDLEdBQUcsc0JBQXNCO0FBQzNELGdCQUFnQixtQkFBTyxDQUFDLG1FQUFVO0FBQ2xDLGdCQUFnQixtQkFBTyxDQUFDLG1FQUFVO0FBQ2xDLGtCQUFrQixtQkFBTyxDQUFDLGlGQUFXO0FBQ3JDO0FBQ0E7QUFDQSxzQkFBc0I7QUFDdEI7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFHQUFxRyxrREFBa0Q7QUFDdko7QUFDQTtBQUNBLHdEQUF3RCx1QkFBdUI7QUFDL0U7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0Esa0NBQWtDO0FBQ2xDIiwic291cmNlcyI6WyJEOlxcc2Fsb25pXFxhcHByYWlzYWwtc3lzdGVtXFxzZXJ2ZXJcXG5vZGVfbW9kdWxlc1xcbW9uZ29kYlxcbGliXFxvcGVyYXRpb25zXFxzZXRfcHJvZmlsaW5nX2xldmVsLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5TZXRQcm9maWxpbmdMZXZlbE9wZXJhdGlvbiA9IGV4cG9ydHMuUHJvZmlsaW5nTGV2ZWwgPSB2b2lkIDA7XG5jb25zdCBlcnJvcl8xID0gcmVxdWlyZShcIi4uL2Vycm9yXCIpO1xuY29uc3QgdXRpbHNfMSA9IHJlcXVpcmUoXCIuLi91dGlsc1wiKTtcbmNvbnN0IGNvbW1hbmRfMSA9IHJlcXVpcmUoXCIuL2NvbW1hbmRcIik7XG5jb25zdCBsZXZlbFZhbHVlcyA9IG5ldyBTZXQoWydvZmYnLCAnc2xvd19vbmx5JywgJ2FsbCddKTtcbi8qKiBAcHVibGljICovXG5leHBvcnRzLlByb2ZpbGluZ0xldmVsID0gT2JqZWN0LmZyZWV6ZSh7XG4gICAgb2ZmOiAnb2ZmJyxcbiAgICBzbG93T25seTogJ3Nsb3dfb25seScsXG4gICAgYWxsOiAnYWxsJ1xufSk7XG4vKiogQGludGVybmFsICovXG5jbGFzcyBTZXRQcm9maWxpbmdMZXZlbE9wZXJhdGlvbiBleHRlbmRzIGNvbW1hbmRfMS5Db21tYW5kQ2FsbGJhY2tPcGVyYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKGRiLCBsZXZlbCwgb3B0aW9ucykge1xuICAgICAgICBzdXBlcihkYiwgb3B0aW9ucyk7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XG4gICAgICAgIHN3aXRjaCAobGV2ZWwpIHtcbiAgICAgICAgICAgIGNhc2UgZXhwb3J0cy5Qcm9maWxpbmdMZXZlbC5vZmY6XG4gICAgICAgICAgICAgICAgdGhpcy5wcm9maWxlID0gMDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgZXhwb3J0cy5Qcm9maWxpbmdMZXZlbC5zbG93T25seTpcbiAgICAgICAgICAgICAgICB0aGlzLnByb2ZpbGUgPSAxO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBleHBvcnRzLlByb2ZpbGluZ0xldmVsLmFsbDpcbiAgICAgICAgICAgICAgICB0aGlzLnByb2ZpbGUgPSAyO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICB0aGlzLnByb2ZpbGUgPSAwO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubGV2ZWwgPSBsZXZlbDtcbiAgICB9XG4gICAgZXhlY3V0ZUNhbGxiYWNrKHNlcnZlciwgc2Vzc2lvbiwgY2FsbGJhY2spIHtcbiAgICAgICAgY29uc3QgbGV2ZWwgPSB0aGlzLmxldmVsO1xuICAgICAgICBpZiAoIWxldmVsVmFsdWVzLmhhcyhsZXZlbCkpIHtcbiAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKGBQcm9maWxpbmcgbGV2ZWwgbXVzdCBiZSBvbmUgb2YgXCIkeygwLCB1dGlsc18xLmVudW1Ub1N0cmluZykoZXhwb3J0cy5Qcm9maWxpbmdMZXZlbCl9XCJgKSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gVE9ETyhOT0RFLTM0ODMpOiBEZXRlcm1pbmUgZXJyb3IgdG8gcHV0IGhlcmVcbiAgICAgICAgc3VwZXIuZXhlY3V0ZUNvbW1hbmRDYWxsYmFjayhzZXJ2ZXIsIHNlc3Npb24sIHsgcHJvZmlsZTogdGhpcy5wcm9maWxlIH0sIChlcnIsIGRvYykgPT4ge1xuICAgICAgICAgICAgaWYgKGVyciA9PSBudWxsICYmIGRvYy5vayA9PT0gMSlcbiAgICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2sodW5kZWZpbmVkLCBsZXZlbCk7XG4gICAgICAgICAgICByZXR1cm4gZXJyICE9IG51bGxcbiAgICAgICAgICAgICAgICA/IGNhbGxiYWNrKGVycilcbiAgICAgICAgICAgICAgICA6IGNhbGxiYWNrKG5ldyBlcnJvcl8xLk1vbmdvUnVudGltZUVycm9yKCdFcnJvciB3aXRoIHByb2ZpbGUgY29tbWFuZCcpKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuZXhwb3J0cy5TZXRQcm9maWxpbmdMZXZlbE9wZXJhdGlvbiA9IFNldFByb2ZpbGluZ0xldmVsT3BlcmF0aW9uO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9c2V0X3Byb2ZpbGluZ19sZXZlbC5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/operations/set_profiling_level.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/operations/stats.js":
/*!**************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/operations/stats.js ***!
  \**************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.DbStatsOperation = exports.CollStatsOperation = void 0;\nconst command_1 = __webpack_require__(/*! ./command */ \"(api)/../server/node_modules/mongodb/lib/operations/command.js\");\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(api)/../server/node_modules/mongodb/lib/operations/operation.js\");\n/**\n * Get all the collection statistics.\n * @internal\n */\nclass CollStatsOperation extends command_1.CommandCallbackOperation {\n    /**\n     * Construct a Stats operation.\n     *\n     * @param collection - Collection instance\n     * @param options - Optional settings. See Collection.prototype.stats for a list of options.\n     */\n    constructor(collection, options) {\n        super(collection, options);\n        this.options = options ?? {};\n        this.collectionName = collection.collectionName;\n    }\n    executeCallback(server, session, callback) {\n        const command = { collStats: this.collectionName };\n        if (this.options.scale != null) {\n            command.scale = this.options.scale;\n        }\n        super.executeCommandCallback(server, session, command, callback);\n    }\n}\nexports.CollStatsOperation = CollStatsOperation;\n/** @internal */\nclass DbStatsOperation extends command_1.CommandCallbackOperation {\n    constructor(db, options) {\n        super(db, options);\n        this.options = options;\n    }\n    executeCallback(server, session, callback) {\n        const command = { dbStats: true };\n        if (this.options.scale != null) {\n            command.scale = this.options.scale;\n        }\n        super.executeCommandCallback(server, session, command, callback);\n    }\n}\nexports.DbStatsOperation = DbStatsOperation;\n(0, operation_1.defineAspects)(CollStatsOperation, [operation_1.Aspect.READ_OPERATION]);\n(0, operation_1.defineAspects)(DbStatsOperation, [operation_1.Aspect.READ_OPERATION]);\n//# sourceMappingURL=stats.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL3N0YXRzLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELHdCQUF3QixHQUFHLDBCQUEwQjtBQUNyRCxrQkFBa0IsbUJBQU8sQ0FBQyxpRkFBVztBQUNyQyxvQkFBb0IsbUJBQU8sQ0FBQyxxRkFBYTtBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQjtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQjtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0I7QUFDeEI7QUFDQTtBQUNBIiwic291cmNlcyI6WyJEOlxcc2Fsb25pXFxhcHByYWlzYWwtc3lzdGVtXFxzZXJ2ZXJcXG5vZGVfbW9kdWxlc1xcbW9uZ29kYlxcbGliXFxvcGVyYXRpb25zXFxzdGF0cy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuRGJTdGF0c09wZXJhdGlvbiA9IGV4cG9ydHMuQ29sbFN0YXRzT3BlcmF0aW9uID0gdm9pZCAwO1xuY29uc3QgY29tbWFuZF8xID0gcmVxdWlyZShcIi4vY29tbWFuZFwiKTtcbmNvbnN0IG9wZXJhdGlvbl8xID0gcmVxdWlyZShcIi4vb3BlcmF0aW9uXCIpO1xuLyoqXG4gKiBHZXQgYWxsIHRoZSBjb2xsZWN0aW9uIHN0YXRpc3RpY3MuXG4gKiBAaW50ZXJuYWxcbiAqL1xuY2xhc3MgQ29sbFN0YXRzT3BlcmF0aW9uIGV4dGVuZHMgY29tbWFuZF8xLkNvbW1hbmRDYWxsYmFja09wZXJhdGlvbiB7XG4gICAgLyoqXG4gICAgICogQ29uc3RydWN0IGEgU3RhdHMgb3BlcmF0aW9uLlxuICAgICAqXG4gICAgICogQHBhcmFtIGNvbGxlY3Rpb24gLSBDb2xsZWN0aW9uIGluc3RhbmNlXG4gICAgICogQHBhcmFtIG9wdGlvbnMgLSBPcHRpb25hbCBzZXR0aW5ncy4gU2VlIENvbGxlY3Rpb24ucHJvdG90eXBlLnN0YXRzIGZvciBhIGxpc3Qgb2Ygb3B0aW9ucy5cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3Rvcihjb2xsZWN0aW9uLCBvcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKGNvbGxlY3Rpb24sIG9wdGlvbnMpO1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zID8/IHt9O1xuICAgICAgICB0aGlzLmNvbGxlY3Rpb25OYW1lID0gY29sbGVjdGlvbi5jb2xsZWN0aW9uTmFtZTtcbiAgICB9XG4gICAgZXhlY3V0ZUNhbGxiYWNrKHNlcnZlciwgc2Vzc2lvbiwgY2FsbGJhY2spIHtcbiAgICAgICAgY29uc3QgY29tbWFuZCA9IHsgY29sbFN0YXRzOiB0aGlzLmNvbGxlY3Rpb25OYW1lIH07XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuc2NhbGUgIT0gbnVsbCkge1xuICAgICAgICAgICAgY29tbWFuZC5zY2FsZSA9IHRoaXMub3B0aW9ucy5zY2FsZTtcbiAgICAgICAgfVxuICAgICAgICBzdXBlci5leGVjdXRlQ29tbWFuZENhbGxiYWNrKHNlcnZlciwgc2Vzc2lvbiwgY29tbWFuZCwgY2FsbGJhY2spO1xuICAgIH1cbn1cbmV4cG9ydHMuQ29sbFN0YXRzT3BlcmF0aW9uID0gQ29sbFN0YXRzT3BlcmF0aW9uO1xuLyoqIEBpbnRlcm5hbCAqL1xuY2xhc3MgRGJTdGF0c09wZXJhdGlvbiBleHRlbmRzIGNvbW1hbmRfMS5Db21tYW5kQ2FsbGJhY2tPcGVyYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKGRiLCBvcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKGRiLCBvcHRpb25zKTtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcbiAgICB9XG4gICAgZXhlY3V0ZUNhbGxiYWNrKHNlcnZlciwgc2Vzc2lvbiwgY2FsbGJhY2spIHtcbiAgICAgICAgY29uc3QgY29tbWFuZCA9IHsgZGJTdGF0czogdHJ1ZSB9O1xuICAgICAgICBpZiAodGhpcy5vcHRpb25zLnNjYWxlICE9IG51bGwpIHtcbiAgICAgICAgICAgIGNvbW1hbmQuc2NhbGUgPSB0aGlzLm9wdGlvbnMuc2NhbGU7XG4gICAgICAgIH1cbiAgICAgICAgc3VwZXIuZXhlY3V0ZUNvbW1hbmRDYWxsYmFjayhzZXJ2ZXIsIHNlc3Npb24sIGNvbW1hbmQsIGNhbGxiYWNrKTtcbiAgICB9XG59XG5leHBvcnRzLkRiU3RhdHNPcGVyYXRpb24gPSBEYlN0YXRzT3BlcmF0aW9uO1xuKDAsIG9wZXJhdGlvbl8xLmRlZmluZUFzcGVjdHMpKENvbGxTdGF0c09wZXJhdGlvbiwgW29wZXJhdGlvbl8xLkFzcGVjdC5SRUFEX09QRVJBVElPTl0pO1xuKDAsIG9wZXJhdGlvbl8xLmRlZmluZUFzcGVjdHMpKERiU3RhdHNPcGVyYXRpb24sIFtvcGVyYXRpb25fMS5Bc3BlY3QuUkVBRF9PUEVSQVRJT05dKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXN0YXRzLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/operations/stats.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/operations/update.js":
/*!***************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/operations/update.js ***!
  \***************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.makeUpdateStatement = exports.ReplaceOneOperation = exports.UpdateManyOperation = exports.UpdateOneOperation = exports.UpdateOperation = void 0;\nconst error_1 = __webpack_require__(/*! ../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\nconst command_1 = __webpack_require__(/*! ./command */ \"(api)/../server/node_modules/mongodb/lib/operations/command.js\");\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(api)/../server/node_modules/mongodb/lib/operations/operation.js\");\n/** @internal */\nclass UpdateOperation extends command_1.CommandCallbackOperation {\n    constructor(ns, statements, options) {\n        super(undefined, options);\n        this.options = options;\n        this.ns = ns;\n        this.statements = statements;\n    }\n    get canRetryWrite() {\n        if (super.canRetryWrite === false) {\n            return false;\n        }\n        return this.statements.every(op => op.multi == null || op.multi === false);\n    }\n    executeCallback(server, session, callback) {\n        const options = this.options ?? {};\n        const ordered = typeof options.ordered === 'boolean' ? options.ordered : true;\n        const command = {\n            update: this.ns.collection,\n            updates: this.statements,\n            ordered\n        };\n        if (typeof options.bypassDocumentValidation === 'boolean') {\n            command.bypassDocumentValidation = options.bypassDocumentValidation;\n        }\n        if (options.let) {\n            command.let = options.let;\n        }\n        // we check for undefined specifically here to allow falsy values\n        // eslint-disable-next-line no-restricted-syntax\n        if (options.comment !== undefined) {\n            command.comment = options.comment;\n        }\n        const unacknowledgedWrite = this.writeConcern && this.writeConcern.w === 0;\n        if (unacknowledgedWrite) {\n            if (this.statements.find((o) => o.hint)) {\n                // TODO(NODE-3541): fix error for hint with unacknowledged writes\n                callback(new error_1.MongoCompatibilityError(`hint is not supported with unacknowledged writes`));\n                return;\n            }\n        }\n        super.executeCommandCallback(server, session, command, callback);\n    }\n}\nexports.UpdateOperation = UpdateOperation;\n/** @internal */\nclass UpdateOneOperation extends UpdateOperation {\n    constructor(collection, filter, update, options) {\n        super(collection.s.namespace, [makeUpdateStatement(filter, update, { ...options, multi: false })], options);\n        if (!(0, utils_1.hasAtomicOperators)(update)) {\n            throw new error_1.MongoInvalidArgumentError('Update document requires atomic operators');\n        }\n    }\n    executeCallback(server, session, callback) {\n        super.executeCallback(server, session, (err, res) => {\n            if (err || !res)\n                return callback(err);\n            if (this.explain != null)\n                return callback(undefined, res);\n            if (res.code)\n                return callback(new error_1.MongoServerError(res));\n            if (res.writeErrors)\n                return callback(new error_1.MongoServerError(res.writeErrors[0]));\n            callback(undefined, {\n                acknowledged: this.writeConcern?.w !== 0 ?? true,\n                modifiedCount: res.nModified != null ? res.nModified : res.n,\n                upsertedId: Array.isArray(res.upserted) && res.upserted.length > 0 ? res.upserted[0]._id : null,\n                upsertedCount: Array.isArray(res.upserted) && res.upserted.length ? res.upserted.length : 0,\n                matchedCount: Array.isArray(res.upserted) && res.upserted.length > 0 ? 0 : res.n\n            });\n        });\n    }\n}\nexports.UpdateOneOperation = UpdateOneOperation;\n/** @internal */\nclass UpdateManyOperation extends UpdateOperation {\n    constructor(collection, filter, update, options) {\n        super(collection.s.namespace, [makeUpdateStatement(filter, update, { ...options, multi: true })], options);\n        if (!(0, utils_1.hasAtomicOperators)(update)) {\n            throw new error_1.MongoInvalidArgumentError('Update document requires atomic operators');\n        }\n    }\n    executeCallback(server, session, callback) {\n        super.executeCallback(server, session, (err, res) => {\n            if (err || !res)\n                return callback(err);\n            if (this.explain != null)\n                return callback(undefined, res);\n            if (res.code)\n                return callback(new error_1.MongoServerError(res));\n            if (res.writeErrors)\n                return callback(new error_1.MongoServerError(res.writeErrors[0]));\n            callback(undefined, {\n                acknowledged: this.writeConcern?.w !== 0 ?? true,\n                modifiedCount: res.nModified != null ? res.nModified : res.n,\n                upsertedId: Array.isArray(res.upserted) && res.upserted.length > 0 ? res.upserted[0]._id : null,\n                upsertedCount: Array.isArray(res.upserted) && res.upserted.length ? res.upserted.length : 0,\n                matchedCount: Array.isArray(res.upserted) && res.upserted.length > 0 ? 0 : res.n\n            });\n        });\n    }\n}\nexports.UpdateManyOperation = UpdateManyOperation;\n/** @internal */\nclass ReplaceOneOperation extends UpdateOperation {\n    constructor(collection, filter, replacement, options) {\n        super(collection.s.namespace, [makeUpdateStatement(filter, replacement, { ...options, multi: false })], options);\n        if ((0, utils_1.hasAtomicOperators)(replacement)) {\n            throw new error_1.MongoInvalidArgumentError('Replacement document must not contain atomic operators');\n        }\n    }\n    executeCallback(server, session, callback) {\n        super.executeCallback(server, session, (err, res) => {\n            if (err || !res)\n                return callback(err);\n            if (this.explain != null)\n                return callback(undefined, res);\n            if (res.code)\n                return callback(new error_1.MongoServerError(res));\n            if (res.writeErrors)\n                return callback(new error_1.MongoServerError(res.writeErrors[0]));\n            callback(undefined, {\n                acknowledged: this.writeConcern?.w !== 0 ?? true,\n                modifiedCount: res.nModified != null ? res.nModified : res.n,\n                upsertedId: Array.isArray(res.upserted) && res.upserted.length > 0 ? res.upserted[0]._id : null,\n                upsertedCount: Array.isArray(res.upserted) && res.upserted.length ? res.upserted.length : 0,\n                matchedCount: Array.isArray(res.upserted) && res.upserted.length > 0 ? 0 : res.n\n            });\n        });\n    }\n}\nexports.ReplaceOneOperation = ReplaceOneOperation;\nfunction makeUpdateStatement(filter, update, options) {\n    if (filter == null || typeof filter !== 'object') {\n        throw new error_1.MongoInvalidArgumentError('Selector must be a valid JavaScript object');\n    }\n    if (update == null || typeof update !== 'object') {\n        throw new error_1.MongoInvalidArgumentError('Document must be a valid JavaScript object');\n    }\n    const op = { q: filter, u: update };\n    if (typeof options.upsert === 'boolean') {\n        op.upsert = options.upsert;\n    }\n    if (options.multi) {\n        op.multi = options.multi;\n    }\n    if (options.hint) {\n        op.hint = options.hint;\n    }\n    if (options.arrayFilters) {\n        op.arrayFilters = options.arrayFilters;\n    }\n    if (options.collation) {\n        op.collation = options.collation;\n    }\n    return op;\n}\nexports.makeUpdateStatement = makeUpdateStatement;\n(0, operation_1.defineAspects)(UpdateOperation, [operation_1.Aspect.RETRYABLE, operation_1.Aspect.WRITE_OPERATION, operation_1.Aspect.SKIP_COLLATION]);\n(0, operation_1.defineAspects)(UpdateOneOperation, [\n    operation_1.Aspect.RETRYABLE,\n    operation_1.Aspect.WRITE_OPERATION,\n    operation_1.Aspect.EXPLAINABLE,\n    operation_1.Aspect.SKIP_COLLATION\n]);\n(0, operation_1.defineAspects)(UpdateManyOperation, [\n    operation_1.Aspect.WRITE_OPERATION,\n    operation_1.Aspect.EXPLAINABLE,\n    operation_1.Aspect.SKIP_COLLATION\n]);\n(0, operation_1.defineAspects)(ReplaceOneOperation, [\n    operation_1.Aspect.RETRYABLE,\n    operation_1.Aspect.WRITE_OPERATION,\n    operation_1.Aspect.SKIP_COLLATION\n]);\n//# sourceMappingURL=update.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL3VwZGF0ZS5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCwyQkFBMkIsR0FBRywyQkFBMkIsR0FBRywyQkFBMkIsR0FBRywwQkFBMEIsR0FBRyx1QkFBdUI7QUFDOUksZ0JBQWdCLG1CQUFPLENBQUMsbUVBQVU7QUFDbEMsZ0JBQWdCLG1CQUFPLENBQUMsbUVBQVU7QUFDbEMsa0JBQWtCLG1CQUFPLENBQUMsaUZBQVc7QUFDckMsb0JBQW9CLG1CQUFPLENBQUMscUZBQWE7QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QjtBQUN2QjtBQUNBO0FBQ0E7QUFDQSw2RUFBNkUsMEJBQTBCO0FBQ3ZHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQSwwQkFBMEI7QUFDMUI7QUFDQTtBQUNBO0FBQ0EsNkVBQTZFLHlCQUF5QjtBQUN0RztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0EsMkJBQTJCO0FBQzNCO0FBQ0E7QUFDQTtBQUNBLGtGQUFrRiwwQkFBMEI7QUFDNUc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBLDJCQUEyQjtBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsiRDpcXHNhbG9uaVxcYXBwcmFpc2FsLXN5c3RlbVxcc2VydmVyXFxub2RlX21vZHVsZXNcXG1vbmdvZGJcXGxpYlxcb3BlcmF0aW9uc1xcdXBkYXRlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5tYWtlVXBkYXRlU3RhdGVtZW50ID0gZXhwb3J0cy5SZXBsYWNlT25lT3BlcmF0aW9uID0gZXhwb3J0cy5VcGRhdGVNYW55T3BlcmF0aW9uID0gZXhwb3J0cy5VcGRhdGVPbmVPcGVyYXRpb24gPSBleHBvcnRzLlVwZGF0ZU9wZXJhdGlvbiA9IHZvaWQgMDtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi4vZXJyb3JcIik7XG5jb25zdCB1dGlsc18xID0gcmVxdWlyZShcIi4uL3V0aWxzXCIpO1xuY29uc3QgY29tbWFuZF8xID0gcmVxdWlyZShcIi4vY29tbWFuZFwiKTtcbmNvbnN0IG9wZXJhdGlvbl8xID0gcmVxdWlyZShcIi4vb3BlcmF0aW9uXCIpO1xuLyoqIEBpbnRlcm5hbCAqL1xuY2xhc3MgVXBkYXRlT3BlcmF0aW9uIGV4dGVuZHMgY29tbWFuZF8xLkNvbW1hbmRDYWxsYmFja09wZXJhdGlvbiB7XG4gICAgY29uc3RydWN0b3IobnMsIHN0YXRlbWVudHMsIG9wdGlvbnMpIHtcbiAgICAgICAgc3VwZXIodW5kZWZpbmVkLCBvcHRpb25zKTtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcbiAgICAgICAgdGhpcy5ucyA9IG5zO1xuICAgICAgICB0aGlzLnN0YXRlbWVudHMgPSBzdGF0ZW1lbnRzO1xuICAgIH1cbiAgICBnZXQgY2FuUmV0cnlXcml0ZSgpIHtcbiAgICAgICAgaWYgKHN1cGVyLmNhblJldHJ5V3JpdGUgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGVtZW50cy5ldmVyeShvcCA9PiBvcC5tdWx0aSA9PSBudWxsIHx8IG9wLm11bHRpID09PSBmYWxzZSk7XG4gICAgfVxuICAgIGV4ZWN1dGVDYWxsYmFjayhzZXJ2ZXIsIHNlc3Npb24sIGNhbGxiYWNrKSB7XG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSB0aGlzLm9wdGlvbnMgPz8ge307XG4gICAgICAgIGNvbnN0IG9yZGVyZWQgPSB0eXBlb2Ygb3B0aW9ucy5vcmRlcmVkID09PSAnYm9vbGVhbicgPyBvcHRpb25zLm9yZGVyZWQgOiB0cnVlO1xuICAgICAgICBjb25zdCBjb21tYW5kID0ge1xuICAgICAgICAgICAgdXBkYXRlOiB0aGlzLm5zLmNvbGxlY3Rpb24sXG4gICAgICAgICAgICB1cGRhdGVzOiB0aGlzLnN0YXRlbWVudHMsXG4gICAgICAgICAgICBvcmRlcmVkXG4gICAgICAgIH07XG4gICAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5ieXBhc3NEb2N1bWVudFZhbGlkYXRpb24gPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgY29tbWFuZC5ieXBhc3NEb2N1bWVudFZhbGlkYXRpb24gPSBvcHRpb25zLmJ5cGFzc0RvY3VtZW50VmFsaWRhdGlvbjtcbiAgICAgICAgfVxuICAgICAgICBpZiAob3B0aW9ucy5sZXQpIHtcbiAgICAgICAgICAgIGNvbW1hbmQubGV0ID0gb3B0aW9ucy5sZXQ7XG4gICAgICAgIH1cbiAgICAgICAgLy8gd2UgY2hlY2sgZm9yIHVuZGVmaW5lZCBzcGVjaWZpY2FsbHkgaGVyZSB0byBhbGxvdyBmYWxzeSB2YWx1ZXNcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXJlc3RyaWN0ZWQtc3ludGF4XG4gICAgICAgIGlmIChvcHRpb25zLmNvbW1lbnQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgY29tbWFuZC5jb21tZW50ID0gb3B0aW9ucy5jb21tZW50O1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHVuYWNrbm93bGVkZ2VkV3JpdGUgPSB0aGlzLndyaXRlQ29uY2VybiAmJiB0aGlzLndyaXRlQ29uY2Vybi53ID09PSAwO1xuICAgICAgICBpZiAodW5hY2tub3dsZWRnZWRXcml0ZSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuc3RhdGVtZW50cy5maW5kKChvKSA9PiBvLmhpbnQpKSB7XG4gICAgICAgICAgICAgICAgLy8gVE9ETyhOT0RFLTM1NDEpOiBmaXggZXJyb3IgZm9yIGhpbnQgd2l0aCB1bmFja25vd2xlZGdlZCB3cml0ZXNcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhuZXcgZXJyb3JfMS5Nb25nb0NvbXBhdGliaWxpdHlFcnJvcihgaGludCBpcyBub3Qgc3VwcG9ydGVkIHdpdGggdW5hY2tub3dsZWRnZWQgd3JpdGVzYCkpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBzdXBlci5leGVjdXRlQ29tbWFuZENhbGxiYWNrKHNlcnZlciwgc2Vzc2lvbiwgY29tbWFuZCwgY2FsbGJhY2spO1xuICAgIH1cbn1cbmV4cG9ydHMuVXBkYXRlT3BlcmF0aW9uID0gVXBkYXRlT3BlcmF0aW9uO1xuLyoqIEBpbnRlcm5hbCAqL1xuY2xhc3MgVXBkYXRlT25lT3BlcmF0aW9uIGV4dGVuZHMgVXBkYXRlT3BlcmF0aW9uIHtcbiAgICBjb25zdHJ1Y3Rvcihjb2xsZWN0aW9uLCBmaWx0ZXIsIHVwZGF0ZSwgb3B0aW9ucykge1xuICAgICAgICBzdXBlcihjb2xsZWN0aW9uLnMubmFtZXNwYWNlLCBbbWFrZVVwZGF0ZVN0YXRlbWVudChmaWx0ZXIsIHVwZGF0ZSwgeyAuLi5vcHRpb25zLCBtdWx0aTogZmFsc2UgfSldLCBvcHRpb25zKTtcbiAgICAgICAgaWYgKCEoMCwgdXRpbHNfMS5oYXNBdG9taWNPcGVyYXRvcnMpKHVwZGF0ZSkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoJ1VwZGF0ZSBkb2N1bWVudCByZXF1aXJlcyBhdG9taWMgb3BlcmF0b3JzJyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZXhlY3V0ZUNhbGxiYWNrKHNlcnZlciwgc2Vzc2lvbiwgY2FsbGJhY2spIHtcbiAgICAgICAgc3VwZXIuZXhlY3V0ZUNhbGxiYWNrKHNlcnZlciwgc2Vzc2lvbiwgKGVyciwgcmVzKSA9PiB7XG4gICAgICAgICAgICBpZiAoZXJyIHx8ICFyZXMpXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgICAgICAgICBpZiAodGhpcy5leHBsYWluICE9IG51bGwpXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKHVuZGVmaW5lZCwgcmVzKTtcbiAgICAgICAgICAgIGlmIChyZXMuY29kZSlcbiAgICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2sobmV3IGVycm9yXzEuTW9uZ29TZXJ2ZXJFcnJvcihyZXMpKTtcbiAgICAgICAgICAgIGlmIChyZXMud3JpdGVFcnJvcnMpXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKG5ldyBlcnJvcl8xLk1vbmdvU2VydmVyRXJyb3IocmVzLndyaXRlRXJyb3JzWzBdKSk7XG4gICAgICAgICAgICBjYWxsYmFjayh1bmRlZmluZWQsIHtcbiAgICAgICAgICAgICAgICBhY2tub3dsZWRnZWQ6IHRoaXMud3JpdGVDb25jZXJuPy53ICE9PSAwID8/IHRydWUsXG4gICAgICAgICAgICAgICAgbW9kaWZpZWRDb3VudDogcmVzLm5Nb2RpZmllZCAhPSBudWxsID8gcmVzLm5Nb2RpZmllZCA6IHJlcy5uLFxuICAgICAgICAgICAgICAgIHVwc2VydGVkSWQ6IEFycmF5LmlzQXJyYXkocmVzLnVwc2VydGVkKSAmJiByZXMudXBzZXJ0ZWQubGVuZ3RoID4gMCA/IHJlcy51cHNlcnRlZFswXS5faWQgOiBudWxsLFxuICAgICAgICAgICAgICAgIHVwc2VydGVkQ291bnQ6IEFycmF5LmlzQXJyYXkocmVzLnVwc2VydGVkKSAmJiByZXMudXBzZXJ0ZWQubGVuZ3RoID8gcmVzLnVwc2VydGVkLmxlbmd0aCA6IDAsXG4gICAgICAgICAgICAgICAgbWF0Y2hlZENvdW50OiBBcnJheS5pc0FycmF5KHJlcy51cHNlcnRlZCkgJiYgcmVzLnVwc2VydGVkLmxlbmd0aCA+IDAgPyAwIDogcmVzLm5cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5leHBvcnRzLlVwZGF0ZU9uZU9wZXJhdGlvbiA9IFVwZGF0ZU9uZU9wZXJhdGlvbjtcbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIFVwZGF0ZU1hbnlPcGVyYXRpb24gZXh0ZW5kcyBVcGRhdGVPcGVyYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKGNvbGxlY3Rpb24sIGZpbHRlciwgdXBkYXRlLCBvcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKGNvbGxlY3Rpb24ucy5uYW1lc3BhY2UsIFttYWtlVXBkYXRlU3RhdGVtZW50KGZpbHRlciwgdXBkYXRlLCB7IC4uLm9wdGlvbnMsIG11bHRpOiB0cnVlIH0pXSwgb3B0aW9ucyk7XG4gICAgICAgIGlmICghKDAsIHV0aWxzXzEuaGFzQXRvbWljT3BlcmF0b3JzKSh1cGRhdGUpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdVcGRhdGUgZG9jdW1lbnQgcmVxdWlyZXMgYXRvbWljIG9wZXJhdG9ycycpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGV4ZWN1dGVDYWxsYmFjayhzZXJ2ZXIsIHNlc3Npb24sIGNhbGxiYWNrKSB7XG4gICAgICAgIHN1cGVyLmV4ZWN1dGVDYWxsYmFjayhzZXJ2ZXIsIHNlc3Npb24sIChlcnIsIHJlcykgPT4ge1xuICAgICAgICAgICAgaWYgKGVyciB8fCAhcmVzKVxuICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgICAgICAgICAgaWYgKHRoaXMuZXhwbGFpbiAhPSBudWxsKVxuICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayh1bmRlZmluZWQsIHJlcyk7XG4gICAgICAgICAgICBpZiAocmVzLmNvZGUpXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKG5ldyBlcnJvcl8xLk1vbmdvU2VydmVyRXJyb3IocmVzKSk7XG4gICAgICAgICAgICBpZiAocmVzLndyaXRlRXJyb3JzKVxuICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhuZXcgZXJyb3JfMS5Nb25nb1NlcnZlckVycm9yKHJlcy53cml0ZUVycm9yc1swXSkpO1xuICAgICAgICAgICAgY2FsbGJhY2sodW5kZWZpbmVkLCB7XG4gICAgICAgICAgICAgICAgYWNrbm93bGVkZ2VkOiB0aGlzLndyaXRlQ29uY2Vybj8udyAhPT0gMCA/PyB0cnVlLFxuICAgICAgICAgICAgICAgIG1vZGlmaWVkQ291bnQ6IHJlcy5uTW9kaWZpZWQgIT0gbnVsbCA/IHJlcy5uTW9kaWZpZWQgOiByZXMubixcbiAgICAgICAgICAgICAgICB1cHNlcnRlZElkOiBBcnJheS5pc0FycmF5KHJlcy51cHNlcnRlZCkgJiYgcmVzLnVwc2VydGVkLmxlbmd0aCA+IDAgPyByZXMudXBzZXJ0ZWRbMF0uX2lkIDogbnVsbCxcbiAgICAgICAgICAgICAgICB1cHNlcnRlZENvdW50OiBBcnJheS5pc0FycmF5KHJlcy51cHNlcnRlZCkgJiYgcmVzLnVwc2VydGVkLmxlbmd0aCA/IHJlcy51cHNlcnRlZC5sZW5ndGggOiAwLFxuICAgICAgICAgICAgICAgIG1hdGNoZWRDb3VudDogQXJyYXkuaXNBcnJheShyZXMudXBzZXJ0ZWQpICYmIHJlcy51cHNlcnRlZC5sZW5ndGggPiAwID8gMCA6IHJlcy5uXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuZXhwb3J0cy5VcGRhdGVNYW55T3BlcmF0aW9uID0gVXBkYXRlTWFueU9wZXJhdGlvbjtcbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIFJlcGxhY2VPbmVPcGVyYXRpb24gZXh0ZW5kcyBVcGRhdGVPcGVyYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKGNvbGxlY3Rpb24sIGZpbHRlciwgcmVwbGFjZW1lbnQsIG9wdGlvbnMpIHtcbiAgICAgICAgc3VwZXIoY29sbGVjdGlvbi5zLm5hbWVzcGFjZSwgW21ha2VVcGRhdGVTdGF0ZW1lbnQoZmlsdGVyLCByZXBsYWNlbWVudCwgeyAuLi5vcHRpb25zLCBtdWx0aTogZmFsc2UgfSldLCBvcHRpb25zKTtcbiAgICAgICAgaWYgKCgwLCB1dGlsc18xLmhhc0F0b21pY09wZXJhdG9ycykocmVwbGFjZW1lbnQpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdSZXBsYWNlbWVudCBkb2N1bWVudCBtdXN0IG5vdCBjb250YWluIGF0b21pYyBvcGVyYXRvcnMnKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBleGVjdXRlQ2FsbGJhY2soc2VydmVyLCBzZXNzaW9uLCBjYWxsYmFjaykge1xuICAgICAgICBzdXBlci5leGVjdXRlQ2FsbGJhY2soc2VydmVyLCBzZXNzaW9uLCAoZXJyLCByZXMpID0+IHtcbiAgICAgICAgICAgIGlmIChlcnIgfHwgIXJlcylcbiAgICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICAgICAgICAgIGlmICh0aGlzLmV4cGxhaW4gIT0gbnVsbClcbiAgICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2sodW5kZWZpbmVkLCByZXMpO1xuICAgICAgICAgICAgaWYgKHJlcy5jb2RlKVxuICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhuZXcgZXJyb3JfMS5Nb25nb1NlcnZlckVycm9yKHJlcykpO1xuICAgICAgICAgICAgaWYgKHJlcy53cml0ZUVycm9ycylcbiAgICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2sobmV3IGVycm9yXzEuTW9uZ29TZXJ2ZXJFcnJvcihyZXMud3JpdGVFcnJvcnNbMF0pKTtcbiAgICAgICAgICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwge1xuICAgICAgICAgICAgICAgIGFja25vd2xlZGdlZDogdGhpcy53cml0ZUNvbmNlcm4/LncgIT09IDAgPz8gdHJ1ZSxcbiAgICAgICAgICAgICAgICBtb2RpZmllZENvdW50OiByZXMubk1vZGlmaWVkICE9IG51bGwgPyByZXMubk1vZGlmaWVkIDogcmVzLm4sXG4gICAgICAgICAgICAgICAgdXBzZXJ0ZWRJZDogQXJyYXkuaXNBcnJheShyZXMudXBzZXJ0ZWQpICYmIHJlcy51cHNlcnRlZC5sZW5ndGggPiAwID8gcmVzLnVwc2VydGVkWzBdLl9pZCA6IG51bGwsXG4gICAgICAgICAgICAgICAgdXBzZXJ0ZWRDb3VudDogQXJyYXkuaXNBcnJheShyZXMudXBzZXJ0ZWQpICYmIHJlcy51cHNlcnRlZC5sZW5ndGggPyByZXMudXBzZXJ0ZWQubGVuZ3RoIDogMCxcbiAgICAgICAgICAgICAgICBtYXRjaGVkQ291bnQ6IEFycmF5LmlzQXJyYXkocmVzLnVwc2VydGVkKSAmJiByZXMudXBzZXJ0ZWQubGVuZ3RoID4gMCA/IDAgOiByZXMublxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmV4cG9ydHMuUmVwbGFjZU9uZU9wZXJhdGlvbiA9IFJlcGxhY2VPbmVPcGVyYXRpb247XG5mdW5jdGlvbiBtYWtlVXBkYXRlU3RhdGVtZW50KGZpbHRlciwgdXBkYXRlLCBvcHRpb25zKSB7XG4gICAgaWYgKGZpbHRlciA9PSBudWxsIHx8IHR5cGVvZiBmaWx0ZXIgIT09ICdvYmplY3QnKSB7XG4gICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoJ1NlbGVjdG9yIG11c3QgYmUgYSB2YWxpZCBKYXZhU2NyaXB0IG9iamVjdCcpO1xuICAgIH1cbiAgICBpZiAodXBkYXRlID09IG51bGwgfHwgdHlwZW9mIHVwZGF0ZSAhPT0gJ29iamVjdCcpIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignRG9jdW1lbnQgbXVzdCBiZSBhIHZhbGlkIEphdmFTY3JpcHQgb2JqZWN0Jyk7XG4gICAgfVxuICAgIGNvbnN0IG9wID0geyBxOiBmaWx0ZXIsIHU6IHVwZGF0ZSB9O1xuICAgIGlmICh0eXBlb2Ygb3B0aW9ucy51cHNlcnQgPT09ICdib29sZWFuJykge1xuICAgICAgICBvcC51cHNlcnQgPSBvcHRpb25zLnVwc2VydDtcbiAgICB9XG4gICAgaWYgKG9wdGlvbnMubXVsdGkpIHtcbiAgICAgICAgb3AubXVsdGkgPSBvcHRpb25zLm11bHRpO1xuICAgIH1cbiAgICBpZiAob3B0aW9ucy5oaW50KSB7XG4gICAgICAgIG9wLmhpbnQgPSBvcHRpb25zLmhpbnQ7XG4gICAgfVxuICAgIGlmIChvcHRpb25zLmFycmF5RmlsdGVycykge1xuICAgICAgICBvcC5hcnJheUZpbHRlcnMgPSBvcHRpb25zLmFycmF5RmlsdGVycztcbiAgICB9XG4gICAgaWYgKG9wdGlvbnMuY29sbGF0aW9uKSB7XG4gICAgICAgIG9wLmNvbGxhdGlvbiA9IG9wdGlvbnMuY29sbGF0aW9uO1xuICAgIH1cbiAgICByZXR1cm4gb3A7XG59XG5leHBvcnRzLm1ha2VVcGRhdGVTdGF0ZW1lbnQgPSBtYWtlVXBkYXRlU3RhdGVtZW50O1xuKDAsIG9wZXJhdGlvbl8xLmRlZmluZUFzcGVjdHMpKFVwZGF0ZU9wZXJhdGlvbiwgW29wZXJhdGlvbl8xLkFzcGVjdC5SRVRSWUFCTEUsIG9wZXJhdGlvbl8xLkFzcGVjdC5XUklURV9PUEVSQVRJT04sIG9wZXJhdGlvbl8xLkFzcGVjdC5TS0lQX0NPTExBVElPTl0pO1xuKDAsIG9wZXJhdGlvbl8xLmRlZmluZUFzcGVjdHMpKFVwZGF0ZU9uZU9wZXJhdGlvbiwgW1xuICAgIG9wZXJhdGlvbl8xLkFzcGVjdC5SRVRSWUFCTEUsXG4gICAgb3BlcmF0aW9uXzEuQXNwZWN0LldSSVRFX09QRVJBVElPTixcbiAgICBvcGVyYXRpb25fMS5Bc3BlY3QuRVhQTEFJTkFCTEUsXG4gICAgb3BlcmF0aW9uXzEuQXNwZWN0LlNLSVBfQ09MTEFUSU9OXG5dKTtcbigwLCBvcGVyYXRpb25fMS5kZWZpbmVBc3BlY3RzKShVcGRhdGVNYW55T3BlcmF0aW9uLCBbXG4gICAgb3BlcmF0aW9uXzEuQXNwZWN0LldSSVRFX09QRVJBVElPTixcbiAgICBvcGVyYXRpb25fMS5Bc3BlY3QuRVhQTEFJTkFCTEUsXG4gICAgb3BlcmF0aW9uXzEuQXNwZWN0LlNLSVBfQ09MTEFUSU9OXG5dKTtcbigwLCBvcGVyYXRpb25fMS5kZWZpbmVBc3BlY3RzKShSZXBsYWNlT25lT3BlcmF0aW9uLCBbXG4gICAgb3BlcmF0aW9uXzEuQXNwZWN0LlJFVFJZQUJMRSxcbiAgICBvcGVyYXRpb25fMS5Bc3BlY3QuV1JJVEVfT1BFUkFUSU9OLFxuICAgIG9wZXJhdGlvbl8xLkFzcGVjdC5TS0lQX0NPTExBVElPTlxuXSk7XG4vLyMgc291cmNlTWFwcGluZ1VSTD11cGRhdGUuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/operations/update.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/operations/validate_collection.js":
/*!****************************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/operations/validate_collection.js ***!
  \****************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.ValidateCollectionOperation = void 0;\nconst error_1 = __webpack_require__(/*! ../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst command_1 = __webpack_require__(/*! ./command */ \"(api)/../server/node_modules/mongodb/lib/operations/command.js\");\n/** @internal */\nclass ValidateCollectionOperation extends command_1.CommandCallbackOperation {\n    constructor(admin, collectionName, options) {\n        // Decorate command with extra options\n        const command = { validate: collectionName };\n        const keys = Object.keys(options);\n        for (let i = 0; i < keys.length; i++) {\n            if (Object.prototype.hasOwnProperty.call(options, keys[i]) && keys[i] !== 'session') {\n                command[keys[i]] = options[keys[i]];\n            }\n        }\n        super(admin.s.db, options);\n        this.options = options;\n        this.command = command;\n        this.collectionName = collectionName;\n    }\n    executeCallback(server, session, callback) {\n        const collectionName = this.collectionName;\n        super.executeCommandCallback(server, session, this.command, (err, doc) => {\n            if (err != null)\n                return callback(err);\n            // TODO(NODE-3483): Replace these with MongoUnexpectedServerResponseError\n            if (doc.ok === 0)\n                return callback(new error_1.MongoRuntimeError('Error with validate command'));\n            if (doc.result != null && typeof doc.result !== 'string')\n                return callback(new error_1.MongoRuntimeError('Error with validation data'));\n            if (doc.result != null && doc.result.match(/exception|corrupt/) != null)\n                return callback(new error_1.MongoRuntimeError(`Invalid collection ${collectionName}`));\n            if (doc.valid != null && !doc.valid)\n                return callback(new error_1.MongoRuntimeError(`Invalid collection ${collectionName}`));\n            return callback(undefined, doc);\n        });\n    }\n}\nexports.ValidateCollectionOperation = ValidateCollectionOperation;\n//# sourceMappingURL=validate_collection.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL3ZhbGlkYXRlX2NvbGxlY3Rpb24uanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsbUNBQW1DO0FBQ25DLGdCQUFnQixtQkFBTyxDQUFDLG1FQUFVO0FBQ2xDLGtCQUFrQixtQkFBTyxDQUFDLGlGQUFXO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCO0FBQzFCO0FBQ0Esd0JBQXdCLGlCQUFpQjtBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0ZBQW9GLGVBQWU7QUFDbkc7QUFDQSxvRkFBb0YsZUFBZTtBQUNuRztBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsbUNBQW1DO0FBQ25DIiwic291cmNlcyI6WyJEOlxcc2Fsb25pXFxhcHByYWlzYWwtc3lzdGVtXFxzZXJ2ZXJcXG5vZGVfbW9kdWxlc1xcbW9uZ29kYlxcbGliXFxvcGVyYXRpb25zXFx2YWxpZGF0ZV9jb2xsZWN0aW9uLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5WYWxpZGF0ZUNvbGxlY3Rpb25PcGVyYXRpb24gPSB2b2lkIDA7XG5jb25zdCBlcnJvcl8xID0gcmVxdWlyZShcIi4uL2Vycm9yXCIpO1xuY29uc3QgY29tbWFuZF8xID0gcmVxdWlyZShcIi4vY29tbWFuZFwiKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIFZhbGlkYXRlQ29sbGVjdGlvbk9wZXJhdGlvbiBleHRlbmRzIGNvbW1hbmRfMS5Db21tYW5kQ2FsbGJhY2tPcGVyYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKGFkbWluLCBjb2xsZWN0aW9uTmFtZSwgb3B0aW9ucykge1xuICAgICAgICAvLyBEZWNvcmF0ZSBjb21tYW5kIHdpdGggZXh0cmEgb3B0aW9uc1xuICAgICAgICBjb25zdCBjb21tYW5kID0geyB2YWxpZGF0ZTogY29sbGVjdGlvbk5hbWUgfTtcbiAgICAgICAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKG9wdGlvbnMpO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob3B0aW9ucywga2V5c1tpXSkgJiYga2V5c1tpXSAhPT0gJ3Nlc3Npb24nKSB7XG4gICAgICAgICAgICAgICAgY29tbWFuZFtrZXlzW2ldXSA9IG9wdGlvbnNba2V5c1tpXV07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgc3VwZXIoYWRtaW4ucy5kYiwgb3B0aW9ucyk7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XG4gICAgICAgIHRoaXMuY29tbWFuZCA9IGNvbW1hbmQ7XG4gICAgICAgIHRoaXMuY29sbGVjdGlvbk5hbWUgPSBjb2xsZWN0aW9uTmFtZTtcbiAgICB9XG4gICAgZXhlY3V0ZUNhbGxiYWNrKHNlcnZlciwgc2Vzc2lvbiwgY2FsbGJhY2spIHtcbiAgICAgICAgY29uc3QgY29sbGVjdGlvbk5hbWUgPSB0aGlzLmNvbGxlY3Rpb25OYW1lO1xuICAgICAgICBzdXBlci5leGVjdXRlQ29tbWFuZENhbGxiYWNrKHNlcnZlciwgc2Vzc2lvbiwgdGhpcy5jb21tYW5kLCAoZXJyLCBkb2MpID0+IHtcbiAgICAgICAgICAgIGlmIChlcnIgIT0gbnVsbClcbiAgICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICAgICAgICAgIC8vIFRPRE8oTk9ERS0zNDgzKTogUmVwbGFjZSB0aGVzZSB3aXRoIE1vbmdvVW5leHBlY3RlZFNlcnZlclJlc3BvbnNlRXJyb3JcbiAgICAgICAgICAgIGlmIChkb2Mub2sgPT09IDApXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKG5ldyBlcnJvcl8xLk1vbmdvUnVudGltZUVycm9yKCdFcnJvciB3aXRoIHZhbGlkYXRlIGNvbW1hbmQnKSk7XG4gICAgICAgICAgICBpZiAoZG9jLnJlc3VsdCAhPSBudWxsICYmIHR5cGVvZiBkb2MucmVzdWx0ICE9PSAnc3RyaW5nJylcbiAgICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2sobmV3IGVycm9yXzEuTW9uZ29SdW50aW1lRXJyb3IoJ0Vycm9yIHdpdGggdmFsaWRhdGlvbiBkYXRhJykpO1xuICAgICAgICAgICAgaWYgKGRvYy5yZXN1bHQgIT0gbnVsbCAmJiBkb2MucmVzdWx0Lm1hdGNoKC9leGNlcHRpb258Y29ycnVwdC8pICE9IG51bGwpXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKG5ldyBlcnJvcl8xLk1vbmdvUnVudGltZUVycm9yKGBJbnZhbGlkIGNvbGxlY3Rpb24gJHtjb2xsZWN0aW9uTmFtZX1gKSk7XG4gICAgICAgICAgICBpZiAoZG9jLnZhbGlkICE9IG51bGwgJiYgIWRvYy52YWxpZClcbiAgICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2sobmV3IGVycm9yXzEuTW9uZ29SdW50aW1lRXJyb3IoYEludmFsaWQgY29sbGVjdGlvbiAke2NvbGxlY3Rpb25OYW1lfWApKTtcbiAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayh1bmRlZmluZWQsIGRvYyk7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmV4cG9ydHMuVmFsaWRhdGVDb2xsZWN0aW9uT3BlcmF0aW9uID0gVmFsaWRhdGVDb2xsZWN0aW9uT3BlcmF0aW9uO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9dmFsaWRhdGVfY29sbGVjdGlvbi5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/operations/validate_collection.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/read_concern.js":
/*!**********************************************************!*\
  !*** ../server/node_modules/mongodb/lib/read_concern.js ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, exports) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.ReadConcern = exports.ReadConcernLevel = void 0;\n/** @public */\nexports.ReadConcernLevel = Object.freeze({\n    local: 'local',\n    majority: 'majority',\n    linearizable: 'linearizable',\n    available: 'available',\n    snapshot: 'snapshot'\n});\n/**\n * The MongoDB ReadConcern, which allows for control of the consistency and isolation properties\n * of the data read from replica sets and replica set shards.\n * @public\n *\n * @see https://www.mongodb.com/docs/manual/reference/read-concern/index.html\n */\nclass ReadConcern {\n    /** Constructs a ReadConcern from the read concern level.*/\n    constructor(level) {\n        /**\n         * A spec test exists that allows level to be any string.\n         * \"invalid readConcern with out stage\"\n         * @see ./test/spec/crud/v2/aggregate-out-readConcern.json\n         * @see https://github.com/mongodb/specifications/blob/master/source/read-write-concern/read-write-concern.rst#unknown-levels-and-additional-options-for-string-based-readconcerns\n         */\n        this.level = exports.ReadConcernLevel[level] ?? level;\n    }\n    /**\n     * Construct a ReadConcern given an options object.\n     *\n     * @param options - The options object from which to extract the write concern.\n     */\n    static fromOptions(options) {\n        if (options == null) {\n            return;\n        }\n        if (options.readConcern) {\n            const { readConcern } = options;\n            if (readConcern instanceof ReadConcern) {\n                return readConcern;\n            }\n            else if (typeof readConcern === 'string') {\n                return new ReadConcern(readConcern);\n            }\n            else if ('level' in readConcern && readConcern.level) {\n                return new ReadConcern(readConcern.level);\n            }\n        }\n        if (options.level) {\n            return new ReadConcern(options.level);\n        }\n        return;\n    }\n    static get MAJORITY() {\n        return exports.ReadConcernLevel.majority;\n    }\n    static get AVAILABLE() {\n        return exports.ReadConcernLevel.available;\n    }\n    static get LINEARIZABLE() {\n        return exports.ReadConcernLevel.linearizable;\n    }\n    static get SNAPSHOT() {\n        return exports.ReadConcernLevel.snapshot;\n    }\n    toJSON() {\n        return { level: this.level };\n    }\n}\nexports.ReadConcern = ReadConcern;\n//# sourceMappingURL=read_concern.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9yZWFkX2NvbmNlcm4uanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsbUJBQW1CLEdBQUcsd0JBQXdCO0FBQzlDO0FBQ0Esd0JBQXdCO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsY0FBYztBQUNsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsbUJBQW1CO0FBQ25CIiwic291cmNlcyI6WyJEOlxcc2Fsb25pXFxhcHByYWlzYWwtc3lzdGVtXFxzZXJ2ZXJcXG5vZGVfbW9kdWxlc1xcbW9uZ29kYlxcbGliXFxyZWFkX2NvbmNlcm4uanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLlJlYWRDb25jZXJuID0gZXhwb3J0cy5SZWFkQ29uY2VybkxldmVsID0gdm9pZCAwO1xuLyoqIEBwdWJsaWMgKi9cbmV4cG9ydHMuUmVhZENvbmNlcm5MZXZlbCA9IE9iamVjdC5mcmVlemUoe1xuICAgIGxvY2FsOiAnbG9jYWwnLFxuICAgIG1ham9yaXR5OiAnbWFqb3JpdHknLFxuICAgIGxpbmVhcml6YWJsZTogJ2xpbmVhcml6YWJsZScsXG4gICAgYXZhaWxhYmxlOiAnYXZhaWxhYmxlJyxcbiAgICBzbmFwc2hvdDogJ3NuYXBzaG90J1xufSk7XG4vKipcbiAqIFRoZSBNb25nb0RCIFJlYWRDb25jZXJuLCB3aGljaCBhbGxvd3MgZm9yIGNvbnRyb2wgb2YgdGhlIGNvbnNpc3RlbmN5IGFuZCBpc29sYXRpb24gcHJvcGVydGllc1xuICogb2YgdGhlIGRhdGEgcmVhZCBmcm9tIHJlcGxpY2Egc2V0cyBhbmQgcmVwbGljYSBzZXQgc2hhcmRzLlxuICogQHB1YmxpY1xuICpcbiAqIEBzZWUgaHR0cHM6Ly93d3cubW9uZ29kYi5jb20vZG9jcy9tYW51YWwvcmVmZXJlbmNlL3JlYWQtY29uY2Vybi9pbmRleC5odG1sXG4gKi9cbmNsYXNzIFJlYWRDb25jZXJuIHtcbiAgICAvKiogQ29uc3RydWN0cyBhIFJlYWRDb25jZXJuIGZyb20gdGhlIHJlYWQgY29uY2VybiBsZXZlbC4qL1xuICAgIGNvbnN0cnVjdG9yKGxldmVsKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBIHNwZWMgdGVzdCBleGlzdHMgdGhhdCBhbGxvd3MgbGV2ZWwgdG8gYmUgYW55IHN0cmluZy5cbiAgICAgICAgICogXCJpbnZhbGlkIHJlYWRDb25jZXJuIHdpdGggb3V0IHN0YWdlXCJcbiAgICAgICAgICogQHNlZSAuL3Rlc3Qvc3BlYy9jcnVkL3YyL2FnZ3JlZ2F0ZS1vdXQtcmVhZENvbmNlcm4uanNvblxuICAgICAgICAgKiBAc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9tb25nb2RiL3NwZWNpZmljYXRpb25zL2Jsb2IvbWFzdGVyL3NvdXJjZS9yZWFkLXdyaXRlLWNvbmNlcm4vcmVhZC13cml0ZS1jb25jZXJuLnJzdCN1bmtub3duLWxldmVscy1hbmQtYWRkaXRpb25hbC1vcHRpb25zLWZvci1zdHJpbmctYmFzZWQtcmVhZGNvbmNlcm5zXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmxldmVsID0gZXhwb3J0cy5SZWFkQ29uY2VybkxldmVsW2xldmVsXSA/PyBsZXZlbDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ29uc3RydWN0IGEgUmVhZENvbmNlcm4gZ2l2ZW4gYW4gb3B0aW9ucyBvYmplY3QuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIFRoZSBvcHRpb25zIG9iamVjdCBmcm9tIHdoaWNoIHRvIGV4dHJhY3QgdGhlIHdyaXRlIGNvbmNlcm4uXG4gICAgICovXG4gICAgc3RhdGljIGZyb21PcHRpb25zKG9wdGlvbnMpIHtcbiAgICAgICAgaWYgKG9wdGlvbnMgPT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvcHRpb25zLnJlYWRDb25jZXJuKSB7XG4gICAgICAgICAgICBjb25zdCB7IHJlYWRDb25jZXJuIH0gPSBvcHRpb25zO1xuICAgICAgICAgICAgaWYgKHJlYWRDb25jZXJuIGluc3RhbmNlb2YgUmVhZENvbmNlcm4pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVhZENvbmNlcm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgcmVhZENvbmNlcm4gPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBSZWFkQ29uY2VybihyZWFkQ29uY2Vybik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICgnbGV2ZWwnIGluIHJlYWRDb25jZXJuICYmIHJlYWRDb25jZXJuLmxldmVsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBSZWFkQ29uY2VybihyZWFkQ29uY2Vybi5sZXZlbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9wdGlvbnMubGV2ZWwpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgUmVhZENvbmNlcm4ob3B0aW9ucy5sZXZlbCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBzdGF0aWMgZ2V0IE1BSk9SSVRZKCkge1xuICAgICAgICByZXR1cm4gZXhwb3J0cy5SZWFkQ29uY2VybkxldmVsLm1ham9yaXR5O1xuICAgIH1cbiAgICBzdGF0aWMgZ2V0IEFWQUlMQUJMRSgpIHtcbiAgICAgICAgcmV0dXJuIGV4cG9ydHMuUmVhZENvbmNlcm5MZXZlbC5hdmFpbGFibGU7XG4gICAgfVxuICAgIHN0YXRpYyBnZXQgTElORUFSSVpBQkxFKCkge1xuICAgICAgICByZXR1cm4gZXhwb3J0cy5SZWFkQ29uY2VybkxldmVsLmxpbmVhcml6YWJsZTtcbiAgICB9XG4gICAgc3RhdGljIGdldCBTTkFQU0hPVCgpIHtcbiAgICAgICAgcmV0dXJuIGV4cG9ydHMuUmVhZENvbmNlcm5MZXZlbC5zbmFwc2hvdDtcbiAgICB9XG4gICAgdG9KU09OKCkge1xuICAgICAgICByZXR1cm4geyBsZXZlbDogdGhpcy5sZXZlbCB9O1xuICAgIH1cbn1cbmV4cG9ydHMuUmVhZENvbmNlcm4gPSBSZWFkQ29uY2Vybjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXJlYWRfY29uY2Vybi5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/read_concern.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/read_preference.js":
/*!*************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/read_preference.js ***!
  \*************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.ReadPreference = exports.ReadPreferenceMode = void 0;\nconst error_1 = __webpack_require__(/*! ./error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\n/** @public */\nexports.ReadPreferenceMode = Object.freeze({\n    primary: 'primary',\n    primaryPreferred: 'primaryPreferred',\n    secondary: 'secondary',\n    secondaryPreferred: 'secondaryPreferred',\n    nearest: 'nearest'\n});\n/**\n * The **ReadPreference** class is a class that represents a MongoDB ReadPreference and is\n * used to construct connections.\n * @public\n *\n * @see https://www.mongodb.com/docs/manual/core/read-preference/\n */\nclass ReadPreference {\n    /**\n     * @param mode - A string describing the read preference mode (primary|primaryPreferred|secondary|secondaryPreferred|nearest)\n     * @param tags - A tag set used to target reads to members with the specified tag(s). tagSet is not available if using read preference mode primary.\n     * @param options - Additional read preference options\n     */\n    constructor(mode, tags, options) {\n        if (!ReadPreference.isValid(mode)) {\n            throw new error_1.MongoInvalidArgumentError(`Invalid read preference mode ${JSON.stringify(mode)}`);\n        }\n        if (options == null && typeof tags === 'object' && !Array.isArray(tags)) {\n            options = tags;\n            tags = undefined;\n        }\n        else if (tags && !Array.isArray(tags)) {\n            throw new error_1.MongoInvalidArgumentError('ReadPreference tags must be an array');\n        }\n        this.mode = mode;\n        this.tags = tags;\n        this.hedge = options?.hedge;\n        this.maxStalenessSeconds = undefined;\n        this.minWireVersion = undefined;\n        options = options ?? {};\n        if (options.maxStalenessSeconds != null) {\n            if (options.maxStalenessSeconds <= 0) {\n                throw new error_1.MongoInvalidArgumentError('maxStalenessSeconds must be a positive integer');\n            }\n            this.maxStalenessSeconds = options.maxStalenessSeconds;\n            // NOTE: The minimum required wire version is 5 for this read preference. If the existing\n            //       topology has a lower value then a MongoError will be thrown during server selection.\n            this.minWireVersion = 5;\n        }\n        if (this.mode === ReadPreference.PRIMARY) {\n            if (this.tags && Array.isArray(this.tags) && this.tags.length > 0) {\n                throw new error_1.MongoInvalidArgumentError('Primary read preference cannot be combined with tags');\n            }\n            if (this.maxStalenessSeconds) {\n                throw new error_1.MongoInvalidArgumentError('Primary read preference cannot be combined with maxStalenessSeconds');\n            }\n            if (this.hedge) {\n                throw new error_1.MongoInvalidArgumentError('Primary read preference cannot be combined with hedge');\n            }\n        }\n    }\n    // Support the deprecated `preference` property introduced in the porcelain layer\n    get preference() {\n        return this.mode;\n    }\n    static fromString(mode) {\n        return new ReadPreference(mode);\n    }\n    /**\n     * Construct a ReadPreference given an options object.\n     *\n     * @param options - The options object from which to extract the read preference.\n     */\n    static fromOptions(options) {\n        if (!options)\n            return;\n        const readPreference = options.readPreference ?? options.session?.transaction.options.readPreference;\n        const readPreferenceTags = options.readPreferenceTags;\n        if (readPreference == null) {\n            return;\n        }\n        if (typeof readPreference === 'string') {\n            return new ReadPreference(readPreference, readPreferenceTags, {\n                maxStalenessSeconds: options.maxStalenessSeconds,\n                hedge: options.hedge\n            });\n        }\n        else if (!(readPreference instanceof ReadPreference) && typeof readPreference === 'object') {\n            const mode = readPreference.mode || readPreference.preference;\n            if (mode && typeof mode === 'string') {\n                return new ReadPreference(mode, readPreference.tags ?? readPreferenceTags, {\n                    maxStalenessSeconds: readPreference.maxStalenessSeconds,\n                    hedge: options.hedge\n                });\n            }\n        }\n        if (readPreferenceTags) {\n            readPreference.tags = readPreferenceTags;\n        }\n        return readPreference;\n    }\n    /**\n     * Replaces options.readPreference with a ReadPreference instance\n     */\n    static translate(options) {\n        if (options.readPreference == null)\n            return options;\n        const r = options.readPreference;\n        if (typeof r === 'string') {\n            options.readPreference = new ReadPreference(r);\n        }\n        else if (r && !(r instanceof ReadPreference) && typeof r === 'object') {\n            const mode = r.mode || r.preference;\n            if (mode && typeof mode === 'string') {\n                options.readPreference = new ReadPreference(mode, r.tags, {\n                    maxStalenessSeconds: r.maxStalenessSeconds\n                });\n            }\n        }\n        else if (!(r instanceof ReadPreference)) {\n            throw new error_1.MongoInvalidArgumentError(`Invalid read preference: ${r}`);\n        }\n        return options;\n    }\n    /**\n     * Validate if a mode is legal\n     *\n     * @param mode - The string representing the read preference mode.\n     */\n    static isValid(mode) {\n        const VALID_MODES = new Set([\n            ReadPreference.PRIMARY,\n            ReadPreference.PRIMARY_PREFERRED,\n            ReadPreference.SECONDARY,\n            ReadPreference.SECONDARY_PREFERRED,\n            ReadPreference.NEAREST,\n            null\n        ]);\n        return VALID_MODES.has(mode);\n    }\n    /**\n     * Validate if a mode is legal\n     *\n     * @param mode - The string representing the read preference mode.\n     */\n    isValid(mode) {\n        return ReadPreference.isValid(typeof mode === 'string' ? mode : this.mode);\n    }\n    /**\n     * Indicates that this readPreference needs the \"SecondaryOk\" bit when sent over the wire\n     * @see https://www.mongodb.com/docs/manual/reference/mongodb-wire-protocol/#op-query\n     */\n    secondaryOk() {\n        const NEEDS_SECONDARYOK = new Set([\n            ReadPreference.PRIMARY_PREFERRED,\n            ReadPreference.SECONDARY,\n            ReadPreference.SECONDARY_PREFERRED,\n            ReadPreference.NEAREST\n        ]);\n        return NEEDS_SECONDARYOK.has(this.mode);\n    }\n    /**\n     * Check if the two ReadPreferences are equivalent\n     *\n     * @param readPreference - The read preference with which to check equality\n     */\n    equals(readPreference) {\n        return readPreference.mode === this.mode;\n    }\n    /** Return JSON representation */\n    toJSON() {\n        const readPreference = { mode: this.mode };\n        if (Array.isArray(this.tags))\n            readPreference.tags = this.tags;\n        if (this.maxStalenessSeconds)\n            readPreference.maxStalenessSeconds = this.maxStalenessSeconds;\n        if (this.hedge)\n            readPreference.hedge = this.hedge;\n        return readPreference;\n    }\n}\nReadPreference.PRIMARY = exports.ReadPreferenceMode.primary;\nReadPreference.PRIMARY_PREFERRED = exports.ReadPreferenceMode.primaryPreferred;\nReadPreference.SECONDARY = exports.ReadPreferenceMode.secondary;\nReadPreference.SECONDARY_PREFERRED = exports.ReadPreferenceMode.secondaryPreferred;\nReadPreference.NEAREST = exports.ReadPreferenceMode.nearest;\nReadPreference.primary = new ReadPreference(exports.ReadPreferenceMode.primary);\nReadPreference.primaryPreferred = new ReadPreference(exports.ReadPreferenceMode.primaryPreferred);\nReadPreference.secondary = new ReadPreference(exports.ReadPreferenceMode.secondary);\nReadPreference.secondaryPreferred = new ReadPreference(exports.ReadPreferenceMode.secondaryPreferred);\nReadPreference.nearest = new ReadPreference(exports.ReadPreferenceMode.nearest);\nexports.ReadPreference = ReadPreference;\n//# sourceMappingURL=read_preference.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9yZWFkX3ByZWZlcmVuY2UuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0Qsc0JBQXNCLEdBQUcsMEJBQTBCO0FBQ25ELGdCQUFnQixtQkFBTyxDQUFDLGtFQUFTO0FBQ2pDO0FBQ0EsMEJBQTBCO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0ZBQXdGLHFCQUFxQjtBQUM3RztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBLG9GQUFvRixFQUFFO0FBQ3RGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQ0FBaUM7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0I7QUFDdEIiLCJzb3VyY2VzIjpbIkQ6XFxzYWxvbmlcXGFwcHJhaXNhbC1zeXN0ZW1cXHNlcnZlclxcbm9kZV9tb2R1bGVzXFxtb25nb2RiXFxsaWJcXHJlYWRfcHJlZmVyZW5jZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuUmVhZFByZWZlcmVuY2UgPSBleHBvcnRzLlJlYWRQcmVmZXJlbmNlTW9kZSA9IHZvaWQgMDtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi9lcnJvclwiKTtcbi8qKiBAcHVibGljICovXG5leHBvcnRzLlJlYWRQcmVmZXJlbmNlTW9kZSA9IE9iamVjdC5mcmVlemUoe1xuICAgIHByaW1hcnk6ICdwcmltYXJ5JyxcbiAgICBwcmltYXJ5UHJlZmVycmVkOiAncHJpbWFyeVByZWZlcnJlZCcsXG4gICAgc2Vjb25kYXJ5OiAnc2Vjb25kYXJ5JyxcbiAgICBzZWNvbmRhcnlQcmVmZXJyZWQ6ICdzZWNvbmRhcnlQcmVmZXJyZWQnLFxuICAgIG5lYXJlc3Q6ICduZWFyZXN0J1xufSk7XG4vKipcbiAqIFRoZSAqKlJlYWRQcmVmZXJlbmNlKiogY2xhc3MgaXMgYSBjbGFzcyB0aGF0IHJlcHJlc2VudHMgYSBNb25nb0RCIFJlYWRQcmVmZXJlbmNlIGFuZCBpc1xuICogdXNlZCB0byBjb25zdHJ1Y3QgY29ubmVjdGlvbnMuXG4gKiBAcHVibGljXG4gKlxuICogQHNlZSBodHRwczovL3d3dy5tb25nb2RiLmNvbS9kb2NzL21hbnVhbC9jb3JlL3JlYWQtcHJlZmVyZW5jZS9cbiAqL1xuY2xhc3MgUmVhZFByZWZlcmVuY2Uge1xuICAgIC8qKlxuICAgICAqIEBwYXJhbSBtb2RlIC0gQSBzdHJpbmcgZGVzY3JpYmluZyB0aGUgcmVhZCBwcmVmZXJlbmNlIG1vZGUgKHByaW1hcnl8cHJpbWFyeVByZWZlcnJlZHxzZWNvbmRhcnl8c2Vjb25kYXJ5UHJlZmVycmVkfG5lYXJlc3QpXG4gICAgICogQHBhcmFtIHRhZ3MgLSBBIHRhZyBzZXQgdXNlZCB0byB0YXJnZXQgcmVhZHMgdG8gbWVtYmVycyB3aXRoIHRoZSBzcGVjaWZpZWQgdGFnKHMpLiB0YWdTZXQgaXMgbm90IGF2YWlsYWJsZSBpZiB1c2luZyByZWFkIHByZWZlcmVuY2UgbW9kZSBwcmltYXJ5LlxuICAgICAqIEBwYXJhbSBvcHRpb25zIC0gQWRkaXRpb25hbCByZWFkIHByZWZlcmVuY2Ugb3B0aW9uc1xuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKG1vZGUsIHRhZ3MsIG9wdGlvbnMpIHtcbiAgICAgICAgaWYgKCFSZWFkUHJlZmVyZW5jZS5pc1ZhbGlkKG1vZGUpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKGBJbnZhbGlkIHJlYWQgcHJlZmVyZW5jZSBtb2RlICR7SlNPTi5zdHJpbmdpZnkobW9kZSl9YCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9wdGlvbnMgPT0gbnVsbCAmJiB0eXBlb2YgdGFncyA9PT0gJ29iamVjdCcgJiYgIUFycmF5LmlzQXJyYXkodGFncykpIHtcbiAgICAgICAgICAgIG9wdGlvbnMgPSB0YWdzO1xuICAgICAgICAgICAgdGFncyA9IHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0YWdzICYmICFBcnJheS5pc0FycmF5KHRhZ3MpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdSZWFkUHJlZmVyZW5jZSB0YWdzIG11c3QgYmUgYW4gYXJyYXknKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLm1vZGUgPSBtb2RlO1xuICAgICAgICB0aGlzLnRhZ3MgPSB0YWdzO1xuICAgICAgICB0aGlzLmhlZGdlID0gb3B0aW9ucz8uaGVkZ2U7XG4gICAgICAgIHRoaXMubWF4U3RhbGVuZXNzU2Vjb25kcyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5taW5XaXJlVmVyc2lvbiA9IHVuZGVmaW5lZDtcbiAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgPz8ge307XG4gICAgICAgIGlmIChvcHRpb25zLm1heFN0YWxlbmVzc1NlY29uZHMgIT0gbnVsbCkge1xuICAgICAgICAgICAgaWYgKG9wdGlvbnMubWF4U3RhbGVuZXNzU2Vjb25kcyA8PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignbWF4U3RhbGVuZXNzU2Vjb25kcyBtdXN0IGJlIGEgcG9zaXRpdmUgaW50ZWdlcicpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5tYXhTdGFsZW5lc3NTZWNvbmRzID0gb3B0aW9ucy5tYXhTdGFsZW5lc3NTZWNvbmRzO1xuICAgICAgICAgICAgLy8gTk9URTogVGhlIG1pbmltdW0gcmVxdWlyZWQgd2lyZSB2ZXJzaW9uIGlzIDUgZm9yIHRoaXMgcmVhZCBwcmVmZXJlbmNlLiBJZiB0aGUgZXhpc3RpbmdcbiAgICAgICAgICAgIC8vICAgICAgIHRvcG9sb2d5IGhhcyBhIGxvd2VyIHZhbHVlIHRoZW4gYSBNb25nb0Vycm9yIHdpbGwgYmUgdGhyb3duIGR1cmluZyBzZXJ2ZXIgc2VsZWN0aW9uLlxuICAgICAgICAgICAgdGhpcy5taW5XaXJlVmVyc2lvbiA9IDU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMubW9kZSA9PT0gUmVhZFByZWZlcmVuY2UuUFJJTUFSWSkge1xuICAgICAgICAgICAgaWYgKHRoaXMudGFncyAmJiBBcnJheS5pc0FycmF5KHRoaXMudGFncykgJiYgdGhpcy50YWdzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdQcmltYXJ5IHJlYWQgcHJlZmVyZW5jZSBjYW5ub3QgYmUgY29tYmluZWQgd2l0aCB0YWdzJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5tYXhTdGFsZW5lc3NTZWNvbmRzKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignUHJpbWFyeSByZWFkIHByZWZlcmVuY2UgY2Fubm90IGJlIGNvbWJpbmVkIHdpdGggbWF4U3RhbGVuZXNzU2Vjb25kcycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMuaGVkZ2UpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdQcmltYXJ5IHJlYWQgcHJlZmVyZW5jZSBjYW5ub3QgYmUgY29tYmluZWQgd2l0aCBoZWRnZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIC8vIFN1cHBvcnQgdGhlIGRlcHJlY2F0ZWQgYHByZWZlcmVuY2VgIHByb3BlcnR5IGludHJvZHVjZWQgaW4gdGhlIHBvcmNlbGFpbiBsYXllclxuICAgIGdldCBwcmVmZXJlbmNlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5tb2RlO1xuICAgIH1cbiAgICBzdGF0aWMgZnJvbVN0cmluZyhtb2RlKSB7XG4gICAgICAgIHJldHVybiBuZXcgUmVhZFByZWZlcmVuY2UobW9kZSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENvbnN0cnVjdCBhIFJlYWRQcmVmZXJlbmNlIGdpdmVuIGFuIG9wdGlvbnMgb2JqZWN0LlxuICAgICAqXG4gICAgICogQHBhcmFtIG9wdGlvbnMgLSBUaGUgb3B0aW9ucyBvYmplY3QgZnJvbSB3aGljaCB0byBleHRyYWN0IHRoZSByZWFkIHByZWZlcmVuY2UuXG4gICAgICovXG4gICAgc3RhdGljIGZyb21PcHRpb25zKG9wdGlvbnMpIHtcbiAgICAgICAgaWYgKCFvcHRpb25zKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBjb25zdCByZWFkUHJlZmVyZW5jZSA9IG9wdGlvbnMucmVhZFByZWZlcmVuY2UgPz8gb3B0aW9ucy5zZXNzaW9uPy50cmFuc2FjdGlvbi5vcHRpb25zLnJlYWRQcmVmZXJlbmNlO1xuICAgICAgICBjb25zdCByZWFkUHJlZmVyZW5jZVRhZ3MgPSBvcHRpb25zLnJlYWRQcmVmZXJlbmNlVGFncztcbiAgICAgICAgaWYgKHJlYWRQcmVmZXJlbmNlID09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZW9mIHJlYWRQcmVmZXJlbmNlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBSZWFkUHJlZmVyZW5jZShyZWFkUHJlZmVyZW5jZSwgcmVhZFByZWZlcmVuY2VUYWdzLCB7XG4gICAgICAgICAgICAgICAgbWF4U3RhbGVuZXNzU2Vjb25kczogb3B0aW9ucy5tYXhTdGFsZW5lc3NTZWNvbmRzLFxuICAgICAgICAgICAgICAgIGhlZGdlOiBvcHRpb25zLmhlZGdlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICghKHJlYWRQcmVmZXJlbmNlIGluc3RhbmNlb2YgUmVhZFByZWZlcmVuY2UpICYmIHR5cGVvZiByZWFkUHJlZmVyZW5jZSA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgIGNvbnN0IG1vZGUgPSByZWFkUHJlZmVyZW5jZS5tb2RlIHx8IHJlYWRQcmVmZXJlbmNlLnByZWZlcmVuY2U7XG4gICAgICAgICAgICBpZiAobW9kZSAmJiB0eXBlb2YgbW9kZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFJlYWRQcmVmZXJlbmNlKG1vZGUsIHJlYWRQcmVmZXJlbmNlLnRhZ3MgPz8gcmVhZFByZWZlcmVuY2VUYWdzLCB7XG4gICAgICAgICAgICAgICAgICAgIG1heFN0YWxlbmVzc1NlY29uZHM6IHJlYWRQcmVmZXJlbmNlLm1heFN0YWxlbmVzc1NlY29uZHMsXG4gICAgICAgICAgICAgICAgICAgIGhlZGdlOiBvcHRpb25zLmhlZGdlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHJlYWRQcmVmZXJlbmNlVGFncykge1xuICAgICAgICAgICAgcmVhZFByZWZlcmVuY2UudGFncyA9IHJlYWRQcmVmZXJlbmNlVGFncztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVhZFByZWZlcmVuY2U7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJlcGxhY2VzIG9wdGlvbnMucmVhZFByZWZlcmVuY2Ugd2l0aCBhIFJlYWRQcmVmZXJlbmNlIGluc3RhbmNlXG4gICAgICovXG4gICAgc3RhdGljIHRyYW5zbGF0ZShvcHRpb25zKSB7XG4gICAgICAgIGlmIChvcHRpb25zLnJlYWRQcmVmZXJlbmNlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gb3B0aW9ucztcbiAgICAgICAgY29uc3QgciA9IG9wdGlvbnMucmVhZFByZWZlcmVuY2U7XG4gICAgICAgIGlmICh0eXBlb2YgciA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIG9wdGlvbnMucmVhZFByZWZlcmVuY2UgPSBuZXcgUmVhZFByZWZlcmVuY2Uocik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAociAmJiAhKHIgaW5zdGFuY2VvZiBSZWFkUHJlZmVyZW5jZSkgJiYgdHlwZW9mIHIgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICBjb25zdCBtb2RlID0gci5tb2RlIHx8IHIucHJlZmVyZW5jZTtcbiAgICAgICAgICAgIGlmIChtb2RlICYmIHR5cGVvZiBtb2RlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIG9wdGlvbnMucmVhZFByZWZlcmVuY2UgPSBuZXcgUmVhZFByZWZlcmVuY2UobW9kZSwgci50YWdzLCB7XG4gICAgICAgICAgICAgICAgICAgIG1heFN0YWxlbmVzc1NlY29uZHM6IHIubWF4U3RhbGVuZXNzU2Vjb25kc1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKCEociBpbnN0YW5jZW9mIFJlYWRQcmVmZXJlbmNlKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcihgSW52YWxpZCByZWFkIHByZWZlcmVuY2U6ICR7cn1gKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gb3B0aW9ucztcbiAgICB9XG4gICAgLyoqXG4gICAgICogVmFsaWRhdGUgaWYgYSBtb2RlIGlzIGxlZ2FsXG4gICAgICpcbiAgICAgKiBAcGFyYW0gbW9kZSAtIFRoZSBzdHJpbmcgcmVwcmVzZW50aW5nIHRoZSByZWFkIHByZWZlcmVuY2UgbW9kZS5cbiAgICAgKi9cbiAgICBzdGF0aWMgaXNWYWxpZChtb2RlKSB7XG4gICAgICAgIGNvbnN0IFZBTElEX01PREVTID0gbmV3IFNldChbXG4gICAgICAgICAgICBSZWFkUHJlZmVyZW5jZS5QUklNQVJZLFxuICAgICAgICAgICAgUmVhZFByZWZlcmVuY2UuUFJJTUFSWV9QUkVGRVJSRUQsXG4gICAgICAgICAgICBSZWFkUHJlZmVyZW5jZS5TRUNPTkRBUlksXG4gICAgICAgICAgICBSZWFkUHJlZmVyZW5jZS5TRUNPTkRBUllfUFJFRkVSUkVELFxuICAgICAgICAgICAgUmVhZFByZWZlcmVuY2UuTkVBUkVTVCxcbiAgICAgICAgICAgIG51bGxcbiAgICAgICAgXSk7XG4gICAgICAgIHJldHVybiBWQUxJRF9NT0RFUy5oYXMobW9kZSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFZhbGlkYXRlIGlmIGEgbW9kZSBpcyBsZWdhbFxuICAgICAqXG4gICAgICogQHBhcmFtIG1vZGUgLSBUaGUgc3RyaW5nIHJlcHJlc2VudGluZyB0aGUgcmVhZCBwcmVmZXJlbmNlIG1vZGUuXG4gICAgICovXG4gICAgaXNWYWxpZChtb2RlKSB7XG4gICAgICAgIHJldHVybiBSZWFkUHJlZmVyZW5jZS5pc1ZhbGlkKHR5cGVvZiBtb2RlID09PSAnc3RyaW5nJyA/IG1vZGUgOiB0aGlzLm1vZGUpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBJbmRpY2F0ZXMgdGhhdCB0aGlzIHJlYWRQcmVmZXJlbmNlIG5lZWRzIHRoZSBcIlNlY29uZGFyeU9rXCIgYml0IHdoZW4gc2VudCBvdmVyIHRoZSB3aXJlXG4gICAgICogQHNlZSBodHRwczovL3d3dy5tb25nb2RiLmNvbS9kb2NzL21hbnVhbC9yZWZlcmVuY2UvbW9uZ29kYi13aXJlLXByb3RvY29sLyNvcC1xdWVyeVxuICAgICAqL1xuICAgIHNlY29uZGFyeU9rKCkge1xuICAgICAgICBjb25zdCBORUVEU19TRUNPTkRBUllPSyA9IG5ldyBTZXQoW1xuICAgICAgICAgICAgUmVhZFByZWZlcmVuY2UuUFJJTUFSWV9QUkVGRVJSRUQsXG4gICAgICAgICAgICBSZWFkUHJlZmVyZW5jZS5TRUNPTkRBUlksXG4gICAgICAgICAgICBSZWFkUHJlZmVyZW5jZS5TRUNPTkRBUllfUFJFRkVSUkVELFxuICAgICAgICAgICAgUmVhZFByZWZlcmVuY2UuTkVBUkVTVFxuICAgICAgICBdKTtcbiAgICAgICAgcmV0dXJuIE5FRURTX1NFQ09OREFSWU9LLmhhcyh0aGlzLm1vZGUpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDaGVjayBpZiB0aGUgdHdvIFJlYWRQcmVmZXJlbmNlcyBhcmUgZXF1aXZhbGVudFxuICAgICAqXG4gICAgICogQHBhcmFtIHJlYWRQcmVmZXJlbmNlIC0gVGhlIHJlYWQgcHJlZmVyZW5jZSB3aXRoIHdoaWNoIHRvIGNoZWNrIGVxdWFsaXR5XG4gICAgICovXG4gICAgZXF1YWxzKHJlYWRQcmVmZXJlbmNlKSB7XG4gICAgICAgIHJldHVybiByZWFkUHJlZmVyZW5jZS5tb2RlID09PSB0aGlzLm1vZGU7XG4gICAgfVxuICAgIC8qKiBSZXR1cm4gSlNPTiByZXByZXNlbnRhdGlvbiAqL1xuICAgIHRvSlNPTigpIHtcbiAgICAgICAgY29uc3QgcmVhZFByZWZlcmVuY2UgPSB7IG1vZGU6IHRoaXMubW9kZSB9O1xuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh0aGlzLnRhZ3MpKVxuICAgICAgICAgICAgcmVhZFByZWZlcmVuY2UudGFncyA9IHRoaXMudGFncztcbiAgICAgICAgaWYgKHRoaXMubWF4U3RhbGVuZXNzU2Vjb25kcylcbiAgICAgICAgICAgIHJlYWRQcmVmZXJlbmNlLm1heFN0YWxlbmVzc1NlY29uZHMgPSB0aGlzLm1heFN0YWxlbmVzc1NlY29uZHM7XG4gICAgICAgIGlmICh0aGlzLmhlZGdlKVxuICAgICAgICAgICAgcmVhZFByZWZlcmVuY2UuaGVkZ2UgPSB0aGlzLmhlZGdlO1xuICAgICAgICByZXR1cm4gcmVhZFByZWZlcmVuY2U7XG4gICAgfVxufVxuUmVhZFByZWZlcmVuY2UuUFJJTUFSWSA9IGV4cG9ydHMuUmVhZFByZWZlcmVuY2VNb2RlLnByaW1hcnk7XG5SZWFkUHJlZmVyZW5jZS5QUklNQVJZX1BSRUZFUlJFRCA9IGV4cG9ydHMuUmVhZFByZWZlcmVuY2VNb2RlLnByaW1hcnlQcmVmZXJyZWQ7XG5SZWFkUHJlZmVyZW5jZS5TRUNPTkRBUlkgPSBleHBvcnRzLlJlYWRQcmVmZXJlbmNlTW9kZS5zZWNvbmRhcnk7XG5SZWFkUHJlZmVyZW5jZS5TRUNPTkRBUllfUFJFRkVSUkVEID0gZXhwb3J0cy5SZWFkUHJlZmVyZW5jZU1vZGUuc2Vjb25kYXJ5UHJlZmVycmVkO1xuUmVhZFByZWZlcmVuY2UuTkVBUkVTVCA9IGV4cG9ydHMuUmVhZFByZWZlcmVuY2VNb2RlLm5lYXJlc3Q7XG5SZWFkUHJlZmVyZW5jZS5wcmltYXJ5ID0gbmV3IFJlYWRQcmVmZXJlbmNlKGV4cG9ydHMuUmVhZFByZWZlcmVuY2VNb2RlLnByaW1hcnkpO1xuUmVhZFByZWZlcmVuY2UucHJpbWFyeVByZWZlcnJlZCA9IG5ldyBSZWFkUHJlZmVyZW5jZShleHBvcnRzLlJlYWRQcmVmZXJlbmNlTW9kZS5wcmltYXJ5UHJlZmVycmVkKTtcblJlYWRQcmVmZXJlbmNlLnNlY29uZGFyeSA9IG5ldyBSZWFkUHJlZmVyZW5jZShleHBvcnRzLlJlYWRQcmVmZXJlbmNlTW9kZS5zZWNvbmRhcnkpO1xuUmVhZFByZWZlcmVuY2Uuc2Vjb25kYXJ5UHJlZmVycmVkID0gbmV3IFJlYWRQcmVmZXJlbmNlKGV4cG9ydHMuUmVhZFByZWZlcmVuY2VNb2RlLnNlY29uZGFyeVByZWZlcnJlZCk7XG5SZWFkUHJlZmVyZW5jZS5uZWFyZXN0ID0gbmV3IFJlYWRQcmVmZXJlbmNlKGV4cG9ydHMuUmVhZFByZWZlcmVuY2VNb2RlLm5lYXJlc3QpO1xuZXhwb3J0cy5SZWFkUHJlZmVyZW5jZSA9IFJlYWRQcmVmZXJlbmNlO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cmVhZF9wcmVmZXJlbmNlLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/read_preference.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/sdam/common.js":
/*!*********************************************************!*\
  !*** ../server/node_modules/mongodb/lib/sdam/common.js ***!
  \*********************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports._advanceClusterTime = exports.drainTimerQueue = exports.ServerType = exports.TopologyType = exports.STATE_CONNECTED = exports.STATE_CONNECTING = exports.STATE_CLOSED = exports.STATE_CLOSING = void 0;\nconst timers_1 = __webpack_require__(/*! timers */ \"timers\");\n// shared state names\nexports.STATE_CLOSING = 'closing';\nexports.STATE_CLOSED = 'closed';\nexports.STATE_CONNECTING = 'connecting';\nexports.STATE_CONNECTED = 'connected';\n/**\n * An enumeration of topology types we know about\n * @public\n */\nexports.TopologyType = Object.freeze({\n    Single: 'Single',\n    ReplicaSetNoPrimary: 'ReplicaSetNoPrimary',\n    ReplicaSetWithPrimary: 'ReplicaSetWithPrimary',\n    Sharded: 'Sharded',\n    Unknown: 'Unknown',\n    LoadBalanced: 'LoadBalanced'\n});\n/**\n * An enumeration of server types we know about\n * @public\n */\nexports.ServerType = Object.freeze({\n    Standalone: 'Standalone',\n    Mongos: 'Mongos',\n    PossiblePrimary: 'PossiblePrimary',\n    RSPrimary: 'RSPrimary',\n    RSSecondary: 'RSSecondary',\n    RSArbiter: 'RSArbiter',\n    RSOther: 'RSOther',\n    RSGhost: 'RSGhost',\n    Unknown: 'Unknown',\n    LoadBalancer: 'LoadBalancer'\n});\n/** @internal */\nfunction drainTimerQueue(queue) {\n    queue.forEach(timers_1.clearTimeout);\n    queue.clear();\n}\nexports.drainTimerQueue = drainTimerQueue;\n/** Shared function to determine clusterTime for a given topology or session */\nfunction _advanceClusterTime(entity, $clusterTime) {\n    if (entity.clusterTime == null) {\n        entity.clusterTime = $clusterTime;\n    }\n    else {\n        if ($clusterTime.clusterTime.greaterThan(entity.clusterTime.clusterTime)) {\n            entity.clusterTime = $clusterTime;\n        }\n    }\n}\nexports._advanceClusterTime = _advanceClusterTime;\n//# sourceMappingURL=common.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9zZGFtL2NvbW1vbi5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCwyQkFBMkIsR0FBRyx1QkFBdUIsR0FBRyxrQkFBa0IsR0FBRyxvQkFBb0IsR0FBRyx1QkFBdUIsR0FBRyx3QkFBd0IsR0FBRyxvQkFBb0IsR0FBRyxxQkFBcUI7QUFDck0saUJBQWlCLG1CQUFPLENBQUMsc0JBQVE7QUFDakM7QUFDQSxxQkFBcUI7QUFDckIsb0JBQW9CO0FBQ3BCLHdCQUF3QjtBQUN4Qix1QkFBdUI7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0I7QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUI7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQjtBQUMzQiIsInNvdXJjZXMiOlsiRDpcXHNhbG9uaVxcYXBwcmFpc2FsLXN5c3RlbVxcc2VydmVyXFxub2RlX21vZHVsZXNcXG1vbmdvZGJcXGxpYlxcc2RhbVxcY29tbW9uLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5fYWR2YW5jZUNsdXN0ZXJUaW1lID0gZXhwb3J0cy5kcmFpblRpbWVyUXVldWUgPSBleHBvcnRzLlNlcnZlclR5cGUgPSBleHBvcnRzLlRvcG9sb2d5VHlwZSA9IGV4cG9ydHMuU1RBVEVfQ09OTkVDVEVEID0gZXhwb3J0cy5TVEFURV9DT05ORUNUSU5HID0gZXhwb3J0cy5TVEFURV9DTE9TRUQgPSBleHBvcnRzLlNUQVRFX0NMT1NJTkcgPSB2b2lkIDA7XG5jb25zdCB0aW1lcnNfMSA9IHJlcXVpcmUoXCJ0aW1lcnNcIik7XG4vLyBzaGFyZWQgc3RhdGUgbmFtZXNcbmV4cG9ydHMuU1RBVEVfQ0xPU0lORyA9ICdjbG9zaW5nJztcbmV4cG9ydHMuU1RBVEVfQ0xPU0VEID0gJ2Nsb3NlZCc7XG5leHBvcnRzLlNUQVRFX0NPTk5FQ1RJTkcgPSAnY29ubmVjdGluZyc7XG5leHBvcnRzLlNUQVRFX0NPTk5FQ1RFRCA9ICdjb25uZWN0ZWQnO1xuLyoqXG4gKiBBbiBlbnVtZXJhdGlvbiBvZiB0b3BvbG9neSB0eXBlcyB3ZSBrbm93IGFib3V0XG4gKiBAcHVibGljXG4gKi9cbmV4cG9ydHMuVG9wb2xvZ3lUeXBlID0gT2JqZWN0LmZyZWV6ZSh7XG4gICAgU2luZ2xlOiAnU2luZ2xlJyxcbiAgICBSZXBsaWNhU2V0Tm9QcmltYXJ5OiAnUmVwbGljYVNldE5vUHJpbWFyeScsXG4gICAgUmVwbGljYVNldFdpdGhQcmltYXJ5OiAnUmVwbGljYVNldFdpdGhQcmltYXJ5JyxcbiAgICBTaGFyZGVkOiAnU2hhcmRlZCcsXG4gICAgVW5rbm93bjogJ1Vua25vd24nLFxuICAgIExvYWRCYWxhbmNlZDogJ0xvYWRCYWxhbmNlZCdcbn0pO1xuLyoqXG4gKiBBbiBlbnVtZXJhdGlvbiBvZiBzZXJ2ZXIgdHlwZXMgd2Uga25vdyBhYm91dFxuICogQHB1YmxpY1xuICovXG5leHBvcnRzLlNlcnZlclR5cGUgPSBPYmplY3QuZnJlZXplKHtcbiAgICBTdGFuZGFsb25lOiAnU3RhbmRhbG9uZScsXG4gICAgTW9uZ29zOiAnTW9uZ29zJyxcbiAgICBQb3NzaWJsZVByaW1hcnk6ICdQb3NzaWJsZVByaW1hcnknLFxuICAgIFJTUHJpbWFyeTogJ1JTUHJpbWFyeScsXG4gICAgUlNTZWNvbmRhcnk6ICdSU1NlY29uZGFyeScsXG4gICAgUlNBcmJpdGVyOiAnUlNBcmJpdGVyJyxcbiAgICBSU090aGVyOiAnUlNPdGhlcicsXG4gICAgUlNHaG9zdDogJ1JTR2hvc3QnLFxuICAgIFVua25vd246ICdVbmtub3duJyxcbiAgICBMb2FkQmFsYW5jZXI6ICdMb2FkQmFsYW5jZXInXG59KTtcbi8qKiBAaW50ZXJuYWwgKi9cbmZ1bmN0aW9uIGRyYWluVGltZXJRdWV1ZShxdWV1ZSkge1xuICAgIHF1ZXVlLmZvckVhY2godGltZXJzXzEuY2xlYXJUaW1lb3V0KTtcbiAgICBxdWV1ZS5jbGVhcigpO1xufVxuZXhwb3J0cy5kcmFpblRpbWVyUXVldWUgPSBkcmFpblRpbWVyUXVldWU7XG4vKiogU2hhcmVkIGZ1bmN0aW9uIHRvIGRldGVybWluZSBjbHVzdGVyVGltZSBmb3IgYSBnaXZlbiB0b3BvbG9neSBvciBzZXNzaW9uICovXG5mdW5jdGlvbiBfYWR2YW5jZUNsdXN0ZXJUaW1lKGVudGl0eSwgJGNsdXN0ZXJUaW1lKSB7XG4gICAgaWYgKGVudGl0eS5jbHVzdGVyVGltZSA9PSBudWxsKSB7XG4gICAgICAgIGVudGl0eS5jbHVzdGVyVGltZSA9ICRjbHVzdGVyVGltZTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGlmICgkY2x1c3RlclRpbWUuY2x1c3RlclRpbWUuZ3JlYXRlclRoYW4oZW50aXR5LmNsdXN0ZXJUaW1lLmNsdXN0ZXJUaW1lKSkge1xuICAgICAgICAgICAgZW50aXR5LmNsdXN0ZXJUaW1lID0gJGNsdXN0ZXJUaW1lO1xuICAgICAgICB9XG4gICAgfVxufVxuZXhwb3J0cy5fYWR2YW5jZUNsdXN0ZXJUaW1lID0gX2FkdmFuY2VDbHVzdGVyVGltZTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWNvbW1vbi5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/sdam/common.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/sdam/events.js":
/*!*********************************************************!*\
  !*** ../server/node_modules/mongodb/lib/sdam/events.js ***!
  \*********************************************************/
/***/ ((__unused_webpack_module, exports) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.ServerHeartbeatFailedEvent = exports.ServerHeartbeatSucceededEvent = exports.ServerHeartbeatStartedEvent = exports.TopologyClosedEvent = exports.TopologyOpeningEvent = exports.TopologyDescriptionChangedEvent = exports.ServerClosedEvent = exports.ServerOpeningEvent = exports.ServerDescriptionChangedEvent = void 0;\n/**\n * Emitted when server description changes, but does NOT include changes to the RTT.\n * @public\n * @category Event\n */\nclass ServerDescriptionChangedEvent {\n    /** @internal */\n    constructor(topologyId, address, previousDescription, newDescription) {\n        this.topologyId = topologyId;\n        this.address = address;\n        this.previousDescription = previousDescription;\n        this.newDescription = newDescription;\n    }\n}\nexports.ServerDescriptionChangedEvent = ServerDescriptionChangedEvent;\n/**\n * Emitted when server is initialized.\n * @public\n * @category Event\n */\nclass ServerOpeningEvent {\n    /** @internal */\n    constructor(topologyId, address) {\n        this.topologyId = topologyId;\n        this.address = address;\n    }\n}\nexports.ServerOpeningEvent = ServerOpeningEvent;\n/**\n * Emitted when server is closed.\n * @public\n * @category Event\n */\nclass ServerClosedEvent {\n    /** @internal */\n    constructor(topologyId, address) {\n        this.topologyId = topologyId;\n        this.address = address;\n    }\n}\nexports.ServerClosedEvent = ServerClosedEvent;\n/**\n * Emitted when topology description changes.\n * @public\n * @category Event\n */\nclass TopologyDescriptionChangedEvent {\n    /** @internal */\n    constructor(topologyId, previousDescription, newDescription) {\n        this.topologyId = topologyId;\n        this.previousDescription = previousDescription;\n        this.newDescription = newDescription;\n    }\n}\nexports.TopologyDescriptionChangedEvent = TopologyDescriptionChangedEvent;\n/**\n * Emitted when topology is initialized.\n * @public\n * @category Event\n */\nclass TopologyOpeningEvent {\n    /** @internal */\n    constructor(topologyId) {\n        this.topologyId = topologyId;\n    }\n}\nexports.TopologyOpeningEvent = TopologyOpeningEvent;\n/**\n * Emitted when topology is closed.\n * @public\n * @category Event\n */\nclass TopologyClosedEvent {\n    /** @internal */\n    constructor(topologyId) {\n        this.topologyId = topologyId;\n    }\n}\nexports.TopologyClosedEvent = TopologyClosedEvent;\n/**\n * Emitted when the server monitor’s hello command is started - immediately before\n * the hello command is serialized into raw BSON and written to the socket.\n *\n * @public\n * @category Event\n */\nclass ServerHeartbeatStartedEvent {\n    /** @internal */\n    constructor(connectionId) {\n        this.connectionId = connectionId;\n    }\n}\nexports.ServerHeartbeatStartedEvent = ServerHeartbeatStartedEvent;\n/**\n * Emitted when the server monitor’s hello succeeds.\n * @public\n * @category Event\n */\nclass ServerHeartbeatSucceededEvent {\n    /** @internal */\n    constructor(connectionId, duration, reply) {\n        this.connectionId = connectionId;\n        this.duration = duration;\n        this.reply = reply ?? {};\n    }\n}\nexports.ServerHeartbeatSucceededEvent = ServerHeartbeatSucceededEvent;\n/**\n * Emitted when the server monitor’s hello fails, either with an “ok: 0” or a socket exception.\n * @public\n * @category Event\n */\nclass ServerHeartbeatFailedEvent {\n    /** @internal */\n    constructor(connectionId, duration, failure) {\n        this.connectionId = connectionId;\n        this.duration = duration;\n        this.failure = failure;\n    }\n}\nexports.ServerHeartbeatFailedEvent = ServerHeartbeatFailedEvent;\n//# sourceMappingURL=events.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9zZGFtL2V2ZW50cy5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxrQ0FBa0MsR0FBRyxxQ0FBcUMsR0FBRyxtQ0FBbUMsR0FBRywyQkFBMkIsR0FBRyw0QkFBNEIsR0FBRyx1Q0FBdUMsR0FBRyx5QkFBeUIsR0FBRywwQkFBMEIsR0FBRyxxQ0FBcUM7QUFDeFQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFDQUFxQztBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEI7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUNBQXVDO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEI7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQjtBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1DQUFtQztBQUNuQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFDQUFxQztBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQztBQUNsQyIsInNvdXJjZXMiOlsiRDpcXHNhbG9uaVxcYXBwcmFpc2FsLXN5c3RlbVxcc2VydmVyXFxub2RlX21vZHVsZXNcXG1vbmdvZGJcXGxpYlxcc2RhbVxcZXZlbnRzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5TZXJ2ZXJIZWFydGJlYXRGYWlsZWRFdmVudCA9IGV4cG9ydHMuU2VydmVySGVhcnRiZWF0U3VjY2VlZGVkRXZlbnQgPSBleHBvcnRzLlNlcnZlckhlYXJ0YmVhdFN0YXJ0ZWRFdmVudCA9IGV4cG9ydHMuVG9wb2xvZ3lDbG9zZWRFdmVudCA9IGV4cG9ydHMuVG9wb2xvZ3lPcGVuaW5nRXZlbnQgPSBleHBvcnRzLlRvcG9sb2d5RGVzY3JpcHRpb25DaGFuZ2VkRXZlbnQgPSBleHBvcnRzLlNlcnZlckNsb3NlZEV2ZW50ID0gZXhwb3J0cy5TZXJ2ZXJPcGVuaW5nRXZlbnQgPSBleHBvcnRzLlNlcnZlckRlc2NyaXB0aW9uQ2hhbmdlZEV2ZW50ID0gdm9pZCAwO1xuLyoqXG4gKiBFbWl0dGVkIHdoZW4gc2VydmVyIGRlc2NyaXB0aW9uIGNoYW5nZXMsIGJ1dCBkb2VzIE5PVCBpbmNsdWRlIGNoYW5nZXMgdG8gdGhlIFJUVC5cbiAqIEBwdWJsaWNcbiAqIEBjYXRlZ29yeSBFdmVudFxuICovXG5jbGFzcyBTZXJ2ZXJEZXNjcmlwdGlvbkNoYW5nZWRFdmVudCB7XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGNvbnN0cnVjdG9yKHRvcG9sb2d5SWQsIGFkZHJlc3MsIHByZXZpb3VzRGVzY3JpcHRpb24sIG5ld0Rlc2NyaXB0aW9uKSB7XG4gICAgICAgIHRoaXMudG9wb2xvZ3lJZCA9IHRvcG9sb2d5SWQ7XG4gICAgICAgIHRoaXMuYWRkcmVzcyA9IGFkZHJlc3M7XG4gICAgICAgIHRoaXMucHJldmlvdXNEZXNjcmlwdGlvbiA9IHByZXZpb3VzRGVzY3JpcHRpb247XG4gICAgICAgIHRoaXMubmV3RGVzY3JpcHRpb24gPSBuZXdEZXNjcmlwdGlvbjtcbiAgICB9XG59XG5leHBvcnRzLlNlcnZlckRlc2NyaXB0aW9uQ2hhbmdlZEV2ZW50ID0gU2VydmVyRGVzY3JpcHRpb25DaGFuZ2VkRXZlbnQ7XG4vKipcbiAqIEVtaXR0ZWQgd2hlbiBzZXJ2ZXIgaXMgaW5pdGlhbGl6ZWQuXG4gKiBAcHVibGljXG4gKiBAY2F0ZWdvcnkgRXZlbnRcbiAqL1xuY2xhc3MgU2VydmVyT3BlbmluZ0V2ZW50IHtcbiAgICAvKiogQGludGVybmFsICovXG4gICAgY29uc3RydWN0b3IodG9wb2xvZ3lJZCwgYWRkcmVzcykge1xuICAgICAgICB0aGlzLnRvcG9sb2d5SWQgPSB0b3BvbG9neUlkO1xuICAgICAgICB0aGlzLmFkZHJlc3MgPSBhZGRyZXNzO1xuICAgIH1cbn1cbmV4cG9ydHMuU2VydmVyT3BlbmluZ0V2ZW50ID0gU2VydmVyT3BlbmluZ0V2ZW50O1xuLyoqXG4gKiBFbWl0dGVkIHdoZW4gc2VydmVyIGlzIGNsb3NlZC5cbiAqIEBwdWJsaWNcbiAqIEBjYXRlZ29yeSBFdmVudFxuICovXG5jbGFzcyBTZXJ2ZXJDbG9zZWRFdmVudCB7XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGNvbnN0cnVjdG9yKHRvcG9sb2d5SWQsIGFkZHJlc3MpIHtcbiAgICAgICAgdGhpcy50b3BvbG9neUlkID0gdG9wb2xvZ3lJZDtcbiAgICAgICAgdGhpcy5hZGRyZXNzID0gYWRkcmVzcztcbiAgICB9XG59XG5leHBvcnRzLlNlcnZlckNsb3NlZEV2ZW50ID0gU2VydmVyQ2xvc2VkRXZlbnQ7XG4vKipcbiAqIEVtaXR0ZWQgd2hlbiB0b3BvbG9neSBkZXNjcmlwdGlvbiBjaGFuZ2VzLlxuICogQHB1YmxpY1xuICogQGNhdGVnb3J5IEV2ZW50XG4gKi9cbmNsYXNzIFRvcG9sb2d5RGVzY3JpcHRpb25DaGFuZ2VkRXZlbnQge1xuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBjb25zdHJ1Y3Rvcih0b3BvbG9neUlkLCBwcmV2aW91c0Rlc2NyaXB0aW9uLCBuZXdEZXNjcmlwdGlvbikge1xuICAgICAgICB0aGlzLnRvcG9sb2d5SWQgPSB0b3BvbG9neUlkO1xuICAgICAgICB0aGlzLnByZXZpb3VzRGVzY3JpcHRpb24gPSBwcmV2aW91c0Rlc2NyaXB0aW9uO1xuICAgICAgICB0aGlzLm5ld0Rlc2NyaXB0aW9uID0gbmV3RGVzY3JpcHRpb247XG4gICAgfVxufVxuZXhwb3J0cy5Ub3BvbG9neURlc2NyaXB0aW9uQ2hhbmdlZEV2ZW50ID0gVG9wb2xvZ3lEZXNjcmlwdGlvbkNoYW5nZWRFdmVudDtcbi8qKlxuICogRW1pdHRlZCB3aGVuIHRvcG9sb2d5IGlzIGluaXRpYWxpemVkLlxuICogQHB1YmxpY1xuICogQGNhdGVnb3J5IEV2ZW50XG4gKi9cbmNsYXNzIFRvcG9sb2d5T3BlbmluZ0V2ZW50IHtcbiAgICAvKiogQGludGVybmFsICovXG4gICAgY29uc3RydWN0b3IodG9wb2xvZ3lJZCkge1xuICAgICAgICB0aGlzLnRvcG9sb2d5SWQgPSB0b3BvbG9neUlkO1xuICAgIH1cbn1cbmV4cG9ydHMuVG9wb2xvZ3lPcGVuaW5nRXZlbnQgPSBUb3BvbG9neU9wZW5pbmdFdmVudDtcbi8qKlxuICogRW1pdHRlZCB3aGVuIHRvcG9sb2d5IGlzIGNsb3NlZC5cbiAqIEBwdWJsaWNcbiAqIEBjYXRlZ29yeSBFdmVudFxuICovXG5jbGFzcyBUb3BvbG9neUNsb3NlZEV2ZW50IHtcbiAgICAvKiogQGludGVybmFsICovXG4gICAgY29uc3RydWN0b3IodG9wb2xvZ3lJZCkge1xuICAgICAgICB0aGlzLnRvcG9sb2d5SWQgPSB0b3BvbG9neUlkO1xuICAgIH1cbn1cbmV4cG9ydHMuVG9wb2xvZ3lDbG9zZWRFdmVudCA9IFRvcG9sb2d5Q2xvc2VkRXZlbnQ7XG4vKipcbiAqIEVtaXR0ZWQgd2hlbiB0aGUgc2VydmVyIG1vbml0b3LigJlzIGhlbGxvIGNvbW1hbmQgaXMgc3RhcnRlZCAtIGltbWVkaWF0ZWx5IGJlZm9yZVxuICogdGhlIGhlbGxvIGNvbW1hbmQgaXMgc2VyaWFsaXplZCBpbnRvIHJhdyBCU09OIGFuZCB3cml0dGVuIHRvIHRoZSBzb2NrZXQuXG4gKlxuICogQHB1YmxpY1xuICogQGNhdGVnb3J5IEV2ZW50XG4gKi9cbmNsYXNzIFNlcnZlckhlYXJ0YmVhdFN0YXJ0ZWRFdmVudCB7XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGNvbnN0cnVjdG9yKGNvbm5lY3Rpb25JZCkge1xuICAgICAgICB0aGlzLmNvbm5lY3Rpb25JZCA9IGNvbm5lY3Rpb25JZDtcbiAgICB9XG59XG5leHBvcnRzLlNlcnZlckhlYXJ0YmVhdFN0YXJ0ZWRFdmVudCA9IFNlcnZlckhlYXJ0YmVhdFN0YXJ0ZWRFdmVudDtcbi8qKlxuICogRW1pdHRlZCB3aGVuIHRoZSBzZXJ2ZXIgbW9uaXRvcuKAmXMgaGVsbG8gc3VjY2VlZHMuXG4gKiBAcHVibGljXG4gKiBAY2F0ZWdvcnkgRXZlbnRcbiAqL1xuY2xhc3MgU2VydmVySGVhcnRiZWF0U3VjY2VlZGVkRXZlbnQge1xuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBjb25zdHJ1Y3Rvcihjb25uZWN0aW9uSWQsIGR1cmF0aW9uLCByZXBseSkge1xuICAgICAgICB0aGlzLmNvbm5lY3Rpb25JZCA9IGNvbm5lY3Rpb25JZDtcbiAgICAgICAgdGhpcy5kdXJhdGlvbiA9IGR1cmF0aW9uO1xuICAgICAgICB0aGlzLnJlcGx5ID0gcmVwbHkgPz8ge307XG4gICAgfVxufVxuZXhwb3J0cy5TZXJ2ZXJIZWFydGJlYXRTdWNjZWVkZWRFdmVudCA9IFNlcnZlckhlYXJ0YmVhdFN1Y2NlZWRlZEV2ZW50O1xuLyoqXG4gKiBFbWl0dGVkIHdoZW4gdGhlIHNlcnZlciBtb25pdG9y4oCZcyBoZWxsbyBmYWlscywgZWl0aGVyIHdpdGggYW4g4oCcb2s6IDDigJ0gb3IgYSBzb2NrZXQgZXhjZXB0aW9uLlxuICogQHB1YmxpY1xuICogQGNhdGVnb3J5IEV2ZW50XG4gKi9cbmNsYXNzIFNlcnZlckhlYXJ0YmVhdEZhaWxlZEV2ZW50IHtcbiAgICAvKiogQGludGVybmFsICovXG4gICAgY29uc3RydWN0b3IoY29ubmVjdGlvbklkLCBkdXJhdGlvbiwgZmFpbHVyZSkge1xuICAgICAgICB0aGlzLmNvbm5lY3Rpb25JZCA9IGNvbm5lY3Rpb25JZDtcbiAgICAgICAgdGhpcy5kdXJhdGlvbiA9IGR1cmF0aW9uO1xuICAgICAgICB0aGlzLmZhaWx1cmUgPSBmYWlsdXJlO1xuICAgIH1cbn1cbmV4cG9ydHMuU2VydmVySGVhcnRiZWF0RmFpbGVkRXZlbnQgPSBTZXJ2ZXJIZWFydGJlYXRGYWlsZWRFdmVudDtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWV2ZW50cy5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/sdam/events.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/sdam/monitor.js":
/*!**********************************************************!*\
  !*** ../server/node_modules/mongodb/lib/sdam/monitor.js ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.MonitorInterval = exports.RTTPinger = exports.Monitor = void 0;\nconst timers_1 = __webpack_require__(/*! timers */ \"timers\");\nconst bson_1 = __webpack_require__(/*! ../bson */ \"(api)/../server/node_modules/mongodb/lib/bson.js\");\nconst connect_1 = __webpack_require__(/*! ../cmap/connect */ \"(api)/../server/node_modules/mongodb/lib/cmap/connect.js\");\nconst connection_1 = __webpack_require__(/*! ../cmap/connection */ \"(api)/../server/node_modules/mongodb/lib/cmap/connection.js\");\nconst constants_1 = __webpack_require__(/*! ../constants */ \"(api)/../server/node_modules/mongodb/lib/constants.js\");\nconst error_1 = __webpack_require__(/*! ../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst mongo_types_1 = __webpack_require__(/*! ../mongo_types */ \"(api)/../server/node_modules/mongodb/lib/mongo_types.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\nconst common_1 = __webpack_require__(/*! ./common */ \"(api)/../server/node_modules/mongodb/lib/sdam/common.js\");\nconst events_1 = __webpack_require__(/*! ./events */ \"(api)/../server/node_modules/mongodb/lib/sdam/events.js\");\nconst server_1 = __webpack_require__(/*! ./server */ \"(api)/../server/node_modules/mongodb/lib/sdam/server.js\");\n/** @internal */\nconst kServer = Symbol('server');\n/** @internal */\nconst kMonitorId = Symbol('monitorId');\n/** @internal */\nconst kConnection = Symbol('connection');\n/** @internal */\nconst kCancellationToken = Symbol('cancellationToken');\n/** @internal */\nconst kRoundTripTime = Symbol('roundTripTime');\nconst STATE_IDLE = 'idle';\nconst STATE_MONITORING = 'monitoring';\nconst stateTransition = (0, utils_1.makeStateMachine)({\n    [common_1.STATE_CLOSING]: [common_1.STATE_CLOSING, STATE_IDLE, common_1.STATE_CLOSED],\n    [common_1.STATE_CLOSED]: [common_1.STATE_CLOSED, STATE_MONITORING],\n    [STATE_IDLE]: [STATE_IDLE, STATE_MONITORING, common_1.STATE_CLOSING],\n    [STATE_MONITORING]: [STATE_MONITORING, STATE_IDLE, common_1.STATE_CLOSING]\n});\nconst INVALID_REQUEST_CHECK_STATES = new Set([common_1.STATE_CLOSING, common_1.STATE_CLOSED, STATE_MONITORING]);\nfunction isInCloseState(monitor) {\n    return monitor.s.state === common_1.STATE_CLOSED || monitor.s.state === common_1.STATE_CLOSING;\n}\n/** @internal */\nclass Monitor extends mongo_types_1.TypedEventEmitter {\n    get connection() {\n        return this[kConnection];\n    }\n    constructor(server, options) {\n        super();\n        this[kServer] = server;\n        this[kConnection] = undefined;\n        this[kCancellationToken] = new mongo_types_1.CancellationToken();\n        this[kCancellationToken].setMaxListeners(Infinity);\n        this[kMonitorId] = undefined;\n        this.s = {\n            state: common_1.STATE_CLOSED\n        };\n        this.address = server.description.address;\n        this.options = Object.freeze({\n            connectTimeoutMS: options.connectTimeoutMS ?? 10000,\n            heartbeatFrequencyMS: options.heartbeatFrequencyMS ?? 10000,\n            minHeartbeatFrequencyMS: options.minHeartbeatFrequencyMS ?? 500\n        });\n        const cancellationToken = this[kCancellationToken];\n        // TODO: refactor this to pull it directly from the pool, requires new ConnectionPool integration\n        const connectOptions = Object.assign({\n            id: '<monitor>',\n            generation: server.pool.generation,\n            connectionType: connection_1.Connection,\n            cancellationToken,\n            hostAddress: server.description.hostAddress\n        }, options, \n        // force BSON serialization options\n        {\n            raw: false,\n            useBigInt64: false,\n            promoteLongs: true,\n            promoteValues: true,\n            promoteBuffers: true\n        });\n        // ensure no authentication is used for monitoring\n        delete connectOptions.credentials;\n        if (connectOptions.autoEncrypter) {\n            delete connectOptions.autoEncrypter;\n        }\n        this.connectOptions = Object.freeze(connectOptions);\n    }\n    connect() {\n        if (this.s.state !== common_1.STATE_CLOSED) {\n            return;\n        }\n        // start\n        const heartbeatFrequencyMS = this.options.heartbeatFrequencyMS;\n        const minHeartbeatFrequencyMS = this.options.minHeartbeatFrequencyMS;\n        this[kMonitorId] = new MonitorInterval(monitorServer(this), {\n            heartbeatFrequencyMS: heartbeatFrequencyMS,\n            minHeartbeatFrequencyMS: minHeartbeatFrequencyMS,\n            immediate: true\n        });\n    }\n    requestCheck() {\n        if (INVALID_REQUEST_CHECK_STATES.has(this.s.state)) {\n            return;\n        }\n        this[kMonitorId]?.wake();\n    }\n    reset() {\n        const topologyVersion = this[kServer].description.topologyVersion;\n        if (isInCloseState(this) || topologyVersion == null) {\n            return;\n        }\n        stateTransition(this, common_1.STATE_CLOSING);\n        resetMonitorState(this);\n        // restart monitor\n        stateTransition(this, STATE_IDLE);\n        // restart monitoring\n        const heartbeatFrequencyMS = this.options.heartbeatFrequencyMS;\n        const minHeartbeatFrequencyMS = this.options.minHeartbeatFrequencyMS;\n        this[kMonitorId] = new MonitorInterval(monitorServer(this), {\n            heartbeatFrequencyMS: heartbeatFrequencyMS,\n            minHeartbeatFrequencyMS: minHeartbeatFrequencyMS\n        });\n    }\n    close() {\n        if (isInCloseState(this)) {\n            return;\n        }\n        stateTransition(this, common_1.STATE_CLOSING);\n        resetMonitorState(this);\n        // close monitor\n        this.emit('close');\n        stateTransition(this, common_1.STATE_CLOSED);\n    }\n}\nexports.Monitor = Monitor;\nfunction resetMonitorState(monitor) {\n    monitor[kMonitorId]?.stop();\n    monitor[kMonitorId] = undefined;\n    monitor.rttPinger?.close();\n    monitor.rttPinger = undefined;\n    monitor[kCancellationToken].emit('cancel');\n    monitor[kConnection]?.destroy({ force: true });\n    monitor[kConnection] = undefined;\n}\nfunction checkServer(monitor, callback) {\n    let start = (0, utils_1.now)();\n    monitor.emit(server_1.Server.SERVER_HEARTBEAT_STARTED, new events_1.ServerHeartbeatStartedEvent(monitor.address));\n    function failureHandler(err) {\n        monitor[kConnection]?.destroy({ force: true });\n        monitor[kConnection] = undefined;\n        monitor.emit(server_1.Server.SERVER_HEARTBEAT_FAILED, new events_1.ServerHeartbeatFailedEvent(monitor.address, (0, utils_1.calculateDurationInMs)(start), err));\n        const error = !(err instanceof error_1.MongoError) ? new error_1.MongoError(err) : err;\n        error.addErrorLabel(error_1.MongoErrorLabel.ResetPool);\n        if (error instanceof error_1.MongoNetworkTimeoutError) {\n            error.addErrorLabel(error_1.MongoErrorLabel.InterruptInUseConnections);\n        }\n        monitor.emit('resetServer', error);\n        callback(err);\n    }\n    const connection = monitor[kConnection];\n    if (connection && !connection.closed) {\n        const { serverApi, helloOk } = connection;\n        const connectTimeoutMS = monitor.options.connectTimeoutMS;\n        const maxAwaitTimeMS = monitor.options.heartbeatFrequencyMS;\n        const topologyVersion = monitor[kServer].description.topologyVersion;\n        const isAwaitable = topologyVersion != null;\n        const cmd = {\n            [serverApi?.version || helloOk ? 'hello' : constants_1.LEGACY_HELLO_COMMAND]: 1,\n            ...(isAwaitable && topologyVersion\n                ? { maxAwaitTimeMS, topologyVersion: makeTopologyVersion(topologyVersion) }\n                : {})\n        };\n        const options = isAwaitable\n            ? {\n                socketTimeoutMS: connectTimeoutMS ? connectTimeoutMS + maxAwaitTimeMS : 0,\n                exhaustAllowed: true\n            }\n            : { socketTimeoutMS: connectTimeoutMS };\n        if (isAwaitable && monitor.rttPinger == null) {\n            monitor.rttPinger = new RTTPinger(monitor[kCancellationToken], Object.assign({ heartbeatFrequencyMS: monitor.options.heartbeatFrequencyMS }, monitor.connectOptions));\n        }\n        connection.command((0, utils_1.ns)('admin.$cmd'), cmd, options, (err, hello) => {\n            if (err) {\n                return failureHandler(err);\n            }\n            if (!('isWritablePrimary' in hello)) {\n                // Provide hello-style response document.\n                hello.isWritablePrimary = hello[constants_1.LEGACY_HELLO_COMMAND];\n            }\n            const duration = isAwaitable && monitor.rttPinger\n                ? monitor.rttPinger.roundTripTime\n                : (0, utils_1.calculateDurationInMs)(start);\n            monitor.emit(server_1.Server.SERVER_HEARTBEAT_SUCCEEDED, new events_1.ServerHeartbeatSucceededEvent(monitor.address, duration, hello));\n            // if we are using the streaming protocol then we immediately issue another `started`\n            // event, otherwise the \"check\" is complete and return to the main monitor loop\n            if (isAwaitable && hello.topologyVersion) {\n                monitor.emit(server_1.Server.SERVER_HEARTBEAT_STARTED, new events_1.ServerHeartbeatStartedEvent(monitor.address));\n                start = (0, utils_1.now)();\n            }\n            else {\n                monitor.rttPinger?.close();\n                monitor.rttPinger = undefined;\n                callback(undefined, hello);\n            }\n        });\n        return;\n    }\n    // connecting does an implicit `hello`\n    (0, connect_1.connect)(monitor.connectOptions, (err, conn) => {\n        if (err) {\n            monitor[kConnection] = undefined;\n            failureHandler(err);\n            return;\n        }\n        if (conn) {\n            // Tell the connection that we are using the streaming protocol so that the\n            // connection's message stream will only read the last hello on the buffer.\n            conn.isMonitoringConnection = true;\n            if (isInCloseState(monitor)) {\n                conn.destroy({ force: true });\n                return;\n            }\n            monitor[kConnection] = conn;\n            monitor.emit(server_1.Server.SERVER_HEARTBEAT_SUCCEEDED, new events_1.ServerHeartbeatSucceededEvent(monitor.address, (0, utils_1.calculateDurationInMs)(start), conn.hello));\n            callback(undefined, conn.hello);\n        }\n    });\n}\nfunction monitorServer(monitor) {\n    return (callback) => {\n        if (monitor.s.state === STATE_MONITORING) {\n            process.nextTick(callback);\n            return;\n        }\n        stateTransition(monitor, STATE_MONITORING);\n        function done() {\n            if (!isInCloseState(monitor)) {\n                stateTransition(monitor, STATE_IDLE);\n            }\n            callback();\n        }\n        checkServer(monitor, (err, hello) => {\n            if (err) {\n                // otherwise an error occurred on initial discovery, also bail\n                if (monitor[kServer].description.type === common_1.ServerType.Unknown) {\n                    return done();\n                }\n            }\n            // if the check indicates streaming is supported, immediately reschedule monitoring\n            if (hello && hello.topologyVersion) {\n                (0, timers_1.setTimeout)(() => {\n                    if (!isInCloseState(monitor)) {\n                        monitor[kMonitorId]?.wake();\n                    }\n                }, 0);\n            }\n            done();\n        });\n    };\n}\nfunction makeTopologyVersion(tv) {\n    return {\n        processId: tv.processId,\n        // tests mock counter as just number, but in a real situation counter should always be a Long\n        // TODO(NODE-2674): Preserve int64 sent from MongoDB\n        counter: bson_1.Long.isLong(tv.counter) ? tv.counter : bson_1.Long.fromNumber(tv.counter)\n    };\n}\n/** @internal */\nclass RTTPinger {\n    constructor(cancellationToken, options) {\n        this.connection = undefined;\n        this[kCancellationToken] = cancellationToken;\n        this[kRoundTripTime] = 0;\n        this.closed = false;\n        const heartbeatFrequencyMS = options.heartbeatFrequencyMS;\n        this[kMonitorId] = (0, timers_1.setTimeout)(() => measureRoundTripTime(this, options), heartbeatFrequencyMS);\n    }\n    get roundTripTime() {\n        return this[kRoundTripTime];\n    }\n    close() {\n        this.closed = true;\n        (0, timers_1.clearTimeout)(this[kMonitorId]);\n        this.connection?.destroy({ force: true });\n        this.connection = undefined;\n    }\n}\nexports.RTTPinger = RTTPinger;\nfunction measureRoundTripTime(rttPinger, options) {\n    const start = (0, utils_1.now)();\n    options.cancellationToken = rttPinger[kCancellationToken];\n    const heartbeatFrequencyMS = options.heartbeatFrequencyMS;\n    if (rttPinger.closed) {\n        return;\n    }\n    function measureAndReschedule(conn) {\n        if (rttPinger.closed) {\n            conn?.destroy({ force: true });\n            return;\n        }\n        if (rttPinger.connection == null) {\n            rttPinger.connection = conn;\n        }\n        rttPinger[kRoundTripTime] = (0, utils_1.calculateDurationInMs)(start);\n        rttPinger[kMonitorId] = (0, timers_1.setTimeout)(() => measureRoundTripTime(rttPinger, options), heartbeatFrequencyMS);\n    }\n    const connection = rttPinger.connection;\n    if (connection == null) {\n        (0, connect_1.connect)(options, (err, conn) => {\n            if (err) {\n                rttPinger.connection = undefined;\n                rttPinger[kRoundTripTime] = 0;\n                return;\n            }\n            measureAndReschedule(conn);\n        });\n        return;\n    }\n    const commandName = connection.serverApi?.version || connection.helloOk ? 'hello' : constants_1.LEGACY_HELLO_COMMAND;\n    connection.commandAsync((0, utils_1.ns)('admin.$cmd'), { [commandName]: 1 }, undefined).then(() => measureAndReschedule(), () => {\n        rttPinger.connection?.destroy({ force: true });\n        rttPinger.connection = undefined;\n        rttPinger[kRoundTripTime] = 0;\n    });\n}\n/**\n * @internal\n */\nclass MonitorInterval {\n    constructor(fn, options = {}) {\n        this.isExpeditedCallToFnScheduled = false;\n        this.stopped = false;\n        this.isExecutionInProgress = false;\n        this.hasExecutedOnce = false;\n        this._executeAndReschedule = () => {\n            if (this.stopped)\n                return;\n            if (this.timerId) {\n                (0, timers_1.clearTimeout)(this.timerId);\n            }\n            this.isExpeditedCallToFnScheduled = false;\n            this.isExecutionInProgress = true;\n            this.fn(() => {\n                this.lastExecutionEnded = (0, utils_1.now)();\n                this.isExecutionInProgress = false;\n                this._reschedule(this.heartbeatFrequencyMS);\n            });\n        };\n        this.fn = fn;\n        this.lastExecutionEnded = -Infinity;\n        this.heartbeatFrequencyMS = options.heartbeatFrequencyMS ?? 1000;\n        this.minHeartbeatFrequencyMS = options.minHeartbeatFrequencyMS ?? 500;\n        if (options.immediate) {\n            this._executeAndReschedule();\n        }\n        else {\n            this._reschedule(undefined);\n        }\n    }\n    wake() {\n        const currentTime = (0, utils_1.now)();\n        const timeSinceLastCall = currentTime - this.lastExecutionEnded;\n        // TODO(NODE-4674): Add error handling and logging to the monitor\n        if (timeSinceLastCall < 0) {\n            return this._executeAndReschedule();\n        }\n        if (this.isExecutionInProgress) {\n            return;\n        }\n        // debounce multiple calls to wake within the `minInterval`\n        if (this.isExpeditedCallToFnScheduled) {\n            return;\n        }\n        // reschedule a call as soon as possible, ensuring the call never happens\n        // faster than the `minInterval`\n        if (timeSinceLastCall < this.minHeartbeatFrequencyMS) {\n            this.isExpeditedCallToFnScheduled = true;\n            this._reschedule(this.minHeartbeatFrequencyMS - timeSinceLastCall);\n            return;\n        }\n        this._executeAndReschedule();\n    }\n    stop() {\n        this.stopped = true;\n        if (this.timerId) {\n            (0, timers_1.clearTimeout)(this.timerId);\n            this.timerId = undefined;\n        }\n        this.lastExecutionEnded = -Infinity;\n        this.isExpeditedCallToFnScheduled = false;\n    }\n    toString() {\n        return JSON.stringify(this);\n    }\n    toJSON() {\n        const currentTime = (0, utils_1.now)();\n        const timeSinceLastCall = currentTime - this.lastExecutionEnded;\n        return {\n            timerId: this.timerId != null ? 'set' : 'cleared',\n            lastCallTime: this.lastExecutionEnded,\n            isExpeditedCheckScheduled: this.isExpeditedCallToFnScheduled,\n            stopped: this.stopped,\n            heartbeatFrequencyMS: this.heartbeatFrequencyMS,\n            minHeartbeatFrequencyMS: this.minHeartbeatFrequencyMS,\n            currentTime,\n            timeSinceLastCall\n        };\n    }\n    _reschedule(ms) {\n        if (this.stopped)\n            return;\n        if (this.timerId) {\n            (0, timers_1.clearTimeout)(this.timerId);\n        }\n        this.timerId = (0, timers_1.setTimeout)(this._executeAndReschedule, ms || this.heartbeatFrequencyMS);\n    }\n}\nexports.MonitorInterval = MonitorInterval;\n//# sourceMappingURL=monitor.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9zZGFtL21vbml0b3IuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsdUJBQXVCLEdBQUcsaUJBQWlCLEdBQUcsZUFBZTtBQUM3RCxpQkFBaUIsbUJBQU8sQ0FBQyxzQkFBUTtBQUNqQyxlQUFlLG1CQUFPLENBQUMsaUVBQVM7QUFDaEMsa0JBQWtCLG1CQUFPLENBQUMsaUZBQWlCO0FBQzNDLHFCQUFxQixtQkFBTyxDQUFDLHVGQUFvQjtBQUNqRCxvQkFBb0IsbUJBQU8sQ0FBQywyRUFBYztBQUMxQyxnQkFBZ0IsbUJBQU8sQ0FBQyxtRUFBVTtBQUNsQyxzQkFBc0IsbUJBQU8sQ0FBQywrRUFBZ0I7QUFDOUMsZ0JBQWdCLG1CQUFPLENBQUMsbUVBQVU7QUFDbEMsaUJBQWlCLG1CQUFPLENBQUMseUVBQVU7QUFDbkMsaUJBQWlCLG1CQUFPLENBQUMseUVBQVU7QUFDbkMsaUJBQWlCLG1CQUFPLENBQUMseUVBQVU7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZTtBQUNmO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9DQUFvQyxhQUFhO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdDQUF3QyxhQUFhO0FBQ3JEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixxQkFBcUI7QUFDckM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0I7QUFDcEIsb0JBQW9CO0FBQ3BCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQjtBQUNoQjtBQUNBLDJGQUEyRiw0REFBNEQ7QUFDdko7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsYUFBYTtBQUM1QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1DQUFtQyxhQUFhO0FBQ2hEO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsYUFBYTtBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLDZEQUE2RCxrQkFBa0I7QUFDL0Usd0NBQXdDLGFBQWE7QUFDckQ7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCO0FBQ3ZCIiwic291cmNlcyI6WyJEOlxcc2Fsb25pXFxhcHByYWlzYWwtc3lzdGVtXFxzZXJ2ZXJcXG5vZGVfbW9kdWxlc1xcbW9uZ29kYlxcbGliXFxzZGFtXFxtb25pdG9yLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5Nb25pdG9ySW50ZXJ2YWwgPSBleHBvcnRzLlJUVFBpbmdlciA9IGV4cG9ydHMuTW9uaXRvciA9IHZvaWQgMDtcbmNvbnN0IHRpbWVyc18xID0gcmVxdWlyZShcInRpbWVyc1wiKTtcbmNvbnN0IGJzb25fMSA9IHJlcXVpcmUoXCIuLi9ic29uXCIpO1xuY29uc3QgY29ubmVjdF8xID0gcmVxdWlyZShcIi4uL2NtYXAvY29ubmVjdFwiKTtcbmNvbnN0IGNvbm5lY3Rpb25fMSA9IHJlcXVpcmUoXCIuLi9jbWFwL2Nvbm5lY3Rpb25cIik7XG5jb25zdCBjb25zdGFudHNfMSA9IHJlcXVpcmUoXCIuLi9jb25zdGFudHNcIik7XG5jb25zdCBlcnJvcl8xID0gcmVxdWlyZShcIi4uL2Vycm9yXCIpO1xuY29uc3QgbW9uZ29fdHlwZXNfMSA9IHJlcXVpcmUoXCIuLi9tb25nb190eXBlc1wiKTtcbmNvbnN0IHV0aWxzXzEgPSByZXF1aXJlKFwiLi4vdXRpbHNcIik7XG5jb25zdCBjb21tb25fMSA9IHJlcXVpcmUoXCIuL2NvbW1vblwiKTtcbmNvbnN0IGV2ZW50c18xID0gcmVxdWlyZShcIi4vZXZlbnRzXCIpO1xuY29uc3Qgc2VydmVyXzEgPSByZXF1aXJlKFwiLi9zZXJ2ZXJcIik7XG4vKiogQGludGVybmFsICovXG5jb25zdCBrU2VydmVyID0gU3ltYm9sKCdzZXJ2ZXInKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNvbnN0IGtNb25pdG9ySWQgPSBTeW1ib2woJ21vbml0b3JJZCcpO1xuLyoqIEBpbnRlcm5hbCAqL1xuY29uc3Qga0Nvbm5lY3Rpb24gPSBTeW1ib2woJ2Nvbm5lY3Rpb24nKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNvbnN0IGtDYW5jZWxsYXRpb25Ub2tlbiA9IFN5bWJvbCgnY2FuY2VsbGF0aW9uVG9rZW4nKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNvbnN0IGtSb3VuZFRyaXBUaW1lID0gU3ltYm9sKCdyb3VuZFRyaXBUaW1lJyk7XG5jb25zdCBTVEFURV9JRExFID0gJ2lkbGUnO1xuY29uc3QgU1RBVEVfTU9OSVRPUklORyA9ICdtb25pdG9yaW5nJztcbmNvbnN0IHN0YXRlVHJhbnNpdGlvbiA9ICgwLCB1dGlsc18xLm1ha2VTdGF0ZU1hY2hpbmUpKHtcbiAgICBbY29tbW9uXzEuU1RBVEVfQ0xPU0lOR106IFtjb21tb25fMS5TVEFURV9DTE9TSU5HLCBTVEFURV9JRExFLCBjb21tb25fMS5TVEFURV9DTE9TRURdLFxuICAgIFtjb21tb25fMS5TVEFURV9DTE9TRURdOiBbY29tbW9uXzEuU1RBVEVfQ0xPU0VELCBTVEFURV9NT05JVE9SSU5HXSxcbiAgICBbU1RBVEVfSURMRV06IFtTVEFURV9JRExFLCBTVEFURV9NT05JVE9SSU5HLCBjb21tb25fMS5TVEFURV9DTE9TSU5HXSxcbiAgICBbU1RBVEVfTU9OSVRPUklOR106IFtTVEFURV9NT05JVE9SSU5HLCBTVEFURV9JRExFLCBjb21tb25fMS5TVEFURV9DTE9TSU5HXVxufSk7XG5jb25zdCBJTlZBTElEX1JFUVVFU1RfQ0hFQ0tfU1RBVEVTID0gbmV3IFNldChbY29tbW9uXzEuU1RBVEVfQ0xPU0lORywgY29tbW9uXzEuU1RBVEVfQ0xPU0VELCBTVEFURV9NT05JVE9SSU5HXSk7XG5mdW5jdGlvbiBpc0luQ2xvc2VTdGF0ZShtb25pdG9yKSB7XG4gICAgcmV0dXJuIG1vbml0b3Iucy5zdGF0ZSA9PT0gY29tbW9uXzEuU1RBVEVfQ0xPU0VEIHx8IG1vbml0b3Iucy5zdGF0ZSA9PT0gY29tbW9uXzEuU1RBVEVfQ0xPU0lORztcbn1cbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIE1vbml0b3IgZXh0ZW5kcyBtb25nb190eXBlc18xLlR5cGVkRXZlbnRFbWl0dGVyIHtcbiAgICBnZXQgY29ubmVjdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXNba0Nvbm5lY3Rpb25dO1xuICAgIH1cbiAgICBjb25zdHJ1Y3RvcihzZXJ2ZXIsIG9wdGlvbnMpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpc1trU2VydmVyXSA9IHNlcnZlcjtcbiAgICAgICAgdGhpc1trQ29ubmVjdGlvbl0gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXNba0NhbmNlbGxhdGlvblRva2VuXSA9IG5ldyBtb25nb190eXBlc18xLkNhbmNlbGxhdGlvblRva2VuKCk7XG4gICAgICAgIHRoaXNba0NhbmNlbGxhdGlvblRva2VuXS5zZXRNYXhMaXN0ZW5lcnMoSW5maW5pdHkpO1xuICAgICAgICB0aGlzW2tNb25pdG9ySWRdID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnMgPSB7XG4gICAgICAgICAgICBzdGF0ZTogY29tbW9uXzEuU1RBVEVfQ0xPU0VEXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuYWRkcmVzcyA9IHNlcnZlci5kZXNjcmlwdGlvbi5hZGRyZXNzO1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSBPYmplY3QuZnJlZXplKHtcbiAgICAgICAgICAgIGNvbm5lY3RUaW1lb3V0TVM6IG9wdGlvbnMuY29ubmVjdFRpbWVvdXRNUyA/PyAxMDAwMCxcbiAgICAgICAgICAgIGhlYXJ0YmVhdEZyZXF1ZW5jeU1TOiBvcHRpb25zLmhlYXJ0YmVhdEZyZXF1ZW5jeU1TID8/IDEwMDAwLFxuICAgICAgICAgICAgbWluSGVhcnRiZWF0RnJlcXVlbmN5TVM6IG9wdGlvbnMubWluSGVhcnRiZWF0RnJlcXVlbmN5TVMgPz8gNTAwXG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBjYW5jZWxsYXRpb25Ub2tlbiA9IHRoaXNba0NhbmNlbGxhdGlvblRva2VuXTtcbiAgICAgICAgLy8gVE9ETzogcmVmYWN0b3IgdGhpcyB0byBwdWxsIGl0IGRpcmVjdGx5IGZyb20gdGhlIHBvb2wsIHJlcXVpcmVzIG5ldyBDb25uZWN0aW9uUG9vbCBpbnRlZ3JhdGlvblxuICAgICAgICBjb25zdCBjb25uZWN0T3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oe1xuICAgICAgICAgICAgaWQ6ICc8bW9uaXRvcj4nLFxuICAgICAgICAgICAgZ2VuZXJhdGlvbjogc2VydmVyLnBvb2wuZ2VuZXJhdGlvbixcbiAgICAgICAgICAgIGNvbm5lY3Rpb25UeXBlOiBjb25uZWN0aW9uXzEuQ29ubmVjdGlvbixcbiAgICAgICAgICAgIGNhbmNlbGxhdGlvblRva2VuLFxuICAgICAgICAgICAgaG9zdEFkZHJlc3M6IHNlcnZlci5kZXNjcmlwdGlvbi5ob3N0QWRkcmVzc1xuICAgICAgICB9LCBvcHRpb25zLCBcbiAgICAgICAgLy8gZm9yY2UgQlNPTiBzZXJpYWxpemF0aW9uIG9wdGlvbnNcbiAgICAgICAge1xuICAgICAgICAgICAgcmF3OiBmYWxzZSxcbiAgICAgICAgICAgIHVzZUJpZ0ludDY0OiBmYWxzZSxcbiAgICAgICAgICAgIHByb21vdGVMb25nczogdHJ1ZSxcbiAgICAgICAgICAgIHByb21vdGVWYWx1ZXM6IHRydWUsXG4gICAgICAgICAgICBwcm9tb3RlQnVmZmVyczogdHJ1ZVxuICAgICAgICB9KTtcbiAgICAgICAgLy8gZW5zdXJlIG5vIGF1dGhlbnRpY2F0aW9uIGlzIHVzZWQgZm9yIG1vbml0b3JpbmdcbiAgICAgICAgZGVsZXRlIGNvbm5lY3RPcHRpb25zLmNyZWRlbnRpYWxzO1xuICAgICAgICBpZiAoY29ubmVjdE9wdGlvbnMuYXV0b0VuY3J5cHRlcikge1xuICAgICAgICAgICAgZGVsZXRlIGNvbm5lY3RPcHRpb25zLmF1dG9FbmNyeXB0ZXI7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jb25uZWN0T3B0aW9ucyA9IE9iamVjdC5mcmVlemUoY29ubmVjdE9wdGlvbnMpO1xuICAgIH1cbiAgICBjb25uZWN0KCkge1xuICAgICAgICBpZiAodGhpcy5zLnN0YXRlICE9PSBjb21tb25fMS5TVEFURV9DTE9TRUQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyBzdGFydFxuICAgICAgICBjb25zdCBoZWFydGJlYXRGcmVxdWVuY3lNUyA9IHRoaXMub3B0aW9ucy5oZWFydGJlYXRGcmVxdWVuY3lNUztcbiAgICAgICAgY29uc3QgbWluSGVhcnRiZWF0RnJlcXVlbmN5TVMgPSB0aGlzLm9wdGlvbnMubWluSGVhcnRiZWF0RnJlcXVlbmN5TVM7XG4gICAgICAgIHRoaXNba01vbml0b3JJZF0gPSBuZXcgTW9uaXRvckludGVydmFsKG1vbml0b3JTZXJ2ZXIodGhpcyksIHtcbiAgICAgICAgICAgIGhlYXJ0YmVhdEZyZXF1ZW5jeU1TOiBoZWFydGJlYXRGcmVxdWVuY3lNUyxcbiAgICAgICAgICAgIG1pbkhlYXJ0YmVhdEZyZXF1ZW5jeU1TOiBtaW5IZWFydGJlYXRGcmVxdWVuY3lNUyxcbiAgICAgICAgICAgIGltbWVkaWF0ZTogdHJ1ZVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgcmVxdWVzdENoZWNrKCkge1xuICAgICAgICBpZiAoSU5WQUxJRF9SRVFVRVNUX0NIRUNLX1NUQVRFUy5oYXModGhpcy5zLnN0YXRlKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXNba01vbml0b3JJZF0/Lndha2UoKTtcbiAgICB9XG4gICAgcmVzZXQoKSB7XG4gICAgICAgIGNvbnN0IHRvcG9sb2d5VmVyc2lvbiA9IHRoaXNba1NlcnZlcl0uZGVzY3JpcHRpb24udG9wb2xvZ3lWZXJzaW9uO1xuICAgICAgICBpZiAoaXNJbkNsb3NlU3RhdGUodGhpcykgfHwgdG9wb2xvZ3lWZXJzaW9uID09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBzdGF0ZVRyYW5zaXRpb24odGhpcywgY29tbW9uXzEuU1RBVEVfQ0xPU0lORyk7XG4gICAgICAgIHJlc2V0TW9uaXRvclN0YXRlKHRoaXMpO1xuICAgICAgICAvLyByZXN0YXJ0IG1vbml0b3JcbiAgICAgICAgc3RhdGVUcmFuc2l0aW9uKHRoaXMsIFNUQVRFX0lETEUpO1xuICAgICAgICAvLyByZXN0YXJ0IG1vbml0b3JpbmdcbiAgICAgICAgY29uc3QgaGVhcnRiZWF0RnJlcXVlbmN5TVMgPSB0aGlzLm9wdGlvbnMuaGVhcnRiZWF0RnJlcXVlbmN5TVM7XG4gICAgICAgIGNvbnN0IG1pbkhlYXJ0YmVhdEZyZXF1ZW5jeU1TID0gdGhpcy5vcHRpb25zLm1pbkhlYXJ0YmVhdEZyZXF1ZW5jeU1TO1xuICAgICAgICB0aGlzW2tNb25pdG9ySWRdID0gbmV3IE1vbml0b3JJbnRlcnZhbChtb25pdG9yU2VydmVyKHRoaXMpLCB7XG4gICAgICAgICAgICBoZWFydGJlYXRGcmVxdWVuY3lNUzogaGVhcnRiZWF0RnJlcXVlbmN5TVMsXG4gICAgICAgICAgICBtaW5IZWFydGJlYXRGcmVxdWVuY3lNUzogbWluSGVhcnRiZWF0RnJlcXVlbmN5TVNcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGNsb3NlKCkge1xuICAgICAgICBpZiAoaXNJbkNsb3NlU3RhdGUodGhpcykpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBzdGF0ZVRyYW5zaXRpb24odGhpcywgY29tbW9uXzEuU1RBVEVfQ0xPU0lORyk7XG4gICAgICAgIHJlc2V0TW9uaXRvclN0YXRlKHRoaXMpO1xuICAgICAgICAvLyBjbG9zZSBtb25pdG9yXG4gICAgICAgIHRoaXMuZW1pdCgnY2xvc2UnKTtcbiAgICAgICAgc3RhdGVUcmFuc2l0aW9uKHRoaXMsIGNvbW1vbl8xLlNUQVRFX0NMT1NFRCk7XG4gICAgfVxufVxuZXhwb3J0cy5Nb25pdG9yID0gTW9uaXRvcjtcbmZ1bmN0aW9uIHJlc2V0TW9uaXRvclN0YXRlKG1vbml0b3IpIHtcbiAgICBtb25pdG9yW2tNb25pdG9ySWRdPy5zdG9wKCk7XG4gICAgbW9uaXRvcltrTW9uaXRvcklkXSA9IHVuZGVmaW5lZDtcbiAgICBtb25pdG9yLnJ0dFBpbmdlcj8uY2xvc2UoKTtcbiAgICBtb25pdG9yLnJ0dFBpbmdlciA9IHVuZGVmaW5lZDtcbiAgICBtb25pdG9yW2tDYW5jZWxsYXRpb25Ub2tlbl0uZW1pdCgnY2FuY2VsJyk7XG4gICAgbW9uaXRvcltrQ29ubmVjdGlvbl0/LmRlc3Ryb3koeyBmb3JjZTogdHJ1ZSB9KTtcbiAgICBtb25pdG9yW2tDb25uZWN0aW9uXSA9IHVuZGVmaW5lZDtcbn1cbmZ1bmN0aW9uIGNoZWNrU2VydmVyKG1vbml0b3IsIGNhbGxiYWNrKSB7XG4gICAgbGV0IHN0YXJ0ID0gKDAsIHV0aWxzXzEubm93KSgpO1xuICAgIG1vbml0b3IuZW1pdChzZXJ2ZXJfMS5TZXJ2ZXIuU0VSVkVSX0hFQVJUQkVBVF9TVEFSVEVELCBuZXcgZXZlbnRzXzEuU2VydmVySGVhcnRiZWF0U3RhcnRlZEV2ZW50KG1vbml0b3IuYWRkcmVzcykpO1xuICAgIGZ1bmN0aW9uIGZhaWx1cmVIYW5kbGVyKGVycikge1xuICAgICAgICBtb25pdG9yW2tDb25uZWN0aW9uXT8uZGVzdHJveSh7IGZvcmNlOiB0cnVlIH0pO1xuICAgICAgICBtb25pdG9yW2tDb25uZWN0aW9uXSA9IHVuZGVmaW5lZDtcbiAgICAgICAgbW9uaXRvci5lbWl0KHNlcnZlcl8xLlNlcnZlci5TRVJWRVJfSEVBUlRCRUFUX0ZBSUxFRCwgbmV3IGV2ZW50c18xLlNlcnZlckhlYXJ0YmVhdEZhaWxlZEV2ZW50KG1vbml0b3IuYWRkcmVzcywgKDAsIHV0aWxzXzEuY2FsY3VsYXRlRHVyYXRpb25Jbk1zKShzdGFydCksIGVycikpO1xuICAgICAgICBjb25zdCBlcnJvciA9ICEoZXJyIGluc3RhbmNlb2YgZXJyb3JfMS5Nb25nb0Vycm9yKSA/IG5ldyBlcnJvcl8xLk1vbmdvRXJyb3IoZXJyKSA6IGVycjtcbiAgICAgICAgZXJyb3IuYWRkRXJyb3JMYWJlbChlcnJvcl8xLk1vbmdvRXJyb3JMYWJlbC5SZXNldFBvb2wpO1xuICAgICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBlcnJvcl8xLk1vbmdvTmV0d29ya1RpbWVvdXRFcnJvcikge1xuICAgICAgICAgICAgZXJyb3IuYWRkRXJyb3JMYWJlbChlcnJvcl8xLk1vbmdvRXJyb3JMYWJlbC5JbnRlcnJ1cHRJblVzZUNvbm5lY3Rpb25zKTtcbiAgICAgICAgfVxuICAgICAgICBtb25pdG9yLmVtaXQoJ3Jlc2V0U2VydmVyJywgZXJyb3IpO1xuICAgICAgICBjYWxsYmFjayhlcnIpO1xuICAgIH1cbiAgICBjb25zdCBjb25uZWN0aW9uID0gbW9uaXRvcltrQ29ubmVjdGlvbl07XG4gICAgaWYgKGNvbm5lY3Rpb24gJiYgIWNvbm5lY3Rpb24uY2xvc2VkKSB7XG4gICAgICAgIGNvbnN0IHsgc2VydmVyQXBpLCBoZWxsb09rIH0gPSBjb25uZWN0aW9uO1xuICAgICAgICBjb25zdCBjb25uZWN0VGltZW91dE1TID0gbW9uaXRvci5vcHRpb25zLmNvbm5lY3RUaW1lb3V0TVM7XG4gICAgICAgIGNvbnN0IG1heEF3YWl0VGltZU1TID0gbW9uaXRvci5vcHRpb25zLmhlYXJ0YmVhdEZyZXF1ZW5jeU1TO1xuICAgICAgICBjb25zdCB0b3BvbG9neVZlcnNpb24gPSBtb25pdG9yW2tTZXJ2ZXJdLmRlc2NyaXB0aW9uLnRvcG9sb2d5VmVyc2lvbjtcbiAgICAgICAgY29uc3QgaXNBd2FpdGFibGUgPSB0b3BvbG9neVZlcnNpb24gIT0gbnVsbDtcbiAgICAgICAgY29uc3QgY21kID0ge1xuICAgICAgICAgICAgW3NlcnZlckFwaT8udmVyc2lvbiB8fCBoZWxsb09rID8gJ2hlbGxvJyA6IGNvbnN0YW50c18xLkxFR0FDWV9IRUxMT19DT01NQU5EXTogMSxcbiAgICAgICAgICAgIC4uLihpc0F3YWl0YWJsZSAmJiB0b3BvbG9neVZlcnNpb25cbiAgICAgICAgICAgICAgICA/IHsgbWF4QXdhaXRUaW1lTVMsIHRvcG9sb2d5VmVyc2lvbjogbWFrZVRvcG9sb2d5VmVyc2lvbih0b3BvbG9neVZlcnNpb24pIH1cbiAgICAgICAgICAgICAgICA6IHt9KVxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBvcHRpb25zID0gaXNBd2FpdGFibGVcbiAgICAgICAgICAgID8ge1xuICAgICAgICAgICAgICAgIHNvY2tldFRpbWVvdXRNUzogY29ubmVjdFRpbWVvdXRNUyA/IGNvbm5lY3RUaW1lb3V0TVMgKyBtYXhBd2FpdFRpbWVNUyA6IDAsXG4gICAgICAgICAgICAgICAgZXhoYXVzdEFsbG93ZWQ6IHRydWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIDogeyBzb2NrZXRUaW1lb3V0TVM6IGNvbm5lY3RUaW1lb3V0TVMgfTtcbiAgICAgICAgaWYgKGlzQXdhaXRhYmxlICYmIG1vbml0b3IucnR0UGluZ2VyID09IG51bGwpIHtcbiAgICAgICAgICAgIG1vbml0b3IucnR0UGluZ2VyID0gbmV3IFJUVFBpbmdlcihtb25pdG9yW2tDYW5jZWxsYXRpb25Ub2tlbl0sIE9iamVjdC5hc3NpZ24oeyBoZWFydGJlYXRGcmVxdWVuY3lNUzogbW9uaXRvci5vcHRpb25zLmhlYXJ0YmVhdEZyZXF1ZW5jeU1TIH0sIG1vbml0b3IuY29ubmVjdE9wdGlvbnMpKTtcbiAgICAgICAgfVxuICAgICAgICBjb25uZWN0aW9uLmNvbW1hbmQoKDAsIHV0aWxzXzEubnMpKCdhZG1pbi4kY21kJyksIGNtZCwgb3B0aW9ucywgKGVyciwgaGVsbG8pID0+IHtcbiAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFpbHVyZUhhbmRsZXIoZXJyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghKCdpc1dyaXRhYmxlUHJpbWFyeScgaW4gaGVsbG8pKSB7XG4gICAgICAgICAgICAgICAgLy8gUHJvdmlkZSBoZWxsby1zdHlsZSByZXNwb25zZSBkb2N1bWVudC5cbiAgICAgICAgICAgICAgICBoZWxsby5pc1dyaXRhYmxlUHJpbWFyeSA9IGhlbGxvW2NvbnN0YW50c18xLkxFR0FDWV9IRUxMT19DT01NQU5EXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGR1cmF0aW9uID0gaXNBd2FpdGFibGUgJiYgbW9uaXRvci5ydHRQaW5nZXJcbiAgICAgICAgICAgICAgICA/IG1vbml0b3IucnR0UGluZ2VyLnJvdW5kVHJpcFRpbWVcbiAgICAgICAgICAgICAgICA6ICgwLCB1dGlsc18xLmNhbGN1bGF0ZUR1cmF0aW9uSW5Ncykoc3RhcnQpO1xuICAgICAgICAgICAgbW9uaXRvci5lbWl0KHNlcnZlcl8xLlNlcnZlci5TRVJWRVJfSEVBUlRCRUFUX1NVQ0NFRURFRCwgbmV3IGV2ZW50c18xLlNlcnZlckhlYXJ0YmVhdFN1Y2NlZWRlZEV2ZW50KG1vbml0b3IuYWRkcmVzcywgZHVyYXRpb24sIGhlbGxvKSk7XG4gICAgICAgICAgICAvLyBpZiB3ZSBhcmUgdXNpbmcgdGhlIHN0cmVhbWluZyBwcm90b2NvbCB0aGVuIHdlIGltbWVkaWF0ZWx5IGlzc3VlIGFub3RoZXIgYHN0YXJ0ZWRgXG4gICAgICAgICAgICAvLyBldmVudCwgb3RoZXJ3aXNlIHRoZSBcImNoZWNrXCIgaXMgY29tcGxldGUgYW5kIHJldHVybiB0byB0aGUgbWFpbiBtb25pdG9yIGxvb3BcbiAgICAgICAgICAgIGlmIChpc0F3YWl0YWJsZSAmJiBoZWxsby50b3BvbG9neVZlcnNpb24pIHtcbiAgICAgICAgICAgICAgICBtb25pdG9yLmVtaXQoc2VydmVyXzEuU2VydmVyLlNFUlZFUl9IRUFSVEJFQVRfU1RBUlRFRCwgbmV3IGV2ZW50c18xLlNlcnZlckhlYXJ0YmVhdFN0YXJ0ZWRFdmVudChtb25pdG9yLmFkZHJlc3MpKTtcbiAgICAgICAgICAgICAgICBzdGFydCA9ICgwLCB1dGlsc18xLm5vdykoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIG1vbml0b3IucnR0UGluZ2VyPy5jbG9zZSgpO1xuICAgICAgICAgICAgICAgIG1vbml0b3IucnR0UGluZ2VyID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwgaGVsbG8pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAvLyBjb25uZWN0aW5nIGRvZXMgYW4gaW1wbGljaXQgYGhlbGxvYFxuICAgICgwLCBjb25uZWN0XzEuY29ubmVjdCkobW9uaXRvci5jb25uZWN0T3B0aW9ucywgKGVyciwgY29ubikgPT4ge1xuICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICBtb25pdG9yW2tDb25uZWN0aW9uXSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIGZhaWx1cmVIYW5kbGVyKGVycik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbm4pIHtcbiAgICAgICAgICAgIC8vIFRlbGwgdGhlIGNvbm5lY3Rpb24gdGhhdCB3ZSBhcmUgdXNpbmcgdGhlIHN0cmVhbWluZyBwcm90b2NvbCBzbyB0aGF0IHRoZVxuICAgICAgICAgICAgLy8gY29ubmVjdGlvbidzIG1lc3NhZ2Ugc3RyZWFtIHdpbGwgb25seSByZWFkIHRoZSBsYXN0IGhlbGxvIG9uIHRoZSBidWZmZXIuXG4gICAgICAgICAgICBjb25uLmlzTW9uaXRvcmluZ0Nvbm5lY3Rpb24gPSB0cnVlO1xuICAgICAgICAgICAgaWYgKGlzSW5DbG9zZVN0YXRlKG1vbml0b3IpKSB7XG4gICAgICAgICAgICAgICAgY29ubi5kZXN0cm95KHsgZm9yY2U6IHRydWUgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbW9uaXRvcltrQ29ubmVjdGlvbl0gPSBjb25uO1xuICAgICAgICAgICAgbW9uaXRvci5lbWl0KHNlcnZlcl8xLlNlcnZlci5TRVJWRVJfSEVBUlRCRUFUX1NVQ0NFRURFRCwgbmV3IGV2ZW50c18xLlNlcnZlckhlYXJ0YmVhdFN1Y2NlZWRlZEV2ZW50KG1vbml0b3IuYWRkcmVzcywgKDAsIHV0aWxzXzEuY2FsY3VsYXRlRHVyYXRpb25Jbk1zKShzdGFydCksIGNvbm4uaGVsbG8pKTtcbiAgICAgICAgICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwgY29ubi5oZWxsbyk7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmZ1bmN0aW9uIG1vbml0b3JTZXJ2ZXIobW9uaXRvcikge1xuICAgIHJldHVybiAoY2FsbGJhY2spID0+IHtcbiAgICAgICAgaWYgKG1vbml0b3Iucy5zdGF0ZSA9PT0gU1RBVEVfTU9OSVRPUklORykge1xuICAgICAgICAgICAgcHJvY2Vzcy5uZXh0VGljayhjYWxsYmFjayk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgc3RhdGVUcmFuc2l0aW9uKG1vbml0b3IsIFNUQVRFX01PTklUT1JJTkcpO1xuICAgICAgICBmdW5jdGlvbiBkb25lKCkge1xuICAgICAgICAgICAgaWYgKCFpc0luQ2xvc2VTdGF0ZShtb25pdG9yKSkge1xuICAgICAgICAgICAgICAgIHN0YXRlVHJhbnNpdGlvbihtb25pdG9yLCBTVEFURV9JRExFKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgIH1cbiAgICAgICAgY2hlY2tTZXJ2ZXIobW9uaXRvciwgKGVyciwgaGVsbG8pID0+IHtcbiAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgICAvLyBvdGhlcndpc2UgYW4gZXJyb3Igb2NjdXJyZWQgb24gaW5pdGlhbCBkaXNjb3ZlcnksIGFsc28gYmFpbFxuICAgICAgICAgICAgICAgIGlmIChtb25pdG9yW2tTZXJ2ZXJdLmRlc2NyaXB0aW9uLnR5cGUgPT09IGNvbW1vbl8xLlNlcnZlclR5cGUuVW5rbm93bikge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZG9uZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGlmIHRoZSBjaGVjayBpbmRpY2F0ZXMgc3RyZWFtaW5nIGlzIHN1cHBvcnRlZCwgaW1tZWRpYXRlbHkgcmVzY2hlZHVsZSBtb25pdG9yaW5nXG4gICAgICAgICAgICBpZiAoaGVsbG8gJiYgaGVsbG8udG9wb2xvZ3lWZXJzaW9uKSB7XG4gICAgICAgICAgICAgICAgKDAsIHRpbWVyc18xLnNldFRpbWVvdXQpKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc0luQ2xvc2VTdGF0ZShtb25pdG9yKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbW9uaXRvcltrTW9uaXRvcklkXT8ud2FrZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSwgMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkb25lKCk7XG4gICAgICAgIH0pO1xuICAgIH07XG59XG5mdW5jdGlvbiBtYWtlVG9wb2xvZ3lWZXJzaW9uKHR2KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgcHJvY2Vzc0lkOiB0di5wcm9jZXNzSWQsXG4gICAgICAgIC8vIHRlc3RzIG1vY2sgY291bnRlciBhcyBqdXN0IG51bWJlciwgYnV0IGluIGEgcmVhbCBzaXR1YXRpb24gY291bnRlciBzaG91bGQgYWx3YXlzIGJlIGEgTG9uZ1xuICAgICAgICAvLyBUT0RPKE5PREUtMjY3NCk6IFByZXNlcnZlIGludDY0IHNlbnQgZnJvbSBNb25nb0RCXG4gICAgICAgIGNvdW50ZXI6IGJzb25fMS5Mb25nLmlzTG9uZyh0di5jb3VudGVyKSA/IHR2LmNvdW50ZXIgOiBic29uXzEuTG9uZy5mcm9tTnVtYmVyKHR2LmNvdW50ZXIpXG4gICAgfTtcbn1cbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIFJUVFBpbmdlciB7XG4gICAgY29uc3RydWN0b3IoY2FuY2VsbGF0aW9uVG9rZW4sIG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5jb25uZWN0aW9uID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzW2tDYW5jZWxsYXRpb25Ub2tlbl0gPSBjYW5jZWxsYXRpb25Ub2tlbjtcbiAgICAgICAgdGhpc1trUm91bmRUcmlwVGltZV0gPSAwO1xuICAgICAgICB0aGlzLmNsb3NlZCA9IGZhbHNlO1xuICAgICAgICBjb25zdCBoZWFydGJlYXRGcmVxdWVuY3lNUyA9IG9wdGlvbnMuaGVhcnRiZWF0RnJlcXVlbmN5TVM7XG4gICAgICAgIHRoaXNba01vbml0b3JJZF0gPSAoMCwgdGltZXJzXzEuc2V0VGltZW91dCkoKCkgPT4gbWVhc3VyZVJvdW5kVHJpcFRpbWUodGhpcywgb3B0aW9ucyksIGhlYXJ0YmVhdEZyZXF1ZW5jeU1TKTtcbiAgICB9XG4gICAgZ2V0IHJvdW5kVHJpcFRpbWUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzW2tSb3VuZFRyaXBUaW1lXTtcbiAgICB9XG4gICAgY2xvc2UoKSB7XG4gICAgICAgIHRoaXMuY2xvc2VkID0gdHJ1ZTtcbiAgICAgICAgKDAsIHRpbWVyc18xLmNsZWFyVGltZW91dCkodGhpc1trTW9uaXRvcklkXSk7XG4gICAgICAgIHRoaXMuY29ubmVjdGlvbj8uZGVzdHJveSh7IGZvcmNlOiB0cnVlIH0pO1xuICAgICAgICB0aGlzLmNvbm5lY3Rpb24gPSB1bmRlZmluZWQ7XG4gICAgfVxufVxuZXhwb3J0cy5SVFRQaW5nZXIgPSBSVFRQaW5nZXI7XG5mdW5jdGlvbiBtZWFzdXJlUm91bmRUcmlwVGltZShydHRQaW5nZXIsIG9wdGlvbnMpIHtcbiAgICBjb25zdCBzdGFydCA9ICgwLCB1dGlsc18xLm5vdykoKTtcbiAgICBvcHRpb25zLmNhbmNlbGxhdGlvblRva2VuID0gcnR0UGluZ2VyW2tDYW5jZWxsYXRpb25Ub2tlbl07XG4gICAgY29uc3QgaGVhcnRiZWF0RnJlcXVlbmN5TVMgPSBvcHRpb25zLmhlYXJ0YmVhdEZyZXF1ZW5jeU1TO1xuICAgIGlmIChydHRQaW5nZXIuY2xvc2VkKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgZnVuY3Rpb24gbWVhc3VyZUFuZFJlc2NoZWR1bGUoY29ubikge1xuICAgICAgICBpZiAocnR0UGluZ2VyLmNsb3NlZCkge1xuICAgICAgICAgICAgY29ubj8uZGVzdHJveSh7IGZvcmNlOiB0cnVlIH0pO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChydHRQaW5nZXIuY29ubmVjdGlvbiA9PSBudWxsKSB7XG4gICAgICAgICAgICBydHRQaW5nZXIuY29ubmVjdGlvbiA9IGNvbm47XG4gICAgICAgIH1cbiAgICAgICAgcnR0UGluZ2VyW2tSb3VuZFRyaXBUaW1lXSA9ICgwLCB1dGlsc18xLmNhbGN1bGF0ZUR1cmF0aW9uSW5Ncykoc3RhcnQpO1xuICAgICAgICBydHRQaW5nZXJba01vbml0b3JJZF0gPSAoMCwgdGltZXJzXzEuc2V0VGltZW91dCkoKCkgPT4gbWVhc3VyZVJvdW5kVHJpcFRpbWUocnR0UGluZ2VyLCBvcHRpb25zKSwgaGVhcnRiZWF0RnJlcXVlbmN5TVMpO1xuICAgIH1cbiAgICBjb25zdCBjb25uZWN0aW9uID0gcnR0UGluZ2VyLmNvbm5lY3Rpb247XG4gICAgaWYgKGNvbm5lY3Rpb24gPT0gbnVsbCkge1xuICAgICAgICAoMCwgY29ubmVjdF8xLmNvbm5lY3QpKG9wdGlvbnMsIChlcnIsIGNvbm4pID0+IHtcbiAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgICBydHRQaW5nZXIuY29ubmVjdGlvbiA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICBydHRQaW5nZXJba1JvdW5kVHJpcFRpbWVdID0gMDtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBtZWFzdXJlQW5kUmVzY2hlZHVsZShjb25uKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgY29tbWFuZE5hbWUgPSBjb25uZWN0aW9uLnNlcnZlckFwaT8udmVyc2lvbiB8fCBjb25uZWN0aW9uLmhlbGxvT2sgPyAnaGVsbG8nIDogY29uc3RhbnRzXzEuTEVHQUNZX0hFTExPX0NPTU1BTkQ7XG4gICAgY29ubmVjdGlvbi5jb21tYW5kQXN5bmMoKDAsIHV0aWxzXzEubnMpKCdhZG1pbi4kY21kJyksIHsgW2NvbW1hbmROYW1lXTogMSB9LCB1bmRlZmluZWQpLnRoZW4oKCkgPT4gbWVhc3VyZUFuZFJlc2NoZWR1bGUoKSwgKCkgPT4ge1xuICAgICAgICBydHRQaW5nZXIuY29ubmVjdGlvbj8uZGVzdHJveSh7IGZvcmNlOiB0cnVlIH0pO1xuICAgICAgICBydHRQaW5nZXIuY29ubmVjdGlvbiA9IHVuZGVmaW5lZDtcbiAgICAgICAgcnR0UGluZ2VyW2tSb3VuZFRyaXBUaW1lXSA9IDA7XG4gICAgfSk7XG59XG4vKipcbiAqIEBpbnRlcm5hbFxuICovXG5jbGFzcyBNb25pdG9ySW50ZXJ2YWwge1xuICAgIGNvbnN0cnVjdG9yKGZuLCBvcHRpb25zID0ge30pIHtcbiAgICAgICAgdGhpcy5pc0V4cGVkaXRlZENhbGxUb0ZuU2NoZWR1bGVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc3RvcHBlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmlzRXhlY3V0aW9uSW5Qcm9ncmVzcyA9IGZhbHNlO1xuICAgICAgICB0aGlzLmhhc0V4ZWN1dGVkT25jZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLl9leGVjdXRlQW5kUmVzY2hlZHVsZSA9ICgpID0+IHtcbiAgICAgICAgICAgIGlmICh0aGlzLnN0b3BwZWQpXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgaWYgKHRoaXMudGltZXJJZCkge1xuICAgICAgICAgICAgICAgICgwLCB0aW1lcnNfMS5jbGVhclRpbWVvdXQpKHRoaXMudGltZXJJZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmlzRXhwZWRpdGVkQ2FsbFRvRm5TY2hlZHVsZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuaXNFeGVjdXRpb25JblByb2dyZXNzID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuZm4oKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMubGFzdEV4ZWN1dGlvbkVuZGVkID0gKDAsIHV0aWxzXzEubm93KSgpO1xuICAgICAgICAgICAgICAgIHRoaXMuaXNFeGVjdXRpb25JblByb2dyZXNzID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5fcmVzY2hlZHVsZSh0aGlzLmhlYXJ0YmVhdEZyZXF1ZW5jeU1TKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmZuID0gZm47XG4gICAgICAgIHRoaXMubGFzdEV4ZWN1dGlvbkVuZGVkID0gLUluZmluaXR5O1xuICAgICAgICB0aGlzLmhlYXJ0YmVhdEZyZXF1ZW5jeU1TID0gb3B0aW9ucy5oZWFydGJlYXRGcmVxdWVuY3lNUyA/PyAxMDAwO1xuICAgICAgICB0aGlzLm1pbkhlYXJ0YmVhdEZyZXF1ZW5jeU1TID0gb3B0aW9ucy5taW5IZWFydGJlYXRGcmVxdWVuY3lNUyA/PyA1MDA7XG4gICAgICAgIGlmIChvcHRpb25zLmltbWVkaWF0ZSkge1xuICAgICAgICAgICAgdGhpcy5fZXhlY3V0ZUFuZFJlc2NoZWR1bGUoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuX3Jlc2NoZWR1bGUodW5kZWZpbmVkKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICB3YWtlKCkge1xuICAgICAgICBjb25zdCBjdXJyZW50VGltZSA9ICgwLCB1dGlsc18xLm5vdykoKTtcbiAgICAgICAgY29uc3QgdGltZVNpbmNlTGFzdENhbGwgPSBjdXJyZW50VGltZSAtIHRoaXMubGFzdEV4ZWN1dGlvbkVuZGVkO1xuICAgICAgICAvLyBUT0RPKE5PREUtNDY3NCk6IEFkZCBlcnJvciBoYW5kbGluZyBhbmQgbG9nZ2luZyB0byB0aGUgbW9uaXRvclxuICAgICAgICBpZiAodGltZVNpbmNlTGFzdENhbGwgPCAwKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fZXhlY3V0ZUFuZFJlc2NoZWR1bGUoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5pc0V4ZWN1dGlvbkluUHJvZ3Jlc3MpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyBkZWJvdW5jZSBtdWx0aXBsZSBjYWxscyB0byB3YWtlIHdpdGhpbiB0aGUgYG1pbkludGVydmFsYFxuICAgICAgICBpZiAodGhpcy5pc0V4cGVkaXRlZENhbGxUb0ZuU2NoZWR1bGVkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy8gcmVzY2hlZHVsZSBhIGNhbGwgYXMgc29vbiBhcyBwb3NzaWJsZSwgZW5zdXJpbmcgdGhlIGNhbGwgbmV2ZXIgaGFwcGVuc1xuICAgICAgICAvLyBmYXN0ZXIgdGhhbiB0aGUgYG1pbkludGVydmFsYFxuICAgICAgICBpZiAodGltZVNpbmNlTGFzdENhbGwgPCB0aGlzLm1pbkhlYXJ0YmVhdEZyZXF1ZW5jeU1TKSB7XG4gICAgICAgICAgICB0aGlzLmlzRXhwZWRpdGVkQ2FsbFRvRm5TY2hlZHVsZWQgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5fcmVzY2hlZHVsZSh0aGlzLm1pbkhlYXJ0YmVhdEZyZXF1ZW5jeU1TIC0gdGltZVNpbmNlTGFzdENhbGwpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2V4ZWN1dGVBbmRSZXNjaGVkdWxlKCk7XG4gICAgfVxuICAgIHN0b3AoKSB7XG4gICAgICAgIHRoaXMuc3RvcHBlZCA9IHRydWU7XG4gICAgICAgIGlmICh0aGlzLnRpbWVySWQpIHtcbiAgICAgICAgICAgICgwLCB0aW1lcnNfMS5jbGVhclRpbWVvdXQpKHRoaXMudGltZXJJZCk7XG4gICAgICAgICAgICB0aGlzLnRpbWVySWQgPSB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5sYXN0RXhlY3V0aW9uRW5kZWQgPSAtSW5maW5pdHk7XG4gICAgICAgIHRoaXMuaXNFeHBlZGl0ZWRDYWxsVG9GblNjaGVkdWxlZCA9IGZhbHNlO1xuICAgIH1cbiAgICB0b1N0cmluZygpIHtcbiAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHRoaXMpO1xuICAgIH1cbiAgICB0b0pTT04oKSB7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRUaW1lID0gKDAsIHV0aWxzXzEubm93KSgpO1xuICAgICAgICBjb25zdCB0aW1lU2luY2VMYXN0Q2FsbCA9IGN1cnJlbnRUaW1lIC0gdGhpcy5sYXN0RXhlY3V0aW9uRW5kZWQ7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0aW1lcklkOiB0aGlzLnRpbWVySWQgIT0gbnVsbCA/ICdzZXQnIDogJ2NsZWFyZWQnLFxuICAgICAgICAgICAgbGFzdENhbGxUaW1lOiB0aGlzLmxhc3RFeGVjdXRpb25FbmRlZCxcbiAgICAgICAgICAgIGlzRXhwZWRpdGVkQ2hlY2tTY2hlZHVsZWQ6IHRoaXMuaXNFeHBlZGl0ZWRDYWxsVG9GblNjaGVkdWxlZCxcbiAgICAgICAgICAgIHN0b3BwZWQ6IHRoaXMuc3RvcHBlZCxcbiAgICAgICAgICAgIGhlYXJ0YmVhdEZyZXF1ZW5jeU1TOiB0aGlzLmhlYXJ0YmVhdEZyZXF1ZW5jeU1TLFxuICAgICAgICAgICAgbWluSGVhcnRiZWF0RnJlcXVlbmN5TVM6IHRoaXMubWluSGVhcnRiZWF0RnJlcXVlbmN5TVMsXG4gICAgICAgICAgICBjdXJyZW50VGltZSxcbiAgICAgICAgICAgIHRpbWVTaW5jZUxhc3RDYWxsXG4gICAgICAgIH07XG4gICAgfVxuICAgIF9yZXNjaGVkdWxlKG1zKSB7XG4gICAgICAgIGlmICh0aGlzLnN0b3BwZWQpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGlmICh0aGlzLnRpbWVySWQpIHtcbiAgICAgICAgICAgICgwLCB0aW1lcnNfMS5jbGVhclRpbWVvdXQpKHRoaXMudGltZXJJZCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy50aW1lcklkID0gKDAsIHRpbWVyc18xLnNldFRpbWVvdXQpKHRoaXMuX2V4ZWN1dGVBbmRSZXNjaGVkdWxlLCBtcyB8fCB0aGlzLmhlYXJ0YmVhdEZyZXF1ZW5jeU1TKTtcbiAgICB9XG59XG5leHBvcnRzLk1vbml0b3JJbnRlcnZhbCA9IE1vbml0b3JJbnRlcnZhbDtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPW1vbml0b3IuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/sdam/monitor.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/sdam/server.js":
/*!*********************************************************!*\
  !*** ../server/node_modules/mongodb/lib/sdam/server.js ***!
  \*********************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.Server = void 0;\nconst util_1 = __webpack_require__(/*! util */ \"util\");\nconst connection_1 = __webpack_require__(/*! ../cmap/connection */ \"(api)/../server/node_modules/mongodb/lib/cmap/connection.js\");\nconst connection_pool_1 = __webpack_require__(/*! ../cmap/connection_pool */ \"(api)/../server/node_modules/mongodb/lib/cmap/connection_pool.js\");\nconst errors_1 = __webpack_require__(/*! ../cmap/errors */ \"(api)/../server/node_modules/mongodb/lib/cmap/errors.js\");\nconst constants_1 = __webpack_require__(/*! ../constants */ \"(api)/../server/node_modules/mongodb/lib/constants.js\");\nconst error_1 = __webpack_require__(/*! ../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst mongo_types_1 = __webpack_require__(/*! ../mongo_types */ \"(api)/../server/node_modules/mongodb/lib/mongo_types.js\");\nconst transactions_1 = __webpack_require__(/*! ../transactions */ \"(api)/../server/node_modules/mongodb/lib/transactions.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\nconst common_1 = __webpack_require__(/*! ./common */ \"(api)/../server/node_modules/mongodb/lib/sdam/common.js\");\nconst monitor_1 = __webpack_require__(/*! ./monitor */ \"(api)/../server/node_modules/mongodb/lib/sdam/monitor.js\");\nconst server_description_1 = __webpack_require__(/*! ./server_description */ \"(api)/../server/node_modules/mongodb/lib/sdam/server_description.js\");\nconst stateTransition = (0, utils_1.makeStateMachine)({\n    [common_1.STATE_CLOSED]: [common_1.STATE_CLOSED, common_1.STATE_CONNECTING],\n    [common_1.STATE_CONNECTING]: [common_1.STATE_CONNECTING, common_1.STATE_CLOSING, common_1.STATE_CONNECTED, common_1.STATE_CLOSED],\n    [common_1.STATE_CONNECTED]: [common_1.STATE_CONNECTED, common_1.STATE_CLOSING, common_1.STATE_CLOSED],\n    [common_1.STATE_CLOSING]: [common_1.STATE_CLOSING, common_1.STATE_CLOSED]\n});\n/** @internal */\nclass Server extends mongo_types_1.TypedEventEmitter {\n    /**\n     * Create a server\n     */\n    constructor(topology, description, options) {\n        super();\n        this.commandAsync = (0, util_1.promisify)((ns, cmd, options, \n        // callback type defines Document result because result is never nullish when it succeeds, otherwise promise rejects\n        callback) => this.command(ns, cmd, options, callback));\n        this.serverApi = options.serverApi;\n        const poolOptions = { hostAddress: description.hostAddress, ...options };\n        this.topology = topology;\n        this.pool = new connection_pool_1.ConnectionPool(this, poolOptions);\n        this.s = {\n            description,\n            options,\n            state: common_1.STATE_CLOSED,\n            operationCount: 0\n        };\n        for (const event of [...constants_1.CMAP_EVENTS, ...constants_1.APM_EVENTS]) {\n            this.pool.on(event, (e) => this.emit(event, e));\n        }\n        this.pool.on(connection_1.Connection.CLUSTER_TIME_RECEIVED, (clusterTime) => {\n            this.clusterTime = clusterTime;\n        });\n        if (this.loadBalanced) {\n            this.monitor = null;\n            // monitoring is disabled in load balancing mode\n            return;\n        }\n        // create the monitor\n        // TODO(NODE-4144): Remove new variable for type narrowing\n        this.monitor = new monitor_1.Monitor(this, this.s.options);\n        for (const event of constants_1.HEARTBEAT_EVENTS) {\n            this.monitor.on(event, (e) => this.emit(event, e));\n        }\n        this.monitor.on('resetServer', (error) => markServerUnknown(this, error));\n        this.monitor.on(Server.SERVER_HEARTBEAT_SUCCEEDED, (event) => {\n            this.emit(Server.DESCRIPTION_RECEIVED, new server_description_1.ServerDescription(this.description.hostAddress, event.reply, {\n                roundTripTime: calculateRoundTripTime(this.description.roundTripTime, event.duration)\n            }));\n            if (this.s.state === common_1.STATE_CONNECTING) {\n                stateTransition(this, common_1.STATE_CONNECTED);\n                this.emit(Server.CONNECT, this);\n            }\n        });\n    }\n    get clusterTime() {\n        return this.topology.clusterTime;\n    }\n    set clusterTime(clusterTime) {\n        this.topology.clusterTime = clusterTime;\n    }\n    get description() {\n        return this.s.description;\n    }\n    get name() {\n        return this.s.description.address;\n    }\n    get autoEncrypter() {\n        if (this.s.options && this.s.options.autoEncrypter) {\n            return this.s.options.autoEncrypter;\n        }\n        return;\n    }\n    get loadBalanced() {\n        return this.topology.description.type === common_1.TopologyType.LoadBalanced;\n    }\n    /**\n     * Initiate server connect\n     */\n    connect() {\n        if (this.s.state !== common_1.STATE_CLOSED) {\n            return;\n        }\n        stateTransition(this, common_1.STATE_CONNECTING);\n        // If in load balancer mode we automatically set the server to\n        // a load balancer. It never transitions out of this state and\n        // has no monitor.\n        if (!this.loadBalanced) {\n            this.monitor?.connect();\n        }\n        else {\n            stateTransition(this, common_1.STATE_CONNECTED);\n            this.emit(Server.CONNECT, this);\n        }\n    }\n    /** Destroy the server connection */\n    destroy(options, callback) {\n        if (typeof options === 'function') {\n            callback = options;\n            options = { force: false };\n        }\n        options = Object.assign({}, { force: false }, options);\n        if (this.s.state === common_1.STATE_CLOSED) {\n            if (typeof callback === 'function') {\n                callback();\n            }\n            return;\n        }\n        stateTransition(this, common_1.STATE_CLOSING);\n        if (!this.loadBalanced) {\n            this.monitor?.close();\n        }\n        this.pool.close(options, err => {\n            stateTransition(this, common_1.STATE_CLOSED);\n            this.emit('closed');\n            if (typeof callback === 'function') {\n                callback(err);\n            }\n        });\n    }\n    /**\n     * Immediately schedule monitoring of this server. If there already an attempt being made\n     * this will be a no-op.\n     */\n    requestCheck() {\n        if (!this.loadBalanced) {\n            this.monitor?.requestCheck();\n        }\n    }\n    /**\n     * Execute a command\n     * @internal\n     */\n    command(ns, cmd, options, callback) {\n        if (callback == null) {\n            throw new error_1.MongoInvalidArgumentError('Callback must be provided');\n        }\n        if (ns.db == null || typeof ns === 'string') {\n            throw new error_1.MongoInvalidArgumentError('Namespace must not be a string');\n        }\n        if (this.s.state === common_1.STATE_CLOSING || this.s.state === common_1.STATE_CLOSED) {\n            callback(new error_1.MongoServerClosedError());\n            return;\n        }\n        // Clone the options\n        const finalOptions = Object.assign({}, options, { wireProtocolCommand: false });\n        // There are cases where we need to flag the read preference not to get sent in\n        // the command, such as pre-5.0 servers attempting to perform an aggregate write\n        // with a non-primary read preference. In this case the effective read preference\n        // (primary) is not the same as the provided and must be removed completely.\n        if (finalOptions.omitReadPreference) {\n            delete finalOptions.readPreference;\n        }\n        const session = finalOptions.session;\n        const conn = session?.pinnedConnection;\n        // NOTE: This is a hack! We can't retrieve the connections used for executing an operation\n        //       (and prevent them from being checked back in) at the point of operation execution.\n        //       This should be considered as part of the work for NODE-2882\n        // NOTE:\n        //       When incrementing operation count, it's important that we increment it before we\n        //       attempt to check out a connection from the pool.  This ensures that operations that\n        //       are waiting for a connection are included in the operation count.  Load balanced\n        //       mode will only ever have a single server, so the operation count doesn't matter.\n        //       Incrementing the operation count above the logic to handle load balanced mode would\n        //       require special logic to decrement it again, or would double increment (the load\n        //       balanced code makes a recursive call).  Instead, we increment the count after this\n        //       check.\n        if (this.loadBalanced && session && conn == null && isPinnableCommand(cmd, session)) {\n            this.pool.checkOut((err, checkedOut) => {\n                if (err || checkedOut == null) {\n                    if (callback)\n                        return callback(err);\n                    return;\n                }\n                session.pin(checkedOut);\n                this.command(ns, cmd, finalOptions, callback);\n            });\n            return;\n        }\n        this.incrementOperationCount();\n        this.pool.withConnection(conn, (err, conn, cb) => {\n            if (err || !conn) {\n                this.decrementOperationCount();\n                if (!err) {\n                    return cb(new error_1.MongoRuntimeError('Failed to create connection without error'));\n                }\n                if (!(err instanceof errors_1.PoolClearedError)) {\n                    this.handleError(err);\n                }\n                return cb(err);\n            }\n            conn.command(ns, cmd, finalOptions, makeOperationHandler(this, conn, cmd, finalOptions, (error, response) => {\n                this.decrementOperationCount();\n                cb(error, response);\n            }));\n        }, callback);\n    }\n    /**\n     * Handle SDAM error\n     * @internal\n     */\n    handleError(error, connection) {\n        if (!(error instanceof error_1.MongoError)) {\n            return;\n        }\n        const isStaleError = error.connectionGeneration && error.connectionGeneration < this.pool.generation;\n        if (isStaleError) {\n            return;\n        }\n        const isNetworkNonTimeoutError = error instanceof error_1.MongoNetworkError && !(error instanceof error_1.MongoNetworkTimeoutError);\n        const isNetworkTimeoutBeforeHandshakeError = (0, error_1.isNetworkErrorBeforeHandshake)(error);\n        const isAuthHandshakeError = error.hasErrorLabel(error_1.MongoErrorLabel.HandshakeError);\n        if (isNetworkNonTimeoutError || isNetworkTimeoutBeforeHandshakeError || isAuthHandshakeError) {\n            // In load balanced mode we never mark the server as unknown and always\n            // clear for the specific service id.\n            if (!this.loadBalanced) {\n                error.addErrorLabel(error_1.MongoErrorLabel.ResetPool);\n                markServerUnknown(this, error);\n            }\n            else if (connection) {\n                this.pool.clear({ serviceId: connection.serviceId });\n            }\n        }\n        else {\n            if ((0, error_1.isSDAMUnrecoverableError)(error)) {\n                if (shouldHandleStateChangeError(this, error)) {\n                    const shouldClearPool = (0, utils_1.maxWireVersion)(this) <= 7 || (0, error_1.isNodeShuttingDownError)(error);\n                    if (this.loadBalanced && connection && shouldClearPool) {\n                        this.pool.clear({ serviceId: connection.serviceId });\n                    }\n                    if (!this.loadBalanced) {\n                        if (shouldClearPool) {\n                            error.addErrorLabel(error_1.MongoErrorLabel.ResetPool);\n                        }\n                        markServerUnknown(this, error);\n                        process.nextTick(() => this.requestCheck());\n                    }\n                }\n            }\n        }\n    }\n    /**\n     * Decrement the operation count, returning the new count.\n     */\n    decrementOperationCount() {\n        return (this.s.operationCount -= 1);\n    }\n    /**\n     * Increment the operation count, returning the new count.\n     */\n    incrementOperationCount() {\n        return (this.s.operationCount += 1);\n    }\n}\n/** @event */\nServer.SERVER_HEARTBEAT_STARTED = constants_1.SERVER_HEARTBEAT_STARTED;\n/** @event */\nServer.SERVER_HEARTBEAT_SUCCEEDED = constants_1.SERVER_HEARTBEAT_SUCCEEDED;\n/** @event */\nServer.SERVER_HEARTBEAT_FAILED = constants_1.SERVER_HEARTBEAT_FAILED;\n/** @event */\nServer.CONNECT = constants_1.CONNECT;\n/** @event */\nServer.DESCRIPTION_RECEIVED = constants_1.DESCRIPTION_RECEIVED;\n/** @event */\nServer.CLOSED = constants_1.CLOSED;\n/** @event */\nServer.ENDED = constants_1.ENDED;\nexports.Server = Server;\nfunction calculateRoundTripTime(oldRtt, duration) {\n    if (oldRtt === -1) {\n        return duration;\n    }\n    const alpha = 0.2;\n    return alpha * duration + (1 - alpha) * oldRtt;\n}\nfunction markServerUnknown(server, error) {\n    // Load balancer servers can never be marked unknown.\n    if (server.loadBalanced) {\n        return;\n    }\n    if (error instanceof error_1.MongoNetworkError && !(error instanceof error_1.MongoNetworkTimeoutError)) {\n        server.monitor?.reset();\n    }\n    server.emit(Server.DESCRIPTION_RECEIVED, new server_description_1.ServerDescription(server.description.hostAddress, undefined, { error }));\n}\nfunction isPinnableCommand(cmd, session) {\n    if (session) {\n        return (session.inTransaction() ||\n            'aggregate' in cmd ||\n            'find' in cmd ||\n            'getMore' in cmd ||\n            'listCollections' in cmd ||\n            'listIndexes' in cmd);\n    }\n    return false;\n}\nfunction connectionIsStale(pool, connection) {\n    if (connection.serviceId) {\n        return (connection.generation !== pool.serviceGenerations.get(connection.serviceId.toHexString()));\n    }\n    return connection.generation !== pool.generation;\n}\nfunction shouldHandleStateChangeError(server, err) {\n    const etv = err.topologyVersion;\n    const stv = server.description.topologyVersion;\n    return (0, server_description_1.compareTopologyVersion)(stv, etv) < 0;\n}\nfunction inActiveTransaction(session, cmd) {\n    return session && session.inTransaction() && !(0, transactions_1.isTransactionCommand)(cmd);\n}\n/** this checks the retryWrites option passed down from the client options, it\n * does not check if the server supports retryable writes */\nfunction isRetryableWritesEnabled(topology) {\n    return topology.s.options.retryWrites !== false;\n}\nfunction makeOperationHandler(server, connection, cmd, options, callback) {\n    const session = options?.session;\n    return function handleOperationResult(error, result) {\n        // We should not swallow an error if it is present.\n        if (error == null && result != null) {\n            return callback(undefined, result);\n        }\n        if (options != null && 'noResponse' in options && options.noResponse === true) {\n            return callback(undefined, null);\n        }\n        if (!error) {\n            return callback(new error_1.MongoUnexpectedServerResponseError('Empty response with no error'));\n        }\n        if (!(error instanceof error_1.MongoError)) {\n            // Node.js or some other error we have not special handling for\n            return callback(error);\n        }\n        if (connectionIsStale(server.pool, connection)) {\n            return callback(error);\n        }\n        if (error instanceof error_1.MongoNetworkError) {\n            if (session && !session.hasEnded && session.serverSession) {\n                session.serverSession.isDirty = true;\n            }\n            // inActiveTransaction check handles commit and abort.\n            if (inActiveTransaction(session, cmd) &&\n                !error.hasErrorLabel(error_1.MongoErrorLabel.TransientTransactionError)) {\n                error.addErrorLabel(error_1.MongoErrorLabel.TransientTransactionError);\n            }\n            if ((isRetryableWritesEnabled(server.topology) || (0, transactions_1.isTransactionCommand)(cmd)) &&\n                (0, utils_1.supportsRetryableWrites)(server) &&\n                !inActiveTransaction(session, cmd)) {\n                error.addErrorLabel(error_1.MongoErrorLabel.RetryableWriteError);\n            }\n        }\n        else {\n            if ((isRetryableWritesEnabled(server.topology) || (0, transactions_1.isTransactionCommand)(cmd)) &&\n                (0, error_1.needsRetryableWriteLabel)(error, (0, utils_1.maxWireVersion)(server)) &&\n                !inActiveTransaction(session, cmd)) {\n                error.addErrorLabel(error_1.MongoErrorLabel.RetryableWriteError);\n            }\n        }\n        if (session &&\n            session.isPinned &&\n            error.hasErrorLabel(error_1.MongoErrorLabel.TransientTransactionError)) {\n            session.unpin({ force: true });\n        }\n        server.handleError(error, connection);\n        return callback(error);\n    };\n}\n//# sourceMappingURL=server.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9zZGFtL3NlcnZlci5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxjQUFjO0FBQ2QsZUFBZSxtQkFBTyxDQUFDLGtCQUFNO0FBQzdCLHFCQUFxQixtQkFBTyxDQUFDLHVGQUFvQjtBQUNqRCwwQkFBMEIsbUJBQU8sQ0FBQyxpR0FBeUI7QUFDM0QsaUJBQWlCLG1CQUFPLENBQUMsK0VBQWdCO0FBQ3pDLG9CQUFvQixtQkFBTyxDQUFDLDJFQUFjO0FBQzFDLGdCQUFnQixtQkFBTyxDQUFDLG1FQUFVO0FBQ2xDLHNCQUFzQixtQkFBTyxDQUFDLCtFQUFnQjtBQUM5Qyx1QkFBdUIsbUJBQU8sQ0FBQyxpRkFBaUI7QUFDaEQsZ0JBQWdCLG1CQUFPLENBQUMsbUVBQVU7QUFDbEMsaUJBQWlCLG1CQUFPLENBQUMseUVBQVU7QUFDbkMsa0JBQWtCLG1CQUFPLENBQUMsMkVBQVc7QUFDckMsNkJBQTZCLG1CQUFPLENBQUMsaUdBQXNCO0FBQzNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhCQUE4QjtBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCO0FBQ3hCO0FBQ0Esa0NBQWtDLElBQUksY0FBYztBQUNwRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkNBQTZDLGFBQWEsNEJBQTRCO0FBQ3RGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0MsaUNBQWlDO0FBQ25FO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMENBQTBDLGlDQUFpQztBQUMzRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUlBQXFJLE9BQU87QUFDNUk7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsYUFBYTtBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIkQ6XFxzYWxvbmlcXGFwcHJhaXNhbC1zeXN0ZW1cXHNlcnZlclxcbm9kZV9tb2R1bGVzXFxtb25nb2RiXFxsaWJcXHNkYW1cXHNlcnZlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuU2VydmVyID0gdm9pZCAwO1xuY29uc3QgdXRpbF8xID0gcmVxdWlyZShcInV0aWxcIik7XG5jb25zdCBjb25uZWN0aW9uXzEgPSByZXF1aXJlKFwiLi4vY21hcC9jb25uZWN0aW9uXCIpO1xuY29uc3QgY29ubmVjdGlvbl9wb29sXzEgPSByZXF1aXJlKFwiLi4vY21hcC9jb25uZWN0aW9uX3Bvb2xcIik7XG5jb25zdCBlcnJvcnNfMSA9IHJlcXVpcmUoXCIuLi9jbWFwL2Vycm9yc1wiKTtcbmNvbnN0IGNvbnN0YW50c18xID0gcmVxdWlyZShcIi4uL2NvbnN0YW50c1wiKTtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi4vZXJyb3JcIik7XG5jb25zdCBtb25nb190eXBlc18xID0gcmVxdWlyZShcIi4uL21vbmdvX3R5cGVzXCIpO1xuY29uc3QgdHJhbnNhY3Rpb25zXzEgPSByZXF1aXJlKFwiLi4vdHJhbnNhY3Rpb25zXCIpO1xuY29uc3QgdXRpbHNfMSA9IHJlcXVpcmUoXCIuLi91dGlsc1wiKTtcbmNvbnN0IGNvbW1vbl8xID0gcmVxdWlyZShcIi4vY29tbW9uXCIpO1xuY29uc3QgbW9uaXRvcl8xID0gcmVxdWlyZShcIi4vbW9uaXRvclwiKTtcbmNvbnN0IHNlcnZlcl9kZXNjcmlwdGlvbl8xID0gcmVxdWlyZShcIi4vc2VydmVyX2Rlc2NyaXB0aW9uXCIpO1xuY29uc3Qgc3RhdGVUcmFuc2l0aW9uID0gKDAsIHV0aWxzXzEubWFrZVN0YXRlTWFjaGluZSkoe1xuICAgIFtjb21tb25fMS5TVEFURV9DTE9TRURdOiBbY29tbW9uXzEuU1RBVEVfQ0xPU0VELCBjb21tb25fMS5TVEFURV9DT05ORUNUSU5HXSxcbiAgICBbY29tbW9uXzEuU1RBVEVfQ09OTkVDVElOR106IFtjb21tb25fMS5TVEFURV9DT05ORUNUSU5HLCBjb21tb25fMS5TVEFURV9DTE9TSU5HLCBjb21tb25fMS5TVEFURV9DT05ORUNURUQsIGNvbW1vbl8xLlNUQVRFX0NMT1NFRF0sXG4gICAgW2NvbW1vbl8xLlNUQVRFX0NPTk5FQ1RFRF06IFtjb21tb25fMS5TVEFURV9DT05ORUNURUQsIGNvbW1vbl8xLlNUQVRFX0NMT1NJTkcsIGNvbW1vbl8xLlNUQVRFX0NMT1NFRF0sXG4gICAgW2NvbW1vbl8xLlNUQVRFX0NMT1NJTkddOiBbY29tbW9uXzEuU1RBVEVfQ0xPU0lORywgY29tbW9uXzEuU1RBVEVfQ0xPU0VEXVxufSk7XG4vKiogQGludGVybmFsICovXG5jbGFzcyBTZXJ2ZXIgZXh0ZW5kcyBtb25nb190eXBlc18xLlR5cGVkRXZlbnRFbWl0dGVyIHtcbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBzZXJ2ZXJcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3Rvcih0b3BvbG9neSwgZGVzY3JpcHRpb24sIG9wdGlvbnMpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5jb21tYW5kQXN5bmMgPSAoMCwgdXRpbF8xLnByb21pc2lmeSkoKG5zLCBjbWQsIG9wdGlvbnMsIFxuICAgICAgICAvLyBjYWxsYmFjayB0eXBlIGRlZmluZXMgRG9jdW1lbnQgcmVzdWx0IGJlY2F1c2UgcmVzdWx0IGlzIG5ldmVyIG51bGxpc2ggd2hlbiBpdCBzdWNjZWVkcywgb3RoZXJ3aXNlIHByb21pc2UgcmVqZWN0c1xuICAgICAgICBjYWxsYmFjaykgPT4gdGhpcy5jb21tYW5kKG5zLCBjbWQsIG9wdGlvbnMsIGNhbGxiYWNrKSk7XG4gICAgICAgIHRoaXMuc2VydmVyQXBpID0gb3B0aW9ucy5zZXJ2ZXJBcGk7XG4gICAgICAgIGNvbnN0IHBvb2xPcHRpb25zID0geyBob3N0QWRkcmVzczogZGVzY3JpcHRpb24uaG9zdEFkZHJlc3MsIC4uLm9wdGlvbnMgfTtcbiAgICAgICAgdGhpcy50b3BvbG9neSA9IHRvcG9sb2d5O1xuICAgICAgICB0aGlzLnBvb2wgPSBuZXcgY29ubmVjdGlvbl9wb29sXzEuQ29ubmVjdGlvblBvb2wodGhpcywgcG9vbE9wdGlvbnMpO1xuICAgICAgICB0aGlzLnMgPSB7XG4gICAgICAgICAgICBkZXNjcmlwdGlvbixcbiAgICAgICAgICAgIG9wdGlvbnMsXG4gICAgICAgICAgICBzdGF0ZTogY29tbW9uXzEuU1RBVEVfQ0xPU0VELFxuICAgICAgICAgICAgb3BlcmF0aW9uQ291bnQ6IDBcbiAgICAgICAgfTtcbiAgICAgICAgZm9yIChjb25zdCBldmVudCBvZiBbLi4uY29uc3RhbnRzXzEuQ01BUF9FVkVOVFMsIC4uLmNvbnN0YW50c18xLkFQTV9FVkVOVFNdKSB7XG4gICAgICAgICAgICB0aGlzLnBvb2wub24oZXZlbnQsIChlKSA9PiB0aGlzLmVtaXQoZXZlbnQsIGUpKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnBvb2wub24oY29ubmVjdGlvbl8xLkNvbm5lY3Rpb24uQ0xVU1RFUl9USU1FX1JFQ0VJVkVELCAoY2x1c3RlclRpbWUpID0+IHtcbiAgICAgICAgICAgIHRoaXMuY2x1c3RlclRpbWUgPSBjbHVzdGVyVGltZTtcbiAgICAgICAgfSk7XG4gICAgICAgIGlmICh0aGlzLmxvYWRCYWxhbmNlZCkge1xuICAgICAgICAgICAgdGhpcy5tb25pdG9yID0gbnVsbDtcbiAgICAgICAgICAgIC8vIG1vbml0b3JpbmcgaXMgZGlzYWJsZWQgaW4gbG9hZCBiYWxhbmNpbmcgbW9kZVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIGNyZWF0ZSB0aGUgbW9uaXRvclxuICAgICAgICAvLyBUT0RPKE5PREUtNDE0NCk6IFJlbW92ZSBuZXcgdmFyaWFibGUgZm9yIHR5cGUgbmFycm93aW5nXG4gICAgICAgIHRoaXMubW9uaXRvciA9IG5ldyBtb25pdG9yXzEuTW9uaXRvcih0aGlzLCB0aGlzLnMub3B0aW9ucyk7XG4gICAgICAgIGZvciAoY29uc3QgZXZlbnQgb2YgY29uc3RhbnRzXzEuSEVBUlRCRUFUX0VWRU5UUykge1xuICAgICAgICAgICAgdGhpcy5tb25pdG9yLm9uKGV2ZW50LCAoZSkgPT4gdGhpcy5lbWl0KGV2ZW50LCBlKSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5tb25pdG9yLm9uKCdyZXNldFNlcnZlcicsIChlcnJvcikgPT4gbWFya1NlcnZlclVua25vd24odGhpcywgZXJyb3IpKTtcbiAgICAgICAgdGhpcy5tb25pdG9yLm9uKFNlcnZlci5TRVJWRVJfSEVBUlRCRUFUX1NVQ0NFRURFRCwgKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICB0aGlzLmVtaXQoU2VydmVyLkRFU0NSSVBUSU9OX1JFQ0VJVkVELCBuZXcgc2VydmVyX2Rlc2NyaXB0aW9uXzEuU2VydmVyRGVzY3JpcHRpb24odGhpcy5kZXNjcmlwdGlvbi5ob3N0QWRkcmVzcywgZXZlbnQucmVwbHksIHtcbiAgICAgICAgICAgICAgICByb3VuZFRyaXBUaW1lOiBjYWxjdWxhdGVSb3VuZFRyaXBUaW1lKHRoaXMuZGVzY3JpcHRpb24ucm91bmRUcmlwVGltZSwgZXZlbnQuZHVyYXRpb24pXG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICBpZiAodGhpcy5zLnN0YXRlID09PSBjb21tb25fMS5TVEFURV9DT05ORUNUSU5HKSB7XG4gICAgICAgICAgICAgICAgc3RhdGVUcmFuc2l0aW9uKHRoaXMsIGNvbW1vbl8xLlNUQVRFX0NPTk5FQ1RFRCk7XG4gICAgICAgICAgICAgICAgdGhpcy5lbWl0KFNlcnZlci5DT05ORUNULCB0aGlzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGdldCBjbHVzdGVyVGltZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudG9wb2xvZ3kuY2x1c3RlclRpbWU7XG4gICAgfVxuICAgIHNldCBjbHVzdGVyVGltZShjbHVzdGVyVGltZSkge1xuICAgICAgICB0aGlzLnRvcG9sb2d5LmNsdXN0ZXJUaW1lID0gY2x1c3RlclRpbWU7XG4gICAgfVxuICAgIGdldCBkZXNjcmlwdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucy5kZXNjcmlwdGlvbjtcbiAgICB9XG4gICAgZ2V0IG5hbWUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnMuZGVzY3JpcHRpb24uYWRkcmVzcztcbiAgICB9XG4gICAgZ2V0IGF1dG9FbmNyeXB0ZXIoKSB7XG4gICAgICAgIGlmICh0aGlzLnMub3B0aW9ucyAmJiB0aGlzLnMub3B0aW9ucy5hdXRvRW5jcnlwdGVyKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zLm9wdGlvbnMuYXV0b0VuY3J5cHRlcjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGdldCBsb2FkQmFsYW5jZWQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnRvcG9sb2d5LmRlc2NyaXB0aW9uLnR5cGUgPT09IGNvbW1vbl8xLlRvcG9sb2d5VHlwZS5Mb2FkQmFsYW5jZWQ7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEluaXRpYXRlIHNlcnZlciBjb25uZWN0XG4gICAgICovXG4gICAgY29ubmVjdCgpIHtcbiAgICAgICAgaWYgKHRoaXMucy5zdGF0ZSAhPT0gY29tbW9uXzEuU1RBVEVfQ0xPU0VEKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgc3RhdGVUcmFuc2l0aW9uKHRoaXMsIGNvbW1vbl8xLlNUQVRFX0NPTk5FQ1RJTkcpO1xuICAgICAgICAvLyBJZiBpbiBsb2FkIGJhbGFuY2VyIG1vZGUgd2UgYXV0b21hdGljYWxseSBzZXQgdGhlIHNlcnZlciB0b1xuICAgICAgICAvLyBhIGxvYWQgYmFsYW5jZXIuIEl0IG5ldmVyIHRyYW5zaXRpb25zIG91dCBvZiB0aGlzIHN0YXRlIGFuZFxuICAgICAgICAvLyBoYXMgbm8gbW9uaXRvci5cbiAgICAgICAgaWYgKCF0aGlzLmxvYWRCYWxhbmNlZCkge1xuICAgICAgICAgICAgdGhpcy5tb25pdG9yPy5jb25uZWN0KCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBzdGF0ZVRyYW5zaXRpb24odGhpcywgY29tbW9uXzEuU1RBVEVfQ09OTkVDVEVEKTtcbiAgICAgICAgICAgIHRoaXMuZW1pdChTZXJ2ZXIuQ09OTkVDVCwgdGhpcyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqIERlc3Ryb3kgdGhlIHNlcnZlciBjb25uZWN0aW9uICovXG4gICAgZGVzdHJveShvcHRpb25zLCBjYWxsYmFjaykge1xuICAgICAgICBpZiAodHlwZW9mIG9wdGlvbnMgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIGNhbGxiYWNrID0gb3B0aW9ucztcbiAgICAgICAgICAgIG9wdGlvbnMgPSB7IGZvcmNlOiBmYWxzZSB9O1xuICAgICAgICB9XG4gICAgICAgIG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHt9LCB7IGZvcmNlOiBmYWxzZSB9LCBvcHRpb25zKTtcbiAgICAgICAgaWYgKHRoaXMucy5zdGF0ZSA9PT0gY29tbW9uXzEuU1RBVEVfQ0xPU0VEKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIGNhbGxiYWNrID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBzdGF0ZVRyYW5zaXRpb24odGhpcywgY29tbW9uXzEuU1RBVEVfQ0xPU0lORyk7XG4gICAgICAgIGlmICghdGhpcy5sb2FkQmFsYW5jZWQpIHtcbiAgICAgICAgICAgIHRoaXMubW9uaXRvcj8uY2xvc2UoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnBvb2wuY2xvc2Uob3B0aW9ucywgZXJyID0+IHtcbiAgICAgICAgICAgIHN0YXRlVHJhbnNpdGlvbih0aGlzLCBjb21tb25fMS5TVEFURV9DTE9TRUQpO1xuICAgICAgICAgICAgdGhpcy5lbWl0KCdjbG9zZWQnKTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogSW1tZWRpYXRlbHkgc2NoZWR1bGUgbW9uaXRvcmluZyBvZiB0aGlzIHNlcnZlci4gSWYgdGhlcmUgYWxyZWFkeSBhbiBhdHRlbXB0IGJlaW5nIG1hZGVcbiAgICAgKiB0aGlzIHdpbGwgYmUgYSBuby1vcC5cbiAgICAgKi9cbiAgICByZXF1ZXN0Q2hlY2soKSB7XG4gICAgICAgIGlmICghdGhpcy5sb2FkQmFsYW5jZWQpIHtcbiAgICAgICAgICAgIHRoaXMubW9uaXRvcj8ucmVxdWVzdENoZWNrKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogRXhlY3V0ZSBhIGNvbW1hbmRcbiAgICAgKiBAaW50ZXJuYWxcbiAgICAgKi9cbiAgICBjb21tYW5kKG5zLCBjbWQsIG9wdGlvbnMsIGNhbGxiYWNrKSB7XG4gICAgICAgIGlmIChjYWxsYmFjayA9PSBudWxsKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdDYWxsYmFjayBtdXN0IGJlIHByb3ZpZGVkJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5zLmRiID09IG51bGwgfHwgdHlwZW9mIG5zID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignTmFtZXNwYWNlIG11c3Qgbm90IGJlIGEgc3RyaW5nJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMucy5zdGF0ZSA9PT0gY29tbW9uXzEuU1RBVEVfQ0xPU0lORyB8fCB0aGlzLnMuc3RhdGUgPT09IGNvbW1vbl8xLlNUQVRFX0NMT1NFRCkge1xuICAgICAgICAgICAgY2FsbGJhY2sobmV3IGVycm9yXzEuTW9uZ29TZXJ2ZXJDbG9zZWRFcnJvcigpKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyBDbG9uZSB0aGUgb3B0aW9uc1xuICAgICAgICBjb25zdCBmaW5hbE9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHt9LCBvcHRpb25zLCB7IHdpcmVQcm90b2NvbENvbW1hbmQ6IGZhbHNlIH0pO1xuICAgICAgICAvLyBUaGVyZSBhcmUgY2FzZXMgd2hlcmUgd2UgbmVlZCB0byBmbGFnIHRoZSByZWFkIHByZWZlcmVuY2Ugbm90IHRvIGdldCBzZW50IGluXG4gICAgICAgIC8vIHRoZSBjb21tYW5kLCBzdWNoIGFzIHByZS01LjAgc2VydmVycyBhdHRlbXB0aW5nIHRvIHBlcmZvcm0gYW4gYWdncmVnYXRlIHdyaXRlXG4gICAgICAgIC8vIHdpdGggYSBub24tcHJpbWFyeSByZWFkIHByZWZlcmVuY2UuIEluIHRoaXMgY2FzZSB0aGUgZWZmZWN0aXZlIHJlYWQgcHJlZmVyZW5jZVxuICAgICAgICAvLyAocHJpbWFyeSkgaXMgbm90IHRoZSBzYW1lIGFzIHRoZSBwcm92aWRlZCBhbmQgbXVzdCBiZSByZW1vdmVkIGNvbXBsZXRlbHkuXG4gICAgICAgIGlmIChmaW5hbE9wdGlvbnMub21pdFJlYWRQcmVmZXJlbmNlKSB7XG4gICAgICAgICAgICBkZWxldGUgZmluYWxPcHRpb25zLnJlYWRQcmVmZXJlbmNlO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHNlc3Npb24gPSBmaW5hbE9wdGlvbnMuc2Vzc2lvbjtcbiAgICAgICAgY29uc3QgY29ubiA9IHNlc3Npb24/LnBpbm5lZENvbm5lY3Rpb247XG4gICAgICAgIC8vIE5PVEU6IFRoaXMgaXMgYSBoYWNrISBXZSBjYW4ndCByZXRyaWV2ZSB0aGUgY29ubmVjdGlvbnMgdXNlZCBmb3IgZXhlY3V0aW5nIGFuIG9wZXJhdGlvblxuICAgICAgICAvLyAgICAgICAoYW5kIHByZXZlbnQgdGhlbSBmcm9tIGJlaW5nIGNoZWNrZWQgYmFjayBpbikgYXQgdGhlIHBvaW50IG9mIG9wZXJhdGlvbiBleGVjdXRpb24uXG4gICAgICAgIC8vICAgICAgIFRoaXMgc2hvdWxkIGJlIGNvbnNpZGVyZWQgYXMgcGFydCBvZiB0aGUgd29yayBmb3IgTk9ERS0yODgyXG4gICAgICAgIC8vIE5PVEU6XG4gICAgICAgIC8vICAgICAgIFdoZW4gaW5jcmVtZW50aW5nIG9wZXJhdGlvbiBjb3VudCwgaXQncyBpbXBvcnRhbnQgdGhhdCB3ZSBpbmNyZW1lbnQgaXQgYmVmb3JlIHdlXG4gICAgICAgIC8vICAgICAgIGF0dGVtcHQgdG8gY2hlY2sgb3V0IGEgY29ubmVjdGlvbiBmcm9tIHRoZSBwb29sLiAgVGhpcyBlbnN1cmVzIHRoYXQgb3BlcmF0aW9ucyB0aGF0XG4gICAgICAgIC8vICAgICAgIGFyZSB3YWl0aW5nIGZvciBhIGNvbm5lY3Rpb24gYXJlIGluY2x1ZGVkIGluIHRoZSBvcGVyYXRpb24gY291bnQuICBMb2FkIGJhbGFuY2VkXG4gICAgICAgIC8vICAgICAgIG1vZGUgd2lsbCBvbmx5IGV2ZXIgaGF2ZSBhIHNpbmdsZSBzZXJ2ZXIsIHNvIHRoZSBvcGVyYXRpb24gY291bnQgZG9lc24ndCBtYXR0ZXIuXG4gICAgICAgIC8vICAgICAgIEluY3JlbWVudGluZyB0aGUgb3BlcmF0aW9uIGNvdW50IGFib3ZlIHRoZSBsb2dpYyB0byBoYW5kbGUgbG9hZCBiYWxhbmNlZCBtb2RlIHdvdWxkXG4gICAgICAgIC8vICAgICAgIHJlcXVpcmUgc3BlY2lhbCBsb2dpYyB0byBkZWNyZW1lbnQgaXQgYWdhaW4sIG9yIHdvdWxkIGRvdWJsZSBpbmNyZW1lbnQgKHRoZSBsb2FkXG4gICAgICAgIC8vICAgICAgIGJhbGFuY2VkIGNvZGUgbWFrZXMgYSByZWN1cnNpdmUgY2FsbCkuICBJbnN0ZWFkLCB3ZSBpbmNyZW1lbnQgdGhlIGNvdW50IGFmdGVyIHRoaXNcbiAgICAgICAgLy8gICAgICAgY2hlY2suXG4gICAgICAgIGlmICh0aGlzLmxvYWRCYWxhbmNlZCAmJiBzZXNzaW9uICYmIGNvbm4gPT0gbnVsbCAmJiBpc1Bpbm5hYmxlQ29tbWFuZChjbWQsIHNlc3Npb24pKSB7XG4gICAgICAgICAgICB0aGlzLnBvb2wuY2hlY2tPdXQoKGVyciwgY2hlY2tlZE91dCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChlcnIgfHwgY2hlY2tlZE91dCA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaylcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHNlc3Npb24ucGluKGNoZWNrZWRPdXQpO1xuICAgICAgICAgICAgICAgIHRoaXMuY29tbWFuZChucywgY21kLCBmaW5hbE9wdGlvbnMsIGNhbGxiYWNrKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuaW5jcmVtZW50T3BlcmF0aW9uQ291bnQoKTtcbiAgICAgICAgdGhpcy5wb29sLndpdGhDb25uZWN0aW9uKGNvbm4sIChlcnIsIGNvbm4sIGNiKSA9PiB7XG4gICAgICAgICAgICBpZiAoZXJyIHx8ICFjb25uKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kZWNyZW1lbnRPcGVyYXRpb25Db3VudCgpO1xuICAgICAgICAgICAgICAgIGlmICghZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjYihuZXcgZXJyb3JfMS5Nb25nb1J1bnRpbWVFcnJvcignRmFpbGVkIHRvIGNyZWF0ZSBjb25uZWN0aW9uIHdpdGhvdXQgZXJyb3InKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICghKGVyciBpbnN0YW5jZW9mIGVycm9yc18xLlBvb2xDbGVhcmVkRXJyb3IpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlRXJyb3IoZXJyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNiKGVycik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25uLmNvbW1hbmQobnMsIGNtZCwgZmluYWxPcHRpb25zLCBtYWtlT3BlcmF0aW9uSGFuZGxlcih0aGlzLCBjb25uLCBjbWQsIGZpbmFsT3B0aW9ucywgKGVycm9yLCByZXNwb25zZSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuZGVjcmVtZW50T3BlcmF0aW9uQ291bnQoKTtcbiAgICAgICAgICAgICAgICBjYihlcnJvciwgcmVzcG9uc2UpO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9LCBjYWxsYmFjayk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEhhbmRsZSBTREFNIGVycm9yXG4gICAgICogQGludGVybmFsXG4gICAgICovXG4gICAgaGFuZGxlRXJyb3IoZXJyb3IsIGNvbm5lY3Rpb24pIHtcbiAgICAgICAgaWYgKCEoZXJyb3IgaW5zdGFuY2VvZiBlcnJvcl8xLk1vbmdvRXJyb3IpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaXNTdGFsZUVycm9yID0gZXJyb3IuY29ubmVjdGlvbkdlbmVyYXRpb24gJiYgZXJyb3IuY29ubmVjdGlvbkdlbmVyYXRpb24gPCB0aGlzLnBvb2wuZ2VuZXJhdGlvbjtcbiAgICAgICAgaWYgKGlzU3RhbGVFcnJvcikge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGlzTmV0d29ya05vblRpbWVvdXRFcnJvciA9IGVycm9yIGluc3RhbmNlb2YgZXJyb3JfMS5Nb25nb05ldHdvcmtFcnJvciAmJiAhKGVycm9yIGluc3RhbmNlb2YgZXJyb3JfMS5Nb25nb05ldHdvcmtUaW1lb3V0RXJyb3IpO1xuICAgICAgICBjb25zdCBpc05ldHdvcmtUaW1lb3V0QmVmb3JlSGFuZHNoYWtlRXJyb3IgPSAoMCwgZXJyb3JfMS5pc05ldHdvcmtFcnJvckJlZm9yZUhhbmRzaGFrZSkoZXJyb3IpO1xuICAgICAgICBjb25zdCBpc0F1dGhIYW5kc2hha2VFcnJvciA9IGVycm9yLmhhc0Vycm9yTGFiZWwoZXJyb3JfMS5Nb25nb0Vycm9yTGFiZWwuSGFuZHNoYWtlRXJyb3IpO1xuICAgICAgICBpZiAoaXNOZXR3b3JrTm9uVGltZW91dEVycm9yIHx8IGlzTmV0d29ya1RpbWVvdXRCZWZvcmVIYW5kc2hha2VFcnJvciB8fCBpc0F1dGhIYW5kc2hha2VFcnJvcikge1xuICAgICAgICAgICAgLy8gSW4gbG9hZCBiYWxhbmNlZCBtb2RlIHdlIG5ldmVyIG1hcmsgdGhlIHNlcnZlciBhcyB1bmtub3duIGFuZCBhbHdheXNcbiAgICAgICAgICAgIC8vIGNsZWFyIGZvciB0aGUgc3BlY2lmaWMgc2VydmljZSBpZC5cbiAgICAgICAgICAgIGlmICghdGhpcy5sb2FkQmFsYW5jZWQpIHtcbiAgICAgICAgICAgICAgICBlcnJvci5hZGRFcnJvckxhYmVsKGVycm9yXzEuTW9uZ29FcnJvckxhYmVsLlJlc2V0UG9vbCk7XG4gICAgICAgICAgICAgICAgbWFya1NlcnZlclVua25vd24odGhpcywgZXJyb3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoY29ubmVjdGlvbikge1xuICAgICAgICAgICAgICAgIHRoaXMucG9vbC5jbGVhcih7IHNlcnZpY2VJZDogY29ubmVjdGlvbi5zZXJ2aWNlSWQgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpZiAoKDAsIGVycm9yXzEuaXNTREFNVW5yZWNvdmVyYWJsZUVycm9yKShlcnJvcikpIHtcbiAgICAgICAgICAgICAgICBpZiAoc2hvdWxkSGFuZGxlU3RhdGVDaGFuZ2VFcnJvcih0aGlzLCBlcnJvcikpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2hvdWxkQ2xlYXJQb29sID0gKDAsIHV0aWxzXzEubWF4V2lyZVZlcnNpb24pKHRoaXMpIDw9IDcgfHwgKDAsIGVycm9yXzEuaXNOb2RlU2h1dHRpbmdEb3duRXJyb3IpKGVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMubG9hZEJhbGFuY2VkICYmIGNvbm5lY3Rpb24gJiYgc2hvdWxkQ2xlYXJQb29sKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBvb2wuY2xlYXIoeyBzZXJ2aWNlSWQ6IGNvbm5lY3Rpb24uc2VydmljZUlkIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5sb2FkQmFsYW5jZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzaG91bGRDbGVhclBvb2wpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvci5hZGRFcnJvckxhYmVsKGVycm9yXzEuTW9uZ29FcnJvckxhYmVsLlJlc2V0UG9vbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBtYXJrU2VydmVyVW5rbm93bih0aGlzLCBlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzLm5leHRUaWNrKCgpID0+IHRoaXMucmVxdWVzdENoZWNrKCkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIERlY3JlbWVudCB0aGUgb3BlcmF0aW9uIGNvdW50LCByZXR1cm5pbmcgdGhlIG5ldyBjb3VudC5cbiAgICAgKi9cbiAgICBkZWNyZW1lbnRPcGVyYXRpb25Db3VudCgpIHtcbiAgICAgICAgcmV0dXJuICh0aGlzLnMub3BlcmF0aW9uQ291bnQgLT0gMSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEluY3JlbWVudCB0aGUgb3BlcmF0aW9uIGNvdW50LCByZXR1cm5pbmcgdGhlIG5ldyBjb3VudC5cbiAgICAgKi9cbiAgICBpbmNyZW1lbnRPcGVyYXRpb25Db3VudCgpIHtcbiAgICAgICAgcmV0dXJuICh0aGlzLnMub3BlcmF0aW9uQ291bnQgKz0gMSk7XG4gICAgfVxufVxuLyoqIEBldmVudCAqL1xuU2VydmVyLlNFUlZFUl9IRUFSVEJFQVRfU1RBUlRFRCA9IGNvbnN0YW50c18xLlNFUlZFUl9IRUFSVEJFQVRfU1RBUlRFRDtcbi8qKiBAZXZlbnQgKi9cblNlcnZlci5TRVJWRVJfSEVBUlRCRUFUX1NVQ0NFRURFRCA9IGNvbnN0YW50c18xLlNFUlZFUl9IRUFSVEJFQVRfU1VDQ0VFREVEO1xuLyoqIEBldmVudCAqL1xuU2VydmVyLlNFUlZFUl9IRUFSVEJFQVRfRkFJTEVEID0gY29uc3RhbnRzXzEuU0VSVkVSX0hFQVJUQkVBVF9GQUlMRUQ7XG4vKiogQGV2ZW50ICovXG5TZXJ2ZXIuQ09OTkVDVCA9IGNvbnN0YW50c18xLkNPTk5FQ1Q7XG4vKiogQGV2ZW50ICovXG5TZXJ2ZXIuREVTQ1JJUFRJT05fUkVDRUlWRUQgPSBjb25zdGFudHNfMS5ERVNDUklQVElPTl9SRUNFSVZFRDtcbi8qKiBAZXZlbnQgKi9cblNlcnZlci5DTE9TRUQgPSBjb25zdGFudHNfMS5DTE9TRUQ7XG4vKiogQGV2ZW50ICovXG5TZXJ2ZXIuRU5ERUQgPSBjb25zdGFudHNfMS5FTkRFRDtcbmV4cG9ydHMuU2VydmVyID0gU2VydmVyO1xuZnVuY3Rpb24gY2FsY3VsYXRlUm91bmRUcmlwVGltZShvbGRSdHQsIGR1cmF0aW9uKSB7XG4gICAgaWYgKG9sZFJ0dCA9PT0gLTEpIHtcbiAgICAgICAgcmV0dXJuIGR1cmF0aW9uO1xuICAgIH1cbiAgICBjb25zdCBhbHBoYSA9IDAuMjtcbiAgICByZXR1cm4gYWxwaGEgKiBkdXJhdGlvbiArICgxIC0gYWxwaGEpICogb2xkUnR0O1xufVxuZnVuY3Rpb24gbWFya1NlcnZlclVua25vd24oc2VydmVyLCBlcnJvcikge1xuICAgIC8vIExvYWQgYmFsYW5jZXIgc2VydmVycyBjYW4gbmV2ZXIgYmUgbWFya2VkIHVua25vd24uXG4gICAgaWYgKHNlcnZlci5sb2FkQmFsYW5jZWQpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBlcnJvcl8xLk1vbmdvTmV0d29ya0Vycm9yICYmICEoZXJyb3IgaW5zdGFuY2VvZiBlcnJvcl8xLk1vbmdvTmV0d29ya1RpbWVvdXRFcnJvcikpIHtcbiAgICAgICAgc2VydmVyLm1vbml0b3I/LnJlc2V0KCk7XG4gICAgfVxuICAgIHNlcnZlci5lbWl0KFNlcnZlci5ERVNDUklQVElPTl9SRUNFSVZFRCwgbmV3IHNlcnZlcl9kZXNjcmlwdGlvbl8xLlNlcnZlckRlc2NyaXB0aW9uKHNlcnZlci5kZXNjcmlwdGlvbi5ob3N0QWRkcmVzcywgdW5kZWZpbmVkLCB7IGVycm9yIH0pKTtcbn1cbmZ1bmN0aW9uIGlzUGlubmFibGVDb21tYW5kKGNtZCwgc2Vzc2lvbikge1xuICAgIGlmIChzZXNzaW9uKSB7XG4gICAgICAgIHJldHVybiAoc2Vzc2lvbi5pblRyYW5zYWN0aW9uKCkgfHxcbiAgICAgICAgICAgICdhZ2dyZWdhdGUnIGluIGNtZCB8fFxuICAgICAgICAgICAgJ2ZpbmQnIGluIGNtZCB8fFxuICAgICAgICAgICAgJ2dldE1vcmUnIGluIGNtZCB8fFxuICAgICAgICAgICAgJ2xpc3RDb2xsZWN0aW9ucycgaW4gY21kIHx8XG4gICAgICAgICAgICAnbGlzdEluZGV4ZXMnIGluIGNtZCk7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbn1cbmZ1bmN0aW9uIGNvbm5lY3Rpb25Jc1N0YWxlKHBvb2wsIGNvbm5lY3Rpb24pIHtcbiAgICBpZiAoY29ubmVjdGlvbi5zZXJ2aWNlSWQpIHtcbiAgICAgICAgcmV0dXJuIChjb25uZWN0aW9uLmdlbmVyYXRpb24gIT09IHBvb2wuc2VydmljZUdlbmVyYXRpb25zLmdldChjb25uZWN0aW9uLnNlcnZpY2VJZC50b0hleFN0cmluZygpKSk7XG4gICAgfVxuICAgIHJldHVybiBjb25uZWN0aW9uLmdlbmVyYXRpb24gIT09IHBvb2wuZ2VuZXJhdGlvbjtcbn1cbmZ1bmN0aW9uIHNob3VsZEhhbmRsZVN0YXRlQ2hhbmdlRXJyb3Ioc2VydmVyLCBlcnIpIHtcbiAgICBjb25zdCBldHYgPSBlcnIudG9wb2xvZ3lWZXJzaW9uO1xuICAgIGNvbnN0IHN0diA9IHNlcnZlci5kZXNjcmlwdGlvbi50b3BvbG9neVZlcnNpb247XG4gICAgcmV0dXJuICgwLCBzZXJ2ZXJfZGVzY3JpcHRpb25fMS5jb21wYXJlVG9wb2xvZ3lWZXJzaW9uKShzdHYsIGV0dikgPCAwO1xufVxuZnVuY3Rpb24gaW5BY3RpdmVUcmFuc2FjdGlvbihzZXNzaW9uLCBjbWQpIHtcbiAgICByZXR1cm4gc2Vzc2lvbiAmJiBzZXNzaW9uLmluVHJhbnNhY3Rpb24oKSAmJiAhKDAsIHRyYW5zYWN0aW9uc18xLmlzVHJhbnNhY3Rpb25Db21tYW5kKShjbWQpO1xufVxuLyoqIHRoaXMgY2hlY2tzIHRoZSByZXRyeVdyaXRlcyBvcHRpb24gcGFzc2VkIGRvd24gZnJvbSB0aGUgY2xpZW50IG9wdGlvbnMsIGl0XG4gKiBkb2VzIG5vdCBjaGVjayBpZiB0aGUgc2VydmVyIHN1cHBvcnRzIHJldHJ5YWJsZSB3cml0ZXMgKi9cbmZ1bmN0aW9uIGlzUmV0cnlhYmxlV3JpdGVzRW5hYmxlZCh0b3BvbG9neSkge1xuICAgIHJldHVybiB0b3BvbG9neS5zLm9wdGlvbnMucmV0cnlXcml0ZXMgIT09IGZhbHNlO1xufVxuZnVuY3Rpb24gbWFrZU9wZXJhdGlvbkhhbmRsZXIoc2VydmVyLCBjb25uZWN0aW9uLCBjbWQsIG9wdGlvbnMsIGNhbGxiYWNrKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IG9wdGlvbnM/LnNlc3Npb247XG4gICAgcmV0dXJuIGZ1bmN0aW9uIGhhbmRsZU9wZXJhdGlvblJlc3VsdChlcnJvciwgcmVzdWx0KSB7XG4gICAgICAgIC8vIFdlIHNob3VsZCBub3Qgc3dhbGxvdyBhbiBlcnJvciBpZiBpdCBpcyBwcmVzZW50LlxuICAgICAgICBpZiAoZXJyb3IgPT0gbnVsbCAmJiByZXN1bHQgIT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKHVuZGVmaW5lZCwgcmVzdWx0KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAob3B0aW9ucyAhPSBudWxsICYmICdub1Jlc3BvbnNlJyBpbiBvcHRpb25zICYmIG9wdGlvbnMubm9SZXNwb25zZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKHVuZGVmaW5lZCwgbnVsbCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFlcnJvcikge1xuICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKG5ldyBlcnJvcl8xLk1vbmdvVW5leHBlY3RlZFNlcnZlclJlc3BvbnNlRXJyb3IoJ0VtcHR5IHJlc3BvbnNlIHdpdGggbm8gZXJyb3InKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCEoZXJyb3IgaW5zdGFuY2VvZiBlcnJvcl8xLk1vbmdvRXJyb3IpKSB7XG4gICAgICAgICAgICAvLyBOb2RlLmpzIG9yIHNvbWUgb3RoZXIgZXJyb3Igd2UgaGF2ZSBub3Qgc3BlY2lhbCBoYW5kbGluZyBmb3JcbiAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhlcnJvcik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbm5lY3Rpb25Jc1N0YWxlKHNlcnZlci5wb29sLCBjb25uZWN0aW9uKSkge1xuICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBlcnJvcl8xLk1vbmdvTmV0d29ya0Vycm9yKSB7XG4gICAgICAgICAgICBpZiAoc2Vzc2lvbiAmJiAhc2Vzc2lvbi5oYXNFbmRlZCAmJiBzZXNzaW9uLnNlcnZlclNlc3Npb24pIHtcbiAgICAgICAgICAgICAgICBzZXNzaW9uLnNlcnZlclNlc3Npb24uaXNEaXJ0eSA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBpbkFjdGl2ZVRyYW5zYWN0aW9uIGNoZWNrIGhhbmRsZXMgY29tbWl0IGFuZCBhYm9ydC5cbiAgICAgICAgICAgIGlmIChpbkFjdGl2ZVRyYW5zYWN0aW9uKHNlc3Npb24sIGNtZCkgJiZcbiAgICAgICAgICAgICAgICAhZXJyb3IuaGFzRXJyb3JMYWJlbChlcnJvcl8xLk1vbmdvRXJyb3JMYWJlbC5UcmFuc2llbnRUcmFuc2FjdGlvbkVycm9yKSkge1xuICAgICAgICAgICAgICAgIGVycm9yLmFkZEVycm9yTGFiZWwoZXJyb3JfMS5Nb25nb0Vycm9yTGFiZWwuVHJhbnNpZW50VHJhbnNhY3Rpb25FcnJvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoKGlzUmV0cnlhYmxlV3JpdGVzRW5hYmxlZChzZXJ2ZXIudG9wb2xvZ3kpIHx8ICgwLCB0cmFuc2FjdGlvbnNfMS5pc1RyYW5zYWN0aW9uQ29tbWFuZCkoY21kKSkgJiZcbiAgICAgICAgICAgICAgICAoMCwgdXRpbHNfMS5zdXBwb3J0c1JldHJ5YWJsZVdyaXRlcykoc2VydmVyKSAmJlxuICAgICAgICAgICAgICAgICFpbkFjdGl2ZVRyYW5zYWN0aW9uKHNlc3Npb24sIGNtZCkpIHtcbiAgICAgICAgICAgICAgICBlcnJvci5hZGRFcnJvckxhYmVsKGVycm9yXzEuTW9uZ29FcnJvckxhYmVsLlJldHJ5YWJsZVdyaXRlRXJyb3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKChpc1JldHJ5YWJsZVdyaXRlc0VuYWJsZWQoc2VydmVyLnRvcG9sb2d5KSB8fCAoMCwgdHJhbnNhY3Rpb25zXzEuaXNUcmFuc2FjdGlvbkNvbW1hbmQpKGNtZCkpICYmXG4gICAgICAgICAgICAgICAgKDAsIGVycm9yXzEubmVlZHNSZXRyeWFibGVXcml0ZUxhYmVsKShlcnJvciwgKDAsIHV0aWxzXzEubWF4V2lyZVZlcnNpb24pKHNlcnZlcikpICYmXG4gICAgICAgICAgICAgICAgIWluQWN0aXZlVHJhbnNhY3Rpb24oc2Vzc2lvbiwgY21kKSkge1xuICAgICAgICAgICAgICAgIGVycm9yLmFkZEVycm9yTGFiZWwoZXJyb3JfMS5Nb25nb0Vycm9yTGFiZWwuUmV0cnlhYmxlV3JpdGVFcnJvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNlc3Npb24gJiZcbiAgICAgICAgICAgIHNlc3Npb24uaXNQaW5uZWQgJiZcbiAgICAgICAgICAgIGVycm9yLmhhc0Vycm9yTGFiZWwoZXJyb3JfMS5Nb25nb0Vycm9yTGFiZWwuVHJhbnNpZW50VHJhbnNhY3Rpb25FcnJvcikpIHtcbiAgICAgICAgICAgIHNlc3Npb24udW5waW4oeyBmb3JjZTogdHJ1ZSB9KTtcbiAgICAgICAgfVxuICAgICAgICBzZXJ2ZXIuaGFuZGxlRXJyb3IoZXJyb3IsIGNvbm5lY3Rpb24pO1xuICAgICAgICByZXR1cm4gY2FsbGJhY2soZXJyb3IpO1xuICAgIH07XG59XG4vLyMgc291cmNlTWFwcGluZ1VSTD1zZXJ2ZXIuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/sdam/server.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/sdam/server_description.js":
/*!*********************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/sdam/server_description.js ***!
  \*********************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.compareTopologyVersion = exports.parseServerType = exports.ServerDescription = void 0;\nconst bson_1 = __webpack_require__(/*! ../bson */ \"(api)/../server/node_modules/mongodb/lib/bson.js\");\nconst error_1 = __webpack_require__(/*! ../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\nconst common_1 = __webpack_require__(/*! ./common */ \"(api)/../server/node_modules/mongodb/lib/sdam/common.js\");\nconst WRITABLE_SERVER_TYPES = new Set([\n    common_1.ServerType.RSPrimary,\n    common_1.ServerType.Standalone,\n    common_1.ServerType.Mongos,\n    common_1.ServerType.LoadBalancer\n]);\nconst DATA_BEARING_SERVER_TYPES = new Set([\n    common_1.ServerType.RSPrimary,\n    common_1.ServerType.RSSecondary,\n    common_1.ServerType.Mongos,\n    common_1.ServerType.Standalone,\n    common_1.ServerType.LoadBalancer\n]);\n/**\n * The client's view of a single server, based on the most recent hello outcome.\n *\n * Internal type, not meant to be directly instantiated\n * @public\n */\nclass ServerDescription {\n    /**\n     * Create a ServerDescription\n     * @internal\n     *\n     * @param address - The address of the server\n     * @param hello - An optional hello response for this server\n     */\n    constructor(address, hello, options = {}) {\n        if (address == null || address === '') {\n            throw new error_1.MongoRuntimeError('ServerDescription must be provided with a non-empty address');\n        }\n        this.address =\n            typeof address === 'string'\n                ? utils_1.HostAddress.fromString(address).toString() // Use HostAddress to normalize\n                : address.toString();\n        this.type = parseServerType(hello, options);\n        this.hosts = hello?.hosts?.map((host) => host.toLowerCase()) ?? [];\n        this.passives = hello?.passives?.map((host) => host.toLowerCase()) ?? [];\n        this.arbiters = hello?.arbiters?.map((host) => host.toLowerCase()) ?? [];\n        this.tags = hello?.tags ?? {};\n        this.minWireVersion = hello?.minWireVersion ?? 0;\n        this.maxWireVersion = hello?.maxWireVersion ?? 0;\n        this.roundTripTime = options?.roundTripTime ?? -1;\n        this.lastUpdateTime = (0, utils_1.now)();\n        this.lastWriteDate = hello?.lastWrite?.lastWriteDate ?? 0;\n        this.error = options.error ?? null;\n        // TODO(NODE-2674): Preserve int64 sent from MongoDB\n        this.topologyVersion = this.error?.topologyVersion ?? hello?.topologyVersion ?? null;\n        this.setName = hello?.setName ?? null;\n        this.setVersion = hello?.setVersion ?? null;\n        this.electionId = hello?.electionId ?? null;\n        this.logicalSessionTimeoutMinutes = hello?.logicalSessionTimeoutMinutes ?? null;\n        this.primary = hello?.primary ?? null;\n        this.me = hello?.me?.toLowerCase() ?? null;\n        this.$clusterTime = hello?.$clusterTime ?? null;\n    }\n    get hostAddress() {\n        return utils_1.HostAddress.fromString(this.address);\n    }\n    get allHosts() {\n        return this.hosts.concat(this.arbiters).concat(this.passives);\n    }\n    /** Is this server available for reads*/\n    get isReadable() {\n        return this.type === common_1.ServerType.RSSecondary || this.isWritable;\n    }\n    /** Is this server data bearing */\n    get isDataBearing() {\n        return DATA_BEARING_SERVER_TYPES.has(this.type);\n    }\n    /** Is this server available for writes */\n    get isWritable() {\n        return WRITABLE_SERVER_TYPES.has(this.type);\n    }\n    get host() {\n        const chopLength = `:${this.port}`.length;\n        return this.address.slice(0, -chopLength);\n    }\n    get port() {\n        const port = this.address.split(':').pop();\n        return port ? Number.parseInt(port, 10) : 27017;\n    }\n    /**\n     * Determines if another `ServerDescription` is equal to this one per the rules defined\n     * in the {@link https://github.com/mongodb/specifications/blob/master/source/server-discovery-and-monitoring/server-discovery-and-monitoring.rst#serverdescription|SDAM spec}\n     */\n    equals(other) {\n        // Despite using the comparator that would determine a nullish topologyVersion as greater than\n        // for equality we should only always perform direct equality comparison\n        const topologyVersionsEqual = this.topologyVersion === other?.topologyVersion ||\n            compareTopologyVersion(this.topologyVersion, other?.topologyVersion) === 0;\n        const electionIdsEqual = this.electionId != null && other?.electionId != null\n            ? (0, utils_1.compareObjectId)(this.electionId, other.electionId) === 0\n            : this.electionId === other?.electionId;\n        return (other != null &&\n            (0, utils_1.errorStrictEqual)(this.error, other.error) &&\n            this.type === other.type &&\n            this.minWireVersion === other.minWireVersion &&\n            (0, utils_1.arrayStrictEqual)(this.hosts, other.hosts) &&\n            tagsStrictEqual(this.tags, other.tags) &&\n            this.setName === other.setName &&\n            this.setVersion === other.setVersion &&\n            electionIdsEqual &&\n            this.primary === other.primary &&\n            this.logicalSessionTimeoutMinutes === other.logicalSessionTimeoutMinutes &&\n            topologyVersionsEqual);\n    }\n}\nexports.ServerDescription = ServerDescription;\n// Parses a `hello` message and determines the server type\nfunction parseServerType(hello, options) {\n    if (options?.loadBalanced) {\n        return common_1.ServerType.LoadBalancer;\n    }\n    if (!hello || !hello.ok) {\n        return common_1.ServerType.Unknown;\n    }\n    if (hello.isreplicaset) {\n        return common_1.ServerType.RSGhost;\n    }\n    if (hello.msg && hello.msg === 'isdbgrid') {\n        return common_1.ServerType.Mongos;\n    }\n    if (hello.setName) {\n        if (hello.hidden) {\n            return common_1.ServerType.RSOther;\n        }\n        else if (hello.isWritablePrimary) {\n            return common_1.ServerType.RSPrimary;\n        }\n        else if (hello.secondary) {\n            return common_1.ServerType.RSSecondary;\n        }\n        else if (hello.arbiterOnly) {\n            return common_1.ServerType.RSArbiter;\n        }\n        else {\n            return common_1.ServerType.RSOther;\n        }\n    }\n    return common_1.ServerType.Standalone;\n}\nexports.parseServerType = parseServerType;\nfunction tagsStrictEqual(tags, tags2) {\n    const tagsKeys = Object.keys(tags);\n    const tags2Keys = Object.keys(tags2);\n    return (tagsKeys.length === tags2Keys.length &&\n        tagsKeys.every((key) => tags2[key] === tags[key]));\n}\n/**\n * Compares two topology versions.\n *\n * 1. If the response topologyVersion is unset or the ServerDescription's\n *    topologyVersion is null, the client MUST assume the response is more recent.\n * 1. If the response's topologyVersion.processId is not equal to the\n *    ServerDescription's, the client MUST assume the response is more recent.\n * 1. If the response's topologyVersion.processId is equal to the\n *    ServerDescription's, the client MUST use the counter field to determine\n *    which topologyVersion is more recent.\n *\n * ```ts\n * currentTv <   newTv === -1\n * currentTv === newTv === 0\n * currentTv >   newTv === 1\n * ```\n */\nfunction compareTopologyVersion(currentTv, newTv) {\n    if (currentTv == null || newTv == null) {\n        return -1;\n    }\n    if (!currentTv.processId.equals(newTv.processId)) {\n        return -1;\n    }\n    // TODO(NODE-2674): Preserve int64 sent from MongoDB\n    const currentCounter = bson_1.Long.isLong(currentTv.counter)\n        ? currentTv.counter\n        : bson_1.Long.fromNumber(currentTv.counter);\n    const newCounter = bson_1.Long.isLong(newTv.counter) ? newTv.counter : bson_1.Long.fromNumber(newTv.counter);\n    return currentCounter.compare(newCounter);\n}\nexports.compareTopologyVersion = compareTopologyVersion;\n//# sourceMappingURL=server_description.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9zZGFtL3NlcnZlcl9kZXNjcmlwdGlvbi5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCw4QkFBOEIsR0FBRyx1QkFBdUIsR0FBRyx5QkFBeUI7QUFDcEYsZUFBZSxtQkFBTyxDQUFDLGlFQUFTO0FBQ2hDLGdCQUFnQixtQkFBTyxDQUFDLG1FQUFVO0FBQ2xDLGdCQUFnQixtQkFBTyxDQUFDLG1FQUFVO0FBQ2xDLGlCQUFpQixtQkFBTyxDQUFDLHlFQUFVO0FBQ25DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRDQUE0QztBQUM1QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLFVBQVU7QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QjtBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhCQUE4QjtBQUM5QiIsInNvdXJjZXMiOlsiRDpcXHNhbG9uaVxcYXBwcmFpc2FsLXN5c3RlbVxcc2VydmVyXFxub2RlX21vZHVsZXNcXG1vbmdvZGJcXGxpYlxcc2RhbVxcc2VydmVyX2Rlc2NyaXB0aW9uLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5jb21wYXJlVG9wb2xvZ3lWZXJzaW9uID0gZXhwb3J0cy5wYXJzZVNlcnZlclR5cGUgPSBleHBvcnRzLlNlcnZlckRlc2NyaXB0aW9uID0gdm9pZCAwO1xuY29uc3QgYnNvbl8xID0gcmVxdWlyZShcIi4uL2Jzb25cIik7XG5jb25zdCBlcnJvcl8xID0gcmVxdWlyZShcIi4uL2Vycm9yXCIpO1xuY29uc3QgdXRpbHNfMSA9IHJlcXVpcmUoXCIuLi91dGlsc1wiKTtcbmNvbnN0IGNvbW1vbl8xID0gcmVxdWlyZShcIi4vY29tbW9uXCIpO1xuY29uc3QgV1JJVEFCTEVfU0VSVkVSX1RZUEVTID0gbmV3IFNldChbXG4gICAgY29tbW9uXzEuU2VydmVyVHlwZS5SU1ByaW1hcnksXG4gICAgY29tbW9uXzEuU2VydmVyVHlwZS5TdGFuZGFsb25lLFxuICAgIGNvbW1vbl8xLlNlcnZlclR5cGUuTW9uZ29zLFxuICAgIGNvbW1vbl8xLlNlcnZlclR5cGUuTG9hZEJhbGFuY2VyXG5dKTtcbmNvbnN0IERBVEFfQkVBUklOR19TRVJWRVJfVFlQRVMgPSBuZXcgU2V0KFtcbiAgICBjb21tb25fMS5TZXJ2ZXJUeXBlLlJTUHJpbWFyeSxcbiAgICBjb21tb25fMS5TZXJ2ZXJUeXBlLlJTU2Vjb25kYXJ5LFxuICAgIGNvbW1vbl8xLlNlcnZlclR5cGUuTW9uZ29zLFxuICAgIGNvbW1vbl8xLlNlcnZlclR5cGUuU3RhbmRhbG9uZSxcbiAgICBjb21tb25fMS5TZXJ2ZXJUeXBlLkxvYWRCYWxhbmNlclxuXSk7XG4vKipcbiAqIFRoZSBjbGllbnQncyB2aWV3IG9mIGEgc2luZ2xlIHNlcnZlciwgYmFzZWQgb24gdGhlIG1vc3QgcmVjZW50IGhlbGxvIG91dGNvbWUuXG4gKlxuICogSW50ZXJuYWwgdHlwZSwgbm90IG1lYW50IHRvIGJlIGRpcmVjdGx5IGluc3RhbnRpYXRlZFxuICogQHB1YmxpY1xuICovXG5jbGFzcyBTZXJ2ZXJEZXNjcmlwdGlvbiB7XG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgU2VydmVyRGVzY3JpcHRpb25cbiAgICAgKiBAaW50ZXJuYWxcbiAgICAgKlxuICAgICAqIEBwYXJhbSBhZGRyZXNzIC0gVGhlIGFkZHJlc3Mgb2YgdGhlIHNlcnZlclxuICAgICAqIEBwYXJhbSBoZWxsbyAtIEFuIG9wdGlvbmFsIGhlbGxvIHJlc3BvbnNlIGZvciB0aGlzIHNlcnZlclxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGFkZHJlc3MsIGhlbGxvLCBvcHRpb25zID0ge30pIHtcbiAgICAgICAgaWYgKGFkZHJlc3MgPT0gbnVsbCB8fCBhZGRyZXNzID09PSAnJykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29SdW50aW1lRXJyb3IoJ1NlcnZlckRlc2NyaXB0aW9uIG11c3QgYmUgcHJvdmlkZWQgd2l0aCBhIG5vbi1lbXB0eSBhZGRyZXNzJyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5hZGRyZXNzID1cbiAgICAgICAgICAgIHR5cGVvZiBhZGRyZXNzID09PSAnc3RyaW5nJ1xuICAgICAgICAgICAgICAgID8gdXRpbHNfMS5Ib3N0QWRkcmVzcy5mcm9tU3RyaW5nKGFkZHJlc3MpLnRvU3RyaW5nKCkgLy8gVXNlIEhvc3RBZGRyZXNzIHRvIG5vcm1hbGl6ZVxuICAgICAgICAgICAgICAgIDogYWRkcmVzcy50b1N0cmluZygpO1xuICAgICAgICB0aGlzLnR5cGUgPSBwYXJzZVNlcnZlclR5cGUoaGVsbG8sIG9wdGlvbnMpO1xuICAgICAgICB0aGlzLmhvc3RzID0gaGVsbG8/Lmhvc3RzPy5tYXAoKGhvc3QpID0+IGhvc3QudG9Mb3dlckNhc2UoKSkgPz8gW107XG4gICAgICAgIHRoaXMucGFzc2l2ZXMgPSBoZWxsbz8ucGFzc2l2ZXM/Lm1hcCgoaG9zdCkgPT4gaG9zdC50b0xvd2VyQ2FzZSgpKSA/PyBbXTtcbiAgICAgICAgdGhpcy5hcmJpdGVycyA9IGhlbGxvPy5hcmJpdGVycz8ubWFwKChob3N0KSA9PiBob3N0LnRvTG93ZXJDYXNlKCkpID8/IFtdO1xuICAgICAgICB0aGlzLnRhZ3MgPSBoZWxsbz8udGFncyA/PyB7fTtcbiAgICAgICAgdGhpcy5taW5XaXJlVmVyc2lvbiA9IGhlbGxvPy5taW5XaXJlVmVyc2lvbiA/PyAwO1xuICAgICAgICB0aGlzLm1heFdpcmVWZXJzaW9uID0gaGVsbG8/Lm1heFdpcmVWZXJzaW9uID8/IDA7XG4gICAgICAgIHRoaXMucm91bmRUcmlwVGltZSA9IG9wdGlvbnM/LnJvdW5kVHJpcFRpbWUgPz8gLTE7XG4gICAgICAgIHRoaXMubGFzdFVwZGF0ZVRpbWUgPSAoMCwgdXRpbHNfMS5ub3cpKCk7XG4gICAgICAgIHRoaXMubGFzdFdyaXRlRGF0ZSA9IGhlbGxvPy5sYXN0V3JpdGU/Lmxhc3RXcml0ZURhdGUgPz8gMDtcbiAgICAgICAgdGhpcy5lcnJvciA9IG9wdGlvbnMuZXJyb3IgPz8gbnVsbDtcbiAgICAgICAgLy8gVE9ETyhOT0RFLTI2NzQpOiBQcmVzZXJ2ZSBpbnQ2NCBzZW50IGZyb20gTW9uZ29EQlxuICAgICAgICB0aGlzLnRvcG9sb2d5VmVyc2lvbiA9IHRoaXMuZXJyb3I/LnRvcG9sb2d5VmVyc2lvbiA/PyBoZWxsbz8udG9wb2xvZ3lWZXJzaW9uID8/IG51bGw7XG4gICAgICAgIHRoaXMuc2V0TmFtZSA9IGhlbGxvPy5zZXROYW1lID8/IG51bGw7XG4gICAgICAgIHRoaXMuc2V0VmVyc2lvbiA9IGhlbGxvPy5zZXRWZXJzaW9uID8/IG51bGw7XG4gICAgICAgIHRoaXMuZWxlY3Rpb25JZCA9IGhlbGxvPy5lbGVjdGlvbklkID8/IG51bGw7XG4gICAgICAgIHRoaXMubG9naWNhbFNlc3Npb25UaW1lb3V0TWludXRlcyA9IGhlbGxvPy5sb2dpY2FsU2Vzc2lvblRpbWVvdXRNaW51dGVzID8/IG51bGw7XG4gICAgICAgIHRoaXMucHJpbWFyeSA9IGhlbGxvPy5wcmltYXJ5ID8/IG51bGw7XG4gICAgICAgIHRoaXMubWUgPSBoZWxsbz8ubWU/LnRvTG93ZXJDYXNlKCkgPz8gbnVsbDtcbiAgICAgICAgdGhpcy4kY2x1c3RlclRpbWUgPSBoZWxsbz8uJGNsdXN0ZXJUaW1lID8/IG51bGw7XG4gICAgfVxuICAgIGdldCBob3N0QWRkcmVzcygpIHtcbiAgICAgICAgcmV0dXJuIHV0aWxzXzEuSG9zdEFkZHJlc3MuZnJvbVN0cmluZyh0aGlzLmFkZHJlc3MpO1xuICAgIH1cbiAgICBnZXQgYWxsSG9zdHMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmhvc3RzLmNvbmNhdCh0aGlzLmFyYml0ZXJzKS5jb25jYXQodGhpcy5wYXNzaXZlcyk7XG4gICAgfVxuICAgIC8qKiBJcyB0aGlzIHNlcnZlciBhdmFpbGFibGUgZm9yIHJlYWRzKi9cbiAgICBnZXQgaXNSZWFkYWJsZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudHlwZSA9PT0gY29tbW9uXzEuU2VydmVyVHlwZS5SU1NlY29uZGFyeSB8fCB0aGlzLmlzV3JpdGFibGU7XG4gICAgfVxuICAgIC8qKiBJcyB0aGlzIHNlcnZlciBkYXRhIGJlYXJpbmcgKi9cbiAgICBnZXQgaXNEYXRhQmVhcmluZygpIHtcbiAgICAgICAgcmV0dXJuIERBVEFfQkVBUklOR19TRVJWRVJfVFlQRVMuaGFzKHRoaXMudHlwZSk7XG4gICAgfVxuICAgIC8qKiBJcyB0aGlzIHNlcnZlciBhdmFpbGFibGUgZm9yIHdyaXRlcyAqL1xuICAgIGdldCBpc1dyaXRhYmxlKCkge1xuICAgICAgICByZXR1cm4gV1JJVEFCTEVfU0VSVkVSX1RZUEVTLmhhcyh0aGlzLnR5cGUpO1xuICAgIH1cbiAgICBnZXQgaG9zdCgpIHtcbiAgICAgICAgY29uc3QgY2hvcExlbmd0aCA9IGA6JHt0aGlzLnBvcnR9YC5sZW5ndGg7XG4gICAgICAgIHJldHVybiB0aGlzLmFkZHJlc3Muc2xpY2UoMCwgLWNob3BMZW5ndGgpO1xuICAgIH1cbiAgICBnZXQgcG9ydCgpIHtcbiAgICAgICAgY29uc3QgcG9ydCA9IHRoaXMuYWRkcmVzcy5zcGxpdCgnOicpLnBvcCgpO1xuICAgICAgICByZXR1cm4gcG9ydCA/IE51bWJlci5wYXJzZUludChwb3J0LCAxMCkgOiAyNzAxNztcbiAgICB9XG4gICAgLyoqXG4gICAgICogRGV0ZXJtaW5lcyBpZiBhbm90aGVyIGBTZXJ2ZXJEZXNjcmlwdGlvbmAgaXMgZXF1YWwgdG8gdGhpcyBvbmUgcGVyIHRoZSBydWxlcyBkZWZpbmVkXG4gICAgICogaW4gdGhlIHtAbGluayBodHRwczovL2dpdGh1Yi5jb20vbW9uZ29kYi9zcGVjaWZpY2F0aW9ucy9ibG9iL21hc3Rlci9zb3VyY2Uvc2VydmVyLWRpc2NvdmVyeS1hbmQtbW9uaXRvcmluZy9zZXJ2ZXItZGlzY292ZXJ5LWFuZC1tb25pdG9yaW5nLnJzdCNzZXJ2ZXJkZXNjcmlwdGlvbnxTREFNIHNwZWN9XG4gICAgICovXG4gICAgZXF1YWxzKG90aGVyKSB7XG4gICAgICAgIC8vIERlc3BpdGUgdXNpbmcgdGhlIGNvbXBhcmF0b3IgdGhhdCB3b3VsZCBkZXRlcm1pbmUgYSBudWxsaXNoIHRvcG9sb2d5VmVyc2lvbiBhcyBncmVhdGVyIHRoYW5cbiAgICAgICAgLy8gZm9yIGVxdWFsaXR5IHdlIHNob3VsZCBvbmx5IGFsd2F5cyBwZXJmb3JtIGRpcmVjdCBlcXVhbGl0eSBjb21wYXJpc29uXG4gICAgICAgIGNvbnN0IHRvcG9sb2d5VmVyc2lvbnNFcXVhbCA9IHRoaXMudG9wb2xvZ3lWZXJzaW9uID09PSBvdGhlcj8udG9wb2xvZ3lWZXJzaW9uIHx8XG4gICAgICAgICAgICBjb21wYXJlVG9wb2xvZ3lWZXJzaW9uKHRoaXMudG9wb2xvZ3lWZXJzaW9uLCBvdGhlcj8udG9wb2xvZ3lWZXJzaW9uKSA9PT0gMDtcbiAgICAgICAgY29uc3QgZWxlY3Rpb25JZHNFcXVhbCA9IHRoaXMuZWxlY3Rpb25JZCAhPSBudWxsICYmIG90aGVyPy5lbGVjdGlvbklkICE9IG51bGxcbiAgICAgICAgICAgID8gKDAsIHV0aWxzXzEuY29tcGFyZU9iamVjdElkKSh0aGlzLmVsZWN0aW9uSWQsIG90aGVyLmVsZWN0aW9uSWQpID09PSAwXG4gICAgICAgICAgICA6IHRoaXMuZWxlY3Rpb25JZCA9PT0gb3RoZXI/LmVsZWN0aW9uSWQ7XG4gICAgICAgIHJldHVybiAob3RoZXIgIT0gbnVsbCAmJlxuICAgICAgICAgICAgKDAsIHV0aWxzXzEuZXJyb3JTdHJpY3RFcXVhbCkodGhpcy5lcnJvciwgb3RoZXIuZXJyb3IpICYmXG4gICAgICAgICAgICB0aGlzLnR5cGUgPT09IG90aGVyLnR5cGUgJiZcbiAgICAgICAgICAgIHRoaXMubWluV2lyZVZlcnNpb24gPT09IG90aGVyLm1pbldpcmVWZXJzaW9uICYmXG4gICAgICAgICAgICAoMCwgdXRpbHNfMS5hcnJheVN0cmljdEVxdWFsKSh0aGlzLmhvc3RzLCBvdGhlci5ob3N0cykgJiZcbiAgICAgICAgICAgIHRhZ3NTdHJpY3RFcXVhbCh0aGlzLnRhZ3MsIG90aGVyLnRhZ3MpICYmXG4gICAgICAgICAgICB0aGlzLnNldE5hbWUgPT09IG90aGVyLnNldE5hbWUgJiZcbiAgICAgICAgICAgIHRoaXMuc2V0VmVyc2lvbiA9PT0gb3RoZXIuc2V0VmVyc2lvbiAmJlxuICAgICAgICAgICAgZWxlY3Rpb25JZHNFcXVhbCAmJlxuICAgICAgICAgICAgdGhpcy5wcmltYXJ5ID09PSBvdGhlci5wcmltYXJ5ICYmXG4gICAgICAgICAgICB0aGlzLmxvZ2ljYWxTZXNzaW9uVGltZW91dE1pbnV0ZXMgPT09IG90aGVyLmxvZ2ljYWxTZXNzaW9uVGltZW91dE1pbnV0ZXMgJiZcbiAgICAgICAgICAgIHRvcG9sb2d5VmVyc2lvbnNFcXVhbCk7XG4gICAgfVxufVxuZXhwb3J0cy5TZXJ2ZXJEZXNjcmlwdGlvbiA9IFNlcnZlckRlc2NyaXB0aW9uO1xuLy8gUGFyc2VzIGEgYGhlbGxvYCBtZXNzYWdlIGFuZCBkZXRlcm1pbmVzIHRoZSBzZXJ2ZXIgdHlwZVxuZnVuY3Rpb24gcGFyc2VTZXJ2ZXJUeXBlKGhlbGxvLCBvcHRpb25zKSB7XG4gICAgaWYgKG9wdGlvbnM/LmxvYWRCYWxhbmNlZCkge1xuICAgICAgICByZXR1cm4gY29tbW9uXzEuU2VydmVyVHlwZS5Mb2FkQmFsYW5jZXI7XG4gICAgfVxuICAgIGlmICghaGVsbG8gfHwgIWhlbGxvLm9rKSB7XG4gICAgICAgIHJldHVybiBjb21tb25fMS5TZXJ2ZXJUeXBlLlVua25vd247XG4gICAgfVxuICAgIGlmIChoZWxsby5pc3JlcGxpY2FzZXQpIHtcbiAgICAgICAgcmV0dXJuIGNvbW1vbl8xLlNlcnZlclR5cGUuUlNHaG9zdDtcbiAgICB9XG4gICAgaWYgKGhlbGxvLm1zZyAmJiBoZWxsby5tc2cgPT09ICdpc2RiZ3JpZCcpIHtcbiAgICAgICAgcmV0dXJuIGNvbW1vbl8xLlNlcnZlclR5cGUuTW9uZ29zO1xuICAgIH1cbiAgICBpZiAoaGVsbG8uc2V0TmFtZSkge1xuICAgICAgICBpZiAoaGVsbG8uaGlkZGVuKSB7XG4gICAgICAgICAgICByZXR1cm4gY29tbW9uXzEuU2VydmVyVHlwZS5SU090aGVyO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGhlbGxvLmlzV3JpdGFibGVQcmltYXJ5KSB7XG4gICAgICAgICAgICByZXR1cm4gY29tbW9uXzEuU2VydmVyVHlwZS5SU1ByaW1hcnk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoaGVsbG8uc2Vjb25kYXJ5KSB7XG4gICAgICAgICAgICByZXR1cm4gY29tbW9uXzEuU2VydmVyVHlwZS5SU1NlY29uZGFyeTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChoZWxsby5hcmJpdGVyT25seSkge1xuICAgICAgICAgICAgcmV0dXJuIGNvbW1vbl8xLlNlcnZlclR5cGUuUlNBcmJpdGVyO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGNvbW1vbl8xLlNlcnZlclR5cGUuUlNPdGhlcjtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gY29tbW9uXzEuU2VydmVyVHlwZS5TdGFuZGFsb25lO1xufVxuZXhwb3J0cy5wYXJzZVNlcnZlclR5cGUgPSBwYXJzZVNlcnZlclR5cGU7XG5mdW5jdGlvbiB0YWdzU3RyaWN0RXF1YWwodGFncywgdGFnczIpIHtcbiAgICBjb25zdCB0YWdzS2V5cyA9IE9iamVjdC5rZXlzKHRhZ3MpO1xuICAgIGNvbnN0IHRhZ3MyS2V5cyA9IE9iamVjdC5rZXlzKHRhZ3MyKTtcbiAgICByZXR1cm4gKHRhZ3NLZXlzLmxlbmd0aCA9PT0gdGFnczJLZXlzLmxlbmd0aCAmJlxuICAgICAgICB0YWdzS2V5cy5ldmVyeSgoa2V5KSA9PiB0YWdzMltrZXldID09PSB0YWdzW2tleV0pKTtcbn1cbi8qKlxuICogQ29tcGFyZXMgdHdvIHRvcG9sb2d5IHZlcnNpb25zLlxuICpcbiAqIDEuIElmIHRoZSByZXNwb25zZSB0b3BvbG9neVZlcnNpb24gaXMgdW5zZXQgb3IgdGhlIFNlcnZlckRlc2NyaXB0aW9uJ3NcbiAqICAgIHRvcG9sb2d5VmVyc2lvbiBpcyBudWxsLCB0aGUgY2xpZW50IE1VU1QgYXNzdW1lIHRoZSByZXNwb25zZSBpcyBtb3JlIHJlY2VudC5cbiAqIDEuIElmIHRoZSByZXNwb25zZSdzIHRvcG9sb2d5VmVyc2lvbi5wcm9jZXNzSWQgaXMgbm90IGVxdWFsIHRvIHRoZVxuICogICAgU2VydmVyRGVzY3JpcHRpb24ncywgdGhlIGNsaWVudCBNVVNUIGFzc3VtZSB0aGUgcmVzcG9uc2UgaXMgbW9yZSByZWNlbnQuXG4gKiAxLiBJZiB0aGUgcmVzcG9uc2UncyB0b3BvbG9neVZlcnNpb24ucHJvY2Vzc0lkIGlzIGVxdWFsIHRvIHRoZVxuICogICAgU2VydmVyRGVzY3JpcHRpb24ncywgdGhlIGNsaWVudCBNVVNUIHVzZSB0aGUgY291bnRlciBmaWVsZCB0byBkZXRlcm1pbmVcbiAqICAgIHdoaWNoIHRvcG9sb2d5VmVyc2lvbiBpcyBtb3JlIHJlY2VudC5cbiAqXG4gKiBgYGB0c1xuICogY3VycmVudFR2IDwgICBuZXdUdiA9PT0gLTFcbiAqIGN1cnJlbnRUdiA9PT0gbmV3VHYgPT09IDBcbiAqIGN1cnJlbnRUdiA+ICAgbmV3VHYgPT09IDFcbiAqIGBgYFxuICovXG5mdW5jdGlvbiBjb21wYXJlVG9wb2xvZ3lWZXJzaW9uKGN1cnJlbnRUdiwgbmV3VHYpIHtcbiAgICBpZiAoY3VycmVudFR2ID09IG51bGwgfHwgbmV3VHYgPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gLTE7XG4gICAgfVxuICAgIGlmICghY3VycmVudFR2LnByb2Nlc3NJZC5lcXVhbHMobmV3VHYucHJvY2Vzc0lkKSkge1xuICAgICAgICByZXR1cm4gLTE7XG4gICAgfVxuICAgIC8vIFRPRE8oTk9ERS0yNjc0KTogUHJlc2VydmUgaW50NjQgc2VudCBmcm9tIE1vbmdvREJcbiAgICBjb25zdCBjdXJyZW50Q291bnRlciA9IGJzb25fMS5Mb25nLmlzTG9uZyhjdXJyZW50VHYuY291bnRlcilcbiAgICAgICAgPyBjdXJyZW50VHYuY291bnRlclxuICAgICAgICA6IGJzb25fMS5Mb25nLmZyb21OdW1iZXIoY3VycmVudFR2LmNvdW50ZXIpO1xuICAgIGNvbnN0IG5ld0NvdW50ZXIgPSBic29uXzEuTG9uZy5pc0xvbmcobmV3VHYuY291bnRlcikgPyBuZXdUdi5jb3VudGVyIDogYnNvbl8xLkxvbmcuZnJvbU51bWJlcihuZXdUdi5jb3VudGVyKTtcbiAgICByZXR1cm4gY3VycmVudENvdW50ZXIuY29tcGFyZShuZXdDb3VudGVyKTtcbn1cbmV4cG9ydHMuY29tcGFyZVRvcG9sb2d5VmVyc2lvbiA9IGNvbXBhcmVUb3BvbG9neVZlcnNpb247XG4vLyMgc291cmNlTWFwcGluZ1VSTD1zZXJ2ZXJfZGVzY3JpcHRpb24uanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/sdam/server_description.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/sdam/server_selection.js":
/*!*******************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/sdam/server_selection.js ***!
  \*******************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.readPreferenceServerSelector = exports.secondaryWritableServerSelector = exports.sameServerSelector = exports.writableServerSelector = exports.MIN_SECONDARY_WRITE_WIRE_VERSION = void 0;\nconst error_1 = __webpack_require__(/*! ../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst read_preference_1 = __webpack_require__(/*! ../read_preference */ \"(api)/../server/node_modules/mongodb/lib/read_preference.js\");\nconst common_1 = __webpack_require__(/*! ./common */ \"(api)/../server/node_modules/mongodb/lib/sdam/common.js\");\n// max staleness constants\nconst IDLE_WRITE_PERIOD = 10000;\nconst SMALLEST_MAX_STALENESS_SECONDS = 90;\n//  Minimum version to try writes on secondaries.\nexports.MIN_SECONDARY_WRITE_WIRE_VERSION = 13;\n/**\n * Returns a server selector that selects for writable servers\n */\nfunction writableServerSelector() {\n    return (topologyDescription, servers) => latencyWindowReducer(topologyDescription, servers.filter((s) => s.isWritable));\n}\nexports.writableServerSelector = writableServerSelector;\n/**\n * The purpose of this selector is to select the same server, only\n * if it is in a state that it can have commands sent to it.\n */\nfunction sameServerSelector(description) {\n    return (topologyDescription, servers) => {\n        if (!description)\n            return [];\n        // Filter the servers to match the provided description only if\n        // the type is not unknown.\n        return servers.filter(sd => {\n            return sd.address === description.address && sd.type !== common_1.ServerType.Unknown;\n        });\n    };\n}\nexports.sameServerSelector = sameServerSelector;\n/**\n * Returns a server selector that uses a read preference to select a\n * server potentially for a write on a secondary.\n */\nfunction secondaryWritableServerSelector(wireVersion, readPreference) {\n    // If server version < 5.0, read preference always primary.\n    // If server version >= 5.0...\n    // - If read preference is supplied, use that.\n    // - If no read preference is supplied, use primary.\n    if (!readPreference ||\n        !wireVersion ||\n        (wireVersion && wireVersion < exports.MIN_SECONDARY_WRITE_WIRE_VERSION)) {\n        return readPreferenceServerSelector(read_preference_1.ReadPreference.primary);\n    }\n    return readPreferenceServerSelector(readPreference);\n}\nexports.secondaryWritableServerSelector = secondaryWritableServerSelector;\n/**\n * Reduces the passed in array of servers by the rules of the \"Max Staleness\" specification\n * found here: https://github.com/mongodb/specifications/blob/master/source/max-staleness/max-staleness.rst\n *\n * @param readPreference - The read preference providing max staleness guidance\n * @param topologyDescription - The topology description\n * @param servers - The list of server descriptions to be reduced\n * @returns The list of servers that satisfy the requirements of max staleness\n */\nfunction maxStalenessReducer(readPreference, topologyDescription, servers) {\n    if (readPreference.maxStalenessSeconds == null || readPreference.maxStalenessSeconds < 0) {\n        return servers;\n    }\n    const maxStaleness = readPreference.maxStalenessSeconds;\n    const maxStalenessVariance = (topologyDescription.heartbeatFrequencyMS + IDLE_WRITE_PERIOD) / 1000;\n    if (maxStaleness < maxStalenessVariance) {\n        throw new error_1.MongoInvalidArgumentError(`Option \"maxStalenessSeconds\" must be at least ${maxStalenessVariance} seconds`);\n    }\n    if (maxStaleness < SMALLEST_MAX_STALENESS_SECONDS) {\n        throw new error_1.MongoInvalidArgumentError(`Option \"maxStalenessSeconds\" must be at least ${SMALLEST_MAX_STALENESS_SECONDS} seconds`);\n    }\n    if (topologyDescription.type === common_1.TopologyType.ReplicaSetWithPrimary) {\n        const primary = Array.from(topologyDescription.servers.values()).filter(primaryFilter)[0];\n        return servers.reduce((result, server) => {\n            const stalenessMS = server.lastUpdateTime -\n                server.lastWriteDate -\n                (primary.lastUpdateTime - primary.lastWriteDate) +\n                topologyDescription.heartbeatFrequencyMS;\n            const staleness = stalenessMS / 1000;\n            const maxStalenessSeconds = readPreference.maxStalenessSeconds ?? 0;\n            if (staleness <= maxStalenessSeconds) {\n                result.push(server);\n            }\n            return result;\n        }, []);\n    }\n    if (topologyDescription.type === common_1.TopologyType.ReplicaSetNoPrimary) {\n        if (servers.length === 0) {\n            return servers;\n        }\n        const sMax = servers.reduce((max, s) => s.lastWriteDate > max.lastWriteDate ? s : max);\n        return servers.reduce((result, server) => {\n            const stalenessMS = sMax.lastWriteDate - server.lastWriteDate + topologyDescription.heartbeatFrequencyMS;\n            const staleness = stalenessMS / 1000;\n            const maxStalenessSeconds = readPreference.maxStalenessSeconds ?? 0;\n            if (staleness <= maxStalenessSeconds) {\n                result.push(server);\n            }\n            return result;\n        }, []);\n    }\n    return servers;\n}\n/**\n * Determines whether a server's tags match a given set of tags\n *\n * @param tagSet - The requested tag set to match\n * @param serverTags - The server's tags\n */\nfunction tagSetMatch(tagSet, serverTags) {\n    const keys = Object.keys(tagSet);\n    const serverTagKeys = Object.keys(serverTags);\n    for (let i = 0; i < keys.length; ++i) {\n        const key = keys[i];\n        if (serverTagKeys.indexOf(key) === -1 || serverTags[key] !== tagSet[key]) {\n            return false;\n        }\n    }\n    return true;\n}\n/**\n * Reduces a set of server descriptions based on tags requested by the read preference\n *\n * @param readPreference - The read preference providing the requested tags\n * @param servers - The list of server descriptions to reduce\n * @returns The list of servers matching the requested tags\n */\nfunction tagSetReducer(readPreference, servers) {\n    if (readPreference.tags == null ||\n        (Array.isArray(readPreference.tags) && readPreference.tags.length === 0)) {\n        return servers;\n    }\n    for (let i = 0; i < readPreference.tags.length; ++i) {\n        const tagSet = readPreference.tags[i];\n        const serversMatchingTagset = servers.reduce((matched, server) => {\n            if (tagSetMatch(tagSet, server.tags))\n                matched.push(server);\n            return matched;\n        }, []);\n        if (serversMatchingTagset.length) {\n            return serversMatchingTagset;\n        }\n    }\n    return [];\n}\n/**\n * Reduces a list of servers to ensure they fall within an acceptable latency window. This is\n * further specified in the \"Server Selection\" specification, found here:\n * https://github.com/mongodb/specifications/blob/master/source/server-selection/server-selection.rst\n *\n * @param topologyDescription - The topology description\n * @param servers - The list of servers to reduce\n * @returns The servers which fall within an acceptable latency window\n */\nfunction latencyWindowReducer(topologyDescription, servers) {\n    const low = servers.reduce((min, server) => min === -1 ? server.roundTripTime : Math.min(server.roundTripTime, min), -1);\n    const high = low + topologyDescription.localThresholdMS;\n    return servers.reduce((result, server) => {\n        if (server.roundTripTime <= high && server.roundTripTime >= low)\n            result.push(server);\n        return result;\n    }, []);\n}\n// filters\nfunction primaryFilter(server) {\n    return server.type === common_1.ServerType.RSPrimary;\n}\nfunction secondaryFilter(server) {\n    return server.type === common_1.ServerType.RSSecondary;\n}\nfunction nearestFilter(server) {\n    return server.type === common_1.ServerType.RSSecondary || server.type === common_1.ServerType.RSPrimary;\n}\nfunction knownFilter(server) {\n    return server.type !== common_1.ServerType.Unknown;\n}\nfunction loadBalancerFilter(server) {\n    return server.type === common_1.ServerType.LoadBalancer;\n}\n/**\n * Returns a function which selects servers based on a provided read preference\n *\n * @param readPreference - The read preference to select with\n */\nfunction readPreferenceServerSelector(readPreference) {\n    if (!readPreference.isValid()) {\n        throw new error_1.MongoInvalidArgumentError('Invalid read preference specified');\n    }\n    return (topologyDescription, servers) => {\n        const commonWireVersion = topologyDescription.commonWireVersion;\n        if (commonWireVersion &&\n            readPreference.minWireVersion &&\n            readPreference.minWireVersion > commonWireVersion) {\n            throw new error_1.MongoCompatibilityError(`Minimum wire version '${readPreference.minWireVersion}' required, but found '${commonWireVersion}'`);\n        }\n        if (topologyDescription.type === common_1.TopologyType.LoadBalanced) {\n            return servers.filter(loadBalancerFilter);\n        }\n        if (topologyDescription.type === common_1.TopologyType.Unknown) {\n            return [];\n        }\n        if (topologyDescription.type === common_1.TopologyType.Single ||\n            topologyDescription.type === common_1.TopologyType.Sharded) {\n            return latencyWindowReducer(topologyDescription, servers.filter(knownFilter));\n        }\n        const mode = readPreference.mode;\n        if (mode === read_preference_1.ReadPreference.PRIMARY) {\n            return servers.filter(primaryFilter);\n        }\n        if (mode === read_preference_1.ReadPreference.PRIMARY_PREFERRED) {\n            const result = servers.filter(primaryFilter);\n            if (result.length) {\n                return result;\n            }\n        }\n        const filter = mode === read_preference_1.ReadPreference.NEAREST ? nearestFilter : secondaryFilter;\n        const selectedServers = latencyWindowReducer(topologyDescription, tagSetReducer(readPreference, maxStalenessReducer(readPreference, topologyDescription, servers.filter(filter))));\n        if (mode === read_preference_1.ReadPreference.SECONDARY_PREFERRED && selectedServers.length === 0) {\n            return servers.filter(primaryFilter);\n        }\n        return selectedServers;\n    };\n}\nexports.readPreferenceServerSelector = readPreferenceServerSelector;\n//# sourceMappingURL=server_selection.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9zZGFtL3NlcnZlcl9zZWxlY3Rpb24uanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0Qsb0NBQW9DLEdBQUcsdUNBQXVDLEdBQUcsMEJBQTBCLEdBQUcsOEJBQThCLEdBQUcsd0NBQXdDO0FBQ3ZMLGdCQUFnQixtQkFBTyxDQUFDLG1FQUFVO0FBQ2xDLDBCQUEwQixtQkFBTyxDQUFDLHVGQUFvQjtBQUN0RCxpQkFBaUIsbUJBQU8sQ0FBQyx5RUFBVTtBQUNuQztBQUNBO0FBQ0E7QUFDQTtBQUNBLHdDQUF3QztBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFBOEI7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSwwQkFBMEI7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1Q0FBdUM7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxR0FBcUcsc0JBQXNCO0FBQzNIO0FBQ0E7QUFDQSxxR0FBcUcsZ0NBQWdDO0FBQ3JJO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsaUJBQWlCO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLGdDQUFnQztBQUNwRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0VBQStFLDhCQUE4Qix5QkFBeUIsa0JBQWtCO0FBQ3hKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQ0FBb0M7QUFDcEMiLCJzb3VyY2VzIjpbIkQ6XFxzYWxvbmlcXGFwcHJhaXNhbC1zeXN0ZW1cXHNlcnZlclxcbm9kZV9tb2R1bGVzXFxtb25nb2RiXFxsaWJcXHNkYW1cXHNlcnZlcl9zZWxlY3Rpb24uanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnJlYWRQcmVmZXJlbmNlU2VydmVyU2VsZWN0b3IgPSBleHBvcnRzLnNlY29uZGFyeVdyaXRhYmxlU2VydmVyU2VsZWN0b3IgPSBleHBvcnRzLnNhbWVTZXJ2ZXJTZWxlY3RvciA9IGV4cG9ydHMud3JpdGFibGVTZXJ2ZXJTZWxlY3RvciA9IGV4cG9ydHMuTUlOX1NFQ09OREFSWV9XUklURV9XSVJFX1ZFUlNJT04gPSB2b2lkIDA7XG5jb25zdCBlcnJvcl8xID0gcmVxdWlyZShcIi4uL2Vycm9yXCIpO1xuY29uc3QgcmVhZF9wcmVmZXJlbmNlXzEgPSByZXF1aXJlKFwiLi4vcmVhZF9wcmVmZXJlbmNlXCIpO1xuY29uc3QgY29tbW9uXzEgPSByZXF1aXJlKFwiLi9jb21tb25cIik7XG4vLyBtYXggc3RhbGVuZXNzIGNvbnN0YW50c1xuY29uc3QgSURMRV9XUklURV9QRVJJT0QgPSAxMDAwMDtcbmNvbnN0IFNNQUxMRVNUX01BWF9TVEFMRU5FU1NfU0VDT05EUyA9IDkwO1xuLy8gIE1pbmltdW0gdmVyc2lvbiB0byB0cnkgd3JpdGVzIG9uIHNlY29uZGFyaWVzLlxuZXhwb3J0cy5NSU5fU0VDT05EQVJZX1dSSVRFX1dJUkVfVkVSU0lPTiA9IDEzO1xuLyoqXG4gKiBSZXR1cm5zIGEgc2VydmVyIHNlbGVjdG9yIHRoYXQgc2VsZWN0cyBmb3Igd3JpdGFibGUgc2VydmVyc1xuICovXG5mdW5jdGlvbiB3cml0YWJsZVNlcnZlclNlbGVjdG9yKCkge1xuICAgIHJldHVybiAodG9wb2xvZ3lEZXNjcmlwdGlvbiwgc2VydmVycykgPT4gbGF0ZW5jeVdpbmRvd1JlZHVjZXIodG9wb2xvZ3lEZXNjcmlwdGlvbiwgc2VydmVycy5maWx0ZXIoKHMpID0+IHMuaXNXcml0YWJsZSkpO1xufVxuZXhwb3J0cy53cml0YWJsZVNlcnZlclNlbGVjdG9yID0gd3JpdGFibGVTZXJ2ZXJTZWxlY3Rvcjtcbi8qKlxuICogVGhlIHB1cnBvc2Ugb2YgdGhpcyBzZWxlY3RvciBpcyB0byBzZWxlY3QgdGhlIHNhbWUgc2VydmVyLCBvbmx5XG4gKiBpZiBpdCBpcyBpbiBhIHN0YXRlIHRoYXQgaXQgY2FuIGhhdmUgY29tbWFuZHMgc2VudCB0byBpdC5cbiAqL1xuZnVuY3Rpb24gc2FtZVNlcnZlclNlbGVjdG9yKGRlc2NyaXB0aW9uKSB7XG4gICAgcmV0dXJuICh0b3BvbG9neURlc2NyaXB0aW9uLCBzZXJ2ZXJzKSA9PiB7XG4gICAgICAgIGlmICghZGVzY3JpcHRpb24pXG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIC8vIEZpbHRlciB0aGUgc2VydmVycyB0byBtYXRjaCB0aGUgcHJvdmlkZWQgZGVzY3JpcHRpb24gb25seSBpZlxuICAgICAgICAvLyB0aGUgdHlwZSBpcyBub3QgdW5rbm93bi5cbiAgICAgICAgcmV0dXJuIHNlcnZlcnMuZmlsdGVyKHNkID0+IHtcbiAgICAgICAgICAgIHJldHVybiBzZC5hZGRyZXNzID09PSBkZXNjcmlwdGlvbi5hZGRyZXNzICYmIHNkLnR5cGUgIT09IGNvbW1vbl8xLlNlcnZlclR5cGUuVW5rbm93bjtcbiAgICAgICAgfSk7XG4gICAgfTtcbn1cbmV4cG9ydHMuc2FtZVNlcnZlclNlbGVjdG9yID0gc2FtZVNlcnZlclNlbGVjdG9yO1xuLyoqXG4gKiBSZXR1cm5zIGEgc2VydmVyIHNlbGVjdG9yIHRoYXQgdXNlcyBhIHJlYWQgcHJlZmVyZW5jZSB0byBzZWxlY3QgYVxuICogc2VydmVyIHBvdGVudGlhbGx5IGZvciBhIHdyaXRlIG9uIGEgc2Vjb25kYXJ5LlxuICovXG5mdW5jdGlvbiBzZWNvbmRhcnlXcml0YWJsZVNlcnZlclNlbGVjdG9yKHdpcmVWZXJzaW9uLCByZWFkUHJlZmVyZW5jZSkge1xuICAgIC8vIElmIHNlcnZlciB2ZXJzaW9uIDwgNS4wLCByZWFkIHByZWZlcmVuY2UgYWx3YXlzIHByaW1hcnkuXG4gICAgLy8gSWYgc2VydmVyIHZlcnNpb24gPj0gNS4wLi4uXG4gICAgLy8gLSBJZiByZWFkIHByZWZlcmVuY2UgaXMgc3VwcGxpZWQsIHVzZSB0aGF0LlxuICAgIC8vIC0gSWYgbm8gcmVhZCBwcmVmZXJlbmNlIGlzIHN1cHBsaWVkLCB1c2UgcHJpbWFyeS5cbiAgICBpZiAoIXJlYWRQcmVmZXJlbmNlIHx8XG4gICAgICAgICF3aXJlVmVyc2lvbiB8fFxuICAgICAgICAod2lyZVZlcnNpb24gJiYgd2lyZVZlcnNpb24gPCBleHBvcnRzLk1JTl9TRUNPTkRBUllfV1JJVEVfV0lSRV9WRVJTSU9OKSkge1xuICAgICAgICByZXR1cm4gcmVhZFByZWZlcmVuY2VTZXJ2ZXJTZWxlY3RvcihyZWFkX3ByZWZlcmVuY2VfMS5SZWFkUHJlZmVyZW5jZS5wcmltYXJ5KTtcbiAgICB9XG4gICAgcmV0dXJuIHJlYWRQcmVmZXJlbmNlU2VydmVyU2VsZWN0b3IocmVhZFByZWZlcmVuY2UpO1xufVxuZXhwb3J0cy5zZWNvbmRhcnlXcml0YWJsZVNlcnZlclNlbGVjdG9yID0gc2Vjb25kYXJ5V3JpdGFibGVTZXJ2ZXJTZWxlY3Rvcjtcbi8qKlxuICogUmVkdWNlcyB0aGUgcGFzc2VkIGluIGFycmF5IG9mIHNlcnZlcnMgYnkgdGhlIHJ1bGVzIG9mIHRoZSBcIk1heCBTdGFsZW5lc3NcIiBzcGVjaWZpY2F0aW9uXG4gKiBmb3VuZCBoZXJlOiBodHRwczovL2dpdGh1Yi5jb20vbW9uZ29kYi9zcGVjaWZpY2F0aW9ucy9ibG9iL21hc3Rlci9zb3VyY2UvbWF4LXN0YWxlbmVzcy9tYXgtc3RhbGVuZXNzLnJzdFxuICpcbiAqIEBwYXJhbSByZWFkUHJlZmVyZW5jZSAtIFRoZSByZWFkIHByZWZlcmVuY2UgcHJvdmlkaW5nIG1heCBzdGFsZW5lc3MgZ3VpZGFuY2VcbiAqIEBwYXJhbSB0b3BvbG9neURlc2NyaXB0aW9uIC0gVGhlIHRvcG9sb2d5IGRlc2NyaXB0aW9uXG4gKiBAcGFyYW0gc2VydmVycyAtIFRoZSBsaXN0IG9mIHNlcnZlciBkZXNjcmlwdGlvbnMgdG8gYmUgcmVkdWNlZFxuICogQHJldHVybnMgVGhlIGxpc3Qgb2Ygc2VydmVycyB0aGF0IHNhdGlzZnkgdGhlIHJlcXVpcmVtZW50cyBvZiBtYXggc3RhbGVuZXNzXG4gKi9cbmZ1bmN0aW9uIG1heFN0YWxlbmVzc1JlZHVjZXIocmVhZFByZWZlcmVuY2UsIHRvcG9sb2d5RGVzY3JpcHRpb24sIHNlcnZlcnMpIHtcbiAgICBpZiAocmVhZFByZWZlcmVuY2UubWF4U3RhbGVuZXNzU2Vjb25kcyA9PSBudWxsIHx8IHJlYWRQcmVmZXJlbmNlLm1heFN0YWxlbmVzc1NlY29uZHMgPCAwKSB7XG4gICAgICAgIHJldHVybiBzZXJ2ZXJzO1xuICAgIH1cbiAgICBjb25zdCBtYXhTdGFsZW5lc3MgPSByZWFkUHJlZmVyZW5jZS5tYXhTdGFsZW5lc3NTZWNvbmRzO1xuICAgIGNvbnN0IG1heFN0YWxlbmVzc1ZhcmlhbmNlID0gKHRvcG9sb2d5RGVzY3JpcHRpb24uaGVhcnRiZWF0RnJlcXVlbmN5TVMgKyBJRExFX1dSSVRFX1BFUklPRCkgLyAxMDAwO1xuICAgIGlmIChtYXhTdGFsZW5lc3MgPCBtYXhTdGFsZW5lc3NWYXJpYW5jZSkge1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKGBPcHRpb24gXCJtYXhTdGFsZW5lc3NTZWNvbmRzXCIgbXVzdCBiZSBhdCBsZWFzdCAke21heFN0YWxlbmVzc1ZhcmlhbmNlfSBzZWNvbmRzYCk7XG4gICAgfVxuICAgIGlmIChtYXhTdGFsZW5lc3MgPCBTTUFMTEVTVF9NQVhfU1RBTEVORVNTX1NFQ09ORFMpIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcihgT3B0aW9uIFwibWF4U3RhbGVuZXNzU2Vjb25kc1wiIG11c3QgYmUgYXQgbGVhc3QgJHtTTUFMTEVTVF9NQVhfU1RBTEVORVNTX1NFQ09ORFN9IHNlY29uZHNgKTtcbiAgICB9XG4gICAgaWYgKHRvcG9sb2d5RGVzY3JpcHRpb24udHlwZSA9PT0gY29tbW9uXzEuVG9wb2xvZ3lUeXBlLlJlcGxpY2FTZXRXaXRoUHJpbWFyeSkge1xuICAgICAgICBjb25zdCBwcmltYXJ5ID0gQXJyYXkuZnJvbSh0b3BvbG9neURlc2NyaXB0aW9uLnNlcnZlcnMudmFsdWVzKCkpLmZpbHRlcihwcmltYXJ5RmlsdGVyKVswXTtcbiAgICAgICAgcmV0dXJuIHNlcnZlcnMucmVkdWNlKChyZXN1bHQsIHNlcnZlcikgPT4ge1xuICAgICAgICAgICAgY29uc3Qgc3RhbGVuZXNzTVMgPSBzZXJ2ZXIubGFzdFVwZGF0ZVRpbWUgLVxuICAgICAgICAgICAgICAgIHNlcnZlci5sYXN0V3JpdGVEYXRlIC1cbiAgICAgICAgICAgICAgICAocHJpbWFyeS5sYXN0VXBkYXRlVGltZSAtIHByaW1hcnkubGFzdFdyaXRlRGF0ZSkgK1xuICAgICAgICAgICAgICAgIHRvcG9sb2d5RGVzY3JpcHRpb24uaGVhcnRiZWF0RnJlcXVlbmN5TVM7XG4gICAgICAgICAgICBjb25zdCBzdGFsZW5lc3MgPSBzdGFsZW5lc3NNUyAvIDEwMDA7XG4gICAgICAgICAgICBjb25zdCBtYXhTdGFsZW5lc3NTZWNvbmRzID0gcmVhZFByZWZlcmVuY2UubWF4U3RhbGVuZXNzU2Vjb25kcyA/PyAwO1xuICAgICAgICAgICAgaWYgKHN0YWxlbmVzcyA8PSBtYXhTdGFsZW5lc3NTZWNvbmRzKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goc2VydmVyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH0sIFtdKTtcbiAgICB9XG4gICAgaWYgKHRvcG9sb2d5RGVzY3JpcHRpb24udHlwZSA9PT0gY29tbW9uXzEuVG9wb2xvZ3lUeXBlLlJlcGxpY2FTZXROb1ByaW1hcnkpIHtcbiAgICAgICAgaWYgKHNlcnZlcnMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gc2VydmVycztcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBzTWF4ID0gc2VydmVycy5yZWR1Y2UoKG1heCwgcykgPT4gcy5sYXN0V3JpdGVEYXRlID4gbWF4Lmxhc3RXcml0ZURhdGUgPyBzIDogbWF4KTtcbiAgICAgICAgcmV0dXJuIHNlcnZlcnMucmVkdWNlKChyZXN1bHQsIHNlcnZlcikgPT4ge1xuICAgICAgICAgICAgY29uc3Qgc3RhbGVuZXNzTVMgPSBzTWF4Lmxhc3RXcml0ZURhdGUgLSBzZXJ2ZXIubGFzdFdyaXRlRGF0ZSArIHRvcG9sb2d5RGVzY3JpcHRpb24uaGVhcnRiZWF0RnJlcXVlbmN5TVM7XG4gICAgICAgICAgICBjb25zdCBzdGFsZW5lc3MgPSBzdGFsZW5lc3NNUyAvIDEwMDA7XG4gICAgICAgICAgICBjb25zdCBtYXhTdGFsZW5lc3NTZWNvbmRzID0gcmVhZFByZWZlcmVuY2UubWF4U3RhbGVuZXNzU2Vjb25kcyA/PyAwO1xuICAgICAgICAgICAgaWYgKHN0YWxlbmVzcyA8PSBtYXhTdGFsZW5lc3NTZWNvbmRzKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goc2VydmVyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH0sIFtdKTtcbiAgICB9XG4gICAgcmV0dXJuIHNlcnZlcnM7XG59XG4vKipcbiAqIERldGVybWluZXMgd2hldGhlciBhIHNlcnZlcidzIHRhZ3MgbWF0Y2ggYSBnaXZlbiBzZXQgb2YgdGFnc1xuICpcbiAqIEBwYXJhbSB0YWdTZXQgLSBUaGUgcmVxdWVzdGVkIHRhZyBzZXQgdG8gbWF0Y2hcbiAqIEBwYXJhbSBzZXJ2ZXJUYWdzIC0gVGhlIHNlcnZlcidzIHRhZ3NcbiAqL1xuZnVuY3Rpb24gdGFnU2V0TWF0Y2godGFnU2V0LCBzZXJ2ZXJUYWdzKSB7XG4gICAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKHRhZ1NldCk7XG4gICAgY29uc3Qgc2VydmVyVGFnS2V5cyA9IE9iamVjdC5rZXlzKHNlcnZlclRhZ3MpO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7ICsraSkge1xuICAgICAgICBjb25zdCBrZXkgPSBrZXlzW2ldO1xuICAgICAgICBpZiAoc2VydmVyVGFnS2V5cy5pbmRleE9mKGtleSkgPT09IC0xIHx8IHNlcnZlclRhZ3Nba2V5XSAhPT0gdGFnU2V0W2tleV0pIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbn1cbi8qKlxuICogUmVkdWNlcyBhIHNldCBvZiBzZXJ2ZXIgZGVzY3JpcHRpb25zIGJhc2VkIG9uIHRhZ3MgcmVxdWVzdGVkIGJ5IHRoZSByZWFkIHByZWZlcmVuY2VcbiAqXG4gKiBAcGFyYW0gcmVhZFByZWZlcmVuY2UgLSBUaGUgcmVhZCBwcmVmZXJlbmNlIHByb3ZpZGluZyB0aGUgcmVxdWVzdGVkIHRhZ3NcbiAqIEBwYXJhbSBzZXJ2ZXJzIC0gVGhlIGxpc3Qgb2Ygc2VydmVyIGRlc2NyaXB0aW9ucyB0byByZWR1Y2VcbiAqIEByZXR1cm5zIFRoZSBsaXN0IG9mIHNlcnZlcnMgbWF0Y2hpbmcgdGhlIHJlcXVlc3RlZCB0YWdzXG4gKi9cbmZ1bmN0aW9uIHRhZ1NldFJlZHVjZXIocmVhZFByZWZlcmVuY2UsIHNlcnZlcnMpIHtcbiAgICBpZiAocmVhZFByZWZlcmVuY2UudGFncyA9PSBudWxsIHx8XG4gICAgICAgIChBcnJheS5pc0FycmF5KHJlYWRQcmVmZXJlbmNlLnRhZ3MpICYmIHJlYWRQcmVmZXJlbmNlLnRhZ3MubGVuZ3RoID09PSAwKSkge1xuICAgICAgICByZXR1cm4gc2VydmVycztcbiAgICB9XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCByZWFkUHJlZmVyZW5jZS50YWdzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgIGNvbnN0IHRhZ1NldCA9IHJlYWRQcmVmZXJlbmNlLnRhZ3NbaV07XG4gICAgICAgIGNvbnN0IHNlcnZlcnNNYXRjaGluZ1RhZ3NldCA9IHNlcnZlcnMucmVkdWNlKChtYXRjaGVkLCBzZXJ2ZXIpID0+IHtcbiAgICAgICAgICAgIGlmICh0YWdTZXRNYXRjaCh0YWdTZXQsIHNlcnZlci50YWdzKSlcbiAgICAgICAgICAgICAgICBtYXRjaGVkLnB1c2goc2VydmVyKTtcbiAgICAgICAgICAgIHJldHVybiBtYXRjaGVkO1xuICAgICAgICB9LCBbXSk7XG4gICAgICAgIGlmIChzZXJ2ZXJzTWF0Y2hpbmdUYWdzZXQubGVuZ3RoKSB7XG4gICAgICAgICAgICByZXR1cm4gc2VydmVyc01hdGNoaW5nVGFnc2V0O1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBbXTtcbn1cbi8qKlxuICogUmVkdWNlcyBhIGxpc3Qgb2Ygc2VydmVycyB0byBlbnN1cmUgdGhleSBmYWxsIHdpdGhpbiBhbiBhY2NlcHRhYmxlIGxhdGVuY3kgd2luZG93LiBUaGlzIGlzXG4gKiBmdXJ0aGVyIHNwZWNpZmllZCBpbiB0aGUgXCJTZXJ2ZXIgU2VsZWN0aW9uXCIgc3BlY2lmaWNhdGlvbiwgZm91bmQgaGVyZTpcbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9tb25nb2RiL3NwZWNpZmljYXRpb25zL2Jsb2IvbWFzdGVyL3NvdXJjZS9zZXJ2ZXItc2VsZWN0aW9uL3NlcnZlci1zZWxlY3Rpb24ucnN0XG4gKlxuICogQHBhcmFtIHRvcG9sb2d5RGVzY3JpcHRpb24gLSBUaGUgdG9wb2xvZ3kgZGVzY3JpcHRpb25cbiAqIEBwYXJhbSBzZXJ2ZXJzIC0gVGhlIGxpc3Qgb2Ygc2VydmVycyB0byByZWR1Y2VcbiAqIEByZXR1cm5zIFRoZSBzZXJ2ZXJzIHdoaWNoIGZhbGwgd2l0aGluIGFuIGFjY2VwdGFibGUgbGF0ZW5jeSB3aW5kb3dcbiAqL1xuZnVuY3Rpb24gbGF0ZW5jeVdpbmRvd1JlZHVjZXIodG9wb2xvZ3lEZXNjcmlwdGlvbiwgc2VydmVycykge1xuICAgIGNvbnN0IGxvdyA9IHNlcnZlcnMucmVkdWNlKChtaW4sIHNlcnZlcikgPT4gbWluID09PSAtMSA/IHNlcnZlci5yb3VuZFRyaXBUaW1lIDogTWF0aC5taW4oc2VydmVyLnJvdW5kVHJpcFRpbWUsIG1pbiksIC0xKTtcbiAgICBjb25zdCBoaWdoID0gbG93ICsgdG9wb2xvZ3lEZXNjcmlwdGlvbi5sb2NhbFRocmVzaG9sZE1TO1xuICAgIHJldHVybiBzZXJ2ZXJzLnJlZHVjZSgocmVzdWx0LCBzZXJ2ZXIpID0+IHtcbiAgICAgICAgaWYgKHNlcnZlci5yb3VuZFRyaXBUaW1lIDw9IGhpZ2ggJiYgc2VydmVyLnJvdW5kVHJpcFRpbWUgPj0gbG93KVxuICAgICAgICAgICAgcmVzdWx0LnB1c2goc2VydmVyKTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9LCBbXSk7XG59XG4vLyBmaWx0ZXJzXG5mdW5jdGlvbiBwcmltYXJ5RmlsdGVyKHNlcnZlcikge1xuICAgIHJldHVybiBzZXJ2ZXIudHlwZSA9PT0gY29tbW9uXzEuU2VydmVyVHlwZS5SU1ByaW1hcnk7XG59XG5mdW5jdGlvbiBzZWNvbmRhcnlGaWx0ZXIoc2VydmVyKSB7XG4gICAgcmV0dXJuIHNlcnZlci50eXBlID09PSBjb21tb25fMS5TZXJ2ZXJUeXBlLlJTU2Vjb25kYXJ5O1xufVxuZnVuY3Rpb24gbmVhcmVzdEZpbHRlcihzZXJ2ZXIpIHtcbiAgICByZXR1cm4gc2VydmVyLnR5cGUgPT09IGNvbW1vbl8xLlNlcnZlclR5cGUuUlNTZWNvbmRhcnkgfHwgc2VydmVyLnR5cGUgPT09IGNvbW1vbl8xLlNlcnZlclR5cGUuUlNQcmltYXJ5O1xufVxuZnVuY3Rpb24ga25vd25GaWx0ZXIoc2VydmVyKSB7XG4gICAgcmV0dXJuIHNlcnZlci50eXBlICE9PSBjb21tb25fMS5TZXJ2ZXJUeXBlLlVua25vd247XG59XG5mdW5jdGlvbiBsb2FkQmFsYW5jZXJGaWx0ZXIoc2VydmVyKSB7XG4gICAgcmV0dXJuIHNlcnZlci50eXBlID09PSBjb21tb25fMS5TZXJ2ZXJUeXBlLkxvYWRCYWxhbmNlcjtcbn1cbi8qKlxuICogUmV0dXJucyBhIGZ1bmN0aW9uIHdoaWNoIHNlbGVjdHMgc2VydmVycyBiYXNlZCBvbiBhIHByb3ZpZGVkIHJlYWQgcHJlZmVyZW5jZVxuICpcbiAqIEBwYXJhbSByZWFkUHJlZmVyZW5jZSAtIFRoZSByZWFkIHByZWZlcmVuY2UgdG8gc2VsZWN0IHdpdGhcbiAqL1xuZnVuY3Rpb24gcmVhZFByZWZlcmVuY2VTZXJ2ZXJTZWxlY3RvcihyZWFkUHJlZmVyZW5jZSkge1xuICAgIGlmICghcmVhZFByZWZlcmVuY2UuaXNWYWxpZCgpKSB7XG4gICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoJ0ludmFsaWQgcmVhZCBwcmVmZXJlbmNlIHNwZWNpZmllZCcpO1xuICAgIH1cbiAgICByZXR1cm4gKHRvcG9sb2d5RGVzY3JpcHRpb24sIHNlcnZlcnMpID0+IHtcbiAgICAgICAgY29uc3QgY29tbW9uV2lyZVZlcnNpb24gPSB0b3BvbG9neURlc2NyaXB0aW9uLmNvbW1vbldpcmVWZXJzaW9uO1xuICAgICAgICBpZiAoY29tbW9uV2lyZVZlcnNpb24gJiZcbiAgICAgICAgICAgIHJlYWRQcmVmZXJlbmNlLm1pbldpcmVWZXJzaW9uICYmXG4gICAgICAgICAgICByZWFkUHJlZmVyZW5jZS5taW5XaXJlVmVyc2lvbiA+IGNvbW1vbldpcmVWZXJzaW9uKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0NvbXBhdGliaWxpdHlFcnJvcihgTWluaW11bSB3aXJlIHZlcnNpb24gJyR7cmVhZFByZWZlcmVuY2UubWluV2lyZVZlcnNpb259JyByZXF1aXJlZCwgYnV0IGZvdW5kICcke2NvbW1vbldpcmVWZXJzaW9ufSdgKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodG9wb2xvZ3lEZXNjcmlwdGlvbi50eXBlID09PSBjb21tb25fMS5Ub3BvbG9neVR5cGUuTG9hZEJhbGFuY2VkKSB7XG4gICAgICAgICAgICByZXR1cm4gc2VydmVycy5maWx0ZXIobG9hZEJhbGFuY2VyRmlsdGVyKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodG9wb2xvZ3lEZXNjcmlwdGlvbi50eXBlID09PSBjb21tb25fMS5Ub3BvbG9neVR5cGUuVW5rbm93bikge1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0b3BvbG9neURlc2NyaXB0aW9uLnR5cGUgPT09IGNvbW1vbl8xLlRvcG9sb2d5VHlwZS5TaW5nbGUgfHxcbiAgICAgICAgICAgIHRvcG9sb2d5RGVzY3JpcHRpb24udHlwZSA9PT0gY29tbW9uXzEuVG9wb2xvZ3lUeXBlLlNoYXJkZWQpIHtcbiAgICAgICAgICAgIHJldHVybiBsYXRlbmN5V2luZG93UmVkdWNlcih0b3BvbG9neURlc2NyaXB0aW9uLCBzZXJ2ZXJzLmZpbHRlcihrbm93bkZpbHRlcikpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG1vZGUgPSByZWFkUHJlZmVyZW5jZS5tb2RlO1xuICAgICAgICBpZiAobW9kZSA9PT0gcmVhZF9wcmVmZXJlbmNlXzEuUmVhZFByZWZlcmVuY2UuUFJJTUFSWSkge1xuICAgICAgICAgICAgcmV0dXJuIHNlcnZlcnMuZmlsdGVyKHByaW1hcnlGaWx0ZXIpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChtb2RlID09PSByZWFkX3ByZWZlcmVuY2VfMS5SZWFkUHJlZmVyZW5jZS5QUklNQVJZX1BSRUZFUlJFRCkge1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gc2VydmVycy5maWx0ZXIocHJpbWFyeUZpbHRlcik7XG4gICAgICAgICAgICBpZiAocmVzdWx0Lmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZmlsdGVyID0gbW9kZSA9PT0gcmVhZF9wcmVmZXJlbmNlXzEuUmVhZFByZWZlcmVuY2UuTkVBUkVTVCA/IG5lYXJlc3RGaWx0ZXIgOiBzZWNvbmRhcnlGaWx0ZXI7XG4gICAgICAgIGNvbnN0IHNlbGVjdGVkU2VydmVycyA9IGxhdGVuY3lXaW5kb3dSZWR1Y2VyKHRvcG9sb2d5RGVzY3JpcHRpb24sIHRhZ1NldFJlZHVjZXIocmVhZFByZWZlcmVuY2UsIG1heFN0YWxlbmVzc1JlZHVjZXIocmVhZFByZWZlcmVuY2UsIHRvcG9sb2d5RGVzY3JpcHRpb24sIHNlcnZlcnMuZmlsdGVyKGZpbHRlcikpKSk7XG4gICAgICAgIGlmIChtb2RlID09PSByZWFkX3ByZWZlcmVuY2VfMS5SZWFkUHJlZmVyZW5jZS5TRUNPTkRBUllfUFJFRkVSUkVEICYmIHNlbGVjdGVkU2VydmVycy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBzZXJ2ZXJzLmZpbHRlcihwcmltYXJ5RmlsdGVyKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc2VsZWN0ZWRTZXJ2ZXJzO1xuICAgIH07XG59XG5leHBvcnRzLnJlYWRQcmVmZXJlbmNlU2VydmVyU2VsZWN0b3IgPSByZWFkUHJlZmVyZW5jZVNlcnZlclNlbGVjdG9yO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9c2VydmVyX3NlbGVjdGlvbi5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/sdam/server_selection.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/sdam/srv_polling.js":
/*!**************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/sdam/srv_polling.js ***!
  \**************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.SrvPoller = exports.SrvPollingEvent = void 0;\nconst dns = __webpack_require__(/*! dns */ \"dns\");\nconst timers_1 = __webpack_require__(/*! timers */ \"timers\");\nconst error_1 = __webpack_require__(/*! ../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst mongo_types_1 = __webpack_require__(/*! ../mongo_types */ \"(api)/../server/node_modules/mongodb/lib/mongo_types.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\n/**\n * @internal\n * @category Event\n */\nclass SrvPollingEvent {\n    constructor(srvRecords) {\n        this.srvRecords = srvRecords;\n    }\n    hostnames() {\n        return new Set(this.srvRecords.map(r => utils_1.HostAddress.fromSrvRecord(r).toString()));\n    }\n}\nexports.SrvPollingEvent = SrvPollingEvent;\n/** @internal */\nclass SrvPoller extends mongo_types_1.TypedEventEmitter {\n    constructor(options) {\n        super();\n        if (!options || !options.srvHost) {\n            throw new error_1.MongoRuntimeError('Options for SrvPoller must exist and include srvHost');\n        }\n        this.srvHost = options.srvHost;\n        this.srvMaxHosts = options.srvMaxHosts ?? 0;\n        this.srvServiceName = options.srvServiceName ?? 'mongodb';\n        this.rescanSrvIntervalMS = 60000;\n        this.heartbeatFrequencyMS = options.heartbeatFrequencyMS ?? 10000;\n        this.haMode = false;\n        this.generation = 0;\n        this._timeout = undefined;\n    }\n    get srvAddress() {\n        return `_${this.srvServiceName}._tcp.${this.srvHost}`;\n    }\n    get intervalMS() {\n        return this.haMode ? this.heartbeatFrequencyMS : this.rescanSrvIntervalMS;\n    }\n    start() {\n        if (!this._timeout) {\n            this.schedule();\n        }\n    }\n    stop() {\n        if (this._timeout) {\n            (0, timers_1.clearTimeout)(this._timeout);\n            this.generation += 1;\n            this._timeout = undefined;\n        }\n    }\n    // TODO(NODE-4994): implement new logging logic for SrvPoller failures\n    schedule() {\n        if (this._timeout) {\n            (0, timers_1.clearTimeout)(this._timeout);\n        }\n        this._timeout = (0, timers_1.setTimeout)(() => {\n            this._poll().catch(() => null);\n        }, this.intervalMS);\n    }\n    success(srvRecords) {\n        this.haMode = false;\n        this.schedule();\n        this.emit(SrvPoller.SRV_RECORD_DISCOVERY, new SrvPollingEvent(srvRecords));\n    }\n    failure() {\n        this.haMode = true;\n        this.schedule();\n    }\n    async _poll() {\n        const generation = this.generation;\n        let srvRecords;\n        try {\n            srvRecords = await dns.promises.resolveSrv(this.srvAddress);\n        }\n        catch (dnsError) {\n            this.failure();\n            return;\n        }\n        if (generation !== this.generation) {\n            return;\n        }\n        const finalAddresses = [];\n        for (const record of srvRecords) {\n            if ((0, utils_1.matchesParentDomain)(record.name, this.srvHost)) {\n                finalAddresses.push(record);\n            }\n        }\n        if (!finalAddresses.length) {\n            this.failure();\n            return;\n        }\n        this.success(finalAddresses);\n    }\n}\n/** @event */\nSrvPoller.SRV_RECORD_DISCOVERY = 'srvRecordDiscovery';\nexports.SrvPoller = SrvPoller;\n//# sourceMappingURL=srv_polling.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9zZGFtL3Nydl9wb2xsaW5nLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELGlCQUFpQixHQUFHLHVCQUF1QjtBQUMzQyxZQUFZLG1CQUFPLENBQUMsZ0JBQUs7QUFDekIsaUJBQWlCLG1CQUFPLENBQUMsc0JBQVE7QUFDakMsZ0JBQWdCLG1CQUFPLENBQUMsbUVBQVU7QUFDbEMsc0JBQXNCLG1CQUFPLENBQUMsK0VBQWdCO0FBQzlDLGdCQUFnQixtQkFBTyxDQUFDLG1FQUFVO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QjtBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CLG9CQUFvQixRQUFRLGFBQWE7QUFDNUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCIiwic291cmNlcyI6WyJEOlxcc2Fsb25pXFxhcHByYWlzYWwtc3lzdGVtXFxzZXJ2ZXJcXG5vZGVfbW9kdWxlc1xcbW9uZ29kYlxcbGliXFxzZGFtXFxzcnZfcG9sbGluZy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuU3J2UG9sbGVyID0gZXhwb3J0cy5TcnZQb2xsaW5nRXZlbnQgPSB2b2lkIDA7XG5jb25zdCBkbnMgPSByZXF1aXJlKFwiZG5zXCIpO1xuY29uc3QgdGltZXJzXzEgPSByZXF1aXJlKFwidGltZXJzXCIpO1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuLi9lcnJvclwiKTtcbmNvbnN0IG1vbmdvX3R5cGVzXzEgPSByZXF1aXJlKFwiLi4vbW9uZ29fdHlwZXNcIik7XG5jb25zdCB1dGlsc18xID0gcmVxdWlyZShcIi4uL3V0aWxzXCIpO1xuLyoqXG4gKiBAaW50ZXJuYWxcbiAqIEBjYXRlZ29yeSBFdmVudFxuICovXG5jbGFzcyBTcnZQb2xsaW5nRXZlbnQge1xuICAgIGNvbnN0cnVjdG9yKHNydlJlY29yZHMpIHtcbiAgICAgICAgdGhpcy5zcnZSZWNvcmRzID0gc3J2UmVjb3JkcztcbiAgICB9XG4gICAgaG9zdG5hbWVzKCkge1xuICAgICAgICByZXR1cm4gbmV3IFNldCh0aGlzLnNydlJlY29yZHMubWFwKHIgPT4gdXRpbHNfMS5Ib3N0QWRkcmVzcy5mcm9tU3J2UmVjb3JkKHIpLnRvU3RyaW5nKCkpKTtcbiAgICB9XG59XG5leHBvcnRzLlNydlBvbGxpbmdFdmVudCA9IFNydlBvbGxpbmdFdmVudDtcbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIFNydlBvbGxlciBleHRlbmRzIG1vbmdvX3R5cGVzXzEuVHlwZWRFdmVudEVtaXR0ZXIge1xuICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgaWYgKCFvcHRpb25zIHx8ICFvcHRpb25zLnNydkhvc3QpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUnVudGltZUVycm9yKCdPcHRpb25zIGZvciBTcnZQb2xsZXIgbXVzdCBleGlzdCBhbmQgaW5jbHVkZSBzcnZIb3N0Jyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zcnZIb3N0ID0gb3B0aW9ucy5zcnZIb3N0O1xuICAgICAgICB0aGlzLnNydk1heEhvc3RzID0gb3B0aW9ucy5zcnZNYXhIb3N0cyA/PyAwO1xuICAgICAgICB0aGlzLnNydlNlcnZpY2VOYW1lID0gb3B0aW9ucy5zcnZTZXJ2aWNlTmFtZSA/PyAnbW9uZ29kYic7XG4gICAgICAgIHRoaXMucmVzY2FuU3J2SW50ZXJ2YWxNUyA9IDYwMDAwO1xuICAgICAgICB0aGlzLmhlYXJ0YmVhdEZyZXF1ZW5jeU1TID0gb3B0aW9ucy5oZWFydGJlYXRGcmVxdWVuY3lNUyA/PyAxMDAwMDtcbiAgICAgICAgdGhpcy5oYU1vZGUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5nZW5lcmF0aW9uID0gMDtcbiAgICAgICAgdGhpcy5fdGltZW91dCA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgZ2V0IHNydkFkZHJlc3MoKSB7XG4gICAgICAgIHJldHVybiBgXyR7dGhpcy5zcnZTZXJ2aWNlTmFtZX0uX3RjcC4ke3RoaXMuc3J2SG9zdH1gO1xuICAgIH1cbiAgICBnZXQgaW50ZXJ2YWxNUygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaGFNb2RlID8gdGhpcy5oZWFydGJlYXRGcmVxdWVuY3lNUyA6IHRoaXMucmVzY2FuU3J2SW50ZXJ2YWxNUztcbiAgICB9XG4gICAgc3RhcnQoKSB7XG4gICAgICAgIGlmICghdGhpcy5fdGltZW91dCkge1xuICAgICAgICAgICAgdGhpcy5zY2hlZHVsZSgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHN0b3AoKSB7XG4gICAgICAgIGlmICh0aGlzLl90aW1lb3V0KSB7XG4gICAgICAgICAgICAoMCwgdGltZXJzXzEuY2xlYXJUaW1lb3V0KSh0aGlzLl90aW1lb3V0KTtcbiAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGlvbiArPSAxO1xuICAgICAgICAgICAgdGhpcy5fdGltZW91dCA9IHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvLyBUT0RPKE5PREUtNDk5NCk6IGltcGxlbWVudCBuZXcgbG9nZ2luZyBsb2dpYyBmb3IgU3J2UG9sbGVyIGZhaWx1cmVzXG4gICAgc2NoZWR1bGUoKSB7XG4gICAgICAgIGlmICh0aGlzLl90aW1lb3V0KSB7XG4gICAgICAgICAgICAoMCwgdGltZXJzXzEuY2xlYXJUaW1lb3V0KSh0aGlzLl90aW1lb3V0KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl90aW1lb3V0ID0gKDAsIHRpbWVyc18xLnNldFRpbWVvdXQpKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuX3BvbGwoKS5jYXRjaCgoKSA9PiBudWxsKTtcbiAgICAgICAgfSwgdGhpcy5pbnRlcnZhbE1TKTtcbiAgICB9XG4gICAgc3VjY2VzcyhzcnZSZWNvcmRzKSB7XG4gICAgICAgIHRoaXMuaGFNb2RlID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc2NoZWR1bGUoKTtcbiAgICAgICAgdGhpcy5lbWl0KFNydlBvbGxlci5TUlZfUkVDT1JEX0RJU0NPVkVSWSwgbmV3IFNydlBvbGxpbmdFdmVudChzcnZSZWNvcmRzKSk7XG4gICAgfVxuICAgIGZhaWx1cmUoKSB7XG4gICAgICAgIHRoaXMuaGFNb2RlID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5zY2hlZHVsZSgpO1xuICAgIH1cbiAgICBhc3luYyBfcG9sbCgpIHtcbiAgICAgICAgY29uc3QgZ2VuZXJhdGlvbiA9IHRoaXMuZ2VuZXJhdGlvbjtcbiAgICAgICAgbGV0IHNydlJlY29yZHM7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBzcnZSZWNvcmRzID0gYXdhaXQgZG5zLnByb21pc2VzLnJlc29sdmVTcnYodGhpcy5zcnZBZGRyZXNzKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZG5zRXJyb3IpIHtcbiAgICAgICAgICAgIHRoaXMuZmFpbHVyZSgpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChnZW5lcmF0aW9uICE9PSB0aGlzLmdlbmVyYXRpb24pIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBmaW5hbEFkZHJlc3NlcyA9IFtdO1xuICAgICAgICBmb3IgKGNvbnN0IHJlY29yZCBvZiBzcnZSZWNvcmRzKSB7XG4gICAgICAgICAgICBpZiAoKDAsIHV0aWxzXzEubWF0Y2hlc1BhcmVudERvbWFpbikocmVjb3JkLm5hbWUsIHRoaXMuc3J2SG9zdCkpIHtcbiAgICAgICAgICAgICAgICBmaW5hbEFkZHJlc3Nlcy5wdXNoKHJlY29yZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFmaW5hbEFkZHJlc3Nlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRoaXMuZmFpbHVyZSgpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc3VjY2VzcyhmaW5hbEFkZHJlc3Nlcyk7XG4gICAgfVxufVxuLyoqIEBldmVudCAqL1xuU3J2UG9sbGVyLlNSVl9SRUNPUkRfRElTQ09WRVJZID0gJ3NydlJlY29yZERpc2NvdmVyeSc7XG5leHBvcnRzLlNydlBvbGxlciA9IFNydlBvbGxlcjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXNydl9wb2xsaW5nLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/sdam/srv_polling.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/sdam/topology.js":
/*!***********************************************************!*\
  !*** ../server/node_modules/mongodb/lib/sdam/topology.js ***!
  \***********************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.ServerCapabilities = exports.Topology = void 0;\nconst timers_1 = __webpack_require__(/*! timers */ \"timers\");\nconst util_1 = __webpack_require__(/*! util */ \"util\");\nconst connection_string_1 = __webpack_require__(/*! ../connection_string */ \"(api)/../server/node_modules/mongodb/lib/connection_string.js\");\nconst constants_1 = __webpack_require__(/*! ../constants */ \"(api)/../server/node_modules/mongodb/lib/constants.js\");\nconst error_1 = __webpack_require__(/*! ../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst mongo_types_1 = __webpack_require__(/*! ../mongo_types */ \"(api)/../server/node_modules/mongodb/lib/mongo_types.js\");\nconst read_preference_1 = __webpack_require__(/*! ../read_preference */ \"(api)/../server/node_modules/mongodb/lib/read_preference.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\nconst common_1 = __webpack_require__(/*! ./common */ \"(api)/../server/node_modules/mongodb/lib/sdam/common.js\");\nconst events_1 = __webpack_require__(/*! ./events */ \"(api)/../server/node_modules/mongodb/lib/sdam/events.js\");\nconst server_1 = __webpack_require__(/*! ./server */ \"(api)/../server/node_modules/mongodb/lib/sdam/server.js\");\nconst server_description_1 = __webpack_require__(/*! ./server_description */ \"(api)/../server/node_modules/mongodb/lib/sdam/server_description.js\");\nconst server_selection_1 = __webpack_require__(/*! ./server_selection */ \"(api)/../server/node_modules/mongodb/lib/sdam/server_selection.js\");\nconst srv_polling_1 = __webpack_require__(/*! ./srv_polling */ \"(api)/../server/node_modules/mongodb/lib/sdam/srv_polling.js\");\nconst topology_description_1 = __webpack_require__(/*! ./topology_description */ \"(api)/../server/node_modules/mongodb/lib/sdam/topology_description.js\");\n// Global state\nlet globalTopologyCounter = 0;\nconst stateTransition = (0, utils_1.makeStateMachine)({\n    [common_1.STATE_CLOSED]: [common_1.STATE_CLOSED, common_1.STATE_CONNECTING],\n    [common_1.STATE_CONNECTING]: [common_1.STATE_CONNECTING, common_1.STATE_CLOSING, common_1.STATE_CONNECTED, common_1.STATE_CLOSED],\n    [common_1.STATE_CONNECTED]: [common_1.STATE_CONNECTED, common_1.STATE_CLOSING, common_1.STATE_CLOSED],\n    [common_1.STATE_CLOSING]: [common_1.STATE_CLOSING, common_1.STATE_CLOSED]\n});\n/** @internal */\nconst kCancelled = Symbol('cancelled');\n/** @internal */\nconst kWaitQueue = Symbol('waitQueue');\n/**\n * A container of server instances representing a connection to a MongoDB topology.\n * @internal\n */\nclass Topology extends mongo_types_1.TypedEventEmitter {\n    /**\n     * @param seedlist - a list of HostAddress instances to connect to\n     */\n    constructor(client, seeds, options) {\n        super();\n        this.client = client;\n        this.selectServerAsync = (0, util_1.promisify)((selector, options, callback) => this.selectServer(selector, options, callback));\n        // Options should only be undefined in tests, MongoClient will always have defined options\n        options = options ?? {\n            hosts: [utils_1.HostAddress.fromString('localhost:27017')],\n            ...Object.fromEntries(connection_string_1.DEFAULT_OPTIONS.entries()),\n            ...Object.fromEntries(connection_string_1.FEATURE_FLAGS.entries())\n        };\n        if (typeof seeds === 'string') {\n            seeds = [utils_1.HostAddress.fromString(seeds)];\n        }\n        else if (!Array.isArray(seeds)) {\n            seeds = [seeds];\n        }\n        const seedlist = [];\n        for (const seed of seeds) {\n            if (typeof seed === 'string') {\n                seedlist.push(utils_1.HostAddress.fromString(seed));\n            }\n            else if (seed instanceof utils_1.HostAddress) {\n                seedlist.push(seed);\n            }\n            else {\n                // FIXME(NODE-3483): May need to be a MongoParseError\n                throw new error_1.MongoRuntimeError(`Topology cannot be constructed from ${JSON.stringify(seed)}`);\n            }\n        }\n        const topologyType = topologyTypeFromOptions(options);\n        const topologyId = globalTopologyCounter++;\n        const selectedHosts = options.srvMaxHosts == null ||\n            options.srvMaxHosts === 0 ||\n            options.srvMaxHosts >= seedlist.length\n            ? seedlist\n            : (0, utils_1.shuffle)(seedlist, options.srvMaxHosts);\n        const serverDescriptions = new Map();\n        for (const hostAddress of selectedHosts) {\n            serverDescriptions.set(hostAddress.toString(), new server_description_1.ServerDescription(hostAddress));\n        }\n        this[kWaitQueue] = new utils_1.List();\n        this.s = {\n            // the id of this topology\n            id: topologyId,\n            // passed in options\n            options,\n            // initial seedlist of servers to connect to\n            seedlist,\n            // initial state\n            state: common_1.STATE_CLOSED,\n            // the topology description\n            description: new topology_description_1.TopologyDescription(topologyType, serverDescriptions, options.replicaSet, undefined, undefined, undefined, options),\n            serverSelectionTimeoutMS: options.serverSelectionTimeoutMS,\n            heartbeatFrequencyMS: options.heartbeatFrequencyMS,\n            minHeartbeatFrequencyMS: options.minHeartbeatFrequencyMS,\n            // a map of server instances to normalized addresses\n            servers: new Map(),\n            credentials: options?.credentials,\n            clusterTime: undefined,\n            // timer management\n            connectionTimers: new Set(),\n            detectShardedTopology: ev => this.detectShardedTopology(ev),\n            detectSrvRecords: ev => this.detectSrvRecords(ev)\n        };\n        if (options.srvHost && !options.loadBalanced) {\n            this.s.srvPoller =\n                options.srvPoller ??\n                    new srv_polling_1.SrvPoller({\n                        heartbeatFrequencyMS: this.s.heartbeatFrequencyMS,\n                        srvHost: options.srvHost,\n                        srvMaxHosts: options.srvMaxHosts,\n                        srvServiceName: options.srvServiceName\n                    });\n            this.on(Topology.TOPOLOGY_DESCRIPTION_CHANGED, this.s.detectShardedTopology);\n        }\n    }\n    detectShardedTopology(event) {\n        const previousType = event.previousDescription.type;\n        const newType = event.newDescription.type;\n        const transitionToSharded = previousType !== common_1.TopologyType.Sharded && newType === common_1.TopologyType.Sharded;\n        const srvListeners = this.s.srvPoller?.listeners(srv_polling_1.SrvPoller.SRV_RECORD_DISCOVERY);\n        const listeningToSrvPolling = !!srvListeners?.includes(this.s.detectSrvRecords);\n        if (transitionToSharded && !listeningToSrvPolling) {\n            this.s.srvPoller?.on(srv_polling_1.SrvPoller.SRV_RECORD_DISCOVERY, this.s.detectSrvRecords);\n            this.s.srvPoller?.start();\n        }\n    }\n    detectSrvRecords(ev) {\n        const previousTopologyDescription = this.s.description;\n        this.s.description = this.s.description.updateFromSrvPollingEvent(ev, this.s.options.srvMaxHosts);\n        if (this.s.description === previousTopologyDescription) {\n            // Nothing changed, so return\n            return;\n        }\n        updateServers(this);\n        this.emit(Topology.TOPOLOGY_DESCRIPTION_CHANGED, new events_1.TopologyDescriptionChangedEvent(this.s.id, previousTopologyDescription, this.s.description));\n    }\n    /**\n     * @returns A `TopologyDescription` for this topology\n     */\n    get description() {\n        return this.s.description;\n    }\n    get loadBalanced() {\n        return this.s.options.loadBalanced;\n    }\n    get capabilities() {\n        return new ServerCapabilities(this.lastHello());\n    }\n    connect(options, callback) {\n        if (typeof options === 'function')\n            (callback = options), (options = {});\n        options = options ?? {};\n        if (this.s.state === common_1.STATE_CONNECTED) {\n            if (typeof callback === 'function') {\n                callback();\n            }\n            return;\n        }\n        stateTransition(this, common_1.STATE_CONNECTING);\n        // emit SDAM monitoring events\n        this.emit(Topology.TOPOLOGY_OPENING, new events_1.TopologyOpeningEvent(this.s.id));\n        // emit an event for the topology change\n        this.emit(Topology.TOPOLOGY_DESCRIPTION_CHANGED, new events_1.TopologyDescriptionChangedEvent(this.s.id, new topology_description_1.TopologyDescription(common_1.TopologyType.Unknown), // initial is always Unknown\n        this.s.description));\n        // connect all known servers, then attempt server selection to connect\n        const serverDescriptions = Array.from(this.s.description.servers.values());\n        this.s.servers = new Map(serverDescriptions.map(serverDescription => [\n            serverDescription.address,\n            createAndConnectServer(this, serverDescription)\n        ]));\n        // In load balancer mode we need to fake a server description getting\n        // emitted from the monitor, since the monitor doesn't exist.\n        if (this.s.options.loadBalanced) {\n            for (const description of serverDescriptions) {\n                const newDescription = new server_description_1.ServerDescription(description.hostAddress, undefined, {\n                    loadBalanced: this.s.options.loadBalanced\n                });\n                this.serverUpdateHandler(newDescription);\n            }\n        }\n        const exitWithError = (error) => callback ? callback(error) : this.emit(Topology.ERROR, error);\n        const readPreference = options.readPreference ?? read_preference_1.ReadPreference.primary;\n        this.selectServer((0, server_selection_1.readPreferenceServerSelector)(readPreference), options, (err, server) => {\n            if (err) {\n                return this.close({ force: false }, () => exitWithError(err));\n            }\n            // TODO: NODE-2471\n            const skipPingOnConnect = this.s.options[Symbol.for('@@mdb.skipPingOnConnect')] === true;\n            if (!skipPingOnConnect && server && this.s.credentials) {\n                server.command((0, utils_1.ns)('admin.$cmd'), { ping: 1 }, {}, err => {\n                    if (err) {\n                        return exitWithError(err);\n                    }\n                    stateTransition(this, common_1.STATE_CONNECTED);\n                    this.emit(Topology.OPEN, this);\n                    this.emit(Topology.CONNECT, this);\n                    callback?.(undefined, this);\n                });\n                return;\n            }\n            stateTransition(this, common_1.STATE_CONNECTED);\n            this.emit(Topology.OPEN, this);\n            this.emit(Topology.CONNECT, this);\n            callback?.(undefined, this);\n        });\n    }\n    close(options, callback) {\n        options = options ?? { force: false };\n        if (this.s.state === common_1.STATE_CLOSED || this.s.state === common_1.STATE_CLOSING) {\n            return callback?.();\n        }\n        const destroyedServers = Array.from(this.s.servers.values(), server => {\n            return (0, util_1.promisify)(destroyServer)(server, this, { force: !!options?.force });\n        });\n        Promise.all(destroyedServers)\n            .then(() => {\n            this.s.servers.clear();\n            stateTransition(this, common_1.STATE_CLOSING);\n            drainWaitQueue(this[kWaitQueue], new error_1.MongoTopologyClosedError());\n            (0, common_1.drainTimerQueue)(this.s.connectionTimers);\n            if (this.s.srvPoller) {\n                this.s.srvPoller.stop();\n                this.s.srvPoller.removeListener(srv_polling_1.SrvPoller.SRV_RECORD_DISCOVERY, this.s.detectSrvRecords);\n            }\n            this.removeListener(Topology.TOPOLOGY_DESCRIPTION_CHANGED, this.s.detectShardedTopology);\n            stateTransition(this, common_1.STATE_CLOSED);\n            // emit an event for close\n            this.emit(Topology.TOPOLOGY_CLOSED, new events_1.TopologyClosedEvent(this.s.id));\n        })\n            .finally(() => callback?.());\n    }\n    /**\n     * Selects a server according to the selection predicate provided\n     *\n     * @param selector - An optional selector to select servers by, defaults to a random selection within a latency window\n     * @param options - Optional settings related to server selection\n     * @param callback - The callback used to indicate success or failure\n     * @returns An instance of a `Server` meeting the criteria of the predicate provided\n     */\n    selectServer(selector, options, callback) {\n        let serverSelector;\n        if (typeof selector !== 'function') {\n            if (typeof selector === 'string') {\n                serverSelector = (0, server_selection_1.readPreferenceServerSelector)(read_preference_1.ReadPreference.fromString(selector));\n            }\n            else {\n                let readPreference;\n                if (selector instanceof read_preference_1.ReadPreference) {\n                    readPreference = selector;\n                }\n                else {\n                    read_preference_1.ReadPreference.translate(options);\n                    readPreference = options.readPreference || read_preference_1.ReadPreference.primary;\n                }\n                serverSelector = (0, server_selection_1.readPreferenceServerSelector)(readPreference);\n            }\n        }\n        else {\n            serverSelector = selector;\n        }\n        options = Object.assign({}, { serverSelectionTimeoutMS: this.s.serverSelectionTimeoutMS }, options);\n        const isSharded = this.description.type === common_1.TopologyType.Sharded;\n        const session = options.session;\n        const transaction = session && session.transaction;\n        if (isSharded && transaction && transaction.server) {\n            callback(undefined, transaction.server);\n            return;\n        }\n        const waitQueueMember = {\n            serverSelector,\n            transaction,\n            callback\n        };\n        const serverSelectionTimeoutMS = options.serverSelectionTimeoutMS;\n        if (serverSelectionTimeoutMS) {\n            waitQueueMember.timer = (0, timers_1.setTimeout)(() => {\n                waitQueueMember[kCancelled] = true;\n                waitQueueMember.timer = undefined;\n                const timeoutError = new error_1.MongoServerSelectionError(`Server selection timed out after ${serverSelectionTimeoutMS} ms`, this.description);\n                waitQueueMember.callback(timeoutError);\n            }, serverSelectionTimeoutMS);\n        }\n        this[kWaitQueue].push(waitQueueMember);\n        processWaitQueue(this);\n    }\n    /**\n     * Update the internal TopologyDescription with a ServerDescription\n     *\n     * @param serverDescription - The server to update in the internal list of server descriptions\n     */\n    serverUpdateHandler(serverDescription) {\n        if (!this.s.description.hasServer(serverDescription.address)) {\n            return;\n        }\n        // ignore this server update if its from an outdated topologyVersion\n        if (isStaleServerDescription(this.s.description, serverDescription)) {\n            return;\n        }\n        // these will be used for monitoring events later\n        const previousTopologyDescription = this.s.description;\n        const previousServerDescription = this.s.description.servers.get(serverDescription.address);\n        if (!previousServerDescription) {\n            return;\n        }\n        // Driver Sessions Spec: \"Whenever a driver receives a cluster time from\n        // a server it MUST compare it to the current highest seen cluster time\n        // for the deployment. If the new cluster time is higher than the\n        // highest seen cluster time it MUST become the new highest seen cluster\n        // time. Two cluster times are compared using only the BsonTimestamp\n        // value of the clusterTime embedded field.\"\n        const clusterTime = serverDescription.$clusterTime;\n        if (clusterTime) {\n            (0, common_1._advanceClusterTime)(this, clusterTime);\n        }\n        // If we already know all the information contained in this updated description, then\n        // we don't need to emit SDAM events, but still need to update the description, in order\n        // to keep client-tracked attributes like last update time and round trip time up to date\n        const equalDescriptions = previousServerDescription && previousServerDescription.equals(serverDescription);\n        // first update the TopologyDescription\n        this.s.description = this.s.description.update(serverDescription);\n        if (this.s.description.compatibilityError) {\n            this.emit(Topology.ERROR, new error_1.MongoCompatibilityError(this.s.description.compatibilityError));\n            return;\n        }\n        // emit monitoring events for this change\n        if (!equalDescriptions) {\n            const newDescription = this.s.description.servers.get(serverDescription.address);\n            if (newDescription) {\n                this.emit(Topology.SERVER_DESCRIPTION_CHANGED, new events_1.ServerDescriptionChangedEvent(this.s.id, serverDescription.address, previousServerDescription, newDescription));\n            }\n        }\n        // update server list from updated descriptions\n        updateServers(this, serverDescription);\n        // attempt to resolve any outstanding server selection attempts\n        if (this[kWaitQueue].length > 0) {\n            processWaitQueue(this);\n        }\n        if (!equalDescriptions) {\n            this.emit(Topology.TOPOLOGY_DESCRIPTION_CHANGED, new events_1.TopologyDescriptionChangedEvent(this.s.id, previousTopologyDescription, this.s.description));\n        }\n    }\n    auth(credentials, callback) {\n        if (typeof credentials === 'function')\n            (callback = credentials), (credentials = undefined);\n        if (typeof callback === 'function')\n            callback(undefined, true);\n    }\n    get clientMetadata() {\n        return this.s.options.metadata;\n    }\n    isConnected() {\n        return this.s.state === common_1.STATE_CONNECTED;\n    }\n    isDestroyed() {\n        return this.s.state === common_1.STATE_CLOSED;\n    }\n    // NOTE: There are many places in code where we explicitly check the last hello\n    //       to do feature support detection. This should be done any other way, but for\n    //       now we will just return the first hello seen, which should suffice.\n    lastHello() {\n        const serverDescriptions = Array.from(this.description.servers.values());\n        if (serverDescriptions.length === 0)\n            return {};\n        const sd = serverDescriptions.filter((sd) => sd.type !== common_1.ServerType.Unknown)[0];\n        const result = sd || { maxWireVersion: this.description.commonWireVersion };\n        return result;\n    }\n    get commonWireVersion() {\n        return this.description.commonWireVersion;\n    }\n    get logicalSessionTimeoutMinutes() {\n        return this.description.logicalSessionTimeoutMinutes;\n    }\n    get clusterTime() {\n        return this.s.clusterTime;\n    }\n    set clusterTime(clusterTime) {\n        this.s.clusterTime = clusterTime;\n    }\n}\n/** @event */\nTopology.SERVER_OPENING = constants_1.SERVER_OPENING;\n/** @event */\nTopology.SERVER_CLOSED = constants_1.SERVER_CLOSED;\n/** @event */\nTopology.SERVER_DESCRIPTION_CHANGED = constants_1.SERVER_DESCRIPTION_CHANGED;\n/** @event */\nTopology.TOPOLOGY_OPENING = constants_1.TOPOLOGY_OPENING;\n/** @event */\nTopology.TOPOLOGY_CLOSED = constants_1.TOPOLOGY_CLOSED;\n/** @event */\nTopology.TOPOLOGY_DESCRIPTION_CHANGED = constants_1.TOPOLOGY_DESCRIPTION_CHANGED;\n/** @event */\nTopology.ERROR = constants_1.ERROR;\n/** @event */\nTopology.OPEN = constants_1.OPEN;\n/** @event */\nTopology.CONNECT = constants_1.CONNECT;\n/** @event */\nTopology.CLOSE = constants_1.CLOSE;\n/** @event */\nTopology.TIMEOUT = constants_1.TIMEOUT;\nexports.Topology = Topology;\n/** Destroys a server, and removes all event listeners from the instance */\nfunction destroyServer(server, topology, options, callback) {\n    options = options ?? { force: false };\n    for (const event of constants_1.LOCAL_SERVER_EVENTS) {\n        server.removeAllListeners(event);\n    }\n    server.destroy(options, () => {\n        topology.emit(Topology.SERVER_CLOSED, new events_1.ServerClosedEvent(topology.s.id, server.description.address));\n        for (const event of constants_1.SERVER_RELAY_EVENTS) {\n            server.removeAllListeners(event);\n        }\n        if (typeof callback === 'function') {\n            callback();\n        }\n    });\n}\n/** Predicts the TopologyType from options */\nfunction topologyTypeFromOptions(options) {\n    if (options?.directConnection) {\n        return common_1.TopologyType.Single;\n    }\n    if (options?.replicaSet) {\n        return common_1.TopologyType.ReplicaSetNoPrimary;\n    }\n    if (options?.loadBalanced) {\n        return common_1.TopologyType.LoadBalanced;\n    }\n    return common_1.TopologyType.Unknown;\n}\n/**\n * Creates new server instances and attempts to connect them\n *\n * @param topology - The topology that this server belongs to\n * @param serverDescription - The description for the server to initialize and connect to\n */\nfunction createAndConnectServer(topology, serverDescription) {\n    topology.emit(Topology.SERVER_OPENING, new events_1.ServerOpeningEvent(topology.s.id, serverDescription.address));\n    const server = new server_1.Server(topology, serverDescription, topology.s.options);\n    for (const event of constants_1.SERVER_RELAY_EVENTS) {\n        server.on(event, (e) => topology.emit(event, e));\n    }\n    server.on(server_1.Server.DESCRIPTION_RECEIVED, description => topology.serverUpdateHandler(description));\n    server.connect();\n    return server;\n}\n/**\n * @param topology - Topology to update.\n * @param incomingServerDescription - New server description.\n */\nfunction updateServers(topology, incomingServerDescription) {\n    // update the internal server's description\n    if (incomingServerDescription && topology.s.servers.has(incomingServerDescription.address)) {\n        const server = topology.s.servers.get(incomingServerDescription.address);\n        if (server) {\n            server.s.description = incomingServerDescription;\n            if (incomingServerDescription.error instanceof error_1.MongoError &&\n                incomingServerDescription.error.hasErrorLabel(error_1.MongoErrorLabel.ResetPool)) {\n                const interruptInUseConnections = incomingServerDescription.error.hasErrorLabel(error_1.MongoErrorLabel.InterruptInUseConnections);\n                server.pool.clear({ interruptInUseConnections });\n            }\n            else if (incomingServerDescription.error == null) {\n                const newTopologyType = topology.s.description.type;\n                const shouldMarkPoolReady = incomingServerDescription.isDataBearing ||\n                    (incomingServerDescription.type !== common_1.ServerType.Unknown &&\n                        newTopologyType === common_1.TopologyType.Single);\n                if (shouldMarkPoolReady) {\n                    server.pool.ready();\n                }\n            }\n        }\n    }\n    // add new servers for all descriptions we currently don't know about locally\n    for (const serverDescription of topology.description.servers.values()) {\n        if (!topology.s.servers.has(serverDescription.address)) {\n            const server = createAndConnectServer(topology, serverDescription);\n            topology.s.servers.set(serverDescription.address, server);\n        }\n    }\n    // for all servers no longer known, remove their descriptions and destroy their instances\n    for (const entry of topology.s.servers) {\n        const serverAddress = entry[0];\n        if (topology.description.hasServer(serverAddress)) {\n            continue;\n        }\n        if (!topology.s.servers.has(serverAddress)) {\n            continue;\n        }\n        const server = topology.s.servers.get(serverAddress);\n        topology.s.servers.delete(serverAddress);\n        // prepare server for garbage collection\n        if (server) {\n            destroyServer(server, topology);\n        }\n    }\n}\nfunction drainWaitQueue(queue, err) {\n    while (queue.length) {\n        const waitQueueMember = queue.shift();\n        if (!waitQueueMember) {\n            continue;\n        }\n        if (waitQueueMember.timer) {\n            (0, timers_1.clearTimeout)(waitQueueMember.timer);\n        }\n        if (!waitQueueMember[kCancelled]) {\n            waitQueueMember.callback(err);\n        }\n    }\n}\nfunction processWaitQueue(topology) {\n    if (topology.s.state === common_1.STATE_CLOSED) {\n        drainWaitQueue(topology[kWaitQueue], new error_1.MongoTopologyClosedError());\n        return;\n    }\n    const isSharded = topology.description.type === common_1.TopologyType.Sharded;\n    const serverDescriptions = Array.from(topology.description.servers.values());\n    const membersToProcess = topology[kWaitQueue].length;\n    for (let i = 0; i < membersToProcess; ++i) {\n        const waitQueueMember = topology[kWaitQueue].shift();\n        if (!waitQueueMember) {\n            continue;\n        }\n        if (waitQueueMember[kCancelled]) {\n            continue;\n        }\n        let selectedDescriptions;\n        try {\n            const serverSelector = waitQueueMember.serverSelector;\n            selectedDescriptions = serverSelector\n                ? serverSelector(topology.description, serverDescriptions)\n                : serverDescriptions;\n        }\n        catch (e) {\n            if (waitQueueMember.timer) {\n                (0, timers_1.clearTimeout)(waitQueueMember.timer);\n            }\n            waitQueueMember.callback(e);\n            continue;\n        }\n        let selectedServer;\n        if (selectedDescriptions.length === 0) {\n            topology[kWaitQueue].push(waitQueueMember);\n            continue;\n        }\n        else if (selectedDescriptions.length === 1) {\n            selectedServer = topology.s.servers.get(selectedDescriptions[0].address);\n        }\n        else {\n            const descriptions = (0, utils_1.shuffle)(selectedDescriptions, 2);\n            const server1 = topology.s.servers.get(descriptions[0].address);\n            const server2 = topology.s.servers.get(descriptions[1].address);\n            selectedServer =\n                server1 && server2 && server1.s.operationCount < server2.s.operationCount\n                    ? server1\n                    : server2;\n        }\n        if (!selectedServer) {\n            waitQueueMember.callback(new error_1.MongoServerSelectionError('server selection returned a server description but the server was not found in the topology', topology.description));\n            return;\n        }\n        const transaction = waitQueueMember.transaction;\n        if (isSharded && transaction && transaction.isActive && selectedServer) {\n            transaction.pinServer(selectedServer);\n        }\n        if (waitQueueMember.timer) {\n            (0, timers_1.clearTimeout)(waitQueueMember.timer);\n        }\n        waitQueueMember.callback(undefined, selectedServer);\n    }\n    if (topology[kWaitQueue].length > 0) {\n        // ensure all server monitors attempt monitoring soon\n        for (const [, server] of topology.s.servers) {\n            process.nextTick(function scheduleServerCheck() {\n                return server.requestCheck();\n            });\n        }\n    }\n}\nfunction isStaleServerDescription(topologyDescription, incomingServerDescription) {\n    const currentServerDescription = topologyDescription.servers.get(incomingServerDescription.address);\n    const currentTopologyVersion = currentServerDescription?.topologyVersion;\n    return ((0, server_description_1.compareTopologyVersion)(currentTopologyVersion, incomingServerDescription.topologyVersion) > 0);\n}\n/** @public */\nclass ServerCapabilities {\n    constructor(hello) {\n        this.minWireVersion = hello.minWireVersion || 0;\n        this.maxWireVersion = hello.maxWireVersion || 0;\n    }\n    get hasAggregationCursor() {\n        return this.maxWireVersion >= 1;\n    }\n    get hasWriteCommands() {\n        return this.maxWireVersion >= 2;\n    }\n    get hasTextSearch() {\n        return this.minWireVersion >= 0;\n    }\n    get hasAuthCommands() {\n        return this.maxWireVersion >= 1;\n    }\n    get hasListCollectionsCommand() {\n        return this.maxWireVersion >= 3;\n    }\n    get hasListIndexesCommand() {\n        return this.maxWireVersion >= 3;\n    }\n    get supportsSnapshotReads() {\n        return this.maxWireVersion >= 13;\n    }\n    get commandsTakeWriteConcern() {\n        return this.maxWireVersion >= 5;\n    }\n    get commandsTakeCollation() {\n        return this.maxWireVersion >= 5;\n    }\n}\nexports.ServerCapabilities = ServerCapabilities;\n//# sourceMappingURL=topology.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9zZGFtL3RvcG9sb2d5LmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELDBCQUEwQixHQUFHLGdCQUFnQjtBQUM3QyxpQkFBaUIsbUJBQU8sQ0FBQyxzQkFBUTtBQUNqQyxlQUFlLG1CQUFPLENBQUMsa0JBQU07QUFDN0IsNEJBQTRCLG1CQUFPLENBQUMsMkZBQXNCO0FBQzFELG9CQUFvQixtQkFBTyxDQUFDLDJFQUFjO0FBQzFDLGdCQUFnQixtQkFBTyxDQUFDLG1FQUFVO0FBQ2xDLHNCQUFzQixtQkFBTyxDQUFDLCtFQUFnQjtBQUM5QywwQkFBMEIsbUJBQU8sQ0FBQyx1RkFBb0I7QUFDdEQsZ0JBQWdCLG1CQUFPLENBQUMsbUVBQVU7QUFDbEMsaUJBQWlCLG1CQUFPLENBQUMseUVBQVU7QUFDbkMsaUJBQWlCLG1CQUFPLENBQUMseUVBQVU7QUFDbkMsaUJBQWlCLG1CQUFPLENBQUMseUVBQVU7QUFDbkMsNkJBQTZCLG1CQUFPLENBQUMsaUdBQXNCO0FBQzNELDJCQUEyQixtQkFBTyxDQUFDLDZGQUFvQjtBQUN2RCxzQkFBc0IsbUJBQU8sQ0FBQyxtRkFBZTtBQUM3QywrQkFBK0IsbUJBQU8sQ0FBQyxxR0FBd0I7QUFDL0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJGQUEyRixxQkFBcUI7QUFDaEg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQ0FBK0M7QUFDL0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQ0FBb0MsY0FBYztBQUNsRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdFQUFnRSxTQUFTLElBQUk7QUFDN0U7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSwrQkFBK0I7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3RUFBd0UseUJBQXlCO0FBQ2pHLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0NBQWtDLElBQUksMkRBQTJEO0FBQ2pHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrR0FBK0csMEJBQTBCO0FBQ3pJO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0I7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0I7QUFDaEI7QUFDQTtBQUNBLDJCQUEyQjtBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0NBQW9DLDJCQUEyQjtBQUMvRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixzQkFBc0I7QUFDMUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEI7QUFDMUIiLCJzb3VyY2VzIjpbIkQ6XFxzYWxvbmlcXGFwcHJhaXNhbC1zeXN0ZW1cXHNlcnZlclxcbm9kZV9tb2R1bGVzXFxtb25nb2RiXFxsaWJcXHNkYW1cXHRvcG9sb2d5LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5TZXJ2ZXJDYXBhYmlsaXRpZXMgPSBleHBvcnRzLlRvcG9sb2d5ID0gdm9pZCAwO1xuY29uc3QgdGltZXJzXzEgPSByZXF1aXJlKFwidGltZXJzXCIpO1xuY29uc3QgdXRpbF8xID0gcmVxdWlyZShcInV0aWxcIik7XG5jb25zdCBjb25uZWN0aW9uX3N0cmluZ18xID0gcmVxdWlyZShcIi4uL2Nvbm5lY3Rpb25fc3RyaW5nXCIpO1xuY29uc3QgY29uc3RhbnRzXzEgPSByZXF1aXJlKFwiLi4vY29uc3RhbnRzXCIpO1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuLi9lcnJvclwiKTtcbmNvbnN0IG1vbmdvX3R5cGVzXzEgPSByZXF1aXJlKFwiLi4vbW9uZ29fdHlwZXNcIik7XG5jb25zdCByZWFkX3ByZWZlcmVuY2VfMSA9IHJlcXVpcmUoXCIuLi9yZWFkX3ByZWZlcmVuY2VcIik7XG5jb25zdCB1dGlsc18xID0gcmVxdWlyZShcIi4uL3V0aWxzXCIpO1xuY29uc3QgY29tbW9uXzEgPSByZXF1aXJlKFwiLi9jb21tb25cIik7XG5jb25zdCBldmVudHNfMSA9IHJlcXVpcmUoXCIuL2V2ZW50c1wiKTtcbmNvbnN0IHNlcnZlcl8xID0gcmVxdWlyZShcIi4vc2VydmVyXCIpO1xuY29uc3Qgc2VydmVyX2Rlc2NyaXB0aW9uXzEgPSByZXF1aXJlKFwiLi9zZXJ2ZXJfZGVzY3JpcHRpb25cIik7XG5jb25zdCBzZXJ2ZXJfc2VsZWN0aW9uXzEgPSByZXF1aXJlKFwiLi9zZXJ2ZXJfc2VsZWN0aW9uXCIpO1xuY29uc3Qgc3J2X3BvbGxpbmdfMSA9IHJlcXVpcmUoXCIuL3Nydl9wb2xsaW5nXCIpO1xuY29uc3QgdG9wb2xvZ3lfZGVzY3JpcHRpb25fMSA9IHJlcXVpcmUoXCIuL3RvcG9sb2d5X2Rlc2NyaXB0aW9uXCIpO1xuLy8gR2xvYmFsIHN0YXRlXG5sZXQgZ2xvYmFsVG9wb2xvZ3lDb3VudGVyID0gMDtcbmNvbnN0IHN0YXRlVHJhbnNpdGlvbiA9ICgwLCB1dGlsc18xLm1ha2VTdGF0ZU1hY2hpbmUpKHtcbiAgICBbY29tbW9uXzEuU1RBVEVfQ0xPU0VEXTogW2NvbW1vbl8xLlNUQVRFX0NMT1NFRCwgY29tbW9uXzEuU1RBVEVfQ09OTkVDVElOR10sXG4gICAgW2NvbW1vbl8xLlNUQVRFX0NPTk5FQ1RJTkddOiBbY29tbW9uXzEuU1RBVEVfQ09OTkVDVElORywgY29tbW9uXzEuU1RBVEVfQ0xPU0lORywgY29tbW9uXzEuU1RBVEVfQ09OTkVDVEVELCBjb21tb25fMS5TVEFURV9DTE9TRURdLFxuICAgIFtjb21tb25fMS5TVEFURV9DT05ORUNURURdOiBbY29tbW9uXzEuU1RBVEVfQ09OTkVDVEVELCBjb21tb25fMS5TVEFURV9DTE9TSU5HLCBjb21tb25fMS5TVEFURV9DTE9TRURdLFxuICAgIFtjb21tb25fMS5TVEFURV9DTE9TSU5HXTogW2NvbW1vbl8xLlNUQVRFX0NMT1NJTkcsIGNvbW1vbl8xLlNUQVRFX0NMT1NFRF1cbn0pO1xuLyoqIEBpbnRlcm5hbCAqL1xuY29uc3Qga0NhbmNlbGxlZCA9IFN5bWJvbCgnY2FuY2VsbGVkJyk7XG4vKiogQGludGVybmFsICovXG5jb25zdCBrV2FpdFF1ZXVlID0gU3ltYm9sKCd3YWl0UXVldWUnKTtcbi8qKlxuICogQSBjb250YWluZXIgb2Ygc2VydmVyIGluc3RhbmNlcyByZXByZXNlbnRpbmcgYSBjb25uZWN0aW9uIHRvIGEgTW9uZ29EQiB0b3BvbG9neS5cbiAqIEBpbnRlcm5hbFxuICovXG5jbGFzcyBUb3BvbG9neSBleHRlbmRzIG1vbmdvX3R5cGVzXzEuVHlwZWRFdmVudEVtaXR0ZXIge1xuICAgIC8qKlxuICAgICAqIEBwYXJhbSBzZWVkbGlzdCAtIGEgbGlzdCBvZiBIb3N0QWRkcmVzcyBpbnN0YW5jZXMgdG8gY29ubmVjdCB0b1xuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGNsaWVudCwgc2VlZHMsIG9wdGlvbnMpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5jbGllbnQgPSBjbGllbnQ7XG4gICAgICAgIHRoaXMuc2VsZWN0U2VydmVyQXN5bmMgPSAoMCwgdXRpbF8xLnByb21pc2lmeSkoKHNlbGVjdG9yLCBvcHRpb25zLCBjYWxsYmFjaykgPT4gdGhpcy5zZWxlY3RTZXJ2ZXIoc2VsZWN0b3IsIG9wdGlvbnMsIGNhbGxiYWNrKSk7XG4gICAgICAgIC8vIE9wdGlvbnMgc2hvdWxkIG9ubHkgYmUgdW5kZWZpbmVkIGluIHRlc3RzLCBNb25nb0NsaWVudCB3aWxsIGFsd2F5cyBoYXZlIGRlZmluZWQgb3B0aW9uc1xuICAgICAgICBvcHRpb25zID0gb3B0aW9ucyA/PyB7XG4gICAgICAgICAgICBob3N0czogW3V0aWxzXzEuSG9zdEFkZHJlc3MuZnJvbVN0cmluZygnbG9jYWxob3N0OjI3MDE3JyldLFxuICAgICAgICAgICAgLi4uT2JqZWN0LmZyb21FbnRyaWVzKGNvbm5lY3Rpb25fc3RyaW5nXzEuREVGQVVMVF9PUFRJT05TLmVudHJpZXMoKSksXG4gICAgICAgICAgICAuLi5PYmplY3QuZnJvbUVudHJpZXMoY29ubmVjdGlvbl9zdHJpbmdfMS5GRUFUVVJFX0ZMQUdTLmVudHJpZXMoKSlcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKHR5cGVvZiBzZWVkcyA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHNlZWRzID0gW3V0aWxzXzEuSG9zdEFkZHJlc3MuZnJvbVN0cmluZyhzZWVkcyldO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKCFBcnJheS5pc0FycmF5KHNlZWRzKSkge1xuICAgICAgICAgICAgc2VlZHMgPSBbc2VlZHNdO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHNlZWRsaXN0ID0gW107XG4gICAgICAgIGZvciAoY29uc3Qgc2VlZCBvZiBzZWVkcykge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBzZWVkID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIHNlZWRsaXN0LnB1c2godXRpbHNfMS5Ib3N0QWRkcmVzcy5mcm9tU3RyaW5nKHNlZWQpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHNlZWQgaW5zdGFuY2VvZiB1dGlsc18xLkhvc3RBZGRyZXNzKSB7XG4gICAgICAgICAgICAgICAgc2VlZGxpc3QucHVzaChzZWVkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIEZJWE1FKE5PREUtMzQ4Myk6IE1heSBuZWVkIHRvIGJlIGEgTW9uZ29QYXJzZUVycm9yXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29SdW50aW1lRXJyb3IoYFRvcG9sb2d5IGNhbm5vdCBiZSBjb25zdHJ1Y3RlZCBmcm9tICR7SlNPTi5zdHJpbmdpZnkoc2VlZCl9YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdG9wb2xvZ3lUeXBlID0gdG9wb2xvZ3lUeXBlRnJvbU9wdGlvbnMob3B0aW9ucyk7XG4gICAgICAgIGNvbnN0IHRvcG9sb2d5SWQgPSBnbG9iYWxUb3BvbG9neUNvdW50ZXIrKztcbiAgICAgICAgY29uc3Qgc2VsZWN0ZWRIb3N0cyA9IG9wdGlvbnMuc3J2TWF4SG9zdHMgPT0gbnVsbCB8fFxuICAgICAgICAgICAgb3B0aW9ucy5zcnZNYXhIb3N0cyA9PT0gMCB8fFxuICAgICAgICAgICAgb3B0aW9ucy5zcnZNYXhIb3N0cyA+PSBzZWVkbGlzdC5sZW5ndGhcbiAgICAgICAgICAgID8gc2VlZGxpc3RcbiAgICAgICAgICAgIDogKDAsIHV0aWxzXzEuc2h1ZmZsZSkoc2VlZGxpc3QsIG9wdGlvbnMuc3J2TWF4SG9zdHMpO1xuICAgICAgICBjb25zdCBzZXJ2ZXJEZXNjcmlwdGlvbnMgPSBuZXcgTWFwKCk7XG4gICAgICAgIGZvciAoY29uc3QgaG9zdEFkZHJlc3Mgb2Ygc2VsZWN0ZWRIb3N0cykge1xuICAgICAgICAgICAgc2VydmVyRGVzY3JpcHRpb25zLnNldChob3N0QWRkcmVzcy50b1N0cmluZygpLCBuZXcgc2VydmVyX2Rlc2NyaXB0aW9uXzEuU2VydmVyRGVzY3JpcHRpb24oaG9zdEFkZHJlc3MpKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzW2tXYWl0UXVldWVdID0gbmV3IHV0aWxzXzEuTGlzdCgpO1xuICAgICAgICB0aGlzLnMgPSB7XG4gICAgICAgICAgICAvLyB0aGUgaWQgb2YgdGhpcyB0b3BvbG9neVxuICAgICAgICAgICAgaWQ6IHRvcG9sb2d5SWQsXG4gICAgICAgICAgICAvLyBwYXNzZWQgaW4gb3B0aW9uc1xuICAgICAgICAgICAgb3B0aW9ucyxcbiAgICAgICAgICAgIC8vIGluaXRpYWwgc2VlZGxpc3Qgb2Ygc2VydmVycyB0byBjb25uZWN0IHRvXG4gICAgICAgICAgICBzZWVkbGlzdCxcbiAgICAgICAgICAgIC8vIGluaXRpYWwgc3RhdGVcbiAgICAgICAgICAgIHN0YXRlOiBjb21tb25fMS5TVEFURV9DTE9TRUQsXG4gICAgICAgICAgICAvLyB0aGUgdG9wb2xvZ3kgZGVzY3JpcHRpb25cbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBuZXcgdG9wb2xvZ3lfZGVzY3JpcHRpb25fMS5Ub3BvbG9neURlc2NyaXB0aW9uKHRvcG9sb2d5VHlwZSwgc2VydmVyRGVzY3JpcHRpb25zLCBvcHRpb25zLnJlcGxpY2FTZXQsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIG9wdGlvbnMpLFxuICAgICAgICAgICAgc2VydmVyU2VsZWN0aW9uVGltZW91dE1TOiBvcHRpb25zLnNlcnZlclNlbGVjdGlvblRpbWVvdXRNUyxcbiAgICAgICAgICAgIGhlYXJ0YmVhdEZyZXF1ZW5jeU1TOiBvcHRpb25zLmhlYXJ0YmVhdEZyZXF1ZW5jeU1TLFxuICAgICAgICAgICAgbWluSGVhcnRiZWF0RnJlcXVlbmN5TVM6IG9wdGlvbnMubWluSGVhcnRiZWF0RnJlcXVlbmN5TVMsXG4gICAgICAgICAgICAvLyBhIG1hcCBvZiBzZXJ2ZXIgaW5zdGFuY2VzIHRvIG5vcm1hbGl6ZWQgYWRkcmVzc2VzXG4gICAgICAgICAgICBzZXJ2ZXJzOiBuZXcgTWFwKCksXG4gICAgICAgICAgICBjcmVkZW50aWFsczogb3B0aW9ucz8uY3JlZGVudGlhbHMsXG4gICAgICAgICAgICBjbHVzdGVyVGltZTogdW5kZWZpbmVkLFxuICAgICAgICAgICAgLy8gdGltZXIgbWFuYWdlbWVudFxuICAgICAgICAgICAgY29ubmVjdGlvblRpbWVyczogbmV3IFNldCgpLFxuICAgICAgICAgICAgZGV0ZWN0U2hhcmRlZFRvcG9sb2d5OiBldiA9PiB0aGlzLmRldGVjdFNoYXJkZWRUb3BvbG9neShldiksXG4gICAgICAgICAgICBkZXRlY3RTcnZSZWNvcmRzOiBldiA9PiB0aGlzLmRldGVjdFNydlJlY29yZHMoZXYpXG4gICAgICAgIH07XG4gICAgICAgIGlmIChvcHRpb25zLnNydkhvc3QgJiYgIW9wdGlvbnMubG9hZEJhbGFuY2VkKSB7XG4gICAgICAgICAgICB0aGlzLnMuc3J2UG9sbGVyID1cbiAgICAgICAgICAgICAgICBvcHRpb25zLnNydlBvbGxlciA/P1xuICAgICAgICAgICAgICAgICAgICBuZXcgc3J2X3BvbGxpbmdfMS5TcnZQb2xsZXIoe1xuICAgICAgICAgICAgICAgICAgICAgICAgaGVhcnRiZWF0RnJlcXVlbmN5TVM6IHRoaXMucy5oZWFydGJlYXRGcmVxdWVuY3lNUyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNydkhvc3Q6IG9wdGlvbnMuc3J2SG9zdCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNydk1heEhvc3RzOiBvcHRpb25zLnNydk1heEhvc3RzLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3J2U2VydmljZU5hbWU6IG9wdGlvbnMuc3J2U2VydmljZU5hbWVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLm9uKFRvcG9sb2d5LlRPUE9MT0dZX0RFU0NSSVBUSU9OX0NIQU5HRUQsIHRoaXMucy5kZXRlY3RTaGFyZGVkVG9wb2xvZ3kpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGRldGVjdFNoYXJkZWRUb3BvbG9neShldmVudCkge1xuICAgICAgICBjb25zdCBwcmV2aW91c1R5cGUgPSBldmVudC5wcmV2aW91c0Rlc2NyaXB0aW9uLnR5cGU7XG4gICAgICAgIGNvbnN0IG5ld1R5cGUgPSBldmVudC5uZXdEZXNjcmlwdGlvbi50eXBlO1xuICAgICAgICBjb25zdCB0cmFuc2l0aW9uVG9TaGFyZGVkID0gcHJldmlvdXNUeXBlICE9PSBjb21tb25fMS5Ub3BvbG9neVR5cGUuU2hhcmRlZCAmJiBuZXdUeXBlID09PSBjb21tb25fMS5Ub3BvbG9neVR5cGUuU2hhcmRlZDtcbiAgICAgICAgY29uc3Qgc3J2TGlzdGVuZXJzID0gdGhpcy5zLnNydlBvbGxlcj8ubGlzdGVuZXJzKHNydl9wb2xsaW5nXzEuU3J2UG9sbGVyLlNSVl9SRUNPUkRfRElTQ09WRVJZKTtcbiAgICAgICAgY29uc3QgbGlzdGVuaW5nVG9TcnZQb2xsaW5nID0gISFzcnZMaXN0ZW5lcnM/LmluY2x1ZGVzKHRoaXMucy5kZXRlY3RTcnZSZWNvcmRzKTtcbiAgICAgICAgaWYgKHRyYW5zaXRpb25Ub1NoYXJkZWQgJiYgIWxpc3RlbmluZ1RvU3J2UG9sbGluZykge1xuICAgICAgICAgICAgdGhpcy5zLnNydlBvbGxlcj8ub24oc3J2X3BvbGxpbmdfMS5TcnZQb2xsZXIuU1JWX1JFQ09SRF9ESVNDT1ZFUlksIHRoaXMucy5kZXRlY3RTcnZSZWNvcmRzKTtcbiAgICAgICAgICAgIHRoaXMucy5zcnZQb2xsZXI/LnN0YXJ0KCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZGV0ZWN0U3J2UmVjb3Jkcyhldikge1xuICAgICAgICBjb25zdCBwcmV2aW91c1RvcG9sb2d5RGVzY3JpcHRpb24gPSB0aGlzLnMuZGVzY3JpcHRpb247XG4gICAgICAgIHRoaXMucy5kZXNjcmlwdGlvbiA9IHRoaXMucy5kZXNjcmlwdGlvbi51cGRhdGVGcm9tU3J2UG9sbGluZ0V2ZW50KGV2LCB0aGlzLnMub3B0aW9ucy5zcnZNYXhIb3N0cyk7XG4gICAgICAgIGlmICh0aGlzLnMuZGVzY3JpcHRpb24gPT09IHByZXZpb3VzVG9wb2xvZ3lEZXNjcmlwdGlvbikge1xuICAgICAgICAgICAgLy8gTm90aGluZyBjaGFuZ2VkLCBzbyByZXR1cm5cbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB1cGRhdGVTZXJ2ZXJzKHRoaXMpO1xuICAgICAgICB0aGlzLmVtaXQoVG9wb2xvZ3kuVE9QT0xPR1lfREVTQ1JJUFRJT05fQ0hBTkdFRCwgbmV3IGV2ZW50c18xLlRvcG9sb2d5RGVzY3JpcHRpb25DaGFuZ2VkRXZlbnQodGhpcy5zLmlkLCBwcmV2aW91c1RvcG9sb2d5RGVzY3JpcHRpb24sIHRoaXMucy5kZXNjcmlwdGlvbikpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAcmV0dXJucyBBIGBUb3BvbG9neURlc2NyaXB0aW9uYCBmb3IgdGhpcyB0b3BvbG9neVxuICAgICAqL1xuICAgIGdldCBkZXNjcmlwdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucy5kZXNjcmlwdGlvbjtcbiAgICB9XG4gICAgZ2V0IGxvYWRCYWxhbmNlZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucy5vcHRpb25zLmxvYWRCYWxhbmNlZDtcbiAgICB9XG4gICAgZ2V0IGNhcGFiaWxpdGllcygpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBTZXJ2ZXJDYXBhYmlsaXRpZXModGhpcy5sYXN0SGVsbG8oKSk7XG4gICAgfVxuICAgIGNvbm5lY3Qob3B0aW9ucywgY2FsbGJhY2spIHtcbiAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zID09PSAnZnVuY3Rpb24nKVxuICAgICAgICAgICAgKGNhbGxiYWNrID0gb3B0aW9ucyksIChvcHRpb25zID0ge30pO1xuICAgICAgICBvcHRpb25zID0gb3B0aW9ucyA/PyB7fTtcbiAgICAgICAgaWYgKHRoaXMucy5zdGF0ZSA9PT0gY29tbW9uXzEuU1RBVEVfQ09OTkVDVEVEKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIGNhbGxiYWNrID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBzdGF0ZVRyYW5zaXRpb24odGhpcywgY29tbW9uXzEuU1RBVEVfQ09OTkVDVElORyk7XG4gICAgICAgIC8vIGVtaXQgU0RBTSBtb25pdG9yaW5nIGV2ZW50c1xuICAgICAgICB0aGlzLmVtaXQoVG9wb2xvZ3kuVE9QT0xPR1lfT1BFTklORywgbmV3IGV2ZW50c18xLlRvcG9sb2d5T3BlbmluZ0V2ZW50KHRoaXMucy5pZCkpO1xuICAgICAgICAvLyBlbWl0IGFuIGV2ZW50IGZvciB0aGUgdG9wb2xvZ3kgY2hhbmdlXG4gICAgICAgIHRoaXMuZW1pdChUb3BvbG9neS5UT1BPTE9HWV9ERVNDUklQVElPTl9DSEFOR0VELCBuZXcgZXZlbnRzXzEuVG9wb2xvZ3lEZXNjcmlwdGlvbkNoYW5nZWRFdmVudCh0aGlzLnMuaWQsIG5ldyB0b3BvbG9neV9kZXNjcmlwdGlvbl8xLlRvcG9sb2d5RGVzY3JpcHRpb24oY29tbW9uXzEuVG9wb2xvZ3lUeXBlLlVua25vd24pLCAvLyBpbml0aWFsIGlzIGFsd2F5cyBVbmtub3duXG4gICAgICAgIHRoaXMucy5kZXNjcmlwdGlvbikpO1xuICAgICAgICAvLyBjb25uZWN0IGFsbCBrbm93biBzZXJ2ZXJzLCB0aGVuIGF0dGVtcHQgc2VydmVyIHNlbGVjdGlvbiB0byBjb25uZWN0XG4gICAgICAgIGNvbnN0IHNlcnZlckRlc2NyaXB0aW9ucyA9IEFycmF5LmZyb20odGhpcy5zLmRlc2NyaXB0aW9uLnNlcnZlcnMudmFsdWVzKCkpO1xuICAgICAgICB0aGlzLnMuc2VydmVycyA9IG5ldyBNYXAoc2VydmVyRGVzY3JpcHRpb25zLm1hcChzZXJ2ZXJEZXNjcmlwdGlvbiA9PiBbXG4gICAgICAgICAgICBzZXJ2ZXJEZXNjcmlwdGlvbi5hZGRyZXNzLFxuICAgICAgICAgICAgY3JlYXRlQW5kQ29ubmVjdFNlcnZlcih0aGlzLCBzZXJ2ZXJEZXNjcmlwdGlvbilcbiAgICAgICAgXSkpO1xuICAgICAgICAvLyBJbiBsb2FkIGJhbGFuY2VyIG1vZGUgd2UgbmVlZCB0byBmYWtlIGEgc2VydmVyIGRlc2NyaXB0aW9uIGdldHRpbmdcbiAgICAgICAgLy8gZW1pdHRlZCBmcm9tIHRoZSBtb25pdG9yLCBzaW5jZSB0aGUgbW9uaXRvciBkb2Vzbid0IGV4aXN0LlxuICAgICAgICBpZiAodGhpcy5zLm9wdGlvbnMubG9hZEJhbGFuY2VkKSB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGRlc2NyaXB0aW9uIG9mIHNlcnZlckRlc2NyaXB0aW9ucykge1xuICAgICAgICAgICAgICAgIGNvbnN0IG5ld0Rlc2NyaXB0aW9uID0gbmV3IHNlcnZlcl9kZXNjcmlwdGlvbl8xLlNlcnZlckRlc2NyaXB0aW9uKGRlc2NyaXB0aW9uLmhvc3RBZGRyZXNzLCB1bmRlZmluZWQsIHtcbiAgICAgICAgICAgICAgICAgICAgbG9hZEJhbGFuY2VkOiB0aGlzLnMub3B0aW9ucy5sb2FkQmFsYW5jZWRcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB0aGlzLnNlcnZlclVwZGF0ZUhhbmRsZXIobmV3RGVzY3JpcHRpb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGV4aXRXaXRoRXJyb3IgPSAoZXJyb3IpID0+IGNhbGxiYWNrID8gY2FsbGJhY2soZXJyb3IpIDogdGhpcy5lbWl0KFRvcG9sb2d5LkVSUk9SLCBlcnJvcik7XG4gICAgICAgIGNvbnN0IHJlYWRQcmVmZXJlbmNlID0gb3B0aW9ucy5yZWFkUHJlZmVyZW5jZSA/PyByZWFkX3ByZWZlcmVuY2VfMS5SZWFkUHJlZmVyZW5jZS5wcmltYXJ5O1xuICAgICAgICB0aGlzLnNlbGVjdFNlcnZlcigoMCwgc2VydmVyX3NlbGVjdGlvbl8xLnJlYWRQcmVmZXJlbmNlU2VydmVyU2VsZWN0b3IpKHJlYWRQcmVmZXJlbmNlKSwgb3B0aW9ucywgKGVyciwgc2VydmVyKSA9PiB7XG4gICAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2xvc2UoeyBmb3JjZTogZmFsc2UgfSwgKCkgPT4gZXhpdFdpdGhFcnJvcihlcnIpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIFRPRE86IE5PREUtMjQ3MVxuICAgICAgICAgICAgY29uc3Qgc2tpcFBpbmdPbkNvbm5lY3QgPSB0aGlzLnMub3B0aW9uc1tTeW1ib2wuZm9yKCdAQG1kYi5za2lwUGluZ09uQ29ubmVjdCcpXSA9PT0gdHJ1ZTtcbiAgICAgICAgICAgIGlmICghc2tpcFBpbmdPbkNvbm5lY3QgJiYgc2VydmVyICYmIHRoaXMucy5jcmVkZW50aWFscykge1xuICAgICAgICAgICAgICAgIHNlcnZlci5jb21tYW5kKCgwLCB1dGlsc18xLm5zKSgnYWRtaW4uJGNtZCcpLCB7IHBpbmc6IDEgfSwge30sIGVyciA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBleGl0V2l0aEVycm9yKGVycik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgc3RhdGVUcmFuc2l0aW9uKHRoaXMsIGNvbW1vbl8xLlNUQVRFX0NPTk5FQ1RFRCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZW1pdChUb3BvbG9neS5PUEVOLCB0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0KFRvcG9sb2d5LkNPTk5FQ1QsIHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaz8uKHVuZGVmaW5lZCwgdGhpcyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc3RhdGVUcmFuc2l0aW9uKHRoaXMsIGNvbW1vbl8xLlNUQVRFX0NPTk5FQ1RFRCk7XG4gICAgICAgICAgICB0aGlzLmVtaXQoVG9wb2xvZ3kuT1BFTiwgdGhpcyk7XG4gICAgICAgICAgICB0aGlzLmVtaXQoVG9wb2xvZ3kuQ09OTkVDVCwgdGhpcyk7XG4gICAgICAgICAgICBjYWxsYmFjaz8uKHVuZGVmaW5lZCwgdGhpcyk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBjbG9zZShvcHRpb25zLCBjYWxsYmFjaykge1xuICAgICAgICBvcHRpb25zID0gb3B0aW9ucyA/PyB7IGZvcmNlOiBmYWxzZSB9O1xuICAgICAgICBpZiAodGhpcy5zLnN0YXRlID09PSBjb21tb25fMS5TVEFURV9DTE9TRUQgfHwgdGhpcy5zLnN0YXRlID09PSBjb21tb25fMS5TVEFURV9DTE9TSU5HKSB7XG4gICAgICAgICAgICByZXR1cm4gY2FsbGJhY2s/LigpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGRlc3Ryb3llZFNlcnZlcnMgPSBBcnJheS5mcm9tKHRoaXMucy5zZXJ2ZXJzLnZhbHVlcygpLCBzZXJ2ZXIgPT4ge1xuICAgICAgICAgICAgcmV0dXJuICgwLCB1dGlsXzEucHJvbWlzaWZ5KShkZXN0cm95U2VydmVyKShzZXJ2ZXIsIHRoaXMsIHsgZm9yY2U6ICEhb3B0aW9ucz8uZm9yY2UgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICBQcm9taXNlLmFsbChkZXN0cm95ZWRTZXJ2ZXJzKVxuICAgICAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zLnNlcnZlcnMuY2xlYXIoKTtcbiAgICAgICAgICAgIHN0YXRlVHJhbnNpdGlvbih0aGlzLCBjb21tb25fMS5TVEFURV9DTE9TSU5HKTtcbiAgICAgICAgICAgIGRyYWluV2FpdFF1ZXVlKHRoaXNba1dhaXRRdWV1ZV0sIG5ldyBlcnJvcl8xLk1vbmdvVG9wb2xvZ3lDbG9zZWRFcnJvcigpKTtcbiAgICAgICAgICAgICgwLCBjb21tb25fMS5kcmFpblRpbWVyUXVldWUpKHRoaXMucy5jb25uZWN0aW9uVGltZXJzKTtcbiAgICAgICAgICAgIGlmICh0aGlzLnMuc3J2UG9sbGVyKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zLnNydlBvbGxlci5zdG9wKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5zLnNydlBvbGxlci5yZW1vdmVMaXN0ZW5lcihzcnZfcG9sbGluZ18xLlNydlBvbGxlci5TUlZfUkVDT1JEX0RJU0NPVkVSWSwgdGhpcy5zLmRldGVjdFNydlJlY29yZHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5yZW1vdmVMaXN0ZW5lcihUb3BvbG9neS5UT1BPTE9HWV9ERVNDUklQVElPTl9DSEFOR0VELCB0aGlzLnMuZGV0ZWN0U2hhcmRlZFRvcG9sb2d5KTtcbiAgICAgICAgICAgIHN0YXRlVHJhbnNpdGlvbih0aGlzLCBjb21tb25fMS5TVEFURV9DTE9TRUQpO1xuICAgICAgICAgICAgLy8gZW1pdCBhbiBldmVudCBmb3IgY2xvc2VcbiAgICAgICAgICAgIHRoaXMuZW1pdChUb3BvbG9neS5UT1BPTE9HWV9DTE9TRUQsIG5ldyBldmVudHNfMS5Ub3BvbG9neUNsb3NlZEV2ZW50KHRoaXMucy5pZCkpO1xuICAgICAgICB9KVxuICAgICAgICAgICAgLmZpbmFsbHkoKCkgPT4gY2FsbGJhY2s/LigpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU2VsZWN0cyBhIHNlcnZlciBhY2NvcmRpbmcgdG8gdGhlIHNlbGVjdGlvbiBwcmVkaWNhdGUgcHJvdmlkZWRcbiAgICAgKlxuICAgICAqIEBwYXJhbSBzZWxlY3RvciAtIEFuIG9wdGlvbmFsIHNlbGVjdG9yIHRvIHNlbGVjdCBzZXJ2ZXJzIGJ5LCBkZWZhdWx0cyB0byBhIHJhbmRvbSBzZWxlY3Rpb24gd2l0aGluIGEgbGF0ZW5jeSB3aW5kb3dcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzIHJlbGF0ZWQgdG8gc2VydmVyIHNlbGVjdGlvblxuICAgICAqIEBwYXJhbSBjYWxsYmFjayAtIFRoZSBjYWxsYmFjayB1c2VkIHRvIGluZGljYXRlIHN1Y2Nlc3Mgb3IgZmFpbHVyZVxuICAgICAqIEByZXR1cm5zIEFuIGluc3RhbmNlIG9mIGEgYFNlcnZlcmAgbWVldGluZyB0aGUgY3JpdGVyaWEgb2YgdGhlIHByZWRpY2F0ZSBwcm92aWRlZFxuICAgICAqL1xuICAgIHNlbGVjdFNlcnZlcihzZWxlY3Rvciwgb3B0aW9ucywgY2FsbGJhY2spIHtcbiAgICAgICAgbGV0IHNlcnZlclNlbGVjdG9yO1xuICAgICAgICBpZiAodHlwZW9mIHNlbGVjdG9yICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHNlbGVjdG9yID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIHNlcnZlclNlbGVjdG9yID0gKDAsIHNlcnZlcl9zZWxlY3Rpb25fMS5yZWFkUHJlZmVyZW5jZVNlcnZlclNlbGVjdG9yKShyZWFkX3ByZWZlcmVuY2VfMS5SZWFkUHJlZmVyZW5jZS5mcm9tU3RyaW5nKHNlbGVjdG9yKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBsZXQgcmVhZFByZWZlcmVuY2U7XG4gICAgICAgICAgICAgICAgaWYgKHNlbGVjdG9yIGluc3RhbmNlb2YgcmVhZF9wcmVmZXJlbmNlXzEuUmVhZFByZWZlcmVuY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVhZFByZWZlcmVuY2UgPSBzZWxlY3RvcjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJlYWRfcHJlZmVyZW5jZV8xLlJlYWRQcmVmZXJlbmNlLnRyYW5zbGF0ZShvcHRpb25zKTtcbiAgICAgICAgICAgICAgICAgICAgcmVhZFByZWZlcmVuY2UgPSBvcHRpb25zLnJlYWRQcmVmZXJlbmNlIHx8IHJlYWRfcHJlZmVyZW5jZV8xLlJlYWRQcmVmZXJlbmNlLnByaW1hcnk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHNlcnZlclNlbGVjdG9yID0gKDAsIHNlcnZlcl9zZWxlY3Rpb25fMS5yZWFkUHJlZmVyZW5jZVNlcnZlclNlbGVjdG9yKShyZWFkUHJlZmVyZW5jZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBzZXJ2ZXJTZWxlY3RvciA9IHNlbGVjdG9yO1xuICAgICAgICB9XG4gICAgICAgIG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHt9LCB7IHNlcnZlclNlbGVjdGlvblRpbWVvdXRNUzogdGhpcy5zLnNlcnZlclNlbGVjdGlvblRpbWVvdXRNUyB9LCBvcHRpb25zKTtcbiAgICAgICAgY29uc3QgaXNTaGFyZGVkID0gdGhpcy5kZXNjcmlwdGlvbi50eXBlID09PSBjb21tb25fMS5Ub3BvbG9neVR5cGUuU2hhcmRlZDtcbiAgICAgICAgY29uc3Qgc2Vzc2lvbiA9IG9wdGlvbnMuc2Vzc2lvbjtcbiAgICAgICAgY29uc3QgdHJhbnNhY3Rpb24gPSBzZXNzaW9uICYmIHNlc3Npb24udHJhbnNhY3Rpb247XG4gICAgICAgIGlmIChpc1NoYXJkZWQgJiYgdHJhbnNhY3Rpb24gJiYgdHJhbnNhY3Rpb24uc2VydmVyKSB7XG4gICAgICAgICAgICBjYWxsYmFjayh1bmRlZmluZWQsIHRyYW5zYWN0aW9uLnNlcnZlcik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgd2FpdFF1ZXVlTWVtYmVyID0ge1xuICAgICAgICAgICAgc2VydmVyU2VsZWN0b3IsXG4gICAgICAgICAgICB0cmFuc2FjdGlvbixcbiAgICAgICAgICAgIGNhbGxiYWNrXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IHNlcnZlclNlbGVjdGlvblRpbWVvdXRNUyA9IG9wdGlvbnMuc2VydmVyU2VsZWN0aW9uVGltZW91dE1TO1xuICAgICAgICBpZiAoc2VydmVyU2VsZWN0aW9uVGltZW91dE1TKSB7XG4gICAgICAgICAgICB3YWl0UXVldWVNZW1iZXIudGltZXIgPSAoMCwgdGltZXJzXzEuc2V0VGltZW91dCkoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHdhaXRRdWV1ZU1lbWJlcltrQ2FuY2VsbGVkXSA9IHRydWU7XG4gICAgICAgICAgICAgICAgd2FpdFF1ZXVlTWVtYmVyLnRpbWVyID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgIGNvbnN0IHRpbWVvdXRFcnJvciA9IG5ldyBlcnJvcl8xLk1vbmdvU2VydmVyU2VsZWN0aW9uRXJyb3IoYFNlcnZlciBzZWxlY3Rpb24gdGltZWQgb3V0IGFmdGVyICR7c2VydmVyU2VsZWN0aW9uVGltZW91dE1TfSBtc2AsIHRoaXMuZGVzY3JpcHRpb24pO1xuICAgICAgICAgICAgICAgIHdhaXRRdWV1ZU1lbWJlci5jYWxsYmFjayh0aW1lb3V0RXJyb3IpO1xuICAgICAgICAgICAgfSwgc2VydmVyU2VsZWN0aW9uVGltZW91dE1TKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzW2tXYWl0UXVldWVdLnB1c2god2FpdFF1ZXVlTWVtYmVyKTtcbiAgICAgICAgcHJvY2Vzc1dhaXRRdWV1ZSh0aGlzKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVXBkYXRlIHRoZSBpbnRlcm5hbCBUb3BvbG9neURlc2NyaXB0aW9uIHdpdGggYSBTZXJ2ZXJEZXNjcmlwdGlvblxuICAgICAqXG4gICAgICogQHBhcmFtIHNlcnZlckRlc2NyaXB0aW9uIC0gVGhlIHNlcnZlciB0byB1cGRhdGUgaW4gdGhlIGludGVybmFsIGxpc3Qgb2Ygc2VydmVyIGRlc2NyaXB0aW9uc1xuICAgICAqL1xuICAgIHNlcnZlclVwZGF0ZUhhbmRsZXIoc2VydmVyRGVzY3JpcHRpb24pIHtcbiAgICAgICAgaWYgKCF0aGlzLnMuZGVzY3JpcHRpb24uaGFzU2VydmVyKHNlcnZlckRlc2NyaXB0aW9uLmFkZHJlc3MpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy8gaWdub3JlIHRoaXMgc2VydmVyIHVwZGF0ZSBpZiBpdHMgZnJvbSBhbiBvdXRkYXRlZCB0b3BvbG9neVZlcnNpb25cbiAgICAgICAgaWYgKGlzU3RhbGVTZXJ2ZXJEZXNjcmlwdGlvbih0aGlzLnMuZGVzY3JpcHRpb24sIHNlcnZlckRlc2NyaXB0aW9uKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIHRoZXNlIHdpbGwgYmUgdXNlZCBmb3IgbW9uaXRvcmluZyBldmVudHMgbGF0ZXJcbiAgICAgICAgY29uc3QgcHJldmlvdXNUb3BvbG9neURlc2NyaXB0aW9uID0gdGhpcy5zLmRlc2NyaXB0aW9uO1xuICAgICAgICBjb25zdCBwcmV2aW91c1NlcnZlckRlc2NyaXB0aW9uID0gdGhpcy5zLmRlc2NyaXB0aW9uLnNlcnZlcnMuZ2V0KHNlcnZlckRlc2NyaXB0aW9uLmFkZHJlc3MpO1xuICAgICAgICBpZiAoIXByZXZpb3VzU2VydmVyRGVzY3JpcHRpb24pIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyBEcml2ZXIgU2Vzc2lvbnMgU3BlYzogXCJXaGVuZXZlciBhIGRyaXZlciByZWNlaXZlcyBhIGNsdXN0ZXIgdGltZSBmcm9tXG4gICAgICAgIC8vIGEgc2VydmVyIGl0IE1VU1QgY29tcGFyZSBpdCB0byB0aGUgY3VycmVudCBoaWdoZXN0IHNlZW4gY2x1c3RlciB0aW1lXG4gICAgICAgIC8vIGZvciB0aGUgZGVwbG95bWVudC4gSWYgdGhlIG5ldyBjbHVzdGVyIHRpbWUgaXMgaGlnaGVyIHRoYW4gdGhlXG4gICAgICAgIC8vIGhpZ2hlc3Qgc2VlbiBjbHVzdGVyIHRpbWUgaXQgTVVTVCBiZWNvbWUgdGhlIG5ldyBoaWdoZXN0IHNlZW4gY2x1c3RlclxuICAgICAgICAvLyB0aW1lLiBUd28gY2x1c3RlciB0aW1lcyBhcmUgY29tcGFyZWQgdXNpbmcgb25seSB0aGUgQnNvblRpbWVzdGFtcFxuICAgICAgICAvLyB2YWx1ZSBvZiB0aGUgY2x1c3RlclRpbWUgZW1iZWRkZWQgZmllbGQuXCJcbiAgICAgICAgY29uc3QgY2x1c3RlclRpbWUgPSBzZXJ2ZXJEZXNjcmlwdGlvbi4kY2x1c3RlclRpbWU7XG4gICAgICAgIGlmIChjbHVzdGVyVGltZSkge1xuICAgICAgICAgICAgKDAsIGNvbW1vbl8xLl9hZHZhbmNlQ2x1c3RlclRpbWUpKHRoaXMsIGNsdXN0ZXJUaW1lKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBJZiB3ZSBhbHJlYWR5IGtub3cgYWxsIHRoZSBpbmZvcm1hdGlvbiBjb250YWluZWQgaW4gdGhpcyB1cGRhdGVkIGRlc2NyaXB0aW9uLCB0aGVuXG4gICAgICAgIC8vIHdlIGRvbid0IG5lZWQgdG8gZW1pdCBTREFNIGV2ZW50cywgYnV0IHN0aWxsIG5lZWQgdG8gdXBkYXRlIHRoZSBkZXNjcmlwdGlvbiwgaW4gb3JkZXJcbiAgICAgICAgLy8gdG8ga2VlcCBjbGllbnQtdHJhY2tlZCBhdHRyaWJ1dGVzIGxpa2UgbGFzdCB1cGRhdGUgdGltZSBhbmQgcm91bmQgdHJpcCB0aW1lIHVwIHRvIGRhdGVcbiAgICAgICAgY29uc3QgZXF1YWxEZXNjcmlwdGlvbnMgPSBwcmV2aW91c1NlcnZlckRlc2NyaXB0aW9uICYmIHByZXZpb3VzU2VydmVyRGVzY3JpcHRpb24uZXF1YWxzKHNlcnZlckRlc2NyaXB0aW9uKTtcbiAgICAgICAgLy8gZmlyc3QgdXBkYXRlIHRoZSBUb3BvbG9neURlc2NyaXB0aW9uXG4gICAgICAgIHRoaXMucy5kZXNjcmlwdGlvbiA9IHRoaXMucy5kZXNjcmlwdGlvbi51cGRhdGUoc2VydmVyRGVzY3JpcHRpb24pO1xuICAgICAgICBpZiAodGhpcy5zLmRlc2NyaXB0aW9uLmNvbXBhdGliaWxpdHlFcnJvcikge1xuICAgICAgICAgICAgdGhpcy5lbWl0KFRvcG9sb2d5LkVSUk9SLCBuZXcgZXJyb3JfMS5Nb25nb0NvbXBhdGliaWxpdHlFcnJvcih0aGlzLnMuZGVzY3JpcHRpb24uY29tcGF0aWJpbGl0eUVycm9yKSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy8gZW1pdCBtb25pdG9yaW5nIGV2ZW50cyBmb3IgdGhpcyBjaGFuZ2VcbiAgICAgICAgaWYgKCFlcXVhbERlc2NyaXB0aW9ucykge1xuICAgICAgICAgICAgY29uc3QgbmV3RGVzY3JpcHRpb24gPSB0aGlzLnMuZGVzY3JpcHRpb24uc2VydmVycy5nZXQoc2VydmVyRGVzY3JpcHRpb24uYWRkcmVzcyk7XG4gICAgICAgICAgICBpZiAobmV3RGVzY3JpcHRpb24pIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVtaXQoVG9wb2xvZ3kuU0VSVkVSX0RFU0NSSVBUSU9OX0NIQU5HRUQsIG5ldyBldmVudHNfMS5TZXJ2ZXJEZXNjcmlwdGlvbkNoYW5nZWRFdmVudCh0aGlzLnMuaWQsIHNlcnZlckRlc2NyaXB0aW9uLmFkZHJlc3MsIHByZXZpb3VzU2VydmVyRGVzY3JpcHRpb24sIG5ld0Rlc2NyaXB0aW9uKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gdXBkYXRlIHNlcnZlciBsaXN0IGZyb20gdXBkYXRlZCBkZXNjcmlwdGlvbnNcbiAgICAgICAgdXBkYXRlU2VydmVycyh0aGlzLCBzZXJ2ZXJEZXNjcmlwdGlvbik7XG4gICAgICAgIC8vIGF0dGVtcHQgdG8gcmVzb2x2ZSBhbnkgb3V0c3RhbmRpbmcgc2VydmVyIHNlbGVjdGlvbiBhdHRlbXB0c1xuICAgICAgICBpZiAodGhpc1trV2FpdFF1ZXVlXS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBwcm9jZXNzV2FpdFF1ZXVlKHRoaXMpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghZXF1YWxEZXNjcmlwdGlvbnMpIHtcbiAgICAgICAgICAgIHRoaXMuZW1pdChUb3BvbG9neS5UT1BPTE9HWV9ERVNDUklQVElPTl9DSEFOR0VELCBuZXcgZXZlbnRzXzEuVG9wb2xvZ3lEZXNjcmlwdGlvbkNoYW5nZWRFdmVudCh0aGlzLnMuaWQsIHByZXZpb3VzVG9wb2xvZ3lEZXNjcmlwdGlvbiwgdGhpcy5zLmRlc2NyaXB0aW9uKSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgYXV0aChjcmVkZW50aWFscywgY2FsbGJhY2spIHtcbiAgICAgICAgaWYgKHR5cGVvZiBjcmVkZW50aWFscyA9PT0gJ2Z1bmN0aW9uJylcbiAgICAgICAgICAgIChjYWxsYmFjayA9IGNyZWRlbnRpYWxzKSwgKGNyZWRlbnRpYWxzID0gdW5kZWZpbmVkKTtcbiAgICAgICAgaWYgKHR5cGVvZiBjYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJylcbiAgICAgICAgICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwgdHJ1ZSk7XG4gICAgfVxuICAgIGdldCBjbGllbnRNZXRhZGF0YSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucy5vcHRpb25zLm1ldGFkYXRhO1xuICAgIH1cbiAgICBpc0Nvbm5lY3RlZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucy5zdGF0ZSA9PT0gY29tbW9uXzEuU1RBVEVfQ09OTkVDVEVEO1xuICAgIH1cbiAgICBpc0Rlc3Ryb3llZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucy5zdGF0ZSA9PT0gY29tbW9uXzEuU1RBVEVfQ0xPU0VEO1xuICAgIH1cbiAgICAvLyBOT1RFOiBUaGVyZSBhcmUgbWFueSBwbGFjZXMgaW4gY29kZSB3aGVyZSB3ZSBleHBsaWNpdGx5IGNoZWNrIHRoZSBsYXN0IGhlbGxvXG4gICAgLy8gICAgICAgdG8gZG8gZmVhdHVyZSBzdXBwb3J0IGRldGVjdGlvbi4gVGhpcyBzaG91bGQgYmUgZG9uZSBhbnkgb3RoZXIgd2F5LCBidXQgZm9yXG4gICAgLy8gICAgICAgbm93IHdlIHdpbGwganVzdCByZXR1cm4gdGhlIGZpcnN0IGhlbGxvIHNlZW4sIHdoaWNoIHNob3VsZCBzdWZmaWNlLlxuICAgIGxhc3RIZWxsbygpIHtcbiAgICAgICAgY29uc3Qgc2VydmVyRGVzY3JpcHRpb25zID0gQXJyYXkuZnJvbSh0aGlzLmRlc2NyaXB0aW9uLnNlcnZlcnMudmFsdWVzKCkpO1xuICAgICAgICBpZiAoc2VydmVyRGVzY3JpcHRpb25zLmxlbmd0aCA9PT0gMClcbiAgICAgICAgICAgIHJldHVybiB7fTtcbiAgICAgICAgY29uc3Qgc2QgPSBzZXJ2ZXJEZXNjcmlwdGlvbnMuZmlsdGVyKChzZCkgPT4gc2QudHlwZSAhPT0gY29tbW9uXzEuU2VydmVyVHlwZS5Vbmtub3duKVswXTtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gc2QgfHwgeyBtYXhXaXJlVmVyc2lvbjogdGhpcy5kZXNjcmlwdGlvbi5jb21tb25XaXJlVmVyc2lvbiB9O1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cbiAgICBnZXQgY29tbW9uV2lyZVZlcnNpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmRlc2NyaXB0aW9uLmNvbW1vbldpcmVWZXJzaW9uO1xuICAgIH1cbiAgICBnZXQgbG9naWNhbFNlc3Npb25UaW1lb3V0TWludXRlcygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGVzY3JpcHRpb24ubG9naWNhbFNlc3Npb25UaW1lb3V0TWludXRlcztcbiAgICB9XG4gICAgZ2V0IGNsdXN0ZXJUaW1lKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zLmNsdXN0ZXJUaW1lO1xuICAgIH1cbiAgICBzZXQgY2x1c3RlclRpbWUoY2x1c3RlclRpbWUpIHtcbiAgICAgICAgdGhpcy5zLmNsdXN0ZXJUaW1lID0gY2x1c3RlclRpbWU7XG4gICAgfVxufVxuLyoqIEBldmVudCAqL1xuVG9wb2xvZ3kuU0VSVkVSX09QRU5JTkcgPSBjb25zdGFudHNfMS5TRVJWRVJfT1BFTklORztcbi8qKiBAZXZlbnQgKi9cblRvcG9sb2d5LlNFUlZFUl9DTE9TRUQgPSBjb25zdGFudHNfMS5TRVJWRVJfQ0xPU0VEO1xuLyoqIEBldmVudCAqL1xuVG9wb2xvZ3kuU0VSVkVSX0RFU0NSSVBUSU9OX0NIQU5HRUQgPSBjb25zdGFudHNfMS5TRVJWRVJfREVTQ1JJUFRJT05fQ0hBTkdFRDtcbi8qKiBAZXZlbnQgKi9cblRvcG9sb2d5LlRPUE9MT0dZX09QRU5JTkcgPSBjb25zdGFudHNfMS5UT1BPTE9HWV9PUEVOSU5HO1xuLyoqIEBldmVudCAqL1xuVG9wb2xvZ3kuVE9QT0xPR1lfQ0xPU0VEID0gY29uc3RhbnRzXzEuVE9QT0xPR1lfQ0xPU0VEO1xuLyoqIEBldmVudCAqL1xuVG9wb2xvZ3kuVE9QT0xPR1lfREVTQ1JJUFRJT05fQ0hBTkdFRCA9IGNvbnN0YW50c18xLlRPUE9MT0dZX0RFU0NSSVBUSU9OX0NIQU5HRUQ7XG4vKiogQGV2ZW50ICovXG5Ub3BvbG9neS5FUlJPUiA9IGNvbnN0YW50c18xLkVSUk9SO1xuLyoqIEBldmVudCAqL1xuVG9wb2xvZ3kuT1BFTiA9IGNvbnN0YW50c18xLk9QRU47XG4vKiogQGV2ZW50ICovXG5Ub3BvbG9neS5DT05ORUNUID0gY29uc3RhbnRzXzEuQ09OTkVDVDtcbi8qKiBAZXZlbnQgKi9cblRvcG9sb2d5LkNMT1NFID0gY29uc3RhbnRzXzEuQ0xPU0U7XG4vKiogQGV2ZW50ICovXG5Ub3BvbG9neS5USU1FT1VUID0gY29uc3RhbnRzXzEuVElNRU9VVDtcbmV4cG9ydHMuVG9wb2xvZ3kgPSBUb3BvbG9neTtcbi8qKiBEZXN0cm95cyBhIHNlcnZlciwgYW5kIHJlbW92ZXMgYWxsIGV2ZW50IGxpc3RlbmVycyBmcm9tIHRoZSBpbnN0YW5jZSAqL1xuZnVuY3Rpb24gZGVzdHJveVNlcnZlcihzZXJ2ZXIsIHRvcG9sb2d5LCBvcHRpb25zLCBjYWxsYmFjaykge1xuICAgIG9wdGlvbnMgPSBvcHRpb25zID8/IHsgZm9yY2U6IGZhbHNlIH07XG4gICAgZm9yIChjb25zdCBldmVudCBvZiBjb25zdGFudHNfMS5MT0NBTF9TRVJWRVJfRVZFTlRTKSB7XG4gICAgICAgIHNlcnZlci5yZW1vdmVBbGxMaXN0ZW5lcnMoZXZlbnQpO1xuICAgIH1cbiAgICBzZXJ2ZXIuZGVzdHJveShvcHRpb25zLCAoKSA9PiB7XG4gICAgICAgIHRvcG9sb2d5LmVtaXQoVG9wb2xvZ3kuU0VSVkVSX0NMT1NFRCwgbmV3IGV2ZW50c18xLlNlcnZlckNsb3NlZEV2ZW50KHRvcG9sb2d5LnMuaWQsIHNlcnZlci5kZXNjcmlwdGlvbi5hZGRyZXNzKSk7XG4gICAgICAgIGZvciAoY29uc3QgZXZlbnQgb2YgY29uc3RhbnRzXzEuU0VSVkVSX1JFTEFZX0VWRU5UUykge1xuICAgICAgICAgICAgc2VydmVyLnJlbW92ZUFsbExpc3RlbmVycyhldmVudCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiBjYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuLyoqIFByZWRpY3RzIHRoZSBUb3BvbG9neVR5cGUgZnJvbSBvcHRpb25zICovXG5mdW5jdGlvbiB0b3BvbG9neVR5cGVGcm9tT3B0aW9ucyhvcHRpb25zKSB7XG4gICAgaWYgKG9wdGlvbnM/LmRpcmVjdENvbm5lY3Rpb24pIHtcbiAgICAgICAgcmV0dXJuIGNvbW1vbl8xLlRvcG9sb2d5VHlwZS5TaW5nbGU7XG4gICAgfVxuICAgIGlmIChvcHRpb25zPy5yZXBsaWNhU2V0KSB7XG4gICAgICAgIHJldHVybiBjb21tb25fMS5Ub3BvbG9neVR5cGUuUmVwbGljYVNldE5vUHJpbWFyeTtcbiAgICB9XG4gICAgaWYgKG9wdGlvbnM/LmxvYWRCYWxhbmNlZCkge1xuICAgICAgICByZXR1cm4gY29tbW9uXzEuVG9wb2xvZ3lUeXBlLkxvYWRCYWxhbmNlZDtcbiAgICB9XG4gICAgcmV0dXJuIGNvbW1vbl8xLlRvcG9sb2d5VHlwZS5Vbmtub3duO1xufVxuLyoqXG4gKiBDcmVhdGVzIG5ldyBzZXJ2ZXIgaW5zdGFuY2VzIGFuZCBhdHRlbXB0cyB0byBjb25uZWN0IHRoZW1cbiAqXG4gKiBAcGFyYW0gdG9wb2xvZ3kgLSBUaGUgdG9wb2xvZ3kgdGhhdCB0aGlzIHNlcnZlciBiZWxvbmdzIHRvXG4gKiBAcGFyYW0gc2VydmVyRGVzY3JpcHRpb24gLSBUaGUgZGVzY3JpcHRpb24gZm9yIHRoZSBzZXJ2ZXIgdG8gaW5pdGlhbGl6ZSBhbmQgY29ubmVjdCB0b1xuICovXG5mdW5jdGlvbiBjcmVhdGVBbmRDb25uZWN0U2VydmVyKHRvcG9sb2d5LCBzZXJ2ZXJEZXNjcmlwdGlvbikge1xuICAgIHRvcG9sb2d5LmVtaXQoVG9wb2xvZ3kuU0VSVkVSX09QRU5JTkcsIG5ldyBldmVudHNfMS5TZXJ2ZXJPcGVuaW5nRXZlbnQodG9wb2xvZ3kucy5pZCwgc2VydmVyRGVzY3JpcHRpb24uYWRkcmVzcykpO1xuICAgIGNvbnN0IHNlcnZlciA9IG5ldyBzZXJ2ZXJfMS5TZXJ2ZXIodG9wb2xvZ3ksIHNlcnZlckRlc2NyaXB0aW9uLCB0b3BvbG9neS5zLm9wdGlvbnMpO1xuICAgIGZvciAoY29uc3QgZXZlbnQgb2YgY29uc3RhbnRzXzEuU0VSVkVSX1JFTEFZX0VWRU5UUykge1xuICAgICAgICBzZXJ2ZXIub24oZXZlbnQsIChlKSA9PiB0b3BvbG9neS5lbWl0KGV2ZW50LCBlKSk7XG4gICAgfVxuICAgIHNlcnZlci5vbihzZXJ2ZXJfMS5TZXJ2ZXIuREVTQ1JJUFRJT05fUkVDRUlWRUQsIGRlc2NyaXB0aW9uID0+IHRvcG9sb2d5LnNlcnZlclVwZGF0ZUhhbmRsZXIoZGVzY3JpcHRpb24pKTtcbiAgICBzZXJ2ZXIuY29ubmVjdCgpO1xuICAgIHJldHVybiBzZXJ2ZXI7XG59XG4vKipcbiAqIEBwYXJhbSB0b3BvbG9neSAtIFRvcG9sb2d5IHRvIHVwZGF0ZS5cbiAqIEBwYXJhbSBpbmNvbWluZ1NlcnZlckRlc2NyaXB0aW9uIC0gTmV3IHNlcnZlciBkZXNjcmlwdGlvbi5cbiAqL1xuZnVuY3Rpb24gdXBkYXRlU2VydmVycyh0b3BvbG9neSwgaW5jb21pbmdTZXJ2ZXJEZXNjcmlwdGlvbikge1xuICAgIC8vIHVwZGF0ZSB0aGUgaW50ZXJuYWwgc2VydmVyJ3MgZGVzY3JpcHRpb25cbiAgICBpZiAoaW5jb21pbmdTZXJ2ZXJEZXNjcmlwdGlvbiAmJiB0b3BvbG9neS5zLnNlcnZlcnMuaGFzKGluY29taW5nU2VydmVyRGVzY3JpcHRpb24uYWRkcmVzcykpIHtcbiAgICAgICAgY29uc3Qgc2VydmVyID0gdG9wb2xvZ3kucy5zZXJ2ZXJzLmdldChpbmNvbWluZ1NlcnZlckRlc2NyaXB0aW9uLmFkZHJlc3MpO1xuICAgICAgICBpZiAoc2VydmVyKSB7XG4gICAgICAgICAgICBzZXJ2ZXIucy5kZXNjcmlwdGlvbiA9IGluY29taW5nU2VydmVyRGVzY3JpcHRpb247XG4gICAgICAgICAgICBpZiAoaW5jb21pbmdTZXJ2ZXJEZXNjcmlwdGlvbi5lcnJvciBpbnN0YW5jZW9mIGVycm9yXzEuTW9uZ29FcnJvciAmJlxuICAgICAgICAgICAgICAgIGluY29taW5nU2VydmVyRGVzY3JpcHRpb24uZXJyb3IuaGFzRXJyb3JMYWJlbChlcnJvcl8xLk1vbmdvRXJyb3JMYWJlbC5SZXNldFBvb2wpKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgaW50ZXJydXB0SW5Vc2VDb25uZWN0aW9ucyA9IGluY29taW5nU2VydmVyRGVzY3JpcHRpb24uZXJyb3IuaGFzRXJyb3JMYWJlbChlcnJvcl8xLk1vbmdvRXJyb3JMYWJlbC5JbnRlcnJ1cHRJblVzZUNvbm5lY3Rpb25zKTtcbiAgICAgICAgICAgICAgICBzZXJ2ZXIucG9vbC5jbGVhcih7IGludGVycnVwdEluVXNlQ29ubmVjdGlvbnMgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChpbmNvbWluZ1NlcnZlckRlc2NyaXB0aW9uLmVycm9yID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdUb3BvbG9neVR5cGUgPSB0b3BvbG9neS5zLmRlc2NyaXB0aW9uLnR5cGU7XG4gICAgICAgICAgICAgICAgY29uc3Qgc2hvdWxkTWFya1Bvb2xSZWFkeSA9IGluY29taW5nU2VydmVyRGVzY3JpcHRpb24uaXNEYXRhQmVhcmluZyB8fFxuICAgICAgICAgICAgICAgICAgICAoaW5jb21pbmdTZXJ2ZXJEZXNjcmlwdGlvbi50eXBlICE9PSBjb21tb25fMS5TZXJ2ZXJUeXBlLlVua25vd24gJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld1RvcG9sb2d5VHlwZSA9PT0gY29tbW9uXzEuVG9wb2xvZ3lUeXBlLlNpbmdsZSk7XG4gICAgICAgICAgICAgICAgaWYgKHNob3VsZE1hcmtQb29sUmVhZHkpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VydmVyLnBvb2wucmVhZHkoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gYWRkIG5ldyBzZXJ2ZXJzIGZvciBhbGwgZGVzY3JpcHRpb25zIHdlIGN1cnJlbnRseSBkb24ndCBrbm93IGFib3V0IGxvY2FsbHlcbiAgICBmb3IgKGNvbnN0IHNlcnZlckRlc2NyaXB0aW9uIG9mIHRvcG9sb2d5LmRlc2NyaXB0aW9uLnNlcnZlcnMudmFsdWVzKCkpIHtcbiAgICAgICAgaWYgKCF0b3BvbG9neS5zLnNlcnZlcnMuaGFzKHNlcnZlckRlc2NyaXB0aW9uLmFkZHJlc3MpKSB7XG4gICAgICAgICAgICBjb25zdCBzZXJ2ZXIgPSBjcmVhdGVBbmRDb25uZWN0U2VydmVyKHRvcG9sb2d5LCBzZXJ2ZXJEZXNjcmlwdGlvbik7XG4gICAgICAgICAgICB0b3BvbG9neS5zLnNlcnZlcnMuc2V0KHNlcnZlckRlc2NyaXB0aW9uLmFkZHJlc3MsIHNlcnZlcik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gZm9yIGFsbCBzZXJ2ZXJzIG5vIGxvbmdlciBrbm93biwgcmVtb3ZlIHRoZWlyIGRlc2NyaXB0aW9ucyBhbmQgZGVzdHJveSB0aGVpciBpbnN0YW5jZXNcbiAgICBmb3IgKGNvbnN0IGVudHJ5IG9mIHRvcG9sb2d5LnMuc2VydmVycykge1xuICAgICAgICBjb25zdCBzZXJ2ZXJBZGRyZXNzID0gZW50cnlbMF07XG4gICAgICAgIGlmICh0b3BvbG9neS5kZXNjcmlwdGlvbi5oYXNTZXJ2ZXIoc2VydmVyQWRkcmVzcykpIHtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmICghdG9wb2xvZ3kucy5zZXJ2ZXJzLmhhcyhzZXJ2ZXJBZGRyZXNzKSkge1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgc2VydmVyID0gdG9wb2xvZ3kucy5zZXJ2ZXJzLmdldChzZXJ2ZXJBZGRyZXNzKTtcbiAgICAgICAgdG9wb2xvZ3kucy5zZXJ2ZXJzLmRlbGV0ZShzZXJ2ZXJBZGRyZXNzKTtcbiAgICAgICAgLy8gcHJlcGFyZSBzZXJ2ZXIgZm9yIGdhcmJhZ2UgY29sbGVjdGlvblxuICAgICAgICBpZiAoc2VydmVyKSB7XG4gICAgICAgICAgICBkZXN0cm95U2VydmVyKHNlcnZlciwgdG9wb2xvZ3kpO1xuICAgICAgICB9XG4gICAgfVxufVxuZnVuY3Rpb24gZHJhaW5XYWl0UXVldWUocXVldWUsIGVycikge1xuICAgIHdoaWxlIChxdWV1ZS5sZW5ndGgpIHtcbiAgICAgICAgY29uc3Qgd2FpdFF1ZXVlTWVtYmVyID0gcXVldWUuc2hpZnQoKTtcbiAgICAgICAgaWYgKCF3YWl0UXVldWVNZW1iZXIpIHtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmICh3YWl0UXVldWVNZW1iZXIudGltZXIpIHtcbiAgICAgICAgICAgICgwLCB0aW1lcnNfMS5jbGVhclRpbWVvdXQpKHdhaXRRdWV1ZU1lbWJlci50aW1lcik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF3YWl0UXVldWVNZW1iZXJba0NhbmNlbGxlZF0pIHtcbiAgICAgICAgICAgIHdhaXRRdWV1ZU1lbWJlci5jYWxsYmFjayhlcnIpO1xuICAgICAgICB9XG4gICAgfVxufVxuZnVuY3Rpb24gcHJvY2Vzc1dhaXRRdWV1ZSh0b3BvbG9neSkge1xuICAgIGlmICh0b3BvbG9neS5zLnN0YXRlID09PSBjb21tb25fMS5TVEFURV9DTE9TRUQpIHtcbiAgICAgICAgZHJhaW5XYWl0UXVldWUodG9wb2xvZ3lba1dhaXRRdWV1ZV0sIG5ldyBlcnJvcl8xLk1vbmdvVG9wb2xvZ3lDbG9zZWRFcnJvcigpKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBpc1NoYXJkZWQgPSB0b3BvbG9neS5kZXNjcmlwdGlvbi50eXBlID09PSBjb21tb25fMS5Ub3BvbG9neVR5cGUuU2hhcmRlZDtcbiAgICBjb25zdCBzZXJ2ZXJEZXNjcmlwdGlvbnMgPSBBcnJheS5mcm9tKHRvcG9sb2d5LmRlc2NyaXB0aW9uLnNlcnZlcnMudmFsdWVzKCkpO1xuICAgIGNvbnN0IG1lbWJlcnNUb1Byb2Nlc3MgPSB0b3BvbG9neVtrV2FpdFF1ZXVlXS5sZW5ndGg7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBtZW1iZXJzVG9Qcm9jZXNzOyArK2kpIHtcbiAgICAgICAgY29uc3Qgd2FpdFF1ZXVlTWVtYmVyID0gdG9wb2xvZ3lba1dhaXRRdWV1ZV0uc2hpZnQoKTtcbiAgICAgICAgaWYgKCF3YWl0UXVldWVNZW1iZXIpIHtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmICh3YWl0UXVldWVNZW1iZXJba0NhbmNlbGxlZF0pIHtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIGxldCBzZWxlY3RlZERlc2NyaXB0aW9ucztcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHNlcnZlclNlbGVjdG9yID0gd2FpdFF1ZXVlTWVtYmVyLnNlcnZlclNlbGVjdG9yO1xuICAgICAgICAgICAgc2VsZWN0ZWREZXNjcmlwdGlvbnMgPSBzZXJ2ZXJTZWxlY3RvclxuICAgICAgICAgICAgICAgID8gc2VydmVyU2VsZWN0b3IodG9wb2xvZ3kuZGVzY3JpcHRpb24sIHNlcnZlckRlc2NyaXB0aW9ucylcbiAgICAgICAgICAgICAgICA6IHNlcnZlckRlc2NyaXB0aW9ucztcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgaWYgKHdhaXRRdWV1ZU1lbWJlci50aW1lcikge1xuICAgICAgICAgICAgICAgICgwLCB0aW1lcnNfMS5jbGVhclRpbWVvdXQpKHdhaXRRdWV1ZU1lbWJlci50aW1lcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB3YWl0UXVldWVNZW1iZXIuY2FsbGJhY2soZSk7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgc2VsZWN0ZWRTZXJ2ZXI7XG4gICAgICAgIGlmIChzZWxlY3RlZERlc2NyaXB0aW9ucy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHRvcG9sb2d5W2tXYWl0UXVldWVdLnB1c2god2FpdFF1ZXVlTWVtYmVyKTtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHNlbGVjdGVkRGVzY3JpcHRpb25zLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgc2VsZWN0ZWRTZXJ2ZXIgPSB0b3BvbG9neS5zLnNlcnZlcnMuZ2V0KHNlbGVjdGVkRGVzY3JpcHRpb25zWzBdLmFkZHJlc3MpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgZGVzY3JpcHRpb25zID0gKDAsIHV0aWxzXzEuc2h1ZmZsZSkoc2VsZWN0ZWREZXNjcmlwdGlvbnMsIDIpO1xuICAgICAgICAgICAgY29uc3Qgc2VydmVyMSA9IHRvcG9sb2d5LnMuc2VydmVycy5nZXQoZGVzY3JpcHRpb25zWzBdLmFkZHJlc3MpO1xuICAgICAgICAgICAgY29uc3Qgc2VydmVyMiA9IHRvcG9sb2d5LnMuc2VydmVycy5nZXQoZGVzY3JpcHRpb25zWzFdLmFkZHJlc3MpO1xuICAgICAgICAgICAgc2VsZWN0ZWRTZXJ2ZXIgPVxuICAgICAgICAgICAgICAgIHNlcnZlcjEgJiYgc2VydmVyMiAmJiBzZXJ2ZXIxLnMub3BlcmF0aW9uQ291bnQgPCBzZXJ2ZXIyLnMub3BlcmF0aW9uQ291bnRcbiAgICAgICAgICAgICAgICAgICAgPyBzZXJ2ZXIxXG4gICAgICAgICAgICAgICAgICAgIDogc2VydmVyMjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXNlbGVjdGVkU2VydmVyKSB7XG4gICAgICAgICAgICB3YWl0UXVldWVNZW1iZXIuY2FsbGJhY2sobmV3IGVycm9yXzEuTW9uZ29TZXJ2ZXJTZWxlY3Rpb25FcnJvcignc2VydmVyIHNlbGVjdGlvbiByZXR1cm5lZCBhIHNlcnZlciBkZXNjcmlwdGlvbiBidXQgdGhlIHNlcnZlciB3YXMgbm90IGZvdW5kIGluIHRoZSB0b3BvbG9neScsIHRvcG9sb2d5LmRlc2NyaXB0aW9uKSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdHJhbnNhY3Rpb24gPSB3YWl0UXVldWVNZW1iZXIudHJhbnNhY3Rpb247XG4gICAgICAgIGlmIChpc1NoYXJkZWQgJiYgdHJhbnNhY3Rpb24gJiYgdHJhbnNhY3Rpb24uaXNBY3RpdmUgJiYgc2VsZWN0ZWRTZXJ2ZXIpIHtcbiAgICAgICAgICAgIHRyYW5zYWN0aW9uLnBpblNlcnZlcihzZWxlY3RlZFNlcnZlcik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHdhaXRRdWV1ZU1lbWJlci50aW1lcikge1xuICAgICAgICAgICAgKDAsIHRpbWVyc18xLmNsZWFyVGltZW91dCkod2FpdFF1ZXVlTWVtYmVyLnRpbWVyKTtcbiAgICAgICAgfVxuICAgICAgICB3YWl0UXVldWVNZW1iZXIuY2FsbGJhY2sodW5kZWZpbmVkLCBzZWxlY3RlZFNlcnZlcik7XG4gICAgfVxuICAgIGlmICh0b3BvbG9neVtrV2FpdFF1ZXVlXS5sZW5ndGggPiAwKSB7XG4gICAgICAgIC8vIGVuc3VyZSBhbGwgc2VydmVyIG1vbml0b3JzIGF0dGVtcHQgbW9uaXRvcmluZyBzb29uXG4gICAgICAgIGZvciAoY29uc3QgWywgc2VydmVyXSBvZiB0b3BvbG9neS5zLnNlcnZlcnMpIHtcbiAgICAgICAgICAgIHByb2Nlc3MubmV4dFRpY2soZnVuY3Rpb24gc2NoZWR1bGVTZXJ2ZXJDaGVjaygpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc2VydmVyLnJlcXVlc3RDaGVjaygpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG59XG5mdW5jdGlvbiBpc1N0YWxlU2VydmVyRGVzY3JpcHRpb24odG9wb2xvZ3lEZXNjcmlwdGlvbiwgaW5jb21pbmdTZXJ2ZXJEZXNjcmlwdGlvbikge1xuICAgIGNvbnN0IGN1cnJlbnRTZXJ2ZXJEZXNjcmlwdGlvbiA9IHRvcG9sb2d5RGVzY3JpcHRpb24uc2VydmVycy5nZXQoaW5jb21pbmdTZXJ2ZXJEZXNjcmlwdGlvbi5hZGRyZXNzKTtcbiAgICBjb25zdCBjdXJyZW50VG9wb2xvZ3lWZXJzaW9uID0gY3VycmVudFNlcnZlckRlc2NyaXB0aW9uPy50b3BvbG9neVZlcnNpb247XG4gICAgcmV0dXJuICgoMCwgc2VydmVyX2Rlc2NyaXB0aW9uXzEuY29tcGFyZVRvcG9sb2d5VmVyc2lvbikoY3VycmVudFRvcG9sb2d5VmVyc2lvbiwgaW5jb21pbmdTZXJ2ZXJEZXNjcmlwdGlvbi50b3BvbG9neVZlcnNpb24pID4gMCk7XG59XG4vKiogQHB1YmxpYyAqL1xuY2xhc3MgU2VydmVyQ2FwYWJpbGl0aWVzIHtcbiAgICBjb25zdHJ1Y3RvcihoZWxsbykge1xuICAgICAgICB0aGlzLm1pbldpcmVWZXJzaW9uID0gaGVsbG8ubWluV2lyZVZlcnNpb24gfHwgMDtcbiAgICAgICAgdGhpcy5tYXhXaXJlVmVyc2lvbiA9IGhlbGxvLm1heFdpcmVWZXJzaW9uIHx8IDA7XG4gICAgfVxuICAgIGdldCBoYXNBZ2dyZWdhdGlvbkN1cnNvcigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubWF4V2lyZVZlcnNpb24gPj0gMTtcbiAgICB9XG4gICAgZ2V0IGhhc1dyaXRlQ29tbWFuZHMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm1heFdpcmVWZXJzaW9uID49IDI7XG4gICAgfVxuICAgIGdldCBoYXNUZXh0U2VhcmNoKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5taW5XaXJlVmVyc2lvbiA+PSAwO1xuICAgIH1cbiAgICBnZXQgaGFzQXV0aENvbW1hbmRzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5tYXhXaXJlVmVyc2lvbiA+PSAxO1xuICAgIH1cbiAgICBnZXQgaGFzTGlzdENvbGxlY3Rpb25zQ29tbWFuZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubWF4V2lyZVZlcnNpb24gPj0gMztcbiAgICB9XG4gICAgZ2V0IGhhc0xpc3RJbmRleGVzQ29tbWFuZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubWF4V2lyZVZlcnNpb24gPj0gMztcbiAgICB9XG4gICAgZ2V0IHN1cHBvcnRzU25hcHNob3RSZWFkcygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubWF4V2lyZVZlcnNpb24gPj0gMTM7XG4gICAgfVxuICAgIGdldCBjb21tYW5kc1Rha2VXcml0ZUNvbmNlcm4oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm1heFdpcmVWZXJzaW9uID49IDU7XG4gICAgfVxuICAgIGdldCBjb21tYW5kc1Rha2VDb2xsYXRpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm1heFdpcmVWZXJzaW9uID49IDU7XG4gICAgfVxufVxuZXhwb3J0cy5TZXJ2ZXJDYXBhYmlsaXRpZXMgPSBTZXJ2ZXJDYXBhYmlsaXRpZXM7XG4vLyMgc291cmNlTWFwcGluZ1VSTD10b3BvbG9neS5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/sdam/topology.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/sdam/topology_description.js":
/*!***********************************************************************!*\
  !*** ../server/node_modules/mongodb/lib/sdam/topology_description.js ***!
  \***********************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.TopologyDescription = void 0;\nconst WIRE_CONSTANTS = __webpack_require__(/*! ../cmap/wire_protocol/constants */ \"(api)/../server/node_modules/mongodb/lib/cmap/wire_protocol/constants.js\");\nconst error_1 = __webpack_require__(/*! ../error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\nconst common_1 = __webpack_require__(/*! ./common */ \"(api)/../server/node_modules/mongodb/lib/sdam/common.js\");\nconst server_description_1 = __webpack_require__(/*! ./server_description */ \"(api)/../server/node_modules/mongodb/lib/sdam/server_description.js\");\n// constants related to compatibility checks\nconst MIN_SUPPORTED_SERVER_VERSION = WIRE_CONSTANTS.MIN_SUPPORTED_SERVER_VERSION;\nconst MAX_SUPPORTED_SERVER_VERSION = WIRE_CONSTANTS.MAX_SUPPORTED_SERVER_VERSION;\nconst MIN_SUPPORTED_WIRE_VERSION = WIRE_CONSTANTS.MIN_SUPPORTED_WIRE_VERSION;\nconst MAX_SUPPORTED_WIRE_VERSION = WIRE_CONSTANTS.MAX_SUPPORTED_WIRE_VERSION;\nconst MONGOS_OR_UNKNOWN = new Set([common_1.ServerType.Mongos, common_1.ServerType.Unknown]);\nconst MONGOS_OR_STANDALONE = new Set([common_1.ServerType.Mongos, common_1.ServerType.Standalone]);\nconst NON_PRIMARY_RS_MEMBERS = new Set([\n    common_1.ServerType.RSSecondary,\n    common_1.ServerType.RSArbiter,\n    common_1.ServerType.RSOther\n]);\n/**\n * Representation of a deployment of servers\n * @public\n */\nclass TopologyDescription {\n    /**\n     * Create a TopologyDescription\n     */\n    constructor(topologyType, serverDescriptions = null, setName = null, maxSetVersion = null, maxElectionId = null, commonWireVersion = null, options = null) {\n        options = options ?? {};\n        this.type = topologyType ?? common_1.TopologyType.Unknown;\n        this.servers = serverDescriptions ?? new Map();\n        this.stale = false;\n        this.compatible = true;\n        this.heartbeatFrequencyMS = options.heartbeatFrequencyMS ?? 0;\n        this.localThresholdMS = options.localThresholdMS ?? 15;\n        this.setName = setName ?? null;\n        this.maxElectionId = maxElectionId ?? null;\n        this.maxSetVersion = maxSetVersion ?? null;\n        this.commonWireVersion = commonWireVersion ?? 0;\n        // determine server compatibility\n        for (const serverDescription of this.servers.values()) {\n            // Load balancer mode is always compatible.\n            if (serverDescription.type === common_1.ServerType.Unknown ||\n                serverDescription.type === common_1.ServerType.LoadBalancer) {\n                continue;\n            }\n            if (serverDescription.minWireVersion > MAX_SUPPORTED_WIRE_VERSION) {\n                this.compatible = false;\n                this.compatibilityError = `Server at ${serverDescription.address} requires wire version ${serverDescription.minWireVersion}, but this version of the driver only supports up to ${MAX_SUPPORTED_WIRE_VERSION} (MongoDB ${MAX_SUPPORTED_SERVER_VERSION})`;\n            }\n            if (serverDescription.maxWireVersion < MIN_SUPPORTED_WIRE_VERSION) {\n                this.compatible = false;\n                this.compatibilityError = `Server at ${serverDescription.address} reports wire version ${serverDescription.maxWireVersion}, but this version of the driver requires at least ${MIN_SUPPORTED_WIRE_VERSION} (MongoDB ${MIN_SUPPORTED_SERVER_VERSION}).`;\n                break;\n            }\n        }\n        // Whenever a client updates the TopologyDescription from a hello response, it MUST set\n        // TopologyDescription.logicalSessionTimeoutMinutes to the smallest logicalSessionTimeoutMinutes\n        // value among ServerDescriptions of all data-bearing server types. If any have a null\n        // logicalSessionTimeoutMinutes, then TopologyDescription.logicalSessionTimeoutMinutes MUST be\n        // set to null.\n        this.logicalSessionTimeoutMinutes = null;\n        for (const [, server] of this.servers) {\n            if (server.isReadable) {\n                if (server.logicalSessionTimeoutMinutes == null) {\n                    // If any of the servers have a null logicalSessionsTimeout, then the whole topology does\n                    this.logicalSessionTimeoutMinutes = null;\n                    break;\n                }\n                if (this.logicalSessionTimeoutMinutes == null) {\n                    // First server with a non null logicalSessionsTimeout\n                    this.logicalSessionTimeoutMinutes = server.logicalSessionTimeoutMinutes;\n                    continue;\n                }\n                // Always select the smaller of the:\n                // current server logicalSessionsTimeout and the topologies logicalSessionsTimeout\n                this.logicalSessionTimeoutMinutes = Math.min(this.logicalSessionTimeoutMinutes, server.logicalSessionTimeoutMinutes);\n            }\n        }\n    }\n    /**\n     * Returns a new TopologyDescription based on the SrvPollingEvent\n     * @internal\n     */\n    updateFromSrvPollingEvent(ev, srvMaxHosts = 0) {\n        /** The SRV addresses defines the set of addresses we should be using */\n        const incomingHostnames = ev.hostnames();\n        const currentHostnames = new Set(this.servers.keys());\n        const hostnamesToAdd = new Set(incomingHostnames);\n        const hostnamesToRemove = new Set();\n        for (const hostname of currentHostnames) {\n            // filter hostnamesToAdd (made from incomingHostnames) down to what is *not* present in currentHostnames\n            hostnamesToAdd.delete(hostname);\n            if (!incomingHostnames.has(hostname)) {\n                // If the SRV Records no longer include this hostname\n                // we have to stop using it\n                hostnamesToRemove.add(hostname);\n            }\n        }\n        if (hostnamesToAdd.size === 0 && hostnamesToRemove.size === 0) {\n            // No new hosts to add and none to remove\n            return this;\n        }\n        const serverDescriptions = new Map(this.servers);\n        for (const removedHost of hostnamesToRemove) {\n            serverDescriptions.delete(removedHost);\n        }\n        if (hostnamesToAdd.size > 0) {\n            if (srvMaxHosts === 0) {\n                // Add all!\n                for (const hostToAdd of hostnamesToAdd) {\n                    serverDescriptions.set(hostToAdd, new server_description_1.ServerDescription(hostToAdd));\n                }\n            }\n            else if (serverDescriptions.size < srvMaxHosts) {\n                // Add only the amount needed to get us back to srvMaxHosts\n                const selectedHosts = (0, utils_1.shuffle)(hostnamesToAdd, srvMaxHosts - serverDescriptions.size);\n                for (const selectedHostToAdd of selectedHosts) {\n                    serverDescriptions.set(selectedHostToAdd, new server_description_1.ServerDescription(selectedHostToAdd));\n                }\n            }\n        }\n        return new TopologyDescription(this.type, serverDescriptions, this.setName, this.maxSetVersion, this.maxElectionId, this.commonWireVersion, { heartbeatFrequencyMS: this.heartbeatFrequencyMS, localThresholdMS: this.localThresholdMS });\n    }\n    /**\n     * Returns a copy of this description updated with a given ServerDescription\n     * @internal\n     */\n    update(serverDescription) {\n        const address = serverDescription.address;\n        // potentially mutated values\n        let { type: topologyType, setName, maxSetVersion, maxElectionId, commonWireVersion } = this;\n        const serverType = serverDescription.type;\n        const serverDescriptions = new Map(this.servers);\n        // update common wire version\n        if (serverDescription.maxWireVersion !== 0) {\n            if (commonWireVersion == null) {\n                commonWireVersion = serverDescription.maxWireVersion;\n            }\n            else {\n                commonWireVersion = Math.min(commonWireVersion, serverDescription.maxWireVersion);\n            }\n        }\n        if (typeof serverDescription.setName === 'string' &&\n            typeof setName === 'string' &&\n            serverDescription.setName !== setName) {\n            if (topologyType === common_1.TopologyType.Single) {\n                // \"Single\" Topology with setName mismatch is direct connection usage, mark unknown do not remove\n                serverDescription = new server_description_1.ServerDescription(address);\n            }\n            else {\n                serverDescriptions.delete(address);\n            }\n        }\n        // update the actual server description\n        serverDescriptions.set(address, serverDescription);\n        if (topologyType === common_1.TopologyType.Single) {\n            // once we are defined as single, that never changes\n            return new TopologyDescription(common_1.TopologyType.Single, serverDescriptions, setName, maxSetVersion, maxElectionId, commonWireVersion, { heartbeatFrequencyMS: this.heartbeatFrequencyMS, localThresholdMS: this.localThresholdMS });\n        }\n        if (topologyType === common_1.TopologyType.Unknown) {\n            if (serverType === common_1.ServerType.Standalone && this.servers.size !== 1) {\n                serverDescriptions.delete(address);\n            }\n            else {\n                topologyType = topologyTypeForServerType(serverType);\n            }\n        }\n        if (topologyType === common_1.TopologyType.Sharded) {\n            if (!MONGOS_OR_UNKNOWN.has(serverType)) {\n                serverDescriptions.delete(address);\n            }\n        }\n        if (topologyType === common_1.TopologyType.ReplicaSetNoPrimary) {\n            if (MONGOS_OR_STANDALONE.has(serverType)) {\n                serverDescriptions.delete(address);\n            }\n            if (serverType === common_1.ServerType.RSPrimary) {\n                const result = updateRsFromPrimary(serverDescriptions, serverDescription, setName, maxSetVersion, maxElectionId);\n                topologyType = result[0];\n                setName = result[1];\n                maxSetVersion = result[2];\n                maxElectionId = result[3];\n            }\n            else if (NON_PRIMARY_RS_MEMBERS.has(serverType)) {\n                const result = updateRsNoPrimaryFromMember(serverDescriptions, serverDescription, setName);\n                topologyType = result[0];\n                setName = result[1];\n            }\n        }\n        if (topologyType === common_1.TopologyType.ReplicaSetWithPrimary) {\n            if (MONGOS_OR_STANDALONE.has(serverType)) {\n                serverDescriptions.delete(address);\n                topologyType = checkHasPrimary(serverDescriptions);\n            }\n            else if (serverType === common_1.ServerType.RSPrimary) {\n                const result = updateRsFromPrimary(serverDescriptions, serverDescription, setName, maxSetVersion, maxElectionId);\n                topologyType = result[0];\n                setName = result[1];\n                maxSetVersion = result[2];\n                maxElectionId = result[3];\n            }\n            else if (NON_PRIMARY_RS_MEMBERS.has(serverType)) {\n                topologyType = updateRsWithPrimaryFromMember(serverDescriptions, serverDescription, setName);\n            }\n            else {\n                topologyType = checkHasPrimary(serverDescriptions);\n            }\n        }\n        return new TopologyDescription(topologyType, serverDescriptions, setName, maxSetVersion, maxElectionId, commonWireVersion, { heartbeatFrequencyMS: this.heartbeatFrequencyMS, localThresholdMS: this.localThresholdMS });\n    }\n    get error() {\n        const descriptionsWithError = Array.from(this.servers.values()).filter((sd) => sd.error);\n        if (descriptionsWithError.length > 0) {\n            return descriptionsWithError[0].error;\n        }\n        return null;\n    }\n    /**\n     * Determines if the topology description has any known servers\n     */\n    get hasKnownServers() {\n        return Array.from(this.servers.values()).some((sd) => sd.type !== common_1.ServerType.Unknown);\n    }\n    /**\n     * Determines if this topology description has a data-bearing server available.\n     */\n    get hasDataBearingServers() {\n        return Array.from(this.servers.values()).some((sd) => sd.isDataBearing);\n    }\n    /**\n     * Determines if the topology has a definition for the provided address\n     * @internal\n     */\n    hasServer(address) {\n        return this.servers.has(address);\n    }\n}\nexports.TopologyDescription = TopologyDescription;\nfunction topologyTypeForServerType(serverType) {\n    switch (serverType) {\n        case common_1.ServerType.Standalone:\n            return common_1.TopologyType.Single;\n        case common_1.ServerType.Mongos:\n            return common_1.TopologyType.Sharded;\n        case common_1.ServerType.RSPrimary:\n            return common_1.TopologyType.ReplicaSetWithPrimary;\n        case common_1.ServerType.RSOther:\n        case common_1.ServerType.RSSecondary:\n            return common_1.TopologyType.ReplicaSetNoPrimary;\n        default:\n            return common_1.TopologyType.Unknown;\n    }\n}\nfunction updateRsFromPrimary(serverDescriptions, serverDescription, setName = null, maxSetVersion = null, maxElectionId = null) {\n    setName = setName || serverDescription.setName;\n    if (setName !== serverDescription.setName) {\n        serverDescriptions.delete(serverDescription.address);\n        return [checkHasPrimary(serverDescriptions), setName, maxSetVersion, maxElectionId];\n    }\n    if (serverDescription.maxWireVersion >= 17) {\n        const electionIdComparison = (0, utils_1.compareObjectId)(maxElectionId, serverDescription.electionId);\n        const maxElectionIdIsEqual = electionIdComparison === 0;\n        const maxElectionIdIsLess = electionIdComparison === -1;\n        const maxSetVersionIsLessOrEqual = (maxSetVersion ?? -1) <= (serverDescription.setVersion ?? -1);\n        if (maxElectionIdIsLess || (maxElectionIdIsEqual && maxSetVersionIsLessOrEqual)) {\n            // The reported electionId was greater\n            // or the electionId was equal and reported setVersion was greater\n            // Always update both values, they are a tuple\n            maxElectionId = serverDescription.electionId;\n            maxSetVersion = serverDescription.setVersion;\n        }\n        else {\n            // Stale primary\n            // replace serverDescription with a default ServerDescription of type \"Unknown\"\n            serverDescriptions.set(serverDescription.address, new server_description_1.ServerDescription(serverDescription.address));\n            return [checkHasPrimary(serverDescriptions), setName, maxSetVersion, maxElectionId];\n        }\n    }\n    else {\n        const electionId = serverDescription.electionId ? serverDescription.electionId : null;\n        if (serverDescription.setVersion && electionId) {\n            if (maxSetVersion && maxElectionId) {\n                if (maxSetVersion > serverDescription.setVersion ||\n                    (0, utils_1.compareObjectId)(maxElectionId, electionId) > 0) {\n                    // this primary is stale, we must remove it\n                    serverDescriptions.set(serverDescription.address, new server_description_1.ServerDescription(serverDescription.address));\n                    return [checkHasPrimary(serverDescriptions), setName, maxSetVersion, maxElectionId];\n                }\n            }\n            maxElectionId = serverDescription.electionId;\n        }\n        if (serverDescription.setVersion != null &&\n            (maxSetVersion == null || serverDescription.setVersion > maxSetVersion)) {\n            maxSetVersion = serverDescription.setVersion;\n        }\n    }\n    // We've heard from the primary. Is it the same primary as before?\n    for (const [address, server] of serverDescriptions) {\n        if (server.type === common_1.ServerType.RSPrimary && server.address !== serverDescription.address) {\n            // Reset old primary's type to Unknown.\n            serverDescriptions.set(address, new server_description_1.ServerDescription(server.address));\n            // There can only be one primary\n            break;\n        }\n    }\n    // Discover new hosts from this primary's response.\n    serverDescription.allHosts.forEach((address) => {\n        if (!serverDescriptions.has(address)) {\n            serverDescriptions.set(address, new server_description_1.ServerDescription(address));\n        }\n    });\n    // Remove hosts not in the response.\n    const currentAddresses = Array.from(serverDescriptions.keys());\n    const responseAddresses = serverDescription.allHosts;\n    currentAddresses\n        .filter((addr) => responseAddresses.indexOf(addr) === -1)\n        .forEach((address) => {\n        serverDescriptions.delete(address);\n    });\n    return [checkHasPrimary(serverDescriptions), setName, maxSetVersion, maxElectionId];\n}\nfunction updateRsWithPrimaryFromMember(serverDescriptions, serverDescription, setName = null) {\n    if (setName == null) {\n        // TODO(NODE-3483): should be an appropriate runtime error\n        throw new error_1.MongoRuntimeError('Argument \"setName\" is required if connected to a replica set');\n    }\n    if (setName !== serverDescription.setName ||\n        (serverDescription.me && serverDescription.address !== serverDescription.me)) {\n        serverDescriptions.delete(serverDescription.address);\n    }\n    return checkHasPrimary(serverDescriptions);\n}\nfunction updateRsNoPrimaryFromMember(serverDescriptions, serverDescription, setName = null) {\n    const topologyType = common_1.TopologyType.ReplicaSetNoPrimary;\n    setName = setName ?? serverDescription.setName;\n    if (setName !== serverDescription.setName) {\n        serverDescriptions.delete(serverDescription.address);\n        return [topologyType, setName];\n    }\n    serverDescription.allHosts.forEach((address) => {\n        if (!serverDescriptions.has(address)) {\n            serverDescriptions.set(address, new server_description_1.ServerDescription(address));\n        }\n    });\n    if (serverDescription.me && serverDescription.address !== serverDescription.me) {\n        serverDescriptions.delete(serverDescription.address);\n    }\n    return [topologyType, setName];\n}\nfunction checkHasPrimary(serverDescriptions) {\n    for (const serverDescription of serverDescriptions.values()) {\n        if (serverDescription.type === common_1.ServerType.RSPrimary) {\n            return common_1.TopologyType.ReplicaSetWithPrimary;\n        }\n    }\n    return common_1.TopologyType.ReplicaSetNoPrimary;\n}\n//# sourceMappingURL=topology_description.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9zZGFtL3RvcG9sb2d5X2Rlc2NyaXB0aW9uLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELDJCQUEyQjtBQUMzQix1QkFBdUIsbUJBQU8sQ0FBQyxpSEFBaUM7QUFDaEUsZ0JBQWdCLG1CQUFPLENBQUMsbUVBQVU7QUFDbEMsZ0JBQWdCLG1CQUFPLENBQUMsbUVBQVU7QUFDbEMsaUJBQWlCLG1CQUFPLENBQUMseUVBQVU7QUFDbkMsNkJBQTZCLG1CQUFPLENBQUMsaUdBQXNCO0FBQzNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1REFBdUQsMkJBQTJCLHdCQUF3QixpQ0FBaUMsdURBQXVELDRCQUE0QixXQUFXLDZCQUE2QjtBQUN0UTtBQUNBO0FBQ0E7QUFDQSx1REFBdUQsMkJBQTJCLHVCQUF1QixpQ0FBaUMscURBQXFELDRCQUE0QixXQUFXLDZCQUE2QjtBQUNuUTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzSkFBc0osMEZBQTBGO0FBQ2hQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjLCtFQUErRTtBQUM3RjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUpBQXlKLDBGQUEwRjtBQUNuUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUlBQXFJLDBGQUEwRjtBQUMvTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQjtBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIkQ6XFxzYWxvbmlcXGFwcHJhaXNhbC1zeXN0ZW1cXHNlcnZlclxcbm9kZV9tb2R1bGVzXFxtb25nb2RiXFxsaWJcXHNkYW1cXHRvcG9sb2d5X2Rlc2NyaXB0aW9uLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5Ub3BvbG9neURlc2NyaXB0aW9uID0gdm9pZCAwO1xuY29uc3QgV0lSRV9DT05TVEFOVFMgPSByZXF1aXJlKFwiLi4vY21hcC93aXJlX3Byb3RvY29sL2NvbnN0YW50c1wiKTtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi4vZXJyb3JcIik7XG5jb25zdCB1dGlsc18xID0gcmVxdWlyZShcIi4uL3V0aWxzXCIpO1xuY29uc3QgY29tbW9uXzEgPSByZXF1aXJlKFwiLi9jb21tb25cIik7XG5jb25zdCBzZXJ2ZXJfZGVzY3JpcHRpb25fMSA9IHJlcXVpcmUoXCIuL3NlcnZlcl9kZXNjcmlwdGlvblwiKTtcbi8vIGNvbnN0YW50cyByZWxhdGVkIHRvIGNvbXBhdGliaWxpdHkgY2hlY2tzXG5jb25zdCBNSU5fU1VQUE9SVEVEX1NFUlZFUl9WRVJTSU9OID0gV0lSRV9DT05TVEFOVFMuTUlOX1NVUFBPUlRFRF9TRVJWRVJfVkVSU0lPTjtcbmNvbnN0IE1BWF9TVVBQT1JURURfU0VSVkVSX1ZFUlNJT04gPSBXSVJFX0NPTlNUQU5UUy5NQVhfU1VQUE9SVEVEX1NFUlZFUl9WRVJTSU9OO1xuY29uc3QgTUlOX1NVUFBPUlRFRF9XSVJFX1ZFUlNJT04gPSBXSVJFX0NPTlNUQU5UUy5NSU5fU1VQUE9SVEVEX1dJUkVfVkVSU0lPTjtcbmNvbnN0IE1BWF9TVVBQT1JURURfV0lSRV9WRVJTSU9OID0gV0lSRV9DT05TVEFOVFMuTUFYX1NVUFBPUlRFRF9XSVJFX1ZFUlNJT047XG5jb25zdCBNT05HT1NfT1JfVU5LTk9XTiA9IG5ldyBTZXQoW2NvbW1vbl8xLlNlcnZlclR5cGUuTW9uZ29zLCBjb21tb25fMS5TZXJ2ZXJUeXBlLlVua25vd25dKTtcbmNvbnN0IE1PTkdPU19PUl9TVEFOREFMT05FID0gbmV3IFNldChbY29tbW9uXzEuU2VydmVyVHlwZS5Nb25nb3MsIGNvbW1vbl8xLlNlcnZlclR5cGUuU3RhbmRhbG9uZV0pO1xuY29uc3QgTk9OX1BSSU1BUllfUlNfTUVNQkVSUyA9IG5ldyBTZXQoW1xuICAgIGNvbW1vbl8xLlNlcnZlclR5cGUuUlNTZWNvbmRhcnksXG4gICAgY29tbW9uXzEuU2VydmVyVHlwZS5SU0FyYml0ZXIsXG4gICAgY29tbW9uXzEuU2VydmVyVHlwZS5SU090aGVyXG5dKTtcbi8qKlxuICogUmVwcmVzZW50YXRpb24gb2YgYSBkZXBsb3ltZW50IG9mIHNlcnZlcnNcbiAqIEBwdWJsaWNcbiAqL1xuY2xhc3MgVG9wb2xvZ3lEZXNjcmlwdGlvbiB7XG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgVG9wb2xvZ3lEZXNjcmlwdGlvblxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKHRvcG9sb2d5VHlwZSwgc2VydmVyRGVzY3JpcHRpb25zID0gbnVsbCwgc2V0TmFtZSA9IG51bGwsIG1heFNldFZlcnNpb24gPSBudWxsLCBtYXhFbGVjdGlvbklkID0gbnVsbCwgY29tbW9uV2lyZVZlcnNpb24gPSBudWxsLCBvcHRpb25zID0gbnVsbCkge1xuICAgICAgICBvcHRpb25zID0gb3B0aW9ucyA/PyB7fTtcbiAgICAgICAgdGhpcy50eXBlID0gdG9wb2xvZ3lUeXBlID8/IGNvbW1vbl8xLlRvcG9sb2d5VHlwZS5Vbmtub3duO1xuICAgICAgICB0aGlzLnNlcnZlcnMgPSBzZXJ2ZXJEZXNjcmlwdGlvbnMgPz8gbmV3IE1hcCgpO1xuICAgICAgICB0aGlzLnN0YWxlID0gZmFsc2U7XG4gICAgICAgIHRoaXMuY29tcGF0aWJsZSA9IHRydWU7XG4gICAgICAgIHRoaXMuaGVhcnRiZWF0RnJlcXVlbmN5TVMgPSBvcHRpb25zLmhlYXJ0YmVhdEZyZXF1ZW5jeU1TID8/IDA7XG4gICAgICAgIHRoaXMubG9jYWxUaHJlc2hvbGRNUyA9IG9wdGlvbnMubG9jYWxUaHJlc2hvbGRNUyA/PyAxNTtcbiAgICAgICAgdGhpcy5zZXROYW1lID0gc2V0TmFtZSA/PyBudWxsO1xuICAgICAgICB0aGlzLm1heEVsZWN0aW9uSWQgPSBtYXhFbGVjdGlvbklkID8/IG51bGw7XG4gICAgICAgIHRoaXMubWF4U2V0VmVyc2lvbiA9IG1heFNldFZlcnNpb24gPz8gbnVsbDtcbiAgICAgICAgdGhpcy5jb21tb25XaXJlVmVyc2lvbiA9IGNvbW1vbldpcmVWZXJzaW9uID8/IDA7XG4gICAgICAgIC8vIGRldGVybWluZSBzZXJ2ZXIgY29tcGF0aWJpbGl0eVxuICAgICAgICBmb3IgKGNvbnN0IHNlcnZlckRlc2NyaXB0aW9uIG9mIHRoaXMuc2VydmVycy52YWx1ZXMoKSkge1xuICAgICAgICAgICAgLy8gTG9hZCBiYWxhbmNlciBtb2RlIGlzIGFsd2F5cyBjb21wYXRpYmxlLlxuICAgICAgICAgICAgaWYgKHNlcnZlckRlc2NyaXB0aW9uLnR5cGUgPT09IGNvbW1vbl8xLlNlcnZlclR5cGUuVW5rbm93biB8fFxuICAgICAgICAgICAgICAgIHNlcnZlckRlc2NyaXB0aW9uLnR5cGUgPT09IGNvbW1vbl8xLlNlcnZlclR5cGUuTG9hZEJhbGFuY2VyKSB7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoc2VydmVyRGVzY3JpcHRpb24ubWluV2lyZVZlcnNpb24gPiBNQVhfU1VQUE9SVEVEX1dJUkVfVkVSU0lPTikge1xuICAgICAgICAgICAgICAgIHRoaXMuY29tcGF0aWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoaXMuY29tcGF0aWJpbGl0eUVycm9yID0gYFNlcnZlciBhdCAke3NlcnZlckRlc2NyaXB0aW9uLmFkZHJlc3N9IHJlcXVpcmVzIHdpcmUgdmVyc2lvbiAke3NlcnZlckRlc2NyaXB0aW9uLm1pbldpcmVWZXJzaW9ufSwgYnV0IHRoaXMgdmVyc2lvbiBvZiB0aGUgZHJpdmVyIG9ubHkgc3VwcG9ydHMgdXAgdG8gJHtNQVhfU1VQUE9SVEVEX1dJUkVfVkVSU0lPTn0gKE1vbmdvREIgJHtNQVhfU1VQUE9SVEVEX1NFUlZFUl9WRVJTSU9OfSlgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHNlcnZlckRlc2NyaXB0aW9uLm1heFdpcmVWZXJzaW9uIDwgTUlOX1NVUFBPUlRFRF9XSVJFX1ZFUlNJT04pIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbXBhdGlibGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbXBhdGliaWxpdHlFcnJvciA9IGBTZXJ2ZXIgYXQgJHtzZXJ2ZXJEZXNjcmlwdGlvbi5hZGRyZXNzfSByZXBvcnRzIHdpcmUgdmVyc2lvbiAke3NlcnZlckRlc2NyaXB0aW9uLm1heFdpcmVWZXJzaW9ufSwgYnV0IHRoaXMgdmVyc2lvbiBvZiB0aGUgZHJpdmVyIHJlcXVpcmVzIGF0IGxlYXN0ICR7TUlOX1NVUFBPUlRFRF9XSVJFX1ZFUlNJT059IChNb25nb0RCICR7TUlOX1NVUFBPUlRFRF9TRVJWRVJfVkVSU0lPTn0pLmA7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gV2hlbmV2ZXIgYSBjbGllbnQgdXBkYXRlcyB0aGUgVG9wb2xvZ3lEZXNjcmlwdGlvbiBmcm9tIGEgaGVsbG8gcmVzcG9uc2UsIGl0IE1VU1Qgc2V0XG4gICAgICAgIC8vIFRvcG9sb2d5RGVzY3JpcHRpb24ubG9naWNhbFNlc3Npb25UaW1lb3V0TWludXRlcyB0byB0aGUgc21hbGxlc3QgbG9naWNhbFNlc3Npb25UaW1lb3V0TWludXRlc1xuICAgICAgICAvLyB2YWx1ZSBhbW9uZyBTZXJ2ZXJEZXNjcmlwdGlvbnMgb2YgYWxsIGRhdGEtYmVhcmluZyBzZXJ2ZXIgdHlwZXMuIElmIGFueSBoYXZlIGEgbnVsbFxuICAgICAgICAvLyBsb2dpY2FsU2Vzc2lvblRpbWVvdXRNaW51dGVzLCB0aGVuIFRvcG9sb2d5RGVzY3JpcHRpb24ubG9naWNhbFNlc3Npb25UaW1lb3V0TWludXRlcyBNVVNUIGJlXG4gICAgICAgIC8vIHNldCB0byBudWxsLlxuICAgICAgICB0aGlzLmxvZ2ljYWxTZXNzaW9uVGltZW91dE1pbnV0ZXMgPSBudWxsO1xuICAgICAgICBmb3IgKGNvbnN0IFssIHNlcnZlcl0gb2YgdGhpcy5zZXJ2ZXJzKSB7XG4gICAgICAgICAgICBpZiAoc2VydmVyLmlzUmVhZGFibGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoc2VydmVyLmxvZ2ljYWxTZXNzaW9uVGltZW91dE1pbnV0ZXMgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBJZiBhbnkgb2YgdGhlIHNlcnZlcnMgaGF2ZSBhIG51bGwgbG9naWNhbFNlc3Npb25zVGltZW91dCwgdGhlbiB0aGUgd2hvbGUgdG9wb2xvZ3kgZG9lc1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2ljYWxTZXNzaW9uVGltZW91dE1pbnV0ZXMgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubG9naWNhbFNlc3Npb25UaW1lb3V0TWludXRlcyA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEZpcnN0IHNlcnZlciB3aXRoIGEgbm9uIG51bGwgbG9naWNhbFNlc3Npb25zVGltZW91dFxuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2ljYWxTZXNzaW9uVGltZW91dE1pbnV0ZXMgPSBzZXJ2ZXIubG9naWNhbFNlc3Npb25UaW1lb3V0TWludXRlcztcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIEFsd2F5cyBzZWxlY3QgdGhlIHNtYWxsZXIgb2YgdGhlOlxuICAgICAgICAgICAgICAgIC8vIGN1cnJlbnQgc2VydmVyIGxvZ2ljYWxTZXNzaW9uc1RpbWVvdXQgYW5kIHRoZSB0b3BvbG9naWVzIGxvZ2ljYWxTZXNzaW9uc1RpbWVvdXRcbiAgICAgICAgICAgICAgICB0aGlzLmxvZ2ljYWxTZXNzaW9uVGltZW91dE1pbnV0ZXMgPSBNYXRoLm1pbih0aGlzLmxvZ2ljYWxTZXNzaW9uVGltZW91dE1pbnV0ZXMsIHNlcnZlci5sb2dpY2FsU2Vzc2lvblRpbWVvdXRNaW51dGVzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGEgbmV3IFRvcG9sb2d5RGVzY3JpcHRpb24gYmFzZWQgb24gdGhlIFNydlBvbGxpbmdFdmVudFxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIHVwZGF0ZUZyb21TcnZQb2xsaW5nRXZlbnQoZXYsIHNydk1heEhvc3RzID0gMCkge1xuICAgICAgICAvKiogVGhlIFNSViBhZGRyZXNzZXMgZGVmaW5lcyB0aGUgc2V0IG9mIGFkZHJlc3NlcyB3ZSBzaG91bGQgYmUgdXNpbmcgKi9cbiAgICAgICAgY29uc3QgaW5jb21pbmdIb3N0bmFtZXMgPSBldi5ob3N0bmFtZXMoKTtcbiAgICAgICAgY29uc3QgY3VycmVudEhvc3RuYW1lcyA9IG5ldyBTZXQodGhpcy5zZXJ2ZXJzLmtleXMoKSk7XG4gICAgICAgIGNvbnN0IGhvc3RuYW1lc1RvQWRkID0gbmV3IFNldChpbmNvbWluZ0hvc3RuYW1lcyk7XG4gICAgICAgIGNvbnN0IGhvc3RuYW1lc1RvUmVtb3ZlID0gbmV3IFNldCgpO1xuICAgICAgICBmb3IgKGNvbnN0IGhvc3RuYW1lIG9mIGN1cnJlbnRIb3N0bmFtZXMpIHtcbiAgICAgICAgICAgIC8vIGZpbHRlciBob3N0bmFtZXNUb0FkZCAobWFkZSBmcm9tIGluY29taW5nSG9zdG5hbWVzKSBkb3duIHRvIHdoYXQgaXMgKm5vdCogcHJlc2VudCBpbiBjdXJyZW50SG9zdG5hbWVzXG4gICAgICAgICAgICBob3N0bmFtZXNUb0FkZC5kZWxldGUoaG9zdG5hbWUpO1xuICAgICAgICAgICAgaWYgKCFpbmNvbWluZ0hvc3RuYW1lcy5oYXMoaG9zdG5hbWUpKSB7XG4gICAgICAgICAgICAgICAgLy8gSWYgdGhlIFNSViBSZWNvcmRzIG5vIGxvbmdlciBpbmNsdWRlIHRoaXMgaG9zdG5hbWVcbiAgICAgICAgICAgICAgICAvLyB3ZSBoYXZlIHRvIHN0b3AgdXNpbmcgaXRcbiAgICAgICAgICAgICAgICBob3N0bmFtZXNUb1JlbW92ZS5hZGQoaG9zdG5hbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChob3N0bmFtZXNUb0FkZC5zaXplID09PSAwICYmIGhvc3RuYW1lc1RvUmVtb3ZlLnNpemUgPT09IDApIHtcbiAgICAgICAgICAgIC8vIE5vIG5ldyBob3N0cyB0byBhZGQgYW5kIG5vbmUgdG8gcmVtb3ZlXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBzZXJ2ZXJEZXNjcmlwdGlvbnMgPSBuZXcgTWFwKHRoaXMuc2VydmVycyk7XG4gICAgICAgIGZvciAoY29uc3QgcmVtb3ZlZEhvc3Qgb2YgaG9zdG5hbWVzVG9SZW1vdmUpIHtcbiAgICAgICAgICAgIHNlcnZlckRlc2NyaXB0aW9ucy5kZWxldGUocmVtb3ZlZEhvc3QpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChob3N0bmFtZXNUb0FkZC5zaXplID4gMCkge1xuICAgICAgICAgICAgaWYgKHNydk1heEhvc3RzID09PSAwKSB7XG4gICAgICAgICAgICAgICAgLy8gQWRkIGFsbCFcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGhvc3RUb0FkZCBvZiBob3N0bmFtZXNUb0FkZCkge1xuICAgICAgICAgICAgICAgICAgICBzZXJ2ZXJEZXNjcmlwdGlvbnMuc2V0KGhvc3RUb0FkZCwgbmV3IHNlcnZlcl9kZXNjcmlwdGlvbl8xLlNlcnZlckRlc2NyaXB0aW9uKGhvc3RUb0FkZCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHNlcnZlckRlc2NyaXB0aW9ucy5zaXplIDwgc3J2TWF4SG9zdHMpIHtcbiAgICAgICAgICAgICAgICAvLyBBZGQgb25seSB0aGUgYW1vdW50IG5lZWRlZCB0byBnZXQgdXMgYmFjayB0byBzcnZNYXhIb3N0c1xuICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkSG9zdHMgPSAoMCwgdXRpbHNfMS5zaHVmZmxlKShob3N0bmFtZXNUb0FkZCwgc3J2TWF4SG9zdHMgLSBzZXJ2ZXJEZXNjcmlwdGlvbnMuc2l6ZSk7XG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBzZWxlY3RlZEhvc3RUb0FkZCBvZiBzZWxlY3RlZEhvc3RzKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlcnZlckRlc2NyaXB0aW9ucy5zZXQoc2VsZWN0ZWRIb3N0VG9BZGQsIG5ldyBzZXJ2ZXJfZGVzY3JpcHRpb25fMS5TZXJ2ZXJEZXNjcmlwdGlvbihzZWxlY3RlZEhvc3RUb0FkZCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3IFRvcG9sb2d5RGVzY3JpcHRpb24odGhpcy50eXBlLCBzZXJ2ZXJEZXNjcmlwdGlvbnMsIHRoaXMuc2V0TmFtZSwgdGhpcy5tYXhTZXRWZXJzaW9uLCB0aGlzLm1heEVsZWN0aW9uSWQsIHRoaXMuY29tbW9uV2lyZVZlcnNpb24sIHsgaGVhcnRiZWF0RnJlcXVlbmN5TVM6IHRoaXMuaGVhcnRiZWF0RnJlcXVlbmN5TVMsIGxvY2FsVGhyZXNob2xkTVM6IHRoaXMubG9jYWxUaHJlc2hvbGRNUyB9KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhIGNvcHkgb2YgdGhpcyBkZXNjcmlwdGlvbiB1cGRhdGVkIHdpdGggYSBnaXZlbiBTZXJ2ZXJEZXNjcmlwdGlvblxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIHVwZGF0ZShzZXJ2ZXJEZXNjcmlwdGlvbikge1xuICAgICAgICBjb25zdCBhZGRyZXNzID0gc2VydmVyRGVzY3JpcHRpb24uYWRkcmVzcztcbiAgICAgICAgLy8gcG90ZW50aWFsbHkgbXV0YXRlZCB2YWx1ZXNcbiAgICAgICAgbGV0IHsgdHlwZTogdG9wb2xvZ3lUeXBlLCBzZXROYW1lLCBtYXhTZXRWZXJzaW9uLCBtYXhFbGVjdGlvbklkLCBjb21tb25XaXJlVmVyc2lvbiB9ID0gdGhpcztcbiAgICAgICAgY29uc3Qgc2VydmVyVHlwZSA9IHNlcnZlckRlc2NyaXB0aW9uLnR5cGU7XG4gICAgICAgIGNvbnN0IHNlcnZlckRlc2NyaXB0aW9ucyA9IG5ldyBNYXAodGhpcy5zZXJ2ZXJzKTtcbiAgICAgICAgLy8gdXBkYXRlIGNvbW1vbiB3aXJlIHZlcnNpb25cbiAgICAgICAgaWYgKHNlcnZlckRlc2NyaXB0aW9uLm1heFdpcmVWZXJzaW9uICE9PSAwKSB7XG4gICAgICAgICAgICBpZiAoY29tbW9uV2lyZVZlcnNpb24gPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGNvbW1vbldpcmVWZXJzaW9uID0gc2VydmVyRGVzY3JpcHRpb24ubWF4V2lyZVZlcnNpb247XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb21tb25XaXJlVmVyc2lvbiA9IE1hdGgubWluKGNvbW1vbldpcmVWZXJzaW9uLCBzZXJ2ZXJEZXNjcmlwdGlvbi5tYXhXaXJlVmVyc2lvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiBzZXJ2ZXJEZXNjcmlwdGlvbi5zZXROYW1lID09PSAnc3RyaW5nJyAmJlxuICAgICAgICAgICAgdHlwZW9mIHNldE5hbWUgPT09ICdzdHJpbmcnICYmXG4gICAgICAgICAgICBzZXJ2ZXJEZXNjcmlwdGlvbi5zZXROYW1lICE9PSBzZXROYW1lKSB7XG4gICAgICAgICAgICBpZiAodG9wb2xvZ3lUeXBlID09PSBjb21tb25fMS5Ub3BvbG9neVR5cGUuU2luZ2xlKSB7XG4gICAgICAgICAgICAgICAgLy8gXCJTaW5nbGVcIiBUb3BvbG9neSB3aXRoIHNldE5hbWUgbWlzbWF0Y2ggaXMgZGlyZWN0IGNvbm5lY3Rpb24gdXNhZ2UsIG1hcmsgdW5rbm93biBkbyBub3QgcmVtb3ZlXG4gICAgICAgICAgICAgICAgc2VydmVyRGVzY3JpcHRpb24gPSBuZXcgc2VydmVyX2Rlc2NyaXB0aW9uXzEuU2VydmVyRGVzY3JpcHRpb24oYWRkcmVzcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBzZXJ2ZXJEZXNjcmlwdGlvbnMuZGVsZXRlKGFkZHJlc3MpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIHVwZGF0ZSB0aGUgYWN0dWFsIHNlcnZlciBkZXNjcmlwdGlvblxuICAgICAgICBzZXJ2ZXJEZXNjcmlwdGlvbnMuc2V0KGFkZHJlc3MsIHNlcnZlckRlc2NyaXB0aW9uKTtcbiAgICAgICAgaWYgKHRvcG9sb2d5VHlwZSA9PT0gY29tbW9uXzEuVG9wb2xvZ3lUeXBlLlNpbmdsZSkge1xuICAgICAgICAgICAgLy8gb25jZSB3ZSBhcmUgZGVmaW5lZCBhcyBzaW5nbGUsIHRoYXQgbmV2ZXIgY2hhbmdlc1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBUb3BvbG9neURlc2NyaXB0aW9uKGNvbW1vbl8xLlRvcG9sb2d5VHlwZS5TaW5nbGUsIHNlcnZlckRlc2NyaXB0aW9ucywgc2V0TmFtZSwgbWF4U2V0VmVyc2lvbiwgbWF4RWxlY3Rpb25JZCwgY29tbW9uV2lyZVZlcnNpb24sIHsgaGVhcnRiZWF0RnJlcXVlbmN5TVM6IHRoaXMuaGVhcnRiZWF0RnJlcXVlbmN5TVMsIGxvY2FsVGhyZXNob2xkTVM6IHRoaXMubG9jYWxUaHJlc2hvbGRNUyB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodG9wb2xvZ3lUeXBlID09PSBjb21tb25fMS5Ub3BvbG9neVR5cGUuVW5rbm93bikge1xuICAgICAgICAgICAgaWYgKHNlcnZlclR5cGUgPT09IGNvbW1vbl8xLlNlcnZlclR5cGUuU3RhbmRhbG9uZSAmJiB0aGlzLnNlcnZlcnMuc2l6ZSAhPT0gMSkge1xuICAgICAgICAgICAgICAgIHNlcnZlckRlc2NyaXB0aW9ucy5kZWxldGUoYWRkcmVzcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0b3BvbG9neVR5cGUgPSB0b3BvbG9neVR5cGVGb3JTZXJ2ZXJUeXBlKHNlcnZlclR5cGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh0b3BvbG9neVR5cGUgPT09IGNvbW1vbl8xLlRvcG9sb2d5VHlwZS5TaGFyZGVkKSB7XG4gICAgICAgICAgICBpZiAoIU1PTkdPU19PUl9VTktOT1dOLmhhcyhzZXJ2ZXJUeXBlKSkge1xuICAgICAgICAgICAgICAgIHNlcnZlckRlc2NyaXB0aW9ucy5kZWxldGUoYWRkcmVzcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRvcG9sb2d5VHlwZSA9PT0gY29tbW9uXzEuVG9wb2xvZ3lUeXBlLlJlcGxpY2FTZXROb1ByaW1hcnkpIHtcbiAgICAgICAgICAgIGlmIChNT05HT1NfT1JfU1RBTkRBTE9ORS5oYXMoc2VydmVyVHlwZSkpIHtcbiAgICAgICAgICAgICAgICBzZXJ2ZXJEZXNjcmlwdGlvbnMuZGVsZXRlKGFkZHJlc3MpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHNlcnZlclR5cGUgPT09IGNvbW1vbl8xLlNlcnZlclR5cGUuUlNQcmltYXJ5KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gdXBkYXRlUnNGcm9tUHJpbWFyeShzZXJ2ZXJEZXNjcmlwdGlvbnMsIHNlcnZlckRlc2NyaXB0aW9uLCBzZXROYW1lLCBtYXhTZXRWZXJzaW9uLCBtYXhFbGVjdGlvbklkKTtcbiAgICAgICAgICAgICAgICB0b3BvbG9neVR5cGUgPSByZXN1bHRbMF07XG4gICAgICAgICAgICAgICAgc2V0TmFtZSA9IHJlc3VsdFsxXTtcbiAgICAgICAgICAgICAgICBtYXhTZXRWZXJzaW9uID0gcmVzdWx0WzJdO1xuICAgICAgICAgICAgICAgIG1heEVsZWN0aW9uSWQgPSByZXN1bHRbM107XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChOT05fUFJJTUFSWV9SU19NRU1CRVJTLmhhcyhzZXJ2ZXJUeXBlKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHVwZGF0ZVJzTm9QcmltYXJ5RnJvbU1lbWJlcihzZXJ2ZXJEZXNjcmlwdGlvbnMsIHNlcnZlckRlc2NyaXB0aW9uLCBzZXROYW1lKTtcbiAgICAgICAgICAgICAgICB0b3BvbG9neVR5cGUgPSByZXN1bHRbMF07XG4gICAgICAgICAgICAgICAgc2V0TmFtZSA9IHJlc3VsdFsxXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAodG9wb2xvZ3lUeXBlID09PSBjb21tb25fMS5Ub3BvbG9neVR5cGUuUmVwbGljYVNldFdpdGhQcmltYXJ5KSB7XG4gICAgICAgICAgICBpZiAoTU9OR09TX09SX1NUQU5EQUxPTkUuaGFzKHNlcnZlclR5cGUpKSB7XG4gICAgICAgICAgICAgICAgc2VydmVyRGVzY3JpcHRpb25zLmRlbGV0ZShhZGRyZXNzKTtcbiAgICAgICAgICAgICAgICB0b3BvbG9neVR5cGUgPSBjaGVja0hhc1ByaW1hcnkoc2VydmVyRGVzY3JpcHRpb25zKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHNlcnZlclR5cGUgPT09IGNvbW1vbl8xLlNlcnZlclR5cGUuUlNQcmltYXJ5KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gdXBkYXRlUnNGcm9tUHJpbWFyeShzZXJ2ZXJEZXNjcmlwdGlvbnMsIHNlcnZlckRlc2NyaXB0aW9uLCBzZXROYW1lLCBtYXhTZXRWZXJzaW9uLCBtYXhFbGVjdGlvbklkKTtcbiAgICAgICAgICAgICAgICB0b3BvbG9neVR5cGUgPSByZXN1bHRbMF07XG4gICAgICAgICAgICAgICAgc2V0TmFtZSA9IHJlc3VsdFsxXTtcbiAgICAgICAgICAgICAgICBtYXhTZXRWZXJzaW9uID0gcmVzdWx0WzJdO1xuICAgICAgICAgICAgICAgIG1heEVsZWN0aW9uSWQgPSByZXN1bHRbM107XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChOT05fUFJJTUFSWV9SU19NRU1CRVJTLmhhcyhzZXJ2ZXJUeXBlKSkge1xuICAgICAgICAgICAgICAgIHRvcG9sb2d5VHlwZSA9IHVwZGF0ZVJzV2l0aFByaW1hcnlGcm9tTWVtYmVyKHNlcnZlckRlc2NyaXB0aW9ucywgc2VydmVyRGVzY3JpcHRpb24sIHNldE5hbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdG9wb2xvZ3lUeXBlID0gY2hlY2tIYXNQcmltYXJ5KHNlcnZlckRlc2NyaXB0aW9ucyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ldyBUb3BvbG9neURlc2NyaXB0aW9uKHRvcG9sb2d5VHlwZSwgc2VydmVyRGVzY3JpcHRpb25zLCBzZXROYW1lLCBtYXhTZXRWZXJzaW9uLCBtYXhFbGVjdGlvbklkLCBjb21tb25XaXJlVmVyc2lvbiwgeyBoZWFydGJlYXRGcmVxdWVuY3lNUzogdGhpcy5oZWFydGJlYXRGcmVxdWVuY3lNUywgbG9jYWxUaHJlc2hvbGRNUzogdGhpcy5sb2NhbFRocmVzaG9sZE1TIH0pO1xuICAgIH1cbiAgICBnZXQgZXJyb3IoKSB7XG4gICAgICAgIGNvbnN0IGRlc2NyaXB0aW9uc1dpdGhFcnJvciA9IEFycmF5LmZyb20odGhpcy5zZXJ2ZXJzLnZhbHVlcygpKS5maWx0ZXIoKHNkKSA9PiBzZC5lcnJvcik7XG4gICAgICAgIGlmIChkZXNjcmlwdGlvbnNXaXRoRXJyb3IubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgcmV0dXJuIGRlc2NyaXB0aW9uc1dpdGhFcnJvclswXS5lcnJvcjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRGV0ZXJtaW5lcyBpZiB0aGUgdG9wb2xvZ3kgZGVzY3JpcHRpb24gaGFzIGFueSBrbm93biBzZXJ2ZXJzXG4gICAgICovXG4gICAgZ2V0IGhhc0tub3duU2VydmVycygpIHtcbiAgICAgICAgcmV0dXJuIEFycmF5LmZyb20odGhpcy5zZXJ2ZXJzLnZhbHVlcygpKS5zb21lKChzZCkgPT4gc2QudHlwZSAhPT0gY29tbW9uXzEuU2VydmVyVHlwZS5Vbmtub3duKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRGV0ZXJtaW5lcyBpZiB0aGlzIHRvcG9sb2d5IGRlc2NyaXB0aW9uIGhhcyBhIGRhdGEtYmVhcmluZyBzZXJ2ZXIgYXZhaWxhYmxlLlxuICAgICAqL1xuICAgIGdldCBoYXNEYXRhQmVhcmluZ1NlcnZlcnMoKSB7XG4gICAgICAgIHJldHVybiBBcnJheS5mcm9tKHRoaXMuc2VydmVycy52YWx1ZXMoKSkuc29tZSgoc2QpID0+IHNkLmlzRGF0YUJlYXJpbmcpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBEZXRlcm1pbmVzIGlmIHRoZSB0b3BvbG9neSBoYXMgYSBkZWZpbml0aW9uIGZvciB0aGUgcHJvdmlkZWQgYWRkcmVzc1xuICAgICAqIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIGhhc1NlcnZlcihhZGRyZXNzKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNlcnZlcnMuaGFzKGFkZHJlc3MpO1xuICAgIH1cbn1cbmV4cG9ydHMuVG9wb2xvZ3lEZXNjcmlwdGlvbiA9IFRvcG9sb2d5RGVzY3JpcHRpb247XG5mdW5jdGlvbiB0b3BvbG9neVR5cGVGb3JTZXJ2ZXJUeXBlKHNlcnZlclR5cGUpIHtcbiAgICBzd2l0Y2ggKHNlcnZlclR5cGUpIHtcbiAgICAgICAgY2FzZSBjb21tb25fMS5TZXJ2ZXJUeXBlLlN0YW5kYWxvbmU6XG4gICAgICAgICAgICByZXR1cm4gY29tbW9uXzEuVG9wb2xvZ3lUeXBlLlNpbmdsZTtcbiAgICAgICAgY2FzZSBjb21tb25fMS5TZXJ2ZXJUeXBlLk1vbmdvczpcbiAgICAgICAgICAgIHJldHVybiBjb21tb25fMS5Ub3BvbG9neVR5cGUuU2hhcmRlZDtcbiAgICAgICAgY2FzZSBjb21tb25fMS5TZXJ2ZXJUeXBlLlJTUHJpbWFyeTpcbiAgICAgICAgICAgIHJldHVybiBjb21tb25fMS5Ub3BvbG9neVR5cGUuUmVwbGljYVNldFdpdGhQcmltYXJ5O1xuICAgICAgICBjYXNlIGNvbW1vbl8xLlNlcnZlclR5cGUuUlNPdGhlcjpcbiAgICAgICAgY2FzZSBjb21tb25fMS5TZXJ2ZXJUeXBlLlJTU2Vjb25kYXJ5OlxuICAgICAgICAgICAgcmV0dXJuIGNvbW1vbl8xLlRvcG9sb2d5VHlwZS5SZXBsaWNhU2V0Tm9QcmltYXJ5O1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgcmV0dXJuIGNvbW1vbl8xLlRvcG9sb2d5VHlwZS5Vbmtub3duO1xuICAgIH1cbn1cbmZ1bmN0aW9uIHVwZGF0ZVJzRnJvbVByaW1hcnkoc2VydmVyRGVzY3JpcHRpb25zLCBzZXJ2ZXJEZXNjcmlwdGlvbiwgc2V0TmFtZSA9IG51bGwsIG1heFNldFZlcnNpb24gPSBudWxsLCBtYXhFbGVjdGlvbklkID0gbnVsbCkge1xuICAgIHNldE5hbWUgPSBzZXROYW1lIHx8IHNlcnZlckRlc2NyaXB0aW9uLnNldE5hbWU7XG4gICAgaWYgKHNldE5hbWUgIT09IHNlcnZlckRlc2NyaXB0aW9uLnNldE5hbWUpIHtcbiAgICAgICAgc2VydmVyRGVzY3JpcHRpb25zLmRlbGV0ZShzZXJ2ZXJEZXNjcmlwdGlvbi5hZGRyZXNzKTtcbiAgICAgICAgcmV0dXJuIFtjaGVja0hhc1ByaW1hcnkoc2VydmVyRGVzY3JpcHRpb25zKSwgc2V0TmFtZSwgbWF4U2V0VmVyc2lvbiwgbWF4RWxlY3Rpb25JZF07XG4gICAgfVxuICAgIGlmIChzZXJ2ZXJEZXNjcmlwdGlvbi5tYXhXaXJlVmVyc2lvbiA+PSAxNykge1xuICAgICAgICBjb25zdCBlbGVjdGlvbklkQ29tcGFyaXNvbiA9ICgwLCB1dGlsc18xLmNvbXBhcmVPYmplY3RJZCkobWF4RWxlY3Rpb25JZCwgc2VydmVyRGVzY3JpcHRpb24uZWxlY3Rpb25JZCk7XG4gICAgICAgIGNvbnN0IG1heEVsZWN0aW9uSWRJc0VxdWFsID0gZWxlY3Rpb25JZENvbXBhcmlzb24gPT09IDA7XG4gICAgICAgIGNvbnN0IG1heEVsZWN0aW9uSWRJc0xlc3MgPSBlbGVjdGlvbklkQ29tcGFyaXNvbiA9PT0gLTE7XG4gICAgICAgIGNvbnN0IG1heFNldFZlcnNpb25Jc0xlc3NPckVxdWFsID0gKG1heFNldFZlcnNpb24gPz8gLTEpIDw9IChzZXJ2ZXJEZXNjcmlwdGlvbi5zZXRWZXJzaW9uID8/IC0xKTtcbiAgICAgICAgaWYgKG1heEVsZWN0aW9uSWRJc0xlc3MgfHwgKG1heEVsZWN0aW9uSWRJc0VxdWFsICYmIG1heFNldFZlcnNpb25Jc0xlc3NPckVxdWFsKSkge1xuICAgICAgICAgICAgLy8gVGhlIHJlcG9ydGVkIGVsZWN0aW9uSWQgd2FzIGdyZWF0ZXJcbiAgICAgICAgICAgIC8vIG9yIHRoZSBlbGVjdGlvbklkIHdhcyBlcXVhbCBhbmQgcmVwb3J0ZWQgc2V0VmVyc2lvbiB3YXMgZ3JlYXRlclxuICAgICAgICAgICAgLy8gQWx3YXlzIHVwZGF0ZSBib3RoIHZhbHVlcywgdGhleSBhcmUgYSB0dXBsZVxuICAgICAgICAgICAgbWF4RWxlY3Rpb25JZCA9IHNlcnZlckRlc2NyaXB0aW9uLmVsZWN0aW9uSWQ7XG4gICAgICAgICAgICBtYXhTZXRWZXJzaW9uID0gc2VydmVyRGVzY3JpcHRpb24uc2V0VmVyc2lvbjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIC8vIFN0YWxlIHByaW1hcnlcbiAgICAgICAgICAgIC8vIHJlcGxhY2Ugc2VydmVyRGVzY3JpcHRpb24gd2l0aCBhIGRlZmF1bHQgU2VydmVyRGVzY3JpcHRpb24gb2YgdHlwZSBcIlVua25vd25cIlxuICAgICAgICAgICAgc2VydmVyRGVzY3JpcHRpb25zLnNldChzZXJ2ZXJEZXNjcmlwdGlvbi5hZGRyZXNzLCBuZXcgc2VydmVyX2Rlc2NyaXB0aW9uXzEuU2VydmVyRGVzY3JpcHRpb24oc2VydmVyRGVzY3JpcHRpb24uYWRkcmVzcykpO1xuICAgICAgICAgICAgcmV0dXJuIFtjaGVja0hhc1ByaW1hcnkoc2VydmVyRGVzY3JpcHRpb25zKSwgc2V0TmFtZSwgbWF4U2V0VmVyc2lvbiwgbWF4RWxlY3Rpb25JZF07XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGNvbnN0IGVsZWN0aW9uSWQgPSBzZXJ2ZXJEZXNjcmlwdGlvbi5lbGVjdGlvbklkID8gc2VydmVyRGVzY3JpcHRpb24uZWxlY3Rpb25JZCA6IG51bGw7XG4gICAgICAgIGlmIChzZXJ2ZXJEZXNjcmlwdGlvbi5zZXRWZXJzaW9uICYmIGVsZWN0aW9uSWQpIHtcbiAgICAgICAgICAgIGlmIChtYXhTZXRWZXJzaW9uICYmIG1heEVsZWN0aW9uSWQpIHtcbiAgICAgICAgICAgICAgICBpZiAobWF4U2V0VmVyc2lvbiA+IHNlcnZlckRlc2NyaXB0aW9uLnNldFZlcnNpb24gfHxcbiAgICAgICAgICAgICAgICAgICAgKDAsIHV0aWxzXzEuY29tcGFyZU9iamVjdElkKShtYXhFbGVjdGlvbklkLCBlbGVjdGlvbklkKSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gdGhpcyBwcmltYXJ5IGlzIHN0YWxlLCB3ZSBtdXN0IHJlbW92ZSBpdFxuICAgICAgICAgICAgICAgICAgICBzZXJ2ZXJEZXNjcmlwdGlvbnMuc2V0KHNlcnZlckRlc2NyaXB0aW9uLmFkZHJlc3MsIG5ldyBzZXJ2ZXJfZGVzY3JpcHRpb25fMS5TZXJ2ZXJEZXNjcmlwdGlvbihzZXJ2ZXJEZXNjcmlwdGlvbi5hZGRyZXNzKSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbY2hlY2tIYXNQcmltYXJ5KHNlcnZlckRlc2NyaXB0aW9ucyksIHNldE5hbWUsIG1heFNldFZlcnNpb24sIG1heEVsZWN0aW9uSWRdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG1heEVsZWN0aW9uSWQgPSBzZXJ2ZXJEZXNjcmlwdGlvbi5lbGVjdGlvbklkO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzZXJ2ZXJEZXNjcmlwdGlvbi5zZXRWZXJzaW9uICE9IG51bGwgJiZcbiAgICAgICAgICAgIChtYXhTZXRWZXJzaW9uID09IG51bGwgfHwgc2VydmVyRGVzY3JpcHRpb24uc2V0VmVyc2lvbiA+IG1heFNldFZlcnNpb24pKSB7XG4gICAgICAgICAgICBtYXhTZXRWZXJzaW9uID0gc2VydmVyRGVzY3JpcHRpb24uc2V0VmVyc2lvbjtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvLyBXZSd2ZSBoZWFyZCBmcm9tIHRoZSBwcmltYXJ5LiBJcyBpdCB0aGUgc2FtZSBwcmltYXJ5IGFzIGJlZm9yZT9cbiAgICBmb3IgKGNvbnN0IFthZGRyZXNzLCBzZXJ2ZXJdIG9mIHNlcnZlckRlc2NyaXB0aW9ucykge1xuICAgICAgICBpZiAoc2VydmVyLnR5cGUgPT09IGNvbW1vbl8xLlNlcnZlclR5cGUuUlNQcmltYXJ5ICYmIHNlcnZlci5hZGRyZXNzICE9PSBzZXJ2ZXJEZXNjcmlwdGlvbi5hZGRyZXNzKSB7XG4gICAgICAgICAgICAvLyBSZXNldCBvbGQgcHJpbWFyeSdzIHR5cGUgdG8gVW5rbm93bi5cbiAgICAgICAgICAgIHNlcnZlckRlc2NyaXB0aW9ucy5zZXQoYWRkcmVzcywgbmV3IHNlcnZlcl9kZXNjcmlwdGlvbl8xLlNlcnZlckRlc2NyaXB0aW9uKHNlcnZlci5hZGRyZXNzKSk7XG4gICAgICAgICAgICAvLyBUaGVyZSBjYW4gb25seSBiZSBvbmUgcHJpbWFyeVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gRGlzY292ZXIgbmV3IGhvc3RzIGZyb20gdGhpcyBwcmltYXJ5J3MgcmVzcG9uc2UuXG4gICAgc2VydmVyRGVzY3JpcHRpb24uYWxsSG9zdHMuZm9yRWFjaCgoYWRkcmVzcykgPT4ge1xuICAgICAgICBpZiAoIXNlcnZlckRlc2NyaXB0aW9ucy5oYXMoYWRkcmVzcykpIHtcbiAgICAgICAgICAgIHNlcnZlckRlc2NyaXB0aW9ucy5zZXQoYWRkcmVzcywgbmV3IHNlcnZlcl9kZXNjcmlwdGlvbl8xLlNlcnZlckRlc2NyaXB0aW9uKGFkZHJlc3MpKTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIC8vIFJlbW92ZSBob3N0cyBub3QgaW4gdGhlIHJlc3BvbnNlLlxuICAgIGNvbnN0IGN1cnJlbnRBZGRyZXNzZXMgPSBBcnJheS5mcm9tKHNlcnZlckRlc2NyaXB0aW9ucy5rZXlzKCkpO1xuICAgIGNvbnN0IHJlc3BvbnNlQWRkcmVzc2VzID0gc2VydmVyRGVzY3JpcHRpb24uYWxsSG9zdHM7XG4gICAgY3VycmVudEFkZHJlc3Nlc1xuICAgICAgICAuZmlsdGVyKChhZGRyKSA9PiByZXNwb25zZUFkZHJlc3Nlcy5pbmRleE9mKGFkZHIpID09PSAtMSlcbiAgICAgICAgLmZvckVhY2goKGFkZHJlc3MpID0+IHtcbiAgICAgICAgc2VydmVyRGVzY3JpcHRpb25zLmRlbGV0ZShhZGRyZXNzKTtcbiAgICB9KTtcbiAgICByZXR1cm4gW2NoZWNrSGFzUHJpbWFyeShzZXJ2ZXJEZXNjcmlwdGlvbnMpLCBzZXROYW1lLCBtYXhTZXRWZXJzaW9uLCBtYXhFbGVjdGlvbklkXTtcbn1cbmZ1bmN0aW9uIHVwZGF0ZVJzV2l0aFByaW1hcnlGcm9tTWVtYmVyKHNlcnZlckRlc2NyaXB0aW9ucywgc2VydmVyRGVzY3JpcHRpb24sIHNldE5hbWUgPSBudWxsKSB7XG4gICAgaWYgKHNldE5hbWUgPT0gbnVsbCkge1xuICAgICAgICAvLyBUT0RPKE5PREUtMzQ4Myk6IHNob3VsZCBiZSBhbiBhcHByb3ByaWF0ZSBydW50aW1lIGVycm9yXG4gICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUnVudGltZUVycm9yKCdBcmd1bWVudCBcInNldE5hbWVcIiBpcyByZXF1aXJlZCBpZiBjb25uZWN0ZWQgdG8gYSByZXBsaWNhIHNldCcpO1xuICAgIH1cbiAgICBpZiAoc2V0TmFtZSAhPT0gc2VydmVyRGVzY3JpcHRpb24uc2V0TmFtZSB8fFxuICAgICAgICAoc2VydmVyRGVzY3JpcHRpb24ubWUgJiYgc2VydmVyRGVzY3JpcHRpb24uYWRkcmVzcyAhPT0gc2VydmVyRGVzY3JpcHRpb24ubWUpKSB7XG4gICAgICAgIHNlcnZlckRlc2NyaXB0aW9ucy5kZWxldGUoc2VydmVyRGVzY3JpcHRpb24uYWRkcmVzcyk7XG4gICAgfVxuICAgIHJldHVybiBjaGVja0hhc1ByaW1hcnkoc2VydmVyRGVzY3JpcHRpb25zKTtcbn1cbmZ1bmN0aW9uIHVwZGF0ZVJzTm9QcmltYXJ5RnJvbU1lbWJlcihzZXJ2ZXJEZXNjcmlwdGlvbnMsIHNlcnZlckRlc2NyaXB0aW9uLCBzZXROYW1lID0gbnVsbCkge1xuICAgIGNvbnN0IHRvcG9sb2d5VHlwZSA9IGNvbW1vbl8xLlRvcG9sb2d5VHlwZS5SZXBsaWNhU2V0Tm9QcmltYXJ5O1xuICAgIHNldE5hbWUgPSBzZXROYW1lID8/IHNlcnZlckRlc2NyaXB0aW9uLnNldE5hbWU7XG4gICAgaWYgKHNldE5hbWUgIT09IHNlcnZlckRlc2NyaXB0aW9uLnNldE5hbWUpIHtcbiAgICAgICAgc2VydmVyRGVzY3JpcHRpb25zLmRlbGV0ZShzZXJ2ZXJEZXNjcmlwdGlvbi5hZGRyZXNzKTtcbiAgICAgICAgcmV0dXJuIFt0b3BvbG9neVR5cGUsIHNldE5hbWVdO1xuICAgIH1cbiAgICBzZXJ2ZXJEZXNjcmlwdGlvbi5hbGxIb3N0cy5mb3JFYWNoKChhZGRyZXNzKSA9PiB7XG4gICAgICAgIGlmICghc2VydmVyRGVzY3JpcHRpb25zLmhhcyhhZGRyZXNzKSkge1xuICAgICAgICAgICAgc2VydmVyRGVzY3JpcHRpb25zLnNldChhZGRyZXNzLCBuZXcgc2VydmVyX2Rlc2NyaXB0aW9uXzEuU2VydmVyRGVzY3JpcHRpb24oYWRkcmVzcykpO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgaWYgKHNlcnZlckRlc2NyaXB0aW9uLm1lICYmIHNlcnZlckRlc2NyaXB0aW9uLmFkZHJlc3MgIT09IHNlcnZlckRlc2NyaXB0aW9uLm1lKSB7XG4gICAgICAgIHNlcnZlckRlc2NyaXB0aW9ucy5kZWxldGUoc2VydmVyRGVzY3JpcHRpb24uYWRkcmVzcyk7XG4gICAgfVxuICAgIHJldHVybiBbdG9wb2xvZ3lUeXBlLCBzZXROYW1lXTtcbn1cbmZ1bmN0aW9uIGNoZWNrSGFzUHJpbWFyeShzZXJ2ZXJEZXNjcmlwdGlvbnMpIHtcbiAgICBmb3IgKGNvbnN0IHNlcnZlckRlc2NyaXB0aW9uIG9mIHNlcnZlckRlc2NyaXB0aW9ucy52YWx1ZXMoKSkge1xuICAgICAgICBpZiAoc2VydmVyRGVzY3JpcHRpb24udHlwZSA9PT0gY29tbW9uXzEuU2VydmVyVHlwZS5SU1ByaW1hcnkpIHtcbiAgICAgICAgICAgIHJldHVybiBjb21tb25fMS5Ub3BvbG9neVR5cGUuUmVwbGljYVNldFdpdGhQcmltYXJ5O1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBjb21tb25fMS5Ub3BvbG9neVR5cGUuUmVwbGljYVNldE5vUHJpbWFyeTtcbn1cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXRvcG9sb2d5X2Rlc2NyaXB0aW9uLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/sdam/topology_description.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/sessions.js":
/*!******************************************************!*\
  !*** ../server/node_modules/mongodb/lib/sessions.js ***!
  \******************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nvar _a;\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.updateSessionFromResponse = exports.applySession = exports.ServerSessionPool = exports.ServerSession = exports.maybeClearPinnedConnection = exports.ClientSession = void 0;\nconst util_1 = __webpack_require__(/*! util */ \"util\");\nconst bson_1 = __webpack_require__(/*! ./bson */ \"(api)/../server/node_modules/mongodb/lib/bson.js\");\nconst metrics_1 = __webpack_require__(/*! ./cmap/metrics */ \"(api)/../server/node_modules/mongodb/lib/cmap/metrics.js\");\nconst shared_1 = __webpack_require__(/*! ./cmap/wire_protocol/shared */ \"(api)/../server/node_modules/mongodb/lib/cmap/wire_protocol/shared.js\");\nconst constants_1 = __webpack_require__(/*! ./constants */ \"(api)/../server/node_modules/mongodb/lib/constants.js\");\nconst error_1 = __webpack_require__(/*! ./error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst mongo_types_1 = __webpack_require__(/*! ./mongo_types */ \"(api)/../server/node_modules/mongodb/lib/mongo_types.js\");\nconst execute_operation_1 = __webpack_require__(/*! ./operations/execute_operation */ \"(api)/../server/node_modules/mongodb/lib/operations/execute_operation.js\");\nconst run_command_1 = __webpack_require__(/*! ./operations/run_command */ \"(api)/../server/node_modules/mongodb/lib/operations/run_command.js\");\nconst read_concern_1 = __webpack_require__(/*! ./read_concern */ \"(api)/../server/node_modules/mongodb/lib/read_concern.js\");\nconst read_preference_1 = __webpack_require__(/*! ./read_preference */ \"(api)/../server/node_modules/mongodb/lib/read_preference.js\");\nconst common_1 = __webpack_require__(/*! ./sdam/common */ \"(api)/../server/node_modules/mongodb/lib/sdam/common.js\");\nconst transactions_1 = __webpack_require__(/*! ./transactions */ \"(api)/../server/node_modules/mongodb/lib/transactions.js\");\nconst utils_1 = __webpack_require__(/*! ./utils */ \"(api)/../server/node_modules/mongodb/lib/utils.js\");\nconst write_concern_1 = __webpack_require__(/*! ./write_concern */ \"(api)/../server/node_modules/mongodb/lib/write_concern.js\");\nconst minWireVersionForShardedTransactions = 8;\n/** @internal */\nconst kServerSession = Symbol('serverSession');\n/** @internal */\nconst kSnapshotTime = Symbol('snapshotTime');\n/** @internal */\nconst kSnapshotEnabled = Symbol('snapshotEnabled');\n/** @internal */\nconst kPinnedConnection = Symbol('pinnedConnection');\n/** @internal Accumulates total number of increments to add to txnNumber when applying session to command */\nconst kTxnNumberIncrement = Symbol('txnNumberIncrement');\n/**\n * A class representing a client session on the server\n *\n * NOTE: not meant to be instantiated directly.\n * @public\n */\nclass ClientSession extends mongo_types_1.TypedEventEmitter {\n    /**\n     * Create a client session.\n     * @internal\n     * @param client - The current client\n     * @param sessionPool - The server session pool (Internal Class)\n     * @param options - Optional settings\n     * @param clientOptions - Optional settings provided when creating a MongoClient\n     */\n    constructor(client, sessionPool, options, clientOptions) {\n        super();\n        /** @internal */\n        this[_a] = false;\n        if (client == null) {\n            // TODO(NODE-3483)\n            throw new error_1.MongoRuntimeError('ClientSession requires a MongoClient');\n        }\n        if (sessionPool == null || !(sessionPool instanceof ServerSessionPool)) {\n            // TODO(NODE-3483)\n            throw new error_1.MongoRuntimeError('ClientSession requires a ServerSessionPool');\n        }\n        options = options ?? {};\n        if (options.snapshot === true) {\n            this[kSnapshotEnabled] = true;\n            if (options.causalConsistency === true) {\n                throw new error_1.MongoInvalidArgumentError('Properties \"causalConsistency\" and \"snapshot\" are mutually exclusive');\n            }\n        }\n        this.client = client;\n        this.sessionPool = sessionPool;\n        this.hasEnded = false;\n        this.clientOptions = clientOptions;\n        this.explicit = !!options.explicit;\n        this[kServerSession] = this.explicit ? this.sessionPool.acquire() : null;\n        this[kTxnNumberIncrement] = 0;\n        const defaultCausalConsistencyValue = this.explicit && options.snapshot !== true;\n        this.supports = {\n            // if we can enable causal consistency, do so by default\n            causalConsistency: options.causalConsistency ?? defaultCausalConsistencyValue\n        };\n        this.clusterTime = options.initialClusterTime;\n        this.operationTime = undefined;\n        this.owner = options.owner;\n        this.defaultTransactionOptions = Object.assign({}, options.defaultTransactionOptions);\n        this.transaction = new transactions_1.Transaction();\n    }\n    /** The server id associated with this session */\n    get id() {\n        return this[kServerSession]?.id;\n    }\n    get serverSession() {\n        let serverSession = this[kServerSession];\n        if (serverSession == null) {\n            if (this.explicit) {\n                throw new error_1.MongoRuntimeError('Unexpected null serverSession for an explicit session');\n            }\n            if (this.hasEnded) {\n                throw new error_1.MongoRuntimeError('Unexpected null serverSession for an ended implicit session');\n            }\n            serverSession = this.sessionPool.acquire();\n            this[kServerSession] = serverSession;\n        }\n        return serverSession;\n    }\n    /** Whether or not this session is configured for snapshot reads */\n    get snapshotEnabled() {\n        return this[kSnapshotEnabled];\n    }\n    get loadBalanced() {\n        return this.client.topology?.description.type === common_1.TopologyType.LoadBalanced;\n    }\n    /** @internal */\n    get pinnedConnection() {\n        return this[kPinnedConnection];\n    }\n    /** @internal */\n    pin(conn) {\n        if (this[kPinnedConnection]) {\n            throw TypeError('Cannot pin multiple connections to the same session');\n        }\n        this[kPinnedConnection] = conn;\n        conn.emit(constants_1.PINNED, this.inTransaction() ? metrics_1.ConnectionPoolMetrics.TXN : metrics_1.ConnectionPoolMetrics.CURSOR);\n    }\n    /** @internal */\n    unpin(options) {\n        if (this.loadBalanced) {\n            return maybeClearPinnedConnection(this, options);\n        }\n        this.transaction.unpinServer();\n    }\n    get isPinned() {\n        return this.loadBalanced ? !!this[kPinnedConnection] : this.transaction.isPinned;\n    }\n    /**\n     * Ends this session on the server\n     *\n     * @param options - Optional settings. Currently reserved for future use\n     */\n    async endSession(options) {\n        try {\n            if (this.inTransaction()) {\n                await this.abortTransaction();\n            }\n            if (!this.hasEnded) {\n                const serverSession = this[kServerSession];\n                if (serverSession != null) {\n                    // release the server session back to the pool\n                    this.sessionPool.release(serverSession);\n                    // Make sure a new serverSession never makes it onto this ClientSession\n                    Object.defineProperty(this, kServerSession, {\n                        value: ServerSession.clone(serverSession),\n                        writable: false\n                    });\n                }\n                // mark the session as ended, and emit a signal\n                this.hasEnded = true;\n                this.emit('ended', this);\n            }\n        }\n        catch {\n            // spec indicates that we should ignore all errors for `endSessions`\n        }\n        finally {\n            maybeClearPinnedConnection(this, { force: true, ...options });\n        }\n    }\n    /**\n     * Advances the operationTime for a ClientSession.\n     *\n     * @param operationTime - the `BSON.Timestamp` of the operation type it is desired to advance to\n     */\n    advanceOperationTime(operationTime) {\n        if (this.operationTime == null) {\n            this.operationTime = operationTime;\n            return;\n        }\n        if (operationTime.greaterThan(this.operationTime)) {\n            this.operationTime = operationTime;\n        }\n    }\n    /**\n     * Advances the clusterTime for a ClientSession to the provided clusterTime of another ClientSession\n     *\n     * @param clusterTime - the $clusterTime returned by the server from another session in the form of a document containing the `BSON.Timestamp` clusterTime and signature\n     */\n    advanceClusterTime(clusterTime) {\n        if (!clusterTime || typeof clusterTime !== 'object') {\n            throw new error_1.MongoInvalidArgumentError('input cluster time must be an object');\n        }\n        if (!clusterTime.clusterTime || clusterTime.clusterTime._bsontype !== 'Timestamp') {\n            throw new error_1.MongoInvalidArgumentError('input cluster time \"clusterTime\" property must be a valid BSON Timestamp');\n        }\n        if (!clusterTime.signature ||\n            clusterTime.signature.hash?._bsontype !== 'Binary' ||\n            (typeof clusterTime.signature.keyId !== 'bigint' &&\n                typeof clusterTime.signature.keyId !== 'number' &&\n                clusterTime.signature.keyId?._bsontype !== 'Long') // apparently we decode the key to number?\n        ) {\n            throw new error_1.MongoInvalidArgumentError('input cluster time must have a valid \"signature\" property with BSON Binary hash and BSON Long keyId');\n        }\n        (0, common_1._advanceClusterTime)(this, clusterTime);\n    }\n    /**\n     * Used to determine if this session equals another\n     *\n     * @param session - The session to compare to\n     */\n    equals(session) {\n        if (!(session instanceof ClientSession)) {\n            return false;\n        }\n        if (this.id == null || session.id == null) {\n            return false;\n        }\n        return utils_1.ByteUtils.equals(this.id.id.buffer, session.id.id.buffer);\n    }\n    /**\n     * Increment the transaction number on the internal ServerSession\n     *\n     * @privateRemarks\n     * This helper increments a value stored on the client session that will be\n     * added to the serverSession's txnNumber upon applying it to a command.\n     * This is because the serverSession is lazily acquired after a connection is obtained\n     */\n    incrementTransactionNumber() {\n        this[kTxnNumberIncrement] += 1;\n    }\n    /** @returns whether this session is currently in a transaction or not */\n    inTransaction() {\n        return this.transaction.isActive;\n    }\n    /**\n     * Starts a new transaction with the given options.\n     *\n     * @param options - Options for the transaction\n     */\n    startTransaction(options) {\n        if (this[kSnapshotEnabled]) {\n            throw new error_1.MongoCompatibilityError('Transactions are not supported in snapshot sessions');\n        }\n        if (this.inTransaction()) {\n            throw new error_1.MongoTransactionError('Transaction already in progress');\n        }\n        if (this.isPinned && this.transaction.isCommitted) {\n            this.unpin();\n        }\n        const topologyMaxWireVersion = (0, utils_1.maxWireVersion)(this.client.topology);\n        if ((0, shared_1.isSharded)(this.client.topology) &&\n            topologyMaxWireVersion != null &&\n            topologyMaxWireVersion < minWireVersionForShardedTransactions) {\n            throw new error_1.MongoCompatibilityError('Transactions are not supported on sharded clusters in MongoDB < 4.2.');\n        }\n        // increment txnNumber\n        this.incrementTransactionNumber();\n        // create transaction state\n        this.transaction = new transactions_1.Transaction({\n            readConcern: options?.readConcern ??\n                this.defaultTransactionOptions.readConcern ??\n                this.clientOptions?.readConcern,\n            writeConcern: options?.writeConcern ??\n                this.defaultTransactionOptions.writeConcern ??\n                this.clientOptions?.writeConcern,\n            readPreference: options?.readPreference ??\n                this.defaultTransactionOptions.readPreference ??\n                this.clientOptions?.readPreference,\n            maxCommitTimeMS: options?.maxCommitTimeMS ?? this.defaultTransactionOptions.maxCommitTimeMS\n        });\n        this.transaction.transition(transactions_1.TxnState.STARTING_TRANSACTION);\n    }\n    /**\n     * Commits the currently active transaction in this session.\n     */\n    async commitTransaction() {\n        return endTransactionAsync(this, 'commitTransaction');\n    }\n    /**\n     * Aborts the currently active transaction in this session.\n     */\n    async abortTransaction() {\n        return endTransactionAsync(this, 'abortTransaction');\n    }\n    /**\n     * This is here to ensure that ClientSession is never serialized to BSON.\n     */\n    toBSON() {\n        throw new error_1.MongoRuntimeError('ClientSession cannot be serialized to BSON.');\n    }\n    /**\n     * Runs a provided callback within a transaction, retrying either the commitTransaction operation\n     * or entire transaction as needed (and when the error permits) to better ensure that\n     * the transaction can complete successfully.\n     *\n     * **IMPORTANT:** This method requires the user to return a Promise, and `await` all operations.\n     * Any callbacks that do not return a Promise will result in undefined behavior.\n     *\n     * @remarks\n     * This function:\n     * - Will return the command response from the final commitTransaction if every operation is successful (can be used as a truthy object)\n     * - Will return `undefined` if the transaction is explicitly aborted with `await session.abortTransaction()`\n     * - Will throw if one of the operations throws or `throw` statement is used inside the `withTransaction` callback\n     *\n     * Checkout a descriptive example here:\n     * @see https://www.mongodb.com/developer/quickstart/node-transactions/\n     *\n     * @param fn - callback to run within a transaction\n     * @param options - optional settings for the transaction\n     * @returns A raw command response or undefined\n     */\n    async withTransaction(fn, options) {\n        const startTime = (0, utils_1.now)();\n        return attemptTransaction(this, startTime, fn, options);\n    }\n}\nexports.ClientSession = ClientSession;\n_a = kSnapshotEnabled;\nconst MAX_WITH_TRANSACTION_TIMEOUT = 120000;\nconst NON_DETERMINISTIC_WRITE_CONCERN_ERRORS = new Set([\n    'CannotSatisfyWriteConcern',\n    'UnknownReplWriteConcern',\n    'UnsatisfiableWriteConcern'\n]);\nfunction hasNotTimedOut(startTime, max) {\n    return (0, utils_1.calculateDurationInMs)(startTime) < max;\n}\nfunction isUnknownTransactionCommitResult(err) {\n    const isNonDeterministicWriteConcernError = err instanceof error_1.MongoServerError &&\n        err.codeName &&\n        NON_DETERMINISTIC_WRITE_CONCERN_ERRORS.has(err.codeName);\n    return (isMaxTimeMSExpiredError(err) ||\n        (!isNonDeterministicWriteConcernError &&\n            err.code !== error_1.MONGODB_ERROR_CODES.UnsatisfiableWriteConcern &&\n            err.code !== error_1.MONGODB_ERROR_CODES.UnknownReplWriteConcern));\n}\nfunction maybeClearPinnedConnection(session, options) {\n    // unpin a connection if it has been pinned\n    const conn = session[kPinnedConnection];\n    const error = options?.error;\n    if (session.inTransaction() &&\n        error &&\n        error instanceof error_1.MongoError &&\n        error.hasErrorLabel(error_1.MongoErrorLabel.TransientTransactionError)) {\n        return;\n    }\n    const topology = session.client.topology;\n    // NOTE: the spec talks about what to do on a network error only, but the tests seem to\n    //       to validate that we don't unpin on _all_ errors?\n    if (conn && topology != null) {\n        const servers = Array.from(topology.s.servers.values());\n        const loadBalancer = servers[0];\n        if (options?.error == null || options?.force) {\n            loadBalancer.pool.checkIn(conn);\n            conn.emit(constants_1.UNPINNED, session.transaction.state !== transactions_1.TxnState.NO_TRANSACTION\n                ? metrics_1.ConnectionPoolMetrics.TXN\n                : metrics_1.ConnectionPoolMetrics.CURSOR);\n            if (options?.forceClear) {\n                loadBalancer.pool.clear({ serviceId: conn.serviceId });\n            }\n        }\n        session[kPinnedConnection] = undefined;\n    }\n}\nexports.maybeClearPinnedConnection = maybeClearPinnedConnection;\nfunction isMaxTimeMSExpiredError(err) {\n    if (err == null || !(err instanceof error_1.MongoServerError)) {\n        return false;\n    }\n    return (err.code === error_1.MONGODB_ERROR_CODES.MaxTimeMSExpired ||\n        (err.writeConcernError && err.writeConcernError.code === error_1.MONGODB_ERROR_CODES.MaxTimeMSExpired));\n}\nfunction attemptTransactionCommit(session, startTime, fn, options) {\n    return session.commitTransaction().catch((err) => {\n        if (err instanceof error_1.MongoError &&\n            hasNotTimedOut(startTime, MAX_WITH_TRANSACTION_TIMEOUT) &&\n            !isMaxTimeMSExpiredError(err)) {\n            if (err.hasErrorLabel(error_1.MongoErrorLabel.UnknownTransactionCommitResult)) {\n                return attemptTransactionCommit(session, startTime, fn, options);\n            }\n            if (err.hasErrorLabel(error_1.MongoErrorLabel.TransientTransactionError)) {\n                return attemptTransaction(session, startTime, fn, options);\n            }\n        }\n        throw err;\n    });\n}\nconst USER_EXPLICIT_TXN_END_STATES = new Set([\n    transactions_1.TxnState.NO_TRANSACTION,\n    transactions_1.TxnState.TRANSACTION_COMMITTED,\n    transactions_1.TxnState.TRANSACTION_ABORTED\n]);\nfunction userExplicitlyEndedTransaction(session) {\n    return USER_EXPLICIT_TXN_END_STATES.has(session.transaction.state);\n}\nfunction attemptTransaction(session, startTime, fn, options) {\n    session.startTransaction(options);\n    let promise;\n    try {\n        promise = fn(session);\n    }\n    catch (err) {\n        promise = Promise.reject(err);\n    }\n    if (!(0, utils_1.isPromiseLike)(promise)) {\n        session.abortTransaction().catch(() => null);\n        throw new error_1.MongoInvalidArgumentError('Function provided to `withTransaction` must return a Promise');\n    }\n    return promise.then(() => {\n        if (userExplicitlyEndedTransaction(session)) {\n            return;\n        }\n        return attemptTransactionCommit(session, startTime, fn, options);\n    }, err => {\n        function maybeRetryOrThrow(err) {\n            if (err instanceof error_1.MongoError &&\n                err.hasErrorLabel(error_1.MongoErrorLabel.TransientTransactionError) &&\n                hasNotTimedOut(startTime, MAX_WITH_TRANSACTION_TIMEOUT)) {\n                return attemptTransaction(session, startTime, fn, options);\n            }\n            if (isMaxTimeMSExpiredError(err)) {\n                err.addErrorLabel(error_1.MongoErrorLabel.UnknownTransactionCommitResult);\n            }\n            throw err;\n        }\n        if (session.inTransaction()) {\n            return session.abortTransaction().then(() => maybeRetryOrThrow(err));\n        }\n        return maybeRetryOrThrow(err);\n    });\n}\nconst endTransactionAsync = (0, util_1.promisify)(endTransaction);\nfunction endTransaction(session, commandName, callback) {\n    // handle any initial problematic cases\n    const txnState = session.transaction.state;\n    if (txnState === transactions_1.TxnState.NO_TRANSACTION) {\n        callback(new error_1.MongoTransactionError('No transaction started'));\n        return;\n    }\n    if (commandName === 'commitTransaction') {\n        if (txnState === transactions_1.TxnState.STARTING_TRANSACTION ||\n            txnState === transactions_1.TxnState.TRANSACTION_COMMITTED_EMPTY) {\n            // the transaction was never started, we can safely exit here\n            session.transaction.transition(transactions_1.TxnState.TRANSACTION_COMMITTED_EMPTY);\n            callback();\n            return;\n        }\n        if (txnState === transactions_1.TxnState.TRANSACTION_ABORTED) {\n            callback(new error_1.MongoTransactionError('Cannot call commitTransaction after calling abortTransaction'));\n            return;\n        }\n    }\n    else {\n        if (txnState === transactions_1.TxnState.STARTING_TRANSACTION) {\n            // the transaction was never started, we can safely exit here\n            session.transaction.transition(transactions_1.TxnState.TRANSACTION_ABORTED);\n            callback();\n            return;\n        }\n        if (txnState === transactions_1.TxnState.TRANSACTION_ABORTED) {\n            callback(new error_1.MongoTransactionError('Cannot call abortTransaction twice'));\n            return;\n        }\n        if (txnState === transactions_1.TxnState.TRANSACTION_COMMITTED ||\n            txnState === transactions_1.TxnState.TRANSACTION_COMMITTED_EMPTY) {\n            callback(new error_1.MongoTransactionError('Cannot call abortTransaction after calling commitTransaction'));\n            return;\n        }\n    }\n    // construct and send the command\n    const command = { [commandName]: 1 };\n    // apply a writeConcern if specified\n    let writeConcern;\n    if (session.transaction.options.writeConcern) {\n        writeConcern = Object.assign({}, session.transaction.options.writeConcern);\n    }\n    else if (session.clientOptions && session.clientOptions.writeConcern) {\n        writeConcern = { w: session.clientOptions.writeConcern.w };\n    }\n    if (txnState === transactions_1.TxnState.TRANSACTION_COMMITTED) {\n        writeConcern = Object.assign({ wtimeoutMS: 10000 }, writeConcern, { w: 'majority' });\n    }\n    if (writeConcern) {\n        write_concern_1.WriteConcern.apply(command, writeConcern);\n    }\n    if (commandName === 'commitTransaction' && session.transaction.options.maxTimeMS) {\n        Object.assign(command, { maxTimeMS: session.transaction.options.maxTimeMS });\n    }\n    function commandHandler(error, result) {\n        if (commandName !== 'commitTransaction') {\n            session.transaction.transition(transactions_1.TxnState.TRANSACTION_ABORTED);\n            if (session.loadBalanced) {\n                maybeClearPinnedConnection(session, { force: false });\n            }\n            // The spec indicates that we should ignore all errors on `abortTransaction`\n            return callback();\n        }\n        session.transaction.transition(transactions_1.TxnState.TRANSACTION_COMMITTED);\n        if (error instanceof error_1.MongoError) {\n            if (error.hasErrorLabel(error_1.MongoErrorLabel.RetryableWriteError) ||\n                error instanceof error_1.MongoWriteConcernError ||\n                isMaxTimeMSExpiredError(error)) {\n                if (isUnknownTransactionCommitResult(error)) {\n                    error.addErrorLabel(error_1.MongoErrorLabel.UnknownTransactionCommitResult);\n                    // per txns spec, must unpin session in this case\n                    session.unpin({ error });\n                }\n            }\n            else if (error.hasErrorLabel(error_1.MongoErrorLabel.TransientTransactionError)) {\n                session.unpin({ error });\n            }\n        }\n        callback(error, result);\n    }\n    if (session.transaction.recoveryToken) {\n        command.recoveryToken = session.transaction.recoveryToken;\n    }\n    // send the command\n    (0, execute_operation_1.executeOperation)(session.client, new run_command_1.RunAdminCommandOperation(undefined, command, {\n        session,\n        readPreference: read_preference_1.ReadPreference.primary,\n        bypassPinningCheck: true\n    }), (error, result) => {\n        if (command.abortTransaction) {\n            // always unpin on abort regardless of command outcome\n            session.unpin();\n        }\n        if (error instanceof error_1.MongoError && error.hasErrorLabel(error_1.MongoErrorLabel.RetryableWriteError)) {\n            // SPEC-1185: apply majority write concern when retrying commitTransaction\n            if (command.commitTransaction) {\n                // per txns spec, must unpin session in this case\n                session.unpin({ force: true });\n                command.writeConcern = Object.assign({ wtimeout: 10000 }, command.writeConcern, {\n                    w: 'majority'\n                });\n            }\n            return (0, execute_operation_1.executeOperation)(session.client, new run_command_1.RunAdminCommandOperation(undefined, command, {\n                session,\n                readPreference: read_preference_1.ReadPreference.primary,\n                bypassPinningCheck: true\n            }), commandHandler);\n        }\n        commandHandler(error, result);\n    });\n}\n/**\n * Reflects the existence of a session on the server. Can be reused by the session pool.\n * WARNING: not meant to be instantiated directly. For internal use only.\n * @public\n */\nclass ServerSession {\n    /** @internal */\n    constructor() {\n        this.id = { id: new bson_1.Binary((0, utils_1.uuidV4)(), bson_1.Binary.SUBTYPE_UUID) };\n        this.lastUse = (0, utils_1.now)();\n        this.txnNumber = 0;\n        this.isDirty = false;\n    }\n    /**\n     * Determines if the server session has timed out.\n     *\n     * @param sessionTimeoutMinutes - The server's \"logicalSessionTimeoutMinutes\"\n     */\n    hasTimedOut(sessionTimeoutMinutes) {\n        // Take the difference of the lastUse timestamp and now, which will result in a value in\n        // milliseconds, and then convert milliseconds to minutes to compare to `sessionTimeoutMinutes`\n        const idleTimeMinutes = Math.round((((0, utils_1.calculateDurationInMs)(this.lastUse) % 86400000) % 3600000) / 60000);\n        return idleTimeMinutes > sessionTimeoutMinutes - 1;\n    }\n    /**\n     * @internal\n     * Cloning meant to keep a readable reference to the server session data\n     * after ClientSession has ended\n     */\n    static clone(serverSession) {\n        const arrayBuffer = new ArrayBuffer(16);\n        const idBytes = Buffer.from(arrayBuffer);\n        idBytes.set(serverSession.id.id.buffer);\n        const id = new bson_1.Binary(idBytes, serverSession.id.id.sub_type);\n        // Manual prototype construction to avoid modifying the constructor of this class\n        return Object.setPrototypeOf({\n            id: { id },\n            lastUse: serverSession.lastUse,\n            txnNumber: serverSession.txnNumber,\n            isDirty: serverSession.isDirty\n        }, ServerSession.prototype);\n    }\n}\nexports.ServerSession = ServerSession;\n/**\n * Maintains a pool of Server Sessions.\n * For internal use only\n * @internal\n */\nclass ServerSessionPool {\n    constructor(client) {\n        if (client == null) {\n            throw new error_1.MongoRuntimeError('ServerSessionPool requires a MongoClient');\n        }\n        this.client = client;\n        this.sessions = new utils_1.List();\n    }\n    /**\n     * Acquire a Server Session from the pool.\n     * Iterates through each session in the pool, removing any stale sessions\n     * along the way. The first non-stale session found is removed from the\n     * pool and returned. If no non-stale session is found, a new ServerSession is created.\n     */\n    acquire() {\n        const sessionTimeoutMinutes = this.client.topology?.logicalSessionTimeoutMinutes ?? 10;\n        let session = null;\n        // Try to obtain from session pool\n        while (this.sessions.length > 0) {\n            const potentialSession = this.sessions.shift();\n            if (potentialSession != null &&\n                (!!this.client.topology?.loadBalanced ||\n                    !potentialSession.hasTimedOut(sessionTimeoutMinutes))) {\n                session = potentialSession;\n                break;\n            }\n        }\n        // If nothing valid came from the pool make a new one\n        if (session == null) {\n            session = new ServerSession();\n        }\n        return session;\n    }\n    /**\n     * Release a session to the session pool\n     * Adds the session back to the session pool if the session has not timed out yet.\n     * This method also removes any stale sessions from the pool.\n     *\n     * @param session - The session to release to the pool\n     */\n    release(session) {\n        const sessionTimeoutMinutes = this.client.topology?.logicalSessionTimeoutMinutes ?? 10;\n        if (this.client.topology?.loadBalanced && !sessionTimeoutMinutes) {\n            this.sessions.unshift(session);\n        }\n        if (!sessionTimeoutMinutes) {\n            return;\n        }\n        this.sessions.prune(session => session.hasTimedOut(sessionTimeoutMinutes));\n        if (!session.hasTimedOut(sessionTimeoutMinutes)) {\n            if (session.isDirty) {\n                return;\n            }\n            // otherwise, readd this session to the session pool\n            this.sessions.unshift(session);\n        }\n    }\n}\nexports.ServerSessionPool = ServerSessionPool;\n/**\n * Optionally decorate a command with sessions specific keys\n *\n * @param session - the session tracking transaction state\n * @param command - the command to decorate\n * @param options - Optional settings passed to calling operation\n *\n * @internal\n */\nfunction applySession(session, command, options) {\n    if (session.hasEnded) {\n        return new error_1.MongoExpiredSessionError();\n    }\n    // May acquire serverSession here\n    const serverSession = session.serverSession;\n    if (serverSession == null) {\n        return new error_1.MongoRuntimeError('Unable to acquire server session');\n    }\n    if (options.writeConcern?.w === 0) {\n        if (session && session.explicit) {\n            // Error if user provided an explicit session to an unacknowledged write (SPEC-1019)\n            return new error_1.MongoAPIError('Cannot have explicit session with unacknowledged writes');\n        }\n        return;\n    }\n    // mark the last use of this session, and apply the `lsid`\n    serverSession.lastUse = (0, utils_1.now)();\n    command.lsid = serverSession.id;\n    const inTxnOrTxnCommand = session.inTransaction() || (0, transactions_1.isTransactionCommand)(command);\n    const isRetryableWrite = !!options.willRetryWrite;\n    if (isRetryableWrite || inTxnOrTxnCommand) {\n        serverSession.txnNumber += session[kTxnNumberIncrement];\n        session[kTxnNumberIncrement] = 0;\n        // TODO(NODE-2674): Preserve int64 sent from MongoDB\n        command.txnNumber = bson_1.Long.fromNumber(serverSession.txnNumber);\n    }\n    if (!inTxnOrTxnCommand) {\n        if (session.transaction.state !== transactions_1.TxnState.NO_TRANSACTION) {\n            session.transaction.transition(transactions_1.TxnState.NO_TRANSACTION);\n        }\n        if (session.supports.causalConsistency &&\n            session.operationTime &&\n            (0, utils_1.commandSupportsReadConcern)(command, options)) {\n            command.readConcern = command.readConcern || {};\n            Object.assign(command.readConcern, { afterClusterTime: session.operationTime });\n        }\n        else if (session[kSnapshotEnabled]) {\n            command.readConcern = command.readConcern || { level: read_concern_1.ReadConcernLevel.snapshot };\n            if (session[kSnapshotTime] != null) {\n                Object.assign(command.readConcern, { atClusterTime: session[kSnapshotTime] });\n            }\n        }\n        return;\n    }\n    // now attempt to apply transaction-specific sessions data\n    // `autocommit` must always be false to differentiate from retryable writes\n    command.autocommit = false;\n    if (session.transaction.state === transactions_1.TxnState.STARTING_TRANSACTION) {\n        session.transaction.transition(transactions_1.TxnState.TRANSACTION_IN_PROGRESS);\n        command.startTransaction = true;\n        const readConcern = session.transaction.options.readConcern || session?.clientOptions?.readConcern;\n        if (readConcern) {\n            command.readConcern = readConcern;\n        }\n        if (session.supports.causalConsistency && session.operationTime) {\n            command.readConcern = command.readConcern || {};\n            Object.assign(command.readConcern, { afterClusterTime: session.operationTime });\n        }\n    }\n    return;\n}\nexports.applySession = applySession;\nfunction updateSessionFromResponse(session, document) {\n    if (document.$clusterTime) {\n        (0, common_1._advanceClusterTime)(session, document.$clusterTime);\n    }\n    if (document.operationTime && session && session.supports.causalConsistency) {\n        session.advanceOperationTime(document.operationTime);\n    }\n    if (document.recoveryToken && session && session.inTransaction()) {\n        session.transaction._recoveryToken = document.recoveryToken;\n    }\n    if (session?.[kSnapshotEnabled] && session[kSnapshotTime] == null) {\n        // find and aggregate commands return atClusterTime on the cursor\n        // distinct includes it in the response body\n        const atClusterTime = document.cursor?.atClusterTime || document.atClusterTime;\n        if (atClusterTime) {\n            session[kSnapshotTime] = atClusterTime;\n        }\n    }\n}\nexports.updateSessionFromResponse = updateSessionFromResponse;\n//# sourceMappingURL=sessions.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9zZXNzaW9ucy5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiO0FBQ0EsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELGlDQUFpQyxHQUFHLG9CQUFvQixHQUFHLHlCQUF5QixHQUFHLHFCQUFxQixHQUFHLGtDQUFrQyxHQUFHLHFCQUFxQjtBQUN6SyxlQUFlLG1CQUFPLENBQUMsa0JBQU07QUFDN0IsZUFBZSxtQkFBTyxDQUFDLGdFQUFRO0FBQy9CLGtCQUFrQixtQkFBTyxDQUFDLGdGQUFnQjtBQUMxQyxpQkFBaUIsbUJBQU8sQ0FBQywwR0FBNkI7QUFDdEQsb0JBQW9CLG1CQUFPLENBQUMsMEVBQWE7QUFDekMsZ0JBQWdCLG1CQUFPLENBQUMsa0VBQVM7QUFDakMsc0JBQXNCLG1CQUFPLENBQUMsOEVBQWU7QUFDN0MsNEJBQTRCLG1CQUFPLENBQUMsZ0hBQWdDO0FBQ3BFLHNCQUFzQixtQkFBTyxDQUFDLG9HQUEwQjtBQUN4RCx1QkFBdUIsbUJBQU8sQ0FBQyxnRkFBZ0I7QUFDL0MsMEJBQTBCLG1CQUFPLENBQUMsc0ZBQW1CO0FBQ3JELGlCQUFpQixtQkFBTyxDQUFDLDhFQUFlO0FBQ3hDLHVCQUF1QixtQkFBTyxDQUFDLGdGQUFnQjtBQUMvQyxnQkFBZ0IsbUJBQU8sQ0FBQyxrRUFBUztBQUNqQyx3QkFBd0IsbUJBQU8sQ0FBQyxrRkFBaUI7QUFDakQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseURBQXlEO0FBQ3pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQ0FBK0MseUJBQXlCO0FBQ3hFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMENBQTBDLDJCQUEyQjtBQUNyRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0NBQWtDO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQjtBQUN0QjtBQUNBO0FBQ0E7QUFDQSx1Q0FBdUM7QUFDdkM7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0EsdUNBQXVDLG1CQUFtQixrQkFBa0IsZUFBZTtBQUMzRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDLGtEQUFrRDtBQUNuRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0RBQXNELGNBQWM7QUFDcEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0NBQW9DLE9BQU87QUFDM0M7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDLE9BQU87QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0MsYUFBYTtBQUM3Qyx1REFBdUQsaUJBQWlCO0FBQ3hFO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0I7QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLElBQUk7QUFDdEI7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpREFBaUQseUNBQXlDO0FBQzFGO0FBQ0E7QUFDQSwyREFBMkQ7QUFDM0Q7QUFDQSxxREFBcUQsdUNBQXVDO0FBQzVGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaURBQWlELHlDQUF5QztBQUMxRjtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQjtBQUNwQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQztBQUNqQyIsInNvdXJjZXMiOlsiRDpcXHNhbG9uaVxcYXBwcmFpc2FsLXN5c3RlbVxcc2VydmVyXFxub2RlX21vZHVsZXNcXG1vbmdvZGJcXGxpYlxcc2Vzc2lvbnMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX2E7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnVwZGF0ZVNlc3Npb25Gcm9tUmVzcG9uc2UgPSBleHBvcnRzLmFwcGx5U2Vzc2lvbiA9IGV4cG9ydHMuU2VydmVyU2Vzc2lvblBvb2wgPSBleHBvcnRzLlNlcnZlclNlc3Npb24gPSBleHBvcnRzLm1heWJlQ2xlYXJQaW5uZWRDb25uZWN0aW9uID0gZXhwb3J0cy5DbGllbnRTZXNzaW9uID0gdm9pZCAwO1xuY29uc3QgdXRpbF8xID0gcmVxdWlyZShcInV0aWxcIik7XG5jb25zdCBic29uXzEgPSByZXF1aXJlKFwiLi9ic29uXCIpO1xuY29uc3QgbWV0cmljc18xID0gcmVxdWlyZShcIi4vY21hcC9tZXRyaWNzXCIpO1xuY29uc3Qgc2hhcmVkXzEgPSByZXF1aXJlKFwiLi9jbWFwL3dpcmVfcHJvdG9jb2wvc2hhcmVkXCIpO1xuY29uc3QgY29uc3RhbnRzXzEgPSByZXF1aXJlKFwiLi9jb25zdGFudHNcIik7XG5jb25zdCBlcnJvcl8xID0gcmVxdWlyZShcIi4vZXJyb3JcIik7XG5jb25zdCBtb25nb190eXBlc18xID0gcmVxdWlyZShcIi4vbW9uZ29fdHlwZXNcIik7XG5jb25zdCBleGVjdXRlX29wZXJhdGlvbl8xID0gcmVxdWlyZShcIi4vb3BlcmF0aW9ucy9leGVjdXRlX29wZXJhdGlvblwiKTtcbmNvbnN0IHJ1bl9jb21tYW5kXzEgPSByZXF1aXJlKFwiLi9vcGVyYXRpb25zL3J1bl9jb21tYW5kXCIpO1xuY29uc3QgcmVhZF9jb25jZXJuXzEgPSByZXF1aXJlKFwiLi9yZWFkX2NvbmNlcm5cIik7XG5jb25zdCByZWFkX3ByZWZlcmVuY2VfMSA9IHJlcXVpcmUoXCIuL3JlYWRfcHJlZmVyZW5jZVwiKTtcbmNvbnN0IGNvbW1vbl8xID0gcmVxdWlyZShcIi4vc2RhbS9jb21tb25cIik7XG5jb25zdCB0cmFuc2FjdGlvbnNfMSA9IHJlcXVpcmUoXCIuL3RyYW5zYWN0aW9uc1wiKTtcbmNvbnN0IHV0aWxzXzEgPSByZXF1aXJlKFwiLi91dGlsc1wiKTtcbmNvbnN0IHdyaXRlX2NvbmNlcm5fMSA9IHJlcXVpcmUoXCIuL3dyaXRlX2NvbmNlcm5cIik7XG5jb25zdCBtaW5XaXJlVmVyc2lvbkZvclNoYXJkZWRUcmFuc2FjdGlvbnMgPSA4O1xuLyoqIEBpbnRlcm5hbCAqL1xuY29uc3Qga1NlcnZlclNlc3Npb24gPSBTeW1ib2woJ3NlcnZlclNlc3Npb24nKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNvbnN0IGtTbmFwc2hvdFRpbWUgPSBTeW1ib2woJ3NuYXBzaG90VGltZScpO1xuLyoqIEBpbnRlcm5hbCAqL1xuY29uc3Qga1NuYXBzaG90RW5hYmxlZCA9IFN5bWJvbCgnc25hcHNob3RFbmFibGVkJyk7XG4vKiogQGludGVybmFsICovXG5jb25zdCBrUGlubmVkQ29ubmVjdGlvbiA9IFN5bWJvbCgncGlubmVkQ29ubmVjdGlvbicpO1xuLyoqIEBpbnRlcm5hbCBBY2N1bXVsYXRlcyB0b3RhbCBudW1iZXIgb2YgaW5jcmVtZW50cyB0byBhZGQgdG8gdHhuTnVtYmVyIHdoZW4gYXBwbHlpbmcgc2Vzc2lvbiB0byBjb21tYW5kICovXG5jb25zdCBrVHhuTnVtYmVySW5jcmVtZW50ID0gU3ltYm9sKCd0eG5OdW1iZXJJbmNyZW1lbnQnKTtcbi8qKlxuICogQSBjbGFzcyByZXByZXNlbnRpbmcgYSBjbGllbnQgc2Vzc2lvbiBvbiB0aGUgc2VydmVyXG4gKlxuICogTk9URTogbm90IG1lYW50IHRvIGJlIGluc3RhbnRpYXRlZCBkaXJlY3RseS5cbiAqIEBwdWJsaWNcbiAqL1xuY2xhc3MgQ2xpZW50U2Vzc2lvbiBleHRlbmRzIG1vbmdvX3R5cGVzXzEuVHlwZWRFdmVudEVtaXR0ZXIge1xuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIGNsaWVudCBzZXNzaW9uLlxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqIEBwYXJhbSBjbGllbnQgLSBUaGUgY3VycmVudCBjbGllbnRcbiAgICAgKiBAcGFyYW0gc2Vzc2lvblBvb2wgLSBUaGUgc2VydmVyIHNlc3Npb24gcG9vbCAoSW50ZXJuYWwgQ2xhc3MpXG4gICAgICogQHBhcmFtIG9wdGlvbnMgLSBPcHRpb25hbCBzZXR0aW5nc1xuICAgICAqIEBwYXJhbSBjbGllbnRPcHRpb25zIC0gT3B0aW9uYWwgc2V0dGluZ3MgcHJvdmlkZWQgd2hlbiBjcmVhdGluZyBhIE1vbmdvQ2xpZW50XG4gICAgICovXG4gICAgY29uc3RydWN0b3IoY2xpZW50LCBzZXNzaW9uUG9vbCwgb3B0aW9ucywgY2xpZW50T3B0aW9ucykge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICAvKiogQGludGVybmFsICovXG4gICAgICAgIHRoaXNbX2FdID0gZmFsc2U7XG4gICAgICAgIGlmIChjbGllbnQgPT0gbnVsbCkge1xuICAgICAgICAgICAgLy8gVE9ETyhOT0RFLTM0ODMpXG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1J1bnRpbWVFcnJvcignQ2xpZW50U2Vzc2lvbiByZXF1aXJlcyBhIE1vbmdvQ2xpZW50Jyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNlc3Npb25Qb29sID09IG51bGwgfHwgIShzZXNzaW9uUG9vbCBpbnN0YW5jZW9mIFNlcnZlclNlc3Npb25Qb29sKSkge1xuICAgICAgICAgICAgLy8gVE9ETyhOT0RFLTM0ODMpXG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1J1bnRpbWVFcnJvcignQ2xpZW50U2Vzc2lvbiByZXF1aXJlcyBhIFNlcnZlclNlc3Npb25Qb29sJyk7XG4gICAgICAgIH1cbiAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgPz8ge307XG4gICAgICAgIGlmIChvcHRpb25zLnNuYXBzaG90ID09PSB0cnVlKSB7XG4gICAgICAgICAgICB0aGlzW2tTbmFwc2hvdEVuYWJsZWRdID0gdHJ1ZTtcbiAgICAgICAgICAgIGlmIChvcHRpb25zLmNhdXNhbENvbnNpc3RlbmN5ID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignUHJvcGVydGllcyBcImNhdXNhbENvbnNpc3RlbmN5XCIgYW5kIFwic25hcHNob3RcIiBhcmUgbXV0dWFsbHkgZXhjbHVzaXZlJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jbGllbnQgPSBjbGllbnQ7XG4gICAgICAgIHRoaXMuc2Vzc2lvblBvb2wgPSBzZXNzaW9uUG9vbDtcbiAgICAgICAgdGhpcy5oYXNFbmRlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmNsaWVudE9wdGlvbnMgPSBjbGllbnRPcHRpb25zO1xuICAgICAgICB0aGlzLmV4cGxpY2l0ID0gISFvcHRpb25zLmV4cGxpY2l0O1xuICAgICAgICB0aGlzW2tTZXJ2ZXJTZXNzaW9uXSA9IHRoaXMuZXhwbGljaXQgPyB0aGlzLnNlc3Npb25Qb29sLmFjcXVpcmUoKSA6IG51bGw7XG4gICAgICAgIHRoaXNba1R4bk51bWJlckluY3JlbWVudF0gPSAwO1xuICAgICAgICBjb25zdCBkZWZhdWx0Q2F1c2FsQ29uc2lzdGVuY3lWYWx1ZSA9IHRoaXMuZXhwbGljaXQgJiYgb3B0aW9ucy5zbmFwc2hvdCAhPT0gdHJ1ZTtcbiAgICAgICAgdGhpcy5zdXBwb3J0cyA9IHtcbiAgICAgICAgICAgIC8vIGlmIHdlIGNhbiBlbmFibGUgY2F1c2FsIGNvbnNpc3RlbmN5LCBkbyBzbyBieSBkZWZhdWx0XG4gICAgICAgICAgICBjYXVzYWxDb25zaXN0ZW5jeTogb3B0aW9ucy5jYXVzYWxDb25zaXN0ZW5jeSA/PyBkZWZhdWx0Q2F1c2FsQ29uc2lzdGVuY3lWYWx1ZVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmNsdXN0ZXJUaW1lID0gb3B0aW9ucy5pbml0aWFsQ2x1c3RlclRpbWU7XG4gICAgICAgIHRoaXMub3BlcmF0aW9uVGltZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5vd25lciA9IG9wdGlvbnMub3duZXI7XG4gICAgICAgIHRoaXMuZGVmYXVsdFRyYW5zYWN0aW9uT3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oe30sIG9wdGlvbnMuZGVmYXVsdFRyYW5zYWN0aW9uT3B0aW9ucyk7XG4gICAgICAgIHRoaXMudHJhbnNhY3Rpb24gPSBuZXcgdHJhbnNhY3Rpb25zXzEuVHJhbnNhY3Rpb24oKTtcbiAgICB9XG4gICAgLyoqIFRoZSBzZXJ2ZXIgaWQgYXNzb2NpYXRlZCB3aXRoIHRoaXMgc2Vzc2lvbiAqL1xuICAgIGdldCBpZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXNba1NlcnZlclNlc3Npb25dPy5pZDtcbiAgICB9XG4gICAgZ2V0IHNlcnZlclNlc3Npb24oKSB7XG4gICAgICAgIGxldCBzZXJ2ZXJTZXNzaW9uID0gdGhpc1trU2VydmVyU2Vzc2lvbl07XG4gICAgICAgIGlmIChzZXJ2ZXJTZXNzaW9uID09IG51bGwpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmV4cGxpY2l0KSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29SdW50aW1lRXJyb3IoJ1VuZXhwZWN0ZWQgbnVsbCBzZXJ2ZXJTZXNzaW9uIGZvciBhbiBleHBsaWNpdCBzZXNzaW9uJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5oYXNFbmRlZCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUnVudGltZUVycm9yKCdVbmV4cGVjdGVkIG51bGwgc2VydmVyU2Vzc2lvbiBmb3IgYW4gZW5kZWQgaW1wbGljaXQgc2Vzc2lvbicpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc2VydmVyU2Vzc2lvbiA9IHRoaXMuc2Vzc2lvblBvb2wuYWNxdWlyZSgpO1xuICAgICAgICAgICAgdGhpc1trU2VydmVyU2Vzc2lvbl0gPSBzZXJ2ZXJTZXNzaW9uO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzZXJ2ZXJTZXNzaW9uO1xuICAgIH1cbiAgICAvKiogV2hldGhlciBvciBub3QgdGhpcyBzZXNzaW9uIGlzIGNvbmZpZ3VyZWQgZm9yIHNuYXBzaG90IHJlYWRzICovXG4gICAgZ2V0IHNuYXBzaG90RW5hYmxlZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXNba1NuYXBzaG90RW5hYmxlZF07XG4gICAgfVxuICAgIGdldCBsb2FkQmFsYW5jZWQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNsaWVudC50b3BvbG9neT8uZGVzY3JpcHRpb24udHlwZSA9PT0gY29tbW9uXzEuVG9wb2xvZ3lUeXBlLkxvYWRCYWxhbmNlZDtcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGdldCBwaW5uZWRDb25uZWN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpc1trUGlubmVkQ29ubmVjdGlvbl07XG4gICAgfVxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBwaW4oY29ubikge1xuICAgICAgICBpZiAodGhpc1trUGlubmVkQ29ubmVjdGlvbl0pIHtcbiAgICAgICAgICAgIHRocm93IFR5cGVFcnJvcignQ2Fubm90IHBpbiBtdWx0aXBsZSBjb25uZWN0aW9ucyB0byB0aGUgc2FtZSBzZXNzaW9uJyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpc1trUGlubmVkQ29ubmVjdGlvbl0gPSBjb25uO1xuICAgICAgICBjb25uLmVtaXQoY29uc3RhbnRzXzEuUElOTkVELCB0aGlzLmluVHJhbnNhY3Rpb24oKSA/IG1ldHJpY3NfMS5Db25uZWN0aW9uUG9vbE1ldHJpY3MuVFhOIDogbWV0cmljc18xLkNvbm5lY3Rpb25Qb29sTWV0cmljcy5DVVJTT1IpO1xuICAgIH1cbiAgICAvKiogQGludGVybmFsICovXG4gICAgdW5waW4ob3B0aW9ucykge1xuICAgICAgICBpZiAodGhpcy5sb2FkQmFsYW5jZWQpIHtcbiAgICAgICAgICAgIHJldHVybiBtYXliZUNsZWFyUGlubmVkQ29ubmVjdGlvbih0aGlzLCBvcHRpb25zKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnRyYW5zYWN0aW9uLnVucGluU2VydmVyKCk7XG4gICAgfVxuICAgIGdldCBpc1Bpbm5lZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubG9hZEJhbGFuY2VkID8gISF0aGlzW2tQaW5uZWRDb25uZWN0aW9uXSA6IHRoaXMudHJhbnNhY3Rpb24uaXNQaW5uZWQ7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEVuZHMgdGhpcyBzZXNzaW9uIG9uIHRoZSBzZXJ2ZXJcbiAgICAgKlxuICAgICAqIEBwYXJhbSBvcHRpb25zIC0gT3B0aW9uYWwgc2V0dGluZ3MuIEN1cnJlbnRseSByZXNlcnZlZCBmb3IgZnV0dXJlIHVzZVxuICAgICAqL1xuICAgIGFzeW5jIGVuZFNlc3Npb24ob3B0aW9ucykge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgaWYgKHRoaXMuaW5UcmFuc2FjdGlvbigpKSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5hYm9ydFRyYW5zYWN0aW9uKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIXRoaXMuaGFzRW5kZWQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBzZXJ2ZXJTZXNzaW9uID0gdGhpc1trU2VydmVyU2Vzc2lvbl07XG4gICAgICAgICAgICAgICAgaWYgKHNlcnZlclNlc3Npb24gIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAvLyByZWxlYXNlIHRoZSBzZXJ2ZXIgc2Vzc2lvbiBiYWNrIHRvIHRoZSBwb29sXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2Vzc2lvblBvb2wucmVsZWFzZShzZXJ2ZXJTZXNzaW9uKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gTWFrZSBzdXJlIGEgbmV3IHNlcnZlclNlc3Npb24gbmV2ZXIgbWFrZXMgaXQgb250byB0aGlzIENsaWVudFNlc3Npb25cbiAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIGtTZXJ2ZXJTZXNzaW9uLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogU2VydmVyU2Vzc2lvbi5jbG9uZShzZXJ2ZXJTZXNzaW9uKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRhYmxlOiBmYWxzZVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gbWFyayB0aGUgc2Vzc2lvbiBhcyBlbmRlZCwgYW5kIGVtaXQgYSBzaWduYWxcbiAgICAgICAgICAgICAgICB0aGlzLmhhc0VuZGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLmVtaXQoJ2VuZGVkJywgdGhpcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2gge1xuICAgICAgICAgICAgLy8gc3BlYyBpbmRpY2F0ZXMgdGhhdCB3ZSBzaG91bGQgaWdub3JlIGFsbCBlcnJvcnMgZm9yIGBlbmRTZXNzaW9uc2BcbiAgICAgICAgfVxuICAgICAgICBmaW5hbGx5IHtcbiAgICAgICAgICAgIG1heWJlQ2xlYXJQaW5uZWRDb25uZWN0aW9uKHRoaXMsIHsgZm9yY2U6IHRydWUsIC4uLm9wdGlvbnMgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogQWR2YW5jZXMgdGhlIG9wZXJhdGlvblRpbWUgZm9yIGEgQ2xpZW50U2Vzc2lvbi5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBvcGVyYXRpb25UaW1lIC0gdGhlIGBCU09OLlRpbWVzdGFtcGAgb2YgdGhlIG9wZXJhdGlvbiB0eXBlIGl0IGlzIGRlc2lyZWQgdG8gYWR2YW5jZSB0b1xuICAgICAqL1xuICAgIGFkdmFuY2VPcGVyYXRpb25UaW1lKG9wZXJhdGlvblRpbWUpIHtcbiAgICAgICAgaWYgKHRoaXMub3BlcmF0aW9uVGltZSA9PSBudWxsKSB7XG4gICAgICAgICAgICB0aGlzLm9wZXJhdGlvblRpbWUgPSBvcGVyYXRpb25UaW1lO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvcGVyYXRpb25UaW1lLmdyZWF0ZXJUaGFuKHRoaXMub3BlcmF0aW9uVGltZSkpIHtcbiAgICAgICAgICAgIHRoaXMub3BlcmF0aW9uVGltZSA9IG9wZXJhdGlvblRpbWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogQWR2YW5jZXMgdGhlIGNsdXN0ZXJUaW1lIGZvciBhIENsaWVudFNlc3Npb24gdG8gdGhlIHByb3ZpZGVkIGNsdXN0ZXJUaW1lIG9mIGFub3RoZXIgQ2xpZW50U2Vzc2lvblxuICAgICAqXG4gICAgICogQHBhcmFtIGNsdXN0ZXJUaW1lIC0gdGhlICRjbHVzdGVyVGltZSByZXR1cm5lZCBieSB0aGUgc2VydmVyIGZyb20gYW5vdGhlciBzZXNzaW9uIGluIHRoZSBmb3JtIG9mIGEgZG9jdW1lbnQgY29udGFpbmluZyB0aGUgYEJTT04uVGltZXN0YW1wYCBjbHVzdGVyVGltZSBhbmQgc2lnbmF0dXJlXG4gICAgICovXG4gICAgYWR2YW5jZUNsdXN0ZXJUaW1lKGNsdXN0ZXJUaW1lKSB7XG4gICAgICAgIGlmICghY2x1c3RlclRpbWUgfHwgdHlwZW9mIGNsdXN0ZXJUaW1lICE9PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignaW5wdXQgY2x1c3RlciB0aW1lIG11c3QgYmUgYW4gb2JqZWN0Jyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFjbHVzdGVyVGltZS5jbHVzdGVyVGltZSB8fCBjbHVzdGVyVGltZS5jbHVzdGVyVGltZS5fYnNvbnR5cGUgIT09ICdUaW1lc3RhbXAnKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdpbnB1dCBjbHVzdGVyIHRpbWUgXCJjbHVzdGVyVGltZVwiIHByb3BlcnR5IG11c3QgYmUgYSB2YWxpZCBCU09OIFRpbWVzdGFtcCcpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghY2x1c3RlclRpbWUuc2lnbmF0dXJlIHx8XG4gICAgICAgICAgICBjbHVzdGVyVGltZS5zaWduYXR1cmUuaGFzaD8uX2Jzb250eXBlICE9PSAnQmluYXJ5JyB8fFxuICAgICAgICAgICAgKHR5cGVvZiBjbHVzdGVyVGltZS5zaWduYXR1cmUua2V5SWQgIT09ICdiaWdpbnQnICYmXG4gICAgICAgICAgICAgICAgdHlwZW9mIGNsdXN0ZXJUaW1lLnNpZ25hdHVyZS5rZXlJZCAhPT0gJ251bWJlcicgJiZcbiAgICAgICAgICAgICAgICBjbHVzdGVyVGltZS5zaWduYXR1cmUua2V5SWQ/Ll9ic29udHlwZSAhPT0gJ0xvbmcnKSAvLyBhcHBhcmVudGx5IHdlIGRlY29kZSB0aGUga2V5IHRvIG51bWJlcj9cbiAgICAgICAgKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdpbnB1dCBjbHVzdGVyIHRpbWUgbXVzdCBoYXZlIGEgdmFsaWQgXCJzaWduYXR1cmVcIiBwcm9wZXJ0eSB3aXRoIEJTT04gQmluYXJ5IGhhc2ggYW5kIEJTT04gTG9uZyBrZXlJZCcpO1xuICAgICAgICB9XG4gICAgICAgICgwLCBjb21tb25fMS5fYWR2YW5jZUNsdXN0ZXJUaW1lKSh0aGlzLCBjbHVzdGVyVGltZSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFVzZWQgdG8gZGV0ZXJtaW5lIGlmIHRoaXMgc2Vzc2lvbiBlcXVhbHMgYW5vdGhlclxuICAgICAqXG4gICAgICogQHBhcmFtIHNlc3Npb24gLSBUaGUgc2Vzc2lvbiB0byBjb21wYXJlIHRvXG4gICAgICovXG4gICAgZXF1YWxzKHNlc3Npb24pIHtcbiAgICAgICAgaWYgKCEoc2Vzc2lvbiBpbnN0YW5jZW9mIENsaWVudFNlc3Npb24pKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuaWQgPT0gbnVsbCB8fCBzZXNzaW9uLmlkID09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdXRpbHNfMS5CeXRlVXRpbHMuZXF1YWxzKHRoaXMuaWQuaWQuYnVmZmVyLCBzZXNzaW9uLmlkLmlkLmJ1ZmZlcik7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEluY3JlbWVudCB0aGUgdHJhbnNhY3Rpb24gbnVtYmVyIG9uIHRoZSBpbnRlcm5hbCBTZXJ2ZXJTZXNzaW9uXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVJlbWFya3NcbiAgICAgKiBUaGlzIGhlbHBlciBpbmNyZW1lbnRzIGEgdmFsdWUgc3RvcmVkIG9uIHRoZSBjbGllbnQgc2Vzc2lvbiB0aGF0IHdpbGwgYmVcbiAgICAgKiBhZGRlZCB0byB0aGUgc2VydmVyU2Vzc2lvbidzIHR4bk51bWJlciB1cG9uIGFwcGx5aW5nIGl0IHRvIGEgY29tbWFuZC5cbiAgICAgKiBUaGlzIGlzIGJlY2F1c2UgdGhlIHNlcnZlclNlc3Npb24gaXMgbGF6aWx5IGFjcXVpcmVkIGFmdGVyIGEgY29ubmVjdGlvbiBpcyBvYnRhaW5lZFxuICAgICAqL1xuICAgIGluY3JlbWVudFRyYW5zYWN0aW9uTnVtYmVyKCkge1xuICAgICAgICB0aGlzW2tUeG5OdW1iZXJJbmNyZW1lbnRdICs9IDE7XG4gICAgfVxuICAgIC8qKiBAcmV0dXJucyB3aGV0aGVyIHRoaXMgc2Vzc2lvbiBpcyBjdXJyZW50bHkgaW4gYSB0cmFuc2FjdGlvbiBvciBub3QgKi9cbiAgICBpblRyYW5zYWN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy50cmFuc2FjdGlvbi5pc0FjdGl2ZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU3RhcnRzIGEgbmV3IHRyYW5zYWN0aW9uIHdpdGggdGhlIGdpdmVuIG9wdGlvbnMuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbnMgZm9yIHRoZSB0cmFuc2FjdGlvblxuICAgICAqL1xuICAgIHN0YXJ0VHJhbnNhY3Rpb24ob3B0aW9ucykge1xuICAgICAgICBpZiAodGhpc1trU25hcHNob3RFbmFibGVkXSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29Db21wYXRpYmlsaXR5RXJyb3IoJ1RyYW5zYWN0aW9ucyBhcmUgbm90IHN1cHBvcnRlZCBpbiBzbmFwc2hvdCBzZXNzaW9ucycpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmluVHJhbnNhY3Rpb24oKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29UcmFuc2FjdGlvbkVycm9yKCdUcmFuc2FjdGlvbiBhbHJlYWR5IGluIHByb2dyZXNzJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuaXNQaW5uZWQgJiYgdGhpcy50cmFuc2FjdGlvbi5pc0NvbW1pdHRlZCkge1xuICAgICAgICAgICAgdGhpcy51bnBpbigpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHRvcG9sb2d5TWF4V2lyZVZlcnNpb24gPSAoMCwgdXRpbHNfMS5tYXhXaXJlVmVyc2lvbikodGhpcy5jbGllbnQudG9wb2xvZ3kpO1xuICAgICAgICBpZiAoKDAsIHNoYXJlZF8xLmlzU2hhcmRlZCkodGhpcy5jbGllbnQudG9wb2xvZ3kpICYmXG4gICAgICAgICAgICB0b3BvbG9neU1heFdpcmVWZXJzaW9uICE9IG51bGwgJiZcbiAgICAgICAgICAgIHRvcG9sb2d5TWF4V2lyZVZlcnNpb24gPCBtaW5XaXJlVmVyc2lvbkZvclNoYXJkZWRUcmFuc2FjdGlvbnMpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvQ29tcGF0aWJpbGl0eUVycm9yKCdUcmFuc2FjdGlvbnMgYXJlIG5vdCBzdXBwb3J0ZWQgb24gc2hhcmRlZCBjbHVzdGVycyBpbiBNb25nb0RCIDwgNC4yLicpO1xuICAgICAgICB9XG4gICAgICAgIC8vIGluY3JlbWVudCB0eG5OdW1iZXJcbiAgICAgICAgdGhpcy5pbmNyZW1lbnRUcmFuc2FjdGlvbk51bWJlcigpO1xuICAgICAgICAvLyBjcmVhdGUgdHJhbnNhY3Rpb24gc3RhdGVcbiAgICAgICAgdGhpcy50cmFuc2FjdGlvbiA9IG5ldyB0cmFuc2FjdGlvbnNfMS5UcmFuc2FjdGlvbih7XG4gICAgICAgICAgICByZWFkQ29uY2Vybjogb3B0aW9ucz8ucmVhZENvbmNlcm4gPz9cbiAgICAgICAgICAgICAgICB0aGlzLmRlZmF1bHRUcmFuc2FjdGlvbk9wdGlvbnMucmVhZENvbmNlcm4gPz9cbiAgICAgICAgICAgICAgICB0aGlzLmNsaWVudE9wdGlvbnM/LnJlYWRDb25jZXJuLFxuICAgICAgICAgICAgd3JpdGVDb25jZXJuOiBvcHRpb25zPy53cml0ZUNvbmNlcm4gPz9cbiAgICAgICAgICAgICAgICB0aGlzLmRlZmF1bHRUcmFuc2FjdGlvbk9wdGlvbnMud3JpdGVDb25jZXJuID8/XG4gICAgICAgICAgICAgICAgdGhpcy5jbGllbnRPcHRpb25zPy53cml0ZUNvbmNlcm4sXG4gICAgICAgICAgICByZWFkUHJlZmVyZW5jZTogb3B0aW9ucz8ucmVhZFByZWZlcmVuY2UgPz9cbiAgICAgICAgICAgICAgICB0aGlzLmRlZmF1bHRUcmFuc2FjdGlvbk9wdGlvbnMucmVhZFByZWZlcmVuY2UgPz9cbiAgICAgICAgICAgICAgICB0aGlzLmNsaWVudE9wdGlvbnM/LnJlYWRQcmVmZXJlbmNlLFxuICAgICAgICAgICAgbWF4Q29tbWl0VGltZU1TOiBvcHRpb25zPy5tYXhDb21taXRUaW1lTVMgPz8gdGhpcy5kZWZhdWx0VHJhbnNhY3Rpb25PcHRpb25zLm1heENvbW1pdFRpbWVNU1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy50cmFuc2FjdGlvbi50cmFuc2l0aW9uKHRyYW5zYWN0aW9uc18xLlR4blN0YXRlLlNUQVJUSU5HX1RSQU5TQUNUSU9OKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ29tbWl0cyB0aGUgY3VycmVudGx5IGFjdGl2ZSB0cmFuc2FjdGlvbiBpbiB0aGlzIHNlc3Npb24uXG4gICAgICovXG4gICAgYXN5bmMgY29tbWl0VHJhbnNhY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBlbmRUcmFuc2FjdGlvbkFzeW5jKHRoaXMsICdjb21taXRUcmFuc2FjdGlvbicpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBYm9ydHMgdGhlIGN1cnJlbnRseSBhY3RpdmUgdHJhbnNhY3Rpb24gaW4gdGhpcyBzZXNzaW9uLlxuICAgICAqL1xuICAgIGFzeW5jIGFib3J0VHJhbnNhY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBlbmRUcmFuc2FjdGlvbkFzeW5jKHRoaXMsICdhYm9ydFRyYW5zYWN0aW9uJyk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRoaXMgaXMgaGVyZSB0byBlbnN1cmUgdGhhdCBDbGllbnRTZXNzaW9uIGlzIG5ldmVyIHNlcmlhbGl6ZWQgdG8gQlNPTi5cbiAgICAgKi9cbiAgICB0b0JTT04oKSB7XG4gICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUnVudGltZUVycm9yKCdDbGllbnRTZXNzaW9uIGNhbm5vdCBiZSBzZXJpYWxpemVkIHRvIEJTT04uJyk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJ1bnMgYSBwcm92aWRlZCBjYWxsYmFjayB3aXRoaW4gYSB0cmFuc2FjdGlvbiwgcmV0cnlpbmcgZWl0aGVyIHRoZSBjb21taXRUcmFuc2FjdGlvbiBvcGVyYXRpb25cbiAgICAgKiBvciBlbnRpcmUgdHJhbnNhY3Rpb24gYXMgbmVlZGVkIChhbmQgd2hlbiB0aGUgZXJyb3IgcGVybWl0cykgdG8gYmV0dGVyIGVuc3VyZSB0aGF0XG4gICAgICogdGhlIHRyYW5zYWN0aW9uIGNhbiBjb21wbGV0ZSBzdWNjZXNzZnVsbHkuXG4gICAgICpcbiAgICAgKiAqKklNUE9SVEFOVDoqKiBUaGlzIG1ldGhvZCByZXF1aXJlcyB0aGUgdXNlciB0byByZXR1cm4gYSBQcm9taXNlLCBhbmQgYGF3YWl0YCBhbGwgb3BlcmF0aW9ucy5cbiAgICAgKiBBbnkgY2FsbGJhY2tzIHRoYXQgZG8gbm90IHJldHVybiBhIFByb21pc2Ugd2lsbCByZXN1bHQgaW4gdW5kZWZpbmVkIGJlaGF2aW9yLlxuICAgICAqXG4gICAgICogQHJlbWFya3NcbiAgICAgKiBUaGlzIGZ1bmN0aW9uOlxuICAgICAqIC0gV2lsbCByZXR1cm4gdGhlIGNvbW1hbmQgcmVzcG9uc2UgZnJvbSB0aGUgZmluYWwgY29tbWl0VHJhbnNhY3Rpb24gaWYgZXZlcnkgb3BlcmF0aW9uIGlzIHN1Y2Nlc3NmdWwgKGNhbiBiZSB1c2VkIGFzIGEgdHJ1dGh5IG9iamVjdClcbiAgICAgKiAtIFdpbGwgcmV0dXJuIGB1bmRlZmluZWRgIGlmIHRoZSB0cmFuc2FjdGlvbiBpcyBleHBsaWNpdGx5IGFib3J0ZWQgd2l0aCBgYXdhaXQgc2Vzc2lvbi5hYm9ydFRyYW5zYWN0aW9uKClgXG4gICAgICogLSBXaWxsIHRocm93IGlmIG9uZSBvZiB0aGUgb3BlcmF0aW9ucyB0aHJvd3Mgb3IgYHRocm93YCBzdGF0ZW1lbnQgaXMgdXNlZCBpbnNpZGUgdGhlIGB3aXRoVHJhbnNhY3Rpb25gIGNhbGxiYWNrXG4gICAgICpcbiAgICAgKiBDaGVja291dCBhIGRlc2NyaXB0aXZlIGV4YW1wbGUgaGVyZTpcbiAgICAgKiBAc2VlIGh0dHBzOi8vd3d3Lm1vbmdvZGIuY29tL2RldmVsb3Blci9xdWlja3N0YXJ0L25vZGUtdHJhbnNhY3Rpb25zL1xuICAgICAqXG4gICAgICogQHBhcmFtIGZuIC0gY2FsbGJhY2sgdG8gcnVuIHdpdGhpbiBhIHRyYW5zYWN0aW9uXG4gICAgICogQHBhcmFtIG9wdGlvbnMgLSBvcHRpb25hbCBzZXR0aW5ncyBmb3IgdGhlIHRyYW5zYWN0aW9uXG4gICAgICogQHJldHVybnMgQSByYXcgY29tbWFuZCByZXNwb25zZSBvciB1bmRlZmluZWRcbiAgICAgKi9cbiAgICBhc3luYyB3aXRoVHJhbnNhY3Rpb24oZm4sIG9wdGlvbnMpIHtcbiAgICAgICAgY29uc3Qgc3RhcnRUaW1lID0gKDAsIHV0aWxzXzEubm93KSgpO1xuICAgICAgICByZXR1cm4gYXR0ZW1wdFRyYW5zYWN0aW9uKHRoaXMsIHN0YXJ0VGltZSwgZm4sIG9wdGlvbnMpO1xuICAgIH1cbn1cbmV4cG9ydHMuQ2xpZW50U2Vzc2lvbiA9IENsaWVudFNlc3Npb247XG5fYSA9IGtTbmFwc2hvdEVuYWJsZWQ7XG5jb25zdCBNQVhfV0lUSF9UUkFOU0FDVElPTl9USU1FT1VUID0gMTIwMDAwO1xuY29uc3QgTk9OX0RFVEVSTUlOSVNUSUNfV1JJVEVfQ09OQ0VSTl9FUlJPUlMgPSBuZXcgU2V0KFtcbiAgICAnQ2Fubm90U2F0aXNmeVdyaXRlQ29uY2VybicsXG4gICAgJ1Vua25vd25SZXBsV3JpdGVDb25jZXJuJyxcbiAgICAnVW5zYXRpc2ZpYWJsZVdyaXRlQ29uY2Vybidcbl0pO1xuZnVuY3Rpb24gaGFzTm90VGltZWRPdXQoc3RhcnRUaW1lLCBtYXgpIHtcbiAgICByZXR1cm4gKDAsIHV0aWxzXzEuY2FsY3VsYXRlRHVyYXRpb25Jbk1zKShzdGFydFRpbWUpIDwgbWF4O1xufVxuZnVuY3Rpb24gaXNVbmtub3duVHJhbnNhY3Rpb25Db21taXRSZXN1bHQoZXJyKSB7XG4gICAgY29uc3QgaXNOb25EZXRlcm1pbmlzdGljV3JpdGVDb25jZXJuRXJyb3IgPSBlcnIgaW5zdGFuY2VvZiBlcnJvcl8xLk1vbmdvU2VydmVyRXJyb3IgJiZcbiAgICAgICAgZXJyLmNvZGVOYW1lICYmXG4gICAgICAgIE5PTl9ERVRFUk1JTklTVElDX1dSSVRFX0NPTkNFUk5fRVJST1JTLmhhcyhlcnIuY29kZU5hbWUpO1xuICAgIHJldHVybiAoaXNNYXhUaW1lTVNFeHBpcmVkRXJyb3IoZXJyKSB8fFxuICAgICAgICAoIWlzTm9uRGV0ZXJtaW5pc3RpY1dyaXRlQ29uY2VybkVycm9yICYmXG4gICAgICAgICAgICBlcnIuY29kZSAhPT0gZXJyb3JfMS5NT05HT0RCX0VSUk9SX0NPREVTLlVuc2F0aXNmaWFibGVXcml0ZUNvbmNlcm4gJiZcbiAgICAgICAgICAgIGVyci5jb2RlICE9PSBlcnJvcl8xLk1PTkdPREJfRVJST1JfQ09ERVMuVW5rbm93blJlcGxXcml0ZUNvbmNlcm4pKTtcbn1cbmZ1bmN0aW9uIG1heWJlQ2xlYXJQaW5uZWRDb25uZWN0aW9uKHNlc3Npb24sIG9wdGlvbnMpIHtcbiAgICAvLyB1bnBpbiBhIGNvbm5lY3Rpb24gaWYgaXQgaGFzIGJlZW4gcGlubmVkXG4gICAgY29uc3QgY29ubiA9IHNlc3Npb25ba1Bpbm5lZENvbm5lY3Rpb25dO1xuICAgIGNvbnN0IGVycm9yID0gb3B0aW9ucz8uZXJyb3I7XG4gICAgaWYgKHNlc3Npb24uaW5UcmFuc2FjdGlvbigpICYmXG4gICAgICAgIGVycm9yICYmXG4gICAgICAgIGVycm9yIGluc3RhbmNlb2YgZXJyb3JfMS5Nb25nb0Vycm9yICYmXG4gICAgICAgIGVycm9yLmhhc0Vycm9yTGFiZWwoZXJyb3JfMS5Nb25nb0Vycm9yTGFiZWwuVHJhbnNpZW50VHJhbnNhY3Rpb25FcnJvcikpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCB0b3BvbG9neSA9IHNlc3Npb24uY2xpZW50LnRvcG9sb2d5O1xuICAgIC8vIE5PVEU6IHRoZSBzcGVjIHRhbGtzIGFib3V0IHdoYXQgdG8gZG8gb24gYSBuZXR3b3JrIGVycm9yIG9ubHksIGJ1dCB0aGUgdGVzdHMgc2VlbSB0b1xuICAgIC8vICAgICAgIHRvIHZhbGlkYXRlIHRoYXQgd2UgZG9uJ3QgdW5waW4gb24gX2FsbF8gZXJyb3JzP1xuICAgIGlmIChjb25uICYmIHRvcG9sb2d5ICE9IG51bGwpIHtcbiAgICAgICAgY29uc3Qgc2VydmVycyA9IEFycmF5LmZyb20odG9wb2xvZ3kucy5zZXJ2ZXJzLnZhbHVlcygpKTtcbiAgICAgICAgY29uc3QgbG9hZEJhbGFuY2VyID0gc2VydmVyc1swXTtcbiAgICAgICAgaWYgKG9wdGlvbnM/LmVycm9yID09IG51bGwgfHwgb3B0aW9ucz8uZm9yY2UpIHtcbiAgICAgICAgICAgIGxvYWRCYWxhbmNlci5wb29sLmNoZWNrSW4oY29ubik7XG4gICAgICAgICAgICBjb25uLmVtaXQoY29uc3RhbnRzXzEuVU5QSU5ORUQsIHNlc3Npb24udHJhbnNhY3Rpb24uc3RhdGUgIT09IHRyYW5zYWN0aW9uc18xLlR4blN0YXRlLk5PX1RSQU5TQUNUSU9OXG4gICAgICAgICAgICAgICAgPyBtZXRyaWNzXzEuQ29ubmVjdGlvblBvb2xNZXRyaWNzLlRYTlxuICAgICAgICAgICAgICAgIDogbWV0cmljc18xLkNvbm5lY3Rpb25Qb29sTWV0cmljcy5DVVJTT1IpO1xuICAgICAgICAgICAgaWYgKG9wdGlvbnM/LmZvcmNlQ2xlYXIpIHtcbiAgICAgICAgICAgICAgICBsb2FkQmFsYW5jZXIucG9vbC5jbGVhcih7IHNlcnZpY2VJZDogY29ubi5zZXJ2aWNlSWQgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgc2Vzc2lvbltrUGlubmVkQ29ubmVjdGlvbl0gPSB1bmRlZmluZWQ7XG4gICAgfVxufVxuZXhwb3J0cy5tYXliZUNsZWFyUGlubmVkQ29ubmVjdGlvbiA9IG1heWJlQ2xlYXJQaW5uZWRDb25uZWN0aW9uO1xuZnVuY3Rpb24gaXNNYXhUaW1lTVNFeHBpcmVkRXJyb3IoZXJyKSB7XG4gICAgaWYgKGVyciA9PSBudWxsIHx8ICEoZXJyIGluc3RhbmNlb2YgZXJyb3JfMS5Nb25nb1NlcnZlckVycm9yKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiAoZXJyLmNvZGUgPT09IGVycm9yXzEuTU9OR09EQl9FUlJPUl9DT0RFUy5NYXhUaW1lTVNFeHBpcmVkIHx8XG4gICAgICAgIChlcnIud3JpdGVDb25jZXJuRXJyb3IgJiYgZXJyLndyaXRlQ29uY2VybkVycm9yLmNvZGUgPT09IGVycm9yXzEuTU9OR09EQl9FUlJPUl9DT0RFUy5NYXhUaW1lTVNFeHBpcmVkKSk7XG59XG5mdW5jdGlvbiBhdHRlbXB0VHJhbnNhY3Rpb25Db21taXQoc2Vzc2lvbiwgc3RhcnRUaW1lLCBmbiwgb3B0aW9ucykge1xuICAgIHJldHVybiBzZXNzaW9uLmNvbW1pdFRyYW5zYWN0aW9uKCkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICBpZiAoZXJyIGluc3RhbmNlb2YgZXJyb3JfMS5Nb25nb0Vycm9yICYmXG4gICAgICAgICAgICBoYXNOb3RUaW1lZE91dChzdGFydFRpbWUsIE1BWF9XSVRIX1RSQU5TQUNUSU9OX1RJTUVPVVQpICYmXG4gICAgICAgICAgICAhaXNNYXhUaW1lTVNFeHBpcmVkRXJyb3IoZXJyKSkge1xuICAgICAgICAgICAgaWYgKGVyci5oYXNFcnJvckxhYmVsKGVycm9yXzEuTW9uZ29FcnJvckxhYmVsLlVua25vd25UcmFuc2FjdGlvbkNvbW1pdFJlc3VsdCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYXR0ZW1wdFRyYW5zYWN0aW9uQ29tbWl0KHNlc3Npb24sIHN0YXJ0VGltZSwgZm4sIG9wdGlvbnMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGVyci5oYXNFcnJvckxhYmVsKGVycm9yXzEuTW9uZ29FcnJvckxhYmVsLlRyYW5zaWVudFRyYW5zYWN0aW9uRXJyb3IpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGF0dGVtcHRUcmFuc2FjdGlvbihzZXNzaW9uLCBzdGFydFRpbWUsIGZuLCBvcHRpb25zKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aHJvdyBlcnI7XG4gICAgfSk7XG59XG5jb25zdCBVU0VSX0VYUExJQ0lUX1RYTl9FTkRfU1RBVEVTID0gbmV3IFNldChbXG4gICAgdHJhbnNhY3Rpb25zXzEuVHhuU3RhdGUuTk9fVFJBTlNBQ1RJT04sXG4gICAgdHJhbnNhY3Rpb25zXzEuVHhuU3RhdGUuVFJBTlNBQ1RJT05fQ09NTUlUVEVELFxuICAgIHRyYW5zYWN0aW9uc18xLlR4blN0YXRlLlRSQU5TQUNUSU9OX0FCT1JURURcbl0pO1xuZnVuY3Rpb24gdXNlckV4cGxpY2l0bHlFbmRlZFRyYW5zYWN0aW9uKHNlc3Npb24pIHtcbiAgICByZXR1cm4gVVNFUl9FWFBMSUNJVF9UWE5fRU5EX1NUQVRFUy5oYXMoc2Vzc2lvbi50cmFuc2FjdGlvbi5zdGF0ZSk7XG59XG5mdW5jdGlvbiBhdHRlbXB0VHJhbnNhY3Rpb24oc2Vzc2lvbiwgc3RhcnRUaW1lLCBmbiwgb3B0aW9ucykge1xuICAgIHNlc3Npb24uc3RhcnRUcmFuc2FjdGlvbihvcHRpb25zKTtcbiAgICBsZXQgcHJvbWlzZTtcbiAgICB0cnkge1xuICAgICAgICBwcm9taXNlID0gZm4oc2Vzc2lvbik7XG4gICAgfVxuICAgIGNhdGNoIChlcnIpIHtcbiAgICAgICAgcHJvbWlzZSA9IFByb21pc2UucmVqZWN0KGVycik7XG4gICAgfVxuICAgIGlmICghKDAsIHV0aWxzXzEuaXNQcm9taXNlTGlrZSkocHJvbWlzZSkpIHtcbiAgICAgICAgc2Vzc2lvbi5hYm9ydFRyYW5zYWN0aW9uKCkuY2F0Y2goKCkgPT4gbnVsbCk7XG4gICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoJ0Z1bmN0aW9uIHByb3ZpZGVkIHRvIGB3aXRoVHJhbnNhY3Rpb25gIG11c3QgcmV0dXJuIGEgUHJvbWlzZScpO1xuICAgIH1cbiAgICByZXR1cm4gcHJvbWlzZS50aGVuKCgpID0+IHtcbiAgICAgICAgaWYgKHVzZXJFeHBsaWNpdGx5RW5kZWRUcmFuc2FjdGlvbihzZXNzaW9uKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhdHRlbXB0VHJhbnNhY3Rpb25Db21taXQoc2Vzc2lvbiwgc3RhcnRUaW1lLCBmbiwgb3B0aW9ucyk7XG4gICAgfSwgZXJyID0+IHtcbiAgICAgICAgZnVuY3Rpb24gbWF5YmVSZXRyeU9yVGhyb3coZXJyKSB7XG4gICAgICAgICAgICBpZiAoZXJyIGluc3RhbmNlb2YgZXJyb3JfMS5Nb25nb0Vycm9yICYmXG4gICAgICAgICAgICAgICAgZXJyLmhhc0Vycm9yTGFiZWwoZXJyb3JfMS5Nb25nb0Vycm9yTGFiZWwuVHJhbnNpZW50VHJhbnNhY3Rpb25FcnJvcikgJiZcbiAgICAgICAgICAgICAgICBoYXNOb3RUaW1lZE91dChzdGFydFRpbWUsIE1BWF9XSVRIX1RSQU5TQUNUSU9OX1RJTUVPVVQpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGF0dGVtcHRUcmFuc2FjdGlvbihzZXNzaW9uLCBzdGFydFRpbWUsIGZuLCBvcHRpb25zKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChpc01heFRpbWVNU0V4cGlyZWRFcnJvcihlcnIpKSB7XG4gICAgICAgICAgICAgICAgZXJyLmFkZEVycm9yTGFiZWwoZXJyb3JfMS5Nb25nb0Vycm9yTGFiZWwuVW5rbm93blRyYW5zYWN0aW9uQ29tbWl0UmVzdWx0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRocm93IGVycjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc2Vzc2lvbi5pblRyYW5zYWN0aW9uKCkpIHtcbiAgICAgICAgICAgIHJldHVybiBzZXNzaW9uLmFib3J0VHJhbnNhY3Rpb24oKS50aGVuKCgpID0+IG1heWJlUmV0cnlPclRocm93KGVycikpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBtYXliZVJldHJ5T3JUaHJvdyhlcnIpO1xuICAgIH0pO1xufVxuY29uc3QgZW5kVHJhbnNhY3Rpb25Bc3luYyA9ICgwLCB1dGlsXzEucHJvbWlzaWZ5KShlbmRUcmFuc2FjdGlvbik7XG5mdW5jdGlvbiBlbmRUcmFuc2FjdGlvbihzZXNzaW9uLCBjb21tYW5kTmFtZSwgY2FsbGJhY2spIHtcbiAgICAvLyBoYW5kbGUgYW55IGluaXRpYWwgcHJvYmxlbWF0aWMgY2FzZXNcbiAgICBjb25zdCB0eG5TdGF0ZSA9IHNlc3Npb24udHJhbnNhY3Rpb24uc3RhdGU7XG4gICAgaWYgKHR4blN0YXRlID09PSB0cmFuc2FjdGlvbnNfMS5UeG5TdGF0ZS5OT19UUkFOU0FDVElPTikge1xuICAgICAgICBjYWxsYmFjayhuZXcgZXJyb3JfMS5Nb25nb1RyYW5zYWN0aW9uRXJyb3IoJ05vIHRyYW5zYWN0aW9uIHN0YXJ0ZWQnKSk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGNvbW1hbmROYW1lID09PSAnY29tbWl0VHJhbnNhY3Rpb24nKSB7XG4gICAgICAgIGlmICh0eG5TdGF0ZSA9PT0gdHJhbnNhY3Rpb25zXzEuVHhuU3RhdGUuU1RBUlRJTkdfVFJBTlNBQ1RJT04gfHxcbiAgICAgICAgICAgIHR4blN0YXRlID09PSB0cmFuc2FjdGlvbnNfMS5UeG5TdGF0ZS5UUkFOU0FDVElPTl9DT01NSVRURURfRU1QVFkpIHtcbiAgICAgICAgICAgIC8vIHRoZSB0cmFuc2FjdGlvbiB3YXMgbmV2ZXIgc3RhcnRlZCwgd2UgY2FuIHNhZmVseSBleGl0IGhlcmVcbiAgICAgICAgICAgIHNlc3Npb24udHJhbnNhY3Rpb24udHJhbnNpdGlvbih0cmFuc2FjdGlvbnNfMS5UeG5TdGF0ZS5UUkFOU0FDVElPTl9DT01NSVRURURfRU1QVFkpO1xuICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodHhuU3RhdGUgPT09IHRyYW5zYWN0aW9uc18xLlR4blN0YXRlLlRSQU5TQUNUSU9OX0FCT1JURUQpIHtcbiAgICAgICAgICAgIGNhbGxiYWNrKG5ldyBlcnJvcl8xLk1vbmdvVHJhbnNhY3Rpb25FcnJvcignQ2Fubm90IGNhbGwgY29tbWl0VHJhbnNhY3Rpb24gYWZ0ZXIgY2FsbGluZyBhYm9ydFRyYW5zYWN0aW9uJykpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBpZiAodHhuU3RhdGUgPT09IHRyYW5zYWN0aW9uc18xLlR4blN0YXRlLlNUQVJUSU5HX1RSQU5TQUNUSU9OKSB7XG4gICAgICAgICAgICAvLyB0aGUgdHJhbnNhY3Rpb24gd2FzIG5ldmVyIHN0YXJ0ZWQsIHdlIGNhbiBzYWZlbHkgZXhpdCBoZXJlXG4gICAgICAgICAgICBzZXNzaW9uLnRyYW5zYWN0aW9uLnRyYW5zaXRpb24odHJhbnNhY3Rpb25zXzEuVHhuU3RhdGUuVFJBTlNBQ1RJT05fQUJPUlRFRCk7XG4gICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eG5TdGF0ZSA9PT0gdHJhbnNhY3Rpb25zXzEuVHhuU3RhdGUuVFJBTlNBQ1RJT05fQUJPUlRFRCkge1xuICAgICAgICAgICAgY2FsbGJhY2sobmV3IGVycm9yXzEuTW9uZ29UcmFuc2FjdGlvbkVycm9yKCdDYW5ub3QgY2FsbCBhYm9ydFRyYW5zYWN0aW9uIHR3aWNlJykpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eG5TdGF0ZSA9PT0gdHJhbnNhY3Rpb25zXzEuVHhuU3RhdGUuVFJBTlNBQ1RJT05fQ09NTUlUVEVEIHx8XG4gICAgICAgICAgICB0eG5TdGF0ZSA9PT0gdHJhbnNhY3Rpb25zXzEuVHhuU3RhdGUuVFJBTlNBQ1RJT05fQ09NTUlUVEVEX0VNUFRZKSB7XG4gICAgICAgICAgICBjYWxsYmFjayhuZXcgZXJyb3JfMS5Nb25nb1RyYW5zYWN0aW9uRXJyb3IoJ0Nhbm5vdCBjYWxsIGFib3J0VHJhbnNhY3Rpb24gYWZ0ZXIgY2FsbGluZyBjb21taXRUcmFuc2FjdGlvbicpKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvLyBjb25zdHJ1Y3QgYW5kIHNlbmQgdGhlIGNvbW1hbmRcbiAgICBjb25zdCBjb21tYW5kID0geyBbY29tbWFuZE5hbWVdOiAxIH07XG4gICAgLy8gYXBwbHkgYSB3cml0ZUNvbmNlcm4gaWYgc3BlY2lmaWVkXG4gICAgbGV0IHdyaXRlQ29uY2VybjtcbiAgICBpZiAoc2Vzc2lvbi50cmFuc2FjdGlvbi5vcHRpb25zLndyaXRlQ29uY2Vybikge1xuICAgICAgICB3cml0ZUNvbmNlcm4gPSBPYmplY3QuYXNzaWduKHt9LCBzZXNzaW9uLnRyYW5zYWN0aW9uLm9wdGlvbnMud3JpdGVDb25jZXJuKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoc2Vzc2lvbi5jbGllbnRPcHRpb25zICYmIHNlc3Npb24uY2xpZW50T3B0aW9ucy53cml0ZUNvbmNlcm4pIHtcbiAgICAgICAgd3JpdGVDb25jZXJuID0geyB3OiBzZXNzaW9uLmNsaWVudE9wdGlvbnMud3JpdGVDb25jZXJuLncgfTtcbiAgICB9XG4gICAgaWYgKHR4blN0YXRlID09PSB0cmFuc2FjdGlvbnNfMS5UeG5TdGF0ZS5UUkFOU0FDVElPTl9DT01NSVRURUQpIHtcbiAgICAgICAgd3JpdGVDb25jZXJuID0gT2JqZWN0LmFzc2lnbih7IHd0aW1lb3V0TVM6IDEwMDAwIH0sIHdyaXRlQ29uY2VybiwgeyB3OiAnbWFqb3JpdHknIH0pO1xuICAgIH1cbiAgICBpZiAod3JpdGVDb25jZXJuKSB7XG4gICAgICAgIHdyaXRlX2NvbmNlcm5fMS5Xcml0ZUNvbmNlcm4uYXBwbHkoY29tbWFuZCwgd3JpdGVDb25jZXJuKTtcbiAgICB9XG4gICAgaWYgKGNvbW1hbmROYW1lID09PSAnY29tbWl0VHJhbnNhY3Rpb24nICYmIHNlc3Npb24udHJhbnNhY3Rpb24ub3B0aW9ucy5tYXhUaW1lTVMpIHtcbiAgICAgICAgT2JqZWN0LmFzc2lnbihjb21tYW5kLCB7IG1heFRpbWVNUzogc2Vzc2lvbi50cmFuc2FjdGlvbi5vcHRpb25zLm1heFRpbWVNUyB9KTtcbiAgICB9XG4gICAgZnVuY3Rpb24gY29tbWFuZEhhbmRsZXIoZXJyb3IsIHJlc3VsdCkge1xuICAgICAgICBpZiAoY29tbWFuZE5hbWUgIT09ICdjb21taXRUcmFuc2FjdGlvbicpIHtcbiAgICAgICAgICAgIHNlc3Npb24udHJhbnNhY3Rpb24udHJhbnNpdGlvbih0cmFuc2FjdGlvbnNfMS5UeG5TdGF0ZS5UUkFOU0FDVElPTl9BQk9SVEVEKTtcbiAgICAgICAgICAgIGlmIChzZXNzaW9uLmxvYWRCYWxhbmNlZCkge1xuICAgICAgICAgICAgICAgIG1heWJlQ2xlYXJQaW5uZWRDb25uZWN0aW9uKHNlc3Npb24sIHsgZm9yY2U6IGZhbHNlIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gVGhlIHNwZWMgaW5kaWNhdGVzIHRoYXQgd2Ugc2hvdWxkIGlnbm9yZSBhbGwgZXJyb3JzIG9uIGBhYm9ydFRyYW5zYWN0aW9uYFxuICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKCk7XG4gICAgICAgIH1cbiAgICAgICAgc2Vzc2lvbi50cmFuc2FjdGlvbi50cmFuc2l0aW9uKHRyYW5zYWN0aW9uc18xLlR4blN0YXRlLlRSQU5TQUNUSU9OX0NPTU1JVFRFRCk7XG4gICAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIGVycm9yXzEuTW9uZ29FcnJvcikge1xuICAgICAgICAgICAgaWYgKGVycm9yLmhhc0Vycm9yTGFiZWwoZXJyb3JfMS5Nb25nb0Vycm9yTGFiZWwuUmV0cnlhYmxlV3JpdGVFcnJvcikgfHxcbiAgICAgICAgICAgICAgICBlcnJvciBpbnN0YW5jZW9mIGVycm9yXzEuTW9uZ29Xcml0ZUNvbmNlcm5FcnJvciB8fFxuICAgICAgICAgICAgICAgIGlzTWF4VGltZU1TRXhwaXJlZEVycm9yKGVycm9yKSkge1xuICAgICAgICAgICAgICAgIGlmIChpc1Vua25vd25UcmFuc2FjdGlvbkNvbW1pdFJlc3VsdChlcnJvcikpIHtcbiAgICAgICAgICAgICAgICAgICAgZXJyb3IuYWRkRXJyb3JMYWJlbChlcnJvcl8xLk1vbmdvRXJyb3JMYWJlbC5Vbmtub3duVHJhbnNhY3Rpb25Db21taXRSZXN1bHQpO1xuICAgICAgICAgICAgICAgICAgICAvLyBwZXIgdHhucyBzcGVjLCBtdXN0IHVucGluIHNlc3Npb24gaW4gdGhpcyBjYXNlXG4gICAgICAgICAgICAgICAgICAgIHNlc3Npb24udW5waW4oeyBlcnJvciB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChlcnJvci5oYXNFcnJvckxhYmVsKGVycm9yXzEuTW9uZ29FcnJvckxhYmVsLlRyYW5zaWVudFRyYW5zYWN0aW9uRXJyb3IpKSB7XG4gICAgICAgICAgICAgICAgc2Vzc2lvbi51bnBpbih7IGVycm9yIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCByZXN1bHQpO1xuICAgIH1cbiAgICBpZiAoc2Vzc2lvbi50cmFuc2FjdGlvbi5yZWNvdmVyeVRva2VuKSB7XG4gICAgICAgIGNvbW1hbmQucmVjb3ZlcnlUb2tlbiA9IHNlc3Npb24udHJhbnNhY3Rpb24ucmVjb3ZlcnlUb2tlbjtcbiAgICB9XG4gICAgLy8gc2VuZCB0aGUgY29tbWFuZFxuICAgICgwLCBleGVjdXRlX29wZXJhdGlvbl8xLmV4ZWN1dGVPcGVyYXRpb24pKHNlc3Npb24uY2xpZW50LCBuZXcgcnVuX2NvbW1hbmRfMS5SdW5BZG1pbkNvbW1hbmRPcGVyYXRpb24odW5kZWZpbmVkLCBjb21tYW5kLCB7XG4gICAgICAgIHNlc3Npb24sXG4gICAgICAgIHJlYWRQcmVmZXJlbmNlOiByZWFkX3ByZWZlcmVuY2VfMS5SZWFkUHJlZmVyZW5jZS5wcmltYXJ5LFxuICAgICAgICBieXBhc3NQaW5uaW5nQ2hlY2s6IHRydWVcbiAgICB9KSwgKGVycm9yLCByZXN1bHQpID0+IHtcbiAgICAgICAgaWYgKGNvbW1hbmQuYWJvcnRUcmFuc2FjdGlvbikge1xuICAgICAgICAgICAgLy8gYWx3YXlzIHVucGluIG9uIGFib3J0IHJlZ2FyZGxlc3Mgb2YgY29tbWFuZCBvdXRjb21lXG4gICAgICAgICAgICBzZXNzaW9uLnVucGluKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgZXJyb3JfMS5Nb25nb0Vycm9yICYmIGVycm9yLmhhc0Vycm9yTGFiZWwoZXJyb3JfMS5Nb25nb0Vycm9yTGFiZWwuUmV0cnlhYmxlV3JpdGVFcnJvcikpIHtcbiAgICAgICAgICAgIC8vIFNQRUMtMTE4NTogYXBwbHkgbWFqb3JpdHkgd3JpdGUgY29uY2VybiB3aGVuIHJldHJ5aW5nIGNvbW1pdFRyYW5zYWN0aW9uXG4gICAgICAgICAgICBpZiAoY29tbWFuZC5jb21taXRUcmFuc2FjdGlvbikge1xuICAgICAgICAgICAgICAgIC8vIHBlciB0eG5zIHNwZWMsIG11c3QgdW5waW4gc2Vzc2lvbiBpbiB0aGlzIGNhc2VcbiAgICAgICAgICAgICAgICBzZXNzaW9uLnVucGluKHsgZm9yY2U6IHRydWUgfSk7XG4gICAgICAgICAgICAgICAgY29tbWFuZC53cml0ZUNvbmNlcm4gPSBPYmplY3QuYXNzaWduKHsgd3RpbWVvdXQ6IDEwMDAwIH0sIGNvbW1hbmQud3JpdGVDb25jZXJuLCB7XG4gICAgICAgICAgICAgICAgICAgIHc6ICdtYWpvcml0eSdcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiAoMCwgZXhlY3V0ZV9vcGVyYXRpb25fMS5leGVjdXRlT3BlcmF0aW9uKShzZXNzaW9uLmNsaWVudCwgbmV3IHJ1bl9jb21tYW5kXzEuUnVuQWRtaW5Db21tYW5kT3BlcmF0aW9uKHVuZGVmaW5lZCwgY29tbWFuZCwge1xuICAgICAgICAgICAgICAgIHNlc3Npb24sXG4gICAgICAgICAgICAgICAgcmVhZFByZWZlcmVuY2U6IHJlYWRfcHJlZmVyZW5jZV8xLlJlYWRQcmVmZXJlbmNlLnByaW1hcnksXG4gICAgICAgICAgICAgICAgYnlwYXNzUGlubmluZ0NoZWNrOiB0cnVlXG4gICAgICAgICAgICB9KSwgY29tbWFuZEhhbmRsZXIpO1xuICAgICAgICB9XG4gICAgICAgIGNvbW1hbmRIYW5kbGVyKGVycm9yLCByZXN1bHQpO1xuICAgIH0pO1xufVxuLyoqXG4gKiBSZWZsZWN0cyB0aGUgZXhpc3RlbmNlIG9mIGEgc2Vzc2lvbiBvbiB0aGUgc2VydmVyLiBDYW4gYmUgcmV1c2VkIGJ5IHRoZSBzZXNzaW9uIHBvb2wuXG4gKiBXQVJOSU5HOiBub3QgbWVhbnQgdG8gYmUgaW5zdGFudGlhdGVkIGRpcmVjdGx5LiBGb3IgaW50ZXJuYWwgdXNlIG9ubHkuXG4gKiBAcHVibGljXG4gKi9cbmNsYXNzIFNlcnZlclNlc3Npb24ge1xuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5pZCA9IHsgaWQ6IG5ldyBic29uXzEuQmluYXJ5KCgwLCB1dGlsc18xLnV1aWRWNCkoKSwgYnNvbl8xLkJpbmFyeS5TVUJUWVBFX1VVSUQpIH07XG4gICAgICAgIHRoaXMubGFzdFVzZSA9ICgwLCB1dGlsc18xLm5vdykoKTtcbiAgICAgICAgdGhpcy50eG5OdW1iZXIgPSAwO1xuICAgICAgICB0aGlzLmlzRGlydHkgPSBmYWxzZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRGV0ZXJtaW5lcyBpZiB0aGUgc2VydmVyIHNlc3Npb24gaGFzIHRpbWVkIG91dC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBzZXNzaW9uVGltZW91dE1pbnV0ZXMgLSBUaGUgc2VydmVyJ3MgXCJsb2dpY2FsU2Vzc2lvblRpbWVvdXRNaW51dGVzXCJcbiAgICAgKi9cbiAgICBoYXNUaW1lZE91dChzZXNzaW9uVGltZW91dE1pbnV0ZXMpIHtcbiAgICAgICAgLy8gVGFrZSB0aGUgZGlmZmVyZW5jZSBvZiB0aGUgbGFzdFVzZSB0aW1lc3RhbXAgYW5kIG5vdywgd2hpY2ggd2lsbCByZXN1bHQgaW4gYSB2YWx1ZSBpblxuICAgICAgICAvLyBtaWxsaXNlY29uZHMsIGFuZCB0aGVuIGNvbnZlcnQgbWlsbGlzZWNvbmRzIHRvIG1pbnV0ZXMgdG8gY29tcGFyZSB0byBgc2Vzc2lvblRpbWVvdXRNaW51dGVzYFxuICAgICAgICBjb25zdCBpZGxlVGltZU1pbnV0ZXMgPSBNYXRoLnJvdW5kKCgoKDAsIHV0aWxzXzEuY2FsY3VsYXRlRHVyYXRpb25Jbk1zKSh0aGlzLmxhc3RVc2UpICUgODY0MDAwMDApICUgMzYwMDAwMCkgLyA2MDAwMCk7XG4gICAgICAgIHJldHVybiBpZGxlVGltZU1pbnV0ZXMgPiBzZXNzaW9uVGltZW91dE1pbnV0ZXMgLSAxO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAaW50ZXJuYWxcbiAgICAgKiBDbG9uaW5nIG1lYW50IHRvIGtlZXAgYSByZWFkYWJsZSByZWZlcmVuY2UgdG8gdGhlIHNlcnZlciBzZXNzaW9uIGRhdGFcbiAgICAgKiBhZnRlciBDbGllbnRTZXNzaW9uIGhhcyBlbmRlZFxuICAgICAqL1xuICAgIHN0YXRpYyBjbG9uZShzZXJ2ZXJTZXNzaW9uKSB7XG4gICAgICAgIGNvbnN0IGFycmF5QnVmZmVyID0gbmV3IEFycmF5QnVmZmVyKDE2KTtcbiAgICAgICAgY29uc3QgaWRCeXRlcyA9IEJ1ZmZlci5mcm9tKGFycmF5QnVmZmVyKTtcbiAgICAgICAgaWRCeXRlcy5zZXQoc2VydmVyU2Vzc2lvbi5pZC5pZC5idWZmZXIpO1xuICAgICAgICBjb25zdCBpZCA9IG5ldyBic29uXzEuQmluYXJ5KGlkQnl0ZXMsIHNlcnZlclNlc3Npb24uaWQuaWQuc3ViX3R5cGUpO1xuICAgICAgICAvLyBNYW51YWwgcHJvdG90eXBlIGNvbnN0cnVjdGlvbiB0byBhdm9pZCBtb2RpZnlpbmcgdGhlIGNvbnN0cnVjdG9yIG9mIHRoaXMgY2xhc3NcbiAgICAgICAgcmV0dXJuIE9iamVjdC5zZXRQcm90b3R5cGVPZih7XG4gICAgICAgICAgICBpZDogeyBpZCB9LFxuICAgICAgICAgICAgbGFzdFVzZTogc2VydmVyU2Vzc2lvbi5sYXN0VXNlLFxuICAgICAgICAgICAgdHhuTnVtYmVyOiBzZXJ2ZXJTZXNzaW9uLnR4bk51bWJlcixcbiAgICAgICAgICAgIGlzRGlydHk6IHNlcnZlclNlc3Npb24uaXNEaXJ0eVxuICAgICAgICB9LCBTZXJ2ZXJTZXNzaW9uLnByb3RvdHlwZSk7XG4gICAgfVxufVxuZXhwb3J0cy5TZXJ2ZXJTZXNzaW9uID0gU2VydmVyU2Vzc2lvbjtcbi8qKlxuICogTWFpbnRhaW5zIGEgcG9vbCBvZiBTZXJ2ZXIgU2Vzc2lvbnMuXG4gKiBGb3IgaW50ZXJuYWwgdXNlIG9ubHlcbiAqIEBpbnRlcm5hbFxuICovXG5jbGFzcyBTZXJ2ZXJTZXNzaW9uUG9vbCB7XG4gICAgY29uc3RydWN0b3IoY2xpZW50KSB7XG4gICAgICAgIGlmIChjbGllbnQgPT0gbnVsbCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29SdW50aW1lRXJyb3IoJ1NlcnZlclNlc3Npb25Qb29sIHJlcXVpcmVzIGEgTW9uZ29DbGllbnQnKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNsaWVudCA9IGNsaWVudDtcbiAgICAgICAgdGhpcy5zZXNzaW9ucyA9IG5ldyB1dGlsc18xLkxpc3QoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQWNxdWlyZSBhIFNlcnZlciBTZXNzaW9uIGZyb20gdGhlIHBvb2wuXG4gICAgICogSXRlcmF0ZXMgdGhyb3VnaCBlYWNoIHNlc3Npb24gaW4gdGhlIHBvb2wsIHJlbW92aW5nIGFueSBzdGFsZSBzZXNzaW9uc1xuICAgICAqIGFsb25nIHRoZSB3YXkuIFRoZSBmaXJzdCBub24tc3RhbGUgc2Vzc2lvbiBmb3VuZCBpcyByZW1vdmVkIGZyb20gdGhlXG4gICAgICogcG9vbCBhbmQgcmV0dXJuZWQuIElmIG5vIG5vbi1zdGFsZSBzZXNzaW9uIGlzIGZvdW5kLCBhIG5ldyBTZXJ2ZXJTZXNzaW9uIGlzIGNyZWF0ZWQuXG4gICAgICovXG4gICAgYWNxdWlyZSgpIHtcbiAgICAgICAgY29uc3Qgc2Vzc2lvblRpbWVvdXRNaW51dGVzID0gdGhpcy5jbGllbnQudG9wb2xvZ3k/LmxvZ2ljYWxTZXNzaW9uVGltZW91dE1pbnV0ZXMgPz8gMTA7XG4gICAgICAgIGxldCBzZXNzaW9uID0gbnVsbDtcbiAgICAgICAgLy8gVHJ5IHRvIG9idGFpbiBmcm9tIHNlc3Npb24gcG9vbFxuICAgICAgICB3aGlsZSAodGhpcy5zZXNzaW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBjb25zdCBwb3RlbnRpYWxTZXNzaW9uID0gdGhpcy5zZXNzaW9ucy5zaGlmdCgpO1xuICAgICAgICAgICAgaWYgKHBvdGVudGlhbFNlc3Npb24gIT0gbnVsbCAmJlxuICAgICAgICAgICAgICAgICghIXRoaXMuY2xpZW50LnRvcG9sb2d5Py5sb2FkQmFsYW5jZWQgfHxcbiAgICAgICAgICAgICAgICAgICAgIXBvdGVudGlhbFNlc3Npb24uaGFzVGltZWRPdXQoc2Vzc2lvblRpbWVvdXRNaW51dGVzKSkpIHtcbiAgICAgICAgICAgICAgICBzZXNzaW9uID0gcG90ZW50aWFsU2Vzc2lvbjtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyBJZiBub3RoaW5nIHZhbGlkIGNhbWUgZnJvbSB0aGUgcG9vbCBtYWtlIGEgbmV3IG9uZVxuICAgICAgICBpZiAoc2Vzc2lvbiA9PSBudWxsKSB7XG4gICAgICAgICAgICBzZXNzaW9uID0gbmV3IFNlcnZlclNlc3Npb24oKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc2Vzc2lvbjtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVsZWFzZSBhIHNlc3Npb24gdG8gdGhlIHNlc3Npb24gcG9vbFxuICAgICAqIEFkZHMgdGhlIHNlc3Npb24gYmFjayB0byB0aGUgc2Vzc2lvbiBwb29sIGlmIHRoZSBzZXNzaW9uIGhhcyBub3QgdGltZWQgb3V0IHlldC5cbiAgICAgKiBUaGlzIG1ldGhvZCBhbHNvIHJlbW92ZXMgYW55IHN0YWxlIHNlc3Npb25zIGZyb20gdGhlIHBvb2wuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gc2Vzc2lvbiAtIFRoZSBzZXNzaW9uIHRvIHJlbGVhc2UgdG8gdGhlIHBvb2xcbiAgICAgKi9cbiAgICByZWxlYXNlKHNlc3Npb24pIHtcbiAgICAgICAgY29uc3Qgc2Vzc2lvblRpbWVvdXRNaW51dGVzID0gdGhpcy5jbGllbnQudG9wb2xvZ3k/LmxvZ2ljYWxTZXNzaW9uVGltZW91dE1pbnV0ZXMgPz8gMTA7XG4gICAgICAgIGlmICh0aGlzLmNsaWVudC50b3BvbG9neT8ubG9hZEJhbGFuY2VkICYmICFzZXNzaW9uVGltZW91dE1pbnV0ZXMpIHtcbiAgICAgICAgICAgIHRoaXMuc2Vzc2lvbnMudW5zaGlmdChzZXNzaW9uKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXNlc3Npb25UaW1lb3V0TWludXRlcykge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2Vzc2lvbnMucHJ1bmUoc2Vzc2lvbiA9PiBzZXNzaW9uLmhhc1RpbWVkT3V0KHNlc3Npb25UaW1lb3V0TWludXRlcykpO1xuICAgICAgICBpZiAoIXNlc3Npb24uaGFzVGltZWRPdXQoc2Vzc2lvblRpbWVvdXRNaW51dGVzKSkge1xuICAgICAgICAgICAgaWYgKHNlc3Npb24uaXNEaXJ0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIG90aGVyd2lzZSwgcmVhZGQgdGhpcyBzZXNzaW9uIHRvIHRoZSBzZXNzaW9uIHBvb2xcbiAgICAgICAgICAgIHRoaXMuc2Vzc2lvbnMudW5zaGlmdChzZXNzaW9uKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbmV4cG9ydHMuU2VydmVyU2Vzc2lvblBvb2wgPSBTZXJ2ZXJTZXNzaW9uUG9vbDtcbi8qKlxuICogT3B0aW9uYWxseSBkZWNvcmF0ZSBhIGNvbW1hbmQgd2l0aCBzZXNzaW9ucyBzcGVjaWZpYyBrZXlzXG4gKlxuICogQHBhcmFtIHNlc3Npb24gLSB0aGUgc2Vzc2lvbiB0cmFja2luZyB0cmFuc2FjdGlvbiBzdGF0ZVxuICogQHBhcmFtIGNvbW1hbmQgLSB0aGUgY29tbWFuZCB0byBkZWNvcmF0ZVxuICogQHBhcmFtIG9wdGlvbnMgLSBPcHRpb25hbCBzZXR0aW5ncyBwYXNzZWQgdG8gY2FsbGluZyBvcGVyYXRpb25cbiAqXG4gKiBAaW50ZXJuYWxcbiAqL1xuZnVuY3Rpb24gYXBwbHlTZXNzaW9uKHNlc3Npb24sIGNvbW1hbmQsIG9wdGlvbnMpIHtcbiAgICBpZiAoc2Vzc2lvbi5oYXNFbmRlZCkge1xuICAgICAgICByZXR1cm4gbmV3IGVycm9yXzEuTW9uZ29FeHBpcmVkU2Vzc2lvbkVycm9yKCk7XG4gICAgfVxuICAgIC8vIE1heSBhY3F1aXJlIHNlcnZlclNlc3Npb24gaGVyZVxuICAgIGNvbnN0IHNlcnZlclNlc3Npb24gPSBzZXNzaW9uLnNlcnZlclNlc3Npb247XG4gICAgaWYgKHNlcnZlclNlc3Npb24gPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gbmV3IGVycm9yXzEuTW9uZ29SdW50aW1lRXJyb3IoJ1VuYWJsZSB0byBhY3F1aXJlIHNlcnZlciBzZXNzaW9uJyk7XG4gICAgfVxuICAgIGlmIChvcHRpb25zLndyaXRlQ29uY2Vybj8udyA9PT0gMCkge1xuICAgICAgICBpZiAoc2Vzc2lvbiAmJiBzZXNzaW9uLmV4cGxpY2l0KSB7XG4gICAgICAgICAgICAvLyBFcnJvciBpZiB1c2VyIHByb3ZpZGVkIGFuIGV4cGxpY2l0IHNlc3Npb24gdG8gYW4gdW5hY2tub3dsZWRnZWQgd3JpdGUgKFNQRUMtMTAxOSlcbiAgICAgICAgICAgIHJldHVybiBuZXcgZXJyb3JfMS5Nb25nb0FQSUVycm9yKCdDYW5ub3QgaGF2ZSBleHBsaWNpdCBzZXNzaW9uIHdpdGggdW5hY2tub3dsZWRnZWQgd3JpdGVzJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAvLyBtYXJrIHRoZSBsYXN0IHVzZSBvZiB0aGlzIHNlc3Npb24sIGFuZCBhcHBseSB0aGUgYGxzaWRgXG4gICAgc2VydmVyU2Vzc2lvbi5sYXN0VXNlID0gKDAsIHV0aWxzXzEubm93KSgpO1xuICAgIGNvbW1hbmQubHNpZCA9IHNlcnZlclNlc3Npb24uaWQ7XG4gICAgY29uc3QgaW5UeG5PclR4bkNvbW1hbmQgPSBzZXNzaW9uLmluVHJhbnNhY3Rpb24oKSB8fCAoMCwgdHJhbnNhY3Rpb25zXzEuaXNUcmFuc2FjdGlvbkNvbW1hbmQpKGNvbW1hbmQpO1xuICAgIGNvbnN0IGlzUmV0cnlhYmxlV3JpdGUgPSAhIW9wdGlvbnMud2lsbFJldHJ5V3JpdGU7XG4gICAgaWYgKGlzUmV0cnlhYmxlV3JpdGUgfHwgaW5UeG5PclR4bkNvbW1hbmQpIHtcbiAgICAgICAgc2VydmVyU2Vzc2lvbi50eG5OdW1iZXIgKz0gc2Vzc2lvbltrVHhuTnVtYmVySW5jcmVtZW50XTtcbiAgICAgICAgc2Vzc2lvbltrVHhuTnVtYmVySW5jcmVtZW50XSA9IDA7XG4gICAgICAgIC8vIFRPRE8oTk9ERS0yNjc0KTogUHJlc2VydmUgaW50NjQgc2VudCBmcm9tIE1vbmdvREJcbiAgICAgICAgY29tbWFuZC50eG5OdW1iZXIgPSBic29uXzEuTG9uZy5mcm9tTnVtYmVyKHNlcnZlclNlc3Npb24udHhuTnVtYmVyKTtcbiAgICB9XG4gICAgaWYgKCFpblR4bk9yVHhuQ29tbWFuZCkge1xuICAgICAgICBpZiAoc2Vzc2lvbi50cmFuc2FjdGlvbi5zdGF0ZSAhPT0gdHJhbnNhY3Rpb25zXzEuVHhuU3RhdGUuTk9fVFJBTlNBQ1RJT04pIHtcbiAgICAgICAgICAgIHNlc3Npb24udHJhbnNhY3Rpb24udHJhbnNpdGlvbih0cmFuc2FjdGlvbnNfMS5UeG5TdGF0ZS5OT19UUkFOU0FDVElPTik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNlc3Npb24uc3VwcG9ydHMuY2F1c2FsQ29uc2lzdGVuY3kgJiZcbiAgICAgICAgICAgIHNlc3Npb24ub3BlcmF0aW9uVGltZSAmJlxuICAgICAgICAgICAgKDAsIHV0aWxzXzEuY29tbWFuZFN1cHBvcnRzUmVhZENvbmNlcm4pKGNvbW1hbmQsIG9wdGlvbnMpKSB7XG4gICAgICAgICAgICBjb21tYW5kLnJlYWRDb25jZXJuID0gY29tbWFuZC5yZWFkQ29uY2VybiB8fCB7fTtcbiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oY29tbWFuZC5yZWFkQ29uY2VybiwgeyBhZnRlckNsdXN0ZXJUaW1lOiBzZXNzaW9uLm9wZXJhdGlvblRpbWUgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoc2Vzc2lvbltrU25hcHNob3RFbmFibGVkXSkge1xuICAgICAgICAgICAgY29tbWFuZC5yZWFkQ29uY2VybiA9IGNvbW1hbmQucmVhZENvbmNlcm4gfHwgeyBsZXZlbDogcmVhZF9jb25jZXJuXzEuUmVhZENvbmNlcm5MZXZlbC5zbmFwc2hvdCB9O1xuICAgICAgICAgICAgaWYgKHNlc3Npb25ba1NuYXBzaG90VGltZV0gIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oY29tbWFuZC5yZWFkQ29uY2VybiwgeyBhdENsdXN0ZXJUaW1lOiBzZXNzaW9uW2tTbmFwc2hvdFRpbWVdIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgLy8gbm93IGF0dGVtcHQgdG8gYXBwbHkgdHJhbnNhY3Rpb24tc3BlY2lmaWMgc2Vzc2lvbnMgZGF0YVxuICAgIC8vIGBhdXRvY29tbWl0YCBtdXN0IGFsd2F5cyBiZSBmYWxzZSB0byBkaWZmZXJlbnRpYXRlIGZyb20gcmV0cnlhYmxlIHdyaXRlc1xuICAgIGNvbW1hbmQuYXV0b2NvbW1pdCA9IGZhbHNlO1xuICAgIGlmIChzZXNzaW9uLnRyYW5zYWN0aW9uLnN0YXRlID09PSB0cmFuc2FjdGlvbnNfMS5UeG5TdGF0ZS5TVEFSVElOR19UUkFOU0FDVElPTikge1xuICAgICAgICBzZXNzaW9uLnRyYW5zYWN0aW9uLnRyYW5zaXRpb24odHJhbnNhY3Rpb25zXzEuVHhuU3RhdGUuVFJBTlNBQ1RJT05fSU5fUFJPR1JFU1MpO1xuICAgICAgICBjb21tYW5kLnN0YXJ0VHJhbnNhY3Rpb24gPSB0cnVlO1xuICAgICAgICBjb25zdCByZWFkQ29uY2VybiA9IHNlc3Npb24udHJhbnNhY3Rpb24ub3B0aW9ucy5yZWFkQ29uY2VybiB8fCBzZXNzaW9uPy5jbGllbnRPcHRpb25zPy5yZWFkQ29uY2VybjtcbiAgICAgICAgaWYgKHJlYWRDb25jZXJuKSB7XG4gICAgICAgICAgICBjb21tYW5kLnJlYWRDb25jZXJuID0gcmVhZENvbmNlcm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNlc3Npb24uc3VwcG9ydHMuY2F1c2FsQ29uc2lzdGVuY3kgJiYgc2Vzc2lvbi5vcGVyYXRpb25UaW1lKSB7XG4gICAgICAgICAgICBjb21tYW5kLnJlYWRDb25jZXJuID0gY29tbWFuZC5yZWFkQ29uY2VybiB8fCB7fTtcbiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oY29tbWFuZC5yZWFkQ29uY2VybiwgeyBhZnRlckNsdXN0ZXJUaW1lOiBzZXNzaW9uLm9wZXJhdGlvblRpbWUgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuO1xufVxuZXhwb3J0cy5hcHBseVNlc3Npb24gPSBhcHBseVNlc3Npb247XG5mdW5jdGlvbiB1cGRhdGVTZXNzaW9uRnJvbVJlc3BvbnNlKHNlc3Npb24sIGRvY3VtZW50KSB7XG4gICAgaWYgKGRvY3VtZW50LiRjbHVzdGVyVGltZSkge1xuICAgICAgICAoMCwgY29tbW9uXzEuX2FkdmFuY2VDbHVzdGVyVGltZSkoc2Vzc2lvbiwgZG9jdW1lbnQuJGNsdXN0ZXJUaW1lKTtcbiAgICB9XG4gICAgaWYgKGRvY3VtZW50Lm9wZXJhdGlvblRpbWUgJiYgc2Vzc2lvbiAmJiBzZXNzaW9uLnN1cHBvcnRzLmNhdXNhbENvbnNpc3RlbmN5KSB7XG4gICAgICAgIHNlc3Npb24uYWR2YW5jZU9wZXJhdGlvblRpbWUoZG9jdW1lbnQub3BlcmF0aW9uVGltZSk7XG4gICAgfVxuICAgIGlmIChkb2N1bWVudC5yZWNvdmVyeVRva2VuICYmIHNlc3Npb24gJiYgc2Vzc2lvbi5pblRyYW5zYWN0aW9uKCkpIHtcbiAgICAgICAgc2Vzc2lvbi50cmFuc2FjdGlvbi5fcmVjb3ZlcnlUb2tlbiA9IGRvY3VtZW50LnJlY292ZXJ5VG9rZW47XG4gICAgfVxuICAgIGlmIChzZXNzaW9uPy5ba1NuYXBzaG90RW5hYmxlZF0gJiYgc2Vzc2lvbltrU25hcHNob3RUaW1lXSA9PSBudWxsKSB7XG4gICAgICAgIC8vIGZpbmQgYW5kIGFnZ3JlZ2F0ZSBjb21tYW5kcyByZXR1cm4gYXRDbHVzdGVyVGltZSBvbiB0aGUgY3Vyc29yXG4gICAgICAgIC8vIGRpc3RpbmN0IGluY2x1ZGVzIGl0IGluIHRoZSByZXNwb25zZSBib2R5XG4gICAgICAgIGNvbnN0IGF0Q2x1c3RlclRpbWUgPSBkb2N1bWVudC5jdXJzb3I/LmF0Q2x1c3RlclRpbWUgfHwgZG9jdW1lbnQuYXRDbHVzdGVyVGltZTtcbiAgICAgICAgaWYgKGF0Q2x1c3RlclRpbWUpIHtcbiAgICAgICAgICAgIHNlc3Npb25ba1NuYXBzaG90VGltZV0gPSBhdENsdXN0ZXJUaW1lO1xuICAgICAgICB9XG4gICAgfVxufVxuZXhwb3J0cy51cGRhdGVTZXNzaW9uRnJvbVJlc3BvbnNlID0gdXBkYXRlU2Vzc2lvbkZyb21SZXNwb25zZTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXNlc3Npb25zLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/sessions.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/sort.js":
/*!**************************************************!*\
  !*** ../server/node_modules/mongodb/lib/sort.js ***!
  \**************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.formatSort = void 0;\nconst error_1 = __webpack_require__(/*! ./error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\n/** @internal */\nfunction prepareDirection(direction = 1) {\n    const value = `${direction}`.toLowerCase();\n    if (isMeta(direction))\n        return direction;\n    switch (value) {\n        case 'ascending':\n        case 'asc':\n        case '1':\n            return 1;\n        case 'descending':\n        case 'desc':\n        case '-1':\n            return -1;\n        default:\n            throw new error_1.MongoInvalidArgumentError(`Invalid sort direction: ${JSON.stringify(direction)}`);\n    }\n}\n/** @internal */\nfunction isMeta(t) {\n    return typeof t === 'object' && t != null && '$meta' in t && typeof t.$meta === 'string';\n}\n/** @internal */\nfunction isPair(t) {\n    if (Array.isArray(t) && t.length === 2) {\n        try {\n            prepareDirection(t[1]);\n            return true;\n        }\n        catch (e) {\n            return false;\n        }\n    }\n    return false;\n}\nfunction isDeep(t) {\n    return Array.isArray(t) && Array.isArray(t[0]);\n}\nfunction isMap(t) {\n    return t instanceof Map && t.size > 0;\n}\n/** @internal */\nfunction pairToMap(v) {\n    return new Map([[`${v[0]}`, prepareDirection([v[1]])]]);\n}\n/** @internal */\nfunction deepToMap(t) {\n    const sortEntries = t.map(([k, v]) => [`${k}`, prepareDirection(v)]);\n    return new Map(sortEntries);\n}\n/** @internal */\nfunction stringsToMap(t) {\n    const sortEntries = t.map(key => [`${key}`, 1]);\n    return new Map(sortEntries);\n}\n/** @internal */\nfunction objectToMap(t) {\n    const sortEntries = Object.entries(t).map(([k, v]) => [\n        `${k}`,\n        prepareDirection(v)\n    ]);\n    return new Map(sortEntries);\n}\n/** @internal */\nfunction mapToMap(t) {\n    const sortEntries = Array.from(t).map(([k, v]) => [\n        `${k}`,\n        prepareDirection(v)\n    ]);\n    return new Map(sortEntries);\n}\n/** converts a Sort type into a type that is valid for the server (SortForCmd) */\nfunction formatSort(sort, direction) {\n    if (sort == null)\n        return undefined;\n    if (typeof sort === 'string')\n        return new Map([[sort, prepareDirection(direction)]]);\n    if (typeof sort !== 'object') {\n        throw new error_1.MongoInvalidArgumentError(`Invalid sort format: ${JSON.stringify(sort)} Sort must be a valid object`);\n    }\n    if (!Array.isArray(sort)) {\n        return isMap(sort) ? mapToMap(sort) : Object.keys(sort).length ? objectToMap(sort) : undefined;\n    }\n    if (!sort.length)\n        return undefined;\n    if (isDeep(sort))\n        return deepToMap(sort);\n    if (isPair(sort))\n        return pairToMap(sort);\n    return stringsToMap(sort);\n}\nexports.formatSort = formatSort;\n//# sourceMappingURL=sort.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9zb3J0LmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELGtCQUFrQjtBQUNsQixnQkFBZ0IsbUJBQU8sQ0FBQyxrRUFBUztBQUNqQztBQUNBO0FBQ0EscUJBQXFCLFVBQVU7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUZBQW1GLDBCQUEwQjtBQUM3RztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsS0FBSztBQUM3QjtBQUNBO0FBQ0E7QUFDQSw4Q0FBOEMsRUFBRTtBQUNoRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlDQUF5QyxJQUFJO0FBQzdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXLEVBQUU7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVcsRUFBRTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0RUFBNEUsc0JBQXNCO0FBQ2xHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQjtBQUNsQiIsInNvdXJjZXMiOlsiRDpcXHNhbG9uaVxcYXBwcmFpc2FsLXN5c3RlbVxcc2VydmVyXFxub2RlX21vZHVsZXNcXG1vbmdvZGJcXGxpYlxcc29ydC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuZm9ybWF0U29ydCA9IHZvaWQgMDtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi9lcnJvclwiKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmZ1bmN0aW9uIHByZXBhcmVEaXJlY3Rpb24oZGlyZWN0aW9uID0gMSkge1xuICAgIGNvbnN0IHZhbHVlID0gYCR7ZGlyZWN0aW9ufWAudG9Mb3dlckNhc2UoKTtcbiAgICBpZiAoaXNNZXRhKGRpcmVjdGlvbikpXG4gICAgICAgIHJldHVybiBkaXJlY3Rpb247XG4gICAgc3dpdGNoICh2YWx1ZSkge1xuICAgICAgICBjYXNlICdhc2NlbmRpbmcnOlxuICAgICAgICBjYXNlICdhc2MnOlxuICAgICAgICBjYXNlICcxJzpcbiAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICBjYXNlICdkZXNjZW5kaW5nJzpcbiAgICAgICAgY2FzZSAnZGVzYyc6XG4gICAgICAgIGNhc2UgJy0xJzpcbiAgICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoYEludmFsaWQgc29ydCBkaXJlY3Rpb246ICR7SlNPTi5zdHJpbmdpZnkoZGlyZWN0aW9uKX1gKTtcbiAgICB9XG59XG4vKiogQGludGVybmFsICovXG5mdW5jdGlvbiBpc01ldGEodCkge1xuICAgIHJldHVybiB0eXBlb2YgdCA9PT0gJ29iamVjdCcgJiYgdCAhPSBudWxsICYmICckbWV0YScgaW4gdCAmJiB0eXBlb2YgdC4kbWV0YSA9PT0gJ3N0cmluZyc7XG59XG4vKiogQGludGVybmFsICovXG5mdW5jdGlvbiBpc1BhaXIodCkge1xuICAgIGlmIChBcnJheS5pc0FycmF5KHQpICYmIHQubGVuZ3RoID09PSAyKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBwcmVwYXJlRGlyZWN0aW9uKHRbMV0pO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG59XG5mdW5jdGlvbiBpc0RlZXAodCkge1xuICAgIHJldHVybiBBcnJheS5pc0FycmF5KHQpICYmIEFycmF5LmlzQXJyYXkodFswXSk7XG59XG5mdW5jdGlvbiBpc01hcCh0KSB7XG4gICAgcmV0dXJuIHQgaW5zdGFuY2VvZiBNYXAgJiYgdC5zaXplID4gMDtcbn1cbi8qKiBAaW50ZXJuYWwgKi9cbmZ1bmN0aW9uIHBhaXJUb01hcCh2KSB7XG4gICAgcmV0dXJuIG5ldyBNYXAoW1tgJHt2WzBdfWAsIHByZXBhcmVEaXJlY3Rpb24oW3ZbMV1dKV1dKTtcbn1cbi8qKiBAaW50ZXJuYWwgKi9cbmZ1bmN0aW9uIGRlZXBUb01hcCh0KSB7XG4gICAgY29uc3Qgc29ydEVudHJpZXMgPSB0Lm1hcCgoW2ssIHZdKSA9PiBbYCR7a31gLCBwcmVwYXJlRGlyZWN0aW9uKHYpXSk7XG4gICAgcmV0dXJuIG5ldyBNYXAoc29ydEVudHJpZXMpO1xufVxuLyoqIEBpbnRlcm5hbCAqL1xuZnVuY3Rpb24gc3RyaW5nc1RvTWFwKHQpIHtcbiAgICBjb25zdCBzb3J0RW50cmllcyA9IHQubWFwKGtleSA9PiBbYCR7a2V5fWAsIDFdKTtcbiAgICByZXR1cm4gbmV3IE1hcChzb3J0RW50cmllcyk7XG59XG4vKiogQGludGVybmFsICovXG5mdW5jdGlvbiBvYmplY3RUb01hcCh0KSB7XG4gICAgY29uc3Qgc29ydEVudHJpZXMgPSBPYmplY3QuZW50cmllcyh0KS5tYXAoKFtrLCB2XSkgPT4gW1xuICAgICAgICBgJHtrfWAsXG4gICAgICAgIHByZXBhcmVEaXJlY3Rpb24odilcbiAgICBdKTtcbiAgICByZXR1cm4gbmV3IE1hcChzb3J0RW50cmllcyk7XG59XG4vKiogQGludGVybmFsICovXG5mdW5jdGlvbiBtYXBUb01hcCh0KSB7XG4gICAgY29uc3Qgc29ydEVudHJpZXMgPSBBcnJheS5mcm9tKHQpLm1hcCgoW2ssIHZdKSA9PiBbXG4gICAgICAgIGAke2t9YCxcbiAgICAgICAgcHJlcGFyZURpcmVjdGlvbih2KVxuICAgIF0pO1xuICAgIHJldHVybiBuZXcgTWFwKHNvcnRFbnRyaWVzKTtcbn1cbi8qKiBjb252ZXJ0cyBhIFNvcnQgdHlwZSBpbnRvIGEgdHlwZSB0aGF0IGlzIHZhbGlkIGZvciB0aGUgc2VydmVyIChTb3J0Rm9yQ21kKSAqL1xuZnVuY3Rpb24gZm9ybWF0U29ydChzb3J0LCBkaXJlY3Rpb24pIHtcbiAgICBpZiAoc29ydCA9PSBudWxsKVxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIGlmICh0eXBlb2Ygc29ydCA9PT0gJ3N0cmluZycpXG4gICAgICAgIHJldHVybiBuZXcgTWFwKFtbc29ydCwgcHJlcGFyZURpcmVjdGlvbihkaXJlY3Rpb24pXV0pO1xuICAgIGlmICh0eXBlb2Ygc29ydCAhPT0gJ29iamVjdCcpIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcihgSW52YWxpZCBzb3J0IGZvcm1hdDogJHtKU09OLnN0cmluZ2lmeShzb3J0KX0gU29ydCBtdXN0IGJlIGEgdmFsaWQgb2JqZWN0YCk7XG4gICAgfVxuICAgIGlmICghQXJyYXkuaXNBcnJheShzb3J0KSkge1xuICAgICAgICByZXR1cm4gaXNNYXAoc29ydCkgPyBtYXBUb01hcChzb3J0KSA6IE9iamVjdC5rZXlzKHNvcnQpLmxlbmd0aCA/IG9iamVjdFRvTWFwKHNvcnQpIDogdW5kZWZpbmVkO1xuICAgIH1cbiAgICBpZiAoIXNvcnQubGVuZ3RoKVxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIGlmIChpc0RlZXAoc29ydCkpXG4gICAgICAgIHJldHVybiBkZWVwVG9NYXAoc29ydCk7XG4gICAgaWYgKGlzUGFpcihzb3J0KSlcbiAgICAgICAgcmV0dXJuIHBhaXJUb01hcChzb3J0KTtcbiAgICByZXR1cm4gc3RyaW5nc1RvTWFwKHNvcnQpO1xufVxuZXhwb3J0cy5mb3JtYXRTb3J0ID0gZm9ybWF0U29ydDtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXNvcnQuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/sort.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/transactions.js":
/*!**********************************************************!*\
  !*** ../server/node_modules/mongodb/lib/transactions.js ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.isTransactionCommand = exports.Transaction = exports.TxnState = void 0;\nconst error_1 = __webpack_require__(/*! ./error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst read_concern_1 = __webpack_require__(/*! ./read_concern */ \"(api)/../server/node_modules/mongodb/lib/read_concern.js\");\nconst read_preference_1 = __webpack_require__(/*! ./read_preference */ \"(api)/../server/node_modules/mongodb/lib/read_preference.js\");\nconst write_concern_1 = __webpack_require__(/*! ./write_concern */ \"(api)/../server/node_modules/mongodb/lib/write_concern.js\");\n/** @internal */\nexports.TxnState = Object.freeze({\n    NO_TRANSACTION: 'NO_TRANSACTION',\n    STARTING_TRANSACTION: 'STARTING_TRANSACTION',\n    TRANSACTION_IN_PROGRESS: 'TRANSACTION_IN_PROGRESS',\n    TRANSACTION_COMMITTED: 'TRANSACTION_COMMITTED',\n    TRANSACTION_COMMITTED_EMPTY: 'TRANSACTION_COMMITTED_EMPTY',\n    TRANSACTION_ABORTED: 'TRANSACTION_ABORTED'\n});\nconst stateMachine = {\n    [exports.TxnState.NO_TRANSACTION]: [exports.TxnState.NO_TRANSACTION, exports.TxnState.STARTING_TRANSACTION],\n    [exports.TxnState.STARTING_TRANSACTION]: [\n        exports.TxnState.TRANSACTION_IN_PROGRESS,\n        exports.TxnState.TRANSACTION_COMMITTED,\n        exports.TxnState.TRANSACTION_COMMITTED_EMPTY,\n        exports.TxnState.TRANSACTION_ABORTED\n    ],\n    [exports.TxnState.TRANSACTION_IN_PROGRESS]: [\n        exports.TxnState.TRANSACTION_IN_PROGRESS,\n        exports.TxnState.TRANSACTION_COMMITTED,\n        exports.TxnState.TRANSACTION_ABORTED\n    ],\n    [exports.TxnState.TRANSACTION_COMMITTED]: [\n        exports.TxnState.TRANSACTION_COMMITTED,\n        exports.TxnState.TRANSACTION_COMMITTED_EMPTY,\n        exports.TxnState.STARTING_TRANSACTION,\n        exports.TxnState.NO_TRANSACTION\n    ],\n    [exports.TxnState.TRANSACTION_ABORTED]: [exports.TxnState.STARTING_TRANSACTION, exports.TxnState.NO_TRANSACTION],\n    [exports.TxnState.TRANSACTION_COMMITTED_EMPTY]: [\n        exports.TxnState.TRANSACTION_COMMITTED_EMPTY,\n        exports.TxnState.NO_TRANSACTION\n    ]\n};\nconst ACTIVE_STATES = new Set([\n    exports.TxnState.STARTING_TRANSACTION,\n    exports.TxnState.TRANSACTION_IN_PROGRESS\n]);\nconst COMMITTED_STATES = new Set([\n    exports.TxnState.TRANSACTION_COMMITTED,\n    exports.TxnState.TRANSACTION_COMMITTED_EMPTY,\n    exports.TxnState.TRANSACTION_ABORTED\n]);\n/**\n * @public\n * A class maintaining state related to a server transaction. Internal Only\n */\nclass Transaction {\n    /** Create a transaction @internal */\n    constructor(options) {\n        options = options ?? {};\n        this.state = exports.TxnState.NO_TRANSACTION;\n        this.options = {};\n        const writeConcern = write_concern_1.WriteConcern.fromOptions(options);\n        if (writeConcern) {\n            if (writeConcern.w === 0) {\n                throw new error_1.MongoTransactionError('Transactions do not support unacknowledged write concern');\n            }\n            this.options.writeConcern = writeConcern;\n        }\n        if (options.readConcern) {\n            this.options.readConcern = read_concern_1.ReadConcern.fromOptions(options);\n        }\n        if (options.readPreference) {\n            this.options.readPreference = read_preference_1.ReadPreference.fromOptions(options);\n        }\n        if (options.maxCommitTimeMS) {\n            this.options.maxTimeMS = options.maxCommitTimeMS;\n        }\n        // TODO: This isn't technically necessary\n        this._pinnedServer = undefined;\n        this._recoveryToken = undefined;\n    }\n    /** @internal */\n    get server() {\n        return this._pinnedServer;\n    }\n    get recoveryToken() {\n        return this._recoveryToken;\n    }\n    get isPinned() {\n        return !!this.server;\n    }\n    /** @returns Whether the transaction has started */\n    get isStarting() {\n        return this.state === exports.TxnState.STARTING_TRANSACTION;\n    }\n    /**\n     * @returns Whether this session is presently in a transaction\n     */\n    get isActive() {\n        return ACTIVE_STATES.has(this.state);\n    }\n    get isCommitted() {\n        return COMMITTED_STATES.has(this.state);\n    }\n    /**\n     * Transition the transaction in the state machine\n     * @internal\n     * @param nextState - The new state to transition to\n     */\n    transition(nextState) {\n        const nextStates = stateMachine[this.state];\n        if (nextStates && nextStates.includes(nextState)) {\n            this.state = nextState;\n            if (this.state === exports.TxnState.NO_TRANSACTION ||\n                this.state === exports.TxnState.STARTING_TRANSACTION ||\n                this.state === exports.TxnState.TRANSACTION_ABORTED) {\n                this.unpinServer();\n            }\n            return;\n        }\n        throw new error_1.MongoRuntimeError(`Attempted illegal state transition from [${this.state}] to [${nextState}]`);\n    }\n    /** @internal */\n    pinServer(server) {\n        if (this.isActive) {\n            this._pinnedServer = server;\n        }\n    }\n    /** @internal */\n    unpinServer() {\n        this._pinnedServer = undefined;\n    }\n}\nexports.Transaction = Transaction;\nfunction isTransactionCommand(command) {\n    return !!(command.commitTransaction || command.abortTransaction);\n}\nexports.isTransactionCommand = isTransactionCommand;\n//# sourceMappingURL=transactions.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi90cmFuc2FjdGlvbnMuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsNEJBQTRCLEdBQUcsbUJBQW1CLEdBQUcsZ0JBQWdCO0FBQ3JFLGdCQUFnQixtQkFBTyxDQUFDLGtFQUFTO0FBQ2pDLHVCQUF1QixtQkFBTyxDQUFDLGdGQUFnQjtBQUMvQywwQkFBMEIsbUJBQU8sQ0FBQyxzRkFBbUI7QUFDckQsd0JBQXdCLG1CQUFPLENBQUMsa0ZBQWlCO0FBQ2pEO0FBQ0EsZ0JBQWdCO0FBQ2hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdGQUF3RixXQUFXLFFBQVEsVUFBVTtBQUNySDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUI7QUFDbkI7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCO0FBQzVCIiwic291cmNlcyI6WyJEOlxcc2Fsb25pXFxhcHByYWlzYWwtc3lzdGVtXFxzZXJ2ZXJcXG5vZGVfbW9kdWxlc1xcbW9uZ29kYlxcbGliXFx0cmFuc2FjdGlvbnMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmlzVHJhbnNhY3Rpb25Db21tYW5kID0gZXhwb3J0cy5UcmFuc2FjdGlvbiA9IGV4cG9ydHMuVHhuU3RhdGUgPSB2b2lkIDA7XG5jb25zdCBlcnJvcl8xID0gcmVxdWlyZShcIi4vZXJyb3JcIik7XG5jb25zdCByZWFkX2NvbmNlcm5fMSA9IHJlcXVpcmUoXCIuL3JlYWRfY29uY2VyblwiKTtcbmNvbnN0IHJlYWRfcHJlZmVyZW5jZV8xID0gcmVxdWlyZShcIi4vcmVhZF9wcmVmZXJlbmNlXCIpO1xuY29uc3Qgd3JpdGVfY29uY2Vybl8xID0gcmVxdWlyZShcIi4vd3JpdGVfY29uY2VyblwiKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmV4cG9ydHMuVHhuU3RhdGUgPSBPYmplY3QuZnJlZXplKHtcbiAgICBOT19UUkFOU0FDVElPTjogJ05PX1RSQU5TQUNUSU9OJyxcbiAgICBTVEFSVElOR19UUkFOU0FDVElPTjogJ1NUQVJUSU5HX1RSQU5TQUNUSU9OJyxcbiAgICBUUkFOU0FDVElPTl9JTl9QUk9HUkVTUzogJ1RSQU5TQUNUSU9OX0lOX1BST0dSRVNTJyxcbiAgICBUUkFOU0FDVElPTl9DT01NSVRURUQ6ICdUUkFOU0FDVElPTl9DT01NSVRURUQnLFxuICAgIFRSQU5TQUNUSU9OX0NPTU1JVFRFRF9FTVBUWTogJ1RSQU5TQUNUSU9OX0NPTU1JVFRFRF9FTVBUWScsXG4gICAgVFJBTlNBQ1RJT05fQUJPUlRFRDogJ1RSQU5TQUNUSU9OX0FCT1JURUQnXG59KTtcbmNvbnN0IHN0YXRlTWFjaGluZSA9IHtcbiAgICBbZXhwb3J0cy5UeG5TdGF0ZS5OT19UUkFOU0FDVElPTl06IFtleHBvcnRzLlR4blN0YXRlLk5PX1RSQU5TQUNUSU9OLCBleHBvcnRzLlR4blN0YXRlLlNUQVJUSU5HX1RSQU5TQUNUSU9OXSxcbiAgICBbZXhwb3J0cy5UeG5TdGF0ZS5TVEFSVElOR19UUkFOU0FDVElPTl06IFtcbiAgICAgICAgZXhwb3J0cy5UeG5TdGF0ZS5UUkFOU0FDVElPTl9JTl9QUk9HUkVTUyxcbiAgICAgICAgZXhwb3J0cy5UeG5TdGF0ZS5UUkFOU0FDVElPTl9DT01NSVRURUQsXG4gICAgICAgIGV4cG9ydHMuVHhuU3RhdGUuVFJBTlNBQ1RJT05fQ09NTUlUVEVEX0VNUFRZLFxuICAgICAgICBleHBvcnRzLlR4blN0YXRlLlRSQU5TQUNUSU9OX0FCT1JURURcbiAgICBdLFxuICAgIFtleHBvcnRzLlR4blN0YXRlLlRSQU5TQUNUSU9OX0lOX1BST0dSRVNTXTogW1xuICAgICAgICBleHBvcnRzLlR4blN0YXRlLlRSQU5TQUNUSU9OX0lOX1BST0dSRVNTLFxuICAgICAgICBleHBvcnRzLlR4blN0YXRlLlRSQU5TQUNUSU9OX0NPTU1JVFRFRCxcbiAgICAgICAgZXhwb3J0cy5UeG5TdGF0ZS5UUkFOU0FDVElPTl9BQk9SVEVEXG4gICAgXSxcbiAgICBbZXhwb3J0cy5UeG5TdGF0ZS5UUkFOU0FDVElPTl9DT01NSVRURURdOiBbXG4gICAgICAgIGV4cG9ydHMuVHhuU3RhdGUuVFJBTlNBQ1RJT05fQ09NTUlUVEVELFxuICAgICAgICBleHBvcnRzLlR4blN0YXRlLlRSQU5TQUNUSU9OX0NPTU1JVFRFRF9FTVBUWSxcbiAgICAgICAgZXhwb3J0cy5UeG5TdGF0ZS5TVEFSVElOR19UUkFOU0FDVElPTixcbiAgICAgICAgZXhwb3J0cy5UeG5TdGF0ZS5OT19UUkFOU0FDVElPTlxuICAgIF0sXG4gICAgW2V4cG9ydHMuVHhuU3RhdGUuVFJBTlNBQ1RJT05fQUJPUlRFRF06IFtleHBvcnRzLlR4blN0YXRlLlNUQVJUSU5HX1RSQU5TQUNUSU9OLCBleHBvcnRzLlR4blN0YXRlLk5PX1RSQU5TQUNUSU9OXSxcbiAgICBbZXhwb3J0cy5UeG5TdGF0ZS5UUkFOU0FDVElPTl9DT01NSVRURURfRU1QVFldOiBbXG4gICAgICAgIGV4cG9ydHMuVHhuU3RhdGUuVFJBTlNBQ1RJT05fQ09NTUlUVEVEX0VNUFRZLFxuICAgICAgICBleHBvcnRzLlR4blN0YXRlLk5PX1RSQU5TQUNUSU9OXG4gICAgXVxufTtcbmNvbnN0IEFDVElWRV9TVEFURVMgPSBuZXcgU2V0KFtcbiAgICBleHBvcnRzLlR4blN0YXRlLlNUQVJUSU5HX1RSQU5TQUNUSU9OLFxuICAgIGV4cG9ydHMuVHhuU3RhdGUuVFJBTlNBQ1RJT05fSU5fUFJPR1JFU1Ncbl0pO1xuY29uc3QgQ09NTUlUVEVEX1NUQVRFUyA9IG5ldyBTZXQoW1xuICAgIGV4cG9ydHMuVHhuU3RhdGUuVFJBTlNBQ1RJT05fQ09NTUlUVEVELFxuICAgIGV4cG9ydHMuVHhuU3RhdGUuVFJBTlNBQ1RJT05fQ09NTUlUVEVEX0VNUFRZLFxuICAgIGV4cG9ydHMuVHhuU3RhdGUuVFJBTlNBQ1RJT05fQUJPUlRFRFxuXSk7XG4vKipcbiAqIEBwdWJsaWNcbiAqIEEgY2xhc3MgbWFpbnRhaW5pbmcgc3RhdGUgcmVsYXRlZCB0byBhIHNlcnZlciB0cmFuc2FjdGlvbi4gSW50ZXJuYWwgT25seVxuICovXG5jbGFzcyBUcmFuc2FjdGlvbiB7XG4gICAgLyoqIENyZWF0ZSBhIHRyYW5zYWN0aW9uIEBpbnRlcm5hbCAqL1xuICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHtcbiAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgPz8ge307XG4gICAgICAgIHRoaXMuc3RhdGUgPSBleHBvcnRzLlR4blN0YXRlLk5PX1RSQU5TQUNUSU9OO1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSB7fTtcbiAgICAgICAgY29uc3Qgd3JpdGVDb25jZXJuID0gd3JpdGVfY29uY2Vybl8xLldyaXRlQ29uY2Vybi5mcm9tT3B0aW9ucyhvcHRpb25zKTtcbiAgICAgICAgaWYgKHdyaXRlQ29uY2Vybikge1xuICAgICAgICAgICAgaWYgKHdyaXRlQ29uY2Vybi53ID09PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29UcmFuc2FjdGlvbkVycm9yKCdUcmFuc2FjdGlvbnMgZG8gbm90IHN1cHBvcnQgdW5hY2tub3dsZWRnZWQgd3JpdGUgY29uY2VybicpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5vcHRpb25zLndyaXRlQ29uY2VybiA9IHdyaXRlQ29uY2VybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAob3B0aW9ucy5yZWFkQ29uY2Vybikge1xuICAgICAgICAgICAgdGhpcy5vcHRpb25zLnJlYWRDb25jZXJuID0gcmVhZF9jb25jZXJuXzEuUmVhZENvbmNlcm4uZnJvbU9wdGlvbnMob3B0aW9ucyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9wdGlvbnMucmVhZFByZWZlcmVuY2UpIHtcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5yZWFkUHJlZmVyZW5jZSA9IHJlYWRfcHJlZmVyZW5jZV8xLlJlYWRQcmVmZXJlbmNlLmZyb21PcHRpb25zKG9wdGlvbnMpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvcHRpb25zLm1heENvbW1pdFRpbWVNUykge1xuICAgICAgICAgICAgdGhpcy5vcHRpb25zLm1heFRpbWVNUyA9IG9wdGlvbnMubWF4Q29tbWl0VGltZU1TO1xuICAgICAgICB9XG4gICAgICAgIC8vIFRPRE86IFRoaXMgaXNuJ3QgdGVjaG5pY2FsbHkgbmVjZXNzYXJ5XG4gICAgICAgIHRoaXMuX3Bpbm5lZFNlcnZlciA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5fcmVjb3ZlcnlUb2tlbiA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGdldCBzZXJ2ZXIoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9waW5uZWRTZXJ2ZXI7XG4gICAgfVxuICAgIGdldCByZWNvdmVyeVRva2VuKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fcmVjb3ZlcnlUb2tlbjtcbiAgICB9XG4gICAgZ2V0IGlzUGlubmVkKCkge1xuICAgICAgICByZXR1cm4gISF0aGlzLnNlcnZlcjtcbiAgICB9XG4gICAgLyoqIEByZXR1cm5zIFdoZXRoZXIgdGhlIHRyYW5zYWN0aW9uIGhhcyBzdGFydGVkICovXG4gICAgZ2V0IGlzU3RhcnRpbmcoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnN0YXRlID09PSBleHBvcnRzLlR4blN0YXRlLlNUQVJUSU5HX1RSQU5TQUNUSU9OO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAcmV0dXJucyBXaGV0aGVyIHRoaXMgc2Vzc2lvbiBpcyBwcmVzZW50bHkgaW4gYSB0cmFuc2FjdGlvblxuICAgICAqL1xuICAgIGdldCBpc0FjdGl2ZSgpIHtcbiAgICAgICAgcmV0dXJuIEFDVElWRV9TVEFURVMuaGFzKHRoaXMuc3RhdGUpO1xuICAgIH1cbiAgICBnZXQgaXNDb21taXR0ZWQoKSB7XG4gICAgICAgIHJldHVybiBDT01NSVRURURfU1RBVEVTLmhhcyh0aGlzLnN0YXRlKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVHJhbnNpdGlvbiB0aGUgdHJhbnNhY3Rpb24gaW4gdGhlIHN0YXRlIG1hY2hpbmVcbiAgICAgKiBAaW50ZXJuYWxcbiAgICAgKiBAcGFyYW0gbmV4dFN0YXRlIC0gVGhlIG5ldyBzdGF0ZSB0byB0cmFuc2l0aW9uIHRvXG4gICAgICovXG4gICAgdHJhbnNpdGlvbihuZXh0U3RhdGUpIHtcbiAgICAgICAgY29uc3QgbmV4dFN0YXRlcyA9IHN0YXRlTWFjaGluZVt0aGlzLnN0YXRlXTtcbiAgICAgICAgaWYgKG5leHRTdGF0ZXMgJiYgbmV4dFN0YXRlcy5pbmNsdWRlcyhuZXh0U3RhdGUpKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXRlID0gbmV4dFN0YXRlO1xuICAgICAgICAgICAgaWYgKHRoaXMuc3RhdGUgPT09IGV4cG9ydHMuVHhuU3RhdGUuTk9fVFJBTlNBQ1RJT04gfHxcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXRlID09PSBleHBvcnRzLlR4blN0YXRlLlNUQVJUSU5HX1RSQU5TQUNUSU9OIHx8XG4gICAgICAgICAgICAgICAgdGhpcy5zdGF0ZSA9PT0gZXhwb3J0cy5UeG5TdGF0ZS5UUkFOU0FDVElPTl9BQk9SVEVEKSB7XG4gICAgICAgICAgICAgICAgdGhpcy51bnBpblNlcnZlcigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUnVudGltZUVycm9yKGBBdHRlbXB0ZWQgaWxsZWdhbCBzdGF0ZSB0cmFuc2l0aW9uIGZyb20gWyR7dGhpcy5zdGF0ZX1dIHRvIFske25leHRTdGF0ZX1dYCk7XG4gICAgfVxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBwaW5TZXJ2ZXIoc2VydmVyKSB7XG4gICAgICAgIGlmICh0aGlzLmlzQWN0aXZlKSB7XG4gICAgICAgICAgICB0aGlzLl9waW5uZWRTZXJ2ZXIgPSBzZXJ2ZXI7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIHVucGluU2VydmVyKCkge1xuICAgICAgICB0aGlzLl9waW5uZWRTZXJ2ZXIgPSB1bmRlZmluZWQ7XG4gICAgfVxufVxuZXhwb3J0cy5UcmFuc2FjdGlvbiA9IFRyYW5zYWN0aW9uO1xuZnVuY3Rpb24gaXNUcmFuc2FjdGlvbkNvbW1hbmQoY29tbWFuZCkge1xuICAgIHJldHVybiAhIShjb21tYW5kLmNvbW1pdFRyYW5zYWN0aW9uIHx8IGNvbW1hbmQuYWJvcnRUcmFuc2FjdGlvbik7XG59XG5leHBvcnRzLmlzVHJhbnNhY3Rpb25Db21tYW5kID0gaXNUcmFuc2FjdGlvbkNvbW1hbmQ7XG4vLyMgc291cmNlTWFwcGluZ1VSTD10cmFuc2FjdGlvbnMuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/transactions.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/utils.js":
/*!***************************************************!*\
  !*** ../server/node_modules/mongodb/lib/utils.js ***!
  \***************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.matchesParentDomain = exports.parseUnsignedInteger = exports.parseInteger = exports.compareObjectId = exports.getMongoDBClientEncryption = exports.commandSupportsReadConcern = exports.shuffle = exports.supportsRetryableWrites = exports.enumToString = exports.emitWarningOnce = exports.emitWarning = exports.MONGODB_WARNING_CODE = exports.DEFAULT_PK_FACTORY = exports.HostAddress = exports.BufferPool = exports.List = exports.deepCopy = exports.isRecord = exports.setDifference = exports.isHello = exports.isSuperset = exports.resolveOptions = exports.hasAtomicOperators = exports.calculateDurationInMs = exports.now = exports.makeStateMachine = exports.errorStrictEqual = exports.arrayStrictEqual = exports.eachAsync = exports.maxWireVersion = exports.uuidV4 = exports.databaseNamespace = exports.maybeCallback = exports.makeCounter = exports.MongoDBCollectionNamespace = exports.MongoDBNamespace = exports.ns = exports.getTopology = exports.decorateWithExplain = exports.decorateWithReadConcern = exports.decorateWithCollation = exports.isPromiseLike = exports.applyRetryableWrites = exports.filterOptions = exports.mergeOptions = exports.isObject = exports.normalizeHintField = exports.checkCollectionName = exports.hostMatchesWildcards = exports.ByteUtils = void 0;\nexports.request = void 0;\nconst crypto = __webpack_require__(/*! crypto */ \"crypto\");\nconst http = __webpack_require__(/*! http */ \"http\");\nconst url = __webpack_require__(/*! url */ \"url\");\nconst url_1 = __webpack_require__(/*! url */ \"url\");\nconst bson_1 = __webpack_require__(/*! ./bson */ \"(api)/../server/node_modules/mongodb/lib/bson.js\");\nconst constants_1 = __webpack_require__(/*! ./cmap/wire_protocol/constants */ \"(api)/../server/node_modules/mongodb/lib/cmap/wire_protocol/constants.js\");\nconst constants_2 = __webpack_require__(/*! ./constants */ \"(api)/../server/node_modules/mongodb/lib/constants.js\");\nconst error_1 = __webpack_require__(/*! ./error */ \"(api)/../server/node_modules/mongodb/lib/error.js\");\nconst read_concern_1 = __webpack_require__(/*! ./read_concern */ \"(api)/../server/node_modules/mongodb/lib/read_concern.js\");\nconst read_preference_1 = __webpack_require__(/*! ./read_preference */ \"(api)/../server/node_modules/mongodb/lib/read_preference.js\");\nconst common_1 = __webpack_require__(/*! ./sdam/common */ \"(api)/../server/node_modules/mongodb/lib/sdam/common.js\");\nconst write_concern_1 = __webpack_require__(/*! ./write_concern */ \"(api)/../server/node_modules/mongodb/lib/write_concern.js\");\nexports.ByteUtils = {\n    toLocalBufferType(buffer) {\n        return Buffer.isBuffer(buffer)\n            ? buffer\n            : Buffer.from(buffer.buffer, buffer.byteOffset, buffer.byteLength);\n    },\n    equals(seqA, seqB) {\n        return exports.ByteUtils.toLocalBufferType(seqA).equals(seqB);\n    },\n    compare(seqA, seqB) {\n        return exports.ByteUtils.toLocalBufferType(seqA).compare(seqB);\n    },\n    toBase64(uint8array) {\n        return exports.ByteUtils.toLocalBufferType(uint8array).toString('base64');\n    }\n};\n/**\n * Determines if a connection's address matches a user provided list\n * of domain wildcards.\n */\nfunction hostMatchesWildcards(host, wildcards) {\n    for (const wildcard of wildcards) {\n        if (host === wildcard ||\n            (wildcard.startsWith('*.') && host?.endsWith(wildcard.substring(2, wildcard.length))) ||\n            (wildcard.startsWith('*/') && host?.endsWith(wildcard.substring(2, wildcard.length)))) {\n            return true;\n        }\n    }\n    return false;\n}\nexports.hostMatchesWildcards = hostMatchesWildcards;\n/**\n * Throws if collectionName is not a valid mongodb collection namespace.\n * @internal\n */\nfunction checkCollectionName(collectionName) {\n    if ('string' !== typeof collectionName) {\n        throw new error_1.MongoInvalidArgumentError('Collection name must be a String');\n    }\n    if (!collectionName || collectionName.indexOf('..') !== -1) {\n        throw new error_1.MongoInvalidArgumentError('Collection names cannot be empty');\n    }\n    if (collectionName.indexOf('$') !== -1 &&\n        collectionName.match(/((^\\$cmd)|(oplog\\.\\$main))/) == null) {\n        // TODO(NODE-3483): Use MongoNamespace static method\n        throw new error_1.MongoInvalidArgumentError(\"Collection names must not contain '$'\");\n    }\n    if (collectionName.match(/^\\.|\\.$/) != null) {\n        // TODO(NODE-3483): Use MongoNamespace static method\n        throw new error_1.MongoInvalidArgumentError(\"Collection names must not start or end with '.'\");\n    }\n    // Validate that we are not passing 0x00 in the collection name\n    if (collectionName.indexOf('\\x00') !== -1) {\n        // TODO(NODE-3483): Use MongoNamespace static method\n        throw new error_1.MongoInvalidArgumentError('Collection names cannot contain a null character');\n    }\n}\nexports.checkCollectionName = checkCollectionName;\n/**\n * Ensure Hint field is in a shape we expect:\n * - object of index names mapping to 1 or -1\n * - just an index name\n * @internal\n */\nfunction normalizeHintField(hint) {\n    let finalHint = undefined;\n    if (typeof hint === 'string') {\n        finalHint = hint;\n    }\n    else if (Array.isArray(hint)) {\n        finalHint = {};\n        hint.forEach(param => {\n            finalHint[param] = 1;\n        });\n    }\n    else if (hint != null && typeof hint === 'object') {\n        finalHint = {};\n        for (const name in hint) {\n            finalHint[name] = hint[name];\n        }\n    }\n    return finalHint;\n}\nexports.normalizeHintField = normalizeHintField;\nconst TO_STRING = (object) => Object.prototype.toString.call(object);\n/**\n * Checks if arg is an Object:\n * - **NOTE**: the check is based on the `[Symbol.toStringTag]() === 'Object'`\n * @internal\n */\nfunction isObject(arg) {\n    return '[object Object]' === TO_STRING(arg);\n}\nexports.isObject = isObject;\n/** @internal */\nfunction mergeOptions(target, source) {\n    return { ...target, ...source };\n}\nexports.mergeOptions = mergeOptions;\n/** @internal */\nfunction filterOptions(options, names) {\n    const filterOptions = {};\n    for (const name in options) {\n        if (names.includes(name)) {\n            filterOptions[name] = options[name];\n        }\n    }\n    // Filtered options\n    return filterOptions;\n}\nexports.filterOptions = filterOptions;\n/**\n * Applies retryWrites: true to a command if retryWrites is set on the command's database.\n * @internal\n *\n * @param target - The target command to which we will apply retryWrites.\n * @param db - The database from which we can inherit a retryWrites value.\n */\nfunction applyRetryableWrites(target, db) {\n    if (db && db.s.options?.retryWrites) {\n        target.retryWrites = true;\n    }\n    return target;\n}\nexports.applyRetryableWrites = applyRetryableWrites;\n/**\n * Applies a write concern to a command based on well defined inheritance rules, optionally\n * detecting support for the write concern in the first place.\n * @internal\n *\n * @param target - the target command we will be applying the write concern to\n * @param sources - sources where we can inherit default write concerns from\n * @param options - optional settings passed into a command for write concern overrides\n */\n/**\n * Checks if a given value is a Promise\n *\n * @typeParam T - The resolution type of the possible promise\n * @param value - An object that could be a promise\n * @returns true if the provided value is a Promise\n */\nfunction isPromiseLike(value) {\n    return !!value && typeof value.then === 'function';\n}\nexports.isPromiseLike = isPromiseLike;\n/**\n * Applies collation to a given command.\n * @internal\n *\n * @param command - the command on which to apply collation\n * @param target - target of command\n * @param options - options containing collation settings\n */\nfunction decorateWithCollation(command, target, options) {\n    const capabilities = getTopology(target).capabilities;\n    if (options.collation && typeof options.collation === 'object') {\n        if (capabilities && capabilities.commandsTakeCollation) {\n            command.collation = options.collation;\n        }\n        else {\n            throw new error_1.MongoCompatibilityError(`Current topology does not support collation`);\n        }\n    }\n}\nexports.decorateWithCollation = decorateWithCollation;\n/**\n * Applies a read concern to a given command.\n * @internal\n *\n * @param command - the command on which to apply the read concern\n * @param coll - the parent collection of the operation calling this method\n */\nfunction decorateWithReadConcern(command, coll, options) {\n    if (options && options.session && options.session.inTransaction()) {\n        return;\n    }\n    const readConcern = Object.assign({}, command.readConcern || {});\n    if (coll.s.readConcern) {\n        Object.assign(readConcern, coll.s.readConcern);\n    }\n    if (Object.keys(readConcern).length > 0) {\n        Object.assign(command, { readConcern: readConcern });\n    }\n}\nexports.decorateWithReadConcern = decorateWithReadConcern;\n/**\n * Applies an explain to a given command.\n * @internal\n *\n * @param command - the command on which to apply the explain\n * @param options - the options containing the explain verbosity\n */\nfunction decorateWithExplain(command, explain) {\n    if (command.explain) {\n        return command;\n    }\n    return { explain: command, verbosity: explain.verbosity };\n}\nexports.decorateWithExplain = decorateWithExplain;\n/**\n * A helper function to get the topology from a given provider. Throws\n * if the topology cannot be found.\n * @throws MongoNotConnectedError\n * @internal\n */\nfunction getTopology(provider) {\n    // MongoClient or ClientSession or AbstractCursor\n    if ('topology' in provider && provider.topology) {\n        return provider.topology;\n    }\n    else if ('client' in provider && provider.client.topology) {\n        return provider.client.topology;\n    }\n    throw new error_1.MongoNotConnectedError('MongoClient must be connected to perform this operation');\n}\nexports.getTopology = getTopology;\n/** @internal */\nfunction ns(ns) {\n    return MongoDBNamespace.fromString(ns);\n}\nexports.ns = ns;\n/** @public */\nclass MongoDBNamespace {\n    /**\n     * Create a namespace object\n     *\n     * @param db - database name\n     * @param collection - collection name\n     */\n    constructor(db, collection) {\n        this.db = db;\n        this.collection = collection;\n        this.collection = collection === '' ? undefined : collection;\n    }\n    toString() {\n        return this.collection ? `${this.db}.${this.collection}` : this.db;\n    }\n    withCollection(collection) {\n        return new MongoDBCollectionNamespace(this.db, collection);\n    }\n    static fromString(namespace) {\n        if (typeof namespace !== 'string' || namespace === '') {\n            // TODO(NODE-3483): Replace with MongoNamespaceError\n            throw new error_1.MongoRuntimeError(`Cannot parse namespace from \"${namespace}\"`);\n        }\n        const [db, ...collectionParts] = namespace.split('.');\n        const collection = collectionParts.join('.');\n        return new MongoDBNamespace(db, collection === '' ? undefined : collection);\n    }\n}\nexports.MongoDBNamespace = MongoDBNamespace;\n/**\n * @public\n *\n * A class representing a collection's namespace.  This class enforces (through Typescript) that\n * the `collection` portion of the namespace is defined and should only be\n * used in scenarios where this can be guaranteed.\n */\nclass MongoDBCollectionNamespace extends MongoDBNamespace {\n    constructor(db, collection) {\n        super(db, collection);\n        this.collection = collection;\n    }\n}\nexports.MongoDBCollectionNamespace = MongoDBCollectionNamespace;\n/** @internal */\nfunction* makeCounter(seed = 0) {\n    let count = seed;\n    while (true) {\n        const newCount = count;\n        count += 1;\n        yield newCount;\n    }\n}\nexports.makeCounter = makeCounter;\nfunction maybeCallback(promiseFn, callback) {\n    const promise = promiseFn();\n    if (callback == null) {\n        return promise;\n    }\n    promise.then(result => callback(undefined, result), error => callback(error));\n    return;\n}\nexports.maybeCallback = maybeCallback;\n/** @internal */\nfunction databaseNamespace(ns) {\n    return ns.split('.')[0];\n}\nexports.databaseNamespace = databaseNamespace;\n/**\n * Synchronously Generate a UUIDv4\n * @internal\n */\nfunction uuidV4() {\n    const result = crypto.randomBytes(16);\n    result[6] = (result[6] & 0x0f) | 0x40;\n    result[8] = (result[8] & 0x3f) | 0x80;\n    return result;\n}\nexports.uuidV4 = uuidV4;\n/**\n * A helper function for determining `maxWireVersion` between legacy and new topology instances\n * @internal\n */\nfunction maxWireVersion(topologyOrServer) {\n    if (topologyOrServer) {\n        if (topologyOrServer.loadBalanced) {\n            // Since we do not have a monitor, we assume the load balanced server is always\n            // pointed at the latest mongodb version. There is a risk that for on-prem\n            // deployments that don't upgrade immediately that this could alert to the\n            // application that a feature is available that is actually not.\n            return constants_1.MAX_SUPPORTED_WIRE_VERSION;\n        }\n        if (topologyOrServer.hello) {\n            return topologyOrServer.hello.maxWireVersion;\n        }\n        if ('lastHello' in topologyOrServer && typeof topologyOrServer.lastHello === 'function') {\n            const lastHello = topologyOrServer.lastHello();\n            if (lastHello) {\n                return lastHello.maxWireVersion;\n            }\n        }\n        if (topologyOrServer.description &&\n            'maxWireVersion' in topologyOrServer.description &&\n            topologyOrServer.description.maxWireVersion != null) {\n            return topologyOrServer.description.maxWireVersion;\n        }\n    }\n    return 0;\n}\nexports.maxWireVersion = maxWireVersion;\n/**\n * Applies the function `eachFn` to each item in `arr`, in parallel.\n * @internal\n *\n * @param arr - An array of items to asynchronously iterate over\n * @param eachFn - A function to call on each item of the array. The callback signature is `(item, callback)`, where the callback indicates iteration is complete.\n * @param callback - The callback called after every item has been iterated\n */\nfunction eachAsync(arr, eachFn, callback) {\n    arr = arr || [];\n    let idx = 0;\n    let awaiting = 0;\n    for (idx = 0; idx < arr.length; ++idx) {\n        awaiting++;\n        eachFn(arr[idx], eachCallback);\n    }\n    if (awaiting === 0) {\n        callback();\n        return;\n    }\n    function eachCallback(err) {\n        awaiting--;\n        if (err) {\n            callback(err);\n            return;\n        }\n        if (idx === arr.length && awaiting <= 0) {\n            callback();\n        }\n    }\n}\nexports.eachAsync = eachAsync;\n/** @internal */\nfunction arrayStrictEqual(arr, arr2) {\n    if (!Array.isArray(arr) || !Array.isArray(arr2)) {\n        return false;\n    }\n    return arr.length === arr2.length && arr.every((elt, idx) => elt === arr2[idx]);\n}\nexports.arrayStrictEqual = arrayStrictEqual;\n/** @internal */\nfunction errorStrictEqual(lhs, rhs) {\n    if (lhs === rhs) {\n        return true;\n    }\n    if (!lhs || !rhs) {\n        return lhs === rhs;\n    }\n    if ((lhs == null && rhs != null) || (lhs != null && rhs == null)) {\n        return false;\n    }\n    if (lhs.constructor.name !== rhs.constructor.name) {\n        return false;\n    }\n    if (lhs.message !== rhs.message) {\n        return false;\n    }\n    return true;\n}\nexports.errorStrictEqual = errorStrictEqual;\n/** @internal */\nfunction makeStateMachine(stateTable) {\n    return function stateTransition(target, newState) {\n        const legalStates = stateTable[target.s.state];\n        if (legalStates && legalStates.indexOf(newState) < 0) {\n            throw new error_1.MongoRuntimeError(`illegal state transition from [${target.s.state}] => [${newState}], allowed: [${legalStates}]`);\n        }\n        target.emit('stateChanged', target.s.state, newState);\n        target.s.state = newState;\n    };\n}\nexports.makeStateMachine = makeStateMachine;\n/** @internal */\nfunction now() {\n    const hrtime = process.hrtime();\n    return Math.floor(hrtime[0] * 1000 + hrtime[1] / 1000000);\n}\nexports.now = now;\n/** @internal */\nfunction calculateDurationInMs(started) {\n    if (typeof started !== 'number') {\n        throw new error_1.MongoInvalidArgumentError('Numeric value required to calculate duration');\n    }\n    const elapsed = now() - started;\n    return elapsed < 0 ? 0 : elapsed;\n}\nexports.calculateDurationInMs = calculateDurationInMs;\n/** @internal */\nfunction hasAtomicOperators(doc) {\n    if (Array.isArray(doc)) {\n        for (const document of doc) {\n            if (hasAtomicOperators(document)) {\n                return true;\n            }\n        }\n        return false;\n    }\n    const keys = Object.keys(doc);\n    return keys.length > 0 && keys[0][0] === '$';\n}\nexports.hasAtomicOperators = hasAtomicOperators;\n/**\n * Merge inherited properties from parent into options, prioritizing values from options,\n * then values from parent.\n * @internal\n */\nfunction resolveOptions(parent, options) {\n    const result = Object.assign({}, options, (0, bson_1.resolveBSONOptions)(options, parent));\n    // Users cannot pass a readConcern/writeConcern to operations in a transaction\n    const session = options?.session;\n    if (!session?.inTransaction()) {\n        const readConcern = read_concern_1.ReadConcern.fromOptions(options) ?? parent?.readConcern;\n        if (readConcern) {\n            result.readConcern = readConcern;\n        }\n        const writeConcern = write_concern_1.WriteConcern.fromOptions(options) ?? parent?.writeConcern;\n        if (writeConcern) {\n            result.writeConcern = writeConcern;\n        }\n    }\n    const readPreference = read_preference_1.ReadPreference.fromOptions(options) ?? parent?.readPreference;\n    if (readPreference) {\n        result.readPreference = readPreference;\n    }\n    return result;\n}\nexports.resolveOptions = resolveOptions;\nfunction isSuperset(set, subset) {\n    set = Array.isArray(set) ? new Set(set) : set;\n    subset = Array.isArray(subset) ? new Set(subset) : subset;\n    for (const elem of subset) {\n        if (!set.has(elem)) {\n            return false;\n        }\n    }\n    return true;\n}\nexports.isSuperset = isSuperset;\n/**\n * Checks if the document is a Hello request\n * @internal\n */\nfunction isHello(doc) {\n    return doc[constants_2.LEGACY_HELLO_COMMAND] || doc.hello ? true : false;\n}\nexports.isHello = isHello;\n/** Returns the items that are uniquely in setA */\nfunction setDifference(setA, setB) {\n    const difference = new Set(setA);\n    for (const elem of setB) {\n        difference.delete(elem);\n    }\n    return difference;\n}\nexports.setDifference = setDifference;\nconst HAS_OWN = (object, prop) => Object.prototype.hasOwnProperty.call(object, prop);\nfunction isRecord(value, requiredKeys = undefined) {\n    if (!isObject(value)) {\n        return false;\n    }\n    const ctor = value.constructor;\n    if (ctor && ctor.prototype) {\n        if (!isObject(ctor.prototype)) {\n            return false;\n        }\n        // Check to see if some method exists from the Object exists\n        if (!HAS_OWN(ctor.prototype, 'isPrototypeOf')) {\n            return false;\n        }\n    }\n    if (requiredKeys) {\n        const keys = Object.keys(value);\n        return isSuperset(keys, requiredKeys);\n    }\n    return true;\n}\nexports.isRecord = isRecord;\n/**\n * Make a deep copy of an object\n *\n * NOTE: This is not meant to be the perfect implementation of a deep copy,\n * but instead something that is good enough for the purposes of\n * command monitoring.\n */\nfunction deepCopy(value) {\n    if (value == null) {\n        return value;\n    }\n    else if (Array.isArray(value)) {\n        return value.map(item => deepCopy(item));\n    }\n    else if (isRecord(value)) {\n        const res = {};\n        for (const key in value) {\n            res[key] = deepCopy(value[key]);\n        }\n        return res;\n    }\n    const ctor = value.constructor;\n    if (ctor) {\n        switch (ctor.name.toLowerCase()) {\n            case 'date':\n                return new ctor(Number(value));\n            case 'map':\n                return new Map(value);\n            case 'set':\n                return new Set(value);\n            case 'buffer':\n                return Buffer.from(value);\n        }\n    }\n    return value;\n}\nexports.deepCopy = deepCopy;\n/**\n * A sequential list of items in a circularly linked list\n * @remarks\n * The head node is special, it is always defined and has a value of null.\n * It is never \"included\" in the list, in that, it is not returned by pop/shift or yielded by the iterator.\n * The circular linkage and always defined head node are to reduce checks for null next/prev references to zero.\n * New nodes are declared as object literals with keys always in the same order: next, prev, value.\n * @internal\n */\nclass List {\n    get length() {\n        return this.count;\n    }\n    get [Symbol.toStringTag]() {\n        return 'List';\n    }\n    constructor() {\n        this.count = 0;\n        // this is carefully crafted:\n        // declaring a complete and consistently key ordered\n        // object is beneficial to the runtime optimizations\n        this.head = {\n            next: null,\n            prev: null,\n            value: null\n        };\n        this.head.next = this.head;\n        this.head.prev = this.head;\n    }\n    toArray() {\n        return Array.from(this);\n    }\n    toString() {\n        return `head <=> ${this.toArray().join(' <=> ')} <=> head`;\n    }\n    *[Symbol.iterator]() {\n        for (const node of this.nodes()) {\n            yield node.value;\n        }\n    }\n    *nodes() {\n        let ptr = this.head.next;\n        while (ptr !== this.head) {\n            // Save next before yielding so that we make removing within iteration safe\n            const { next } = ptr;\n            yield ptr;\n            ptr = next;\n        }\n    }\n    /** Insert at end of list */\n    push(value) {\n        this.count += 1;\n        const newNode = {\n            next: this.head,\n            prev: this.head.prev,\n            value\n        };\n        this.head.prev.next = newNode;\n        this.head.prev = newNode;\n    }\n    /** Inserts every item inside an iterable instead of the iterable itself */\n    pushMany(iterable) {\n        for (const value of iterable) {\n            this.push(value);\n        }\n    }\n    /** Insert at front of list */\n    unshift(value) {\n        this.count += 1;\n        const newNode = {\n            next: this.head.next,\n            prev: this.head,\n            value\n        };\n        this.head.next.prev = newNode;\n        this.head.next = newNode;\n    }\n    remove(node) {\n        if (node === this.head || this.length === 0) {\n            return null;\n        }\n        this.count -= 1;\n        const prevNode = node.prev;\n        const nextNode = node.next;\n        prevNode.next = nextNode;\n        nextNode.prev = prevNode;\n        return node.value;\n    }\n    /** Removes the first node at the front of the list */\n    shift() {\n        return this.remove(this.head.next);\n    }\n    /** Removes the last node at the end of the list */\n    pop() {\n        return this.remove(this.head.prev);\n    }\n    /** Iterates through the list and removes nodes where filter returns true */\n    prune(filter) {\n        for (const node of this.nodes()) {\n            if (filter(node.value)) {\n                this.remove(node);\n            }\n        }\n    }\n    clear() {\n        this.count = 0;\n        this.head.next = this.head;\n        this.head.prev = this.head;\n    }\n    /** Returns the first item in the list, does not remove */\n    first() {\n        // If the list is empty, value will be the head's null\n        return this.head.next.value;\n    }\n    /** Returns the last item in the list, does not remove */\n    last() {\n        // If the list is empty, value will be the head's null\n        return this.head.prev.value;\n    }\n}\nexports.List = List;\n/**\n * A pool of Buffers which allow you to read them as if they were one\n * @internal\n */\nclass BufferPool {\n    constructor() {\n        this.buffers = new List();\n        this.totalByteLength = 0;\n    }\n    get length() {\n        return this.totalByteLength;\n    }\n    /** Adds a buffer to the internal buffer pool list */\n    append(buffer) {\n        this.buffers.push(buffer);\n        this.totalByteLength += buffer.length;\n    }\n    /**\n     * If BufferPool contains 4 bytes or more construct an int32 from the leading bytes,\n     * otherwise return null. Size can be negative, caller should error check.\n     */\n    getInt32() {\n        if (this.totalByteLength < 4) {\n            return null;\n        }\n        const firstBuffer = this.buffers.first();\n        if (firstBuffer != null && firstBuffer.byteLength >= 4) {\n            return firstBuffer.readInt32LE(0);\n        }\n        // Unlikely case: an int32 is split across buffers.\n        // Use read and put the returned buffer back on top\n        const top4Bytes = this.read(4);\n        const value = top4Bytes.readInt32LE(0);\n        // Put it back.\n        this.totalByteLength += 4;\n        this.buffers.unshift(top4Bytes);\n        return value;\n    }\n    /** Reads the requested number of bytes, optionally consuming them */\n    read(size) {\n        if (typeof size !== 'number' || size < 0) {\n            throw new error_1.MongoInvalidArgumentError('Argument \"size\" must be a non-negative number');\n        }\n        // oversized request returns empty buffer\n        if (size > this.totalByteLength) {\n            return Buffer.alloc(0);\n        }\n        // We know we have enough, we just don't know how it is spread across chunks\n        // TODO(NODE-4732): alloc API should change based on raw option\n        const result = Buffer.allocUnsafe(size);\n        for (let bytesRead = 0; bytesRead < size;) {\n            const buffer = this.buffers.shift();\n            if (buffer == null) {\n                break;\n            }\n            const bytesRemaining = size - bytesRead;\n            const bytesReadable = Math.min(bytesRemaining, buffer.byteLength);\n            const bytes = buffer.subarray(0, bytesReadable);\n            result.set(bytes, bytesRead);\n            bytesRead += bytesReadable;\n            this.totalByteLength -= bytesReadable;\n            if (bytesReadable < buffer.byteLength) {\n                this.buffers.unshift(buffer.subarray(bytesReadable));\n            }\n        }\n        return result;\n    }\n}\nexports.BufferPool = BufferPool;\n/** @public */\nclass HostAddress {\n    constructor(hostString) {\n        this.host = undefined;\n        this.port = undefined;\n        this.socketPath = undefined;\n        this.isIPv6 = false;\n        const escapedHost = hostString.split(' ').join('%20'); // escape spaces, for socket path hosts\n        if (escapedHost.endsWith('.sock')) {\n            // heuristically determine if we're working with a domain socket\n            this.socketPath = decodeURIComponent(escapedHost);\n            return;\n        }\n        const urlString = `iLoveJS://${escapedHost}`;\n        let url;\n        try {\n            url = new url_1.URL(urlString);\n        }\n        catch (urlError) {\n            const runtimeError = new error_1.MongoRuntimeError(`Unable to parse ${escapedHost} with URL`);\n            runtimeError.cause = urlError;\n            throw runtimeError;\n        }\n        const hostname = url.hostname;\n        const port = url.port;\n        let normalized = decodeURIComponent(hostname).toLowerCase();\n        if (normalized.startsWith('[') && normalized.endsWith(']')) {\n            this.isIPv6 = true;\n            normalized = normalized.substring(1, hostname.length - 1);\n        }\n        this.host = normalized.toLowerCase();\n        if (typeof port === 'number') {\n            this.port = port;\n        }\n        else if (typeof port === 'string' && port !== '') {\n            this.port = Number.parseInt(port, 10);\n        }\n        else {\n            this.port = 27017;\n        }\n        if (this.port === 0) {\n            throw new error_1.MongoParseError('Invalid port (zero) with hostname');\n        }\n        Object.freeze(this);\n    }\n    [Symbol.for('nodejs.util.inspect.custom')]() {\n        return this.inspect();\n    }\n    inspect() {\n        return `new HostAddress('${this.toString()}')`;\n    }\n    toString() {\n        if (typeof this.host === 'string') {\n            if (this.isIPv6) {\n                return `[${this.host}]:${this.port}`;\n            }\n            return `${this.host}:${this.port}`;\n        }\n        return `${this.socketPath}`;\n    }\n    static fromString(s) {\n        return new HostAddress(s);\n    }\n    static fromHostPort(host, port) {\n        if (host.includes(':')) {\n            host = `[${host}]`; // IPv6 address\n        }\n        return HostAddress.fromString(`${host}:${port}`);\n    }\n    static fromSrvRecord({ name, port }) {\n        return HostAddress.fromHostPort(name, port);\n    }\n    toHostPort() {\n        if (this.socketPath) {\n            return { host: this.socketPath, port: 0 };\n        }\n        const host = this.host ?? '';\n        const port = this.port ?? 0;\n        return { host, port };\n    }\n}\nexports.HostAddress = HostAddress;\nexports.DEFAULT_PK_FACTORY = {\n    // We prefer not to rely on ObjectId having a createPk method\n    createPk() {\n        return new bson_1.ObjectId();\n    }\n};\n/**\n * When the driver used emitWarning the code will be equal to this.\n * @public\n *\n * @example\n * ```ts\n * process.on('warning', (warning) => {\n *  if (warning.code === MONGODB_WARNING_CODE) console.error('Ah an important warning! :)')\n * })\n * ```\n */\nexports.MONGODB_WARNING_CODE = 'MONGODB DRIVER';\n/** @internal */\nfunction emitWarning(message) {\n    return process.emitWarning(message, { code: exports.MONGODB_WARNING_CODE });\n}\nexports.emitWarning = emitWarning;\nconst emittedWarnings = new Set();\n/**\n * Will emit a warning once for the duration of the application.\n * Uses the message to identify if it has already been emitted\n * so using string interpolation can cause multiple emits\n * @internal\n */\nfunction emitWarningOnce(message) {\n    if (!emittedWarnings.has(message)) {\n        emittedWarnings.add(message);\n        return emitWarning(message);\n    }\n}\nexports.emitWarningOnce = emitWarningOnce;\n/**\n * Takes a JS object and joins the values into a string separated by ', '\n */\nfunction enumToString(en) {\n    return Object.values(en).join(', ');\n}\nexports.enumToString = enumToString;\n/**\n * Determine if a server supports retryable writes.\n *\n * @internal\n */\nfunction supportsRetryableWrites(server) {\n    if (!server) {\n        return false;\n    }\n    if (server.loadBalanced) {\n        // Loadbalanced topologies will always support retry writes\n        return true;\n    }\n    if (server.description.logicalSessionTimeoutMinutes != null) {\n        // that supports sessions\n        if (server.description.type !== common_1.ServerType.Standalone) {\n            // and that is not a standalone\n            return true;\n        }\n    }\n    return false;\n}\nexports.supportsRetryableWrites = supportsRetryableWrites;\n/**\n * Fisher–Yates Shuffle\n *\n * Reference: https://bost.ocks.org/mike/shuffle/\n * @param sequence - items to be shuffled\n * @param limit - Defaults to `0`. If nonzero shuffle will slice the randomized array e.g, `.slice(0, limit)` otherwise will return the entire randomized array.\n */\nfunction shuffle(sequence, limit = 0) {\n    const items = Array.from(sequence); // shallow copy in order to never shuffle the input\n    if (limit > items.length) {\n        throw new error_1.MongoRuntimeError('Limit must be less than the number of items');\n    }\n    let remainingItemsToShuffle = items.length;\n    const lowerBound = limit % items.length === 0 ? 1 : items.length - limit;\n    while (remainingItemsToShuffle > lowerBound) {\n        // Pick a remaining element\n        const randomIndex = Math.floor(Math.random() * remainingItemsToShuffle);\n        remainingItemsToShuffle -= 1;\n        // And swap it with the current element\n        const swapHold = items[remainingItemsToShuffle];\n        items[remainingItemsToShuffle] = items[randomIndex];\n        items[randomIndex] = swapHold;\n    }\n    return limit % items.length === 0 ? items : items.slice(lowerBound);\n}\nexports.shuffle = shuffle;\n// TODO(NODE-4936): read concern eligibility for commands should be codified in command construction\n// @see https://github.com/mongodb/specifications/blob/master/source/read-write-concern/read-write-concern.rst#read-concern\nfunction commandSupportsReadConcern(command, options) {\n    if (command.aggregate || command.count || command.distinct || command.find || command.geoNear) {\n        return true;\n    }\n    if (command.mapReduce &&\n        options &&\n        options.out &&\n        (options.out.inline === 1 || options.out === 'inline')) {\n        return true;\n    }\n    return false;\n}\nexports.commandSupportsReadConcern = commandSupportsReadConcern;\n/** A utility function to get the instance of mongodb-client-encryption, if it exists. */\nfunction getMongoDBClientEncryption() {\n    let mongodbClientEncryption = null;\n    // NOTE(NODE-4254): This is to get around the circular dependency between\n    // mongodb-client-encryption and the driver in the test scenarios.\n    if (typeof process.env.MONGODB_CLIENT_ENCRYPTION_OVERRIDE === 'string' &&\n        process.env.MONGODB_CLIENT_ENCRYPTION_OVERRIDE.length > 0) {\n        try {\n            // NOTE(NODE-3199): Ensure you always wrap an optional require literally in the try block\n            // Cannot be moved to helper utility function, bundlers search and replace the actual require call\n            // in a way that makes this line throw at bundle time, not runtime, catching here will make bundling succeed\n            mongodbClientEncryption = __webpack_require__(\"(api)/../server/node_modules/mongodb/lib sync recursive\")(process.env.MONGODB_CLIENT_ENCRYPTION_OVERRIDE);\n        }\n        catch {\n            // ignore\n        }\n    }\n    else {\n        try {\n            // NOTE(NODE-3199): Ensure you always wrap an optional require literally in the try block\n            // Cannot be moved to helper utility function, bundlers search and replace the actual require call\n            // in a way that makes this line throw at bundle time, not runtime, catching here will make bundling succeed\n            mongodbClientEncryption = __webpack_require__(/*! mongodb-client-encryption */ \"?619b\");\n        }\n        catch {\n            // ignore\n        }\n    }\n    return mongodbClientEncryption;\n}\nexports.getMongoDBClientEncryption = getMongoDBClientEncryption;\n/**\n * Compare objectIds. `null` is always less\n * - `+1 = oid1 is greater than oid2`\n * - `-1 = oid1 is less than oid2`\n * - `+0 = oid1 is equal oid2`\n */\nfunction compareObjectId(oid1, oid2) {\n    if (oid1 == null && oid2 == null) {\n        return 0;\n    }\n    if (oid1 == null) {\n        return -1;\n    }\n    if (oid2 == null) {\n        return 1;\n    }\n    return exports.ByteUtils.compare(oid1.id, oid2.id);\n}\nexports.compareObjectId = compareObjectId;\nfunction parseInteger(value) {\n    if (typeof value === 'number')\n        return Math.trunc(value);\n    const parsedValue = Number.parseInt(String(value), 10);\n    return Number.isNaN(parsedValue) ? null : parsedValue;\n}\nexports.parseInteger = parseInteger;\nfunction parseUnsignedInteger(value) {\n    const parsedInt = parseInteger(value);\n    return parsedInt != null && parsedInt >= 0 ? parsedInt : null;\n}\nexports.parseUnsignedInteger = parseUnsignedInteger;\n/**\n * Determines whether a provided address matches the provided parent domain.\n *\n * If a DNS server were to become compromised SRV records would still need to\n * advertise addresses that are under the same domain as the srvHost.\n *\n * @param address - The address to check against a domain\n * @param srvHost - The domain to check the provided address against\n * @returns Whether the provided address matches the parent domain\n */\nfunction matchesParentDomain(address, srvHost) {\n    // Remove trailing dot if exists on either the resolved address or the srv hostname\n    const normalizedAddress = address.endsWith('.') ? address.slice(0, address.length - 1) : address;\n    const normalizedSrvHost = srvHost.endsWith('.') ? srvHost.slice(0, srvHost.length - 1) : srvHost;\n    const allCharacterBeforeFirstDot = /^.*?\\./;\n    // Remove all characters before first dot\n    // Add leading dot back to string so\n    //   an srvHostDomain = '.trusted.site'\n    //   will not satisfy an addressDomain that endsWith '.fake-trusted.site'\n    const addressDomain = `.${normalizedAddress.replace(allCharacterBeforeFirstDot, '')}`;\n    const srvHostDomain = `.${normalizedSrvHost.replace(allCharacterBeforeFirstDot, '')}`;\n    return addressDomain.endsWith(srvHostDomain);\n}\nexports.matchesParentDomain = matchesParentDomain;\nasync function request(uri, options = {}) {\n    return new Promise((resolve, reject) => {\n        const requestOptions = {\n            method: 'GET',\n            timeout: 10000,\n            json: true,\n            ...url.parse(uri),\n            ...options\n        };\n        const req = http.request(requestOptions, res => {\n            res.setEncoding('utf8');\n            let data = '';\n            res.on('data', d => {\n                data += d;\n            });\n            res.once('end', () => {\n                if (options.json === false) {\n                    resolve(data);\n                    return;\n                }\n                try {\n                    const parsed = JSON.parse(data);\n                    resolve(parsed);\n                }\n                catch {\n                    // TODO(NODE-3483)\n                    reject(new error_1.MongoRuntimeError(`Invalid JSON response: \"${data}\"`));\n                }\n            });\n        });\n        req.once('timeout', () => req.destroy(new error_1.MongoNetworkTimeoutError(`Network request to ${uri} timed out after ${options.timeout} ms`)));\n        req.once('error', error => reject(error));\n        req.end();\n    });\n}\nexports.request = request;\n//# sourceMappingURL=utils.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi91dGlscy5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCwyQkFBMkIsR0FBRyw0QkFBNEIsR0FBRyxvQkFBb0IsR0FBRyx1QkFBdUIsR0FBRyxrQ0FBa0MsR0FBRyxrQ0FBa0MsR0FBRyxlQUFlLEdBQUcsK0JBQStCLEdBQUcsb0JBQW9CLEdBQUcsdUJBQXVCLEdBQUcsbUJBQW1CLEdBQUcsNEJBQTRCLEdBQUcsMEJBQTBCLEdBQUcsbUJBQW1CLEdBQUcsa0JBQWtCLEdBQUcsWUFBWSxHQUFHLGdCQUFnQixHQUFHLGdCQUFnQixHQUFHLHFCQUFxQixHQUFHLGVBQWUsR0FBRyxrQkFBa0IsR0FBRyxzQkFBc0IsR0FBRywwQkFBMEIsR0FBRyw2QkFBNkIsR0FBRyxXQUFXLEdBQUcsd0JBQXdCLEdBQUcsd0JBQXdCLEdBQUcsd0JBQXdCLEdBQUcsaUJBQWlCLEdBQUcsc0JBQXNCLEdBQUcsY0FBYyxHQUFHLHlCQUF5QixHQUFHLHFCQUFxQixHQUFHLG1CQUFtQixHQUFHLGtDQUFrQyxHQUFHLHdCQUF3QixHQUFHLFVBQVUsR0FBRyxtQkFBbUIsR0FBRywyQkFBMkIsR0FBRywrQkFBK0IsR0FBRyw2QkFBNkIsR0FBRyxxQkFBcUIsR0FBRyw0QkFBNEIsR0FBRyxxQkFBcUIsR0FBRyxvQkFBb0IsR0FBRyxnQkFBZ0IsR0FBRywwQkFBMEIsR0FBRywyQkFBMkIsR0FBRyw0QkFBNEIsR0FBRyxpQkFBaUI7QUFDbHZDLGVBQWU7QUFDZixlQUFlLG1CQUFPLENBQUMsc0JBQVE7QUFDL0IsYUFBYSxtQkFBTyxDQUFDLGtCQUFNO0FBQzNCLFlBQVksbUJBQU8sQ0FBQyxnQkFBSztBQUN6QixjQUFjLG1CQUFPLENBQUMsZ0JBQUs7QUFDM0IsZUFBZSxtQkFBTyxDQUFDLGdFQUFRO0FBQy9CLG9CQUFvQixtQkFBTyxDQUFDLGdIQUFnQztBQUM1RCxvQkFBb0IsbUJBQU8sQ0FBQywwRUFBYTtBQUN6QyxnQkFBZ0IsbUJBQU8sQ0FBQyxrRUFBUztBQUNqQyx1QkFBdUIsbUJBQU8sQ0FBQyxnRkFBZ0I7QUFDL0MsMEJBQTBCLG1CQUFPLENBQUMsc0ZBQW1CO0FBQ3JELGlCQUFpQixtQkFBTyxDQUFDLDhFQUFlO0FBQ3hDLHdCQUF3QixtQkFBTyxDQUFDLGtGQUFpQjtBQUNqRCxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QjtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEI7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCO0FBQ2hCO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxvQkFBb0I7QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QjtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QjtBQUM3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0NBQXdDLDJCQUEyQjtBQUNuRTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQywwQkFBMEI7QUFDM0Q7QUFDQTtBQUNBLCtCQUErQjtBQUMvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsMkJBQTJCO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CO0FBQ25CO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQ0FBb0MsUUFBUSxHQUFHLGdCQUFnQjtBQUMvRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdGQUFnRixVQUFVO0FBQzFGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QjtBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQztBQUNsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUI7QUFDbkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0I7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLGtCQUFrQjtBQUNwQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0I7QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0I7QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtGQUFrRixlQUFlLFFBQVEsU0FBUyxlQUFlLFlBQVk7QUFDN0k7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QjtBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEI7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUNBQW1DO0FBQ25DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQjtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQjtBQUNsQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQjtBQUNoQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0I7QUFDaEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLDhCQUE4QjtBQUN6RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixPQUFPO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVk7QUFDWjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDLGlCQUFpQjtBQUNqRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0RBQStEO0FBQy9EO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1Q0FBdUMsWUFBWTtBQUNuRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0ZBQWtGLGFBQWE7QUFDL0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1DQUFtQyxnQkFBZ0I7QUFDbkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsVUFBVSxJQUFJLFVBQVU7QUFDbkQ7QUFDQSxzQkFBc0IsVUFBVSxHQUFHLFVBQVU7QUFDN0M7QUFDQSxrQkFBa0IsZ0JBQWdCO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixLQUFLLElBQUk7QUFDaEM7QUFDQSx5Q0FBeUMsS0FBSyxHQUFHLEtBQUs7QUFDdEQ7QUFDQSwyQkFBMkIsWUFBWTtBQUN2QztBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLG1CQUFtQjtBQUNuQiwwQkFBMEI7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBLDRCQUE0QjtBQUM1QjtBQUNBO0FBQ0EsMENBQTBDLG9DQUFvQztBQUM5RTtBQUNBLG1CQUFtQjtBQUNuQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QjtBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0I7QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0I7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdDQUF3QztBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0NBQWtDO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0MsK0VBQVEsOENBQThDLENBQUM7QUFDN0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0MsbUJBQU8sQ0FBQyx3Q0FBMkI7QUFDekU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0M7QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQjtBQUNwQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QjtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhCQUE4QiwwREFBMEQ7QUFDeEYsOEJBQThCLDBEQUEwRDtBQUN4RjtBQUNBO0FBQ0EsMkJBQTJCO0FBQzNCLHdDQUF3QztBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0ZBQW9GLEtBQUs7QUFDekY7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNULHlHQUF5RyxLQUFLLGtCQUFrQixpQkFBaUI7QUFDako7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLGVBQWU7QUFDZiIsInNvdXJjZXMiOlsiRDpcXHNhbG9uaVxcYXBwcmFpc2FsLXN5c3RlbVxcc2VydmVyXFxub2RlX21vZHVsZXNcXG1vbmdvZGJcXGxpYlxcdXRpbHMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLm1hdGNoZXNQYXJlbnREb21haW4gPSBleHBvcnRzLnBhcnNlVW5zaWduZWRJbnRlZ2VyID0gZXhwb3J0cy5wYXJzZUludGVnZXIgPSBleHBvcnRzLmNvbXBhcmVPYmplY3RJZCA9IGV4cG9ydHMuZ2V0TW9uZ29EQkNsaWVudEVuY3J5cHRpb24gPSBleHBvcnRzLmNvbW1hbmRTdXBwb3J0c1JlYWRDb25jZXJuID0gZXhwb3J0cy5zaHVmZmxlID0gZXhwb3J0cy5zdXBwb3J0c1JldHJ5YWJsZVdyaXRlcyA9IGV4cG9ydHMuZW51bVRvU3RyaW5nID0gZXhwb3J0cy5lbWl0V2FybmluZ09uY2UgPSBleHBvcnRzLmVtaXRXYXJuaW5nID0gZXhwb3J0cy5NT05HT0RCX1dBUk5JTkdfQ09ERSA9IGV4cG9ydHMuREVGQVVMVF9QS19GQUNUT1JZID0gZXhwb3J0cy5Ib3N0QWRkcmVzcyA9IGV4cG9ydHMuQnVmZmVyUG9vbCA9IGV4cG9ydHMuTGlzdCA9IGV4cG9ydHMuZGVlcENvcHkgPSBleHBvcnRzLmlzUmVjb3JkID0gZXhwb3J0cy5zZXREaWZmZXJlbmNlID0gZXhwb3J0cy5pc0hlbGxvID0gZXhwb3J0cy5pc1N1cGVyc2V0ID0gZXhwb3J0cy5yZXNvbHZlT3B0aW9ucyA9IGV4cG9ydHMuaGFzQXRvbWljT3BlcmF0b3JzID0gZXhwb3J0cy5jYWxjdWxhdGVEdXJhdGlvbkluTXMgPSBleHBvcnRzLm5vdyA9IGV4cG9ydHMubWFrZVN0YXRlTWFjaGluZSA9IGV4cG9ydHMuZXJyb3JTdHJpY3RFcXVhbCA9IGV4cG9ydHMuYXJyYXlTdHJpY3RFcXVhbCA9IGV4cG9ydHMuZWFjaEFzeW5jID0gZXhwb3J0cy5tYXhXaXJlVmVyc2lvbiA9IGV4cG9ydHMudXVpZFY0ID0gZXhwb3J0cy5kYXRhYmFzZU5hbWVzcGFjZSA9IGV4cG9ydHMubWF5YmVDYWxsYmFjayA9IGV4cG9ydHMubWFrZUNvdW50ZXIgPSBleHBvcnRzLk1vbmdvREJDb2xsZWN0aW9uTmFtZXNwYWNlID0gZXhwb3J0cy5Nb25nb0RCTmFtZXNwYWNlID0gZXhwb3J0cy5ucyA9IGV4cG9ydHMuZ2V0VG9wb2xvZ3kgPSBleHBvcnRzLmRlY29yYXRlV2l0aEV4cGxhaW4gPSBleHBvcnRzLmRlY29yYXRlV2l0aFJlYWRDb25jZXJuID0gZXhwb3J0cy5kZWNvcmF0ZVdpdGhDb2xsYXRpb24gPSBleHBvcnRzLmlzUHJvbWlzZUxpa2UgPSBleHBvcnRzLmFwcGx5UmV0cnlhYmxlV3JpdGVzID0gZXhwb3J0cy5maWx0ZXJPcHRpb25zID0gZXhwb3J0cy5tZXJnZU9wdGlvbnMgPSBleHBvcnRzLmlzT2JqZWN0ID0gZXhwb3J0cy5ub3JtYWxpemVIaW50RmllbGQgPSBleHBvcnRzLmNoZWNrQ29sbGVjdGlvbk5hbWUgPSBleHBvcnRzLmhvc3RNYXRjaGVzV2lsZGNhcmRzID0gZXhwb3J0cy5CeXRlVXRpbHMgPSB2b2lkIDA7XG5leHBvcnRzLnJlcXVlc3QgPSB2b2lkIDA7XG5jb25zdCBjcnlwdG8gPSByZXF1aXJlKFwiY3J5cHRvXCIpO1xuY29uc3QgaHR0cCA9IHJlcXVpcmUoXCJodHRwXCIpO1xuY29uc3QgdXJsID0gcmVxdWlyZShcInVybFwiKTtcbmNvbnN0IHVybF8xID0gcmVxdWlyZShcInVybFwiKTtcbmNvbnN0IGJzb25fMSA9IHJlcXVpcmUoXCIuL2Jzb25cIik7XG5jb25zdCBjb25zdGFudHNfMSA9IHJlcXVpcmUoXCIuL2NtYXAvd2lyZV9wcm90b2NvbC9jb25zdGFudHNcIik7XG5jb25zdCBjb25zdGFudHNfMiA9IHJlcXVpcmUoXCIuL2NvbnN0YW50c1wiKTtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi9lcnJvclwiKTtcbmNvbnN0IHJlYWRfY29uY2Vybl8xID0gcmVxdWlyZShcIi4vcmVhZF9jb25jZXJuXCIpO1xuY29uc3QgcmVhZF9wcmVmZXJlbmNlXzEgPSByZXF1aXJlKFwiLi9yZWFkX3ByZWZlcmVuY2VcIik7XG5jb25zdCBjb21tb25fMSA9IHJlcXVpcmUoXCIuL3NkYW0vY29tbW9uXCIpO1xuY29uc3Qgd3JpdGVfY29uY2Vybl8xID0gcmVxdWlyZShcIi4vd3JpdGVfY29uY2VyblwiKTtcbmV4cG9ydHMuQnl0ZVV0aWxzID0ge1xuICAgIHRvTG9jYWxCdWZmZXJUeXBlKGJ1ZmZlcikge1xuICAgICAgICByZXR1cm4gQnVmZmVyLmlzQnVmZmVyKGJ1ZmZlcilcbiAgICAgICAgICAgID8gYnVmZmVyXG4gICAgICAgICAgICA6IEJ1ZmZlci5mcm9tKGJ1ZmZlci5idWZmZXIsIGJ1ZmZlci5ieXRlT2Zmc2V0LCBidWZmZXIuYnl0ZUxlbmd0aCk7XG4gICAgfSxcbiAgICBlcXVhbHMoc2VxQSwgc2VxQikge1xuICAgICAgICByZXR1cm4gZXhwb3J0cy5CeXRlVXRpbHMudG9Mb2NhbEJ1ZmZlclR5cGUoc2VxQSkuZXF1YWxzKHNlcUIpO1xuICAgIH0sXG4gICAgY29tcGFyZShzZXFBLCBzZXFCKSB7XG4gICAgICAgIHJldHVybiBleHBvcnRzLkJ5dGVVdGlscy50b0xvY2FsQnVmZmVyVHlwZShzZXFBKS5jb21wYXJlKHNlcUIpO1xuICAgIH0sXG4gICAgdG9CYXNlNjQodWludDhhcnJheSkge1xuICAgICAgICByZXR1cm4gZXhwb3J0cy5CeXRlVXRpbHMudG9Mb2NhbEJ1ZmZlclR5cGUodWludDhhcnJheSkudG9TdHJpbmcoJ2Jhc2U2NCcpO1xuICAgIH1cbn07XG4vKipcbiAqIERldGVybWluZXMgaWYgYSBjb25uZWN0aW9uJ3MgYWRkcmVzcyBtYXRjaGVzIGEgdXNlciBwcm92aWRlZCBsaXN0XG4gKiBvZiBkb21haW4gd2lsZGNhcmRzLlxuICovXG5mdW5jdGlvbiBob3N0TWF0Y2hlc1dpbGRjYXJkcyhob3N0LCB3aWxkY2FyZHMpIHtcbiAgICBmb3IgKGNvbnN0IHdpbGRjYXJkIG9mIHdpbGRjYXJkcykge1xuICAgICAgICBpZiAoaG9zdCA9PT0gd2lsZGNhcmQgfHxcbiAgICAgICAgICAgICh3aWxkY2FyZC5zdGFydHNXaXRoKCcqLicpICYmIGhvc3Q/LmVuZHNXaXRoKHdpbGRjYXJkLnN1YnN0cmluZygyLCB3aWxkY2FyZC5sZW5ndGgpKSkgfHxcbiAgICAgICAgICAgICh3aWxkY2FyZC5zdGFydHNXaXRoKCcqLycpICYmIGhvc3Q/LmVuZHNXaXRoKHdpbGRjYXJkLnN1YnN0cmluZygyLCB3aWxkY2FyZC5sZW5ndGgpKSkpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbn1cbmV4cG9ydHMuaG9zdE1hdGNoZXNXaWxkY2FyZHMgPSBob3N0TWF0Y2hlc1dpbGRjYXJkcztcbi8qKlxuICogVGhyb3dzIGlmIGNvbGxlY3Rpb25OYW1lIGlzIG5vdCBhIHZhbGlkIG1vbmdvZGIgY29sbGVjdGlvbiBuYW1lc3BhY2UuXG4gKiBAaW50ZXJuYWxcbiAqL1xuZnVuY3Rpb24gY2hlY2tDb2xsZWN0aW9uTmFtZShjb2xsZWN0aW9uTmFtZSkge1xuICAgIGlmICgnc3RyaW5nJyAhPT0gdHlwZW9mIGNvbGxlY3Rpb25OYW1lKSB7XG4gICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoJ0NvbGxlY3Rpb24gbmFtZSBtdXN0IGJlIGEgU3RyaW5nJyk7XG4gICAgfVxuICAgIGlmICghY29sbGVjdGlvbk5hbWUgfHwgY29sbGVjdGlvbk5hbWUuaW5kZXhPZignLi4nKSAhPT0gLTEpIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignQ29sbGVjdGlvbiBuYW1lcyBjYW5ub3QgYmUgZW1wdHknKTtcbiAgICB9XG4gICAgaWYgKGNvbGxlY3Rpb25OYW1lLmluZGV4T2YoJyQnKSAhPT0gLTEgJiZcbiAgICAgICAgY29sbGVjdGlvbk5hbWUubWF0Y2goLygoXlxcJGNtZCl8KG9wbG9nXFwuXFwkbWFpbikpLykgPT0gbnVsbCkge1xuICAgICAgICAvLyBUT0RPKE5PREUtMzQ4Myk6IFVzZSBNb25nb05hbWVzcGFjZSBzdGF0aWMgbWV0aG9kXG4gICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoXCJDb2xsZWN0aW9uIG5hbWVzIG11c3Qgbm90IGNvbnRhaW4gJyQnXCIpO1xuICAgIH1cbiAgICBpZiAoY29sbGVjdGlvbk5hbWUubWF0Y2goL15cXC58XFwuJC8pICE9IG51bGwpIHtcbiAgICAgICAgLy8gVE9ETyhOT0RFLTM0ODMpOiBVc2UgTW9uZ29OYW1lc3BhY2Ugc3RhdGljIG1ldGhvZFxuICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKFwiQ29sbGVjdGlvbiBuYW1lcyBtdXN0IG5vdCBzdGFydCBvciBlbmQgd2l0aCAnLidcIik7XG4gICAgfVxuICAgIC8vIFZhbGlkYXRlIHRoYXQgd2UgYXJlIG5vdCBwYXNzaW5nIDB4MDAgaW4gdGhlIGNvbGxlY3Rpb24gbmFtZVxuICAgIGlmIChjb2xsZWN0aW9uTmFtZS5pbmRleE9mKCdcXHgwMCcpICE9PSAtMSkge1xuICAgICAgICAvLyBUT0RPKE5PREUtMzQ4Myk6IFVzZSBNb25nb05hbWVzcGFjZSBzdGF0aWMgbWV0aG9kXG4gICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoJ0NvbGxlY3Rpb24gbmFtZXMgY2Fubm90IGNvbnRhaW4gYSBudWxsIGNoYXJhY3RlcicpO1xuICAgIH1cbn1cbmV4cG9ydHMuY2hlY2tDb2xsZWN0aW9uTmFtZSA9IGNoZWNrQ29sbGVjdGlvbk5hbWU7XG4vKipcbiAqIEVuc3VyZSBIaW50IGZpZWxkIGlzIGluIGEgc2hhcGUgd2UgZXhwZWN0OlxuICogLSBvYmplY3Qgb2YgaW5kZXggbmFtZXMgbWFwcGluZyB0byAxIG9yIC0xXG4gKiAtIGp1c3QgYW4gaW5kZXggbmFtZVxuICogQGludGVybmFsXG4gKi9cbmZ1bmN0aW9uIG5vcm1hbGl6ZUhpbnRGaWVsZChoaW50KSB7XG4gICAgbGV0IGZpbmFsSGludCA9IHVuZGVmaW5lZDtcbiAgICBpZiAodHlwZW9mIGhpbnQgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIGZpbmFsSGludCA9IGhpbnQ7XG4gICAgfVxuICAgIGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoaGludCkpIHtcbiAgICAgICAgZmluYWxIaW50ID0ge307XG4gICAgICAgIGhpbnQuZm9yRWFjaChwYXJhbSA9PiB7XG4gICAgICAgICAgICBmaW5hbEhpbnRbcGFyYW1dID0gMTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGVsc2UgaWYgKGhpbnQgIT0gbnVsbCAmJiB0eXBlb2YgaGludCA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgZmluYWxIaW50ID0ge307XG4gICAgICAgIGZvciAoY29uc3QgbmFtZSBpbiBoaW50KSB7XG4gICAgICAgICAgICBmaW5hbEhpbnRbbmFtZV0gPSBoaW50W25hbWVdO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmaW5hbEhpbnQ7XG59XG5leHBvcnRzLm5vcm1hbGl6ZUhpbnRGaWVsZCA9IG5vcm1hbGl6ZUhpbnRGaWVsZDtcbmNvbnN0IFRPX1NUUklORyA9IChvYmplY3QpID0+IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvYmplY3QpO1xuLyoqXG4gKiBDaGVja3MgaWYgYXJnIGlzIGFuIE9iamVjdDpcbiAqIC0gKipOT1RFKio6IHRoZSBjaGVjayBpcyBiYXNlZCBvbiB0aGUgYFtTeW1ib2wudG9TdHJpbmdUYWddKCkgPT09ICdPYmplY3QnYFxuICogQGludGVybmFsXG4gKi9cbmZ1bmN0aW9uIGlzT2JqZWN0KGFyZykge1xuICAgIHJldHVybiAnW29iamVjdCBPYmplY3RdJyA9PT0gVE9fU1RSSU5HKGFyZyk7XG59XG5leHBvcnRzLmlzT2JqZWN0ID0gaXNPYmplY3Q7XG4vKiogQGludGVybmFsICovXG5mdW5jdGlvbiBtZXJnZU9wdGlvbnModGFyZ2V0LCBzb3VyY2UpIHtcbiAgICByZXR1cm4geyAuLi50YXJnZXQsIC4uLnNvdXJjZSB9O1xufVxuZXhwb3J0cy5tZXJnZU9wdGlvbnMgPSBtZXJnZU9wdGlvbnM7XG4vKiogQGludGVybmFsICovXG5mdW5jdGlvbiBmaWx0ZXJPcHRpb25zKG9wdGlvbnMsIG5hbWVzKSB7XG4gICAgY29uc3QgZmlsdGVyT3B0aW9ucyA9IHt9O1xuICAgIGZvciAoY29uc3QgbmFtZSBpbiBvcHRpb25zKSB7XG4gICAgICAgIGlmIChuYW1lcy5pbmNsdWRlcyhuYW1lKSkge1xuICAgICAgICAgICAgZmlsdGVyT3B0aW9uc1tuYW1lXSA9IG9wdGlvbnNbbmFtZV07XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gRmlsdGVyZWQgb3B0aW9uc1xuICAgIHJldHVybiBmaWx0ZXJPcHRpb25zO1xufVxuZXhwb3J0cy5maWx0ZXJPcHRpb25zID0gZmlsdGVyT3B0aW9ucztcbi8qKlxuICogQXBwbGllcyByZXRyeVdyaXRlczogdHJ1ZSB0byBhIGNvbW1hbmQgaWYgcmV0cnlXcml0ZXMgaXMgc2V0IG9uIHRoZSBjb21tYW5kJ3MgZGF0YWJhc2UuXG4gKiBAaW50ZXJuYWxcbiAqXG4gKiBAcGFyYW0gdGFyZ2V0IC0gVGhlIHRhcmdldCBjb21tYW5kIHRvIHdoaWNoIHdlIHdpbGwgYXBwbHkgcmV0cnlXcml0ZXMuXG4gKiBAcGFyYW0gZGIgLSBUaGUgZGF0YWJhc2UgZnJvbSB3aGljaCB3ZSBjYW4gaW5oZXJpdCBhIHJldHJ5V3JpdGVzIHZhbHVlLlxuICovXG5mdW5jdGlvbiBhcHBseVJldHJ5YWJsZVdyaXRlcyh0YXJnZXQsIGRiKSB7XG4gICAgaWYgKGRiICYmIGRiLnMub3B0aW9ucz8ucmV0cnlXcml0ZXMpIHtcbiAgICAgICAgdGFyZ2V0LnJldHJ5V3JpdGVzID0gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIHRhcmdldDtcbn1cbmV4cG9ydHMuYXBwbHlSZXRyeWFibGVXcml0ZXMgPSBhcHBseVJldHJ5YWJsZVdyaXRlcztcbi8qKlxuICogQXBwbGllcyBhIHdyaXRlIGNvbmNlcm4gdG8gYSBjb21tYW5kIGJhc2VkIG9uIHdlbGwgZGVmaW5lZCBpbmhlcml0YW5jZSBydWxlcywgb3B0aW9uYWxseVxuICogZGV0ZWN0aW5nIHN1cHBvcnQgZm9yIHRoZSB3cml0ZSBjb25jZXJuIGluIHRoZSBmaXJzdCBwbGFjZS5cbiAqIEBpbnRlcm5hbFxuICpcbiAqIEBwYXJhbSB0YXJnZXQgLSB0aGUgdGFyZ2V0IGNvbW1hbmQgd2Ugd2lsbCBiZSBhcHBseWluZyB0aGUgd3JpdGUgY29uY2VybiB0b1xuICogQHBhcmFtIHNvdXJjZXMgLSBzb3VyY2VzIHdoZXJlIHdlIGNhbiBpbmhlcml0IGRlZmF1bHQgd3JpdGUgY29uY2VybnMgZnJvbVxuICogQHBhcmFtIG9wdGlvbnMgLSBvcHRpb25hbCBzZXR0aW5ncyBwYXNzZWQgaW50byBhIGNvbW1hbmQgZm9yIHdyaXRlIGNvbmNlcm4gb3ZlcnJpZGVzXG4gKi9cbi8qKlxuICogQ2hlY2tzIGlmIGEgZ2l2ZW4gdmFsdWUgaXMgYSBQcm9taXNlXG4gKlxuICogQHR5cGVQYXJhbSBUIC0gVGhlIHJlc29sdXRpb24gdHlwZSBvZiB0aGUgcG9zc2libGUgcHJvbWlzZVxuICogQHBhcmFtIHZhbHVlIC0gQW4gb2JqZWN0IHRoYXQgY291bGQgYmUgYSBwcm9taXNlXG4gKiBAcmV0dXJucyB0cnVlIGlmIHRoZSBwcm92aWRlZCB2YWx1ZSBpcyBhIFByb21pc2VcbiAqL1xuZnVuY3Rpb24gaXNQcm9taXNlTGlrZSh2YWx1ZSkge1xuICAgIHJldHVybiAhIXZhbHVlICYmIHR5cGVvZiB2YWx1ZS50aGVuID09PSAnZnVuY3Rpb24nO1xufVxuZXhwb3J0cy5pc1Byb21pc2VMaWtlID0gaXNQcm9taXNlTGlrZTtcbi8qKlxuICogQXBwbGllcyBjb2xsYXRpb24gdG8gYSBnaXZlbiBjb21tYW5kLlxuICogQGludGVybmFsXG4gKlxuICogQHBhcmFtIGNvbW1hbmQgLSB0aGUgY29tbWFuZCBvbiB3aGljaCB0byBhcHBseSBjb2xsYXRpb25cbiAqIEBwYXJhbSB0YXJnZXQgLSB0YXJnZXQgb2YgY29tbWFuZFxuICogQHBhcmFtIG9wdGlvbnMgLSBvcHRpb25zIGNvbnRhaW5pbmcgY29sbGF0aW9uIHNldHRpbmdzXG4gKi9cbmZ1bmN0aW9uIGRlY29yYXRlV2l0aENvbGxhdGlvbihjb21tYW5kLCB0YXJnZXQsIG9wdGlvbnMpIHtcbiAgICBjb25zdCBjYXBhYmlsaXRpZXMgPSBnZXRUb3BvbG9neSh0YXJnZXQpLmNhcGFiaWxpdGllcztcbiAgICBpZiAob3B0aW9ucy5jb2xsYXRpb24gJiYgdHlwZW9mIG9wdGlvbnMuY29sbGF0aW9uID09PSAnb2JqZWN0Jykge1xuICAgICAgICBpZiAoY2FwYWJpbGl0aWVzICYmIGNhcGFiaWxpdGllcy5jb21tYW5kc1Rha2VDb2xsYXRpb24pIHtcbiAgICAgICAgICAgIGNvbW1hbmQuY29sbGF0aW9uID0gb3B0aW9ucy5jb2xsYXRpb247XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0NvbXBhdGliaWxpdHlFcnJvcihgQ3VycmVudCB0b3BvbG9neSBkb2VzIG5vdCBzdXBwb3J0IGNvbGxhdGlvbmApO1xuICAgICAgICB9XG4gICAgfVxufVxuZXhwb3J0cy5kZWNvcmF0ZVdpdGhDb2xsYXRpb24gPSBkZWNvcmF0ZVdpdGhDb2xsYXRpb247XG4vKipcbiAqIEFwcGxpZXMgYSByZWFkIGNvbmNlcm4gdG8gYSBnaXZlbiBjb21tYW5kLlxuICogQGludGVybmFsXG4gKlxuICogQHBhcmFtIGNvbW1hbmQgLSB0aGUgY29tbWFuZCBvbiB3aGljaCB0byBhcHBseSB0aGUgcmVhZCBjb25jZXJuXG4gKiBAcGFyYW0gY29sbCAtIHRoZSBwYXJlbnQgY29sbGVjdGlvbiBvZiB0aGUgb3BlcmF0aW9uIGNhbGxpbmcgdGhpcyBtZXRob2RcbiAqL1xuZnVuY3Rpb24gZGVjb3JhdGVXaXRoUmVhZENvbmNlcm4oY29tbWFuZCwgY29sbCwgb3B0aW9ucykge1xuICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMuc2Vzc2lvbiAmJiBvcHRpb25zLnNlc3Npb24uaW5UcmFuc2FjdGlvbigpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgcmVhZENvbmNlcm4gPSBPYmplY3QuYXNzaWduKHt9LCBjb21tYW5kLnJlYWRDb25jZXJuIHx8IHt9KTtcbiAgICBpZiAoY29sbC5zLnJlYWRDb25jZXJuKSB7XG4gICAgICAgIE9iamVjdC5hc3NpZ24ocmVhZENvbmNlcm4sIGNvbGwucy5yZWFkQ29uY2Vybik7XG4gICAgfVxuICAgIGlmIChPYmplY3Qua2V5cyhyZWFkQ29uY2VybikubGVuZ3RoID4gMCkge1xuICAgICAgICBPYmplY3QuYXNzaWduKGNvbW1hbmQsIHsgcmVhZENvbmNlcm46IHJlYWRDb25jZXJuIH0pO1xuICAgIH1cbn1cbmV4cG9ydHMuZGVjb3JhdGVXaXRoUmVhZENvbmNlcm4gPSBkZWNvcmF0ZVdpdGhSZWFkQ29uY2Vybjtcbi8qKlxuICogQXBwbGllcyBhbiBleHBsYWluIHRvIGEgZ2l2ZW4gY29tbWFuZC5cbiAqIEBpbnRlcm5hbFxuICpcbiAqIEBwYXJhbSBjb21tYW5kIC0gdGhlIGNvbW1hbmQgb24gd2hpY2ggdG8gYXBwbHkgdGhlIGV4cGxhaW5cbiAqIEBwYXJhbSBvcHRpb25zIC0gdGhlIG9wdGlvbnMgY29udGFpbmluZyB0aGUgZXhwbGFpbiB2ZXJib3NpdHlcbiAqL1xuZnVuY3Rpb24gZGVjb3JhdGVXaXRoRXhwbGFpbihjb21tYW5kLCBleHBsYWluKSB7XG4gICAgaWYgKGNvbW1hbmQuZXhwbGFpbikge1xuICAgICAgICByZXR1cm4gY29tbWFuZDtcbiAgICB9XG4gICAgcmV0dXJuIHsgZXhwbGFpbjogY29tbWFuZCwgdmVyYm9zaXR5OiBleHBsYWluLnZlcmJvc2l0eSB9O1xufVxuZXhwb3J0cy5kZWNvcmF0ZVdpdGhFeHBsYWluID0gZGVjb3JhdGVXaXRoRXhwbGFpbjtcbi8qKlxuICogQSBoZWxwZXIgZnVuY3Rpb24gdG8gZ2V0IHRoZSB0b3BvbG9neSBmcm9tIGEgZ2l2ZW4gcHJvdmlkZXIuIFRocm93c1xuICogaWYgdGhlIHRvcG9sb2d5IGNhbm5vdCBiZSBmb3VuZC5cbiAqIEB0aHJvd3MgTW9uZ29Ob3RDb25uZWN0ZWRFcnJvclxuICogQGludGVybmFsXG4gKi9cbmZ1bmN0aW9uIGdldFRvcG9sb2d5KHByb3ZpZGVyKSB7XG4gICAgLy8gTW9uZ29DbGllbnQgb3IgQ2xpZW50U2Vzc2lvbiBvciBBYnN0cmFjdEN1cnNvclxuICAgIGlmICgndG9wb2xvZ3knIGluIHByb3ZpZGVyICYmIHByb3ZpZGVyLnRvcG9sb2d5KSB7XG4gICAgICAgIHJldHVybiBwcm92aWRlci50b3BvbG9neTtcbiAgICB9XG4gICAgZWxzZSBpZiAoJ2NsaWVudCcgaW4gcHJvdmlkZXIgJiYgcHJvdmlkZXIuY2xpZW50LnRvcG9sb2d5KSB7XG4gICAgICAgIHJldHVybiBwcm92aWRlci5jbGllbnQudG9wb2xvZ3k7XG4gICAgfVxuICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvTm90Q29ubmVjdGVkRXJyb3IoJ01vbmdvQ2xpZW50IG11c3QgYmUgY29ubmVjdGVkIHRvIHBlcmZvcm0gdGhpcyBvcGVyYXRpb24nKTtcbn1cbmV4cG9ydHMuZ2V0VG9wb2xvZ3kgPSBnZXRUb3BvbG9neTtcbi8qKiBAaW50ZXJuYWwgKi9cbmZ1bmN0aW9uIG5zKG5zKSB7XG4gICAgcmV0dXJuIE1vbmdvREJOYW1lc3BhY2UuZnJvbVN0cmluZyhucyk7XG59XG5leHBvcnRzLm5zID0gbnM7XG4vKiogQHB1YmxpYyAqL1xuY2xhc3MgTW9uZ29EQk5hbWVzcGFjZSB7XG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgbmFtZXNwYWNlIG9iamVjdFxuICAgICAqXG4gICAgICogQHBhcmFtIGRiIC0gZGF0YWJhc2UgbmFtZVxuICAgICAqIEBwYXJhbSBjb2xsZWN0aW9uIC0gY29sbGVjdGlvbiBuYW1lXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoZGIsIGNvbGxlY3Rpb24pIHtcbiAgICAgICAgdGhpcy5kYiA9IGRiO1xuICAgICAgICB0aGlzLmNvbGxlY3Rpb24gPSBjb2xsZWN0aW9uO1xuICAgICAgICB0aGlzLmNvbGxlY3Rpb24gPSBjb2xsZWN0aW9uID09PSAnJyA/IHVuZGVmaW5lZCA6IGNvbGxlY3Rpb247XG4gICAgfVxuICAgIHRvU3RyaW5nKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jb2xsZWN0aW9uID8gYCR7dGhpcy5kYn0uJHt0aGlzLmNvbGxlY3Rpb259YCA6IHRoaXMuZGI7XG4gICAgfVxuICAgIHdpdGhDb2xsZWN0aW9uKGNvbGxlY3Rpb24pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBNb25nb0RCQ29sbGVjdGlvbk5hbWVzcGFjZSh0aGlzLmRiLCBjb2xsZWN0aW9uKTtcbiAgICB9XG4gICAgc3RhdGljIGZyb21TdHJpbmcobmFtZXNwYWNlKSB7XG4gICAgICAgIGlmICh0eXBlb2YgbmFtZXNwYWNlICE9PSAnc3RyaW5nJyB8fCBuYW1lc3BhY2UgPT09ICcnKSB7XG4gICAgICAgICAgICAvLyBUT0RPKE5PREUtMzQ4Myk6IFJlcGxhY2Ugd2l0aCBNb25nb05hbWVzcGFjZUVycm9yXG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1J1bnRpbWVFcnJvcihgQ2Fubm90IHBhcnNlIG5hbWVzcGFjZSBmcm9tIFwiJHtuYW1lc3BhY2V9XCJgKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBbZGIsIC4uLmNvbGxlY3Rpb25QYXJ0c10gPSBuYW1lc3BhY2Uuc3BsaXQoJy4nKTtcbiAgICAgICAgY29uc3QgY29sbGVjdGlvbiA9IGNvbGxlY3Rpb25QYXJ0cy5qb2luKCcuJyk7XG4gICAgICAgIHJldHVybiBuZXcgTW9uZ29EQk5hbWVzcGFjZShkYiwgY29sbGVjdGlvbiA9PT0gJycgPyB1bmRlZmluZWQgOiBjb2xsZWN0aW9uKTtcbiAgICB9XG59XG5leHBvcnRzLk1vbmdvREJOYW1lc3BhY2UgPSBNb25nb0RCTmFtZXNwYWNlO1xuLyoqXG4gKiBAcHVibGljXG4gKlxuICogQSBjbGFzcyByZXByZXNlbnRpbmcgYSBjb2xsZWN0aW9uJ3MgbmFtZXNwYWNlLiAgVGhpcyBjbGFzcyBlbmZvcmNlcyAodGhyb3VnaCBUeXBlc2NyaXB0KSB0aGF0XG4gKiB0aGUgYGNvbGxlY3Rpb25gIHBvcnRpb24gb2YgdGhlIG5hbWVzcGFjZSBpcyBkZWZpbmVkIGFuZCBzaG91bGQgb25seSBiZVxuICogdXNlZCBpbiBzY2VuYXJpb3Mgd2hlcmUgdGhpcyBjYW4gYmUgZ3VhcmFudGVlZC5cbiAqL1xuY2xhc3MgTW9uZ29EQkNvbGxlY3Rpb25OYW1lc3BhY2UgZXh0ZW5kcyBNb25nb0RCTmFtZXNwYWNlIHtcbiAgICBjb25zdHJ1Y3RvcihkYiwgY29sbGVjdGlvbikge1xuICAgICAgICBzdXBlcihkYiwgY29sbGVjdGlvbik7XG4gICAgICAgIHRoaXMuY29sbGVjdGlvbiA9IGNvbGxlY3Rpb247XG4gICAgfVxufVxuZXhwb3J0cy5Nb25nb0RCQ29sbGVjdGlvbk5hbWVzcGFjZSA9IE1vbmdvREJDb2xsZWN0aW9uTmFtZXNwYWNlO1xuLyoqIEBpbnRlcm5hbCAqL1xuZnVuY3Rpb24qIG1ha2VDb3VudGVyKHNlZWQgPSAwKSB7XG4gICAgbGV0IGNvdW50ID0gc2VlZDtcbiAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgICBjb25zdCBuZXdDb3VudCA9IGNvdW50O1xuICAgICAgICBjb3VudCArPSAxO1xuICAgICAgICB5aWVsZCBuZXdDb3VudDtcbiAgICB9XG59XG5leHBvcnRzLm1ha2VDb3VudGVyID0gbWFrZUNvdW50ZXI7XG5mdW5jdGlvbiBtYXliZUNhbGxiYWNrKHByb21pc2VGbiwgY2FsbGJhY2spIHtcbiAgICBjb25zdCBwcm9taXNlID0gcHJvbWlzZUZuKCk7XG4gICAgaWYgKGNhbGxiYWNrID09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIHByb21pc2U7XG4gICAgfVxuICAgIHByb21pc2UudGhlbihyZXN1bHQgPT4gY2FsbGJhY2sodW5kZWZpbmVkLCByZXN1bHQpLCBlcnJvciA9PiBjYWxsYmFjayhlcnJvcikpO1xuICAgIHJldHVybjtcbn1cbmV4cG9ydHMubWF5YmVDYWxsYmFjayA9IG1heWJlQ2FsbGJhY2s7XG4vKiogQGludGVybmFsICovXG5mdW5jdGlvbiBkYXRhYmFzZU5hbWVzcGFjZShucykge1xuICAgIHJldHVybiBucy5zcGxpdCgnLicpWzBdO1xufVxuZXhwb3J0cy5kYXRhYmFzZU5hbWVzcGFjZSA9IGRhdGFiYXNlTmFtZXNwYWNlO1xuLyoqXG4gKiBTeW5jaHJvbm91c2x5IEdlbmVyYXRlIGEgVVVJRHY0XG4gKiBAaW50ZXJuYWxcbiAqL1xuZnVuY3Rpb24gdXVpZFY0KCkge1xuICAgIGNvbnN0IHJlc3VsdCA9IGNyeXB0by5yYW5kb21CeXRlcygxNik7XG4gICAgcmVzdWx0WzZdID0gKHJlc3VsdFs2XSAmIDB4MGYpIHwgMHg0MDtcbiAgICByZXN1bHRbOF0gPSAocmVzdWx0WzhdICYgMHgzZikgfCAweDgwO1xuICAgIHJldHVybiByZXN1bHQ7XG59XG5leHBvcnRzLnV1aWRWNCA9IHV1aWRWNDtcbi8qKlxuICogQSBoZWxwZXIgZnVuY3Rpb24gZm9yIGRldGVybWluaW5nIGBtYXhXaXJlVmVyc2lvbmAgYmV0d2VlbiBsZWdhY3kgYW5kIG5ldyB0b3BvbG9neSBpbnN0YW5jZXNcbiAqIEBpbnRlcm5hbFxuICovXG5mdW5jdGlvbiBtYXhXaXJlVmVyc2lvbih0b3BvbG9neU9yU2VydmVyKSB7XG4gICAgaWYgKHRvcG9sb2d5T3JTZXJ2ZXIpIHtcbiAgICAgICAgaWYgKHRvcG9sb2d5T3JTZXJ2ZXIubG9hZEJhbGFuY2VkKSB7XG4gICAgICAgICAgICAvLyBTaW5jZSB3ZSBkbyBub3QgaGF2ZSBhIG1vbml0b3IsIHdlIGFzc3VtZSB0aGUgbG9hZCBiYWxhbmNlZCBzZXJ2ZXIgaXMgYWx3YXlzXG4gICAgICAgICAgICAvLyBwb2ludGVkIGF0IHRoZSBsYXRlc3QgbW9uZ29kYiB2ZXJzaW9uLiBUaGVyZSBpcyBhIHJpc2sgdGhhdCBmb3Igb24tcHJlbVxuICAgICAgICAgICAgLy8gZGVwbG95bWVudHMgdGhhdCBkb24ndCB1cGdyYWRlIGltbWVkaWF0ZWx5IHRoYXQgdGhpcyBjb3VsZCBhbGVydCB0byB0aGVcbiAgICAgICAgICAgIC8vIGFwcGxpY2F0aW9uIHRoYXQgYSBmZWF0dXJlIGlzIGF2YWlsYWJsZSB0aGF0IGlzIGFjdHVhbGx5IG5vdC5cbiAgICAgICAgICAgIHJldHVybiBjb25zdGFudHNfMS5NQVhfU1VQUE9SVEVEX1dJUkVfVkVSU0lPTjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodG9wb2xvZ3lPclNlcnZlci5oZWxsbykge1xuICAgICAgICAgICAgcmV0dXJuIHRvcG9sb2d5T3JTZXJ2ZXIuaGVsbG8ubWF4V2lyZVZlcnNpb247XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCdsYXN0SGVsbG8nIGluIHRvcG9sb2d5T3JTZXJ2ZXIgJiYgdHlwZW9mIHRvcG9sb2d5T3JTZXJ2ZXIubGFzdEhlbGxvID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICBjb25zdCBsYXN0SGVsbG8gPSB0b3BvbG9neU9yU2VydmVyLmxhc3RIZWxsbygpO1xuICAgICAgICAgICAgaWYgKGxhc3RIZWxsbykge1xuICAgICAgICAgICAgICAgIHJldHVybiBsYXN0SGVsbG8ubWF4V2lyZVZlcnNpb247XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRvcG9sb2d5T3JTZXJ2ZXIuZGVzY3JpcHRpb24gJiZcbiAgICAgICAgICAgICdtYXhXaXJlVmVyc2lvbicgaW4gdG9wb2xvZ3lPclNlcnZlci5kZXNjcmlwdGlvbiAmJlxuICAgICAgICAgICAgdG9wb2xvZ3lPclNlcnZlci5kZXNjcmlwdGlvbi5tYXhXaXJlVmVyc2lvbiAhPSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gdG9wb2xvZ3lPclNlcnZlci5kZXNjcmlwdGlvbi5tYXhXaXJlVmVyc2lvbjtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gMDtcbn1cbmV4cG9ydHMubWF4V2lyZVZlcnNpb24gPSBtYXhXaXJlVmVyc2lvbjtcbi8qKlxuICogQXBwbGllcyB0aGUgZnVuY3Rpb24gYGVhY2hGbmAgdG8gZWFjaCBpdGVtIGluIGBhcnJgLCBpbiBwYXJhbGxlbC5cbiAqIEBpbnRlcm5hbFxuICpcbiAqIEBwYXJhbSBhcnIgLSBBbiBhcnJheSBvZiBpdGVtcyB0byBhc3luY2hyb25vdXNseSBpdGVyYXRlIG92ZXJcbiAqIEBwYXJhbSBlYWNoRm4gLSBBIGZ1bmN0aW9uIHRvIGNhbGwgb24gZWFjaCBpdGVtIG9mIHRoZSBhcnJheS4gVGhlIGNhbGxiYWNrIHNpZ25hdHVyZSBpcyBgKGl0ZW0sIGNhbGxiYWNrKWAsIHdoZXJlIHRoZSBjYWxsYmFjayBpbmRpY2F0ZXMgaXRlcmF0aW9uIGlzIGNvbXBsZXRlLlxuICogQHBhcmFtIGNhbGxiYWNrIC0gVGhlIGNhbGxiYWNrIGNhbGxlZCBhZnRlciBldmVyeSBpdGVtIGhhcyBiZWVuIGl0ZXJhdGVkXG4gKi9cbmZ1bmN0aW9uIGVhY2hBc3luYyhhcnIsIGVhY2hGbiwgY2FsbGJhY2spIHtcbiAgICBhcnIgPSBhcnIgfHwgW107XG4gICAgbGV0IGlkeCA9IDA7XG4gICAgbGV0IGF3YWl0aW5nID0gMDtcbiAgICBmb3IgKGlkeCA9IDA7IGlkeCA8IGFyci5sZW5ndGg7ICsraWR4KSB7XG4gICAgICAgIGF3YWl0aW5nKys7XG4gICAgICAgIGVhY2hGbihhcnJbaWR4XSwgZWFjaENhbGxiYWNrKTtcbiAgICB9XG4gICAgaWYgKGF3YWl0aW5nID09PSAwKSB7XG4gICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgZnVuY3Rpb24gZWFjaENhbGxiYWNrKGVycikge1xuICAgICAgICBhd2FpdGluZy0tO1xuICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICBjYWxsYmFjayhlcnIpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpZHggPT09IGFyci5sZW5ndGggJiYgYXdhaXRpbmcgPD0gMCkge1xuICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbmV4cG9ydHMuZWFjaEFzeW5jID0gZWFjaEFzeW5jO1xuLyoqIEBpbnRlcm5hbCAqL1xuZnVuY3Rpb24gYXJyYXlTdHJpY3RFcXVhbChhcnIsIGFycjIpIHtcbiAgICBpZiAoIUFycmF5LmlzQXJyYXkoYXJyKSB8fCAhQXJyYXkuaXNBcnJheShhcnIyKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiBhcnIubGVuZ3RoID09PSBhcnIyLmxlbmd0aCAmJiBhcnIuZXZlcnkoKGVsdCwgaWR4KSA9PiBlbHQgPT09IGFycjJbaWR4XSk7XG59XG5leHBvcnRzLmFycmF5U3RyaWN0RXF1YWwgPSBhcnJheVN0cmljdEVxdWFsO1xuLyoqIEBpbnRlcm5hbCAqL1xuZnVuY3Rpb24gZXJyb3JTdHJpY3RFcXVhbChsaHMsIHJocykge1xuICAgIGlmIChsaHMgPT09IHJocykge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKCFsaHMgfHwgIXJocykge1xuICAgICAgICByZXR1cm4gbGhzID09PSByaHM7XG4gICAgfVxuICAgIGlmICgobGhzID09IG51bGwgJiYgcmhzICE9IG51bGwpIHx8IChsaHMgIT0gbnVsbCAmJiByaHMgPT0gbnVsbCkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpZiAobGhzLmNvbnN0cnVjdG9yLm5hbWUgIT09IHJocy5jb25zdHJ1Y3Rvci5uYW1lKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgaWYgKGxocy5tZXNzYWdlICE9PSByaHMubWVzc2FnZSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5lcnJvclN0cmljdEVxdWFsID0gZXJyb3JTdHJpY3RFcXVhbDtcbi8qKiBAaW50ZXJuYWwgKi9cbmZ1bmN0aW9uIG1ha2VTdGF0ZU1hY2hpbmUoc3RhdGVUYWJsZSkge1xuICAgIHJldHVybiBmdW5jdGlvbiBzdGF0ZVRyYW5zaXRpb24odGFyZ2V0LCBuZXdTdGF0ZSkge1xuICAgICAgICBjb25zdCBsZWdhbFN0YXRlcyA9IHN0YXRlVGFibGVbdGFyZ2V0LnMuc3RhdGVdO1xuICAgICAgICBpZiAobGVnYWxTdGF0ZXMgJiYgbGVnYWxTdGF0ZXMuaW5kZXhPZihuZXdTdGF0ZSkgPCAwKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1J1bnRpbWVFcnJvcihgaWxsZWdhbCBzdGF0ZSB0cmFuc2l0aW9uIGZyb20gWyR7dGFyZ2V0LnMuc3RhdGV9XSA9PiBbJHtuZXdTdGF0ZX1dLCBhbGxvd2VkOiBbJHtsZWdhbFN0YXRlc31dYCk7XG4gICAgICAgIH1cbiAgICAgICAgdGFyZ2V0LmVtaXQoJ3N0YXRlQ2hhbmdlZCcsIHRhcmdldC5zLnN0YXRlLCBuZXdTdGF0ZSk7XG4gICAgICAgIHRhcmdldC5zLnN0YXRlID0gbmV3U3RhdGU7XG4gICAgfTtcbn1cbmV4cG9ydHMubWFrZVN0YXRlTWFjaGluZSA9IG1ha2VTdGF0ZU1hY2hpbmU7XG4vKiogQGludGVybmFsICovXG5mdW5jdGlvbiBub3coKSB7XG4gICAgY29uc3QgaHJ0aW1lID0gcHJvY2Vzcy5ocnRpbWUoKTtcbiAgICByZXR1cm4gTWF0aC5mbG9vcihocnRpbWVbMF0gKiAxMDAwICsgaHJ0aW1lWzFdIC8gMTAwMDAwMCk7XG59XG5leHBvcnRzLm5vdyA9IG5vdztcbi8qKiBAaW50ZXJuYWwgKi9cbmZ1bmN0aW9uIGNhbGN1bGF0ZUR1cmF0aW9uSW5NcyhzdGFydGVkKSB7XG4gICAgaWYgKHR5cGVvZiBzdGFydGVkICE9PSAnbnVtYmVyJykge1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdOdW1lcmljIHZhbHVlIHJlcXVpcmVkIHRvIGNhbGN1bGF0ZSBkdXJhdGlvbicpO1xuICAgIH1cbiAgICBjb25zdCBlbGFwc2VkID0gbm93KCkgLSBzdGFydGVkO1xuICAgIHJldHVybiBlbGFwc2VkIDwgMCA/IDAgOiBlbGFwc2VkO1xufVxuZXhwb3J0cy5jYWxjdWxhdGVEdXJhdGlvbkluTXMgPSBjYWxjdWxhdGVEdXJhdGlvbkluTXM7XG4vKiogQGludGVybmFsICovXG5mdW5jdGlvbiBoYXNBdG9taWNPcGVyYXRvcnMoZG9jKSB7XG4gICAgaWYgKEFycmF5LmlzQXJyYXkoZG9jKSkge1xuICAgICAgICBmb3IgKGNvbnN0IGRvY3VtZW50IG9mIGRvYykge1xuICAgICAgICAgICAgaWYgKGhhc0F0b21pY09wZXJhdG9ycyhkb2N1bWVudCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyhkb2MpO1xuICAgIHJldHVybiBrZXlzLmxlbmd0aCA+IDAgJiYga2V5c1swXVswXSA9PT0gJyQnO1xufVxuZXhwb3J0cy5oYXNBdG9taWNPcGVyYXRvcnMgPSBoYXNBdG9taWNPcGVyYXRvcnM7XG4vKipcbiAqIE1lcmdlIGluaGVyaXRlZCBwcm9wZXJ0aWVzIGZyb20gcGFyZW50IGludG8gb3B0aW9ucywgcHJpb3JpdGl6aW5nIHZhbHVlcyBmcm9tIG9wdGlvbnMsXG4gKiB0aGVuIHZhbHVlcyBmcm9tIHBhcmVudC5cbiAqIEBpbnRlcm5hbFxuICovXG5mdW5jdGlvbiByZXNvbHZlT3B0aW9ucyhwYXJlbnQsIG9wdGlvbnMpIHtcbiAgICBjb25zdCByZXN1bHQgPSBPYmplY3QuYXNzaWduKHt9LCBvcHRpb25zLCAoMCwgYnNvbl8xLnJlc29sdmVCU09OT3B0aW9ucykob3B0aW9ucywgcGFyZW50KSk7XG4gICAgLy8gVXNlcnMgY2Fubm90IHBhc3MgYSByZWFkQ29uY2Vybi93cml0ZUNvbmNlcm4gdG8gb3BlcmF0aW9ucyBpbiBhIHRyYW5zYWN0aW9uXG4gICAgY29uc3Qgc2Vzc2lvbiA9IG9wdGlvbnM/LnNlc3Npb247XG4gICAgaWYgKCFzZXNzaW9uPy5pblRyYW5zYWN0aW9uKCkpIHtcbiAgICAgICAgY29uc3QgcmVhZENvbmNlcm4gPSByZWFkX2NvbmNlcm5fMS5SZWFkQ29uY2Vybi5mcm9tT3B0aW9ucyhvcHRpb25zKSA/PyBwYXJlbnQ/LnJlYWRDb25jZXJuO1xuICAgICAgICBpZiAocmVhZENvbmNlcm4pIHtcbiAgICAgICAgICAgIHJlc3VsdC5yZWFkQ29uY2VybiA9IHJlYWRDb25jZXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHdyaXRlQ29uY2VybiA9IHdyaXRlX2NvbmNlcm5fMS5Xcml0ZUNvbmNlcm4uZnJvbU9wdGlvbnMob3B0aW9ucykgPz8gcGFyZW50Py53cml0ZUNvbmNlcm47XG4gICAgICAgIGlmICh3cml0ZUNvbmNlcm4pIHtcbiAgICAgICAgICAgIHJlc3VsdC53cml0ZUNvbmNlcm4gPSB3cml0ZUNvbmNlcm47XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29uc3QgcmVhZFByZWZlcmVuY2UgPSByZWFkX3ByZWZlcmVuY2VfMS5SZWFkUHJlZmVyZW5jZS5mcm9tT3B0aW9ucyhvcHRpb25zKSA/PyBwYXJlbnQ/LnJlYWRQcmVmZXJlbmNlO1xuICAgIGlmIChyZWFkUHJlZmVyZW5jZSkge1xuICAgICAgICByZXN1bHQucmVhZFByZWZlcmVuY2UgPSByZWFkUHJlZmVyZW5jZTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbn1cbmV4cG9ydHMucmVzb2x2ZU9wdGlvbnMgPSByZXNvbHZlT3B0aW9ucztcbmZ1bmN0aW9uIGlzU3VwZXJzZXQoc2V0LCBzdWJzZXQpIHtcbiAgICBzZXQgPSBBcnJheS5pc0FycmF5KHNldCkgPyBuZXcgU2V0KHNldCkgOiBzZXQ7XG4gICAgc3Vic2V0ID0gQXJyYXkuaXNBcnJheShzdWJzZXQpID8gbmV3IFNldChzdWJzZXQpIDogc3Vic2V0O1xuICAgIGZvciAoY29uc3QgZWxlbSBvZiBzdWJzZXQpIHtcbiAgICAgICAgaWYgKCFzZXQuaGFzKGVsZW0pKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLmlzU3VwZXJzZXQgPSBpc1N1cGVyc2V0O1xuLyoqXG4gKiBDaGVja3MgaWYgdGhlIGRvY3VtZW50IGlzIGEgSGVsbG8gcmVxdWVzdFxuICogQGludGVybmFsXG4gKi9cbmZ1bmN0aW9uIGlzSGVsbG8oZG9jKSB7XG4gICAgcmV0dXJuIGRvY1tjb25zdGFudHNfMi5MRUdBQ1lfSEVMTE9fQ09NTUFORF0gfHwgZG9jLmhlbGxvID8gdHJ1ZSA6IGZhbHNlO1xufVxuZXhwb3J0cy5pc0hlbGxvID0gaXNIZWxsbztcbi8qKiBSZXR1cm5zIHRoZSBpdGVtcyB0aGF0IGFyZSB1bmlxdWVseSBpbiBzZXRBICovXG5mdW5jdGlvbiBzZXREaWZmZXJlbmNlKHNldEEsIHNldEIpIHtcbiAgICBjb25zdCBkaWZmZXJlbmNlID0gbmV3IFNldChzZXRBKTtcbiAgICBmb3IgKGNvbnN0IGVsZW0gb2Ygc2V0Qikge1xuICAgICAgICBkaWZmZXJlbmNlLmRlbGV0ZShlbGVtKTtcbiAgICB9XG4gICAgcmV0dXJuIGRpZmZlcmVuY2U7XG59XG5leHBvcnRzLnNldERpZmZlcmVuY2UgPSBzZXREaWZmZXJlbmNlO1xuY29uc3QgSEFTX09XTiA9IChvYmplY3QsIHByb3ApID0+IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3ApO1xuZnVuY3Rpb24gaXNSZWNvcmQodmFsdWUsIHJlcXVpcmVkS2V5cyA9IHVuZGVmaW5lZCkge1xuICAgIGlmICghaXNPYmplY3QodmFsdWUpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uc3QgY3RvciA9IHZhbHVlLmNvbnN0cnVjdG9yO1xuICAgIGlmIChjdG9yICYmIGN0b3IucHJvdG90eXBlKSB7XG4gICAgICAgIGlmICghaXNPYmplY3QoY3Rvci5wcm90b3R5cGUpKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgLy8gQ2hlY2sgdG8gc2VlIGlmIHNvbWUgbWV0aG9kIGV4aXN0cyBmcm9tIHRoZSBPYmplY3QgZXhpc3RzXG4gICAgICAgIGlmICghSEFTX09XTihjdG9yLnByb3RvdHlwZSwgJ2lzUHJvdG90eXBlT2YnKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmIChyZXF1aXJlZEtleXMpIHtcbiAgICAgICAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKHZhbHVlKTtcbiAgICAgICAgcmV0dXJuIGlzU3VwZXJzZXQoa2V5cywgcmVxdWlyZWRLZXlzKTtcbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLmlzUmVjb3JkID0gaXNSZWNvcmQ7XG4vKipcbiAqIE1ha2UgYSBkZWVwIGNvcHkgb2YgYW4gb2JqZWN0XG4gKlxuICogTk9URTogVGhpcyBpcyBub3QgbWVhbnQgdG8gYmUgdGhlIHBlcmZlY3QgaW1wbGVtZW50YXRpb24gb2YgYSBkZWVwIGNvcHksXG4gKiBidXQgaW5zdGVhZCBzb21ldGhpbmcgdGhhdCBpcyBnb29kIGVub3VnaCBmb3IgdGhlIHB1cnBvc2VzIG9mXG4gKiBjb21tYW5kIG1vbml0b3JpbmcuXG4gKi9cbmZ1bmN0aW9uIGRlZXBDb3B5KHZhbHVlKSB7XG4gICAgaWYgKHZhbHVlID09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgIH1cbiAgICBlbHNlIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkge1xuICAgICAgICByZXR1cm4gdmFsdWUubWFwKGl0ZW0gPT4gZGVlcENvcHkoaXRlbSkpO1xuICAgIH1cbiAgICBlbHNlIGlmIChpc1JlY29yZCh2YWx1ZSkpIHtcbiAgICAgICAgY29uc3QgcmVzID0ge307XG4gICAgICAgIGZvciAoY29uc3Qga2V5IGluIHZhbHVlKSB7XG4gICAgICAgICAgICByZXNba2V5XSA9IGRlZXBDb3B5KHZhbHVlW2tleV0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXM7XG4gICAgfVxuICAgIGNvbnN0IGN0b3IgPSB2YWx1ZS5jb25zdHJ1Y3RvcjtcbiAgICBpZiAoY3Rvcikge1xuICAgICAgICBzd2l0Y2ggKGN0b3IubmFtZS50b0xvd2VyQ2FzZSgpKSB7XG4gICAgICAgICAgICBjYXNlICdkYXRlJzpcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IGN0b3IoTnVtYmVyKHZhbHVlKSk7XG4gICAgICAgICAgICBjYXNlICdtYXAnOlxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgTWFwKHZhbHVlKTtcbiAgICAgICAgICAgIGNhc2UgJ3NldCc6XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTZXQodmFsdWUpO1xuICAgICAgICAgICAgY2FzZSAnYnVmZmVyJzpcbiAgICAgICAgICAgICAgICByZXR1cm4gQnVmZmVyLmZyb20odmFsdWUpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiB2YWx1ZTtcbn1cbmV4cG9ydHMuZGVlcENvcHkgPSBkZWVwQ29weTtcbi8qKlxuICogQSBzZXF1ZW50aWFsIGxpc3Qgb2YgaXRlbXMgaW4gYSBjaXJjdWxhcmx5IGxpbmtlZCBsaXN0XG4gKiBAcmVtYXJrc1xuICogVGhlIGhlYWQgbm9kZSBpcyBzcGVjaWFsLCBpdCBpcyBhbHdheXMgZGVmaW5lZCBhbmQgaGFzIGEgdmFsdWUgb2YgbnVsbC5cbiAqIEl0IGlzIG5ldmVyIFwiaW5jbHVkZWRcIiBpbiB0aGUgbGlzdCwgaW4gdGhhdCwgaXQgaXMgbm90IHJldHVybmVkIGJ5IHBvcC9zaGlmdCBvciB5aWVsZGVkIGJ5IHRoZSBpdGVyYXRvci5cbiAqIFRoZSBjaXJjdWxhciBsaW5rYWdlIGFuZCBhbHdheXMgZGVmaW5lZCBoZWFkIG5vZGUgYXJlIHRvIHJlZHVjZSBjaGVja3MgZm9yIG51bGwgbmV4dC9wcmV2IHJlZmVyZW5jZXMgdG8gemVyby5cbiAqIE5ldyBub2RlcyBhcmUgZGVjbGFyZWQgYXMgb2JqZWN0IGxpdGVyYWxzIHdpdGgga2V5cyBhbHdheXMgaW4gdGhlIHNhbWUgb3JkZXI6IG5leHQsIHByZXYsIHZhbHVlLlxuICogQGludGVybmFsXG4gKi9cbmNsYXNzIExpc3Qge1xuICAgIGdldCBsZW5ndGgoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvdW50O1xuICAgIH1cbiAgICBnZXQgW1N5bWJvbC50b1N0cmluZ1RhZ10oKSB7XG4gICAgICAgIHJldHVybiAnTGlzdCc7XG4gICAgfVxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLmNvdW50ID0gMDtcbiAgICAgICAgLy8gdGhpcyBpcyBjYXJlZnVsbHkgY3JhZnRlZDpcbiAgICAgICAgLy8gZGVjbGFyaW5nIGEgY29tcGxldGUgYW5kIGNvbnNpc3RlbnRseSBrZXkgb3JkZXJlZFxuICAgICAgICAvLyBvYmplY3QgaXMgYmVuZWZpY2lhbCB0byB0aGUgcnVudGltZSBvcHRpbWl6YXRpb25zXG4gICAgICAgIHRoaXMuaGVhZCA9IHtcbiAgICAgICAgICAgIG5leHQ6IG51bGwsXG4gICAgICAgICAgICBwcmV2OiBudWxsLFxuICAgICAgICAgICAgdmFsdWU6IG51bGxcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5oZWFkLm5leHQgPSB0aGlzLmhlYWQ7XG4gICAgICAgIHRoaXMuaGVhZC5wcmV2ID0gdGhpcy5oZWFkO1xuICAgIH1cbiAgICB0b0FycmF5KCkge1xuICAgICAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzKTtcbiAgICB9XG4gICAgdG9TdHJpbmcoKSB7XG4gICAgICAgIHJldHVybiBgaGVhZCA8PT4gJHt0aGlzLnRvQXJyYXkoKS5qb2luKCcgPD0+ICcpfSA8PT4gaGVhZGA7XG4gICAgfVxuICAgICpbU3ltYm9sLml0ZXJhdG9yXSgpIHtcbiAgICAgICAgZm9yIChjb25zdCBub2RlIG9mIHRoaXMubm9kZXMoKSkge1xuICAgICAgICAgICAgeWllbGQgbm9kZS52YWx1ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAqbm9kZXMoKSB7XG4gICAgICAgIGxldCBwdHIgPSB0aGlzLmhlYWQubmV4dDtcbiAgICAgICAgd2hpbGUgKHB0ciAhPT0gdGhpcy5oZWFkKSB7XG4gICAgICAgICAgICAvLyBTYXZlIG5leHQgYmVmb3JlIHlpZWxkaW5nIHNvIHRoYXQgd2UgbWFrZSByZW1vdmluZyB3aXRoaW4gaXRlcmF0aW9uIHNhZmVcbiAgICAgICAgICAgIGNvbnN0IHsgbmV4dCB9ID0gcHRyO1xuICAgICAgICAgICAgeWllbGQgcHRyO1xuICAgICAgICAgICAgcHRyID0gbmV4dDtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKiogSW5zZXJ0IGF0IGVuZCBvZiBsaXN0ICovXG4gICAgcHVzaCh2YWx1ZSkge1xuICAgICAgICB0aGlzLmNvdW50ICs9IDE7XG4gICAgICAgIGNvbnN0IG5ld05vZGUgPSB7XG4gICAgICAgICAgICBuZXh0OiB0aGlzLmhlYWQsXG4gICAgICAgICAgICBwcmV2OiB0aGlzLmhlYWQucHJldixcbiAgICAgICAgICAgIHZhbHVlXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaGVhZC5wcmV2Lm5leHQgPSBuZXdOb2RlO1xuICAgICAgICB0aGlzLmhlYWQucHJldiA9IG5ld05vZGU7XG4gICAgfVxuICAgIC8qKiBJbnNlcnRzIGV2ZXJ5IGl0ZW0gaW5zaWRlIGFuIGl0ZXJhYmxlIGluc3RlYWQgb2YgdGhlIGl0ZXJhYmxlIGl0c2VsZiAqL1xuICAgIHB1c2hNYW55KGl0ZXJhYmxlKSB7XG4gICAgICAgIGZvciAoY29uc3QgdmFsdWUgb2YgaXRlcmFibGUpIHtcbiAgICAgICAgICAgIHRoaXMucHVzaCh2YWx1ZSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqIEluc2VydCBhdCBmcm9udCBvZiBsaXN0ICovXG4gICAgdW5zaGlmdCh2YWx1ZSkge1xuICAgICAgICB0aGlzLmNvdW50ICs9IDE7XG4gICAgICAgIGNvbnN0IG5ld05vZGUgPSB7XG4gICAgICAgICAgICBuZXh0OiB0aGlzLmhlYWQubmV4dCxcbiAgICAgICAgICAgIHByZXY6IHRoaXMuaGVhZCxcbiAgICAgICAgICAgIHZhbHVlXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaGVhZC5uZXh0LnByZXYgPSBuZXdOb2RlO1xuICAgICAgICB0aGlzLmhlYWQubmV4dCA9IG5ld05vZGU7XG4gICAgfVxuICAgIHJlbW92ZShub2RlKSB7XG4gICAgICAgIGlmIChub2RlID09PSB0aGlzLmhlYWQgfHwgdGhpcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY291bnQgLT0gMTtcbiAgICAgICAgY29uc3QgcHJldk5vZGUgPSBub2RlLnByZXY7XG4gICAgICAgIGNvbnN0IG5leHROb2RlID0gbm9kZS5uZXh0O1xuICAgICAgICBwcmV2Tm9kZS5uZXh0ID0gbmV4dE5vZGU7XG4gICAgICAgIG5leHROb2RlLnByZXYgPSBwcmV2Tm9kZTtcbiAgICAgICAgcmV0dXJuIG5vZGUudmFsdWU7XG4gICAgfVxuICAgIC8qKiBSZW1vdmVzIHRoZSBmaXJzdCBub2RlIGF0IHRoZSBmcm9udCBvZiB0aGUgbGlzdCAqL1xuICAgIHNoaWZ0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yZW1vdmUodGhpcy5oZWFkLm5leHQpO1xuICAgIH1cbiAgICAvKiogUmVtb3ZlcyB0aGUgbGFzdCBub2RlIGF0IHRoZSBlbmQgb2YgdGhlIGxpc3QgKi9cbiAgICBwb3AoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlbW92ZSh0aGlzLmhlYWQucHJldik7XG4gICAgfVxuICAgIC8qKiBJdGVyYXRlcyB0aHJvdWdoIHRoZSBsaXN0IGFuZCByZW1vdmVzIG5vZGVzIHdoZXJlIGZpbHRlciByZXR1cm5zIHRydWUgKi9cbiAgICBwcnVuZShmaWx0ZXIpIHtcbiAgICAgICAgZm9yIChjb25zdCBub2RlIG9mIHRoaXMubm9kZXMoKSkge1xuICAgICAgICAgICAgaWYgKGZpbHRlcihub2RlLnZhbHVlKSkge1xuICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlKG5vZGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGNsZWFyKCkge1xuICAgICAgICB0aGlzLmNvdW50ID0gMDtcbiAgICAgICAgdGhpcy5oZWFkLm5leHQgPSB0aGlzLmhlYWQ7XG4gICAgICAgIHRoaXMuaGVhZC5wcmV2ID0gdGhpcy5oZWFkO1xuICAgIH1cbiAgICAvKiogUmV0dXJucyB0aGUgZmlyc3QgaXRlbSBpbiB0aGUgbGlzdCwgZG9lcyBub3QgcmVtb3ZlICovXG4gICAgZmlyc3QoKSB7XG4gICAgICAgIC8vIElmIHRoZSBsaXN0IGlzIGVtcHR5LCB2YWx1ZSB3aWxsIGJlIHRoZSBoZWFkJ3MgbnVsbFxuICAgICAgICByZXR1cm4gdGhpcy5oZWFkLm5leHQudmFsdWU7XG4gICAgfVxuICAgIC8qKiBSZXR1cm5zIHRoZSBsYXN0IGl0ZW0gaW4gdGhlIGxpc3QsIGRvZXMgbm90IHJlbW92ZSAqL1xuICAgIGxhc3QoKSB7XG4gICAgICAgIC8vIElmIHRoZSBsaXN0IGlzIGVtcHR5LCB2YWx1ZSB3aWxsIGJlIHRoZSBoZWFkJ3MgbnVsbFxuICAgICAgICByZXR1cm4gdGhpcy5oZWFkLnByZXYudmFsdWU7XG4gICAgfVxufVxuZXhwb3J0cy5MaXN0ID0gTGlzdDtcbi8qKlxuICogQSBwb29sIG9mIEJ1ZmZlcnMgd2hpY2ggYWxsb3cgeW91IHRvIHJlYWQgdGhlbSBhcyBpZiB0aGV5IHdlcmUgb25lXG4gKiBAaW50ZXJuYWxcbiAqL1xuY2xhc3MgQnVmZmVyUG9vbCB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuYnVmZmVycyA9IG5ldyBMaXN0KCk7XG4gICAgICAgIHRoaXMudG90YWxCeXRlTGVuZ3RoID0gMDtcbiAgICB9XG4gICAgZ2V0IGxlbmd0aCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudG90YWxCeXRlTGVuZ3RoO1xuICAgIH1cbiAgICAvKiogQWRkcyBhIGJ1ZmZlciB0byB0aGUgaW50ZXJuYWwgYnVmZmVyIHBvb2wgbGlzdCAqL1xuICAgIGFwcGVuZChidWZmZXIpIHtcbiAgICAgICAgdGhpcy5idWZmZXJzLnB1c2goYnVmZmVyKTtcbiAgICAgICAgdGhpcy50b3RhbEJ5dGVMZW5ndGggKz0gYnVmZmVyLmxlbmd0aDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogSWYgQnVmZmVyUG9vbCBjb250YWlucyA0IGJ5dGVzIG9yIG1vcmUgY29uc3RydWN0IGFuIGludDMyIGZyb20gdGhlIGxlYWRpbmcgYnl0ZXMsXG4gICAgICogb3RoZXJ3aXNlIHJldHVybiBudWxsLiBTaXplIGNhbiBiZSBuZWdhdGl2ZSwgY2FsbGVyIHNob3VsZCBlcnJvciBjaGVjay5cbiAgICAgKi9cbiAgICBnZXRJbnQzMigpIHtcbiAgICAgICAgaWYgKHRoaXMudG90YWxCeXRlTGVuZ3RoIDwgNCkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZmlyc3RCdWZmZXIgPSB0aGlzLmJ1ZmZlcnMuZmlyc3QoKTtcbiAgICAgICAgaWYgKGZpcnN0QnVmZmVyICE9IG51bGwgJiYgZmlyc3RCdWZmZXIuYnl0ZUxlbmd0aCA+PSA0KSB7XG4gICAgICAgICAgICByZXR1cm4gZmlyc3RCdWZmZXIucmVhZEludDMyTEUoMCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gVW5saWtlbHkgY2FzZTogYW4gaW50MzIgaXMgc3BsaXQgYWNyb3NzIGJ1ZmZlcnMuXG4gICAgICAgIC8vIFVzZSByZWFkIGFuZCBwdXQgdGhlIHJldHVybmVkIGJ1ZmZlciBiYWNrIG9uIHRvcFxuICAgICAgICBjb25zdCB0b3A0Qnl0ZXMgPSB0aGlzLnJlYWQoNCk7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gdG9wNEJ5dGVzLnJlYWRJbnQzMkxFKDApO1xuICAgICAgICAvLyBQdXQgaXQgYmFjay5cbiAgICAgICAgdGhpcy50b3RhbEJ5dGVMZW5ndGggKz0gNDtcbiAgICAgICAgdGhpcy5idWZmZXJzLnVuc2hpZnQodG9wNEJ5dGVzKTtcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgIH1cbiAgICAvKiogUmVhZHMgdGhlIHJlcXVlc3RlZCBudW1iZXIgb2YgYnl0ZXMsIG9wdGlvbmFsbHkgY29uc3VtaW5nIHRoZW0gKi9cbiAgICByZWFkKHNpemUpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBzaXplICE9PSAnbnVtYmVyJyB8fCBzaXplIDwgMCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignQXJndW1lbnQgXCJzaXplXCIgbXVzdCBiZSBhIG5vbi1uZWdhdGl2ZSBudW1iZXInKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBvdmVyc2l6ZWQgcmVxdWVzdCByZXR1cm5zIGVtcHR5IGJ1ZmZlclxuICAgICAgICBpZiAoc2l6ZSA+IHRoaXMudG90YWxCeXRlTGVuZ3RoKSB7XG4gICAgICAgICAgICByZXR1cm4gQnVmZmVyLmFsbG9jKDApO1xuICAgICAgICB9XG4gICAgICAgIC8vIFdlIGtub3cgd2UgaGF2ZSBlbm91Z2gsIHdlIGp1c3QgZG9uJ3Qga25vdyBob3cgaXQgaXMgc3ByZWFkIGFjcm9zcyBjaHVua3NcbiAgICAgICAgLy8gVE9ETyhOT0RFLTQ3MzIpOiBhbGxvYyBBUEkgc2hvdWxkIGNoYW5nZSBiYXNlZCBvbiByYXcgb3B0aW9uXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IEJ1ZmZlci5hbGxvY1Vuc2FmZShzaXplKTtcbiAgICAgICAgZm9yIChsZXQgYnl0ZXNSZWFkID0gMDsgYnl0ZXNSZWFkIDwgc2l6ZTspIHtcbiAgICAgICAgICAgIGNvbnN0IGJ1ZmZlciA9IHRoaXMuYnVmZmVycy5zaGlmdCgpO1xuICAgICAgICAgICAgaWYgKGJ1ZmZlciA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBieXRlc1JlbWFpbmluZyA9IHNpemUgLSBieXRlc1JlYWQ7XG4gICAgICAgICAgICBjb25zdCBieXRlc1JlYWRhYmxlID0gTWF0aC5taW4oYnl0ZXNSZW1haW5pbmcsIGJ1ZmZlci5ieXRlTGVuZ3RoKTtcbiAgICAgICAgICAgIGNvbnN0IGJ5dGVzID0gYnVmZmVyLnN1YmFycmF5KDAsIGJ5dGVzUmVhZGFibGUpO1xuICAgICAgICAgICAgcmVzdWx0LnNldChieXRlcywgYnl0ZXNSZWFkKTtcbiAgICAgICAgICAgIGJ5dGVzUmVhZCArPSBieXRlc1JlYWRhYmxlO1xuICAgICAgICAgICAgdGhpcy50b3RhbEJ5dGVMZW5ndGggLT0gYnl0ZXNSZWFkYWJsZTtcbiAgICAgICAgICAgIGlmIChieXRlc1JlYWRhYmxlIDwgYnVmZmVyLmJ5dGVMZW5ndGgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmJ1ZmZlcnMudW5zaGlmdChidWZmZXIuc3ViYXJyYXkoYnl0ZXNSZWFkYWJsZSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxufVxuZXhwb3J0cy5CdWZmZXJQb29sID0gQnVmZmVyUG9vbDtcbi8qKiBAcHVibGljICovXG5jbGFzcyBIb3N0QWRkcmVzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFN0cmluZykge1xuICAgICAgICB0aGlzLmhvc3QgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMucG9ydCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5zb2NrZXRQYXRoID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmlzSVB2NiA9IGZhbHNlO1xuICAgICAgICBjb25zdCBlc2NhcGVkSG9zdCA9IGhvc3RTdHJpbmcuc3BsaXQoJyAnKS5qb2luKCclMjAnKTsgLy8gZXNjYXBlIHNwYWNlcywgZm9yIHNvY2tldCBwYXRoIGhvc3RzXG4gICAgICAgIGlmIChlc2NhcGVkSG9zdC5lbmRzV2l0aCgnLnNvY2snKSkge1xuICAgICAgICAgICAgLy8gaGV1cmlzdGljYWxseSBkZXRlcm1pbmUgaWYgd2UncmUgd29ya2luZyB3aXRoIGEgZG9tYWluIHNvY2tldFxuICAgICAgICAgICAgdGhpcy5zb2NrZXRQYXRoID0gZGVjb2RlVVJJQ29tcG9uZW50KGVzY2FwZWRIb3N0KTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB1cmxTdHJpbmcgPSBgaUxvdmVKUzovLyR7ZXNjYXBlZEhvc3R9YDtcbiAgICAgICAgbGV0IHVybDtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHVybCA9IG5ldyB1cmxfMS5VUkwodXJsU3RyaW5nKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAodXJsRXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnN0IHJ1bnRpbWVFcnJvciA9IG5ldyBlcnJvcl8xLk1vbmdvUnVudGltZUVycm9yKGBVbmFibGUgdG8gcGFyc2UgJHtlc2NhcGVkSG9zdH0gd2l0aCBVUkxgKTtcbiAgICAgICAgICAgIHJ1bnRpbWVFcnJvci5jYXVzZSA9IHVybEVycm9yO1xuICAgICAgICAgICAgdGhyb3cgcnVudGltZUVycm9yO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGhvc3RuYW1lID0gdXJsLmhvc3RuYW1lO1xuICAgICAgICBjb25zdCBwb3J0ID0gdXJsLnBvcnQ7XG4gICAgICAgIGxldCBub3JtYWxpemVkID0gZGVjb2RlVVJJQ29tcG9uZW50KGhvc3RuYW1lKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICBpZiAobm9ybWFsaXplZC5zdGFydHNXaXRoKCdbJykgJiYgbm9ybWFsaXplZC5lbmRzV2l0aCgnXScpKSB7XG4gICAgICAgICAgICB0aGlzLmlzSVB2NiA9IHRydWU7XG4gICAgICAgICAgICBub3JtYWxpemVkID0gbm9ybWFsaXplZC5zdWJzdHJpbmcoMSwgaG9zdG5hbWUubGVuZ3RoIC0gMSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5ob3N0ID0gbm9ybWFsaXplZC50b0xvd2VyQ2FzZSgpO1xuICAgICAgICBpZiAodHlwZW9mIHBvcnQgPT09ICdudW1iZXInKSB7XG4gICAgICAgICAgICB0aGlzLnBvcnQgPSBwb3J0O1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHR5cGVvZiBwb3J0ID09PSAnc3RyaW5nJyAmJiBwb3J0ICE9PSAnJykge1xuICAgICAgICAgICAgdGhpcy5wb3J0ID0gTnVtYmVyLnBhcnNlSW50KHBvcnQsIDEwKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMucG9ydCA9IDI3MDE3O1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnBvcnQgPT09IDApIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUGFyc2VFcnJvcignSW52YWxpZCBwb3J0ICh6ZXJvKSB3aXRoIGhvc3RuYW1lJyk7XG4gICAgICAgIH1cbiAgICAgICAgT2JqZWN0LmZyZWV6ZSh0aGlzKTtcbiAgICB9XG4gICAgW1N5bWJvbC5mb3IoJ25vZGVqcy51dGlsLmluc3BlY3QuY3VzdG9tJyldKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5pbnNwZWN0KCk7XG4gICAgfVxuICAgIGluc3BlY3QoKSB7XG4gICAgICAgIHJldHVybiBgbmV3IEhvc3RBZGRyZXNzKCcke3RoaXMudG9TdHJpbmcoKX0nKWA7XG4gICAgfVxuICAgIHRvU3RyaW5nKCkge1xuICAgICAgICBpZiAodHlwZW9mIHRoaXMuaG9zdCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzSVB2Nikge1xuICAgICAgICAgICAgICAgIHJldHVybiBgWyR7dGhpcy5ob3N0fV06JHt0aGlzLnBvcnR9YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBgJHt0aGlzLmhvc3R9OiR7dGhpcy5wb3J0fWA7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGAke3RoaXMuc29ja2V0UGF0aH1gO1xuICAgIH1cbiAgICBzdGF0aWMgZnJvbVN0cmluZyhzKSB7XG4gICAgICAgIHJldHVybiBuZXcgSG9zdEFkZHJlc3Mocyk7XG4gICAgfVxuICAgIHN0YXRpYyBmcm9tSG9zdFBvcnQoaG9zdCwgcG9ydCkge1xuICAgICAgICBpZiAoaG9zdC5pbmNsdWRlcygnOicpKSB7XG4gICAgICAgICAgICBob3N0ID0gYFske2hvc3R9XWA7IC8vIElQdjYgYWRkcmVzc1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBIb3N0QWRkcmVzcy5mcm9tU3RyaW5nKGAke2hvc3R9OiR7cG9ydH1gKTtcbiAgICB9XG4gICAgc3RhdGljIGZyb21TcnZSZWNvcmQoeyBuYW1lLCBwb3J0IH0pIHtcbiAgICAgICAgcmV0dXJuIEhvc3RBZGRyZXNzLmZyb21Ib3N0UG9ydChuYW1lLCBwb3J0KTtcbiAgICB9XG4gICAgdG9Ib3N0UG9ydCgpIHtcbiAgICAgICAgaWYgKHRoaXMuc29ja2V0UGF0aCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgaG9zdDogdGhpcy5zb2NrZXRQYXRoLCBwb3J0OiAwIH07XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaG9zdCA9IHRoaXMuaG9zdCA/PyAnJztcbiAgICAgICAgY29uc3QgcG9ydCA9IHRoaXMucG9ydCA/PyAwO1xuICAgICAgICByZXR1cm4geyBob3N0LCBwb3J0IH07XG4gICAgfVxufVxuZXhwb3J0cy5Ib3N0QWRkcmVzcyA9IEhvc3RBZGRyZXNzO1xuZXhwb3J0cy5ERUZBVUxUX1BLX0ZBQ1RPUlkgPSB7XG4gICAgLy8gV2UgcHJlZmVyIG5vdCB0byByZWx5IG9uIE9iamVjdElkIGhhdmluZyBhIGNyZWF0ZVBrIG1ldGhvZFxuICAgIGNyZWF0ZVBrKCkge1xuICAgICAgICByZXR1cm4gbmV3IGJzb25fMS5PYmplY3RJZCgpO1xuICAgIH1cbn07XG4vKipcbiAqIFdoZW4gdGhlIGRyaXZlciB1c2VkIGVtaXRXYXJuaW5nIHRoZSBjb2RlIHdpbGwgYmUgZXF1YWwgdG8gdGhpcy5cbiAqIEBwdWJsaWNcbiAqXG4gKiBAZXhhbXBsZVxuICogYGBgdHNcbiAqIHByb2Nlc3Mub24oJ3dhcm5pbmcnLCAod2FybmluZykgPT4ge1xuICogIGlmICh3YXJuaW5nLmNvZGUgPT09IE1PTkdPREJfV0FSTklOR19DT0RFKSBjb25zb2xlLmVycm9yKCdBaCBhbiBpbXBvcnRhbnQgd2FybmluZyEgOiknKVxuICogfSlcbiAqIGBgYFxuICovXG5leHBvcnRzLk1PTkdPREJfV0FSTklOR19DT0RFID0gJ01PTkdPREIgRFJJVkVSJztcbi8qKiBAaW50ZXJuYWwgKi9cbmZ1bmN0aW9uIGVtaXRXYXJuaW5nKG1lc3NhZ2UpIHtcbiAgICByZXR1cm4gcHJvY2Vzcy5lbWl0V2FybmluZyhtZXNzYWdlLCB7IGNvZGU6IGV4cG9ydHMuTU9OR09EQl9XQVJOSU5HX0NPREUgfSk7XG59XG5leHBvcnRzLmVtaXRXYXJuaW5nID0gZW1pdFdhcm5pbmc7XG5jb25zdCBlbWl0dGVkV2FybmluZ3MgPSBuZXcgU2V0KCk7XG4vKipcbiAqIFdpbGwgZW1pdCBhIHdhcm5pbmcgb25jZSBmb3IgdGhlIGR1cmF0aW9uIG9mIHRoZSBhcHBsaWNhdGlvbi5cbiAqIFVzZXMgdGhlIG1lc3NhZ2UgdG8gaWRlbnRpZnkgaWYgaXQgaGFzIGFscmVhZHkgYmVlbiBlbWl0dGVkXG4gKiBzbyB1c2luZyBzdHJpbmcgaW50ZXJwb2xhdGlvbiBjYW4gY2F1c2UgbXVsdGlwbGUgZW1pdHNcbiAqIEBpbnRlcm5hbFxuICovXG5mdW5jdGlvbiBlbWl0V2FybmluZ09uY2UobWVzc2FnZSkge1xuICAgIGlmICghZW1pdHRlZFdhcm5pbmdzLmhhcyhtZXNzYWdlKSkge1xuICAgICAgICBlbWl0dGVkV2FybmluZ3MuYWRkKG1lc3NhZ2UpO1xuICAgICAgICByZXR1cm4gZW1pdFdhcm5pbmcobWVzc2FnZSk7XG4gICAgfVxufVxuZXhwb3J0cy5lbWl0V2FybmluZ09uY2UgPSBlbWl0V2FybmluZ09uY2U7XG4vKipcbiAqIFRha2VzIGEgSlMgb2JqZWN0IGFuZCBqb2lucyB0aGUgdmFsdWVzIGludG8gYSBzdHJpbmcgc2VwYXJhdGVkIGJ5ICcsICdcbiAqL1xuZnVuY3Rpb24gZW51bVRvU3RyaW5nKGVuKSB7XG4gICAgcmV0dXJuIE9iamVjdC52YWx1ZXMoZW4pLmpvaW4oJywgJyk7XG59XG5leHBvcnRzLmVudW1Ub1N0cmluZyA9IGVudW1Ub1N0cmluZztcbi8qKlxuICogRGV0ZXJtaW5lIGlmIGEgc2VydmVyIHN1cHBvcnRzIHJldHJ5YWJsZSB3cml0ZXMuXG4gKlxuICogQGludGVybmFsXG4gKi9cbmZ1bmN0aW9uIHN1cHBvcnRzUmV0cnlhYmxlV3JpdGVzKHNlcnZlcikge1xuICAgIGlmICghc2VydmVyKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgaWYgKHNlcnZlci5sb2FkQmFsYW5jZWQpIHtcbiAgICAgICAgLy8gTG9hZGJhbGFuY2VkIHRvcG9sb2dpZXMgd2lsbCBhbHdheXMgc3VwcG9ydCByZXRyeSB3cml0ZXNcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGlmIChzZXJ2ZXIuZGVzY3JpcHRpb24ubG9naWNhbFNlc3Npb25UaW1lb3V0TWludXRlcyAhPSBudWxsKSB7XG4gICAgICAgIC8vIHRoYXQgc3VwcG9ydHMgc2Vzc2lvbnNcbiAgICAgICAgaWYgKHNlcnZlci5kZXNjcmlwdGlvbi50eXBlICE9PSBjb21tb25fMS5TZXJ2ZXJUeXBlLlN0YW5kYWxvbmUpIHtcbiAgICAgICAgICAgIC8vIGFuZCB0aGF0IGlzIG5vdCBhIHN0YW5kYWxvbmVcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbn1cbmV4cG9ydHMuc3VwcG9ydHNSZXRyeWFibGVXcml0ZXMgPSBzdXBwb3J0c1JldHJ5YWJsZVdyaXRlcztcbi8qKlxuICogRmlzaGVy4oCTWWF0ZXMgU2h1ZmZsZVxuICpcbiAqIFJlZmVyZW5jZTogaHR0cHM6Ly9ib3N0Lm9ja3Mub3JnL21pa2Uvc2h1ZmZsZS9cbiAqIEBwYXJhbSBzZXF1ZW5jZSAtIGl0ZW1zIHRvIGJlIHNodWZmbGVkXG4gKiBAcGFyYW0gbGltaXQgLSBEZWZhdWx0cyB0byBgMGAuIElmIG5vbnplcm8gc2h1ZmZsZSB3aWxsIHNsaWNlIHRoZSByYW5kb21pemVkIGFycmF5IGUuZywgYC5zbGljZSgwLCBsaW1pdClgIG90aGVyd2lzZSB3aWxsIHJldHVybiB0aGUgZW50aXJlIHJhbmRvbWl6ZWQgYXJyYXkuXG4gKi9cbmZ1bmN0aW9uIHNodWZmbGUoc2VxdWVuY2UsIGxpbWl0ID0gMCkge1xuICAgIGNvbnN0IGl0ZW1zID0gQXJyYXkuZnJvbShzZXF1ZW5jZSk7IC8vIHNoYWxsb3cgY29weSBpbiBvcmRlciB0byBuZXZlciBzaHVmZmxlIHRoZSBpbnB1dFxuICAgIGlmIChsaW1pdCA+IGl0ZW1zLmxlbmd0aCkge1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1J1bnRpbWVFcnJvcignTGltaXQgbXVzdCBiZSBsZXNzIHRoYW4gdGhlIG51bWJlciBvZiBpdGVtcycpO1xuICAgIH1cbiAgICBsZXQgcmVtYWluaW5nSXRlbXNUb1NodWZmbGUgPSBpdGVtcy5sZW5ndGg7XG4gICAgY29uc3QgbG93ZXJCb3VuZCA9IGxpbWl0ICUgaXRlbXMubGVuZ3RoID09PSAwID8gMSA6IGl0ZW1zLmxlbmd0aCAtIGxpbWl0O1xuICAgIHdoaWxlIChyZW1haW5pbmdJdGVtc1RvU2h1ZmZsZSA+IGxvd2VyQm91bmQpIHtcbiAgICAgICAgLy8gUGljayBhIHJlbWFpbmluZyBlbGVtZW50XG4gICAgICAgIGNvbnN0IHJhbmRvbUluZGV4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogcmVtYWluaW5nSXRlbXNUb1NodWZmbGUpO1xuICAgICAgICByZW1haW5pbmdJdGVtc1RvU2h1ZmZsZSAtPSAxO1xuICAgICAgICAvLyBBbmQgc3dhcCBpdCB3aXRoIHRoZSBjdXJyZW50IGVsZW1lbnRcbiAgICAgICAgY29uc3Qgc3dhcEhvbGQgPSBpdGVtc1tyZW1haW5pbmdJdGVtc1RvU2h1ZmZsZV07XG4gICAgICAgIGl0ZW1zW3JlbWFpbmluZ0l0ZW1zVG9TaHVmZmxlXSA9IGl0ZW1zW3JhbmRvbUluZGV4XTtcbiAgICAgICAgaXRlbXNbcmFuZG9tSW5kZXhdID0gc3dhcEhvbGQ7XG4gICAgfVxuICAgIHJldHVybiBsaW1pdCAlIGl0ZW1zLmxlbmd0aCA9PT0gMCA/IGl0ZW1zIDogaXRlbXMuc2xpY2UobG93ZXJCb3VuZCk7XG59XG5leHBvcnRzLnNodWZmbGUgPSBzaHVmZmxlO1xuLy8gVE9ETyhOT0RFLTQ5MzYpOiByZWFkIGNvbmNlcm4gZWxpZ2liaWxpdHkgZm9yIGNvbW1hbmRzIHNob3VsZCBiZSBjb2RpZmllZCBpbiBjb21tYW5kIGNvbnN0cnVjdGlvblxuLy8gQHNlZSBodHRwczovL2dpdGh1Yi5jb20vbW9uZ29kYi9zcGVjaWZpY2F0aW9ucy9ibG9iL21hc3Rlci9zb3VyY2UvcmVhZC13cml0ZS1jb25jZXJuL3JlYWQtd3JpdGUtY29uY2Vybi5yc3QjcmVhZC1jb25jZXJuXG5mdW5jdGlvbiBjb21tYW5kU3VwcG9ydHNSZWFkQ29uY2Vybihjb21tYW5kLCBvcHRpb25zKSB7XG4gICAgaWYgKGNvbW1hbmQuYWdncmVnYXRlIHx8IGNvbW1hbmQuY291bnQgfHwgY29tbWFuZC5kaXN0aW5jdCB8fCBjb21tYW5kLmZpbmQgfHwgY29tbWFuZC5nZW9OZWFyKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBpZiAoY29tbWFuZC5tYXBSZWR1Y2UgJiZcbiAgICAgICAgb3B0aW9ucyAmJlxuICAgICAgICBvcHRpb25zLm91dCAmJlxuICAgICAgICAob3B0aW9ucy5vdXQuaW5saW5lID09PSAxIHx8IG9wdGlvbnMub3V0ID09PSAnaW5saW5lJykpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbn1cbmV4cG9ydHMuY29tbWFuZFN1cHBvcnRzUmVhZENvbmNlcm4gPSBjb21tYW5kU3VwcG9ydHNSZWFkQ29uY2Vybjtcbi8qKiBBIHV0aWxpdHkgZnVuY3Rpb24gdG8gZ2V0IHRoZSBpbnN0YW5jZSBvZiBtb25nb2RiLWNsaWVudC1lbmNyeXB0aW9uLCBpZiBpdCBleGlzdHMuICovXG5mdW5jdGlvbiBnZXRNb25nb0RCQ2xpZW50RW5jcnlwdGlvbigpIHtcbiAgICBsZXQgbW9uZ29kYkNsaWVudEVuY3J5cHRpb24gPSBudWxsO1xuICAgIC8vIE5PVEUoTk9ERS00MjU0KTogVGhpcyBpcyB0byBnZXQgYXJvdW5kIHRoZSBjaXJjdWxhciBkZXBlbmRlbmN5IGJldHdlZW5cbiAgICAvLyBtb25nb2RiLWNsaWVudC1lbmNyeXB0aW9uIGFuZCB0aGUgZHJpdmVyIGluIHRoZSB0ZXN0IHNjZW5hcmlvcy5cbiAgICBpZiAodHlwZW9mIHByb2Nlc3MuZW52Lk1PTkdPREJfQ0xJRU5UX0VOQ1JZUFRJT05fT1ZFUlJJREUgPT09ICdzdHJpbmcnICYmXG4gICAgICAgIHByb2Nlc3MuZW52Lk1PTkdPREJfQ0xJRU5UX0VOQ1JZUFRJT05fT1ZFUlJJREUubGVuZ3RoID4gMCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgLy8gTk9URShOT0RFLTMxOTkpOiBFbnN1cmUgeW91IGFsd2F5cyB3cmFwIGFuIG9wdGlvbmFsIHJlcXVpcmUgbGl0ZXJhbGx5IGluIHRoZSB0cnkgYmxvY2tcbiAgICAgICAgICAgIC8vIENhbm5vdCBiZSBtb3ZlZCB0byBoZWxwZXIgdXRpbGl0eSBmdW5jdGlvbiwgYnVuZGxlcnMgc2VhcmNoIGFuZCByZXBsYWNlIHRoZSBhY3R1YWwgcmVxdWlyZSBjYWxsXG4gICAgICAgICAgICAvLyBpbiBhIHdheSB0aGF0IG1ha2VzIHRoaXMgbGluZSB0aHJvdyBhdCBidW5kbGUgdGltZSwgbm90IHJ1bnRpbWUsIGNhdGNoaW5nIGhlcmUgd2lsbCBtYWtlIGJ1bmRsaW5nIHN1Y2NlZWRcbiAgICAgICAgICAgIG1vbmdvZGJDbGllbnRFbmNyeXB0aW9uID0gcmVxdWlyZShwcm9jZXNzLmVudi5NT05HT0RCX0NMSUVOVF9FTkNSWVBUSU9OX09WRVJSSURFKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCB7XG4gICAgICAgICAgICAvLyBpZ25vcmVcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIE5PVEUoTk9ERS0zMTk5KTogRW5zdXJlIHlvdSBhbHdheXMgd3JhcCBhbiBvcHRpb25hbCByZXF1aXJlIGxpdGVyYWxseSBpbiB0aGUgdHJ5IGJsb2NrXG4gICAgICAgICAgICAvLyBDYW5ub3QgYmUgbW92ZWQgdG8gaGVscGVyIHV0aWxpdHkgZnVuY3Rpb24sIGJ1bmRsZXJzIHNlYXJjaCBhbmQgcmVwbGFjZSB0aGUgYWN0dWFsIHJlcXVpcmUgY2FsbFxuICAgICAgICAgICAgLy8gaW4gYSB3YXkgdGhhdCBtYWtlcyB0aGlzIGxpbmUgdGhyb3cgYXQgYnVuZGxlIHRpbWUsIG5vdCBydW50aW1lLCBjYXRjaGluZyBoZXJlIHdpbGwgbWFrZSBidW5kbGluZyBzdWNjZWVkXG4gICAgICAgICAgICBtb25nb2RiQ2xpZW50RW5jcnlwdGlvbiA9IHJlcXVpcmUoJ21vbmdvZGItY2xpZW50LWVuY3J5cHRpb24nKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCB7XG4gICAgICAgICAgICAvLyBpZ25vcmVcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbW9uZ29kYkNsaWVudEVuY3J5cHRpb247XG59XG5leHBvcnRzLmdldE1vbmdvREJDbGllbnRFbmNyeXB0aW9uID0gZ2V0TW9uZ29EQkNsaWVudEVuY3J5cHRpb247XG4vKipcbiAqIENvbXBhcmUgb2JqZWN0SWRzLiBgbnVsbGAgaXMgYWx3YXlzIGxlc3NcbiAqIC0gYCsxID0gb2lkMSBpcyBncmVhdGVyIHRoYW4gb2lkMmBcbiAqIC0gYC0xID0gb2lkMSBpcyBsZXNzIHRoYW4gb2lkMmBcbiAqIC0gYCswID0gb2lkMSBpcyBlcXVhbCBvaWQyYFxuICovXG5mdW5jdGlvbiBjb21wYXJlT2JqZWN0SWQob2lkMSwgb2lkMikge1xuICAgIGlmIChvaWQxID09IG51bGwgJiYgb2lkMiA9PSBudWxsKSB7XG4gICAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgICBpZiAob2lkMSA9PSBudWxsKSB7XG4gICAgICAgIHJldHVybiAtMTtcbiAgICB9XG4gICAgaWYgKG9pZDIgPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gMTtcbiAgICB9XG4gICAgcmV0dXJuIGV4cG9ydHMuQnl0ZVV0aWxzLmNvbXBhcmUob2lkMS5pZCwgb2lkMi5pZCk7XG59XG5leHBvcnRzLmNvbXBhcmVPYmplY3RJZCA9IGNvbXBhcmVPYmplY3RJZDtcbmZ1bmN0aW9uIHBhcnNlSW50ZWdlcih2YWx1ZSkge1xuICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInKVxuICAgICAgICByZXR1cm4gTWF0aC50cnVuYyh2YWx1ZSk7XG4gICAgY29uc3QgcGFyc2VkVmFsdWUgPSBOdW1iZXIucGFyc2VJbnQoU3RyaW5nKHZhbHVlKSwgMTApO1xuICAgIHJldHVybiBOdW1iZXIuaXNOYU4ocGFyc2VkVmFsdWUpID8gbnVsbCA6IHBhcnNlZFZhbHVlO1xufVxuZXhwb3J0cy5wYXJzZUludGVnZXIgPSBwYXJzZUludGVnZXI7XG5mdW5jdGlvbiBwYXJzZVVuc2lnbmVkSW50ZWdlcih2YWx1ZSkge1xuICAgIGNvbnN0IHBhcnNlZEludCA9IHBhcnNlSW50ZWdlcih2YWx1ZSk7XG4gICAgcmV0dXJuIHBhcnNlZEludCAhPSBudWxsICYmIHBhcnNlZEludCA+PSAwID8gcGFyc2VkSW50IDogbnVsbDtcbn1cbmV4cG9ydHMucGFyc2VVbnNpZ25lZEludGVnZXIgPSBwYXJzZVVuc2lnbmVkSW50ZWdlcjtcbi8qKlxuICogRGV0ZXJtaW5lcyB3aGV0aGVyIGEgcHJvdmlkZWQgYWRkcmVzcyBtYXRjaGVzIHRoZSBwcm92aWRlZCBwYXJlbnQgZG9tYWluLlxuICpcbiAqIElmIGEgRE5TIHNlcnZlciB3ZXJlIHRvIGJlY29tZSBjb21wcm9taXNlZCBTUlYgcmVjb3JkcyB3b3VsZCBzdGlsbCBuZWVkIHRvXG4gKiBhZHZlcnRpc2UgYWRkcmVzc2VzIHRoYXQgYXJlIHVuZGVyIHRoZSBzYW1lIGRvbWFpbiBhcyB0aGUgc3J2SG9zdC5cbiAqXG4gKiBAcGFyYW0gYWRkcmVzcyAtIFRoZSBhZGRyZXNzIHRvIGNoZWNrIGFnYWluc3QgYSBkb21haW5cbiAqIEBwYXJhbSBzcnZIb3N0IC0gVGhlIGRvbWFpbiB0byBjaGVjayB0aGUgcHJvdmlkZWQgYWRkcmVzcyBhZ2FpbnN0XG4gKiBAcmV0dXJucyBXaGV0aGVyIHRoZSBwcm92aWRlZCBhZGRyZXNzIG1hdGNoZXMgdGhlIHBhcmVudCBkb21haW5cbiAqL1xuZnVuY3Rpb24gbWF0Y2hlc1BhcmVudERvbWFpbihhZGRyZXNzLCBzcnZIb3N0KSB7XG4gICAgLy8gUmVtb3ZlIHRyYWlsaW5nIGRvdCBpZiBleGlzdHMgb24gZWl0aGVyIHRoZSByZXNvbHZlZCBhZGRyZXNzIG9yIHRoZSBzcnYgaG9zdG5hbWVcbiAgICBjb25zdCBub3JtYWxpemVkQWRkcmVzcyA9IGFkZHJlc3MuZW5kc1dpdGgoJy4nKSA/IGFkZHJlc3Muc2xpY2UoMCwgYWRkcmVzcy5sZW5ndGggLSAxKSA6IGFkZHJlc3M7XG4gICAgY29uc3Qgbm9ybWFsaXplZFNydkhvc3QgPSBzcnZIb3N0LmVuZHNXaXRoKCcuJykgPyBzcnZIb3N0LnNsaWNlKDAsIHNydkhvc3QubGVuZ3RoIC0gMSkgOiBzcnZIb3N0O1xuICAgIGNvbnN0IGFsbENoYXJhY3RlckJlZm9yZUZpcnN0RG90ID0gL14uKj9cXC4vO1xuICAgIC8vIFJlbW92ZSBhbGwgY2hhcmFjdGVycyBiZWZvcmUgZmlyc3QgZG90XG4gICAgLy8gQWRkIGxlYWRpbmcgZG90IGJhY2sgdG8gc3RyaW5nIHNvXG4gICAgLy8gICBhbiBzcnZIb3N0RG9tYWluID0gJy50cnVzdGVkLnNpdGUnXG4gICAgLy8gICB3aWxsIG5vdCBzYXRpc2Z5IGFuIGFkZHJlc3NEb21haW4gdGhhdCBlbmRzV2l0aCAnLmZha2UtdHJ1c3RlZC5zaXRlJ1xuICAgIGNvbnN0IGFkZHJlc3NEb21haW4gPSBgLiR7bm9ybWFsaXplZEFkZHJlc3MucmVwbGFjZShhbGxDaGFyYWN0ZXJCZWZvcmVGaXJzdERvdCwgJycpfWA7XG4gICAgY29uc3Qgc3J2SG9zdERvbWFpbiA9IGAuJHtub3JtYWxpemVkU3J2SG9zdC5yZXBsYWNlKGFsbENoYXJhY3RlckJlZm9yZUZpcnN0RG90LCAnJyl9YDtcbiAgICByZXR1cm4gYWRkcmVzc0RvbWFpbi5lbmRzV2l0aChzcnZIb3N0RG9tYWluKTtcbn1cbmV4cG9ydHMubWF0Y2hlc1BhcmVudERvbWFpbiA9IG1hdGNoZXNQYXJlbnREb21haW47XG5hc3luYyBmdW5jdGlvbiByZXF1ZXN0KHVyaSwgb3B0aW9ucyA9IHt9KSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgY29uc3QgcmVxdWVzdE9wdGlvbnMgPSB7XG4gICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgICAgdGltZW91dDogMTAwMDAsXG4gICAgICAgICAgICBqc29uOiB0cnVlLFxuICAgICAgICAgICAgLi4udXJsLnBhcnNlKHVyaSksXG4gICAgICAgICAgICAuLi5vcHRpb25zXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IHJlcSA9IGh0dHAucmVxdWVzdChyZXF1ZXN0T3B0aW9ucywgcmVzID0+IHtcbiAgICAgICAgICAgIHJlcy5zZXRFbmNvZGluZygndXRmOCcpO1xuICAgICAgICAgICAgbGV0IGRhdGEgPSAnJztcbiAgICAgICAgICAgIHJlcy5vbignZGF0YScsIGQgPT4ge1xuICAgICAgICAgICAgICAgIGRhdGEgKz0gZDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmVzLm9uY2UoJ2VuZCcsICgpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5qc29uID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhcnNlZCA9IEpTT04ucGFyc2UoZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUocGFyc2VkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2F0Y2gge1xuICAgICAgICAgICAgICAgICAgICAvLyBUT0RPKE5PREUtMzQ4MylcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KG5ldyBlcnJvcl8xLk1vbmdvUnVudGltZUVycm9yKGBJbnZhbGlkIEpTT04gcmVzcG9uc2U6IFwiJHtkYXRhfVwiYCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgcmVxLm9uY2UoJ3RpbWVvdXQnLCAoKSA9PiByZXEuZGVzdHJveShuZXcgZXJyb3JfMS5Nb25nb05ldHdvcmtUaW1lb3V0RXJyb3IoYE5ldHdvcmsgcmVxdWVzdCB0byAke3VyaX0gdGltZWQgb3V0IGFmdGVyICR7b3B0aW9ucy50aW1lb3V0fSBtc2ApKSk7XG4gICAgICAgIHJlcS5vbmNlKCdlcnJvcicsIGVycm9yID0+IHJlamVjdChlcnJvcikpO1xuICAgICAgICByZXEuZW5kKCk7XG4gICAgfSk7XG59XG5leHBvcnRzLnJlcXVlc3QgPSByZXF1ZXN0O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9dXRpbHMuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/utils.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/lib/write_concern.js":
/*!***********************************************************!*\
  !*** ../server/node_modules/mongodb/lib/write_concern.js ***!
  \***********************************************************/
/***/ ((__unused_webpack_module, exports) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.WriteConcern = exports.WRITE_CONCERN_KEYS = void 0;\nexports.WRITE_CONCERN_KEYS = ['w', 'wtimeout', 'j', 'journal', 'fsync'];\n/**\n * A MongoDB WriteConcern, which describes the level of acknowledgement\n * requested from MongoDB for write operations.\n * @public\n *\n * @see https://www.mongodb.com/docs/manual/reference/write-concern/\n */\nclass WriteConcern {\n    /**\n     * Constructs a WriteConcern from the write concern properties.\n     * @param w - request acknowledgment that the write operation has propagated to a specified number of mongod instances or to mongod instances with specified tags.\n     * @param wtimeoutMS - specify a time limit to prevent write operations from blocking indefinitely\n     * @param journal - request acknowledgment that the write operation has been written to the on-disk journal\n     * @param fsync - equivalent to the j option. Is deprecated and will be removed in the next major version.\n     */\n    constructor(w, wtimeoutMS, journal, fsync) {\n        if (w != null) {\n            if (!Number.isNaN(Number(w))) {\n                this.w = Number(w);\n            }\n            else {\n                this.w = w;\n            }\n        }\n        if (wtimeoutMS != null) {\n            this.wtimeoutMS = this.wtimeout = wtimeoutMS;\n        }\n        if (journal != null) {\n            this.journal = this.j = journal;\n        }\n        if (fsync != null) {\n            this.journal = this.j = fsync ? true : false;\n        }\n    }\n    /**\n     * Apply a write concern to a command document. Will modify and return the command.\n     */\n    static apply(command, writeConcern) {\n        const wc = {};\n        // The write concern document sent to the server has w/wtimeout/j fields.\n        if (writeConcern.w != null)\n            wc.w = writeConcern.w;\n        if (writeConcern.wtimeoutMS != null)\n            wc.wtimeout = writeConcern.wtimeoutMS;\n        if (writeConcern.journal != null)\n            wc.j = writeConcern.j;\n        command.writeConcern = wc;\n        return command;\n    }\n    /** Construct a WriteConcern given an options object. */\n    static fromOptions(options, inherit) {\n        if (options == null)\n            return undefined;\n        inherit = inherit ?? {};\n        let opts;\n        if (typeof options === 'string' || typeof options === 'number') {\n            opts = { w: options };\n        }\n        else if (options instanceof WriteConcern) {\n            opts = options;\n        }\n        else {\n            opts = options.writeConcern;\n        }\n        const parentOpts = inherit instanceof WriteConcern ? inherit : inherit.writeConcern;\n        const { w = undefined, wtimeout = undefined, j = undefined, fsync = undefined, journal = undefined, wtimeoutMS = undefined } = {\n            ...parentOpts,\n            ...opts\n        };\n        if (w != null ||\n            wtimeout != null ||\n            wtimeoutMS != null ||\n            j != null ||\n            journal != null ||\n            fsync != null) {\n            return new WriteConcern(w, wtimeout ?? wtimeoutMS, j ?? journal, fsync);\n        }\n        return undefined;\n    }\n}\nexports.WriteConcern = WriteConcern;\n//# sourceMappingURL=write_concern.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vc2VydmVyL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi93cml0ZV9jb25jZXJuLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELG9CQUFvQixHQUFHLDBCQUEwQjtBQUNqRCwwQkFBMEI7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLHFIQUFxSDtBQUNySTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CO0FBQ3BCIiwic291cmNlcyI6WyJEOlxcc2Fsb25pXFxhcHByYWlzYWwtc3lzdGVtXFxzZXJ2ZXJcXG5vZGVfbW9kdWxlc1xcbW9uZ29kYlxcbGliXFx3cml0ZV9jb25jZXJuLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5Xcml0ZUNvbmNlcm4gPSBleHBvcnRzLldSSVRFX0NPTkNFUk5fS0VZUyA9IHZvaWQgMDtcbmV4cG9ydHMuV1JJVEVfQ09OQ0VSTl9LRVlTID0gWyd3JywgJ3d0aW1lb3V0JywgJ2onLCAnam91cm5hbCcsICdmc3luYyddO1xuLyoqXG4gKiBBIE1vbmdvREIgV3JpdGVDb25jZXJuLCB3aGljaCBkZXNjcmliZXMgdGhlIGxldmVsIG9mIGFja25vd2xlZGdlbWVudFxuICogcmVxdWVzdGVkIGZyb20gTW9uZ29EQiBmb3Igd3JpdGUgb3BlcmF0aW9ucy5cbiAqIEBwdWJsaWNcbiAqXG4gKiBAc2VlIGh0dHBzOi8vd3d3Lm1vbmdvZGIuY29tL2RvY3MvbWFudWFsL3JlZmVyZW5jZS93cml0ZS1jb25jZXJuL1xuICovXG5jbGFzcyBXcml0ZUNvbmNlcm4ge1xuICAgIC8qKlxuICAgICAqIENvbnN0cnVjdHMgYSBXcml0ZUNvbmNlcm4gZnJvbSB0aGUgd3JpdGUgY29uY2VybiBwcm9wZXJ0aWVzLlxuICAgICAqIEBwYXJhbSB3IC0gcmVxdWVzdCBhY2tub3dsZWRnbWVudCB0aGF0IHRoZSB3cml0ZSBvcGVyYXRpb24gaGFzIHByb3BhZ2F0ZWQgdG8gYSBzcGVjaWZpZWQgbnVtYmVyIG9mIG1vbmdvZCBpbnN0YW5jZXMgb3IgdG8gbW9uZ29kIGluc3RhbmNlcyB3aXRoIHNwZWNpZmllZCB0YWdzLlxuICAgICAqIEBwYXJhbSB3dGltZW91dE1TIC0gc3BlY2lmeSBhIHRpbWUgbGltaXQgdG8gcHJldmVudCB3cml0ZSBvcGVyYXRpb25zIGZyb20gYmxvY2tpbmcgaW5kZWZpbml0ZWx5XG4gICAgICogQHBhcmFtIGpvdXJuYWwgLSByZXF1ZXN0IGFja25vd2xlZGdtZW50IHRoYXQgdGhlIHdyaXRlIG9wZXJhdGlvbiBoYXMgYmVlbiB3cml0dGVuIHRvIHRoZSBvbi1kaXNrIGpvdXJuYWxcbiAgICAgKiBAcGFyYW0gZnN5bmMgLSBlcXVpdmFsZW50IHRvIHRoZSBqIG9wdGlvbi4gSXMgZGVwcmVjYXRlZCBhbmQgd2lsbCBiZSByZW1vdmVkIGluIHRoZSBuZXh0IG1ham9yIHZlcnNpb24uXG4gICAgICovXG4gICAgY29uc3RydWN0b3Iodywgd3RpbWVvdXRNUywgam91cm5hbCwgZnN5bmMpIHtcbiAgICAgICAgaWYgKHcgIT0gbnVsbCkge1xuICAgICAgICAgICAgaWYgKCFOdW1iZXIuaXNOYU4oTnVtYmVyKHcpKSkge1xuICAgICAgICAgICAgICAgIHRoaXMudyA9IE51bWJlcih3KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMudyA9IHc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHd0aW1lb3V0TVMgIT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy53dGltZW91dE1TID0gdGhpcy53dGltZW91dCA9IHd0aW1lb3V0TVM7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGpvdXJuYWwgIT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy5qb3VybmFsID0gdGhpcy5qID0gam91cm5hbDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZnN5bmMgIT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy5qb3VybmFsID0gdGhpcy5qID0gZnN5bmMgPyB0cnVlIDogZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogQXBwbHkgYSB3cml0ZSBjb25jZXJuIHRvIGEgY29tbWFuZCBkb2N1bWVudC4gV2lsbCBtb2RpZnkgYW5kIHJldHVybiB0aGUgY29tbWFuZC5cbiAgICAgKi9cbiAgICBzdGF0aWMgYXBwbHkoY29tbWFuZCwgd3JpdGVDb25jZXJuKSB7XG4gICAgICAgIGNvbnN0IHdjID0ge307XG4gICAgICAgIC8vIFRoZSB3cml0ZSBjb25jZXJuIGRvY3VtZW50IHNlbnQgdG8gdGhlIHNlcnZlciBoYXMgdy93dGltZW91dC9qIGZpZWxkcy5cbiAgICAgICAgaWYgKHdyaXRlQ29uY2Vybi53ICE9IG51bGwpXG4gICAgICAgICAgICB3Yy53ID0gd3JpdGVDb25jZXJuLnc7XG4gICAgICAgIGlmICh3cml0ZUNvbmNlcm4ud3RpbWVvdXRNUyAhPSBudWxsKVxuICAgICAgICAgICAgd2Mud3RpbWVvdXQgPSB3cml0ZUNvbmNlcm4ud3RpbWVvdXRNUztcbiAgICAgICAgaWYgKHdyaXRlQ29uY2Vybi5qb3VybmFsICE9IG51bGwpXG4gICAgICAgICAgICB3Yy5qID0gd3JpdGVDb25jZXJuLmo7XG4gICAgICAgIGNvbW1hbmQud3JpdGVDb25jZXJuID0gd2M7XG4gICAgICAgIHJldHVybiBjb21tYW5kO1xuICAgIH1cbiAgICAvKiogQ29uc3RydWN0IGEgV3JpdGVDb25jZXJuIGdpdmVuIGFuIG9wdGlvbnMgb2JqZWN0LiAqL1xuICAgIHN0YXRpYyBmcm9tT3B0aW9ucyhvcHRpb25zLCBpbmhlcml0KSB7XG4gICAgICAgIGlmIChvcHRpb25zID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICBpbmhlcml0ID0gaW5oZXJpdCA/PyB7fTtcbiAgICAgICAgbGV0IG9wdHM7XG4gICAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucyA9PT0gJ3N0cmluZycgfHwgdHlwZW9mIG9wdGlvbnMgPT09ICdudW1iZXInKSB7XG4gICAgICAgICAgICBvcHRzID0geyB3OiBvcHRpb25zIH07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAob3B0aW9ucyBpbnN0YW5jZW9mIFdyaXRlQ29uY2Vybikge1xuICAgICAgICAgICAgb3B0cyA9IG9wdGlvbnM7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBvcHRzID0gb3B0aW9ucy53cml0ZUNvbmNlcm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcGFyZW50T3B0cyA9IGluaGVyaXQgaW5zdGFuY2VvZiBXcml0ZUNvbmNlcm4gPyBpbmhlcml0IDogaW5oZXJpdC53cml0ZUNvbmNlcm47XG4gICAgICAgIGNvbnN0IHsgdyA9IHVuZGVmaW5lZCwgd3RpbWVvdXQgPSB1bmRlZmluZWQsIGogPSB1bmRlZmluZWQsIGZzeW5jID0gdW5kZWZpbmVkLCBqb3VybmFsID0gdW5kZWZpbmVkLCB3dGltZW91dE1TID0gdW5kZWZpbmVkIH0gPSB7XG4gICAgICAgICAgICAuLi5wYXJlbnRPcHRzLFxuICAgICAgICAgICAgLi4ub3B0c1xuICAgICAgICB9O1xuICAgICAgICBpZiAodyAhPSBudWxsIHx8XG4gICAgICAgICAgICB3dGltZW91dCAhPSBudWxsIHx8XG4gICAgICAgICAgICB3dGltZW91dE1TICE9IG51bGwgfHxcbiAgICAgICAgICAgIGogIT0gbnVsbCB8fFxuICAgICAgICAgICAgam91cm5hbCAhPSBudWxsIHx8XG4gICAgICAgICAgICBmc3luYyAhPSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFdyaXRlQ29uY2Vybih3LCB3dGltZW91dCA/PyB3dGltZW91dE1TLCBqID8/IGpvdXJuYWwsIGZzeW5jKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cbn1cbmV4cG9ydHMuV3JpdGVDb25jZXJuID0gV3JpdGVDb25jZXJuO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9d3JpdGVfY29uY2Vybi5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../server/node_modules/mongodb/lib/write_concern.js\n");

/***/ }),

/***/ "(api)/../server/node_modules/mongodb/package.json":
/*!***************************************************!*\
  !*** ../server/node_modules/mongodb/package.json ***!
  \***************************************************/
/***/ ((module) => {

module.exports = /*#__PURE__*/JSON.parse('{"name":"mongodb","version":"5.9.2","description":"The official MongoDB driver for Node.js","main":"lib/index.js","files":["lib","src","etc/prepare.js","mongodb.d.ts","tsconfig.json"],"types":"mongodb.d.ts","repository":{"type":"git","url":"git@github.com:mongodb/node-mongodb-native.git"},"keywords":["mongodb","driver","official"],"author":{"name":"The MongoDB NodeJS Team","email":"dbx-node@mongodb.com"},"dependencies":{"bson":"^5.5.0","mongodb-connection-string-url":"^2.6.0","socks":"^2.7.1"},"optionalDependencies":{"@mongodb-js/saslprep":"^1.1.0"},"peerDependencies":{"@aws-sdk/credential-providers":"^3.188.0","@mongodb-js/zstd":"^1.0.0","kerberos":"^1.0.0 || ^2.0.0","mongodb-client-encryption":">=2.3.0 <3","snappy":"^7.2.2"},"peerDependenciesMeta":{"@aws-sdk/credential-providers":{"optional":true},"@mongodb-js/zstd":{"optional":true},"kerberos":{"optional":true},"snappy":{"optional":true},"mongodb-client-encryption":{"optional":true}},"devDependencies":{"@iarna/toml":"^2.2.5","@istanbuljs/nyc-config-typescript":"^1.0.2","@microsoft/api-extractor":"^7.35.1","@microsoft/tsdoc-config":"^0.16.2","@mongodb-js/zstd":"^1.1.0","@octokit/core":"^4.2.4","@types/chai":"^4.3.5","@types/chai-subset":"^1.3.3","@types/express":"^4.17.17","@types/kerberos":"^1.1.2","@types/mocha":"^10.0.1","@types/node":"^20.1.0","@types/semver":"^7.5.0","@types/sinon":"^10.0.14","@types/sinon-chai":"^3.2.9","@types/whatwg-url":"^11.0.0","@typescript-eslint/eslint-plugin":"^5.59.5","@typescript-eslint/parser":"^5.59.5","chai":"^4.3.7","chai-subset":"^1.6.0","chalk":"^4.1.2","eslint":"^8.40.0","eslint-config-prettier":"^8.8.0","eslint-plugin-import":"^2.27.5","eslint-plugin-prettier":"^4.2.1","eslint-plugin-simple-import-sort":"^10.0.0","eslint-plugin-tsdoc":"^0.2.17","express":"^4.18.2","js-yaml":"^4.1.0","mocha":"^10.2.0","mocha-sinon":"^2.1.2","mongodb-legacy":"^5.0.0","nyc":"^15.1.0","prettier":"^2.8.8","semver":"^7.5.0","sinon":"^15.0.4","sinon-chai":"^3.7.0","snappy":"^7.2.2","source-map-support":"^0.5.21","ts-node":"^10.9.1","tsd":"^0.28.1","typescript":"^5.0.4","typescript-cached-transpile":"^0.0.6","v8-heapsnapshot":"^1.2.0","yargs":"^17.7.2"},"license":"Apache-2.0","engines":{"node":">=14.20.1"},"bugs":{"url":"https://jira.mongodb.org/projects/NODE/issues/"},"homepage":"https://github.com/mongodb/node-mongodb-native","scripts":{"build:evergreen":"node .evergreen/generate_evergreen_tasks.js","build:ts":"node ./node_modules/typescript/bin/tsc","build:dts":"npm run build:ts && api-extractor run && node etc/clean_definition_files.cjs","build:docs":"./etc/docs/build.ts","build:typedoc":"typedoc","build:nightly":"node ./.github/scripts/nightly.mjs","check:bench":"node test/benchmarks/driverBench","check:coverage":"nyc npm run test:all","check:integration-coverage":"nyc npm run check:test","check:lambda":"mocha --config test/mocha_lambda.json test/integration/node-specific/examples/handler.test.js","check:lambda:aws":"mocha --config test/mocha_lambda.json test/integration/node-specific/examples/aws_handler.test.js","check:lint":"npm run build:dts && npm run check:dts && npm run check:eslint && npm run check:tsd","check:eslint":"eslint -v && eslint --max-warnings=0 --ext \'.js,.ts\' src test","check:tsd":"tsd --version && tsd","check:dependencies":"mocha test/action/dependency.test.ts","check:dts":"node ./node_modules/typescript/bin/tsc --noEmit mongodb.d.ts && tsd","check:search-indexes":"nyc mocha --config test/mocha_mongodb.json test/manual/search-index-management.spec.test.ts","check:test":"mocha --config test/mocha_mongodb.json test/integration","check:unit":"mocha test/unit","check:ts":"node ./node_modules/typescript/bin/tsc -v && node ./node_modules/typescript/bin/tsc --noEmit","check:atlas":"mocha --config test/manual/mocharc.json test/manual/atlas_connectivity.test.js","check:adl":"mocha --config test/mocha_mongodb.json test/manual/atlas-data-lake-testing","check:aws":"nyc mocha --config test/mocha_mongodb.json test/integration/auth/mongodb_aws.test.ts","check:oidc":"mocha --config test/mocha_mongodb.json test/manual/mongodb_oidc.prose.test.ts","check:oidc-azure":"mocha --config test/mocha_mongodb.json test/integration/auth/mongodb_oidc_azure.prose.test.ts","check:ocsp":"mocha --config test/manual/mocharc.json test/manual/ocsp_support.test.js","check:kerberos":"nyc mocha --config test/manual/mocharc.json test/manual/kerberos.test.ts","check:tls":"mocha --config test/manual/mocharc.json test/manual/tls_support.test.js","check:ldap":"nyc mocha --config test/manual/mocharc.json test/manual/ldap.test.js","check:socks5":"mocha --config test/manual/mocharc.json test/manual/socks5.test.ts","check:csfle":"mocha --config test/mocha_mongodb.json test/integration/client-side-encryption","check:snappy":"mocha test/unit/assorted/snappy.test.js","fix:eslint":"npm run check:eslint -- --fix","prepare":"node etc/prepare.js","preview:docs":"ts-node etc/docs/preview.ts","test":"npm run check:lint && npm run test:all","test:all":"npm run check:unit && npm run check:test","update:docs":"npm run build:docs -- --yes"},"tsd":{"directory":"test/types","compilerOptions":{"strict":true,"target":"esnext","module":"commonjs","moduleResolution":"node"}}}');

/***/ })

};
;